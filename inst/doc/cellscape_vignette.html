<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">



<title>CellScape vignette</title>

<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEFkZCBhIG1ldGhvZCB0byBkZWxlZ2F0b3IgdGhhdCwgd2hlbiBpbnZva2VkLCBjYWxscwogIC8vIGRlbGVnYXRlZS5tZXRob2ROYW1lLiBJZiB0aGVyZSBpcyBubyBzdWNoIG1ldGhvZCBvbgogIC8vIHRoZSBkZWxlZ2F0ZWUsIGJ1dCB0aGVyZSB3YXMgb25lIG9uIGRlbGVnYXRvciBiZWZvcmUKICAvLyBkZWxlZ2F0ZU1ldGhvZCB3YXMgY2FsbGVkLCB0aGVuIHRoZSBvcmlnaW5hbCB2ZXJzaW9uCiAgLy8gaXMgaW52b2tlZCBpbnN0ZWFkLgogIC8vIEZvciBleGFtcGxlOgogIC8vCiAgLy8gdmFyIGEgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2ExJyk7IH0KICAvLyAgIG1ldGhvZDI6IGZ1bmN0aW9uKCkgeyBjb25zb2xlLmxvZygnYTInKTsgfQogIC8vIH07CiAgLy8gdmFyIGIgPSB7CiAgLy8gICBtZXRob2QxOiBmdW5jdGlvbigpIHsgY29uc29sZS5sb2coJ2IxJyk7IH0KICAvLyB9OwogIC8vIGRlbGVnYXRlTWV0aG9kKGEsIGIsICJtZXRob2QxIik7CiAgLy8gZGVsZWdhdGVNZXRob2QoYSwgYiwgIm1ldGhvZDIiKTsKICAvLyBhLm1ldGhvZDEoKTsKICAvLyBhLm1ldGhvZDIoKTsKICAvLwogIC8vIFRoZSBvdXRwdXQgd291bGQgYmUgImIxIiwgImEyIi4KICBmdW5jdGlvbiBkZWxlZ2F0ZU1ldGhvZChkZWxlZ2F0b3IsIGRlbGVnYXRlZSwgbWV0aG9kTmFtZSkgewogICAgdmFyIGluaGVyaXRlZCA9IGRlbGVnYXRvclttZXRob2ROYW1lXTsKICAgIGRlbGVnYXRvclttZXRob2ROYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgdGFyZ2V0ID0gZGVsZWdhdGVlOwogICAgICB2YXIgbWV0aG9kID0gZGVsZWdhdGVlW21ldGhvZE5hbWVdOwoKICAgICAgLy8gVGhlIG1ldGhvZCBkb2Vzbid0IGV4aXN0IG9uIHRoZSBkZWxlZ2F0ZWUuIEluc3RlYWQsCiAgICAgIC8vIGNhbGwgdGhlIG1ldGhvZCBvbiB0aGUgZGVsZWdhdG9yLCBpZiBpdCBleGlzdHMuCiAgICAgIGlmICghbWV0aG9kKSB7CiAgICAgICAgdGFyZ2V0ID0gZGVsZWdhdG9yOwogICAgICAgIG1ldGhvZCA9IGluaGVyaXRlZDsKICAgICAgfQoKICAgICAgaWYgKG1ldGhvZCkgewogICAgICAgIHJldHVybiBtZXRob2QuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpOwogICAgICB9CiAgICB9OwogIH0KCiAgLy8gSW1wbGVtZW50IGEgdmFndWUgZmFjc2ltaWxpZSBvZiBqUXVlcnkncyBkYXRhIG1ldGhvZAogIGZ1bmN0aW9uIGVsZW1lbnREYXRhKGVsLCBuYW1lLCB2YWx1ZSkgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMikgewogICAgICByZXR1cm4gZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV07CiAgICB9IGVsc2UgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMykgewogICAgICBlbFsiaHRtbHdpZGdldF9kYXRhXyIgKyBuYW1lXSA9IHZhbHVlOwogICAgICByZXR1cm4gZWw7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIG51bWJlciBvZiBhcmd1bWVudHMgZm9yIGVsZW1lbnREYXRhOiAiICsKICAgICAgICBhcmd1bWVudHMubGVuZ3RoKTsKICAgIH0KICB9CgogIC8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMzQ0NjE3MC9lc2NhcGUtc3RyaW5nLWZvci11c2UtaW4tamF2YXNjcmlwdC1yZWdleAogIGZ1bmN0aW9uIGVzY2FwZVJlZ0V4cChzdHIpIHsKICAgIHJldHVybiBzdHIucmVwbGFjZSgvW1wtXFtcXVwvXHtcfVwoXClcKlwrXD9cLlxcXF5cJFx8XS9nLCAiXFwkJiIpOwogIH0KCiAgZnVuY3Rpb24gaGFzQ2xhc3MoZWwsIGNsYXNzTmFtZSkgewogICAgdmFyIHJlID0gbmV3IFJlZ0V4cCgiXFxiIiArIGVzY2FwZVJlZ0V4cChjbGFzc05hbWUpICsgIlxcYiIpOwogICAgcmV0dXJuIHJlLnRlc3QoZWwuY2xhc3NOYW1lKTsKICB9CgogIC8vIGVsZW1lbnRzIC0gYXJyYXkgKG9yIGFycmF5LWxpa2Ugb2JqZWN0KSBvZiBIVE1MIGVsZW1lbnRzCiAgLy8gY2xhc3NOYW1lIC0gY2xhc3MgbmFtZSB0byB0ZXN0IGZvcgogIC8vIGluY2x1ZGUgLSBpZiB0cnVlLCBvbmx5IHJldHVybiBlbGVtZW50cyB3aXRoIGdpdmVuIGNsYXNzTmFtZTsKICAvLyAgIGlmIGZhbHNlLCBvbmx5IHJldHVybiBlbGVtZW50cyAqd2l0aG91dCogZ2l2ZW4gY2xhc3NOYW1lCiAgZnVuY3Rpb24gZmlsdGVyQnlDbGFzcyhlbGVtZW50cywgY2xhc3NOYW1lLCBpbmNsdWRlKSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaGFzQ2xhc3MoZWxlbWVudHNbaV0sIGNsYXNzTmFtZSkgPT0gaW5jbHVkZSkKICAgICAgICByZXN1bHRzLnB1c2goZWxlbWVudHNbaV0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQoKICBmdW5jdGlvbiBvbihvYmosIGV2ZW50TmFtZSwgZnVuYykgewogICAgaWYgKG9iai5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgIG9iai5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgfSBlbHNlIGlmIChvYmouYXR0YWNoRXZlbnQpIHsKICAgICAgb2JqLmF0dGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBvZmYob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmoucmVtb3ZlRXZlbnRMaXN0ZW5lcikKICAgICAgb2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCBmdW5jLCBmYWxzZSk7CiAgICBlbHNlIGlmIChvYmouZGV0YWNoRXZlbnQpIHsKICAgICAgb2JqLmRldGFjaEV2ZW50KGV2ZW50TmFtZSwgZnVuYyk7CiAgICB9CiAgfQoKICAvLyBUcmFuc2xhdGUgYXJyYXkgb2YgdmFsdWVzIHRvIHRvcC9yaWdodC9ib3R0b20vbGVmdCwgYXMgdXN1YWwgd2l0aAogIC8vIHRoZSAicGFkZGluZyIgQ1NTIHByb3BlcnR5CiAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQ1NTL3BhZGRpbmcKICBmdW5jdGlvbiB1bnBhY2tQYWRkaW5nKHZhbHVlKSB7CiAgICBpZiAodHlwZW9mKHZhbHVlKSA9PT0gIm51bWJlciIpCiAgICAgIHZhbHVlID0gW3ZhbHVlXTsKICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMF0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzBdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMF0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDMpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzFdfTsKICAgIH0KICAgIGlmICh2YWx1ZS5sZW5ndGggPT09IDQpIHsKICAgICAgcmV0dXJuIHt0b3A6IHZhbHVlWzBdLCByaWdodDogdmFsdWVbMV0sIGJvdHRvbTogdmFsdWVbMl0sIGxlZnQ6IHZhbHVlWzNdfTsKICAgIH0KICB9CgogIC8vIENvbnZlcnQgYW4gdW5wYWNrZWQgcGFkZGluZyBvYmplY3QgdG8gYSBDU1MgdmFsdWUKICBmdW5jdGlvbiBwYWRkaW5nVG9Dc3MocGFkZGluZ09iaikgewogICAgcmV0dXJuIHBhZGRpbmdPYmoudG9wICsgInB4ICIgKyBwYWRkaW5nT2JqLnJpZ2h0ICsgInB4ICIgKyBwYWRkaW5nT2JqLmJvdHRvbSArICJweCAiICsgcGFkZGluZ09iai5sZWZ0ICsgInB4IjsKICB9CgogIC8vIE1ha2VzIGEgbnVtYmVyIHN1aXRhYmxlIGZvciBDU1MKICBmdW5jdGlvbiBweCh4KSB7CiAgICBpZiAodHlwZW9mKHgpID09PSAibnVtYmVyIikKICAgICAgcmV0dXJuIHggKyAicHgiOwogICAgZWxzZQogICAgICByZXR1cm4geDsKICB9CgogIC8vIFJldHJpZXZlcyBydW50aW1lIHdpZGdldCBzaXppbmcgaW5mb3JtYXRpb24gZm9yIGFuIGVsZW1lbnQuCiAgLy8gVGhlIHJldHVybiB2YWx1ZSBpcyBlaXRoZXIgbnVsbCwgb3IgYW4gb2JqZWN0IHdpdGggZmlsbCwgcGFkZGluZywKICAvLyBkZWZhdWx0V2lkdGgsIGRlZmF1bHRIZWlnaHQgZmllbGRzLgogIGZ1bmN0aW9uIHNpemluZ1BvbGljeShlbCkgewogICAgdmFyIHNpemluZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vaHRtbHdpZGdldC1zaXppbmcnXSIpOwogICAgaWYgKCFzaXppbmdFbCkKICAgICAgcmV0dXJuIG51bGw7CiAgICB2YXIgc3AgPSBKU09OLnBhcnNlKHNpemluZ0VsLnRleHRDb250ZW50IHx8IHNpemluZ0VsLnRleHQgfHwgInt9Iik7CiAgICBpZiAodmlld2VyTW9kZSkgewogICAgICByZXR1cm4gc3Audmlld2VyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwLmJyb3dzZXI7CiAgICB9CiAgfQoKICAvLyBAcGFyYW0gdGFza3MgQXJyYXkgb2Ygc3RyaW5ncyAob3IgZmFsc3kgdmFsdWUsIGluIHdoaWNoIGNhc2Ugbm8tb3ApLgogIC8vICAgRWFjaCBlbGVtZW50IG11c3QgYmUgYSB2YWxpZCBKYXZhU2NyaXB0IGV4cHJlc3Npb24gdGhhdCB5aWVsZHMgYQogIC8vICAgZnVuY3Rpb24uIE9yLCBjYW4gYmUgYW4gYXJyYXkgb2Ygb2JqZWN0cyB3aXRoICJjb2RlIiBhbmQgImRhdGEiCiAgLy8gICBwcm9wZXJ0aWVzOyBpbiB0aGlzIGNhc2UsIHRoZSAiY29kZSIgcHJvcGVydHkgc2hvdWxkIGJlIGEgc3RyaW5nCiAgLy8gICBvZiBKUyB0aGF0J3MgYW4gZXhwciB0aGF0IHlpZWxkcyBhIGZ1bmN0aW9uLCBhbmQgImRhdGEiIHNob3VsZCBiZQogIC8vICAgYW4gb2JqZWN0IHRoYXQgd2lsbCBiZSBhZGRlZCBhcyBhbiBhZGRpdGlvbmFsIGFyZ3VtZW50IHdoZW4gdGhhdAogIC8vICAgZnVuY3Rpb24gaXMgY2FsbGVkLgogIC8vIEBwYXJhbSB0YXJnZXQgVGhlIG9iamVjdCB0aGF0IHdpbGwgYmUgInRoaXMiIGZvciBlYWNoIGZ1bmN0aW9uCiAgLy8gICBleGVjdXRpb24uCiAgLy8gQHBhcmFtIGFyZ3MgQXJyYXkgb2YgYXJndW1lbnRzIHRvIGJlIHBhc3NlZCB0byB0aGUgZnVuY3Rpb25zLiAoVGhlCiAgLy8gICBzYW1lIGFyZ3VtZW50cyB3aWxsIGJlIHBhc3NlZCB0byBhbGwgZnVuY3Rpb25zLikKICBmdW5jdGlvbiBldmFsQW5kUnVuKHRhc2tzLCB0YXJnZXQsIGFyZ3MpIHsKICAgIGlmICh0YXNrcykgewogICAgICBmb3JFYWNoKHRhc2tzLCBmdW5jdGlvbih0YXNrKSB7CiAgICAgICAgdmFyIHRoZXNlQXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKHR5cGVvZih0YXNrKSA9PT0gIm9iamVjdCIpIHsKICAgICAgICAgIHRoZXNlQXJncyA9IHRoZXNlQXJncy5jb25jYXQoW3Rhc2suZGF0YV0pOwogICAgICAgICAgdGFzayA9IHRhc2suY29kZTsKICAgICAgICB9CiAgICAgICAgdmFyIHRhc2tGdW5jID0gZXZhbCgiKCIgKyB0YXNrICsgIikiKTsKICAgICAgICBpZiAodHlwZW9mKHRhc2tGdW5jKSAhPT0gImZ1bmN0aW9uIikgewogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJUYXNrIG11c3QgYmUgYSBmdW5jdGlvbiEgU291cmNlOlxuIiArIHRhc2spOwogICAgICAgIH0KICAgICAgICB0YXNrRnVuYy5hcHBseSh0YXJnZXQsIHRoZXNlQXJncyk7CiAgICAgIH0pOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQoKICAgIC8vIFN1cHBvcnQgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb25zLiBPbGQtc3R5bGUgY2xhc3MtYm91bmQKICAgIC8vIGRlZmluaXRpb25zIGhhdmUgb25lIHdpZGdldCAib2JqZWN0IiBwZXIgd2lkZ2V0IHBlciB0eXBlL2NsYXNzIG9mCiAgICAvLyB3aWRnZXQ7IHRoZSByZW5kZXJWYWx1ZSBhbmQgcmVzaXplIG1ldGhvZHMgb24gc3VjaCB3aWRnZXQgb2JqZWN0cwogICAgLy8gdGFrZSBlbCBhbmQgaW5zdGFuY2UgYXJndW1lbnRzLCBiZWNhdXNlIHRoZSB3aWRnZXQgb2JqZWN0IGNhbid0CiAgICAvLyBzdG9yZSB0aGVtLiBOZXctc3R5bGUgaW5zdGFuY2UtYm91bmQgZGVmaW5pdGlvbnMgaGF2ZSBvbmUgd2lkZ2V0CiAgICAvLyBvYmplY3QgcGVyIHdpZGdldCBpbnN0YW5jZTsgdGhlIGRlZmluaXRpb24gdGhhdCdzIHBhc3NlZCBpbiBkb2Vzbid0CiAgICAvLyBwcm92aWRlIHJlbmRlclZhbHVlIG9yIHJlc2l6ZSBtZXRob2RzIGF0IGFsbCwganVzdCB0aGUgc2luZ2xlIG1ldGhvZAogICAgLy8gICBmYWN0b3J5KGVsLCB3aWR0aCwgaGVpZ2h0KQogICAgLy8gd2hpY2ggcmV0dXJucyBhbiBvYmplY3QgdGhhdCBoYXMgcmVuZGVyVmFsdWUoeCkgYW5kIHJlc2l6ZSh3LCBoKS4KICAgIC8vIFRoaXMgZW5hYmxlcyBhIGZhciBtb3JlIG5hdHVyYWwgcHJvZ3JhbW1pbmcgc3R5bGUgZm9yIHRoZSB3aWRnZXQKICAgIC8vIGF1dGhvciwgd2hvIGNhbiBzdG9yZSBwZXItaW5zdGFuY2Ugc3RhdGUgdXNpbmcgZWl0aGVyIE9PLXN0eWxlCiAgICAvLyBpbnN0YW5jZSBmaWVsZHMgb3IgZnVuY3Rpb25hbC1zdHlsZSBjbG9zdXJlIHZhcmlhYmxlcyAoSSBndWVzcyB0aGlzCiAgICAvLyBpcyBpbiBjb250cmFzdCB0byB3aGF0IGNhbiBvbmx5IGJlIGNhbGxlZCBDLXN0eWxlIHBzZXVkby1PTyB3aGljaCBpcwogICAgLy8gd2hhdCB3ZSByZXF1aXJlZCBiZWZvcmUpLgogICAgaWYgKGRlZmluaXRpb24uZmFjdG9yeSkgewogICAgICBkZWZpbml0aW9uID0gY3JlYXRlTGVnYWN5RGVmaW5pdGlvbkFkYXB0ZXIoZGVmaW5pdGlvbik7CiAgICB9CgogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gd2l0aCBhbiBvdXRwdXQgYmluZGluZy4KICAgICAgLy8gVGhlIGRlZmluaXRpb24gaXRzZWxmIHdpbGwgbm90IGJlIHRoZSBvdXRwdXQgYmluZGluZywgaW5zdGVhZAogICAgICAvLyB3ZSB3aWxsIG1ha2UgYW4gb3V0cHV0IGJpbmRpbmcgb2JqZWN0IHRoYXQgZGVsZWdhdGVzIHRvIHRoZQogICAgICAvLyBkZWZpbml0aW9uLiBUaGlzIGlzIGJlY2F1c2Ugd2UgZm9vbGlzaGx5IHVzZWQgdGhlIHNhbWUgbWV0aG9kCiAgICAgIC8vIG5hbWUgKHJlbmRlclZhbHVlKSBmb3IgaHRtbHdpZGdldHMgZGVmaW5pdGlvbiBhbmQgU2hpbnkgYmluZGluZ3MKICAgICAgLy8gYnV0IHRoZXkgYWN0dWFsbHkgaGF2ZSBxdWl0ZSBkaWZmZXJlbnQgc2VtYW50aWNzICh0aGUgU2hpbnkKICAgICAgLy8gYmluZGluZ3MgcmVjZWl2ZSBkYXRhIHRoYXQgaW5jbHVkZXMgbG90cyBvZiBtZXRhZGF0YSB0aGF0IGl0CiAgICAgIC8vIHN0cmlwcyBvZmYgYmVmb3JlIGNhbGxpbmcgaHRtbHdpZGdldHMgcmVuZGVyVmFsdWUpLiBXZSBjYW4ndAogICAgICAvLyBqdXN0IGlnbm9yZSB0aGUgZGlmZmVyZW5jZSBiZWNhdXNlIGluIHNvbWUgd2lkZ2V0cyBpdCdzIGhlbHBmdWwKICAgICAgLy8gdG8gY2FsbCB0aGlzLnJlbmRlclZhbHVlKCkgZnJvbSBpbnNpZGUgb2YgcmVzaXplKCksIGFuZCBpZgogICAgICAvLyB3ZSdyZSBub3QgZGVsZWdhdGluZywgdGhlbiB0aGF0IGNhbGwgd2lsbCBnbyB0byB0aGUgU2hpbnkKICAgICAgLy8gdmVyc2lvbiBpbnN0ZWFkIG9mIHRoZSBodG1sd2lkZ2V0cyB2ZXJzaW9uLgoKICAgICAgLy8gTWVyZ2UgZGVmYXVsdHMgd2l0aCBkZWZpbml0aW9uLCB3aXRob3V0IG11dGF0aW5nIGVpdGhlci4KICAgICAgdmFyIGJpbmRpbmdEZWYgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKCiAgICAgIC8vIFRoaXMgb2JqZWN0IHdpbGwgYmUgb3VyIGFjdHVhbCBTaGlueSBiaW5kaW5nLgogICAgICB2YXIgc2hpbnlCaW5kaW5nID0gbmV3IFNoaW55Lk91dHB1dEJpbmRpbmcoKTsKCiAgICAgIC8vIFdpdGggYSBmZXcgZXhjZXB0aW9ucywgd2UnbGwgd2FudCB0byBzaW1wbHkgdXNlIHRoZSBiaW5kaW5nRGVmJ3MKICAgICAgLy8gdmVyc2lvbiBvZiBtZXRob2RzIGlmIHRoZXkgYXJlIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGwgYmFjayB0bwogICAgICAvLyBTaGlueSdzIGRlZmF1bHRzLiBOT1RFOiBJZiBTaGlueSdzIG91dHB1dCBiaW5kaW5ncyBnYWluIGFkZGl0aW9uYWwKICAgICAgLy8gbWV0aG9kcyBpbiB0aGUgZnV0dXJlLCBhbmQgd2Ugd2FudCB0aGVtIHRvIGJlIG92ZXJyaWRlYWJsZSBieQogICAgICAvLyBIVE1MV2lkZ2V0IGJpbmRpbmcgZGVmaW5pdGlvbnMsIHRoZW4gd2UnbGwgbmVlZCB0byBhZGQgdGhlbSB0byB0aGlzCiAgICAgIC8vIGxpc3QuCiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImdldElkIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgIm9uVmFsdWVDaGFuZ2UiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAib25WYWx1ZUVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgInJlbmRlckVycm9yIik7CiAgICAgIGRlbGVnYXRlTWV0aG9kKHNoaW55QmluZGluZywgYmluZGluZ0RlZiwgImNsZWFyRXJyb3IiKTsKICAgICAgZGVsZWdhdGVNZXRob2Qoc2hpbnlCaW5kaW5nLCBiaW5kaW5nRGVmLCAic2hvd1Byb2dyZXNzIik7CgogICAgICAvLyBUaGUgZmluZCwgcmVuZGVyVmFsdWUsIGFuZCByZXNpemUgYXJlIGhhbmRsZWQgZGlmZmVyZW50bHksIGJlY2F1c2Ugd2UKICAgICAgLy8gd2FudCB0byBhY3R1YWxseSBkZWNvcmF0ZSB0aGUgYmVoYXZpb3Igb2YgdGhlIGJpbmRpbmdEZWYgbWV0aG9kcy4KCiAgICAgIHNoaW55QmluZGluZy5maW5kID0gZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgICB2YXIgcmVzdWx0cyA9IGJpbmRpbmdEZWYuZmluZChzY29wZSk7CgogICAgICAgIC8vIE9ubHkgcmV0dXJuIGVsZW1lbnRzIHRoYXQgYXJlIFNoaW55IG91dHB1dHMsIG5vdCBzdGF0aWMgb25lcwogICAgICAgIHZhciBkeW5hbWljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKCIuaHRtbC13aWRnZXQtb3V0cHV0Iik7CgogICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAvLyBuZXcgZHluYW1pYyBvdXRwdXRzLCBhbHNvIGNhdXNlZCB0aGVyZSB0byBiZSBuZXcgc3RhdGljIG91dHB1dHMuCiAgICAgICAgLy8gU2luY2UgdGhlcmUgbWlnaHQgYmUgbG90cyBvZiBkaWZmZXJlbnQgaHRtbHdpZGdldHMgYmluZGluZ3MsIHdlCiAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAvLyB0aW1lcy4KICAgICAgICBpZiAocmVzdWx0cy5sZW5ndGggIT09IGR5bmFtaWNSZXN1bHRzLmxlbmd0aCkKICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgIHJldHVybiBkeW5hbWljUmVzdWx0czsKICAgICAgfTsKCiAgICAgIC8vIFdyYXAgcmVuZGVyVmFsdWUgdG8gaGFuZGxlIGluaXRpYWxpemF0aW9uLCB3aGljaCB1bmZvcnR1bmF0ZWx5IGlzbid0CiAgICAgIC8vIHN1cHBvcnRlZCBuYXRpdmVseSBieSBTaGlueSBhdCB0aGUgdGltZSBvZiB0aGlzIHdyaXRpbmcuCgogICAgICBzaGlueUJpbmRpbmcucmVuZGVyVmFsdWUgPSBmdW5jdGlvbihlbCwgZGF0YSkgewogICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgZGF0YS5ldmFscyAmJiBpIDwgZGF0YS5ldmFscy5sZW5ndGg7IGkrKykgewogICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIGlmICghYmluZGluZ0RlZi5yZW5kZXJPbk51bGxWYWx1ZSkgewogICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICBlbC5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaW5oZXJpdCI7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICBpbml0U2l6aW5nKGVsKTsKCiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICBpZiAoYmluZGluZ0RlZi5pbml0aWFsaXplKSB7CiAgICAgICAgICAgIHZhciByZXN1bHQgPSBiaW5kaW5nRGVmLmluaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICAgIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiLCByZXN1bHQpOwogICAgICAgICAgfQogICAgICAgICAgZXZhbEFuZFJ1bihkYXRhLmpzSG9va3MucmVuZGVyLCBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiksIFtlbCwgZGF0YS54XSk7CiAgICAgICAgfQogICAgICAgIFNoaW55LnJlbmRlckRlcGVuZGVuY2llcyhkYXRhLmRlcHMpOwogICAgICAgIGJpbmRpbmdEZWYucmVuZGVyVmFsdWUoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgfTsKCiAgICAgIC8vIE9ubHkgb3ZlcnJpZGUgcmVzaXplIGlmIGJpbmRpbmdEZWYgaW1wbGVtZW50cyBpdAogICAgICBpZiAoYmluZGluZ0RlZi5yZXNpemUpIHsKICAgICAgICBzaGlueUJpbmRpbmcucmVzaXplID0gZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgIC8vIFNoaW55IGNhbiBjYWxsIHJlc2l6ZSBiZWZvcmUgaW5pdGlhbGl6ZS9yZW5kZXJWYWx1ZSBoYXZlIGJlZW4KICAgICAgICAgIC8vIGNhbGxlZCwgd2hpY2ggZG9lc24ndCBtYWtlIHNlbnNlIGZvciB3aWRnZXRzLgogICAgICAgICAgaWYgKGVsZW1lbnREYXRhKGVsLCAiaW5pdGlhbGl6ZWQiKSkgewogICAgICAgICAgICBiaW5kaW5nRGVmLnJlc2l6ZShlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9CgogICAgICBTaGlueS5vdXRwdXRCaW5kaW5ncy5yZWdpc3RlcihzaGlueUJpbmRpbmcsIGJpbmRpbmdEZWYubmFtZSk7CiAgICB9CiAgfTsKCiAgdmFyIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgZnVuY3Rpb24gc2NoZWR1bGVTdGF0aWNSZW5kZXIoKSB7CiAgICBpZiAoIXNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCkgewogICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyVGltZXJJZCA9IG51bGw7CiAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlcigpOwogICAgICB9LCAxKTsKICAgIH0KICB9CgogIC8vIFJlbmRlciBzdGF0aWMgd2lkZ2V0cyBhZnRlciB0aGUgZG9jdW1lbnQgZmluaXNoZXMgbG9hZGluZwogIC8vIFN0YXRpY2FsbHkgcmVuZGVyIGFsbCBlbGVtZW50cyB0aGF0IGFyZSBvZiB0aGlzIHdpZGdldCdzIGNsYXNzCiAgd2luZG93LkhUTUxXaWRnZXRzLnN0YXRpY1JlbmRlciA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGJpbmRpbmdzID0gd2luZG93LkhUTUxXaWRnZXRzLndpZGdldHMgfHwgW107CiAgICBmb3JFYWNoKGJpbmRpbmdzLCBmdW5jdGlvbihiaW5kaW5nKSB7CiAgICAgIHZhciBtYXRjaGVzID0gYmluZGluZy5maW5kKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCk7CiAgICAgIGZvckVhY2gobWF0Y2hlcywgZnVuY3Rpb24oZWwpIHsKICAgICAgICB2YXIgc2l6ZU9iaiA9IGluaXRTaXppbmcoZWwsIGJpbmRpbmcpOwoKICAgICAgICBpZiAoaGFzQ2xhc3MoZWwsICJodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiKSkKICAgICAgICAgIHJldHVybjsKICAgICAgICBlbC5jbGFzc05hbWUgPSBlbC5jbGFzc05hbWUgKyAiIGh0bWwtd2lkZ2V0LXN0YXRpYy1ib3VuZCI7CgogICAgICAgIHZhciBpbml0UmVzdWx0OwogICAgICAgIGlmIChiaW5kaW5nLmluaXRpYWxpemUpIHsKICAgICAgICAgIGluaXRSZXN1bHQgPSBiaW5kaW5nLmluaXRpYWxpemUoZWwsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICk7CiAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgaW5pdFJlc3VsdCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYmluZGluZy5yZXNpemUpIHsKICAgICAgICAgIHZhciBsYXN0U2l6ZSA9IHt9OwogICAgICAgICAgdmFyIHJlc2l6ZUhhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgICAgIHZhciBzaXplID0gewogICAgICAgICAgICAgIHc6IHNpemVPYmogPyBzaXplT2JqLmdldFdpZHRoKCkgOiBlbC5vZmZzZXRXaWR0aCwKICAgICAgICAgICAgICBoOiBzaXplT2JqID8gc2l6ZU9iai5nZXRIZWlnaHQoKSA6IGVsLm9mZnNldEhlaWdodAogICAgICAgICAgICB9OwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSAwICYmIHNpemUuaCA9PT0gMCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGlmIChzaXplLncgPT09IGxhc3RTaXplLncgJiYgc2l6ZS5oID09PSBsYXN0U2l6ZS5oKQogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgbGFzdFNpemUgPSBzaXplOwogICAgICAgICAgICBiaW5kaW5nLnJlc2l6ZShlbCwgc2l6ZS53LCBzaXplLmgsIGluaXRSZXN1bHQpOwogICAgICAgICAgfTsKCiAgICAgICAgICBvbih3aW5kb3csICJyZXNpemUiLCByZXNpemVIYW5kbGVyKTsKCiAgICAgICAgICAvLyBUaGlzIGlzIG5lZWRlZCBmb3IgY2FzZXMgd2hlcmUgd2UncmUgcnVubmluZyBpbiBhIFNoaW55CiAgICAgICAgICAvLyBhcHAsIGJ1dCB0aGUgd2lkZ2V0IGl0c2VsZiBpcyBub3QgYSBTaGlueSBvdXRwdXQsIGJ1dAogICAgICAgICAgLy8gcmF0aGVyIGEgc2ltcGxlIHN0YXRpYyB3aWRnZXQuIE9uZSBleGFtcGxlIG9mIHRoaXMgaXMKICAgICAgICAgIC8vIGFuIHJtYXJrZG93biBkb2N1bWVudCB0aGF0IGhhcyBydW50aW1lOnNoaW55IGFuZCB3aWRnZXQKICAgICAgICAgIC8vIHRoYXQgaXNuJ3QgaW4gYSByZW5kZXIgZnVuY3Rpb24uIFNoaW55IG9ubHkga25vd3MgdG8KICAgICAgICAgIC8vIGNhbGwgcmVzaXplIGhhbmRsZXJzIGZvciBTaGlueSBvdXRwdXRzLCBub3QgZm9yIHN0YXRpYwogICAgICAgICAgLy8gd2lkZ2V0cywgc28gd2UgZG8gaXQgb3Vyc2VsdmVzLgogICAgICAgICAgaWYgKHdpbmRvdy5qUXVlcnkpIHsKICAgICAgICAgICAgd2luZG93LmpRdWVyeShkb2N1bWVudCkub24oCiAgICAgICAgICAgICAgInNob3duLmh0bWx3aWRnZXRzIHNob3duLmJzLnRhYi5odG1sd2lkZ2V0cyBzaG93bi5icy5jb2xsYXBzZS5odG1sd2lkZ2V0cyIsCiAgICAgICAgICAgICAgcmVzaXplSGFuZGxlcgogICAgICAgICAgICApOwogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigKICAgICAgICAgICAgICAiaGlkZGVuLmh0bWx3aWRnZXRzIGhpZGRlbi5icy50YWIuaHRtbHdpZGdldHMgaGlkZGVuLmJzLmNvbGxhcHNlLmh0bWx3aWRnZXRzIiwKICAgICAgICAgICAgICByZXNpemVIYW5kbGVyCiAgICAgICAgICAgICk7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIHRoZSBzcGVjaWZpYyBjYXNlIG9mIGlvc2xpZGVzLCB3aGljaAogICAgICAgICAgLy8gZmxpcHMgc2xpZGVzIGJldHdlZW4gZGlzcGxheTpub25lIGFuZCBkaXNwbGF5OmJsb2NrLgogICAgICAgICAgLy8gSWRlYWxseSB3ZSB3b3VsZCBub3QgaGF2ZSB0byBoYXZlIGlvc2xpZGUtc3BlY2lmaWMgY29kZQogICAgICAgICAgLy8gaGVyZSwgYnV0IHJhdGhlciBoYXZlIGlvc2xpZGVzIHJhaXNlIGEgZ2VuZXJpYyBldmVudCwKICAgICAgICAgIC8vIGJ1dCB0aGUgcm1hcmtkb3duIHBhY2thZ2UganVzdCB3ZW50IHRvIENSQU4gc28gdGhlCiAgICAgICAgICAvLyB3aW5kb3cgdG8gZ2V0dGluZyB0aGF0IGZpeGVkIG1heSBiZSBsb25nLgogICAgICAgICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgIC8vIEl0J3MgT0sgdG8gbGltaXQgdGhpcyB0byB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICAgICAvLyBicm93c2VycyBiZWNhdXNlIGlvc2xpZGVzIGl0c2VsZiBvbmx5IHN1cHBvcnRzCiAgICAgICAgICAgIC8vIHN1Y2ggYnJvd3NlcnMuCiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVlbnRlciIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlbGVhdmUiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzY3JpcHREYXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vanNvbiddIik7CiAgICAgICAgaWYgKHNjcmlwdERhdGEpIHsKICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShzY3JpcHREYXRhLnRleHRDb250ZW50IHx8IHNjcmlwdERhdGEudGV4dCk7CiAgICAgICAgICAvLyBSZXNvbHZlIHN0cmluZ3MgbWFya2VkIGFzIGphdmFzY3JpcHQgbGl0ZXJhbHMgdG8gb2JqZWN0cwogICAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBkYXRhLmV2YWxzICYmIGsgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlcihkYXRhLngsIGRhdGEuZXZhbHNba10pOwogICAgICAgICAgfQogICAgICAgICAgYmluZGluZy5yZW5kZXJWYWx1ZShlbCwgZGF0YS54LCBpbml0UmVzdWx0KTsKICAgICAgICAgIGV2YWxBbmRSdW4oZGF0YS5qc0hvb2tzLnJlbmRlciwgaW5pdFJlc3VsdCwgW2VsLCBkYXRhLnhdKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CgogICAgaW52b2tlUG9zdFJlbmRlckhhbmRsZXJzKCk7CiAgfQoKICAvLyBXYWl0IHVudGlsIGFmdGVyIHRoZSBkb2N1bWVudCBoYXMgbG9hZGVkIHRvIHJlbmRlciB0aGUgd2lkZ2V0cy4KICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgewogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgYXJndW1lbnRzLmNhbGxlZSwgZmFsc2UpOwogICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICB9LCBmYWxzZSk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgewogICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIikgewogICAgICAgIGRvY3VtZW50LmRldGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBhcmd1bWVudHMuY2FsbGVlKTsKICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICAgIH0KICAgIH0pOwogIH0KCgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRBdHRhY2htZW50VXJsID0gZnVuY3Rpb24oZGVwbmFtZSwga2V5KSB7CiAgICAvLyBJZiBubyBrZXksIGRlZmF1bHQgdG8gdGhlIGZpcnN0IGl0ZW0KICAgIGlmICh0eXBlb2Yoa2V5KSA9PT0gInVuZGVmaW5lZCIpCiAgICAgIGtleSA9IDE7CgogICAgdmFyIGxpbmsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZXBuYW1lICsgIi0iICsga2V5ICsgIi1hdHRhY2htZW50Iik7CiAgICBpZiAoIWxpbmspIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBdHRhY2htZW50ICIgKyBkZXBuYW1lICsgIi8iICsga2V5ICsgIiBub3QgZm91bmQgaW4gZG9jdW1lbnQiKTsKICAgIH0KICAgIHJldHVybiBsaW5rLmdldEF0dHJpYnV0ZSgiaHJlZiIpOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5kYXRhZnJhbWVUb0QzID0gZnVuY3Rpb24oZGYpIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgdmFyIGxlbmd0aDsKICAgIGZvciAodmFyIG5hbWUgaW4gZGYpIHsKICAgICAgICBpZiAoZGYuaGFzT3duUHJvcGVydHkobmFtZSkpCiAgICAgICAgICAgIG5hbWVzLnB1c2gobmFtZSk7CiAgICAgICAgaWYgKHR5cGVvZihkZltuYW1lXSkgIT09ICJvYmplY3QiIHx8IHR5cGVvZihkZltuYW1lXS5sZW5ndGgpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihsZW5ndGgpICE9PSAidW5kZWZpbmVkIiAmJiBsZW5ndGggIT09IGRmW25hbWVdLmxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMgb2YgdGhlIHNhbWUgbGVuZ3RoIik7CiAgICAgICAgfQogICAgICAgIGxlbmd0aCA9IGRmW25hbWVdLmxlbmd0aDsKICAgIH0KICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgaXRlbTsKICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IGxlbmd0aDsgcm93KyspIHsKICAgICAgICBpdGVtID0ge307CiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbmFtZXMubGVuZ3RoOyBjb2wrKykgewogICAgICAgICAgICBpdGVtW25hbWVzW2NvbF1dID0gZGZbbmFtZXNbY29sXV1bcm93XTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLnRyYW5zcG9zZUFycmF5MkQgPSBmdW5jdGlvbihhcnJheSkgewogICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSByZXR1cm4gYXJyYXk7CiAgICAgIHZhciBuZXdBcnJheSA9IGFycmF5WzBdLm1hcChmdW5jdGlvbihjb2wsIGkpIHsKICAgICAgICAgIHJldHVybiBhcnJheS5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJvd1tpXQogICAgICAgICAgfSkKICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdBcnJheTsKICB9OwogIC8vIFNwbGl0IHZhbHVlIGF0IHNwbGl0Q2hhciwgYnV0IGFsbG93IHNwbGl0Q2hhciB0byBiZSBlc2NhcGVkCiAgLy8gdXNpbmcgZXNjYXBlQ2hhci4gQW55IG90aGVyIGNoYXJhY3RlcnMgZXNjYXBlZCBieSBlc2NhcGVDaGFyCiAgLy8gd2lsbCBiZSBpbmNsdWRlZCBhcyB1c3VhbCAoaW5jbHVkaW5nIGVzY2FwZUNoYXIgaXRzZWxmKS4KICBmdW5jdGlvbiBzcGxpdFdpdGhFc2NhcGUodmFsdWUsIHNwbGl0Q2hhciwgZXNjYXBlQ2hhcikgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICB2YXIgY3VycmVudFJlc3VsdCA9ICIiOwogICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgdmFsdWUubGVuZ3RoOyBwb3MrKykgewogICAgICBpZiAoIWVzY2FwZU1vZGUpIHsKICAgICAgICBpZiAodmFsdWVbcG9zXSA9PT0gc3BsaXRDaGFyKSB7CiAgICAgICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZVtwb3NdID09PSBlc2NhcGVDaGFyKSB7CiAgICAgICAgICBlc2NhcGVNb2RlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudFJlc3VsdCAhPT0gIiIpIHsKICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQogIC8vIEZ1bmN0aW9uIGF1dGhvcmVkIGJ5IFlpaHVpL0pKIEFsbGFpcmUKICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIgPSBmdW5jdGlvbihvLCBtZW1iZXIpIHsKICAgIHZhciBwYXJ0cyA9IHNwbGl0V2l0aEVzY2FwZShtZW1iZXIsICcuJywgJ1xcJyk7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBhcnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgcGFydCA9IHBhcnRzW2ldOwogICAgICAvLyBwYXJ0IG1heSBiZSBhIGNoYXJhY3RlciBvciAnbnVtZXJpYycgbWVtYmVyIG5hbWUKICAgICAgaWYgKG8gIT09IG51bGwgJiYgdHlwZW9mIG8gPT09ICJvYmplY3QiICYmIHBhcnQgaW4gbykgewogICAgICAgIGlmIChpID09IChsIC0gMSkpIHsgLy8gaWYgd2UgYXJlIGF0IHRoZSBlbmQgb2YgdGhlIGxpbmUgdGhlbiBldmFsdWxhdGUKICAgICAgICAgIGlmICh0eXBlb2Ygb1twYXJ0XSA9PT0gInN0cmluZyIpCiAgICAgICAgICAgIG9bcGFydF0gPSBldmFsKCIoIiArIG9bcGFydF0gKyAiKSIpOwogICAgICAgIH0gZWxzZSB7IC8vIG90aGVyd2lzZSBjb250aW51ZSB0byBuZXh0IGVtYmVkZGVkIG9iamVjdAogICAgICAgICAgbyA9IG9bcGFydF07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKCiAgLy8gUmV0cmlldmUgdGhlIEhUTUxXaWRnZXQgaW5zdGFuY2UgKGkuZS4gdGhlIHJldHVybiB2YWx1ZSBvZiBhbgogIC8vIEhUTUxXaWRnZXQgYmluZGluZydzIGluaXRpYWxpemUoKSBvciBmYWN0b3J5KCkgZnVuY3Rpb24pCiAgLy8gYXNzb2NpYXRlZCB3aXRoIGFuIGVsZW1lbnQsIG9yIG51bGwgaWYgbm9uZS4KICB3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2UgPSBmdW5jdGlvbihlbCkgewogICAgcmV0dXJuIGVsZW1lbnREYXRhKGVsLCAiaW5pdF9yZXN1bHQiKTsKICB9OwoKICAvLyBGaW5kcyB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGUgc2NvcGUgdGhhdCBtYXRjaGVzIHRoZSBzZWxlY3RvciwKICAvLyBhbmQgcmV0dXJucyB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZSAoaS5lLiB0aGUgcmV0dXJuIHZhbHVlIG9mCiAgLy8gYW4gSFRNTFdpZGdldCBiaW5kaW5nJ3MgaW5pdGlhbGl6ZSgpIG9yIGZhY3RvcnkoKSBmdW5jdGlvbikKICAvLyBhc3NvY2lhdGVkIHdpdGggdGhhdCBlbGVtZW50LCBpZiBhbnkuIElmIG5vIGVsZW1lbnQgbWF0Y2hlcyB0aGUKICAvLyBzZWxlY3Rvciwgb3IgdGhlIGZpcnN0IG1hdGNoaW5nIGVsZW1lbnQgaGFzIG5vIEhUTUxXaWRnZXQKICAvLyBpbnN0YW5jZSBhc3NvY2lhdGVkIHdpdGggaXQsIHRoZW4gbnVsbCBpcyByZXR1cm5lZC4KICAvLwogIC8vIFRoZSBzY29wZSBhcmd1bWVudCBpcyBvcHRpb25hbCwgYW5kIGRlZmF1bHRzIHRvIHdpbmRvdy5kb2N1bWVudC4KICB3aW5kb3cuSFRNTFdpZGdldHMuZmluZCA9IGZ1bmN0aW9uKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT0gMSkgewogICAgICBzZWxlY3RvciA9IHNjb3BlOwogICAgICBzY29wZSA9IGRvY3VtZW50OwogICAgfQoKICAgIHZhciBlbCA9IHNjb3BlLnF1ZXJ5U2VsZWN0b3Ioc2VsZWN0b3IpOwogICAgaWYgKGVsID09PSBudWxsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRJbnN0YW5jZShlbCk7CiAgICB9CiAgfTsKCiAgLy8gRmluZHMgYWxsIGVsZW1lbnRzIGluIHRoZSBzY29wZSB0aGF0IG1hdGNoIHRoZSBzZWxlY3RvciwgYW5kCiAgLy8gcmV0dXJucyB0aGUgSFRNTFdpZGdldCBpbnN0YW5jZXMgKGkuZS4gdGhlIHJldHVybiB2YWx1ZXMgb2YKICAvLyBhbiBIVE1MV2lkZ2V0IGJpbmRpbmcncyBpbml0aWFsaXplKCkgb3IgZmFjdG9yeSgpIGZ1bmN0aW9uKQogIC8vIGFzc29jaWF0ZWQgd2l0aCB0aGUgZWxlbWVudHMsIGluIGFuIGFycmF5LiBJZiBlbGVtZW50cyB0aGF0CiAgLy8gbWF0Y2ggdGhlIHNlbGVjdG9yIGRvbid0IGhhdmUgYW4gYXNzb2NpYXRlZCBIVE1MV2lkZ2V0CiAgLy8gaW5zdGFuY2UsIHRoZSByZXR1cm5lZCBhcnJheSB3aWxsIGNvbnRhaW4gbnVsbHMuCiAgLy8KICAvLyBUaGUgc2NvcGUgYXJndW1lbnQgaXMgb3B0aW9uYWwsIGFuZCBkZWZhdWx0cyB0byB3aW5kb3cuZG9jdW1lbnQuCiAgd2luZG93LkhUTUxXaWRnZXRzLmZpbmRBbGwgPSBmdW5jdGlvbihzY29wZSwgc2VsZWN0b3IpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgc2VsZWN0b3IgPSBzY29wZTsKICAgICAgc2NvcGUgPSBkb2N1bWVudDsKICAgIH0KCiAgICB2YXIgbm9kZXMgPSBzY29wZS5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTsKICAgIHZhciByZXN1bHRzID0gW107CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdHMucHVzaCh3aW5kb3cuSFRNTFdpZGdldHMuZ2V0SW5zdGFuY2Uobm9kZXNbaV0pKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIHZhciBwb3N0UmVuZGVySGFuZGxlcnMgPSBbXTsKICBmdW5jdGlvbiBpbnZva2VQb3N0UmVuZGVySGFuZGxlcnMoKSB7CiAgICB3aGlsZSAocG9zdFJlbmRlckhhbmRsZXJzLmxlbmd0aCkgewogICAgICB2YXIgaGFuZGxlciA9IHBvc3RSZW5kZXJIYW5kbGVycy5zaGlmdCgpOwogICAgICBpZiAoaGFuZGxlcikgewogICAgICAgIGhhbmRsZXIoKTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmVnaXN0ZXIgdGhlIGdpdmVuIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGludm9rZWQgYWZ0ZXIgdGhlCiAgLy8gbmV4dCB0aW1lIHN0YXRpYyB3aWRnZXRzIGFyZSByZW5kZXJlZC4KICB3aW5kb3cuSFRNTFdpZGdldHMuYWRkUG9zdFJlbmRlckhhbmRsZXIgPSBmdW5jdGlvbihjYWxsYmFjaykgewogICAgcG9zdFJlbmRlckhhbmRsZXJzLnB1c2goY2FsbGJhY2spOwogIH07CgogIC8vIFRha2VzIGEgbmV3LXN0eWxlIGluc3RhbmNlLWJvdW5kIGRlZmluaXRpb24sIGFuZCByZXR1cm5zIGFuCiAgLy8gb2xkLXN0eWxlIGNsYXNzLWJvdW5kIGRlZmluaXRpb24uIFRoaXMgc2F2ZXMgdXMgZnJvbSBoYXZpbmcKICAvLyB0byByZXdyaXRlIGFsbCB0aGUgbG9naWMgaW4gdGhpcyBmaWxlIHRvIGFjY29tb2RhdGUgYm90aAogIC8vIHR5cGVzIG9mIGRlZmluaXRpb25zLgogIGZ1bmN0aW9uIGNyZWF0ZUxlZ2FjeURlZmluaXRpb25BZGFwdGVyKGRlZm4pIHsKICAgIHZhciByZXN1bHQgPSB7CiAgICAgIG5hbWU6IGRlZm4ubmFtZSwKICAgICAgdHlwZTogZGVmbi50eXBlLAogICAgICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgIHJldHVybiBkZWZuLmZhY3RvcnkoZWwsIHdpZHRoLCBoZWlnaHQpOwogICAgICB9LAogICAgICByZW5kZXJWYWx1ZTogZnVuY3Rpb24oZWwsIHgsIGluc3RhbmNlKSB7CiAgICAgICAgcmV0dXJuIGluc3RhbmNlLnJlbmRlclZhbHVlKHgpOwogICAgICB9LAogICAgICByZXNpemU6IGZ1bmN0aW9uKGVsLCB3aWR0aCwgaGVpZ2h0LCBpbnN0YW5jZSkgewogICAgICAgIHJldHVybiBpbnN0YW5jZS5yZXNpemUod2lkdGgsIGhlaWdodCk7CiAgICAgIH0KICAgIH07CgogICAgaWYgKGRlZm4uZmluZCkKICAgICAgcmVzdWx0LmZpbmQgPSBkZWZuLmZpbmQ7CiAgICBpZiAoZGVmbi5yZW5kZXJFcnJvcikKICAgICAgcmVzdWx0LnJlbmRlckVycm9yID0gZGVmbi5yZW5kZXJFcnJvcjsKICAgIGlmIChkZWZuLmNsZWFyRXJyb3IpCiAgICAgIHJlc3VsdC5jbGVhckVycm9yID0gZGVmbi5jbGVhckVycm9yOwoKICAgIHJldHVybiByZXN1bHQ7CiAgfQp9KSgpOwoK"></script>
<script src="data:application/x-javascript;base64,IWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gbiYmKG4ub3duZXJEb2N1bWVudHx8bi5kb2N1bWVudHx8bikuZG9jdW1lbnRFbGVtZW50fWZ1bmN0aW9uIHQobil7cmV0dXJuIG4mJihuLm93bmVyRG9jdW1lbnQmJm4ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlld3x8bi5kb2N1bWVudCYmbnx8bi5kZWZhdWx0Vmlldyl9ZnVuY3Rpb24gZShuLHQpe3JldHVybiB0Pm4/LTE6bj50PzE6bj49dD8wOk5hTn1mdW5jdGlvbiByKG4pe3JldHVybiBudWxsPT09bj9OYU46K259ZnVuY3Rpb24gdShuKXtyZXR1cm4haXNOYU4obil9ZnVuY3Rpb24gaShuKXtyZXR1cm57bGVmdDpmdW5jdGlvbih0LGUscix1KXtmb3IoYXJndW1lbnRzLmxlbmd0aDwzJiYocj0wKSxhcmd1bWVudHMubGVuZ3RoPDQmJih1PXQubGVuZ3RoKTt1PnI7KXt2YXIgaT1yK3U+Pj4xO24odFtpXSxlKTwwP3I9aSsxOnU9aX1yZXR1cm4gcn0scmlnaHQ6ZnVuY3Rpb24odCxlLHIsdSl7Zm9yKGFyZ3VtZW50cy5sZW5ndGg8MyYmKHI9MCksYXJndW1lbnRzLmxlbmd0aDw0JiYodT10Lmxlbmd0aCk7dT5yOyl7dmFyIGk9cit1Pj4+MTtuKHRbaV0sZSk+MD91PWk6cj1pKzF9cmV0dXJuIHJ9fX1mdW5jdGlvbiBhKG4pe3JldHVybiBuLmxlbmd0aH1mdW5jdGlvbiBvKG4pe2Zvcih2YXIgdD0xO24qdCUxOyl0Kj0xMDtyZXR1cm4gdH1mdW5jdGlvbiBsKG4sdCl7Zm9yKHZhciBlIGluIHQpT2JqZWN0LmRlZmluZVByb3BlcnR5KG4ucHJvdG90eXBlLGUse3ZhbHVlOnRbZV0sZW51bWVyYWJsZTohMX0pfWZ1bmN0aW9uIGMoKXt0aGlzLl89T2JqZWN0LmNyZWF0ZShudWxsKX1mdW5jdGlvbiBzKG4pe3JldHVybihuKz0iIik9PT14YXx8blswXT09PWJhP2JhK246bn1mdW5jdGlvbiBmKG4pe3JldHVybihuKz0iIilbMF09PT1iYT9uLnNsaWNlKDEpOm59ZnVuY3Rpb24gaChuKXtyZXR1cm4gcyhuKWluIHRoaXMuX31mdW5jdGlvbiBnKG4pe3JldHVybihuPXMobikpaW4gdGhpcy5fJiZkZWxldGUgdGhpcy5fW25dfWZ1bmN0aW9uIHAoKXt2YXIgbj1bXTtmb3IodmFyIHQgaW4gdGhpcy5fKW4ucHVzaChmKHQpKTtyZXR1cm4gbn1mdW5jdGlvbiB2KCl7dmFyIG49MDtmb3IodmFyIHQgaW4gdGhpcy5fKSsrbjtyZXR1cm4gbn1mdW5jdGlvbiBkKCl7Zm9yKHZhciBuIGluIHRoaXMuXylyZXR1cm4hMTtyZXR1cm4hMH1mdW5jdGlvbiBtKCl7dGhpcy5fPU9iamVjdC5jcmVhdGUobnVsbCl9ZnVuY3Rpb24geShuKXtyZXR1cm4gbn1mdW5jdGlvbiBNKG4sdCxlKXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgcj1lLmFwcGx5KHQsYXJndW1lbnRzKTtyZXR1cm4gcj09PXQ/bjpyfX1mdW5jdGlvbiB4KG4sdCl7aWYodCBpbiBuKXJldHVybiB0O3Q9dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSt0LnNsaWNlKDEpO2Zvcih2YXIgZT0wLHI9X2EubGVuZ3RoO3I+ZTsrK2Upe3ZhciB1PV9hW2VdK3Q7aWYodSBpbiBuKXJldHVybiB1fX1mdW5jdGlvbiBiKCl7fWZ1bmN0aW9uIF8oKXt9ZnVuY3Rpb24gdyhuKXtmdW5jdGlvbiB0KCl7Zm9yKHZhciB0LHI9ZSx1PS0xLGk9ci5sZW5ndGg7Kyt1PGk7KSh0PXJbdV0ub24pJiZ0LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbn12YXIgZT1bXSxyPW5ldyBjO3JldHVybiB0Lm9uPWZ1bmN0aW9uKHQsdSl7dmFyIGksYT1yLmdldCh0KTtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyP2EmJmEub246KGEmJihhLm9uPW51bGwsZT1lLnNsaWNlKDAsaT1lLmluZGV4T2YoYSkpLmNvbmNhdChlLnNsaWNlKGkrMSkpLHIucmVtb3ZlKHQpKSx1JiZlLnB1c2goci5zZXQodCx7b246dX0pKSxuKX0sdH1mdW5jdGlvbiBTKCl7b2EuZXZlbnQucHJldmVudERlZmF1bHQoKX1mdW5jdGlvbiBrKCl7Zm9yKHZhciBuLHQ9b2EuZXZlbnQ7bj10LnNvdXJjZUV2ZW50Oyl0PW47cmV0dXJuIHR9ZnVuY3Rpb24gTihuKXtmb3IodmFyIHQ9bmV3IF8sZT0wLHI9YXJndW1lbnRzLmxlbmd0aDsrK2U8cjspdFthcmd1bWVudHNbZV1dPXcodCk7cmV0dXJuIHQub2Y9ZnVuY3Rpb24oZSxyKXtyZXR1cm4gZnVuY3Rpb24odSl7dHJ5e3ZhciBpPXUuc291cmNlRXZlbnQ9b2EuZXZlbnQ7dS50YXJnZXQ9bixvYS5ldmVudD11LHRbdS50eXBlXS5hcHBseShlLHIpfWZpbmFsbHl7b2EuZXZlbnQ9aX19fSx0fWZ1bmN0aW9uIEUobil7cmV0dXJuIFNhKG4sQWEpLG59ZnVuY3Rpb24gQShuKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOmZ1bmN0aW9uKCl7cmV0dXJuIGthKG4sdGhpcyl9fWZ1bmN0aW9uIEMobil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG4/bjpmdW5jdGlvbigpe3JldHVybiBOYShuLHRoaXMpfX1mdW5jdGlvbiB6KG4sdCl7ZnVuY3Rpb24gZSgpe3RoaXMucmVtb3ZlQXR0cmlidXRlKG4pfWZ1bmN0aW9uIHIoKXt0aGlzLnJlbW92ZUF0dHJpYnV0ZU5TKG4uc3BhY2Usbi5sb2NhbCl9ZnVuY3Rpb24gdSgpe3RoaXMuc2V0QXR0cmlidXRlKG4sdCl9ZnVuY3Rpb24gaSgpe3RoaXMuc2V0QXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsLHQpfWZ1bmN0aW9uIGEoKXt2YXIgZT10LmFwcGx5KHRoaXMsYXJndW1lbnRzKTtudWxsPT1lP3RoaXMucmVtb3ZlQXR0cmlidXRlKG4pOnRoaXMuc2V0QXR0cmlidXRlKG4sZSl9ZnVuY3Rpb24gbygpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/dGhpcy5yZW1vdmVBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOnRoaXMuc2V0QXR0cmlidXRlTlMobi5zcGFjZSxuLmxvY2FsLGUpfXJldHVybiBuPW9hLm5zLnF1YWxpZnkobiksbnVsbD09dD9uLmxvY2FsP3I6ZToiZnVuY3Rpb24iPT10eXBlb2YgdD9uLmxvY2FsP286YTpuLmxvY2FsP2k6dX1mdW5jdGlvbiBMKG4pe3JldHVybiBuLnRyaW0oKS5yZXBsYWNlKC9ccysvZywiICIpfWZ1bmN0aW9uIHEobil7cmV0dXJuIG5ldyBSZWdFeHAoIig/Ol58XFxzKykiK29hLnJlcXVvdGUobikrIig/Olxccyt8JCkiLCJnIil9ZnVuY3Rpb24gVChuKXtyZXR1cm4obisiIikudHJpbSgpLnNwbGl0KC9efFxzKy8pfWZ1bmN0aW9uIFIobix0KXtmdW5jdGlvbiBlKCl7Zm9yKHZhciBlPS0xOysrZTx1OyluW2VdKHRoaXMsdCl9ZnVuY3Rpb24gcigpe2Zvcih2YXIgZT0tMSxyPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpOysrZTx1OyluW2VdKHRoaXMscil9bj1UKG4pLm1hcChEKTt2YXIgdT1uLmxlbmd0aDtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgdD9yOmV9ZnVuY3Rpb24gRChuKXt2YXIgdD1xKG4pO3JldHVybiBmdW5jdGlvbihlLHIpe2lmKHU9ZS5jbGFzc0xpc3QpcmV0dXJuIHI/dS5hZGQobik6dS5yZW1vdmUobik7dmFyIHU9ZS5nZXRBdHRyaWJ1dGUoImNsYXNzIil8fCIiO3I/KHQubGFzdEluZGV4PTAsdC50ZXN0KHUpfHxlLnNldEF0dHJpYnV0ZSgiY2xhc3MiLEwodSsiICIrbikpKTplLnNldEF0dHJpYnV0ZSgiY2xhc3MiLEwodS5yZXBsYWNlKHQsIiAiKSkpfX1mdW5jdGlvbiBQKG4sdCxlKXtmdW5jdGlvbiByKCl7dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKX1mdW5jdGlvbiB1KCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHQsZSl9ZnVuY3Rpb24gaSgpe3ZhciByPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PXI/dGhpcy5zdHlsZS5yZW1vdmVQcm9wZXJ0eShuKTp0aGlzLnN0eWxlLnNldFByb3BlcnR5KG4scixlKX1yZXR1cm4gbnVsbD09dD9yOiJmdW5jdGlvbiI9PXR5cGVvZiB0P2k6dX1mdW5jdGlvbiBVKG4sdCl7ZnVuY3Rpb24gZSgpe2RlbGV0ZSB0aGlzW25dfWZ1bmN0aW9uIHIoKXt0aGlzW25dPXR9ZnVuY3Rpb24gdSgpe3ZhciBlPXQuYXBwbHkodGhpcyxhcmd1bWVudHMpO251bGw9PWU/ZGVsZXRlIHRoaXNbbl06dGhpc1tuXT1lfXJldHVybiBudWxsPT10P2U6ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dTpyfWZ1bmN0aW9uIGoobil7ZnVuY3Rpb24gdCgpe3ZhciB0PXRoaXMub3duZXJEb2N1bWVudCxlPXRoaXMubmFtZXNwYWNlVVJJO3JldHVybiBlJiZlIT09dC5kb2N1bWVudEVsZW1lbnQubmFtZXNwYWNlVVJJP3QuY3JlYXRlRWxlbWVudE5TKGUsbik6dC5jcmVhdGVFbGVtZW50KG4pfWZ1bmN0aW9uIGUoKXtyZXR1cm4gdGhpcy5vd25lckRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUyhuLnNwYWNlLG4ubG9jYWwpfXJldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBuP246KG49b2EubnMucXVhbGlmeShuKSkubG9jYWw/ZTp0fWZ1bmN0aW9uIEYoKXt2YXIgbj10aGlzLnBhcmVudE5vZGU7biYmbi5yZW1vdmVDaGlsZCh0aGlzKX1mdW5jdGlvbiBIKG4pe3JldHVybntfX2RhdGFfXzpufX1mdW5jdGlvbiBPKG4pe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBFYSh0aGlzLG4pfX1mdW5jdGlvbiBJKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RofHwobj1lKSxmdW5jdGlvbih0LGUpe3JldHVybiB0JiZlP24odC5fX2RhdGFfXyxlLl9fZGF0YV9fKTohdC0hZX19ZnVuY3Rpb24gWShuLHQpe2Zvcih2YXIgZT0wLHI9bi5sZW5ndGg7cj5lO2UrKylmb3IodmFyIHUsaT1uW2VdLGE9MCxvPWkubGVuZ3RoO28+YTthKyspKHU9aVthXSkmJnQodSxhLGUpO3JldHVybiBufWZ1bmN0aW9uIFoobil7cmV0dXJuIFNhKG4semEpLG59ZnVuY3Rpb24gVihuKXt2YXIgdCxlO3JldHVybiBmdW5jdGlvbihyLHUsaSl7dmFyIGEsbz1uW2ldLnVwZGF0ZSxsPW8ubGVuZ3RoO2ZvcihpIT1lJiYoZT1pLHQ9MCksdT49dCYmKHQ9dSsxKTshKGE9b1t0XSkmJisrdDxsOyk7cmV0dXJuIGF9fWZ1bmN0aW9uIFgobix0LGUpe2Z1bmN0aW9uIHIoKXt2YXIgdD10aGlzW2FdO3QmJih0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIobix0LHQuJCksZGVsZXRlIHRoaXNbYV0pfWZ1bmN0aW9uIHUoKXt2YXIgdT1sKHQsY2EoYXJndW1lbnRzKSk7ci5jYWxsKHRoaXMpLHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihuLHRoaXNbYV09dSx1LiQ9ZSksdS5fPXR9ZnVuY3Rpb24gaSgpe3ZhciB0LGU9bmV3IFJlZ0V4cCgiXl9fb24oW14uXSspIitvYS5yZXF1b3RlKG4pKyIkIik7Zm9yKHZhciByIGluIHRoaXMpaWYodD1yLm1hdGNoKGUpKXt2YXIgdT10aGlzW3JdO3RoaXMucmVtb3ZlRXZlbnRMaXN0ZW5lcih0WzFdLHUsdS4kKSxkZWxldGUgdGhpc1tyXX19dmFyIGE9Il9fb24iK24sbz1uLmluZGV4T2YoIi4iKSxsPSQ7bz4wJiYobj1uLnNsaWNlKDAsbykpO3ZhciBjPUxhLmdldChuKTtyZXR1cm4gYyYmKG49YyxsPUIpLG8/dD91OnI6dD9iOml9ZnVuY3Rpb24gJChuLHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj1vYS5ldmVudDtvYS5ldmVudD1lLHRbMF09dGhpcy5fX2RhdGFfXzt0cnl7bi5hcHBseSh0aGlzLHQpfWZpbmFsbHl7b2EuZXZlbnQ9cn19fWZ1bmN0aW9uIEIobix0KXt2YXIgZT0kKG4sdCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciB0PXRoaXMscj1uLnJlbGF0ZWRUYXJnZXQ7ciYmKHI9PT10fHw4JnIuY29tcGFyZURvY3VtZW50UG9zaXRpb24odCkpfHxlLmNhbGwodCxuKX19ZnVuY3Rpb24gVyhlKXt2YXIgcj0iLmRyYWdzdXBwcmVzcy0iKyArK1RhLHU9ImNsaWNrIityLGk9b2Euc2VsZWN0KHQoZSkpLm9uKCJ0b3VjaG1vdmUiK3IsUykub24oImRyYWdzdGFydCIrcixTKS5vbigic2VsZWN0c3RhcnQiK3IsUyk7aWYobnVsbD09cWEmJihxYT0ib25zZWxlY3RzdGFydCJpbiBlPyExOngoZS5zdHlsZSwidXNlclNlbGVjdCIpKSxxYSl7dmFyIGE9bihlKS5zdHlsZSxvPWFbcWFdO2FbcWFdPSJub25lIn1yZXR1cm4gZnVuY3Rpb24obil7aWYoaS5vbihyLG51bGwpLHFhJiYoYVtxYV09byksbil7dmFyIHQ9ZnVuY3Rpb24oKXtpLm9uKHUsbnVsbCl9O2kub24odSxmdW5jdGlvbigpe1MoKSx0KCl9LCEwKSxzZXRUaW1lb3V0KHQsMCl9fX1mdW5jdGlvbiBKKG4sZSl7ZS5jaGFuZ2VkVG91Y2hlcyYmKGU9ZS5jaGFuZ2VkVG91Y2hlc1swXSk7dmFyIHI9bi5vd25lclNWR0VsZW1lbnR8fG47aWYoci5jcmVhdGVTVkdQb2ludCl7dmFyIHU9ci5jcmVhdGVTVkdQb2ludCgpO2lmKDA+UmEpe3ZhciBpPXQobik7aWYoaS5zY3JvbGxYfHxpLnNjcm9sbFkpe3I9b2Euc2VsZWN0KCJib2R5IikuYXBwZW5kKCJzdmciKS5zdHlsZSh7cG9zaXRpb246ImFic29sdXRlIix0b3A6MCxsZWZ0OjAsbWFyZ2luOjAscGFkZGluZzowLGJvcmRlcjoibm9uZSJ9LCJpbXBvcnRhbnQiKTt2YXIgYT1yWzBdWzBdLmdldFNjcmVlbkNUTSgpO1JhPSEoYS5mfHxhLmUpLHIucmVtb3ZlKCl9fXJldHVybiBSYT8odS54PWUucGFnZVgsdS55PWUucGFnZVkpOih1Lng9ZS5jbGllbnRYLHUueT1lLmNsaWVudFkpLHU9dS5tYXRyaXhUcmFuc2Zvcm0obi5nZXRTY3JlZW5DVE0oKS5pbnZlcnNlKCkpLFt1LngsdS55XX12YXIgbz1uLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3JldHVybltlLmNsaWVudFgtby5sZWZ0LW4uY2xpZW50TGVmdCxlLmNsaWVudFktby50b3Atbi5jbGllbnRUb3BdfWZ1bmN0aW9uIEcoKXtyZXR1cm4gb2EuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcn1mdW5jdGlvbiBLKG4pe3JldHVybiBuPjA/MTowPm4/LTE6MH1mdW5jdGlvbiBRKG4sdCxlKXtyZXR1cm4odFswXS1uWzBdKSooZVsxXS1uWzFdKS0odFsxXS1uWzFdKSooZVswXS1uWzBdKX1mdW5jdGlvbiBubihuKXtyZXR1cm4gbj4xPzA6LTE+bj9VYTpNYXRoLmFjb3Mobil9ZnVuY3Rpb24gdG4obil7cmV0dXJuIG4+MT9IYTotMT5uPy1IYTpNYXRoLmFzaW4obil9ZnVuY3Rpb24gZW4obil7cmV0dXJuKChuPU1hdGguZXhwKG4pKS0xL24pLzJ9ZnVuY3Rpb24gcm4obil7cmV0dXJuKChuPU1hdGguZXhwKG4pKSsxL24pLzJ9ZnVuY3Rpb24gdW4obil7cmV0dXJuKChuPU1hdGguZXhwKDIqbikpLTEpLyhuKzEpfWZ1bmN0aW9uIGFuKG4pe3JldHVybihuPU1hdGguc2luKG4vMikpKm59ZnVuY3Rpb24gb24oKXt9ZnVuY3Rpb24gbG4obix0LGUpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgbG4/KHRoaXMuaD0rbix0aGlzLnM9K3Qsdm9pZCh0aGlzLmw9K2UpKTphcmd1bWVudHMubGVuZ3RoPDI/biBpbnN0YW5jZW9mIGxuP25ldyBsbihuLmgsbi5zLG4ubCk6X24oIiIrbix3bixsbik6bmV3IGxuKG4sdCxlKX1mdW5jdGlvbiBjbihuLHQsZSl7ZnVuY3Rpb24gcihuKXtyZXR1cm4gbj4zNjA/bi09MzYwOjA+biYmKG4rPTM2MCksNjA+bj9pKyhhLWkpKm4vNjA6MTgwPm4/YToyNDA+bj9pKyhhLWkpKigyNDAtbikvNjA6aX1mdW5jdGlvbiB1KG4pe3JldHVybiBNYXRoLnJvdW5kKDI1NSpyKG4pKX12YXIgaSxhO3JldHVybiBuPWlzTmFOKG4pPzA6KG4lPTM2MCk8MD9uKzM2MDpuLHQ9aXNOYU4odCk/MDowPnQ/MDp0PjE/MTp0LGU9MD5lPzA6ZT4xPzE6ZSxhPS41Pj1lP2UqKDErdCk6ZSt0LWUqdCxpPTIqZS1hLG5ldyB5bih1KG4rMTIwKSx1KG4pLHUobi0xMjApKX1mdW5jdGlvbiBzbihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBzbj8odGhpcy5oPStuLHRoaXMuYz0rdCx2b2lkKHRoaXMubD0rZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2Ygc24/bmV3IHNuKG4uaCxuLmMsbi5sKTpuIGluc3RhbmNlb2YgaG4/cG4obi5sLG4uYSxuLmIpOnBuKChuPVNuKChuPW9hLnJnYihuKSkucixuLmcsbi5iKSkubCxuLmEsbi5iKTpuZXcgc24obix0LGUpfWZ1bmN0aW9uIGZuKG4sdCxlKXtyZXR1cm4gaXNOYU4obikmJihuPTApLGlzTmFOKHQpJiYodD0wKSxuZXcgaG4oZSxNYXRoLmNvcyhuKj1PYSkqdCxNYXRoLnNpbihuKSp0KX1mdW5jdGlvbiBobihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBobj8odGhpcy5sPStuLHRoaXMuYT0rdCx2b2lkKHRoaXMuYj0rZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2YgaG4/bmV3IGhuKG4ubCxuLmEsbi5iKTpuIGluc3RhbmNlb2Ygc24/Zm4obi5oLG4uYyxuLmwpOlNuKChuPXluKG4pKS5yLG4uZyxuLmIpOm5ldyBobihuLHQsZSl9ZnVuY3Rpb24gZ24obix0LGUpe3ZhciByPShuKzE2KS8xMTYsdT1yK3QvNTAwLGk9ci1lLzIwMDtyZXR1cm4gdT12bih1KSpLYSxyPXZuKHIpKlFhLGk9dm4oaSkqbm8sbmV3IHluKG1uKDMuMjQwNDU0Mip1LTEuNTM3MTM4NSpyLS40OTg1MzE0KmkpLG1uKC0uOTY5MjY2KnUrMS44NzYwMTA4KnIrLjA0MTU1NippKSxtbiguMDU1NjQzNCp1LS4yMDQwMjU5KnIrMS4wNTcyMjUyKmkpKX1mdW5jdGlvbiBwbihuLHQsZSl7cmV0dXJuIG4+MD9uZXcgc24oTWF0aC5hdGFuMihlLHQpKklhLE1hdGguc3FydCh0KnQrZSplKSxuKTpuZXcgc24oTmFOLE5hTixuKX1mdW5jdGlvbiB2bihuKXtyZXR1cm4gbj4uMjA2ODkzMDM0P24qbipuOihuLTQvMjkpLzcuNzg3MDM3fWZ1bmN0aW9uIGRuKG4pe3JldHVybiBuPi4wMDg4NTY/TWF0aC5wb3cobiwxLzMpOjcuNzg3MDM3Km4rNC8yOX1mdW5jdGlvbiBtbihuKXtyZXR1cm4gTWF0aC5yb3VuZCgyNTUqKC4wMDMwND49bj8xMi45MipuOjEuMDU1Kk1hdGgucG93KG4sMS8yLjQpLS4wNTUpKX1mdW5jdGlvbiB5bihuLHQsZSl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiB5bj8odGhpcy5yPX5+bix0aGlzLmc9fn50LHZvaWQodGhpcy5iPX5+ZSkpOmFyZ3VtZW50cy5sZW5ndGg8Mj9uIGluc3RhbmNlb2YgeW4/bmV3IHluKG4ucixuLmcsbi5iKTpfbigiIituLHluLGNuKTpuZXcgeW4obix0LGUpfWZ1bmN0aW9uIE1uKG4pe3JldHVybiBuZXcgeW4obj4+MTYsbj4+OCYyNTUsMjU1Jm4pfWZ1bmN0aW9uIHhuKG4pe3JldHVybiBNbihuKSsiIn1mdW5jdGlvbiBibihuKXtyZXR1cm4gMTY+bj8iMCIrTWF0aC5tYXgoMCxuKS50b1N0cmluZygxNik6TWF0aC5taW4oMjU1LG4pLnRvU3RyaW5nKDE2KX1mdW5jdGlvbiBfbihuLHQsZSl7dmFyIHIsdSxpLGE9MCxvPTAsbD0wO2lmKHI9LyhbYS16XSspXCgoLiopXCkvLmV4ZWMobj1uLnRvTG93ZXJDYXNlKCkpKXN3aXRjaCh1PXJbMl0uc3BsaXQoIiwiKSxyWzFdKXtjYXNlImhzbCI6cmV0dXJuIGUocGFyc2VGbG9hdCh1WzBdKSxwYXJzZUZsb2F0KHVbMV0pLzEwMCxwYXJzZUZsb2F0KHVbMl0pLzEwMCk7Y2FzZSJyZ2IiOnJldHVybiB0KE5uKHVbMF0pLE5uKHVbMV0pLE5uKHVbMl0pKX1yZXR1cm4oaT1yby5nZXQobikpP3QoaS5yLGkuZyxpLmIpOihudWxsPT1ufHwiIyIhPT1uLmNoYXJBdCgwKXx8aXNOYU4oaT1wYXJzZUludChuLnNsaWNlKDEpLDE2KSl8fCg0PT09bi5sZW5ndGg/KGE9KDM4NDAmaSk+PjQsYT1hPj40fGEsbz0yNDAmaSxvPW8+PjR8byxsPTE1JmksbD1sPDw0fGwpOjc9PT1uLmxlbmd0aCYmKGE9KDE2NzExNjgwJmkpPj4xNixvPSg2NTI4MCZpKT4+OCxsPTI1NSZpKSksdChhLG8sbCkpfWZ1bmN0aW9uIHduKG4sdCxlKXt2YXIgcix1LGk9TWF0aC5taW4obi89MjU1LHQvPTI1NSxlLz0yNTUpLGE9TWF0aC5tYXgobix0LGUpLG89YS1pLGw9KGEraSkvMjtyZXR1cm4gbz8odT0uNT5sP28vKGEraSk6by8oMi1hLWkpLHI9bj09YT8odC1lKS9vKyhlPnQ/NjowKTp0PT1hPyhlLW4pL28rMjoobi10KS9vKzQscio9NjApOihyPU5hTix1PWw+MCYmMT5sPzA6ciksbmV3IGxuKHIsdSxsKX1mdW5jdGlvbiBTbihuLHQsZSl7bj1rbihuKSx0PWtuKHQpLGU9a24oZSk7dmFyIHI9ZG4oKC40MTI0NTY0Km4rLjM1NzU3NjEqdCsuMTgwNDM3NSplKS9LYSksdT1kbigoLjIxMjY3MjkqbisuNzE1MTUyMip0Ky4wNzIxNzUqZSkvUWEpLGk9ZG4oKC4wMTkzMzM5Km4rLjExOTE5Mip0Ky45NTAzMDQxKmUpL25vKTtyZXR1cm4gaG4oMTE2KnUtMTYsNTAwKihyLXUpLDIwMCoodS1pKSl9ZnVuY3Rpb24ga24obil7cmV0dXJuKG4vPTI1NSk8PS4wNDA0NT9uLzEyLjkyOk1hdGgucG93KChuKy4wNTUpLzEuMDU1LDIuNCl9ZnVuY3Rpb24gTm4obil7dmFyIHQ9cGFyc2VGbG9hdChuKTtyZXR1cm4iJSI9PT1uLmNoYXJBdChuLmxlbmd0aC0xKT9NYXRoLnJvdW5kKDIuNTUqdCk6dH1mdW5jdGlvbiBFbihuKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOmZ1bmN0aW9uKCl7cmV0dXJuIG59fWZ1bmN0aW9uIEFuKG4pe3JldHVybiBmdW5jdGlvbih0LGUscil7cmV0dXJuIDI9PT1hcmd1bWVudHMubGVuZ3RoJiYiZnVuY3Rpb24iPT10eXBlb2YgZSYmKHI9ZSxlPW51bGwpLENuKHQsZSxuLHIpfX1mdW5jdGlvbiBDbihuLHQsZSxyKXtmdW5jdGlvbiB1KCl7dmFyIG4sdD1sLnN0YXR1cztpZighdCYmTG4obCl8fHQ+PTIwMCYmMzAwPnR8fDMwND09PXQpe3RyeXtuPWUuY2FsbChpLGwpfWNhdGNoKHIpe3JldHVybiB2b2lkIGEuZXJyb3IuY2FsbChpLHIpfWEubG9hZC5jYWxsKGksbil9ZWxzZSBhLmVycm9yLmNhbGwoaSxsKX12YXIgaT17fSxhPW9hLmRpc3BhdGNoKCJiZWZvcmVzZW5kIiwicHJvZ3Jlc3MiLCJsb2FkIiwiZXJyb3IiKSxvPXt9LGw9bmV3IFhNTEh0dHBSZXF1ZXN0LGM9bnVsbDtyZXR1cm4hdGhpcy5YRG9tYWluUmVxdWVzdHx8IndpdGhDcmVkZW50aWFscyJpbiBsfHwhL14oaHR0cChzKT86KT9cL1wvLy50ZXN0KG4pfHwobD1uZXcgWERvbWFpblJlcXVlc3QpLCJvbmxvYWQiaW4gbD9sLm9ubG9hZD1sLm9uZXJyb3I9dTpsLm9ucmVhZHlzdGF0ZWNoYW5nZT1mdW5jdGlvbigpe2wucmVhZHlTdGF0ZT4zJiZ1KCl9LGwub25wcm9ncmVzcz1mdW5jdGlvbihuKXt2YXIgdD1vYS5ldmVudDtvYS5ldmVudD1uO3RyeXthLnByb2dyZXNzLmNhbGwoaSxsKX1maW5hbGx5e29hLmV2ZW50PXR9fSxpLmhlYWRlcj1mdW5jdGlvbihuLHQpe3JldHVybiBuPShuKyIiKS50b0xvd2VyQ2FzZSgpLGFyZ3VtZW50cy5sZW5ndGg8Mj9vW25dOihudWxsPT10P2RlbGV0ZSBvW25dOm9bbl09dCsiIixpKX0saS5taW1lVHlwZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1udWxsPT1uP251bGw6bisiIixpKTp0fSxpLnJlc3BvbnNlVHlwZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz1uLGkpOmN9LGkucmVzcG9uc2U9ZnVuY3Rpb24obil7cmV0dXJuIGU9bixpfSxbImdldCIsInBvc3QiXS5mb3JFYWNoKGZ1bmN0aW9uKG4pe2lbbl09ZnVuY3Rpb24oKXtyZXR1cm4gaS5zZW5kLmFwcGx5KGksW25dLmNvbmNhdChjYShhcmd1bWVudHMpKSl9fSksaS5zZW5kPWZ1bmN0aW9uKGUscix1KXtpZigyPT09YXJndW1lbnRzLmxlbmd0aCYmImZ1bmN0aW9uIj09dHlwZW9mIHImJih1PXIscj1udWxsKSxsLm9wZW4oZSxuLCEwKSxudWxsPT10fHwiYWNjZXB0ImluIG98fChvLmFjY2VwdD10KyIsKi8qIiksbC5zZXRSZXF1ZXN0SGVhZGVyKWZvcih2YXIgcyBpbiBvKWwuc2V0UmVxdWVzdEhlYWRlcihzLG9bc10pO3JldHVybiBudWxsIT10JiZsLm92ZXJyaWRlTWltZVR5cGUmJmwub3ZlcnJpZGVNaW1lVHlwZSh0KSxudWxsIT1jJiYobC5yZXNwb25zZVR5cGU9YyksbnVsbCE9dSYmaS5vbigiZXJyb3IiLHUpLm9uKCJsb2FkIixmdW5jdGlvbihuKXt1KG51bGwsbil9KSxhLmJlZm9yZXNlbmQuY2FsbChpLGwpLGwuc2VuZChudWxsPT1yP251bGw6ciksaX0saS5hYm9ydD1mdW5jdGlvbigpe3JldHVybiBsLmFib3J0KCksaX0sb2EucmViaW5kKGksYSwib24iKSxudWxsPT1yP2k6aS5nZXQoem4ocikpfWZ1bmN0aW9uIHpuKG4pe3JldHVybiAxPT09bi5sZW5ndGg/ZnVuY3Rpb24odCxlKXtuKG51bGw9PXQ/ZTpudWxsKX06bn1mdW5jdGlvbiBMbihuKXt2YXIgdD1uLnJlc3BvbnNlVHlwZTtyZXR1cm4gdCYmInRleHQiIT09dD9uLnJlc3BvbnNlOm4ucmVzcG9uc2VUZXh0fWZ1bmN0aW9uIHFuKG4sdCxlKXt2YXIgcj1hcmd1bWVudHMubGVuZ3RoOzI+ciYmKHQ9MCksMz5yJiYoZT1EYXRlLm5vdygpKTt2YXIgdT1lK3QsaT17YzpuLHQ6dSxuOm51bGx9O3JldHVybiBpbz9pby5uPWk6dW89aSxpbz1pLGFvfHwob289Y2xlYXJUaW1lb3V0KG9vKSxhbz0xLGxvKFRuKSksaX1mdW5jdGlvbiBUbigpe3ZhciBuPVJuKCksdD1EbigpLW47dD4yND8oaXNGaW5pdGUodCkmJihjbGVhclRpbWVvdXQob28pLG9vPXNldFRpbWVvdXQoVG4sdCkpLGFvPTApOihhbz0xLGxvKFRuKSl9ZnVuY3Rpb24gUm4oKXtmb3IodmFyIG49RGF0ZS5ub3coKSx0PXVvO3Q7KW4+PXQudCYmdC5jKG4tdC50KSYmKHQuYz1udWxsKSx0PXQubjtyZXR1cm4gbn1mdW5jdGlvbiBEbigpe2Zvcih2YXIgbix0PXVvLGU9MS8wO3Q7KXQuYz8odC50PGUmJihlPXQudCksdD0obj10KS5uKTp0PW4/bi5uPXQubjp1bz10Lm47cmV0dXJuIGlvPW4sZX1mdW5jdGlvbiBQbihuLHQpe3JldHVybiB0LShuP01hdGguY2VpbChNYXRoLmxvZyhuKS9NYXRoLkxOMTApOjEpfWZ1bmN0aW9uIFVuKG4sdCl7dmFyIGU9TWF0aC5wb3coMTAsMypNYSg4LXQpKTtyZXR1cm57c2NhbGU6dD44P2Z1bmN0aW9uKG4pe3JldHVybiBuL2V9OmZ1bmN0aW9uKG4pe3JldHVybiBuKmV9LHN5bWJvbDpufX1mdW5jdGlvbiBqbihuKXt2YXIgdD1uLmRlY2ltYWwsZT1uLnRob3VzYW5kcyxyPW4uZ3JvdXBpbmcsdT1uLmN1cnJlbmN5LGk9ciYmZT9mdW5jdGlvbihuLHQpe2Zvcih2YXIgdT1uLmxlbmd0aCxpPVtdLGE9MCxvPXJbMF0sbD0wO3U+MCYmbz4wJiYobCtvKzE+dCYmKG89TWF0aC5tYXgoMSx0LWwpKSxpLnB1c2gobi5zdWJzdHJpbmcodS09byx1K28pKSwhKChsKz1vKzEpPnQpKTspbz1yW2E9KGErMSklci5sZW5ndGhdO3JldHVybiBpLnJldmVyc2UoKS5qb2luKGUpfTp5O3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1zby5leGVjKG4pLHI9ZVsxXXx8IiAiLGE9ZVsyXXx8Ij4iLG89ZVszXXx8Ii0iLGw9ZVs0XXx8IiIsYz1lWzVdLHM9K2VbNl0sZj1lWzddLGg9ZVs4XSxnPWVbOV0scD0xLHY9IiIsZD0iIixtPSExLHk9ITA7c3dpdGNoKGgmJihoPStoLnN1YnN0cmluZygxKSksKGN8fCIwIj09PXImJiI9Ij09PWEpJiYoYz1yPSIwIixhPSI9IiksZyl7Y2FzZSJuIjpmPSEwLGc9ImciO2JyZWFrO2Nhc2UiJSI6cD0xMDAsZD0iJSIsZz0iZiI7YnJlYWs7Y2FzZSJwIjpwPTEwMCxkPSIlIixnPSJyIjticmVhaztjYXNlImIiOmNhc2UibyI6Y2FzZSJ4IjpjYXNlIlgiOiIjIj09PWwmJih2PSIwIitnLnRvTG93ZXJDYXNlKCkpO2Nhc2UiYyI6eT0hMTtjYXNlImQiOm09ITAsaD0wO2JyZWFrO2Nhc2UicyI6cD0tMSxnPSJyIn0iJCI9PT1sJiYodj11WzBdLGQ9dVsxXSksInIiIT1nfHxofHwoZz0iZyIpLG51bGwhPWgmJigiZyI9PWc/aD1NYXRoLm1heCgxLE1hdGgubWluKDIxLGgpKTooImUiPT1nfHwiZiI9PWcpJiYoaD1NYXRoLm1heCgwLE1hdGgubWluKDIwLGgpKSkpLGc9Zm8uZ2V0KGcpfHxGbjt2YXIgTT1jJiZmO3JldHVybiBmdW5jdGlvbihuKXt2YXIgZT1kO2lmKG0mJm4lMSlyZXR1cm4iIjt2YXIgdT0wPm58fDA9PT1uJiYwPjEvbj8obj0tbiwiLSIpOiItIj09PW8/IiI6bztpZigwPnApe3ZhciBsPW9hLmZvcm1hdFByZWZpeChuLGgpO249bC5zY2FsZShuKSxlPWwuc3ltYm9sK2R9ZWxzZSBuKj1wO249ZyhuLGgpO3ZhciB4LGIsXz1uLmxhc3RJbmRleE9mKCIuIik7aWYoMD5fKXt2YXIgdz15P24ubGFzdEluZGV4T2YoImUiKTotMTswPnc/KHg9bixiPSIiKTooeD1uLnN1YnN0cmluZygwLHcpLGI9bi5zdWJzdHJpbmcodykpfWVsc2UgeD1uLnN1YnN0cmluZygwLF8pLGI9dCtuLnN1YnN0cmluZyhfKzEpOyFjJiZmJiYoeD1pKHgsMS8wKSk7dmFyIFM9di5sZW5ndGgreC5sZW5ndGgrYi5sZW5ndGgrKE0/MDp1Lmxlbmd0aCksaz1zPlM/bmV3IEFycmF5KFM9cy1TKzEpLmpvaW4ocik6IiI7cmV0dXJuIE0mJih4PWkoayt4LGsubGVuZ3RoP3MtYi5sZW5ndGg6MS8wKSksdSs9dixuPXgrYiwoIjwiPT09YT91K24razoiPiI9PT1hP2srdStuOiJeIj09PWE/ay5zdWJzdHJpbmcoMCxTPj49MSkrdStuK2suc3Vic3RyaW5nKFMpOnUrKE0/bjprK24pKStlfX19ZnVuY3Rpb24gRm4obil7cmV0dXJuIG4rIiJ9ZnVuY3Rpb24gSG4oKXt0aGlzLl89bmV3IERhdGUoYXJndW1lbnRzLmxlbmd0aD4xP0RhdGUuVVRDLmFwcGx5KHRoaXMsYXJndW1lbnRzKTphcmd1bWVudHNbMF0pfWZ1bmN0aW9uIE9uKG4sdCxlKXtmdW5jdGlvbiByKHQpe3ZhciBlPW4odCkscj1pKGUsMSk7cmV0dXJuIHItdD50LWU/ZTpyfWZ1bmN0aW9uIHUoZSl7cmV0dXJuIHQoZT1uKG5ldyBnbyhlLTEpKSwxKSxlfWZ1bmN0aW9uIGkobixlKXtyZXR1cm4gdChuPW5ldyBnbygrbiksZSksbn1mdW5jdGlvbiBhKG4scixpKXt2YXIgYT11KG4pLG89W107aWYoaT4xKWZvcig7cj5hOyllKGEpJWl8fG8ucHVzaChuZXcgRGF0ZSgrYSkpLHQoYSwxKTtlbHNlIGZvcig7cj5hOylvLnB1c2gobmV3IERhdGUoK2EpKSx0KGEsMSk7cmV0dXJuIG99ZnVuY3Rpb24gbyhuLHQsZSl7dHJ5e2dvPUhuO3ZhciByPW5ldyBIbjtyZXR1cm4gci5fPW4sYShyLHQsZSl9ZmluYWxseXtnbz1EYXRlfX1uLmZsb29yPW4sbi5yb3VuZD1yLG4uY2VpbD11LG4ub2Zmc2V0PWksbi5yYW5nZT1hO3ZhciBsPW4udXRjPUluKG4pO3JldHVybiBsLmZsb29yPWwsbC5yb3VuZD1JbihyKSxsLmNlaWw9SW4odSksbC5vZmZzZXQ9SW4oaSksbC5yYW5nZT1vLG59ZnVuY3Rpb24gSW4obil7cmV0dXJuIGZ1bmN0aW9uKHQsZSl7dHJ5e2dvPUhuO3ZhciByPW5ldyBIbjtyZXR1cm4gci5fPXQsbihyLGUpLl99ZmluYWxseXtnbz1EYXRlfX19ZnVuY3Rpb24gWW4obil7ZnVuY3Rpb24gdChuKXtmdW5jdGlvbiB0KHQpe2Zvcih2YXIgZSx1LGksYT1bXSxvPS0xLGw9MDsrK288cjspMzc9PT1uLmNoYXJDb2RlQXQobykmJihhLnB1c2gobi5zbGljZShsLG8pKSxudWxsIT0odT12b1tlPW4uY2hhckF0KCsrbyldKSYmKGU9bi5jaGFyQXQoKytvKSksKGk9QVtlXSkmJihlPWkodCxudWxsPT11PyJlIj09PWU/IiAiOiIwIjp1KSksYS5wdXNoKGUpLGw9bysxKTtyZXR1cm4gYS5wdXNoKG4uc2xpY2UobCxvKSksYS5qb2luKCIiKX12YXIgcj1uLmxlbmd0aDtyZXR1cm4gdC5wYXJzZT1mdW5jdGlvbih0KXt2YXIgcj17eToxOTAwLG06MCxkOjEsSDowLE06MCxTOjAsTDowLFo6bnVsbH0sdT1lKHIsbix0LDApO2lmKHUhPXQubGVuZ3RoKXJldHVybiBudWxsOyJwImluIHImJihyLkg9ci5IJTEyKzEyKnIucCk7dmFyIGk9bnVsbCE9ci5aJiZnbyE9PUhuLGE9bmV3KGk/SG46Z28pO3JldHVybiJqImluIHI/YS5zZXRGdWxsWWVhcihyLnksMCxyLmopOiJXImluIHJ8fCJVImluIHI/KCJ3ImluIHJ8fChyLnc9IlciaW4gcj8xOjApLGEuc2V0RnVsbFllYXIoci55LDAsMSksYS5zZXRGdWxsWWVhcihyLnksMCwiVyJpbiByPyhyLncrNiklNys3KnIuVy0oYS5nZXREYXkoKSs1KSU3OnIudys3KnIuVS0oYS5nZXREYXkoKSs2KSU3KSk6YS5zZXRGdWxsWWVhcihyLnksci5tLHIuZCksYS5zZXRIb3VycyhyLkgrKHIuWi8xMDB8MCksci5NK3IuWiUxMDAsci5TLHIuTCksaT9hLl86YX0sdC50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiBufSx0fWZ1bmN0aW9uIGUobix0LGUscil7Zm9yKHZhciB1LGksYSxvPTAsbD10Lmxlbmd0aCxjPWUubGVuZ3RoO2w+bzspe2lmKHI+PWMpcmV0dXJuLTE7aWYodT10LmNoYXJDb2RlQXQobysrKSwzNz09PXUpe2lmKGE9dC5jaGFyQXQobysrKSxpPUNbYSBpbiB2bz90LmNoYXJBdChvKyspOmFdLCFpfHwocj1pKG4sZSxyKSk8MClyZXR1cm4tMX1lbHNlIGlmKHUhPWUuY2hhckNvZGVBdChyKyspKXJldHVybi0xfXJldHVybiByfWZ1bmN0aW9uIHIobix0LGUpe18ubGFzdEluZGV4PTA7dmFyIHI9Xy5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLnc9dy5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1KG4sdCxlKXt4Lmxhc3RJbmRleD0wO3ZhciByPXguZXhlYyh0LnNsaWNlKGUpKTtyZXR1cm4gcj8obi53PWIuZ2V0KHJbMF0udG9Mb3dlckNhc2UoKSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gaShuLHQsZSl7Ti5sYXN0SW5kZXg9MDt2YXIgcj1OLmV4ZWModC5zbGljZShlKSk7cmV0dXJuIHI/KG4ubT1FLmdldChyWzBdLnRvTG93ZXJDYXNlKCkpLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIGEobix0LGUpe1MubGFzdEluZGV4PTA7dmFyIHI9Uy5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLm09ay5nZXQoclswXS50b0xvd2VyQ2FzZSgpKSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBvKG4sdCxyKXtyZXR1cm4gZShuLEEuYy50b1N0cmluZygpLHQscil9ZnVuY3Rpb24gbChuLHQscil7cmV0dXJuIGUobixBLngudG9TdHJpbmcoKSx0LHIpfWZ1bmN0aW9uIGMobix0LHIpe3JldHVybiBlKG4sQS5YLnRvU3RyaW5nKCksdCxyKX1mdW5jdGlvbiBzKG4sdCxlKXt2YXIgcj1NLmdldCh0LnNsaWNlKGUsZSs9MikudG9Mb3dlckNhc2UoKSk7cmV0dXJuIG51bGw9PXI/LTE6KG4ucD1yLGUpfXZhciBmPW4uZGF0ZVRpbWUsaD1uLmRhdGUsZz1uLnRpbWUscD1uLnBlcmlvZHMsdj1uLmRheXMsZD1uLnNob3J0RGF5cyxtPW4ubW9udGhzLHk9bi5zaG9ydE1vbnRoczt0LnV0Yz1mdW5jdGlvbihuKXtmdW5jdGlvbiBlKG4pe3RyeXtnbz1Ibjt2YXIgdD1uZXcgZ287cmV0dXJuIHQuXz1uLHIodCl9ZmluYWxseXtnbz1EYXRlfX12YXIgcj10KG4pO3JldHVybiBlLnBhcnNlPWZ1bmN0aW9uKG4pe3RyeXtnbz1Ibjt2YXIgdD1yLnBhcnNlKG4pO3JldHVybiB0JiZ0Ll99ZmluYWxseXtnbz1EYXRlfX0sZS50b1N0cmluZz1yLnRvU3RyaW5nLGV9LHQubXVsdGk9dC51dGMubXVsdGk9Y3Q7dmFyIE09b2EubWFwKCkseD1Wbih2KSxiPVhuKHYpLF89Vm4oZCksdz1YbihkKSxTPVZuKG0pLGs9WG4obSksTj1Wbih5KSxFPVhuKHkpO3AuZm9yRWFjaChmdW5jdGlvbihuLHQpe00uc2V0KG4udG9Mb3dlckNhc2UoKSx0KX0pO3ZhciBBPXthOmZ1bmN0aW9uKG4pe3JldHVybiBkW24uZ2V0RGF5KCldfSxBOmZ1bmN0aW9uKG4pe3JldHVybiB2W24uZ2V0RGF5KCldfSxiOmZ1bmN0aW9uKG4pe3JldHVybiB5W24uZ2V0TW9udGgoKV19LEI6ZnVuY3Rpb24obil7cmV0dXJuIG1bbi5nZXRNb250aCgpXX0sYzp0KGYpLGQ6ZnVuY3Rpb24obix0KXtyZXR1cm4gWm4obi5nZXREYXRlKCksdCwyKX0sZTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldERhdGUoKSx0LDIpfSxIOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0SG91cnMoKSx0LDIpfSxJOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0SG91cnMoKSUxMnx8MTIsdCwyKX0sajpmdW5jdGlvbihuLHQpe3JldHVybiBabigxK2hvLmRheU9mWWVhcihuKSx0LDMpfSxMOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0TWlsbGlzZWNvbmRzKCksdCwzKX0sbTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldE1vbnRoKCkrMSx0LDIpfSxNOmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0TWludXRlcygpLHQsMil9LHA6ZnVuY3Rpb24obil7cmV0dXJuIHBbKyhuLmdldEhvdXJzKCk+PTEyKV19LFM6ZnVuY3Rpb24obix0KXtyZXR1cm4gWm4obi5nZXRTZWNvbmRzKCksdCwyKX0sVTpmdW5jdGlvbihuLHQpe3JldHVybiBabihoby5zdW5kYXlPZlllYXIobiksdCwyKX0sdzpmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXREYXkoKX0sVzpmdW5jdGlvbihuLHQpe3JldHVybiBabihoby5tb25kYXlPZlllYXIobiksdCwyKX0seDp0KGgpLFg6dChnKSx5OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIFpuKG4uZ2V0RnVsbFllYXIoKSUxMDAsdCwyKX0sWTpmdW5jdGlvbihuLHQpe3JldHVybiBabihuLmdldEZ1bGxZZWFyKCklMWU0LHQsNCl9LFo6b3QsIiUiOmZ1bmN0aW9uKCl7cmV0dXJuIiUifX0sQz17YTpyLEE6dSxiOmksQjphLGM6byxkOnR0LGU6dHQsSDpydCxJOnJ0LGo6ZXQsTDphdCxtOm50LE06dXQscDpzLFM6aXQsVTpCbix3OiRuLFc6V24seDpsLFg6Yyx5OkduLFk6Sm4sWjpLbiwiJSI6bHR9O3JldHVybiB0fWZ1bmN0aW9uIFpuKG4sdCxlKXt2YXIgcj0wPm4/Ii0iOiIiLHU9KHI/LW46bikrIiIsaT11Lmxlbmd0aDtyZXR1cm4gcisoZT5pP25ldyBBcnJheShlLWkrMSkuam9pbih0KSt1OnUpfWZ1bmN0aW9uIFZuKG4pe3JldHVybiBuZXcgUmVnRXhwKCJeKD86IituLm1hcChvYS5yZXF1b3RlKS5qb2luKCJ8IikrIikiLCJpIil9ZnVuY3Rpb24gWG4obil7Zm9yKHZhciB0PW5ldyBjLGU9LTEscj1uLmxlbmd0aDsrK2U8cjspdC5zZXQobltlXS50b0xvd2VyQ2FzZSgpLGUpO3JldHVybiB0fWZ1bmN0aW9uICRuKG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSxlKzEpKTtyZXR1cm4gcj8obi53PStyWzBdLGUrclswXS5sZW5ndGgpOi0xfWZ1bmN0aW9uIEJuKG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSkpO3JldHVybiByPyhuLlU9K3JbMF0sZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gV24obix0LGUpe21vLmxhc3RJbmRleD0wO3ZhciByPW1vLmV4ZWModC5zbGljZShlKSk7cmV0dXJuIHI/KG4uVz0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBKbihuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSs0KSk7cmV0dXJuIHI/KG4ueT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBHbihuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4ueT1RbigrclswXSksZStyWzBdLmxlbmd0aCk6LTF9ZnVuY3Rpb24gS24obix0LGUpe3JldHVybi9eWystXVxkezR9JC8udGVzdCh0PXQuc2xpY2UoZSxlKzUpKT8obi5aPS10LGUrNSk6LTF9ZnVuY3Rpb24gUW4obil7cmV0dXJuIG4rKG4+Njg/MTkwMDoyZTMpfWZ1bmN0aW9uIG50KG4sdCxlKXttby5sYXN0SW5kZXg9MDt2YXIgcj1tby5leGVjKHQuc2xpY2UoZSxlKzIpKTtyZXR1cm4gcj8obi5tPXJbMF0tMSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB0dChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uZD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBldChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSszKSk7cmV0dXJuIHI/KG4uaj0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBydChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uSD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiB1dChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uTT0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBpdChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSsyKSk7cmV0dXJuIHI/KG4uUz0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBhdChuLHQsZSl7bW8ubGFzdEluZGV4PTA7dmFyIHI9bW8uZXhlYyh0LnNsaWNlKGUsZSszKSk7cmV0dXJuIHI/KG4uTD0rclswXSxlK3JbMF0ubGVuZ3RoKTotMX1mdW5jdGlvbiBvdChuKXt2YXIgdD1uLmdldFRpbWV6b25lT2Zmc2V0KCksZT10PjA/Ii0iOiIrIixyPU1hKHQpLzYwfDAsdT1NYSh0KSU2MDtyZXR1cm4gZStabihyLCIwIiwyKStabih1LCIwIiwyKX1mdW5jdGlvbiBsdChuLHQsZSl7eW8ubGFzdEluZGV4PTA7dmFyIHI9eW8uZXhlYyh0LnNsaWNlKGUsZSsxKSk7cmV0dXJuIHI/ZStyWzBdLmxlbmd0aDotMX1mdW5jdGlvbiBjdChuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT0tMTsrK2U8dDspbltlXVswXT10aGlzKG5bZV1bMF0pO3JldHVybiBmdW5jdGlvbih0KXtmb3IodmFyIGU9MCxyPW5bZV07IXJbMV0odCk7KXI9blsrK2VdO3JldHVybiByWzBdKHQpfX1mdW5jdGlvbiBzdCgpe31mdW5jdGlvbiBmdChuLHQsZSl7dmFyIHI9ZS5zPW4rdCx1PXItbixpPXItdTtlLnQ9bi1pKyh0LXUpfWZ1bmN0aW9uIGh0KG4sdCl7biYmX28uaGFzT3duUHJvcGVydHkobi50eXBlKSYmX29bbi50eXBlXShuLHQpfWZ1bmN0aW9uIGd0KG4sdCxlKXt2YXIgcix1PS0xLGk9bi5sZW5ndGgtZTtmb3IodC5saW5lU3RhcnQoKTsrK3U8aTspcj1uW3VdLHQucG9pbnQoclswXSxyWzFdLHJbMl0pO3QubGluZUVuZCgpfWZ1bmN0aW9uIHB0KG4sdCl7dmFyIGU9LTEscj1uLmxlbmd0aDtmb3IodC5wb2x5Z29uU3RhcnQoKTsrK2U8cjspZ3QobltlXSx0LDEpO3QucG9seWdvbkVuZCgpfWZ1bmN0aW9uIHZ0KCl7ZnVuY3Rpb24gbihuLHQpe24qPU9hLHQ9dCpPYS8yK1VhLzQ7dmFyIGU9bi1yLGE9ZT49MD8xOi0xLG89YSplLGw9TWF0aC5jb3ModCksYz1NYXRoLnNpbih0KSxzPWkqYyxmPXUqbCtzKk1hdGguY29zKG8pLGg9cyphKk1hdGguc2luKG8pO1NvLmFkZChNYXRoLmF0YW4yKGgsZikpLHI9bix1PWwsaT1jfXZhciB0LGUscix1LGk7a28ucG9pbnQ9ZnVuY3Rpb24oYSxvKXtrby5wb2ludD1uLHI9KHQ9YSkqT2EsdT1NYXRoLmNvcyhvPShlPW8pKk9hLzIrVWEvNCksaT1NYXRoLnNpbihvKX0sa28ubGluZUVuZD1mdW5jdGlvbigpe24odCxlKX19ZnVuY3Rpb24gZHQobil7dmFyIHQ9blswXSxlPW5bMV0scj1NYXRoLmNvcyhlKTtyZXR1cm5bcipNYXRoLmNvcyh0KSxyKk1hdGguc2luKHQpLE1hdGguc2luKGUpXX1mdW5jdGlvbiBtdChuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdK25bMl0qdFsyXX1mdW5jdGlvbiB5dChuLHQpe3JldHVybltuWzFdKnRbMl0tblsyXSp0WzFdLG5bMl0qdFswXS1uWzBdKnRbMl0sblswXSp0WzFdLW5bMV0qdFswXV19ZnVuY3Rpb24gTXQobix0KXtuWzBdKz10WzBdLG5bMV0rPXRbMV0sblsyXSs9dFsyXX1mdW5jdGlvbiB4dChuLHQpe3JldHVybltuWzBdKnQsblsxXSp0LG5bMl0qdF19ZnVuY3Rpb24gYnQobil7dmFyIHQ9TWF0aC5zcXJ0KG5bMF0qblswXStuWzFdKm5bMV0rblsyXSpuWzJdKTtuWzBdLz10LG5bMV0vPXQsblsyXS89dH1mdW5jdGlvbiBfdChuKXtyZXR1cm5bTWF0aC5hdGFuMihuWzFdLG5bMF0pLHRuKG5bMl0pXX1mdW5jdGlvbiB3dChuLHQpe3JldHVybiBNYShuWzBdLXRbMF0pPERhJiZNYShuWzFdLXRbMV0pPERhfWZ1bmN0aW9uIFN0KG4sdCl7bio9T2E7dmFyIGU9TWF0aC5jb3ModCo9T2EpO2t0KGUqTWF0aC5jb3MobiksZSpNYXRoLnNpbihuKSxNYXRoLnNpbih0KSl9ZnVuY3Rpb24ga3Qobix0LGUpeysrTm8sQW8rPShuLUFvKS9ObyxDbys9KHQtQ28pL05vLHpvKz0oZS16bykvTm99ZnVuY3Rpb24gTnQoKXtmdW5jdGlvbiBuKG4sdSl7bio9T2E7dmFyIGk9TWF0aC5jb3ModSo9T2EpLGE9aSpNYXRoLmNvcyhuKSxvPWkqTWF0aC5zaW4obiksbD1NYXRoLnNpbih1KSxjPU1hdGguYXRhbjIoTWF0aC5zcXJ0KChjPWUqbC1yKm8pKmMrKGM9ciphLXQqbCkqYysoYz10Km8tZSphKSpjKSx0KmErZSpvK3IqbCk7RW8rPWMsTG8rPWMqKHQrKHQ9YSkpLHFvKz1jKihlKyhlPW8pKSxUbys9Yyoocisocj1sKSksa3QodCxlLHIpfXZhciB0LGUscjtVby5wb2ludD1mdW5jdGlvbih1LGkpe3UqPU9hO3ZhciBhPU1hdGguY29zKGkqPU9hKTt0PWEqTWF0aC5jb3ModSksZT1hKk1hdGguc2luKHUpLHI9TWF0aC5zaW4oaSksVW8ucG9pbnQ9bixrdCh0LGUscil9fWZ1bmN0aW9uIEV0KCl7VW8ucG9pbnQ9U3R9ZnVuY3Rpb24gQXQoKXtmdW5jdGlvbiBuKG4sdCl7bio9T2E7dmFyIGU9TWF0aC5jb3ModCo9T2EpLGE9ZSpNYXRoLmNvcyhuKSxvPWUqTWF0aC5zaW4obiksbD1NYXRoLnNpbih0KSxjPXUqbC1pKm8scz1pKmEtcipsLGY9cipvLXUqYSxoPU1hdGguc3FydChjKmMrcypzK2YqZiksZz1yKmErdSpvK2kqbCxwPWgmJi1ubihnKS9oLHY9TWF0aC5hdGFuMihoLGcpO1JvKz1wKmMsRG8rPXAqcyxQbys9cCpmLEVvKz12LExvKz12KihyKyhyPWEpKSxxbys9dioodSsodT1vKSksVG8rPXYqKGkrKGk9bCkpLGt0KHIsdSxpKX12YXIgdCxlLHIsdSxpO1VvLnBvaW50PWZ1bmN0aW9uKGEsbyl7dD1hLGU9byxVby5wb2ludD1uLGEqPU9hO3ZhciBsPU1hdGguY29zKG8qPU9hKTtyPWwqTWF0aC5jb3MoYSksdT1sKk1hdGguc2luKGEpLGk9TWF0aC5zaW4obyksa3Qocix1LGkpfSxVby5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpLFVvLmxpbmVFbmQ9RXQsVW8ucG9pbnQ9U3R9fWZ1bmN0aW9uIEN0KG4sdCl7ZnVuY3Rpb24gZShlLHIpe3JldHVybiBlPW4oZSxyKSx0KGVbMF0sZVsxXSl9cmV0dXJuIG4uaW52ZXJ0JiZ0LmludmVydCYmKGUuaW52ZXJ0PWZ1bmN0aW9uKGUscil7cmV0dXJuIGU9dC5pbnZlcnQoZSxyKSxlJiZuLmludmVydChlWzBdLGVbMV0pfSksZX1mdW5jdGlvbiB6dCgpe3JldHVybiEwfWZ1bmN0aW9uIEx0KG4sdCxlLHIsdSl7dmFyIGk9W10sYT1bXTtpZihuLmZvckVhY2goZnVuY3Rpb24obil7aWYoISgodD1uLmxlbmd0aC0xKTw9MCkpe3ZhciB0LGU9blswXSxyPW5bdF07aWYod3QoZSxyKSl7dS5saW5lU3RhcnQoKTtmb3IodmFyIG89MDt0Pm87KytvKXUucG9pbnQoKGU9bltvXSlbMF0sZVsxXSk7cmV0dXJuIHZvaWQgdS5saW5lRW5kKCl9dmFyIGw9bmV3IFR0KGUsbixudWxsLCEwKSxjPW5ldyBUdChlLG51bGwsbCwhMSk7bC5vPWMsaS5wdXNoKGwpLGEucHVzaChjKSxsPW5ldyBUdChyLG4sbnVsbCwhMSksYz1uZXcgVHQocixudWxsLGwsITApLGwubz1jLGkucHVzaChsKSxhLnB1c2goYyl9fSksYS5zb3J0KHQpLHF0KGkpLHF0KGEpLGkubGVuZ3RoKXtmb3IodmFyIG89MCxsPWUsYz1hLmxlbmd0aDtjPm87KytvKWFbb10uZT1sPSFsO2Zvcih2YXIgcyxmLGg9aVswXTs7KXtmb3IodmFyIGc9aCxwPSEwO2cudjspaWYoKGc9Zy5uKT09PWgpcmV0dXJuO3M9Zy56LHUubGluZVN0YXJ0KCk7ZG97aWYoZy52PWcuby52PSEwLGcuZSl7aWYocClmb3IodmFyIG89MCxjPXMubGVuZ3RoO2M+bzsrK28pdS5wb2ludCgoZj1zW29dKVswXSxmWzFdKTtlbHNlIHIoZy54LGcubi54LDEsdSk7Zz1nLm59ZWxzZXtpZihwKXtzPWcucC56O2Zvcih2YXIgbz1zLmxlbmd0aC0xO28+PTA7LS1vKXUucG9pbnQoKGY9c1tvXSlbMF0sZlsxXSl9ZWxzZSByKGcueCxnLnAueCwtMSx1KTtnPWcucH1nPWcubyxzPWcueixwPSFwfXdoaWxlKCFnLnYpO3UubGluZUVuZCgpfX19ZnVuY3Rpb24gcXQobil7aWYodD1uLmxlbmd0aCl7Zm9yKHZhciB0LGUscj0wLHU9blswXTsrK3I8dDspdS5uPWU9bltyXSxlLnA9dSx1PWU7dS5uPWU9blswXSxlLnA9dX19ZnVuY3Rpb24gVHQobix0LGUscil7dGhpcy54PW4sdGhpcy56PXQsdGhpcy5vPWUsdGhpcy5lPXIsdGhpcy52PSExLHRoaXMubj10aGlzLnA9bnVsbH1mdW5jdGlvbiBSdChuLHQsZSxyKXtyZXR1cm4gZnVuY3Rpb24odSxpKXtmdW5jdGlvbiBhKHQsZSl7dmFyIHI9dSh0LGUpO24odD1yWzBdLGU9clsxXSkmJmkucG9pbnQodCxlKX1mdW5jdGlvbiBvKG4sdCl7dmFyIGU9dShuLHQpO2QucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiBsKCl7eS5wb2ludD1vLGQubGluZVN0YXJ0KCl9ZnVuY3Rpb24gYygpe3kucG9pbnQ9YSxkLmxpbmVFbmQoKX1mdW5jdGlvbiBzKG4sdCl7di5wdXNoKFtuLHRdKTt2YXIgZT11KG4sdCk7eC5wb2ludChlWzBdLGVbMV0pfWZ1bmN0aW9uIGYoKXt4LmxpbmVTdGFydCgpLHY9W119ZnVuY3Rpb24gaCgpe3ModlswXVswXSx2WzBdWzFdKSx4LmxpbmVFbmQoKTt2YXIgbix0PXguY2xlYW4oKSxlPU0uYnVmZmVyKCkscj1lLmxlbmd0aDtpZih2LnBvcCgpLHAucHVzaCh2KSx2PW51bGwscilpZigxJnQpe249ZVswXTt2YXIgdSxyPW4ubGVuZ3RoLTEsYT0tMTtpZihyPjApe2ZvcihifHwoaS5wb2x5Z29uU3RhcnQoKSxiPSEwKSxpLmxpbmVTdGFydCgpOysrYTxyOylpLnBvaW50KCh1PW5bYV0pWzBdLHVbMV0pO2kubGluZUVuZCgpfX1lbHNlIHI+MSYmMiZ0JiZlLnB1c2goZS5wb3AoKS5jb25jYXQoZS5zaGlmdCgpKSksZy5wdXNoKGUuZmlsdGVyKER0KSl9dmFyIGcscCx2LGQ9dChpKSxtPXUuaW52ZXJ0KHJbMF0sclsxXSkseT17cG9pbnQ6YSxsaW5lU3RhcnQ6bCxsaW5lRW5kOmMscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7eS5wb2ludD1zLHkubGluZVN0YXJ0PWYseS5saW5lRW5kPWgsZz1bXSxwPVtdfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7eS5wb2ludD1hLHkubGluZVN0YXJ0PWwseS5saW5lRW5kPWMsZz1vYS5tZXJnZShnKTt2YXIgbj1PdChtLHApO2cubGVuZ3RoPyhifHwoaS5wb2x5Z29uU3RhcnQoKSxiPSEwKSxMdChnLFV0LG4sZSxpKSk6biYmKGJ8fChpLnBvbHlnb25TdGFydCgpLGI9ITApLGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSksYiYmKGkucG9seWdvbkVuZCgpLGI9ITEpLGc9cD1udWxsfSxzcGhlcmU6ZnVuY3Rpb24oKXtpLnBvbHlnb25TdGFydCgpLGkubGluZVN0YXJ0KCksZShudWxsLG51bGwsMSxpKSxpLmxpbmVFbmQoKSxpLnBvbHlnb25FbmQoKX19LE09UHQoKSx4PXQoTSksYj0hMTtyZXR1cm4geX19ZnVuY3Rpb24gRHQobil7cmV0dXJuIG4ubGVuZ3RoPjF9ZnVuY3Rpb24gUHQoKXt2YXIgbix0PVtdO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXt0LnB1c2gobj1bXSl9LHBvaW50OmZ1bmN0aW9uKHQsZSl7bi5wdXNoKFt0LGVdKX0sbGluZUVuZDpiLGJ1ZmZlcjpmdW5jdGlvbigpe3ZhciBlPXQ7cmV0dXJuIHQ9W10sbj1udWxsLGV9LHJlam9pbjpmdW5jdGlvbigpe3QubGVuZ3RoPjEmJnQucHVzaCh0LnBvcCgpLmNvbmNhdCh0LnNoaWZ0KCkpKX19fWZ1bmN0aW9uIFV0KG4sdCl7cmV0dXJuKChuPW4ueClbMF08MD9uWzFdLUhhLURhOkhhLW5bMV0pLSgodD10LngpWzBdPDA/dFsxXS1IYS1EYTpIYS10WzFdKX1mdW5jdGlvbiBqdChuKXt2YXIgdCxlPU5hTixyPU5hTix1PU5hTjtyZXR1cm57bGluZVN0YXJ0OmZ1bmN0aW9uKCl7bi5saW5lU3RhcnQoKSx0PTF9LHBvaW50OmZ1bmN0aW9uKGksYSl7dmFyIG89aT4wP1VhOi1VYSxsPU1hKGktZSk7TWEobC1VYSk8RGE/KG4ucG9pbnQoZSxyPShyK2EpLzI+MD9IYTotSGEpLG4ucG9pbnQodSxyKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobyxyKSxuLnBvaW50KGksciksdD0wKTp1IT09byYmbD49VWEmJihNYShlLXUpPERhJiYoZS09dSpEYSksTWEoaS1vKTxEYSYmKGktPW8qRGEpLHI9RnQoZSxyLGksYSksbi5wb2ludCh1LHIpLG4ubGluZUVuZCgpLG4ubGluZVN0YXJ0KCksbi5wb2ludChvLHIpLHQ9MCksbi5wb2ludChlPWkscj1hKSx1PW99LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKSxlPXI9TmFOfSxjbGVhbjpmdW5jdGlvbigpe3JldHVybiAyLXR9fX1mdW5jdGlvbiBGdChuLHQsZSxyKXt2YXIgdSxpLGE9TWF0aC5zaW4obi1lKTtyZXR1cm4gTWEoYSk+RGE/TWF0aC5hdGFuKChNYXRoLnNpbih0KSooaT1NYXRoLmNvcyhyKSkqTWF0aC5zaW4oZSktTWF0aC5zaW4ocikqKHU9TWF0aC5jb3ModCkpKk1hdGguc2luKG4pKS8odSppKmEpKToodCtyKS8yfWZ1bmN0aW9uIEh0KG4sdCxlLHIpe3ZhciB1O2lmKG51bGw9PW4pdT1lKkhhLHIucG9pbnQoLVVhLHUpLHIucG9pbnQoMCx1KSxyLnBvaW50KFVhLHUpLHIucG9pbnQoVWEsMCksci5wb2ludChVYSwtdSksci5wb2ludCgwLC11KSxyLnBvaW50KC1VYSwtdSksci5wb2ludCgtVWEsMCksci5wb2ludCgtVWEsdSk7ZWxzZSBpZihNYShuWzBdLXRbMF0pPkRhKXt2YXIgaT1uWzBdPHRbMF0/VWE6LVVhO3U9ZSppLzIsci5wb2ludCgtaSx1KSxyLnBvaW50KDAsdSksci5wb2ludChpLHUpfWVsc2Ugci5wb2ludCh0WzBdLHRbMV0pfWZ1bmN0aW9uIE90KG4sdCl7dmFyIGU9blswXSxyPW5bMV0sdT1bTWF0aC5zaW4oZSksLU1hdGguY29zKGUpLDBdLGk9MCxhPTA7U28ucmVzZXQoKTtmb3IodmFyIG89MCxsPXQubGVuZ3RoO2w+bzsrK28pe3ZhciBjPXRbb10scz1jLmxlbmd0aDtpZihzKWZvcih2YXIgZj1jWzBdLGg9ZlswXSxnPWZbMV0vMitVYS80LHA9TWF0aC5zaW4oZyksdj1NYXRoLmNvcyhnKSxkPTE7Oyl7ZD09PXMmJihkPTApLG49Y1tkXTt2YXIgbT1uWzBdLHk9blsxXS8yK1VhLzQsTT1NYXRoLnNpbih5KSx4PU1hdGguY29zKHkpLGI9bS1oLF89Yj49MD8xOi0xLHc9XypiLFM9dz5VYSxrPXAqTTtpZihTby5hZGQoTWF0aC5hdGFuMihrKl8qTWF0aC5zaW4odyksdip4K2sqTWF0aC5jb3ModykpKSxpKz1TP2IrXypqYTpiLFNeaD49ZV5tPj1lKXt2YXIgTj15dChkdChmKSxkdChuKSk7YnQoTik7dmFyIEU9eXQodSxOKTtidChFKTt2YXIgQT0oU15iPj0wPy0xOjEpKnRuKEVbMl0pOyhyPkF8fHI9PT1BJiYoTlswXXx8TlsxXSkpJiYoYSs9U15iPj0wPzE6LTEpfWlmKCFkKyspYnJlYWs7aD1tLHA9TSx2PXgsZj1ufX1yZXR1cm4oLURhPml8fERhPmkmJjA+U28pXjEmYX1mdW5jdGlvbiBJdChuKXtmdW5jdGlvbiB0KG4sdCl7cmV0dXJuIE1hdGguY29zKG4pKk1hdGguY29zKHQpPml9ZnVuY3Rpb24gZShuKXt2YXIgZSxpLGwsYyxzO3JldHVybntsaW5lU3RhcnQ6ZnVuY3Rpb24oKXtjPWw9ITEscz0xfSxwb2ludDpmdW5jdGlvbihmLGgpe3ZhciBnLHA9W2YsaF0sdj10KGYsaCksZD1hP3Y/MDp1KGYsaCk6dj91KGYrKDA+Zj9VYTotVWEpLGgpOjA7aWYoIWUmJihjPWw9dikmJm4ubGluZVN0YXJ0KCksdiE9PWwmJihnPXIoZSxwKSwod3QoZSxnKXx8d3QocCxnKSkmJihwWzBdKz1EYSxwWzFdKz1EYSx2PXQocFswXSxwWzFdKSkpLHYhPT1sKXM9MCx2PyhuLmxpbmVTdGFydCgpLGc9cihwLGUpLG4ucG9pbnQoZ1swXSxnWzFdKSk6KGc9cihlLHApLG4ucG9pbnQoZ1swXSxnWzFdKSxuLmxpbmVFbmQoKSksZT1nO2Vsc2UgaWYobyYmZSYmYV52KXt2YXIgbTtkJml8fCEobT1yKHAsZSwhMCkpfHwocz0wLGE/KG4ubGluZVN0YXJ0KCksbi5wb2ludChtWzBdWzBdLG1bMF1bMV0pLG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSk6KG4ucG9pbnQobVsxXVswXSxtWzFdWzFdKSxuLmxpbmVFbmQoKSxuLmxpbmVTdGFydCgpLG4ucG9pbnQobVswXVswXSxtWzBdWzFdKSkpfSF2fHxlJiZ3dChlLHApfHxuLnBvaW50KHBbMF0scFsxXSksZT1wLGw9dixpPWR9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtsJiZuLmxpbmVFbmQoKSxlPW51bGx9LGNsZWFuOmZ1bmN0aW9uKCl7cmV0dXJuIHN8KGMmJmwpPDwxfX19ZnVuY3Rpb24gcihuLHQsZSl7dmFyIHI9ZHQobiksdT1kdCh0KSxhPVsxLDAsMF0sbz15dChyLHUpLGw9bXQobyxvKSxjPW9bMF0scz1sLWMqYztpZighcylyZXR1cm4hZSYmbjt2YXIgZj1pKmwvcyxoPS1pKmMvcyxnPXl0KGEsbykscD14dChhLGYpLHY9eHQobyxoKTtNdChwLHYpO3ZhciBkPWcsbT1tdChwLGQpLHk9bXQoZCxkKSxNPW0qbS15KihtdChwLHApLTEpO2lmKCEoMD5NKSl7dmFyIHg9TWF0aC5zcXJ0KE0pLGI9eHQoZCwoLW0teCkveSk7aWYoTXQoYixwKSxiPV90KGIpLCFlKXJldHVybiBiO3ZhciBfLHc9blswXSxTPXRbMF0saz1uWzFdLE49dFsxXTt3PlMmJihfPXcsdz1TLFM9Xyk7dmFyIEU9Uy13LEE9TWEoRS1VYSk8RGEsQz1BfHxEYT5FO2lmKCFBJiZrPk4mJihfPWssaz1OLE49XyksQz9BP2srTj4wXmJbMV08KE1hKGJbMF0tdyk8RGE/azpOKTprPD1iWzFdJiZiWzFdPD1OOkU+VWFeKHc8PWJbMF0mJmJbMF08PVMpKXt2YXIgej14dChkLCgtbSt4KS95KTtyZXR1cm4gTXQoeixwKSxbYixfdCh6KV19fX1mdW5jdGlvbiB1KHQsZSl7dmFyIHI9YT9uOlVhLW4sdT0wO3JldHVybi1yPnQ/dXw9MTp0PnImJih1fD0yKSwtcj5lP3V8PTQ6ZT5yJiYodXw9OCksdX12YXIgaT1NYXRoLmNvcyhuKSxhPWk+MCxvPU1hKGkpPkRhLGw9dmUobiw2Kk9hKTtyZXR1cm4gUnQodCxlLGwsYT9bMCwtbl06Wy1VYSxuLVVhXSl9ZnVuY3Rpb24gWXQobix0LGUscil7cmV0dXJuIGZ1bmN0aW9uKHUpe3ZhciBpLGE9dS5hLG89dS5iLGw9YS54LGM9YS55LHM9by54LGY9by55LGg9MCxnPTEscD1zLWwsdj1mLWM7aWYoaT1uLWwscHx8IShpPjApKXtpZihpLz1wLDA+cCl7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYocD4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1lLWwscHx8ISgwPmkpKXtpZihpLz1wLDA+cCl7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYocD4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9aWYoaT10LWMsdnx8IShpPjApKXtpZihpLz12LDA+dil7aWYoaD5pKXJldHVybjtnPmkmJihnPWkpfWVsc2UgaWYodj4wKXtpZihpPmcpcmV0dXJuO2k+aCYmKGg9aSl9aWYoaT1yLWMsdnx8ISgwPmkpKXtpZihpLz12LDA+dil7aWYoaT5nKXJldHVybjtpPmgmJihoPWkpfWVsc2UgaWYodj4wKXtpZihoPmkpcmV0dXJuO2c+aSYmKGc9aSl9cmV0dXJuIGg+MCYmKHUuYT17eDpsK2gqcCx5OmMraCp2fSksMT5nJiYodS5iPXt4OmwrZypwLHk6YytnKnZ9KSx1fX19fX19ZnVuY3Rpb24gWnQobix0LGUscil7ZnVuY3Rpb24gdShyLHUpe3JldHVybiBNYShyWzBdLW4pPERhP3U+MD8wOjM6TWEoclswXS1lKTxEYT91PjA/MjoxOk1hKHJbMV0tdCk8RGE/dT4wPzE6MDp1PjA/MzoyfWZ1bmN0aW9uIGkobix0KXtyZXR1cm4gYShuLngsdC54KX1mdW5jdGlvbiBhKG4sdCl7dmFyIGU9dShuLDEpLHI9dSh0LDEpO3JldHVybiBlIT09cj9lLXI6MD09PWU/dFsxXS1uWzFdOjE9PT1lP25bMF0tdFswXToyPT09ZT9uWzFdLXRbMV06dFswXS1uWzBdfXJldHVybiBmdW5jdGlvbihvKXtmdW5jdGlvbiBsKG4pe2Zvcih2YXIgdD0wLGU9ZC5sZW5ndGgscj1uWzFdLHU9MDtlPnU7Kyt1KWZvcih2YXIgaSxhPTEsbz1kW3VdLGw9by5sZW5ndGgsYz1vWzBdO2w+YTsrK2EpaT1vW2FdLGNbMV08PXI/aVsxXT5yJiZRKGMsaSxuKT4wJiYrK3Q6aVsxXTw9ciYmUShjLGksbik8MCYmLS10LGM9aTtyZXR1cm4gMCE9PXR9ZnVuY3Rpb24gYyhpLG8sbCxjKXt2YXIgcz0wLGY9MDtpZihudWxsPT1pfHwocz11KGksbCkpIT09KGY9dShvLGwpKXx8YShpLG8pPDBebD4wKXtkbyBjLnBvaW50KDA9PT1zfHwzPT09cz9uOmUscz4xP3I6dCk7d2hpbGUoKHM9KHMrbCs0KSU0KSE9PWYpfWVsc2UgYy5wb2ludChvWzBdLG9bMV0pfWZ1bmN0aW9uIHModSxpKXtyZXR1cm4gdT49biYmZT49dSYmaT49dCYmcj49aX1mdW5jdGlvbiBmKG4sdCl7cyhuLHQpJiZvLnBvaW50KG4sdCl9ZnVuY3Rpb24gaCgpe0MucG9pbnQ9cCxkJiZkLnB1c2gobT1bXSksUz0hMCx3PSExLGI9Xz1OYU59ZnVuY3Rpb24gZygpe3YmJihwKHksTSkseCYmdyYmRS5yZWpvaW4oKSx2LnB1c2goRS5idWZmZXIoKSkpLEMucG9pbnQ9Zix3JiZvLmxpbmVFbmQoKX1mdW5jdGlvbiBwKG4sdCl7bj1NYXRoLm1heCgtRm8sTWF0aC5taW4oRm8sbikpLHQ9TWF0aC5tYXgoLUZvLE1hdGgubWluKEZvLHQpKTt2YXIgZT1zKG4sdCk7aWYoZCYmbS5wdXNoKFtuLHRdKSxTKXk9bixNPXQseD1lLFM9ITEsZSYmKG8ubGluZVN0YXJ0KCksby5wb2ludChuLHQpKTtlbHNlIGlmKGUmJncpby5wb2ludChuLHQpO2Vsc2V7dmFyIHI9e2E6e3g6Yix5Ol99LGI6e3g6bix5OnR9fTtBKHIpPyh3fHwoby5saW5lU3RhcnQoKSxvLnBvaW50KHIuYS54LHIuYS55KSksby5wb2ludChyLmIueCxyLmIueSksZXx8by5saW5lRW5kKCksaz0hMSk6ZSYmKG8ubGluZVN0YXJ0KCksby5wb2ludChuLHQpLGs9ITEpfWI9bixfPXQsdz1lfXZhciB2LGQsbSx5LE0seCxiLF8sdyxTLGssTj1vLEU9UHQoKSxBPVl0KG4sdCxlLHIpLEM9e3BvaW50OmYsbGluZVN0YXJ0OmgsbGluZUVuZDpnLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe289RSx2PVtdLGQ9W10saz0hMH0scG9seWdvbkVuZDpmdW5jdGlvbigpe289Tix2PW9hLm1lcmdlKHYpO3ZhciB0PWwoW24scl0pLGU9ayYmdCx1PXYubGVuZ3RoOyhlfHx1KSYmKG8ucG9seWdvblN0YXJ0KCksZSYmKG8ubGluZVN0YXJ0KCksYyhudWxsLG51bGwsMSxvKSxvLmxpbmVFbmQoKSksdSYmTHQodixpLHQsYyxvKSxvLnBvbHlnb25FbmQoKSksdj1kPW09bnVsbH19O3JldHVybiBDfX1mdW5jdGlvbiBWdChuKXt2YXIgdD0wLGU9VWEvMyxyPW9lKG4pLHU9cih0LGUpO3JldHVybiB1LnBhcmFsbGVscz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9yKHQ9blswXSpVYS8xODAsZT1uWzFdKlVhLzE4MCk6W3QvVWEqMTgwLGUvVWEqMTgwXX0sdX1mdW5jdGlvbiBYdChuLHQpe2Z1bmN0aW9uIGUobix0KXt2YXIgZT1NYXRoLnNxcnQoaS0yKnUqTWF0aC5zaW4odCkpL3U7cmV0dXJuW2UqTWF0aC5zaW4obio9dSksYS1lKk1hdGguY29zKG4pXX12YXIgcj1NYXRoLnNpbihuKSx1PShyK01hdGguc2luKHQpKS8yLGk9MStyKigyKnUtciksYT1NYXRoLnNxcnQoaSkvdTtyZXR1cm4gZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1hLXQ7cmV0dXJuW01hdGguYXRhbjIobixlKS91LHRuKChpLShuKm4rZSplKSp1KnUpLygyKnUpKV19LGV9ZnVuY3Rpb24gJHQoKXtmdW5jdGlvbiBuKG4sdCl7T28rPXUqbi1yKnQscj1uLHU9dH12YXIgdCxlLHIsdTtYby5wb2ludD1mdW5jdGlvbihpLGEpe1hvLnBvaW50PW4sdD1yPWksZT11PWF9LFhvLmxpbmVFbmQ9ZnVuY3Rpb24oKXtuKHQsZSl9fWZ1bmN0aW9uIEJ0KG4sdCl7SW8+biYmKElvPW4pLG4+Wm8mJihabz1uKSxZbz50JiYoWW89dCksdD5WbyYmKFZvPXQpfWZ1bmN0aW9uIFd0KCl7ZnVuY3Rpb24gbihuLHQpe2EucHVzaCgiTSIsbiwiLCIsdCxpKX1mdW5jdGlvbiB0KG4sdCl7YS5wdXNoKCJNIixuLCIsIix0KSxvLnBvaW50PWV9ZnVuY3Rpb24gZShuLHQpe2EucHVzaCgiTCIsbiwiLCIsdCl9ZnVuY3Rpb24gcigpe28ucG9pbnQ9bn1mdW5jdGlvbiB1KCl7YS5wdXNoKCJaIil9dmFyIGk9SnQoNC41KSxhPVtdLG89e3BvaW50Om4sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7by5wb2ludD10fSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7by5saW5lRW5kPXV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtvLmxpbmVFbmQ9cixvLnBvaW50PW59LHBvaW50UmFkaXVzOmZ1bmN0aW9uKG4pe3JldHVybiBpPUp0KG4pLG99LHJlc3VsdDpmdW5jdGlvbigpe2lmKGEubGVuZ3RoKXt2YXIgbj1hLmpvaW4oIiIpO3JldHVybiBhPVtdLG59fX07cmV0dXJuIG99ZnVuY3Rpb24gSnQobil7cmV0dXJuIm0wLCIrbisiYSIrbisiLCIrbisiIDAgMSwxIDAsIistMipuKyJhIituKyIsIituKyIgMCAxLDEgMCwiKzIqbisieiJ9ZnVuY3Rpb24gR3Qobix0KXtBbys9bixDbys9dCwrK3pvfWZ1bmN0aW9uIEt0KCl7ZnVuY3Rpb24gbihuLHIpe3ZhciB1PW4tdCxpPXItZSxhPU1hdGguc3FydCh1KnUraSppKTtMbys9YSoodCtuKS8yLHFvKz1hKihlK3IpLzIsVG8rPWEsR3QodD1uLGU9cil9dmFyIHQsZTtCby5wb2ludD1mdW5jdGlvbihyLHUpe0JvLnBvaW50PW4sR3QodD1yLGU9dSl9fWZ1bmN0aW9uIFF0KCl7Qm8ucG9pbnQ9R3R9ZnVuY3Rpb24gbmUoKXtmdW5jdGlvbiBuKG4sdCl7dmFyIGU9bi1yLGk9dC11LGE9TWF0aC5zcXJ0KGUqZStpKmkpO0xvKz1hKihyK24pLzIscW8rPWEqKHUrdCkvMixUbys9YSxhPXUqbi1yKnQsUm8rPWEqKHIrbiksRG8rPWEqKHUrdCksUG8rPTMqYSxHdChyPW4sdT10KX12YXIgdCxlLHIsdTtCby5wb2ludD1mdW5jdGlvbihpLGEpe0JvLnBvaW50PW4sR3QodD1yPWksZT11PWEpfSxCby5saW5lRW5kPWZ1bmN0aW9uKCl7bih0LGUpfX1mdW5jdGlvbiB0ZShuKXtmdW5jdGlvbiB0KHQsZSl7bi5tb3ZlVG8odCthLGUpLG4uYXJjKHQsZSxhLDAsamEpfWZ1bmN0aW9uIGUodCxlKXtuLm1vdmVUbyh0LGUpLG8ucG9pbnQ9cn1mdW5jdGlvbiByKHQsZSl7bi5saW5lVG8odCxlKX1mdW5jdGlvbiB1KCl7by5wb2ludD10fWZ1bmN0aW9uIGkoKXtuLmNsb3NlUGF0aCgpfXZhciBhPTQuNSxvPXtwb2ludDp0LGxpbmVTdGFydDpmdW5jdGlvbigpe28ucG9pbnQ9ZX0sbGluZUVuZDp1LHBvbHlnb25TdGFydDpmdW5jdGlvbigpe28ubGluZUVuZD1pfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7by5saW5lRW5kPXUsby5wb2ludD10fSxwb2ludFJhZGl1czpmdW5jdGlvbihuKXtyZXR1cm4gYT1uLG99LHJlc3VsdDpifTtyZXR1cm4gb31mdW5jdGlvbiBlZShuKXtmdW5jdGlvbiB0KG4pe3JldHVybihvP3I6ZSkobil9ZnVuY3Rpb24gZSh0KXtyZXR1cm4gaWUodCxmdW5jdGlvbihlLHIpe2U9bihlLHIpLHQucG9pbnQoZVswXSxlWzFdKX0pfWZ1bmN0aW9uIHIodCl7ZnVuY3Rpb24gZShlLHIpe2U9bihlLHIpLHQucG9pbnQoZVswXSxlWzFdKX1mdW5jdGlvbiByKCl7TT1OYU4sUy5wb2ludD1pLHQubGluZVN0YXJ0KCl9ZnVuY3Rpb24gaShlLHIpe3ZhciBpPWR0KFtlLHJdKSxhPW4oZSxyKTt1KE0seCx5LGIsXyx3LE09YVswXSx4PWFbMV0seT1lLGI9aVswXSxfPWlbMV0sdz1pWzJdLG8sdCksdC5wb2ludChNLHgpfWZ1bmN0aW9uIGEoKXtTLnBvaW50PWUsdC5saW5lRW5kKCl9ZnVuY3Rpb24gbCgpewpyKCksUy5wb2ludD1jLFMubGluZUVuZD1zfWZ1bmN0aW9uIGMobix0KXtpKGY9bixoPXQpLGc9TSxwPXgsdj1iLGQ9XyxtPXcsUy5wb2ludD1pfWZ1bmN0aW9uIHMoKXt1KE0seCx5LGIsXyx3LGcscCxmLHYsZCxtLG8sdCksUy5saW5lRW5kPWEsYSgpfXZhciBmLGgsZyxwLHYsZCxtLHksTSx4LGIsXyx3LFM9e3BvaW50OmUsbGluZVN0YXJ0OnIsbGluZUVuZDphLHBvbHlnb25TdGFydDpmdW5jdGlvbigpe3QucG9seWdvblN0YXJ0KCksUy5saW5lU3RhcnQ9bH0scG9seWdvbkVuZDpmdW5jdGlvbigpe3QucG9seWdvbkVuZCgpLFMubGluZVN0YXJ0PXJ9fTtyZXR1cm4gU31mdW5jdGlvbiB1KHQsZSxyLG8sbCxjLHMsZixoLGcscCx2LGQsbSl7dmFyIHk9cy10LE09Zi1lLHg9eSp5K00qTTtpZih4PjQqaSYmZC0tKXt2YXIgYj1vK2csXz1sK3Asdz1jK3YsUz1NYXRoLnNxcnQoYipiK18qXyt3KncpLGs9TWF0aC5hc2luKHcvPVMpLE49TWEoTWEodyktMSk8RGF8fE1hKHItaCk8RGE/KHIraCkvMjpNYXRoLmF0YW4yKF8sYiksRT1uKE4sayksQT1FWzBdLEM9RVsxXSx6PUEtdCxMPUMtZSxxPU0qei15Kkw7KHEqcS94Pml8fE1hKCh5KnorTSpMKS94LS41KT4uM3x8YT5vKmcrbCpwK2MqdikmJih1KHQsZSxyLG8sbCxjLEEsQyxOLGIvPVMsXy89Uyx3LGQsbSksbS5wb2ludChBLEMpLHUoQSxDLE4sYixfLHcscyxmLGgsZyxwLHYsZCxtKSl9fXZhciBpPS41LGE9TWF0aC5jb3MoMzAqT2EpLG89MTY7cmV0dXJuIHQucHJlY2lzaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPShpPW4qbik+MCYmMTYsdCk6TWF0aC5zcXJ0KGkpfSx0fWZ1bmN0aW9uIHJlKG4pe3ZhciB0PWVlKGZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oW3QqSWEsZSpJYV0pfSk7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBsZSh0KG4pKX19ZnVuY3Rpb24gdWUobil7dGhpcy5zdHJlYW09bn1mdW5jdGlvbiBpZShuLHQpe3JldHVybntwb2ludDp0LHNwaGVyZTpmdW5jdGlvbigpe24uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe24ubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXtuLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7bi5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe24ucG9seWdvbkVuZCgpfX19ZnVuY3Rpb24gYWUobil7cmV0dXJuIG9lKGZ1bmN0aW9uKCl7cmV0dXJuIG59KSgpfWZ1bmN0aW9uIG9lKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuIG49byhuWzBdKk9hLG5bMV0qT2EpLFtuWzBdKmgrbCxjLW5bMV0qaF19ZnVuY3Rpb24gZShuKXtyZXR1cm4gbj1vLmludmVydCgoblswXS1sKS9oLChjLW5bMV0pL2gpLG4mJltuWzBdKklhLG5bMV0qSWFdfWZ1bmN0aW9uIHIoKXtvPUN0KGE9ZmUobSxNLHgpLGkpO3ZhciBuPWkodixkKTtyZXR1cm4gbD1nLW5bMF0qaCxjPXArblsxXSpoLHUoKX1mdW5jdGlvbiB1KCl7cmV0dXJuIHMmJihzLnZhbGlkPSExLHM9bnVsbCksdH12YXIgaSxhLG8sbCxjLHMsZj1lZShmdW5jdGlvbihuLHQpe3JldHVybiBuPWkobix0KSxbblswXSpoK2wsYy1uWzFdKmhdfSksaD0xNTAsZz00ODAscD0yNTAsdj0wLGQ9MCxtPTAsTT0wLHg9MCxiPWpvLF89eSx3PW51bGwsUz1udWxsO3JldHVybiB0LnN0cmVhbT1mdW5jdGlvbihuKXtyZXR1cm4gcyYmKHMudmFsaWQ9ITEpLHM9bGUoYihhLGYoXyhuKSkpKSxzLnZhbGlkPSEwLHN9LHQuY2xpcEFuZ2xlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhiPW51bGw9PW4/KHc9bixqbyk6SXQoKHc9K24pKk9hKSx1KCkpOnd9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oUz1uLF89bj9adChuWzBdWzBdLG5bMF1bMV0sblsxXVswXSxuWzFdWzFdKTp5LHUoKSk6U30sdC5zY2FsZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaD0rbixyKCkpOmh9LHQudHJhbnNsYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPStuWzBdLHA9K25bMV0scigpKTpbZyxwXX0sdC5jZW50ZXI9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9blswXSUzNjAqT2EsZD1uWzFdJTM2MCpPYSxyKCkpOlt2KklhLGQqSWFdfSx0LnJvdGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obT1uWzBdJTM2MCpPYSxNPW5bMV0lMzYwKk9hLHg9bi5sZW5ndGg+Mj9uWzJdJTM2MCpPYTowLHIoKSk6W20qSWEsTSpJYSx4KklhXX0sb2EucmViaW5kKHQsZiwicHJlY2lzaW9uIiksZnVuY3Rpb24oKXtyZXR1cm4gaT1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmludmVydD1pLmludmVydCYmZSxyKCl9fWZ1bmN0aW9uIGxlKG4pe3JldHVybiBpZShuLGZ1bmN0aW9uKHQsZSl7bi5wb2ludCh0Kk9hLGUqT2EpfSl9ZnVuY3Rpb24gY2Uobix0KXtyZXR1cm5bbix0XX1mdW5jdGlvbiBzZShuLHQpe3JldHVybltuPlVhP24tamE6LVVhPm4/bitqYTpuLHRdfWZ1bmN0aW9uIGZlKG4sdCxlKXtyZXR1cm4gbj90fHxlP0N0KGdlKG4pLHBlKHQsZSkpOmdlKG4pOnR8fGU/cGUodCxlKTpzZX1mdW5jdGlvbiBoZShuKXtyZXR1cm4gZnVuY3Rpb24odCxlKXtyZXR1cm4gdCs9bixbdD5VYT90LWphOi1VYT50P3QramE6dCxlXX19ZnVuY3Rpb24gZ2Uobil7dmFyIHQ9aGUobik7cmV0dXJuIHQuaW52ZXJ0PWhlKC1uKSx0fWZ1bmN0aW9uIHBlKG4sdCl7ZnVuY3Rpb24gZShuLHQpe3ZhciBlPU1hdGguY29zKHQpLG89TWF0aC5jb3MobikqZSxsPU1hdGguc2luKG4pKmUsYz1NYXRoLnNpbih0KSxzPWMqcitvKnU7cmV0dXJuW01hdGguYXRhbjIobCppLXMqYSxvKnItYyp1KSx0bihzKmkrbCphKV19dmFyIHI9TWF0aC5jb3MobiksdT1NYXRoLnNpbihuKSxpPU1hdGguY29zKHQpLGE9TWF0aC5zaW4odCk7cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sdCl7dmFyIGU9TWF0aC5jb3ModCksbz1NYXRoLmNvcyhuKSplLGw9TWF0aC5zaW4obikqZSxjPU1hdGguc2luKHQpLHM9YyppLWwqYTtyZXR1cm5bTWF0aC5hdGFuMihsKmkrYyphLG8qcitzKnUpLHRuKHMqci1vKnUpXX0sZX1mdW5jdGlvbiB2ZShuLHQpe3ZhciBlPU1hdGguY29zKG4pLHI9TWF0aC5zaW4obik7cmV0dXJuIGZ1bmN0aW9uKHUsaSxhLG8pe3ZhciBsPWEqdDtudWxsIT11Pyh1PWRlKGUsdSksaT1kZShlLGkpLChhPjA/aT51OnU+aSkmJih1Kz1hKmphKSk6KHU9bithKmphLGk9bi0uNSpsKTtmb3IodmFyIGMscz11O2E+MD9zPmk6aT5zO3MtPWwpby5wb2ludCgoYz1fdChbZSwtcipNYXRoLmNvcyhzKSwtcipNYXRoLnNpbihzKV0pKVswXSxjWzFdKX19ZnVuY3Rpb24gZGUobix0KXt2YXIgZT1kdCh0KTtlWzBdLT1uLGJ0KGUpO3ZhciByPW5uKC1lWzFdKTtyZXR1cm4oKC1lWzJdPDA/LXI6cikrMipNYXRoLlBJLURhKSUoMipNYXRoLlBJKX1mdW5jdGlvbiBtZShuLHQsZSl7dmFyIHI9b2EucmFuZ2Uobix0LURhLGUpLmNvbmNhdCh0KTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIHIubWFwKGZ1bmN0aW9uKHQpe3JldHVybltuLHRdfSl9fWZ1bmN0aW9uIHllKG4sdCxlKXt2YXIgcj1vYS5yYW5nZShuLHQtRGEsZSkuY29uY2F0KHQpO3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4gci5tYXAoZnVuY3Rpb24odCl7cmV0dXJuW3Qsbl19KX19ZnVuY3Rpb24gTWUobil7cmV0dXJuIG4uc291cmNlfWZ1bmN0aW9uIHhlKG4pe3JldHVybiBuLnRhcmdldH1mdW5jdGlvbiBiZShuLHQsZSxyKXt2YXIgdT1NYXRoLmNvcyh0KSxpPU1hdGguc2luKHQpLGE9TWF0aC5jb3Mociksbz1NYXRoLnNpbihyKSxsPXUqTWF0aC5jb3MobiksYz11Kk1hdGguc2luKG4pLHM9YSpNYXRoLmNvcyhlKSxmPWEqTWF0aC5zaW4oZSksaD0yKk1hdGguYXNpbihNYXRoLnNxcnQoYW4oci10KSt1KmEqYW4oZS1uKSkpLGc9MS9NYXRoLnNpbihoKSxwPWg/ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zaW4obio9aCkqZyxlPU1hdGguc2luKGgtbikqZyxyPWUqbCt0KnMsdT1lKmMrdCpmLGE9ZSppK3QqbztyZXR1cm5bTWF0aC5hdGFuMih1LHIpKklhLE1hdGguYXRhbjIoYSxNYXRoLnNxcnQocipyK3UqdSkpKklhXX06ZnVuY3Rpb24oKXtyZXR1cm5bbipJYSx0KklhXX07cmV0dXJuIHAuZGlzdGFuY2U9aCxwfWZ1bmN0aW9uIF9lKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBpPU1hdGguc2luKHUqPU9hKSxhPU1hdGguY29zKHUpLG89TWEoKG4qPU9hKS10KSxsPU1hdGguY29zKG8pO1dvKz1NYXRoLmF0YW4yKE1hdGguc3FydCgobz1hKk1hdGguc2luKG8pKSpvKyhvPXIqaS1lKmEqbCkqbyksZSppK3IqYSpsKSx0PW4sZT1pLHI9YX12YXIgdCxlLHI7Sm8ucG9pbnQ9ZnVuY3Rpb24odSxpKXt0PXUqT2EsZT1NYXRoLnNpbihpKj1PYSkscj1NYXRoLmNvcyhpKSxKby5wb2ludD1ufSxKby5saW5lRW5kPWZ1bmN0aW9uKCl7Sm8ucG9pbnQ9Sm8ubGluZUVuZD1ifX1mdW5jdGlvbiB3ZShuLHQpe2Z1bmN0aW9uIGUodCxlKXt2YXIgcj1NYXRoLmNvcyh0KSx1PU1hdGguY29zKGUpLGk9bihyKnUpO3JldHVybltpKnUqTWF0aC5zaW4odCksaSpNYXRoLnNpbihlKV19cmV0dXJuIGUuaW52ZXJ0PWZ1bmN0aW9uKG4sZSl7dmFyIHI9TWF0aC5zcXJ0KG4qbitlKmUpLHU9dChyKSxpPU1hdGguc2luKHUpLGE9TWF0aC5jb3ModSk7cmV0dXJuW01hdGguYXRhbjIobippLHIqYSksTWF0aC5hc2luKHImJmUqaS9yKV19LGV9ZnVuY3Rpb24gU2Uobix0KXtmdW5jdGlvbiBlKG4sdCl7YT4wPy1IYStEYT50JiYodD0tSGErRGEpOnQ+SGEtRGEmJih0PUhhLURhKTt2YXIgZT1hL01hdGgucG93KHUodCksaSk7cmV0dXJuW2UqTWF0aC5zaW4oaSpuKSxhLWUqTWF0aC5jb3MoaSpuKV19dmFyIHI9TWF0aC5jb3MobiksdT1mdW5jdGlvbihuKXtyZXR1cm4gTWF0aC50YW4oVWEvNCtuLzIpfSxpPW49PT10P01hdGguc2luKG4pOk1hdGgubG9nKHIvTWF0aC5jb3ModCkpL01hdGgubG9nKHUodCkvdShuKSksYT1yKk1hdGgucG93KHUobiksaSkvaTtyZXR1cm4gaT8oZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXt2YXIgZT1hLXQscj1LKGkpKk1hdGguc3FydChuKm4rZSplKTtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL2ksMipNYXRoLmF0YW4oTWF0aC5wb3coYS9yLDEvaSkpLUhhXX0sZSk6TmV9ZnVuY3Rpb24ga2Uobix0KXtmdW5jdGlvbiBlKG4sdCl7dmFyIGU9aS10O3JldHVybltlKk1hdGguc2luKHUqbiksaS1lKk1hdGguY29zKHUqbildfXZhciByPU1hdGguY29zKG4pLHU9bj09PXQ/TWF0aC5zaW4obik6KHItTWF0aC5jb3ModCkpLyh0LW4pLGk9ci91K247cmV0dXJuIE1hKHUpPERhP2NlOihlLmludmVydD1mdW5jdGlvbihuLHQpe3ZhciBlPWktdDtyZXR1cm5bTWF0aC5hdGFuMihuLGUpL3UsaS1LKHUpKk1hdGguc3FydChuKm4rZSplKV19LGUpfWZ1bmN0aW9uIE5lKG4sdCl7cmV0dXJuW24sTWF0aC5sb2coTWF0aC50YW4oVWEvNCt0LzIpKV19ZnVuY3Rpb24gRWUobil7dmFyIHQsZT1hZShuKSxyPWUuc2NhbGUsdT1lLnRyYW5zbGF0ZSxpPWUuY2xpcEV4dGVudDtyZXR1cm4gZS5zY2FsZT1mdW5jdGlvbigpe3ZhciBuPXIuYXBwbHkoZSxhcmd1bWVudHMpO3JldHVybiBuPT09ZT90P2UuY2xpcEV4dGVudChudWxsKTplOm59LGUudHJhbnNsYXRlPWZ1bmN0aW9uKCl7dmFyIG49dS5hcHBseShlLGFyZ3VtZW50cyk7cmV0dXJuIG49PT1lP3Q/ZS5jbGlwRXh0ZW50KG51bGwpOmU6bn0sZS5jbGlwRXh0ZW50PWZ1bmN0aW9uKG4pe3ZhciBhPWkuYXBwbHkoZSxhcmd1bWVudHMpO2lmKGE9PT1lKXtpZih0PW51bGw9PW4pe3ZhciBvPVVhKnIoKSxsPXUoKTtpKFtbbFswXS1vLGxbMV0tb10sW2xbMF0rbyxsWzFdK29dXSl9fWVsc2UgdCYmKGE9bnVsbCk7cmV0dXJuIGF9LGUuY2xpcEV4dGVudChudWxsKX1mdW5jdGlvbiBBZShuLHQpe3JldHVybltNYXRoLmxvZyhNYXRoLnRhbihVYS80K3QvMikpLC1uXX1mdW5jdGlvbiBDZShuKXtyZXR1cm4gblswXX1mdW5jdGlvbiB6ZShuKXtyZXR1cm4gblsxXX1mdW5jdGlvbiBMZShuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1bMCwxXSxyPTIsdT0yO3Q+dTt1Kyspe2Zvcig7cj4xJiZRKG5bZVtyLTJdXSxuW2Vbci0xXV0sblt1XSk8PTA7KS0tcjtlW3IrK109dX1yZXR1cm4gZS5zbGljZSgwLHIpfWZ1bmN0aW9uIHFlKG4sdCl7cmV0dXJuIG5bMF0tdFswXXx8blsxXS10WzFdfWZ1bmN0aW9uIFRlKG4sdCxlKXtyZXR1cm4oZVswXS10WzBdKSooblsxXS10WzFdKTwoZVsxXS10WzFdKSooblswXS10WzBdKX1mdW5jdGlvbiBSZShuLHQsZSxyKXt2YXIgdT1uWzBdLGk9ZVswXSxhPXRbMF0tdSxvPXJbMF0taSxsPW5bMV0sYz1lWzFdLHM9dFsxXS1sLGY9clsxXS1jLGg9KG8qKGwtYyktZioodS1pKSkvKGYqYS1vKnMpO3JldHVyblt1K2gqYSxsK2gqc119ZnVuY3Rpb24gRGUobil7dmFyIHQ9blswXSxlPW5bbi5sZW5ndGgtMV07cmV0dXJuISh0WzBdLWVbMF18fHRbMV0tZVsxXSl9ZnVuY3Rpb24gUGUoKXtycih0aGlzKSx0aGlzLmVkZ2U9dGhpcy5zaXRlPXRoaXMuY2lyY2xlPW51bGx9ZnVuY3Rpb24gVWUobil7dmFyIHQ9bGwucG9wKCl8fG5ldyBQZTtyZXR1cm4gdC5zaXRlPW4sdH1mdW5jdGlvbiBqZShuKXtCZShuKSxpbC5yZW1vdmUobiksbGwucHVzaChuKSxycihuKX1mdW5jdGlvbiBGZShuKXt2YXIgdD1uLmNpcmNsZSxlPXQueCxyPXQuY3ksdT17eDplLHk6cn0saT1uLlAsYT1uLk4sbz1bbl07amUobik7Zm9yKHZhciBsPWk7bC5jaXJjbGUmJk1hKGUtbC5jaXJjbGUueCk8RGEmJk1hKHItbC5jaXJjbGUuY3kpPERhOylpPWwuUCxvLnVuc2hpZnQobCksamUobCksbD1pO28udW5zaGlmdChsKSxCZShsKTtmb3IodmFyIGM9YTtjLmNpcmNsZSYmTWEoZS1jLmNpcmNsZS54KTxEYSYmTWEoci1jLmNpcmNsZS5jeSk8RGE7KWE9Yy5OLG8ucHVzaChjKSxqZShjKSxjPWE7by5wdXNoKGMpLEJlKGMpO3ZhciBzLGY9by5sZW5ndGg7Zm9yKHM9MTtmPnM7KytzKWM9b1tzXSxsPW9bcy0xXSxucihjLmVkZ2UsbC5zaXRlLGMuc2l0ZSx1KTtsPW9bMF0sYz1vW2YtMV0sYy5lZGdlPUtlKGwuc2l0ZSxjLnNpdGUsbnVsbCx1KSwkZShsKSwkZShjKX1mdW5jdGlvbiBIZShuKXtmb3IodmFyIHQsZSxyLHUsaT1uLngsYT1uLnksbz1pbC5fO287KWlmKHI9T2UobyxhKS1pLHI+RGEpbz1vLkw7ZWxzZXtpZih1PWktSWUobyxhKSwhKHU+RGEpKXtyPi1EYT8odD1vLlAsZT1vKTp1Pi1EYT8odD1vLGU9by5OKTp0PWU9bzticmVha31pZighby5SKXt0PW87YnJlYWt9bz1vLlJ9dmFyIGw9VWUobik7aWYoaWwuaW5zZXJ0KHQsbCksdHx8ZSl7aWYodD09PWUpcmV0dXJuIEJlKHQpLGU9VWUodC5zaXRlKSxpbC5pbnNlcnQobCxlKSxsLmVkZ2U9ZS5lZGdlPUtlKHQuc2l0ZSxsLnNpdGUpLCRlKHQpLHZvaWQgJGUoZSk7aWYoIWUpcmV0dXJuIHZvaWQobC5lZGdlPUtlKHQuc2l0ZSxsLnNpdGUpKTtCZSh0KSxCZShlKTt2YXIgYz10LnNpdGUscz1jLngsZj1jLnksaD1uLngtcyxnPW4ueS1mLHA9ZS5zaXRlLHY9cC54LXMsZD1wLnktZixtPTIqKGgqZC1nKnYpLHk9aCpoK2cqZyxNPXYqditkKmQseD17eDooZCp5LWcqTSkvbStzLHk6KGgqTS12KnkpL20rZn07bnIoZS5lZGdlLGMscCx4KSxsLmVkZ2U9S2UoYyxuLG51bGwseCksZS5lZGdlPUtlKG4scCxudWxsLHgpLCRlKHQpLCRlKGUpfX1mdW5jdGlvbiBPZShuLHQpe3ZhciBlPW4uc2l0ZSxyPWUueCx1PWUueSxpPXUtdDtpZighaSlyZXR1cm4gcjt2YXIgYT1uLlA7aWYoIWEpcmV0dXJuLSgxLzApO2U9YS5zaXRlO3ZhciBvPWUueCxsPWUueSxjPWwtdDtpZighYylyZXR1cm4gbzt2YXIgcz1vLXIsZj0xL2ktMS9jLGg9cy9jO3JldHVybiBmPygtaCtNYXRoLnNxcnQoaCpoLTIqZioocypzLygtMipjKS1sK2MvMit1LWkvMikpKS9mK3I6KHIrbykvMn1mdW5jdGlvbiBJZShuLHQpe3ZhciBlPW4uTjtpZihlKXJldHVybiBPZShlLHQpO3ZhciByPW4uc2l0ZTtyZXR1cm4gci55PT09dD9yLng6MS8wfWZ1bmN0aW9uIFllKG4pe3RoaXMuc2l0ZT1uLHRoaXMuZWRnZXM9W119ZnVuY3Rpb24gWmUobil7Zm9yKHZhciB0LGUscix1LGksYSxvLGwsYyxzLGY9blswXVswXSxoPW5bMV1bMF0sZz1uWzBdWzFdLHA9blsxXVsxXSx2PXVsLGQ9di5sZW5ndGg7ZC0tOylpZihpPXZbZF0saSYmaS5wcmVwYXJlKCkpZm9yKG89aS5lZGdlcyxsPW8ubGVuZ3RoLGE9MDtsPmE7KXM9b1thXS5lbmQoKSxyPXMueCx1PXMueSxjPW9bKythJWxdLnN0YXJ0KCksdD1jLngsZT1jLnksKE1hKHItdCk+RGF8fE1hKHUtZSk+RGEpJiYoby5zcGxpY2UoYSwwLG5ldyB0cihRZShpLnNpdGUscyxNYShyLWYpPERhJiZwLXU+RGE/e3g6Zix5Ok1hKHQtZik8RGE/ZTpwfTpNYSh1LXApPERhJiZoLXI+RGE/e3g6TWEoZS1wKTxEYT90OmgseTpwfTpNYShyLWgpPERhJiZ1LWc+RGE/e3g6aCx5Ok1hKHQtaCk8RGE/ZTpnfTpNYSh1LWcpPERhJiZyLWY+RGE/e3g6TWEoZS1nKTxEYT90OmYseTpnfTpudWxsKSxpLnNpdGUsbnVsbCkpLCsrbCl9ZnVuY3Rpb24gVmUobix0KXtyZXR1cm4gdC5hbmdsZS1uLmFuZ2xlfWZ1bmN0aW9uIFhlKCl7cnIodGhpcyksdGhpcy54PXRoaXMueT10aGlzLmFyYz10aGlzLnNpdGU9dGhpcy5jeT1udWxsfWZ1bmN0aW9uICRlKG4pe3ZhciB0PW4uUCxlPW4uTjtpZih0JiZlKXt2YXIgcj10LnNpdGUsdT1uLnNpdGUsaT1lLnNpdGU7aWYociE9PWkpe3ZhciBhPXUueCxvPXUueSxsPXIueC1hLGM9ci55LW8scz1pLngtYSxmPWkueS1vLGg9MioobCpmLWMqcyk7aWYoIShoPj0tUGEpKXt2YXIgZz1sKmwrYypjLHA9cypzK2YqZix2PShmKmctYypwKS9oLGQ9KGwqcC1zKmcpL2gsZj1kK28sbT1jbC5wb3AoKXx8bmV3IFhlO20uYXJjPW4sbS5zaXRlPXUsbS54PXYrYSxtLnk9ZitNYXRoLnNxcnQodip2K2QqZCksbS5jeT1mLG4uY2lyY2xlPW07Zm9yKHZhciB5PW51bGwsTT1vbC5fO007KWlmKG0ueTxNLnl8fG0ueT09PU0ueSYmbS54PD1NLngpe2lmKCFNLkwpe3k9TS5QO2JyZWFrfU09TS5MfWVsc2V7aWYoIU0uUil7eT1NO2JyZWFrfU09TS5SfW9sLmluc2VydCh5LG0pLHl8fChhbD1tKX19fX1mdW5jdGlvbiBCZShuKXt2YXIgdD1uLmNpcmNsZTt0JiYodC5QfHwoYWw9dC5OKSxvbC5yZW1vdmUodCksY2wucHVzaCh0KSxycih0KSxuLmNpcmNsZT1udWxsKX1mdW5jdGlvbiBXZShuKXtmb3IodmFyIHQsZT1ybCxyPVl0KG5bMF1bMF0sblswXVsxXSxuWzFdWzBdLG5bMV1bMV0pLHU9ZS5sZW5ndGg7dS0tOyl0PWVbdV0sKCFKZSh0LG4pfHwhcih0KXx8TWEodC5hLngtdC5iLngpPERhJiZNYSh0LmEueS10LmIueSk8RGEpJiYodC5hPXQuYj1udWxsLGUuc3BsaWNlKHUsMSkpfWZ1bmN0aW9uIEplKG4sdCl7dmFyIGU9bi5iO2lmKGUpcmV0dXJuITA7dmFyIHIsdSxpPW4uYSxhPXRbMF1bMF0sbz10WzFdWzBdLGw9dFswXVsxXSxjPXRbMV1bMV0scz1uLmwsZj1uLnIsaD1zLngsZz1zLnkscD1mLngsdj1mLnksZD0oaCtwKS8yLG09KGcrdikvMjtpZih2PT09Zyl7aWYoYT5kfHxkPj1vKXJldHVybjtpZihoPnApe2lmKGkpe2lmKGkueT49YylyZXR1cm59ZWxzZSBpPXt4OmQseTpsfTtlPXt4OmQseTpjfX1lbHNle2lmKGkpe2lmKGkueTxsKXJldHVybn1lbHNlIGk9e3g6ZCx5OmN9O2U9e3g6ZCx5Omx9fX1lbHNlIGlmKHI9KGgtcCkvKHYtZyksdT1tLXIqZCwtMT5yfHxyPjEpaWYoaD5wKXtpZihpKXtpZihpLnk+PWMpcmV0dXJufWVsc2UgaT17eDoobC11KS9yLHk6bH07ZT17eDooYy11KS9yLHk6Y319ZWxzZXtpZihpKXtpZihpLnk8bClyZXR1cm59ZWxzZSBpPXt4OihjLXUpL3IseTpjfTtlPXt4OihsLXUpL3IseTpsfX1lbHNlIGlmKHY+Zyl7aWYoaSl7aWYoaS54Pj1vKXJldHVybn1lbHNlIGk9e3g6YSx5OnIqYSt1fTtlPXt4Om8seTpyKm8rdX19ZWxzZXtpZihpKXtpZihpLng8YSlyZXR1cm59ZWxzZSBpPXt4Om8seTpyKm8rdX07ZT17eDphLHk6ciphK3V9fXJldHVybiBuLmE9aSxuLmI9ZSwhMH1mdW5jdGlvbiBHZShuLHQpe3RoaXMubD1uLHRoaXMucj10LHRoaXMuYT10aGlzLmI9bnVsbH1mdW5jdGlvbiBLZShuLHQsZSxyKXt2YXIgdT1uZXcgR2Uobix0KTtyZXR1cm4gcmwucHVzaCh1KSxlJiZucih1LG4sdCxlKSxyJiZucih1LHQsbixyKSx1bFtuLmldLmVkZ2VzLnB1c2gobmV3IHRyKHUsbix0KSksdWxbdC5pXS5lZGdlcy5wdXNoKG5ldyB0cih1LHQsbikpLHV9ZnVuY3Rpb24gUWUobix0LGUpe3ZhciByPW5ldyBHZShuLG51bGwpO3JldHVybiByLmE9dCxyLmI9ZSxybC5wdXNoKHIpLHJ9ZnVuY3Rpb24gbnIobix0LGUscil7bi5hfHxuLmI/bi5sPT09ZT9uLmI9cjpuLmE9cjoobi5hPXIsbi5sPXQsbi5yPWUpfWZ1bmN0aW9uIHRyKG4sdCxlKXt2YXIgcj1uLmEsdT1uLmI7dGhpcy5lZGdlPW4sdGhpcy5zaXRlPXQsdGhpcy5hbmdsZT1lP01hdGguYXRhbjIoZS55LXQueSxlLngtdC54KTpuLmw9PT10P01hdGguYXRhbjIodS54LXIueCxyLnktdS55KTpNYXRoLmF0YW4yKHIueC11LngsdS55LXIueSl9ZnVuY3Rpb24gZXIoKXt0aGlzLl89bnVsbH1mdW5jdGlvbiBycihuKXtuLlU9bi5DPW4uTD1uLlI9bi5QPW4uTj1udWxsfWZ1bmN0aW9uIHVyKG4sdCl7dmFyIGU9dCxyPXQuUix1PWUuVTt1P3UuTD09PWU/dS5MPXI6dS5SPXI6bi5fPXIsci5VPXUsZS5VPXIsZS5SPXIuTCxlLlImJihlLlIuVT1lKSxyLkw9ZX1mdW5jdGlvbiBpcihuLHQpe3ZhciBlPXQscj10LkwsdT1lLlU7dT91Lkw9PT1lP3UuTD1yOnUuUj1yOm4uXz1yLHIuVT11LGUuVT1yLGUuTD1yLlIsZS5MJiYoZS5MLlU9ZSksci5SPWV9ZnVuY3Rpb24gYXIobil7Zm9yKDtuLkw7KW49bi5MO3JldHVybiBufWZ1bmN0aW9uIG9yKG4sdCl7dmFyIGUscix1LGk9bi5zb3J0KGxyKS5wb3AoKTtmb3Iocmw9W10sdWw9bmV3IEFycmF5KG4ubGVuZ3RoKSxpbD1uZXcgZXIsb2w9bmV3IGVyOzspaWYodT1hbCxpJiYoIXV8fGkueTx1Lnl8fGkueT09PXUueSYmaS54PHUueCkpKGkueCE9PWV8fGkueSE9PXIpJiYodWxbaS5pXT1uZXcgWWUoaSksSGUoaSksZT1pLngscj1pLnkpLGk9bi5wb3AoKTtlbHNle2lmKCF1KWJyZWFrO0ZlKHUuYXJjKX10JiYoV2UodCksWmUodCkpO3ZhciBhPXtjZWxsczp1bCxlZGdlczpybH07cmV0dXJuIGlsPW9sPXJsPXVsPW51bGwsYX1mdW5jdGlvbiBscihuLHQpe3JldHVybiB0Lnktbi55fHx0Lngtbi54fWZ1bmN0aW9uIGNyKG4sdCxlKXtyZXR1cm4obi54LWUueCkqKHQueS1uLnkpLShuLngtdC54KSooZS55LW4ueSl9ZnVuY3Rpb24gc3Iobil7cmV0dXJuIG4ueH1mdW5jdGlvbiBmcihuKXtyZXR1cm4gbi55fWZ1bmN0aW9uIGhyKCl7cmV0dXJue2xlYWY6ITAsbm9kZXM6W10scG9pbnQ6bnVsbCx4Om51bGwseTpudWxsfX1mdW5jdGlvbiBncihuLHQsZSxyLHUsaSl7aWYoIW4odCxlLHIsdSxpKSl7dmFyIGE9LjUqKGUrdSksbz0uNSoocitpKSxsPXQubm9kZXM7bFswXSYmZ3IobixsWzBdLGUscixhLG8pLGxbMV0mJmdyKG4sbFsxXSxhLHIsdSxvKSxsWzJdJiZncihuLGxbMl0sZSxvLGEsaSksbFszXSYmZ3IobixsWzNdLGEsbyx1LGkpfX1mdW5jdGlvbiBwcihuLHQsZSxyLHUsaSxhKXt2YXIgbyxsPTEvMDtyZXR1cm4gZnVuY3Rpb24gYyhuLHMsZixoLGcpe2lmKCEocz5pfHxmPmF8fHI+aHx8dT5nKSl7aWYocD1uLnBvaW50KXt2YXIgcCx2PXQtbi54LGQ9ZS1uLnksbT12KnYrZCpkO2lmKGw+bSl7dmFyIHk9TWF0aC5zcXJ0KGw9bSk7cj10LXksdT1lLXksaT10K3ksYT1lK3ksbz1wfX1mb3IodmFyIE09bi5ub2Rlcyx4PS41KihzK2gpLGI9LjUqKGYrZyksXz10Pj14LHc9ZT49YixTPXc8PDF8XyxrPVMrNDtrPlM7KytTKWlmKG49TVszJlNdKXN3aXRjaCgzJlMpe2Nhc2UgMDpjKG4scyxmLHgsYik7YnJlYWs7Y2FzZSAxOmMobix4LGYsaCxiKTticmVhaztjYXNlIDI6YyhuLHMsYix4LGcpO2JyZWFrO2Nhc2UgMzpjKG4seCxiLGgsZyl9fX0obixyLHUsaSxhKSxvfWZ1bmN0aW9uIHZyKG4sdCl7bj1vYS5yZ2IobiksdD1vYS5yZ2IodCk7dmFyIGU9bi5yLHI9bi5nLHU9bi5iLGk9dC5yLWUsYT10LmctcixvPXQuYi11O3JldHVybiBmdW5jdGlvbihuKXtyZXR1cm4iIyIrYm4oTWF0aC5yb3VuZChlK2kqbikpK2JuKE1hdGgucm91bmQocithKm4pKStibihNYXRoLnJvdW5kKHUrbypuKSl9fWZ1bmN0aW9uIGRyKG4sdCl7dmFyIGUscj17fSx1PXt9O2ZvcihlIGluIG4pZSBpbiB0P3JbZV09TXIobltlXSx0W2VdKTp1W2VdPW5bZV07Zm9yKGUgaW4gdCllIGluIG58fCh1W2VdPXRbZV0pO3JldHVybiBmdW5jdGlvbihuKXtmb3IoZSBpbiByKXVbZV09cltlXShuKTtyZXR1cm4gdX19ZnVuY3Rpb24gbXIobix0KXtyZXR1cm4gbj0rbix0PSt0LGZ1bmN0aW9uKGUpe3JldHVybiBuKigxLWUpK3QqZX19ZnVuY3Rpb24geXIobix0KXt2YXIgZSxyLHUsaT1mbC5sYXN0SW5kZXg9aGwubGFzdEluZGV4PTAsYT0tMSxvPVtdLGw9W107Zm9yKG4rPSIiLHQrPSIiOyhlPWZsLmV4ZWMobikpJiYocj1obC5leGVjKHQpKTspKHU9ci5pbmRleCk+aSYmKHU9dC5zbGljZShpLHUpLG9bYV0/b1thXSs9dTpvWysrYV09dSksKGU9ZVswXSk9PT0ocj1yWzBdKT9vW2FdP29bYV0rPXI6b1srK2FdPXI6KG9bKythXT1udWxsLGwucHVzaCh7aTphLHg6bXIoZSxyKX0pKSxpPWhsLmxhc3RJbmRleDtyZXR1cm4gaTx0Lmxlbmd0aCYmKHU9dC5zbGljZShpKSxvW2FdP29bYV0rPXU6b1srK2FdPXUpLG8ubGVuZ3RoPDI/bFswXT8odD1sWzBdLngsZnVuY3Rpb24obil7cmV0dXJuIHQobikrIiJ9KTpmdW5jdGlvbigpe3JldHVybiB0fToodD1sLmxlbmd0aCxmdW5jdGlvbihuKXtmb3IodmFyIGUscj0wO3Q+cjsrK3Ipb1soZT1sW3JdKS5pXT1lLngobik7cmV0dXJuIG8uam9pbigiIil9KX1mdW5jdGlvbiBNcihuLHQpe2Zvcih2YXIgZSxyPW9hLmludGVycG9sYXRvcnMubGVuZ3RoOy0tcj49MCYmIShlPW9hLmludGVycG9sYXRvcnNbcl0obix0KSk7KTtyZXR1cm4gZX1mdW5jdGlvbiB4cihuLHQpe3ZhciBlLHI9W10sdT1bXSxpPW4ubGVuZ3RoLGE9dC5sZW5ndGgsbz1NYXRoLm1pbihuLmxlbmd0aCx0Lmxlbmd0aCk7Zm9yKGU9MDtvPmU7KytlKXIucHVzaChNcihuW2VdLHRbZV0pKTtmb3IoO2k+ZTsrK2UpdVtlXT1uW2VdO2Zvcig7YT5lOysrZSl1W2VdPXRbZV07cmV0dXJuIGZ1bmN0aW9uKG4pe2ZvcihlPTA7bz5lOysrZSl1W2VdPXJbZV0obik7cmV0dXJuIHV9fWZ1bmN0aW9uIGJyKG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gMD49dD8wOnQ+PTE/MTpuKHQpfX1mdW5jdGlvbiBfcihuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDEtbigxLXQpfX1mdW5jdGlvbiB3cihuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuLjUqKC41PnQ/bigyKnQpOjItbigyLTIqdCkpfX1mdW5jdGlvbiBTcihuKXtyZXR1cm4gbipufWZ1bmN0aW9uIGtyKG4pe3JldHVybiBuKm4qbn1mdW5jdGlvbiBOcihuKXtpZigwPj1uKXJldHVybiAwO2lmKG4+PTEpcmV0dXJuIDE7dmFyIHQ9bipuLGU9dCpuO3JldHVybiA0KiguNT5uP2U6Myoobi10KStlLS43NSl9ZnVuY3Rpb24gRXIobil7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLnBvdyh0LG4pfX1mdW5jdGlvbiBBcihuKXtyZXR1cm4gMS1NYXRoLmNvcyhuKkhhKX1mdW5jdGlvbiBDcihuKXtyZXR1cm4gTWF0aC5wb3coMiwxMCoobi0xKSl9ZnVuY3Rpb24genIobil7cmV0dXJuIDEtTWF0aC5zcXJ0KDEtbipuKX1mdW5jdGlvbiBMcihuLHQpe3ZhciBlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PS40NSksYXJndW1lbnRzLmxlbmd0aD9lPXQvamEqTWF0aC5hc2luKDEvbik6KG49MSxlPXQvNCksZnVuY3Rpb24ocil7cmV0dXJuIDErbipNYXRoLnBvdygyLC0xMCpyKSpNYXRoLnNpbigoci1lKSpqYS90KX19ZnVuY3Rpb24gcXIobil7cmV0dXJuIG58fChuPTEuNzAxNTgpLGZ1bmN0aW9uKHQpe3JldHVybiB0KnQqKChuKzEpKnQtbil9fWZ1bmN0aW9uIFRyKG4pe3JldHVybiAxLzIuNzU+bj83LjU2MjUqbipuOjIvMi43NT5uPzcuNTYyNSoobi09MS41LzIuNzUpKm4rLjc1OjIuNS8yLjc1Pm4/Ny41NjI1KihuLT0yLjI1LzIuNzUpKm4rLjkzNzU6Ny41NjI1KihuLT0yLjYyNS8yLjc1KSpuKy45ODQzNzV9ZnVuY3Rpb24gUnIobix0KXtuPW9hLmhjbChuKSx0PW9hLmhjbCh0KTt2YXIgZT1uLmgscj1uLmMsdT1uLmwsaT10LmgtZSxhPXQuYy1yLG89dC5sLXU7cmV0dXJuIGlzTmFOKGEpJiYoYT0wLHI9aXNOYU4ocik/dC5jOnIpLGlzTmFOKGkpPyhpPTAsZT1pc05hTihlKT90Lmg6ZSk6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGZuKGUraSpuLHIrYSpuLHUrbypuKSsiIn19ZnVuY3Rpb24gRHIobix0KXtuPW9hLmhzbChuKSx0PW9hLmhzbCh0KTt2YXIgZT1uLmgscj1uLnMsdT1uLmwsaT10LmgtZSxhPXQucy1yLG89dC5sLXU7cmV0dXJuIGlzTmFOKGEpJiYoYT0wLHI9aXNOYU4ocik/dC5zOnIpLGlzTmFOKGkpPyhpPTAsZT1pc05hTihlKT90Lmg6ZSk6aT4xODA/aS09MzYwOi0xODA+aSYmKGkrPTM2MCksZnVuY3Rpb24obil7cmV0dXJuIGNuKGUraSpuLHIrYSpuLHUrbypuKSsiIn19ZnVuY3Rpb24gUHIobix0KXtuPW9hLmxhYihuKSx0PW9hLmxhYih0KTt2YXIgZT1uLmwscj1uLmEsdT1uLmIsaT10LmwtZSxhPXQuYS1yLG89dC5iLXU7cmV0dXJuIGZ1bmN0aW9uKG4pe3JldHVybiBnbihlK2kqbixyK2Eqbix1K28qbikrIiJ9fWZ1bmN0aW9uIFVyKG4sdCl7cmV0dXJuIHQtPW4sZnVuY3Rpb24oZSl7cmV0dXJuIE1hdGgucm91bmQobit0KmUpfX1mdW5jdGlvbiBqcihuKXt2YXIgdD1bbi5hLG4uYl0sZT1bbi5jLG4uZF0scj1Icih0KSx1PUZyKHQsZSksaT1IcihPcihlLHQsLXUpKXx8MDt0WzBdKmVbMV08ZVswXSp0WzFdJiYodFswXSo9LTEsdFsxXSo9LTEscio9LTEsdSo9LTEpLHRoaXMucm90YXRlPShyP01hdGguYXRhbjIodFsxXSx0WzBdKTpNYXRoLmF0YW4yKC1lWzBdLGVbMV0pKSpJYSx0aGlzLnRyYW5zbGF0ZT1bbi5lLG4uZl0sdGhpcy5zY2FsZT1bcixpXSx0aGlzLnNrZXc9aT9NYXRoLmF0YW4yKHUsaSkqSWE6MH1mdW5jdGlvbiBGcihuLHQpe3JldHVybiBuWzBdKnRbMF0rblsxXSp0WzFdfWZ1bmN0aW9uIEhyKG4pe3ZhciB0PU1hdGguc3FydChGcihuLG4pKTtyZXR1cm4gdCYmKG5bMF0vPXQsblsxXS89dCksdH1mdW5jdGlvbiBPcihuLHQsZSl7cmV0dXJuIG5bMF0rPWUqdFswXSxuWzFdKz1lKnRbMV0sbn1mdW5jdGlvbiBJcihuKXtyZXR1cm4gbi5sZW5ndGg/bi5wb3AoKSsiLCI6IiJ9ZnVuY3Rpb24gWXIobix0LGUscil7aWYoblswXSE9PXRbMF18fG5bMV0hPT10WzFdKXt2YXIgdT1lLnB1c2goInRyYW5zbGF0ZSgiLG51bGwsIiwiLG51bGwsIikiKTtyLnB1c2goe2k6dS00LHg6bXIoblswXSx0WzBdKX0se2k6dS0yLHg6bXIoblsxXSx0WzFdKX0pfWVsc2UodFswXXx8dFsxXSkmJmUucHVzaCgidHJhbnNsYXRlKCIrdCsiKSIpfWZ1bmN0aW9uIFpyKG4sdCxlLHIpe24hPT10PyhuLXQ+MTgwP3QrPTM2MDp0LW4+MTgwJiYobis9MzYwKSxyLnB1c2goe2k6ZS5wdXNoKElyKGUpKyJyb3RhdGUoIixudWxsLCIpIiktMix4Om1yKG4sdCl9KSk6dCYmZS5wdXNoKElyKGUpKyJyb3RhdGUoIit0KyIpIil9ZnVuY3Rpb24gVnIobix0LGUscil7biE9PXQ/ci5wdXNoKHtpOmUucHVzaChJcihlKSsic2tld1goIixudWxsLCIpIiktMix4Om1yKG4sdCl9KTp0JiZlLnB1c2goSXIoZSkrInNrZXdYKCIrdCsiKSIpfWZ1bmN0aW9uIFhyKG4sdCxlLHIpe2lmKG5bMF0hPT10WzBdfHxuWzFdIT09dFsxXSl7dmFyIHU9ZS5wdXNoKElyKGUpKyJzY2FsZSgiLG51bGwsIiwiLG51bGwsIikiKTtyLnB1c2goe2k6dS00LHg6bXIoblswXSx0WzBdKX0se2k6dS0yLHg6bXIoblsxXSx0WzFdKX0pfWVsc2UoMSE9PXRbMF18fDEhPT10WzFdKSYmZS5wdXNoKElyKGUpKyJzY2FsZSgiK3QrIikiKX1mdW5jdGlvbiAkcihuLHQpe3ZhciBlPVtdLHI9W107cmV0dXJuIG49b2EudHJhbnNmb3JtKG4pLHQ9b2EudHJhbnNmb3JtKHQpLFlyKG4udHJhbnNsYXRlLHQudHJhbnNsYXRlLGUsciksWnIobi5yb3RhdGUsdC5yb3RhdGUsZSxyKSxWcihuLnNrZXcsdC5za2V3LGUsciksWHIobi5zY2FsZSx0LnNjYWxlLGUsciksbj10PW51bGwsZnVuY3Rpb24obil7Zm9yKHZhciB0LHU9LTEsaT1yLmxlbmd0aDsrK3U8aTspZVsodD1yW3VdKS5pXT10Lngobik7cmV0dXJuIGUuam9pbigiIil9fWZ1bmN0aW9uIEJyKG4sdCl7cmV0dXJuIHQ9KHQtPW49K24pfHwxL3QsZnVuY3Rpb24oZSl7cmV0dXJuKGUtbikvdH19ZnVuY3Rpb24gV3Iobix0KXtyZXR1cm4gdD0odC09bj0rbil8fDEvdCxmdW5jdGlvbihlKXtyZXR1cm4gTWF0aC5tYXgoMCxNYXRoLm1pbigxLChlLW4pL3QpKX19ZnVuY3Rpb24gSnIobil7Zm9yKHZhciB0PW4uc291cmNlLGU9bi50YXJnZXQscj1Lcih0LGUpLHU9W3RdO3QhPT1yOyl0PXQucGFyZW50LHUucHVzaCh0KTtmb3IodmFyIGk9dS5sZW5ndGg7ZSE9PXI7KXUuc3BsaWNlKGksMCxlKSxlPWUucGFyZW50O3JldHVybiB1fWZ1bmN0aW9uIEdyKG4pe2Zvcih2YXIgdD1bXSxlPW4ucGFyZW50O251bGwhPWU7KXQucHVzaChuKSxuPWUsZT1lLnBhcmVudDtyZXR1cm4gdC5wdXNoKG4pLHR9ZnVuY3Rpb24gS3Iobix0KXtpZihuPT09dClyZXR1cm4gbjtmb3IodmFyIGU9R3Iobikscj1Hcih0KSx1PWUucG9wKCksaT1yLnBvcCgpLGE9bnVsbDt1PT09aTspYT11LHU9ZS5wb3AoKSxpPXIucG9wKCk7cmV0dXJuIGF9ZnVuY3Rpb24gUXIobil7bi5maXhlZHw9Mn1mdW5jdGlvbiBudShuKXtuLmZpeGVkJj0tN31mdW5jdGlvbiB0dShuKXtuLmZpeGVkfD00LG4ucHg9bi54LG4ucHk9bi55fWZ1bmN0aW9uIGV1KG4pe24uZml4ZWQmPS01fWZ1bmN0aW9uIHJ1KG4sdCxlKXt2YXIgcj0wLHU9MDtpZihuLmNoYXJnZT0wLCFuLmxlYWYpZm9yKHZhciBpLGE9bi5ub2RlcyxvPWEubGVuZ3RoLGw9LTE7KytsPG87KWk9YVtsXSxudWxsIT1pJiYocnUoaSx0LGUpLG4uY2hhcmdlKz1pLmNoYXJnZSxyKz1pLmNoYXJnZSppLmN4LHUrPWkuY2hhcmdlKmkuY3kpO2lmKG4ucG9pbnQpe24ubGVhZnx8KG4ucG9pbnQueCs9TWF0aC5yYW5kb20oKS0uNSxuLnBvaW50LnkrPU1hdGgucmFuZG9tKCktLjUpO3ZhciBjPXQqZVtuLnBvaW50LmluZGV4XTtuLmNoYXJnZSs9bi5wb2ludENoYXJnZT1jLHIrPWMqbi5wb2ludC54LHUrPWMqbi5wb2ludC55fW4uY3g9ci9uLmNoYXJnZSxuLmN5PXUvbi5jaGFyZ2V9ZnVuY3Rpb24gdXUobix0KXtyZXR1cm4gb2EucmViaW5kKG4sdCwic29ydCIsImNoaWxkcmVuIiwidmFsdWUiKSxuLm5vZGVzPW4sbi5saW5rcz1zdSxufWZ1bmN0aW9uIGl1KG4sdCl7Zm9yKHZhciBlPVtuXTtudWxsIT0obj1lLnBvcCgpKTspaWYodChuKSwodT1uLmNoaWxkcmVuKSYmKHI9dS5sZW5ndGgpKWZvcih2YXIgcix1Oy0tcj49MDspZS5wdXNoKHVbcl0pfWZ1bmN0aW9uIGF1KG4sdCl7Zm9yKHZhciBlPVtuXSxyPVtdO251bGwhPShuPWUucG9wKCkpOylpZihyLnB1c2gobiksKGk9bi5jaGlsZHJlbikmJih1PWkubGVuZ3RoKSlmb3IodmFyIHUsaSxhPS0xOysrYTx1OyllLnB1c2goaVthXSk7Zm9yKDtudWxsIT0obj1yLnBvcCgpKTspdChuKX1mdW5jdGlvbiBvdShuKXtyZXR1cm4gbi5jaGlsZHJlbn1mdW5jdGlvbiBsdShuKXtyZXR1cm4gbi52YWx1ZX1mdW5jdGlvbiBjdShuLHQpe3JldHVybiB0LnZhbHVlLW4udmFsdWV9ZnVuY3Rpb24gc3Uobil7cmV0dXJuIG9hLm1lcmdlKG4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybihuLmNoaWxkcmVufHxbXSkubWFwKGZ1bmN0aW9uKHQpe3JldHVybntzb3VyY2U6bix0YXJnZXQ6dH19KX0pKX1mdW5jdGlvbiBmdShuKXtyZXR1cm4gbi54fWZ1bmN0aW9uIGh1KG4pe3JldHVybiBuLnl9ZnVuY3Rpb24gZ3Uobix0LGUpe24ueTA9dCxuLnk9ZX1mdW5jdGlvbiBwdShuKXtyZXR1cm4gb2EucmFuZ2Uobi5sZW5ndGgpfWZ1bmN0aW9uIHZ1KG4pe2Zvcih2YXIgdD0tMSxlPW5bMF0ubGVuZ3RoLHI9W107Kyt0PGU7KXJbdF09MDtyZXR1cm4gcn1mdW5jdGlvbiBkdShuKXtmb3IodmFyIHQsZT0xLHI9MCx1PW5bMF1bMV0saT1uLmxlbmd0aDtpPmU7KytlKSh0PW5bZV1bMV0pPnUmJihyPWUsdT10KTtyZXR1cm4gcn1mdW5jdGlvbiBtdShuKXtyZXR1cm4gbi5yZWR1Y2UoeXUsMCl9ZnVuY3Rpb24geXUobix0KXtyZXR1cm4gbit0WzFdfWZ1bmN0aW9uIE11KG4sdCl7cmV0dXJuIHh1KG4sTWF0aC5jZWlsKE1hdGgubG9nKHQubGVuZ3RoKS9NYXRoLkxOMisxKSl9ZnVuY3Rpb24geHUobix0KXtmb3IodmFyIGU9LTEscj0rblswXSx1PShuWzFdLXIpL3QsaT1bXTsrK2U8PXQ7KWlbZV09dSplK3I7cmV0dXJuIGl9ZnVuY3Rpb24gYnUobil7cmV0dXJuW29hLm1pbihuKSxvYS5tYXgobildfWZ1bmN0aW9uIF91KG4sdCl7cmV0dXJuIG4udmFsdWUtdC52YWx1ZX1mdW5jdGlvbiB3dShuLHQpe3ZhciBlPW4uX3BhY2tfbmV4dDtuLl9wYWNrX25leHQ9dCx0Ll9wYWNrX3ByZXY9bix0Ll9wYWNrX25leHQ9ZSxlLl9wYWNrX3ByZXY9dH1mdW5jdGlvbiBTdShuLHQpe24uX3BhY2tfbmV4dD10LHQuX3BhY2tfcHJldj1ufWZ1bmN0aW9uIGt1KG4sdCl7dmFyIGU9dC54LW4ueCxyPXQueS1uLnksdT1uLnIrdC5yO3JldHVybi45OTkqdSp1PmUqZStyKnJ9ZnVuY3Rpb24gTnUobil7ZnVuY3Rpb24gdChuKXtzPU1hdGgubWluKG4ueC1uLnIscyksZj1NYXRoLm1heChuLngrbi5yLGYpLGg9TWF0aC5taW4obi55LW4ucixoKSxnPU1hdGgubWF4KG4ueStuLnIsZyl9aWYoKGU9bi5jaGlsZHJlbikmJihjPWUubGVuZ3RoKSl7dmFyIGUscix1LGksYSxvLGwsYyxzPTEvMCxmPS0oMS8wKSxoPTEvMCxnPS0oMS8wKTtpZihlLmZvckVhY2goRXUpLHI9ZVswXSxyLng9LXIucixyLnk9MCx0KHIpLGM+MSYmKHU9ZVsxXSx1Lng9dS5yLHUueT0wLHQodSksYz4yKSlmb3IoaT1lWzJdLHp1KHIsdSxpKSx0KGkpLHd1KHIsaSksci5fcGFja19wcmV2PWksd3UoaSx1KSx1PXIuX3BhY2tfbmV4dCxhPTM7Yz5hO2ErKyl7enUocix1LGk9ZVthXSk7dmFyIHA9MCx2PTEsZD0xO2ZvcihvPXUuX3BhY2tfbmV4dDtvIT09dTtvPW8uX3BhY2tfbmV4dCx2KyspaWYoa3UobyxpKSl7cD0xO2JyZWFrfWlmKDE9PXApZm9yKGw9ci5fcGFja19wcmV2O2whPT1vLl9wYWNrX3ByZXYmJiFrdShsLGkpO2w9bC5fcGFja19wcmV2LGQrKyk7cD8oZD52fHx2PT1kJiZ1LnI8ci5yP1N1KHIsdT1vKTpTdShyPWwsdSksYS0tKTood3UocixpKSx1PWksdChpKSl9dmFyIG09KHMrZikvMix5PShoK2cpLzIsTT0wO2ZvcihhPTA7Yz5hO2ErKylpPWVbYV0saS54LT1tLGkueS09eSxNPU1hdGgubWF4KE0saS5yK01hdGguc3FydChpLngqaS54K2kueSppLnkpKTtuLnI9TSxlLmZvckVhY2goQXUpfX1mdW5jdGlvbiBFdShuKXtuLl9wYWNrX25leHQ9bi5fcGFja19wcmV2PW59ZnVuY3Rpb24gQXUobil7ZGVsZXRlIG4uX3BhY2tfbmV4dCxkZWxldGUgbi5fcGFja19wcmV2fWZ1bmN0aW9uIEN1KG4sdCxlLHIpe3ZhciB1PW4uY2hpbGRyZW47aWYobi54PXQrPXIqbi54LG4ueT1lKz1yKm4ueSxuLnIqPXIsdSlmb3IodmFyIGk9LTEsYT11Lmxlbmd0aDsrK2k8YTspQ3UodVtpXSx0LGUscil9ZnVuY3Rpb24genUobix0LGUpe3ZhciByPW4ucitlLnIsdT10Lngtbi54LGk9dC55LW4ueTtpZihyJiYodXx8aSkpe3ZhciBhPXQucitlLnIsbz11KnUraSppO2EqPWEscio9cjt2YXIgbD0uNSsoci1hKS8oMipvKSxjPU1hdGguc3FydChNYXRoLm1heCgwLDIqYSoocitvKS0oci09bykqci1hKmEpKS8oMipvKTtlLng9bi54K2wqdStjKmksZS55PW4ueStsKmktYyp1fWVsc2UgZS54PW4ueCtyLGUueT1uLnl9ZnVuY3Rpb24gTHUobix0KXtyZXR1cm4gbi5wYXJlbnQ9PXQucGFyZW50PzE6Mn1mdW5jdGlvbiBxdShuKXt2YXIgdD1uLmNoaWxkcmVuO3JldHVybiB0Lmxlbmd0aD90WzBdOm4udH1mdW5jdGlvbiBUdShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuKHQ9ZS5sZW5ndGgpP2VbdC0xXTpuLnR9ZnVuY3Rpb24gUnUobix0LGUpe3ZhciByPWUvKHQuaS1uLmkpO3QuYy09cix0LnMrPWUsbi5jKz1yLHQueis9ZSx0Lm0rPWV9ZnVuY3Rpb24gRHUobil7Zm9yKHZhciB0LGU9MCxyPTAsdT1uLmNoaWxkcmVuLGk9dS5sZW5ndGg7LS1pPj0wOyl0PXVbaV0sdC56Kz1lLHQubSs9ZSxlKz10LnMrKHIrPXQuYyl9ZnVuY3Rpb24gUHUobix0LGUpe3JldHVybiBuLmEucGFyZW50PT09dC5wYXJlbnQ/bi5hOmV9ZnVuY3Rpb24gVXUobil7cmV0dXJuIDErb2EubWF4KG4sZnVuY3Rpb24obil7cmV0dXJuIG4ueX0pfWZ1bmN0aW9uIGp1KG4pe3JldHVybiBuLnJlZHVjZShmdW5jdGlvbihuLHQpe3JldHVybiBuK3QueH0sMCkvbi5sZW5ndGh9ZnVuY3Rpb24gRnUobil7dmFyIHQ9bi5jaGlsZHJlbjtyZXR1cm4gdCYmdC5sZW5ndGg/RnUodFswXSk6bn1mdW5jdGlvbiBIdShuKXt2YXIgdCxlPW4uY2hpbGRyZW47cmV0dXJuIGUmJih0PWUubGVuZ3RoKT9IdShlW3QtMV0pOm59ZnVuY3Rpb24gT3Uobil7cmV0dXJue3g6bi54LHk6bi55LGR4Om4uZHgsZHk6bi5keX19ZnVuY3Rpb24gSXUobix0KXt2YXIgZT1uLngrdFszXSxyPW4ueSt0WzBdLHU9bi5keC10WzFdLXRbM10saT1uLmR5LXRbMF0tdFsyXTtyZXR1cm4gMD51JiYoZSs9dS8yLHU9MCksMD5pJiYocis9aS8yLGk9MCkse3g6ZSx5OnIsZHg6dSxkeTppfX1mdW5jdGlvbiBZdShuKXt2YXIgdD1uWzBdLGU9bltuLmxlbmd0aC0xXTtyZXR1cm4gZT50P1t0LGVdOltlLHRdfWZ1bmN0aW9uIFp1KG4pe3JldHVybiBuLnJhbmdlRXh0ZW50P24ucmFuZ2VFeHRlbnQoKTpZdShuLnJhbmdlKCkpfWZ1bmN0aW9uIFZ1KG4sdCxlLHIpe3ZhciB1PWUoblswXSxuWzFdKSxpPXIodFswXSx0WzFdKTtyZXR1cm4gZnVuY3Rpb24obil7cmV0dXJuIGkodShuKSl9fWZ1bmN0aW9uIFh1KG4sdCl7dmFyIGUscj0wLHU9bi5sZW5ndGgtMSxpPW5bcl0sYT1uW3VdO3JldHVybiBpPmEmJihlPXIscj11LHU9ZSxlPWksaT1hLGE9ZSksbltyXT10LmZsb29yKGkpLG5bdV09dC5jZWlsKGEpLG59ZnVuY3Rpb24gJHUobil7cmV0dXJuIG4/e2Zsb29yOmZ1bmN0aW9uKHQpe3JldHVybiBNYXRoLmZsb29yKHQvbikqbn0sY2VpbDpmdW5jdGlvbih0KXtyZXR1cm4gTWF0aC5jZWlsKHQvbikqbn19OndsfWZ1bmN0aW9uIEJ1KG4sdCxlLHIpe3ZhciB1PVtdLGk9W10sYT0wLG89TWF0aC5taW4obi5sZW5ndGgsdC5sZW5ndGgpLTE7Zm9yKG5bb108blswXSYmKG49bi5zbGljZSgpLnJldmVyc2UoKSx0PXQuc2xpY2UoKS5yZXZlcnNlKCkpOysrYTw9bzspdS5wdXNoKGUoblthLTFdLG5bYV0pKSxpLnB1c2gocih0W2EtMV0sdFthXSkpO3JldHVybiBmdW5jdGlvbih0KXt2YXIgZT1vYS5iaXNlY3Qobix0LDEsbyktMTtyZXR1cm4gaVtlXSh1W2VdKHQpKX19ZnVuY3Rpb24gV3Uobix0LGUscil7ZnVuY3Rpb24gdSgpe3ZhciB1PU1hdGgubWluKG4ubGVuZ3RoLHQubGVuZ3RoKT4yP0J1OlZ1LGw9cj9XcjpCcjtyZXR1cm4gYT11KG4sdCxsLGUpLG89dSh0LG4sbCxNciksaX1mdW5jdGlvbiBpKG4pe3JldHVybiBhKG4pfXZhciBhLG87cmV0dXJuIGkuaW52ZXJ0PWZ1bmN0aW9uKG4pe3JldHVybiBvKG4pfSxpLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10Lm1hcChOdW1iZXIpLHUoKSk6bn0saS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1uLHUoKSk6dH0saS5yYW5nZVJvdW5kPWZ1bmN0aW9uKG4pe3JldHVybiBpLnJhbmdlKG4pLmludGVycG9sYXRlKFVyKX0saS5jbGFtcD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHUoKSk6cn0saS5pbnRlcnBvbGF0ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHUoKSk6ZX0saS50aWNrcz1mdW5jdGlvbih0KXtyZXR1cm4gUXUobix0KX0saS50aWNrRm9ybWF0PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5pKG4sdCxlKX0saS5uaWNlPWZ1bmN0aW9uKHQpe3JldHVybiBHdShuLHQpLHUoKX0saS5jb3B5PWZ1bmN0aW9uKCl7cmV0dXJuIFd1KG4sdCxlLHIpfSx1KCl9ZnVuY3Rpb24gSnUobix0KXtyZXR1cm4gb2EucmViaW5kKG4sdCwicmFuZ2UiLCJyYW5nZVJvdW5kIiwiaW50ZXJwb2xhdGUiLCJjbGFtcCIpfWZ1bmN0aW9uIEd1KG4sdCl7cmV0dXJuIFh1KG4sJHUoS3Uobix0KVsyXSkpLFh1KG4sJHUoS3Uobix0KVsyXSkpLG59ZnVuY3Rpb24gS3Uobix0KXtudWxsPT10JiYodD0xMCk7dmFyIGU9WXUobikscj1lWzFdLWVbMF0sdT1NYXRoLnBvdygxMCxNYXRoLmZsb29yKE1hdGgubG9nKHIvdCkvTWF0aC5MTjEwKSksaT10L3IqdTtyZXR1cm4uMTU+PWk/dSo9MTA6LjM1Pj1pP3UqPTU6Ljc1Pj1pJiYodSo9MiksZVswXT1NYXRoLmNlaWwoZVswXS91KSp1LGVbMV09TWF0aC5mbG9vcihlWzFdL3UpKnUrLjUqdSxlWzJdPXUsZX1mdW5jdGlvbiBRdShuLHQpe3JldHVybiBvYS5yYW5nZS5hcHBseShvYSxLdShuLHQpKX1mdW5jdGlvbiBuaShuLHQsZSl7dmFyIHI9S3Uobix0KTtpZihlKXt2YXIgdT1zby5leGVjKGUpO2lmKHUuc2hpZnQoKSwicyI9PT11WzhdKXt2YXIgaT1vYS5mb3JtYXRQcmVmaXgoTWF0aC5tYXgoTWEoclswXSksTWEoclsxXSkpKTtyZXR1cm4gdVs3XXx8KHVbN109Ii4iK3RpKGkuc2NhbGUoclsyXSkpKSx1WzhdPSJmIixlPW9hLmZvcm1hdCh1LmpvaW4oIiIpKSxmdW5jdGlvbihuKXtyZXR1cm4gZShpLnNjYWxlKG4pKStpLnN5bWJvbH19dVs3XXx8KHVbN109Ii4iK2VpKHVbOF0scikpLGU9dS5qb2luKCIiKX1lbHNlIGU9IiwuIit0aShyWzJdKSsiZiI7cmV0dXJuIG9hLmZvcm1hdChlKX1mdW5jdGlvbiB0aShuKXtyZXR1cm4tTWF0aC5mbG9vcihNYXRoLmxvZyhuKS9NYXRoLkxOMTArLjAxKX1mdW5jdGlvbiBlaShuLHQpe3ZhciBlPXRpKHRbMl0pO3JldHVybiBuIGluIFNsP01hdGguYWJzKGUtdGkoTWF0aC5tYXgoTWEodFswXSksTWEodFsxXSkpKSkrICsoImUiIT09bik6ZS0yKigiJSI9PT1uKX1mdW5jdGlvbiByaShuLHQsZSxyKXtmdW5jdGlvbiB1KG4pe3JldHVybihlP01hdGgubG9nKDA+bj8wOm4pOi1NYXRoLmxvZyhuPjA/MDotbikpL01hdGgubG9nKHQpfWZ1bmN0aW9uIGkobil7cmV0dXJuIGU/TWF0aC5wb3codCxuKTotTWF0aC5wb3codCwtbil9ZnVuY3Rpb24gYSh0KXtyZXR1cm4gbih1KHQpKX1yZXR1cm4gYS5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxhLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10WzBdPj0wLG4uZG9tYWluKChyPXQubWFwKE51bWJlcikpLm1hcCh1KSksYSk6cn0sYS5iYXNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PStlLG4uZG9tYWluKHIubWFwKHUpKSxhKTp0fSxhLm5pY2U9ZnVuY3Rpb24oKXt2YXIgdD1YdShyLm1hcCh1KSxlP01hdGg6TmwpO3JldHVybiBuLmRvbWFpbih0KSxyPXQubWFwKGkpLGF9LGEudGlja3M9ZnVuY3Rpb24oKXt2YXIgbj1ZdShyKSxhPVtdLG89blswXSxsPW5bMV0sYz1NYXRoLmZsb29yKHUobykpLHM9TWF0aC5jZWlsKHUobCkpLGY9dCUxPzI6dDtpZihpc0Zpbml0ZShzLWMpKXtpZihlKXtmb3IoO3M+YztjKyspZm9yKHZhciBoPTE7Zj5oO2grKylhLnB1c2goaShjKSpoKTthLnB1c2goaShjKSl9ZWxzZSBmb3IoYS5wdXNoKGkoYykpO2MrKzxzOylmb3IodmFyIGg9Zi0xO2g+MDtoLS0pYS5wdXNoKGkoYykqaCk7Zm9yKGM9MDthW2NdPG87YysrKTtmb3Iocz1hLmxlbmd0aDthW3MtMV0+bDtzLS0pO2E9YS5zbGljZShjLHMpfXJldHVybiBhfSxhLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obixlKXtpZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4ga2w7YXJndW1lbnRzLmxlbmd0aDwyP2U9a2w6ImZ1bmN0aW9uIiE9dHlwZW9mIGUmJihlPW9hLmZvcm1hdChlKSk7dmFyIHI9TWF0aC5tYXgoMSx0Km4vYS50aWNrcygpLmxlbmd0aCk7cmV0dXJuIGZ1bmN0aW9uKG4pe3ZhciBhPW4vaShNYXRoLnJvdW5kKHUobikpKTtyZXR1cm4gdC0uNT5hKnQmJihhKj10KSxyPj1hP2Uobik6IiJ9fSxhLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcmkobi5jb3B5KCksdCxlLHIpfSxKdShhLG4pfWZ1bmN0aW9uIHVpKG4sdCxlKXtmdW5jdGlvbiByKHQpe3JldHVybiBuKHUodCkpfXZhciB1PWlpKHQpLGk9aWkoMS90KTtyZXR1cm4gci5pbnZlcnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGkobi5pbnZlcnQodCkpfSxyLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4oKGU9dC5tYXAoTnVtYmVyKSkubWFwKHUpKSxyKTplfSxyLnRpY2tzPWZ1bmN0aW9uKG4pe3JldHVybiBRdShlLG4pfSxyLnRpY2tGb3JtYXQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbmkoZSxuLHQpfSxyLm5pY2U9ZnVuY3Rpb24obil7cmV0dXJuIHIuZG9tYWluKEd1KGUsbikpfSxyLmV4cG9uZW50PWZ1bmN0aW9uKGEpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWlpKHQ9YSksaT1paSgxL3QpLG4uZG9tYWluKGUubWFwKHUpKSxyKTp0fSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gdWkobi5jb3B5KCksdCxlKX0sSnUocixuKX1mdW5jdGlvbiBpaShuKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIDA+dD8tTWF0aC5wb3coLXQsbik6TWF0aC5wb3codCxuKX19ZnVuY3Rpb24gYWkobix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiBpWygodS5nZXQoZSl8fCgicmFuZ2UiPT09dC50P3Uuc2V0KGUsbi5wdXNoKGUpKTpOYU4pKS0xKSVpLmxlbmd0aF19ZnVuY3Rpb24gcih0LGUpe3JldHVybiBvYS5yYW5nZShuLmxlbmd0aCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybiB0K2Uqbn0pfXZhciB1LGksYTtyZXR1cm4gZS5kb21haW49ZnVuY3Rpb24ocil7aWYoIWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIG47bj1bXSx1PW5ldyBjO2Zvcih2YXIgaSxhPS0xLG89ci5sZW5ndGg7KythPG87KXUuaGFzKGk9clthXSl8fHUuc2V0KGksbi5wdXNoKGkpKTtyZXR1cm4gZVt0LnRdLmFwcGx5KGUsdC5hKX0sZS5yYW5nZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLGE9MCx0PXt0OiJyYW5nZSIsYTphcmd1bWVudHN9LGUpOml9LGUucmFuZ2VQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBsPXVbMF0sYz11WzFdLHM9bi5sZW5ndGg8Mj8obD0obCtjKS8yLDApOihjLWwpLyhuLmxlbmd0aC0xK28pO3JldHVybiBpPXIobCtzKm8vMixzKSxhPTAsdD17dDoicmFuZ2VQb2ludHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlUm91bmRQb2ludHM9ZnVuY3Rpb24odSxvKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApO3ZhciBsPXVbMF0sYz11WzFdLHM9bi5sZW5ndGg8Mj8obD1jPU1hdGgucm91bmQoKGwrYykvMiksMCk6KGMtbCkvKG4ubGVuZ3RoLTErbyl8MDtyZXR1cm4gaT1yKGwrTWF0aC5yb3VuZChzKm8vMisoYy1sLShuLmxlbmd0aC0xK28pKnMpLzIpLHMpLGE9MCx0PXt0OiJyYW5nZVJvdW5kUG9pbnRzIixhOmFyZ3VtZW50c30sZX0sZS5yYW5nZUJhbmRzPWZ1bmN0aW9uKHUsbyxsKXthcmd1bWVudHMubGVuZ3RoPDImJihvPTApLGFyZ3VtZW50cy5sZW5ndGg8MyYmKGw9byk7dmFyIGM9dVsxXTx1WzBdLHM9dVtjLTBdLGY9dVsxLWNdLGg9KGYtcykvKG4ubGVuZ3RoLW8rMipsKTtyZXR1cm4gaT1yKHMraCpsLGgpLGMmJmkucmV2ZXJzZSgpLGE9aCooMS1vKSx0PXt0OiJyYW5nZUJhbmRzIixhOmFyZ3VtZW50c30sZX0sZS5yYW5nZVJvdW5kQmFuZHM9ZnVuY3Rpb24odSxvLGwpe2FyZ3VtZW50cy5sZW5ndGg8MiYmKG89MCksYXJndW1lbnRzLmxlbmd0aDwzJiYobD1vKTt2YXIgYz11WzFdPHVbMF0scz11W2MtMF0sZj11WzEtY10saD1NYXRoLmZsb29yKChmLXMpLyhuLmxlbmd0aC1vKzIqbCkpO3JldHVybiBpPXIocytNYXRoLnJvdW5kKChmLXMtKG4ubGVuZ3RoLW8pKmgpLzIpLGgpLGMmJmkucmV2ZXJzZSgpLGE9TWF0aC5yb3VuZChoKigxLW8pKSx0PXt0OiJyYW5nZVJvdW5kQmFuZHMiLGE6YXJndW1lbnRzfSxlfSxlLnJhbmdlQmFuZD1mdW5jdGlvbigpe3JldHVybiBhfSxlLnJhbmdlRXh0ZW50PWZ1bmN0aW9uKCl7cmV0dXJuIFl1KHQuYVswXSl9LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBhaShuLHQpfSxlLmRvbWFpbihuKX1mdW5jdGlvbiBvaShuLHQpe2Z1bmN0aW9uIGkoKXt2YXIgZT0wLHI9dC5sZW5ndGg7Zm9yKG89W107KytlPHI7KW9bZS0xXT1vYS5xdWFudGlsZShuLGUvcik7cmV0dXJuIGF9ZnVuY3Rpb24gYShuKXtyZXR1cm4gaXNOYU4obj0rbik/dm9pZCAwOnRbb2EuYmlzZWN0KG8sbildfXZhciBvO3JldHVybiBhLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj10Lm1hcChyKS5maWx0ZXIodSkuc29ydChlKSxpKCkpOm59LGEucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9bixpKCkpOnR9LGEucXVhbnRpbGVzPWZ1bmN0aW9uKCl7cmV0dXJuIG99LGEuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKGUpe3JldHVybiBlPXQuaW5kZXhPZihlKSwwPmU/W05hTixOYU5dOltlPjA/b1tlLTFdOm5bMF0sZTxvLmxlbmd0aD9vW2VdOm5bbi5sZW5ndGgtMV1dfSxhLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gb2kobix0KX0saSgpfWZ1bmN0aW9uIGxpKG4sdCxlKXtmdW5jdGlvbiByKHQpe3JldHVybiBlW01hdGgubWF4KDAsTWF0aC5taW4oYSxNYXRoLmZsb29yKGkqKHQtbikpKSldfWZ1bmN0aW9uIHUoKXtyZXR1cm4gaT1lLmxlbmd0aC8odC1uKSxhPWUubGVuZ3RoLTEscn12YXIgaSxhO3JldHVybiByLmRvbWFpbj1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rZVswXSx0PStlW2UubGVuZ3RoLTFdLHUoKSk6W24sdF19LHIucmFuZ2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix1KCkpOmV9LHIuaW52ZXJ0RXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiB0PWUuaW5kZXhPZih0KSx0PTA+dD9OYU46dC9pK24sW3QsdCsxL2ldfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gbGkobix0LGUpfSx1KCl9ZnVuY3Rpb24gY2kobix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiBlPj1lP3Rbb2EuYmlzZWN0KG4sZSldOnZvaWQgMH1yZXR1cm4gZS5kb21haW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG49dCxlKTpufSxlLnJhbmdlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW4sZSk6dH0sZS5pbnZlcnRFeHRlbnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9dC5pbmRleE9mKGUpLFtuW2UtMV0sbltlXV19LGUuY29weT1mdW5jdGlvbigpe3JldHVybiBjaShuLHQpfSxlfWZ1bmN0aW9uIHNpKG4pe2Z1bmN0aW9uIHQobil7cmV0dXJuK259cmV0dXJuIHQuaW52ZXJ0PXQsdC5kb21haW49dC5yYW5nZT1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj1lLm1hcCh0KSx0KTpufSx0LnRpY2tzPWZ1bmN0aW9uKHQpe3JldHVybiBRdShuLHQpfSx0LnRpY2tGb3JtYXQ9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmkobix0LGUpfSx0LmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gc2kobil9LHR9ZnVuY3Rpb24gZmkoKXtyZXR1cm4gMH1mdW5jdGlvbiBoaShuKXtyZXR1cm4gbi5pbm5lclJhZGl1c31mdW5jdGlvbiBnaShuKXtyZXR1cm4gbi5vdXRlclJhZGl1c31mdW5jdGlvbiBwaShuKXtyZXR1cm4gbi5zdGFydEFuZ2xlfWZ1bmN0aW9uIHZpKG4pe3JldHVybiBuLmVuZEFuZ2xlfWZ1bmN0aW9uIGRpKG4pe3JldHVybiBuJiZuLnBhZEFuZ2xlfWZ1bmN0aW9uIG1pKG4sdCxlLHIpe3JldHVybihuLWUpKnQtKHQtcikqbj4wPzA6MX1mdW5jdGlvbiB5aShuLHQsZSxyLHUpe3ZhciBpPW5bMF0tdFswXSxhPW5bMV0tdFsxXSxvPSh1P3I6LXIpL01hdGguc3FydChpKmkrYSphKSxsPW8qYSxjPS1vKmkscz1uWzBdK2wsZj1uWzFdK2MsaD10WzBdK2wsZz10WzFdK2MscD0ocytoKS8yLHY9KGYrZykvMixkPWgtcyxtPWctZix5PWQqZCttKm0sTT1lLXIseD1zKmctaCpmLGI9KDA+bT8tMToxKSpNYXRoLnNxcnQoTWF0aC5tYXgoMCxNKk0qeS14KngpKSxfPSh4Km0tZCpiKS95LHc9KC14KmQtbSpiKS95LFM9KHgqbStkKmIpL3ksaz0oLXgqZCttKmIpL3ksTj1fLXAsRT13LXYsQT1TLXAsQz1rLXY7cmV0dXJuIE4qTitFKkU+QSpBK0MqQyYmKF89Uyx3PWspLFtbXy1sLHctY10sW18qZS9NLHcqZS9NXV19ZnVuY3Rpb24gTWkobil7ZnVuY3Rpb24gdCh0KXtmdW5jdGlvbiBhKCl7Yy5wdXNoKCJNIixpKG4ocyksbykpfWZvcih2YXIgbCxjPVtdLHM9W10sZj0tMSxoPXQubGVuZ3RoLGc9RW4oZSkscD1FbihyKTsrK2Y8aDspdS5jYWxsKHRoaXMsbD10W2ZdLGYpP3MucHVzaChbK2cuY2FsbCh0aGlzLGwsZiksK3AuY2FsbCh0aGlzLGwsZildKTpzLmxlbmd0aCYmKGEoKSxzPVtdKTtyZXR1cm4gcy5sZW5ndGgmJmEoKSxjLmxlbmd0aD9jLmpvaW4oIiIpOm51bGx9dmFyIGU9Q2Uscj16ZSx1PXp0LGk9eGksYT1pLmtleSxvPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0Lnk9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9bix0KTpyfSx0LmRlZmluZWQ9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bix0KTp1fSx0LmludGVycG9sYXRlPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPSJmdW5jdGlvbiI9PXR5cGVvZiBuP2k9bjooaT1xbC5nZXQobil8fHhpKS5rZXksdCk6YX0sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPW4sdCk6b30sdH1mdW5jdGlvbiB4aShuKXtyZXR1cm4gbi5sZW5ndGg+MT9uLmpvaW4oIkwiKTpuKyJaIn1mdW5jdGlvbiBiaShuKXtyZXR1cm4gbi5qb2luKCJMIikrIloifWZ1bmN0aW9uIF9pKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgscj1uWzBdLHU9W3JbMF0sIiwiLHJbMV1dOysrdDxlOyl1LnB1c2goIkgiLChyWzBdKyhyPW5bdF0pWzBdKS8yLCJWIixyWzFdKTtyZXR1cm4gZT4xJiZ1LnB1c2goIkgiLHJbMF0pLHUuam9pbigiIil9ZnVuY3Rpb24gd2kobil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aCxyPW5bMF0sdT1bclswXSwiLCIsclsxXV07Kyt0PGU7KXUucHVzaCgiViIsKHI9blt0XSlbMV0sIkgiLHJbMF0pO3JldHVybiB1LmpvaW4oIiIpfWZ1bmN0aW9uIFNpKG4pe2Zvcih2YXIgdD0wLGU9bi5sZW5ndGgscj1uWzBdLHU9W3JbMF0sIiwiLHJbMV1dOysrdDxlOyl1LnB1c2goIkgiLChyPW5bdF0pWzBdLCJWIixyWzFdKTtyZXR1cm4gdS5qb2luKCIiKX1mdW5jdGlvbiBraShuLHQpe3JldHVybiBuLmxlbmd0aDw0P3hpKG4pOm5bMV0rQWkobi5zbGljZSgxLC0xKSxDaShuLHQpKX1mdW5jdGlvbiBOaShuLHQpe3JldHVybiBuLmxlbmd0aDwzP2JpKG4pOm5bMF0rQWkoKG4ucHVzaChuWzBdKSxuKSxDaShbbltuLmxlbmd0aC0yXV0uY29uY2F0KG4sW25bMV1dKSx0KSl9ZnVuY3Rpb24gRWkobix0KXtyZXR1cm4gbi5sZW5ndGg8Mz94aShuKTpuWzBdK0FpKG4sQ2kobix0KSl9ZnVuY3Rpb24gQWkobix0KXtpZih0Lmxlbmd0aDwxfHxuLmxlbmd0aCE9dC5sZW5ndGgmJm4ubGVuZ3RoIT10Lmxlbmd0aCsyKXJldHVybiB4aShuKTt2YXIgZT1uLmxlbmd0aCE9dC5sZW5ndGgscj0iIix1PW5bMF0saT1uWzFdLGE9dFswXSxvPWEsbD0xO2lmKGUmJihyKz0iUSIrKGlbMF0tMiphWzBdLzMpKyIsIisoaVsxXS0yKmFbMV0vMykrIiwiK2lbMF0rIiwiK2lbMV0sdT1uWzFdLGw9MiksdC5sZW5ndGg+MSl7bz10WzFdLGk9bltsXSxsKysscis9IkMiKyh1WzBdK2FbMF0pKyIsIisodVsxXSthWzFdKSsiLCIrKGlbMF0tb1swXSkrIiwiKyhpWzFdLW9bMV0pKyIsIitpWzBdKyIsIitpWzFdO2Zvcih2YXIgYz0yO2M8dC5sZW5ndGg7YysrLGwrKylpPW5bbF0sbz10W2NdLHIrPSJTIisoaVswXS1vWzBdKSsiLCIrKGlbMV0tb1sxXSkrIiwiK2lbMF0rIiwiK2lbMV19aWYoZSl7dmFyIHM9bltsXTtyKz0iUSIrKGlbMF0rMipvWzBdLzMpKyIsIisoaVsxXSsyKm9bMV0vMykrIiwiK3NbMF0rIiwiK3NbMV19cmV0dXJuIHJ9ZnVuY3Rpb24gQ2kobix0KXtmb3IodmFyIGUscj1bXSx1PSgxLXQpLzIsaT1uWzBdLGE9blsxXSxvPTEsbD1uLmxlbmd0aDsrK288bDspZT1pLGk9YSxhPW5bb10sci5wdXNoKFt1KihhWzBdLWVbMF0pLHUqKGFbMV0tZVsxXSldKTtyZXR1cm4gcn1mdW5jdGlvbiB6aShuKXtpZihuLmxlbmd0aDwzKXJldHVybiB4aShuKTt2YXIgdD0xLGU9bi5sZW5ndGgscj1uWzBdLHU9clswXSxpPXJbMV0sYT1bdSx1LHUsKHI9blsxXSlbMF1dLG89W2ksaSxpLHJbMV1dLGw9W3UsIiwiLGksIkwiLFJpKERsLGEpLCIsIixSaShEbCxvKV07Zm9yKG4ucHVzaChuW2UtMV0pOysrdDw9ZTspcj1uW3RdLGEuc2hpZnQoKSxhLnB1c2goclswXSksby5zaGlmdCgpLG8ucHVzaChyWzFdKSxEaShsLGEsbyk7cmV0dXJuIG4ucG9wKCksbC5wdXNoKCJMIixyKSxsLmpvaW4oIiIpfWZ1bmN0aW9uIExpKG4pe2lmKG4ubGVuZ3RoPDQpcmV0dXJuIHhpKG4pO2Zvcih2YXIgdCxlPVtdLHI9LTEsdT1uLmxlbmd0aCxpPVswXSxhPVswXTsrK3I8MzspdD1uW3JdLGkucHVzaCh0WzBdKSxhLnB1c2godFsxXSk7Zm9yKGUucHVzaChSaShEbCxpKSsiLCIrUmkoRGwsYSkpLC0tcjsrK3I8dTspdD1uW3JdLGkuc2hpZnQoKSxpLnB1c2godFswXSksYS5zaGlmdCgpLGEucHVzaCh0WzFdKSxEaShlLGksYSk7cmV0dXJuIGUuam9pbigiIil9ZnVuY3Rpb24gcWkobil7Zm9yKHZhciB0LGUscj0tMSx1PW4ubGVuZ3RoLGk9dSs0LGE9W10sbz1bXTsrK3I8NDspZT1uW3IldV0sYS5wdXNoKGVbMF0pLG8ucHVzaChlWzFdKTtmb3IodD1bUmkoRGwsYSksIiwiLFJpKERsLG8pXSwtLXI7KytyPGk7KWU9bltyJXVdLGEuc2hpZnQoKSxhLnB1c2goZVswXSksby5zaGlmdCgpLG8ucHVzaChlWzFdKSxEaSh0LGEsbyk7cmV0dXJuIHQuam9pbigiIil9ZnVuY3Rpb24gVGkobix0KXt2YXIgZT1uLmxlbmd0aC0xO2lmKGUpZm9yKHZhciByLHUsaT1uWzBdWzBdLGE9blswXVsxXSxvPW5bZV1bMF0taSxsPW5bZV1bMV0tYSxjPS0xOysrYzw9ZTspcj1uW2NdLHU9Yy9lLHJbMF09dCpyWzBdKygxLXQpKihpK3UqbyksclsxXT10KnJbMV0rKDEtdCkqKGErdSpsKTtyZXR1cm4gemkobil9ZnVuY3Rpb24gUmkobix0KXtyZXR1cm4gblswXSp0WzBdK25bMV0qdFsxXStuWzJdKnRbMl0rblszXSp0WzNdfWZ1bmN0aW9uIERpKG4sdCxlKXtuLnB1c2goIkMiLFJpKFRsLHQpLCIsIixSaShUbCxlKSwiLCIsUmkoUmwsdCksIiwiLFJpKFJsLGUpLCIsIixSaShEbCx0KSwiLCIsUmkoRGwsZSkpfWZ1bmN0aW9uIFBpKG4sdCl7cmV0dXJuKHRbMV0tblsxXSkvKHRbMF0tblswXSl9ZnVuY3Rpb24gVWkobil7Zm9yKHZhciB0PTAsZT1uLmxlbmd0aC0xLHI9W10sdT1uWzBdLGk9blsxXSxhPXJbMF09UGkodSxpKTsrK3Q8ZTspclt0XT0oYSsoYT1QaSh1PWksaT1uW3QrMV0pKSkvMjtyZXR1cm4gclt0XT1hLHJ9ZnVuY3Rpb24gamkobil7Zm9yKHZhciB0LGUscix1LGk9W10sYT1VaShuKSxvPS0xLGw9bi5sZW5ndGgtMTsrK288bDspdD1QaShuW29dLG5bbysxXSksTWEodCk8RGE/YVtvXT1hW28rMV09MDooZT1hW29dL3Qscj1hW28rMV0vdCx1PWUqZStyKnIsdT45JiYodT0zKnQvTWF0aC5zcXJ0KHUpLGFbb109dSplLGFbbysxXT11KnIpKTtmb3Iobz0tMTsrK288PWw7KXU9KG5bTWF0aC5taW4obCxvKzEpXVswXS1uW01hdGgubWF4KDAsby0xKV1bMF0pLyg2KigxK2Fbb10qYVtvXSkpLGkucHVzaChbdXx8MCxhW29dKnV8fDBdKTtyZXR1cm4gaX1mdW5jdGlvbiBGaShuKXtyZXR1cm4gbi5sZW5ndGg8Mz94aShuKTpuWzBdK0FpKG4samkobikpfWZ1bmN0aW9uIEhpKG4pe2Zvcih2YXIgdCxlLHIsdT0tMSxpPW4ubGVuZ3RoOysrdTxpOyl0PW5bdV0sZT10WzBdLHI9dFsxXS1IYSx0WzBdPWUqTWF0aC5jb3MociksdFsxXT1lKk1hdGguc2luKHIpO3JldHVybiBufWZ1bmN0aW9uIE9pKG4pe2Z1bmN0aW9uIHQodCl7ZnVuY3Rpb24gbCgpe3YucHVzaCgiTSIsbyhuKG0pLGYpLHMsYyhuKGQucmV2ZXJzZSgpKSxmKSwiWiIpfWZvcih2YXIgaCxnLHAsdj1bXSxkPVtdLG09W10seT0tMSxNPXQubGVuZ3RoLHg9RW4oZSksYj1Fbih1KSxfPWU9PT1yP2Z1bmN0aW9uKCl7CnJldHVybiBnfTpFbihyKSx3PXU9PT1pP2Z1bmN0aW9uKCl7cmV0dXJuIHB9OkVuKGkpOysreTxNOylhLmNhbGwodGhpcyxoPXRbeV0seSk/KGQucHVzaChbZz0reC5jYWxsKHRoaXMsaCx5KSxwPStiLmNhbGwodGhpcyxoLHkpXSksbS5wdXNoKFsrXy5jYWxsKHRoaXMsaCx5KSwrdy5jYWxsKHRoaXMsaCx5KV0pKTpkLmxlbmd0aCYmKGwoKSxkPVtdLG09W10pO3JldHVybiBkLmxlbmd0aCYmbCgpLHYubGVuZ3RoP3Yuam9pbigiIik6bnVsbH12YXIgZT1DZSxyPUNlLHU9MCxpPXplLGE9enQsbz14aSxsPW8ua2V5LGM9byxzPSJMIixmPS43O3JldHVybiB0Lng9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9cj1uLHQpOnJ9LHQueDA9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9bix0KTplfSx0LngxPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPW4sdCk6cn0sdC55PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PWk9bix0KTppfSx0LnkwPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sdCk6dX0sdC55MT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1uLHQpOml9LHQuZGVmaW5lZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLHQpOmF9LHQuaW50ZXJwb2xhdGU9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bz1uOihvPXFsLmdldChuKXx8eGkpLmtleSxjPW8ucmV2ZXJzZXx8byxzPW8uY2xvc2VkPyJNIjoiTCIsdCk6bH0sdC50ZW5zaW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhmPW4sdCk6Zn0sdH1mdW5jdGlvbiBJaShuKXtyZXR1cm4gbi5yYWRpdXN9ZnVuY3Rpb24gWWkobil7cmV0dXJuW24ueCxuLnldfWZ1bmN0aW9uIFppKG4pe3JldHVybiBmdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpLGU9dFswXSxyPXRbMV0tSGE7cmV0dXJuW2UqTWF0aC5jb3MociksZSpNYXRoLnNpbihyKV19fWZ1bmN0aW9uIFZpKCl7cmV0dXJuIDY0fWZ1bmN0aW9uIFhpKCl7cmV0dXJuImNpcmNsZSJ9ZnVuY3Rpb24gJGkobil7dmFyIHQ9TWF0aC5zcXJ0KG4vVWEpO3JldHVybiJNMCwiK3QrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrLXQrIkEiK3QrIiwiK3QrIiAwIDEsMSAwLCIrdCsiWiJ9ZnVuY3Rpb24gQmkobil7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIHQsZSxyOyh0PXRoaXNbbl0pJiYocj10W2U9dC5hY3RpdmVdKSYmKHIudGltZXIuYz1udWxsLHIudGltZXIudD1OYU4sLS10LmNvdW50P2RlbGV0ZSB0W2VdOmRlbGV0ZSB0aGlzW25dLHQuYWN0aXZlKz0uNSxyLmV2ZW50JiZyLmV2ZW50LmludGVycnVwdC5jYWxsKHRoaXMsdGhpcy5fX2RhdGFfXyxyLmluZGV4KSl9fWZ1bmN0aW9uIFdpKG4sdCxlKXtyZXR1cm4gU2EobixJbCksbi5uYW1lc3BhY2U9dCxuLmlkPWUsbn1mdW5jdGlvbiBKaShuLHQsZSxyKXt2YXIgdT1uLmlkLGk9bi5uYW1lc3BhY2U7cmV0dXJuIFkobiwiZnVuY3Rpb24iPT10eXBlb2YgZT9mdW5jdGlvbihuLGEsbyl7bltpXVt1XS50d2Vlbi5zZXQodCxyKGUuY2FsbChuLG4uX19kYXRhX18sYSxvKSkpfTooZT1yKGUpLGZ1bmN0aW9uKG4pe25baV1bdV0udHdlZW4uc2V0KHQsZSl9KSl9ZnVuY3Rpb24gR2kobil7cmV0dXJuIG51bGw9PW4mJihuPSIiKSxmdW5jdGlvbigpe3RoaXMudGV4dENvbnRlbnQ9bn19ZnVuY3Rpb24gS2kobil7cmV0dXJuIG51bGw9PW4/Il9fdHJhbnNpdGlvbl9fIjoiX190cmFuc2l0aW9uXyIrbisiX18ifWZ1bmN0aW9uIFFpKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXt2YXIgdD12LmRlbGF5O3JldHVybiBzLnQ9dCtsLG4+PXQ/YShuLXQpOnZvaWQocy5jPWEpfWZ1bmN0aW9uIGEoZSl7dmFyIHU9cC5hY3RpdmUsaT1wW3VdO2kmJihpLnRpbWVyLmM9bnVsbCxpLnRpbWVyLnQ9TmFOLC0tcC5jb3VudCxkZWxldGUgcFt1XSxpLmV2ZW50JiZpLmV2ZW50LmludGVycnVwdC5jYWxsKG4sbi5fX2RhdGFfXyxpLmluZGV4KSk7Zm9yKHZhciBhIGluIHApaWYocj4rYSl7dmFyIGM9cFthXTtjLnRpbWVyLmM9bnVsbCxjLnRpbWVyLnQ9TmFOLC0tcC5jb3VudCxkZWxldGUgcFthXX1zLmM9byxxbihmdW5jdGlvbigpe3JldHVybiBzLmMmJm8oZXx8MSkmJihzLmM9bnVsbCxzLnQ9TmFOKSwxfSwwLGwpLHAuYWN0aXZlPXIsdi5ldmVudCYmdi5ldmVudC5zdGFydC5jYWxsKG4sbi5fX2RhdGFfXyx0KSxnPVtdLHYudHdlZW4uZm9yRWFjaChmdW5jdGlvbihlLHIpeyhyPXIuY2FsbChuLG4uX19kYXRhX18sdCkpJiZnLnB1c2gocil9KSxoPXYuZWFzZSxmPXYuZHVyYXRpb259ZnVuY3Rpb24gbyh1KXtmb3IodmFyIGk9dS9mLGE9aChpKSxvPWcubGVuZ3RoO28+MDspZ1stLW9dLmNhbGwobixhKTtyZXR1cm4gaT49MT8odi5ldmVudCYmdi5ldmVudC5lbmQuY2FsbChuLG4uX19kYXRhX18sdCksLS1wLmNvdW50P2RlbGV0ZSBwW3JdOmRlbGV0ZSBuW2VdLDEpOnZvaWQgMH12YXIgbCxzLGYsaCxnLHA9bltlXXx8KG5bZV09e2FjdGl2ZTowLGNvdW50OjB9KSx2PXBbcl07dnx8KGw9dS50aW1lLHM9cW4oaSwwLGwpLHY9cFtyXT17dHdlZW46bmV3IGMsdGltZTpsLHRpbWVyOnMsZGVsYXk6dS5kZWxheSxkdXJhdGlvbjp1LmR1cmF0aW9uLGVhc2U6dS5lYXNlLGluZGV4OnR9LHU9bnVsbCwrK3AuY291bnQpfWZ1bmN0aW9uIG5hKG4sdCxlKXtuLmF0dHIoInRyYW5zZm9ybSIsZnVuY3Rpb24obil7dmFyIHI9dChuKTtyZXR1cm4idHJhbnNsYXRlKCIrKGlzRmluaXRlKHIpP3I6ZShuKSkrIiwwKSJ9KX1mdW5jdGlvbiB0YShuLHQsZSl7bi5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3ZhciByPXQobik7cmV0dXJuInRyYW5zbGF0ZSgwLCIrKGlzRmluaXRlKHIpP3I6ZShuKSkrIikifSl9ZnVuY3Rpb24gZWEobil7cmV0dXJuIG4udG9JU09TdHJpbmcoKX1mdW5jdGlvbiByYShuLHQsZSl7ZnVuY3Rpb24gcih0KXtyZXR1cm4gbih0KX1mdW5jdGlvbiB1KG4sZSl7dmFyIHI9blsxXS1uWzBdLHU9ci9lLGk9b2EuYmlzZWN0KEdsLHUpO3JldHVybiBpPT1HbC5sZW5ndGg/W3QueWVhcixLdShuLm1hcChmdW5jdGlvbihuKXtyZXR1cm4gbi8zMTUzNmU2fSksZSlbMl1dOmk/dFt1L0dsW2ktMV08R2xbaV0vdT9pLTE6aV06W25jLEt1KG4sZSlbMl1dfXJldHVybiByLmludmVydD1mdW5jdGlvbih0KXtyZXR1cm4gdWEobi5pbnZlcnQodCkpfSxyLmRvbWFpbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obi5kb21haW4odCkscik6bi5kb21haW4oKS5tYXAodWEpfSxyLm5pY2U9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKGUpe3JldHVybiFpc05hTihlKSYmIW4ucmFuZ2UoZSx1YSgrZSsxKSx0KS5sZW5ndGh9dmFyIGk9ci5kb21haW4oKSxhPVl1KGkpLG89bnVsbD09bj91KGEsMTApOiJudW1iZXIiPT10eXBlb2YgbiYmdShhLG4pO3JldHVybiBvJiYobj1vWzBdLHQ9b1sxXSksci5kb21haW4oWHUoaSx0PjE/e2Zsb29yOmZ1bmN0aW9uKHQpe2Zvcig7ZSh0PW4uZmxvb3IodCkpOyl0PXVhKHQtMSk7cmV0dXJuIHR9LGNlaWw6ZnVuY3Rpb24odCl7Zm9yKDtlKHQ9bi5jZWlsKHQpKTspdD11YSgrdCsxKTtyZXR1cm4gdH19Om4pKX0sci50aWNrcz1mdW5jdGlvbihuLHQpe3ZhciBlPVl1KHIuZG9tYWluKCkpLGk9bnVsbD09bj91KGUsMTApOiJudW1iZXIiPT10eXBlb2Ygbj91KGUsbik6IW4ucmFuZ2UmJlt7cmFuZ2U6bn0sdF07cmV0dXJuIGkmJihuPWlbMF0sdD1pWzFdKSxuLnJhbmdlKGVbMF0sdWEoK2VbMV0rMSksMT50PzE6dCl9LHIudGlja0Zvcm1hdD1mdW5jdGlvbigpe3JldHVybiBlfSxyLmNvcHk9ZnVuY3Rpb24oKXtyZXR1cm4gcmEobi5jb3B5KCksdCxlKX0sSnUocixuKX1mdW5jdGlvbiB1YShuKXtyZXR1cm4gbmV3IERhdGUobil9ZnVuY3Rpb24gaWEobil7cmV0dXJuIEpTT04ucGFyc2Uobi5yZXNwb25zZVRleHQpfWZ1bmN0aW9uIGFhKG4pe3ZhciB0PXNhLmNyZWF0ZVJhbmdlKCk7cmV0dXJuIHQuc2VsZWN0Tm9kZShzYS5ib2R5KSx0LmNyZWF0ZUNvbnRleHR1YWxGcmFnbWVudChuLnJlc3BvbnNlVGV4dCl9dmFyIG9hPXt2ZXJzaW9uOiIzLjUuMTQifSxsYT1bXS5zbGljZSxjYT1mdW5jdGlvbihuKXtyZXR1cm4gbGEuY2FsbChuKX0sc2E9dGhpcy5kb2N1bWVudDtpZihzYSl0cnl7Y2Eoc2EuZG9jdW1lbnRFbGVtZW50LmNoaWxkTm9kZXMpWzBdLm5vZGVUeXBlfWNhdGNoKGZhKXtjYT1mdW5jdGlvbihuKXtmb3IodmFyIHQ9bi5sZW5ndGgsZT1uZXcgQXJyYXkodCk7dC0tOyllW3RdPW5bdF07cmV0dXJuIGV9fWlmKERhdGUubm93fHwoRGF0ZS5ub3c9ZnVuY3Rpb24oKXtyZXR1cm4rbmV3IERhdGV9KSxzYSl0cnl7c2EuY3JlYXRlRWxlbWVudCgiRElWIikuc3R5bGUuc2V0UHJvcGVydHkoIm9wYWNpdHkiLDAsIiIpfWNhdGNoKGhhKXt2YXIgZ2E9dGhpcy5FbGVtZW50LnByb3RvdHlwZSxwYT1nYS5zZXRBdHRyaWJ1dGUsdmE9Z2Euc2V0QXR0cmlidXRlTlMsZGE9dGhpcy5DU1NTdHlsZURlY2xhcmF0aW9uLnByb3RvdHlwZSxtYT1kYS5zZXRQcm9wZXJ0eTtnYS5zZXRBdHRyaWJ1dGU9ZnVuY3Rpb24obix0KXtwYS5jYWxsKHRoaXMsbix0KyIiKX0sZ2Euc2V0QXR0cmlidXRlTlM9ZnVuY3Rpb24obix0LGUpe3ZhLmNhbGwodGhpcyxuLHQsZSsiIil9LGRhLnNldFByb3BlcnR5PWZ1bmN0aW9uKG4sdCxlKXttYS5jYWxsKHRoaXMsbix0KyIiLGUpfX1vYS5hc2NlbmRpbmc9ZSxvYS5kZXNjZW5kaW5nPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4+dD8tMTp0Pm4/MTp0Pj1uPzA6TmFOfSxvYS5taW49ZnVuY3Rpb24obix0KXt2YXIgZSxyLHU9LTEsaT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK3U8aTspaWYobnVsbCE9KHI9blt1XSkmJnI+PXIpe2U9cjticmVha31mb3IoOysrdTxpOyludWxsIT0ocj1uW3VdKSYmZT5yJiYoZT1yKX1lbHNle2Zvcig7Kyt1PGk7KWlmKG51bGwhPShyPXQuY2FsbChuLG5bdV0sdSkpJiZyPj1yKXtlPXI7YnJlYWt9Zm9yKDsrK3U8aTspbnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJmU+ciYmKGU9cil9cmV0dXJuIGV9LG9hLm1heD1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT0tMSxpPW4ubGVuZ3RoO2lmKDE9PT1hcmd1bWVudHMubGVuZ3RoKXtmb3IoOysrdTxpOylpZihudWxsIT0ocj1uW3VdKSYmcj49cil7ZT1yO2JyZWFrfWZvcig7Kyt1PGk7KW51bGwhPShyPW5bdV0pJiZyPmUmJihlPXIpfWVsc2V7Zm9yKDsrK3U8aTspaWYobnVsbCE9KHI9dC5jYWxsKG4sblt1XSx1KSkmJnI+PXIpe2U9cjticmVha31mb3IoOysrdTxpOyludWxsIT0ocj10LmNhbGwobixuW3VdLHUpKSYmcj5lJiYoZT1yKX1yZXR1cm4gZX0sb2EuZXh0ZW50PWZ1bmN0aW9uKG4sdCl7dmFyIGUscix1LGk9LTEsYT1uLmxlbmd0aDtpZigxPT09YXJndW1lbnRzLmxlbmd0aCl7Zm9yKDsrK2k8YTspaWYobnVsbCE9KHI9bltpXSkmJnI+PXIpe2U9dT1yO2JyZWFrfWZvcig7KytpPGE7KW51bGwhPShyPW5baV0pJiYoZT5yJiYoZT1yKSxyPnUmJih1PXIpKX1lbHNle2Zvcig7KytpPGE7KWlmKG51bGwhPShyPXQuY2FsbChuLG5baV0saSkpJiZyPj1yKXtlPXU9cjticmVha31mb3IoOysraTxhOyludWxsIT0ocj10LmNhbGwobixuW2ldLGkpKSYmKGU+ciYmKGU9cikscj51JiYodT1yKSl9cmV0dXJuW2UsdV19LG9hLnN1bT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9MCxpPW4ubGVuZ3RoLGE9LTE7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK2E8aTspdShlPStuW2FdKSYmKHIrPWUpO2Vsc2UgZm9yKDsrK2E8aTspdShlPSt0LmNhbGwobixuW2FdLGEpKSYmKHIrPWUpO3JldHVybiByfSxvYS5tZWFuPWZ1bmN0aW9uKG4sdCl7dmFyIGUsaT0wLGE9bi5sZW5ndGgsbz0tMSxsPWE7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK288YTspdShlPXIobltvXSkpP2krPWU6LS1sO2Vsc2UgZm9yKDsrK288YTspdShlPXIodC5jYWxsKG4sbltvXSxvKSkpP2krPWU6LS1sO3JldHVybiBsP2kvbDp2b2lkIDB9LG9hLnF1YW50aWxlPWZ1bmN0aW9uKG4sdCl7dmFyIGU9KG4ubGVuZ3RoLTEpKnQrMSxyPU1hdGguZmxvb3IoZSksdT0rbltyLTFdLGk9ZS1yO3JldHVybiBpP3UraSoobltyXS11KTp1fSxvYS5tZWRpYW49ZnVuY3Rpb24obix0KXt2YXIgaSxhPVtdLG89bi5sZW5ndGgsbD0tMTtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysrbDxvOyl1KGk9cihuW2xdKSkmJmEucHVzaChpKTtlbHNlIGZvcig7KytsPG87KXUoaT1yKHQuY2FsbChuLG5bbF0sbCkpKSYmYS5wdXNoKGkpO3JldHVybiBhLmxlbmd0aD9vYS5xdWFudGlsZShhLnNvcnQoZSksLjUpOnZvaWQgMH0sb2EudmFyaWFuY2U9ZnVuY3Rpb24obix0KXt2YXIgZSxpLGE9bi5sZW5ndGgsbz0wLGw9MCxjPS0xLHM9MDtpZigxPT09YXJndW1lbnRzLmxlbmd0aClmb3IoOysrYzxhOyl1KGU9cihuW2NdKSkmJihpPWUtbyxvKz1pLysrcyxsKz1pKihlLW8pKTtlbHNlIGZvcig7KytjPGE7KXUoZT1yKHQuY2FsbChuLG5bY10sYykpKSYmKGk9ZS1vLG8rPWkvKytzLGwrPWkqKGUtbykpO3JldHVybiBzPjE/bC8ocy0xKTp2b2lkIDB9LG9hLmRldmlhdGlvbj1mdW5jdGlvbigpe3ZhciBuPW9hLnZhcmlhbmNlLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtyZXR1cm4gbj9NYXRoLnNxcnQobik6bn07dmFyIHlhPWkoZSk7b2EuYmlzZWN0TGVmdD15YS5sZWZ0LG9hLmJpc2VjdD1vYS5iaXNlY3RSaWdodD15YS5yaWdodCxvYS5iaXNlY3Rvcj1mdW5jdGlvbihuKXtyZXR1cm4gaSgxPT09bi5sZW5ndGg/ZnVuY3Rpb24odCxyKXtyZXR1cm4gZShuKHQpLHIpfTpuKX0sb2Euc2h1ZmZsZT1mdW5jdGlvbihuLHQsZSl7KGk9YXJndW1lbnRzLmxlbmd0aCk8MyYmKGU9bi5sZW5ndGgsMj5pJiYodD0wKSk7Zm9yKHZhciByLHUsaT1lLXQ7aTspdT1NYXRoLnJhbmRvbSgpKmktLXwwLHI9bltpK3RdLG5baSt0XT1uW3UrdF0sblt1K3RdPXI7cmV0dXJuIG59LG9hLnBlcm11dGU9ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1uZXcgQXJyYXkoZSk7ZS0tOylyW2VdPW5bdFtlXV07cmV0dXJuIHJ9LG9hLnBhaXJzPWZ1bmN0aW9uKG4pe2Zvcih2YXIgdCxlPTAscj1uLmxlbmd0aC0xLHU9blswXSxpPW5ldyBBcnJheSgwPnI/MDpyKTtyPmU7KWlbZV09W3Q9dSx1PW5bKytlXV07cmV0dXJuIGl9LG9hLnppcD1mdW5jdGlvbigpe2lmKCEocj1hcmd1bWVudHMubGVuZ3RoKSlyZXR1cm5bXTtmb3IodmFyIG49LTEsdD1vYS5taW4oYXJndW1lbnRzLGEpLGU9bmV3IEFycmF5KHQpOysrbjx0Oylmb3IodmFyIHIsdT0tMSxpPWVbbl09bmV3IEFycmF5KHIpOysrdTxyOylpW3VdPWFyZ3VtZW50c1t1XVtuXTtyZXR1cm4gZX0sb2EudHJhbnNwb3NlPWZ1bmN0aW9uKG4pe3JldHVybiBvYS56aXAuYXBwbHkob2Esbil9LG9hLmtleXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKGUpO3JldHVybiB0fSxvYS52YWx1ZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107Zm9yKHZhciBlIGluIG4pdC5wdXNoKG5bZV0pO3JldHVybiB0fSxvYS5lbnRyaWVzPWZ1bmN0aW9uKG4pe3ZhciB0PVtdO2Zvcih2YXIgZSBpbiBuKXQucHVzaCh7a2V5OmUsdmFsdWU6bltlXX0pO3JldHVybiB0fSxvYS5tZXJnZT1mdW5jdGlvbihuKXtmb3IodmFyIHQsZSxyLHU9bi5sZW5ndGgsaT0tMSxhPTA7KytpPHU7KWErPW5baV0ubGVuZ3RoO2ZvcihlPW5ldyBBcnJheShhKTstLXU+PTA7KWZvcihyPW5bdV0sdD1yLmxlbmd0aDstLXQ+PTA7KWVbLS1hXT1yW3RdO3JldHVybiBlfTt2YXIgTWE9TWF0aC5hYnM7b2EucmFuZ2U9ZnVuY3Rpb24obix0LGUpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKGU9MSxhcmd1bWVudHMubGVuZ3RoPDImJih0PW4sbj0wKSksKHQtbikvZT09PTEvMCl0aHJvdyBuZXcgRXJyb3IoImluZmluaXRlIHJhbmdlIik7dmFyIHIsdT1bXSxpPW8oTWEoZSkpLGE9LTE7aWYobio9aSx0Kj1pLGUqPWksMD5lKWZvcig7KHI9bitlKisrYSk+dDspdS5wdXNoKHIvaSk7ZWxzZSBmb3IoOyhyPW4rZSorK2EpPHQ7KXUucHVzaChyL2kpO3JldHVybiB1fSxvYS5tYXA9ZnVuY3Rpb24obix0KXt2YXIgZT1uZXcgYztpZihuIGluc3RhbmNlb2YgYyluLmZvckVhY2goZnVuY3Rpb24obix0KXtlLnNldChuLHQpfSk7ZWxzZSBpZihBcnJheS5pc0FycmF5KG4pKXt2YXIgcix1PS0xLGk9bi5sZW5ndGg7aWYoMT09PWFyZ3VtZW50cy5sZW5ndGgpZm9yKDsrK3U8aTspZS5zZXQodSxuW3VdKTtlbHNlIGZvcig7Kyt1PGk7KWUuc2V0KHQuY2FsbChuLHI9blt1XSx1KSxyKX1lbHNlIGZvcih2YXIgYSBpbiBuKWUuc2V0KGEsblthXSk7cmV0dXJuIGV9O3ZhciB4YT0iX19wcm90b19fIixiYT0iXHgwMCI7bChjLHtoYXM6aCxnZXQ6ZnVuY3Rpb24obil7cmV0dXJuIHRoaXMuX1tzKG4pXX0sc2V0OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIHRoaXMuX1tzKG4pXT10fSxyZW1vdmU6ZyxrZXlzOnAsdmFsdWVzOmZ1bmN0aW9uKCl7dmFyIG49W107Zm9yKHZhciB0IGluIHRoaXMuXyluLnB1c2godGhpcy5fW3RdKTtyZXR1cm4gbn0sZW50cmllczpmdW5jdGlvbigpe3ZhciBuPVtdO2Zvcih2YXIgdCBpbiB0aGlzLl8pbi5wdXNoKHtrZXk6Zih0KSx2YWx1ZTp0aGlzLl9bdF19KTtyZXR1cm4gbn0sc2l6ZTp2LGVtcHR5OmQsZm9yRWFjaDpmdW5jdGlvbihuKXtmb3IodmFyIHQgaW4gdGhpcy5fKW4uY2FsbCh0aGlzLGYodCksdGhpcy5fW3RdKX19KSxvYS5uZXN0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGEsbyl7aWYobz49aS5sZW5ndGgpcmV0dXJuIHI/ci5jYWxsKHUsYSk6ZT9hLnNvcnQoZSk6YTtmb3IodmFyIGwscyxmLGgsZz0tMSxwPWEubGVuZ3RoLHY9aVtvKytdLGQ9bmV3IGM7KytnPHA7KShoPWQuZ2V0KGw9dihzPWFbZ10pKSk/aC5wdXNoKHMpOmQuc2V0KGwsW3NdKTtyZXR1cm4gdD8ocz10KCksZj1mdW5jdGlvbihlLHIpe3Muc2V0KGUsbih0LHIsbykpfSk6KHM9e30sZj1mdW5jdGlvbihlLHIpe3NbZV09bih0LHIsbyl9KSxkLmZvckVhY2goZiksc31mdW5jdGlvbiB0KG4sZSl7aWYoZT49aS5sZW5ndGgpcmV0dXJuIG47dmFyIHI9W10sdT1hW2UrK107cmV0dXJuIG4uZm9yRWFjaChmdW5jdGlvbihuLHUpe3IucHVzaCh7a2V5Om4sdmFsdWVzOnQodSxlKX0pfSksdT9yLnNvcnQoZnVuY3Rpb24obix0KXtyZXR1cm4gdShuLmtleSx0LmtleSl9KTpyfXZhciBlLHIsdT17fSxpPVtdLGE9W107cmV0dXJuIHUubWFwPWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG4oZSx0LDApfSx1LmVudHJpZXM9ZnVuY3Rpb24oZSl7cmV0dXJuIHQobihvYS5tYXAsZSwwKSwwKX0sdS5rZXk9ZnVuY3Rpb24obil7cmV0dXJuIGkucHVzaChuKSx1fSx1LnNvcnRLZXlzPWZ1bmN0aW9uKG4pe3JldHVybiBhW2kubGVuZ3RoLTFdPW4sdX0sdS5zb3J0VmFsdWVzPWZ1bmN0aW9uKG4pe3JldHVybiBlPW4sdX0sdS5yb2xsdXA9ZnVuY3Rpb24obil7cmV0dXJuIHI9bix1fSx1fSxvYS5zZXQ9ZnVuY3Rpb24obil7dmFyIHQ9bmV3IG07aWYobilmb3IodmFyIGU9MCxyPW4ubGVuZ3RoO3I+ZTsrK2UpdC5hZGQobltlXSk7cmV0dXJuIHR9LGwobSx7aGFzOmgsYWRkOmZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLl9bcyhuKz0iIildPSEwLG59LHJlbW92ZTpnLHZhbHVlczpwLHNpemU6dixlbXB0eTpkLGZvckVhY2g6ZnVuY3Rpb24obil7Zm9yKHZhciB0IGluIHRoaXMuXyluLmNhbGwodGhpcyxmKHQpKX19KSxvYS5iZWhhdmlvcj17fSxvYS5yZWJpbmQ9ZnVuY3Rpb24obix0KXtmb3IodmFyIGUscj0xLHU9YXJndW1lbnRzLmxlbmd0aDsrK3I8dTspbltlPWFyZ3VtZW50c1tyXV09TShuLHQsdFtlXSk7cmV0dXJuIG59O3ZhciBfYT1bIndlYmtpdCIsIm1zIiwibW96IiwiTW96IiwibyIsIk8iXTtvYS5kaXNwYXRjaD1mdW5jdGlvbigpe2Zvcih2YXIgbj1uZXcgXyx0PS0xLGU9YXJndW1lbnRzLmxlbmd0aDsrK3Q8ZTspblthcmd1bWVudHNbdF1dPXcobik7cmV0dXJuIG59LF8ucHJvdG90eXBlLm9uPWZ1bmN0aW9uKG4sdCl7dmFyIGU9bi5pbmRleE9mKCIuIikscj0iIjtpZihlPj0wJiYocj1uLnNsaWNlKGUrMSksbj1uLnNsaWNlKDAsZSkpLG4pcmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8Mj90aGlzW25dLm9uKHIpOnRoaXNbbl0ub24ocix0KTtpZigyPT09YXJndW1lbnRzLmxlbmd0aCl7aWYobnVsbD09dClmb3IobiBpbiB0aGlzKXRoaXMuaGFzT3duUHJvcGVydHkobikmJnRoaXNbbl0ub24ocixudWxsKTtyZXR1cm4gdGhpc319LG9hLmV2ZW50PW51bGwsb2EucmVxdW90ZT1mdW5jdGlvbihuKXtyZXR1cm4gbi5yZXBsYWNlKHdhLCJcXCQmIil9O3ZhciB3YT0vW1xcXF5cJFwqXCtcP1x8XFtcXVwoXClcLlx7XH1dL2csU2E9e30uX19wcm90b19fP2Z1bmN0aW9uKG4sdCl7bi5fX3Byb3RvX189dH06ZnVuY3Rpb24obix0KXtmb3IodmFyIGUgaW4gdCluW2VdPXRbZV19LGthPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIHQucXVlcnlTZWxlY3RvcihuKX0sTmE9ZnVuY3Rpb24obix0KXtyZXR1cm4gdC5xdWVyeVNlbGVjdG9yQWxsKG4pfSxFYT1mdW5jdGlvbihuLHQpe3ZhciBlPW4ubWF0Y2hlc3x8blt4KG4sIm1hdGNoZXNTZWxlY3RvciIpXTtyZXR1cm4oRWE9ZnVuY3Rpb24obix0KXtyZXR1cm4gZS5jYWxsKG4sdCl9KShuLHQpfTsiZnVuY3Rpb24iPT10eXBlb2YgU2l6emxlJiYoa2E9ZnVuY3Rpb24obix0KXtyZXR1cm4gU2l6emxlKG4sdClbMF18fG51bGx9LE5hPVNpenpsZSxFYT1TaXp6bGUubWF0Y2hlc1NlbGVjdG9yKSxvYS5zZWxlY3Rpb249ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2VsZWN0KHNhLmRvY3VtZW50RWxlbWVudCl9O3ZhciBBYT1vYS5zZWxlY3Rpb24ucHJvdG90eXBlPVtdO0FhLnNlbGVjdD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpPVtdO249QShuKTtmb3IodmFyIGE9LTEsbz10aGlzLmxlbmd0aDsrK2E8bzspe2kucHVzaCh0PVtdKSx0LnBhcmVudE5vZGU9KHI9dGhpc1thXSkucGFyZW50Tm9kZTtmb3IodmFyIGw9LTEsYz1yLmxlbmd0aDsrK2w8YzspKHU9cltsXSk/KHQucHVzaChlPW4uY2FsbCh1LHUuX19kYXRhX18sbCxhKSksZSYmIl9fZGF0YV9fImluIHUmJihlLl9fZGF0YV9fPXUuX19kYXRhX18pKTp0LnB1c2gobnVsbCl9cmV0dXJuIEUoaSl9LEFhLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHI9W107bj1DKG4pO2Zvcih2YXIgdT0tMSxpPXRoaXMubGVuZ3RoOysrdTxpOylmb3IodmFyIGE9dGhpc1t1XSxvPS0xLGw9YS5sZW5ndGg7KytvPGw7KShlPWFbb10pJiYoci5wdXNoKHQ9Y2Eobi5jYWxsKGUsZS5fX2RhdGFfXyxvLHUpKSksdC5wYXJlbnROb2RlPWUpO3JldHVybiBFKHIpfTt2YXIgQ2E9e3N2ZzoiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciLHhodG1sOiJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sIix4bGluazoiaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIseG1sOiJodHRwOi8vd3d3LnczLm9yZy9YTUwvMTk5OC9uYW1lc3BhY2UiLHhtbG5zOiJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zLyJ9O29hLm5zPXtwcmVmaXg6Q2EscXVhbGlmeTpmdW5jdGlvbihuKXt2YXIgdD1uLmluZGV4T2YoIjoiKSxlPW47cmV0dXJuIHQ+PTAmJiJ4bWxucyIhPT0oZT1uLnNsaWNlKDAsdCkpJiYobj1uLnNsaWNlKHQrMSkpLENhLmhhc093blByb3BlcnR5KGUpP3tzcGFjZTpDYVtlXSxsb2NhbDpufTpufX0sQWEuYXR0cj1mdW5jdGlvbihuLHQpe2lmKGFyZ3VtZW50cy5sZW5ndGg8Mil7aWYoInN0cmluZyI9PXR5cGVvZiBuKXt2YXIgZT10aGlzLm5vZGUoKTtyZXR1cm4gbj1vYS5ucy5xdWFsaWZ5KG4pLG4ubG9jYWw/ZS5nZXRBdHRyaWJ1dGVOUyhuLnNwYWNlLG4ubG9jYWwpOmUuZ2V0QXR0cmlidXRlKG4pfWZvcih0IGluIG4pdGhpcy5lYWNoKHoodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaCh6KG4sdCkpfSxBYS5jbGFzc2VkPWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pe3ZhciBlPXRoaXMubm9kZSgpLHI9KG49VChuKSkubGVuZ3RoLHU9LTE7aWYodD1lLmNsYXNzTGlzdCl7Zm9yKDsrK3U8cjspaWYoIXQuY29udGFpbnMoblt1XSkpcmV0dXJuITF9ZWxzZSBmb3IodD1lLmdldEF0dHJpYnV0ZSgiY2xhc3MiKTsrK3U8cjspaWYoIXEoblt1XSkudGVzdCh0KSlyZXR1cm4hMTtyZXR1cm4hMH1mb3IodCBpbiBuKXRoaXMuZWFjaChSKHQsblt0XSkpO3JldHVybiB0aGlzfXJldHVybiB0aGlzLmVhY2goUihuLHQpKX0sQWEuc3R5bGU9ZnVuY3Rpb24obixlLHIpe3ZhciB1PWFyZ3VtZW50cy5sZW5ndGg7aWYoMz51KXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+dSYmKGU9IiIpO2ZvcihyIGluIG4pdGhpcy5lYWNoKFAocixuW3JdLGUpKTtyZXR1cm4gdGhpc31pZigyPnUpe3ZhciBpPXRoaXMubm9kZSgpO3JldHVybiB0KGkpLmdldENvbXB1dGVkU3R5bGUoaSxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKG4pfXI9IiJ9cmV0dXJuIHRoaXMuZWFjaChQKG4sZSxyKSl9LEFhLnByb3BlcnR5PWZ1bmN0aW9uKG4sdCl7aWYoYXJndW1lbnRzLmxlbmd0aDwyKXtpZigic3RyaW5nIj09dHlwZW9mIG4pcmV0dXJuIHRoaXMubm9kZSgpW25dO2Zvcih0IGluIG4pdGhpcy5lYWNoKFUodCxuW3RdKSk7cmV0dXJuIHRoaXN9cmV0dXJuIHRoaXMuZWFjaChVKG4sdCkpfSxBYS50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3RoaXMuZWFjaCgiZnVuY3Rpb24iPT10eXBlb2Ygbj9mdW5jdGlvbigpe3ZhciB0PW4uYXBwbHkodGhpcyxhcmd1bWVudHMpO3RoaXMudGV4dENvbnRlbnQ9bnVsbD09dD8iIjp0fTpudWxsPT1uP2Z1bmN0aW9uKCl7dGhpcy50ZXh0Q29udGVudD0iIn06ZnVuY3Rpb24oKXt0aGlzLnRleHRDb250ZW50PW59KTp0aGlzLm5vZGUoKS50ZXh0Q29udGVudH0sQWEuaHRtbD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD90aGlzLmVhY2goImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24oKXt2YXIgdD1uLmFwcGx5KHRoaXMsYXJndW1lbnRzKTt0aGlzLmlubmVySFRNTD1udWxsPT10PyIiOnR9Om51bGw9PW4/ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD0iIn06ZnVuY3Rpb24oKXt0aGlzLmlubmVySFRNTD1ufSk6dGhpcy5ub2RlKCkuaW5uZXJIVE1MfSxBYS5hcHBlbmQ9ZnVuY3Rpb24obil7cmV0dXJuIG49aihuKSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmFwcGVuZENoaWxkKG4uYXBwbHkodGhpcyxhcmd1bWVudHMpKX0pfSxBYS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gbj1qKG4pLHQ9QSh0KSx0aGlzLnNlbGVjdChmdW5jdGlvbigpe3JldHVybiB0aGlzLmluc2VydEJlZm9yZShuLmFwcGx5KHRoaXMsYXJndW1lbnRzKSx0LmFwcGx5KHRoaXMsYXJndW1lbnRzKXx8bnVsbCl9KX0sQWEucmVtb3ZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChGKX0sQWEuZGF0YT1mdW5jdGlvbihuLHQpe2Z1bmN0aW9uIGUobixlKXt2YXIgcix1LGksYT1uLmxlbmd0aCxmPWUubGVuZ3RoLGg9TWF0aC5taW4oYSxmKSxnPW5ldyBBcnJheShmKSxwPW5ldyBBcnJheShmKSx2PW5ldyBBcnJheShhKTtpZih0KXt2YXIgZCxtPW5ldyBjLHk9bmV3IEFycmF5KGEpO2ZvcihyPS0xOysrcjxhOykodT1uW3JdKSYmKG0uaGFzKGQ9dC5jYWxsKHUsdS5fX2RhdGFfXyxyKSk/dltyXT11Om0uc2V0KGQsdSkseVtyXT1kKTtmb3Iocj0tMTsrK3I8ZjspKHU9bS5nZXQoZD10LmNhbGwoZSxpPWVbcl0scikpKT91IT09ITAmJihnW3JdPXUsdS5fX2RhdGFfXz1pKTpwW3JdPUgoaSksbS5zZXQoZCwhMCk7Zm9yKHI9LTE7KytyPGE7KXIgaW4geSYmbS5nZXQoeVtyXSkhPT0hMCYmKHZbcl09bltyXSl9ZWxzZXtmb3Iocj0tMTsrK3I8aDspdT1uW3JdLGk9ZVtyXSx1Pyh1Ll9fZGF0YV9fPWksZ1tyXT11KTpwW3JdPUgoaSk7Zm9yKDtmPnI7KytyKXBbcl09SChlW3JdKTtmb3IoO2E+cjsrK3IpdltyXT1uW3JdfXAudXBkYXRlPWcscC5wYXJlbnROb2RlPWcucGFyZW50Tm9kZT12LnBhcmVudE5vZGU9bi5wYXJlbnROb2RlLG8ucHVzaChwKSxsLnB1c2goZykscy5wdXNoKHYpfXZhciByLHUsaT0tMSxhPXRoaXMubGVuZ3RoO2lmKCFhcmd1bWVudHMubGVuZ3RoKXtmb3Iobj1uZXcgQXJyYXkoYT0ocj10aGlzWzBdKS5sZW5ndGgpOysraTxhOykodT1yW2ldKSYmKG5baV09dS5fX2RhdGFfXyk7cmV0dXJuIG59dmFyIG89WihbXSksbD1FKFtdKSxzPUUoW10pO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBuKWZvcig7KytpPGE7KWUocj10aGlzW2ldLG4uY2FsbChyLHIucGFyZW50Tm9kZS5fX2RhdGFfXyxpKSk7ZWxzZSBmb3IoOysraTxhOyllKHI9dGhpc1tpXSxuKTtyZXR1cm4gbC5lbnRlcj1mdW5jdGlvbigpe3JldHVybiBvfSxsLmV4aXQ9ZnVuY3Rpb24oKXtyZXR1cm4gc30sbH0sQWEuZGF0dW09ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/dGhpcy5wcm9wZXJ0eSgiX19kYXRhX18iLG4pOnRoaXMucHJvcGVydHkoIl9fZGF0YV9fIil9LEFhLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49TyhuKSk7Zm9yKHZhciBpPTAsYT10aGlzLmxlbmd0aDthPmk7aSsrKXt1LnB1c2godD1bXSksdC5wYXJlbnROb2RlPShlPXRoaXNbaV0pLnBhcmVudE5vZGU7Zm9yKHZhciBvPTAsbD1lLmxlbmd0aDtsPm87bysrKShyPWVbb10pJiZuLmNhbGwocixyLl9fZGF0YV9fLG8saSkmJnQucHVzaChyKX1yZXR1cm4gRSh1KX0sQWEub3JkZXI9ZnVuY3Rpb24oKXtmb3IodmFyIG49LTEsdD10aGlzLmxlbmd0aDsrK248dDspZm9yKHZhciBlLHI9dGhpc1tuXSx1PXIubGVuZ3RoLTEsaT1yW3VdOy0tdT49MDspKGU9clt1XSkmJihpJiZpIT09ZS5uZXh0U2libGluZyYmaS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShlLGkpLGk9ZSk7cmV0dXJuIHRoaXN9LEFhLnNvcnQ9ZnVuY3Rpb24obil7bj1JLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtmb3IodmFyIHQ9LTEsZT10aGlzLmxlbmd0aDsrK3Q8ZTspdGhpc1t0XS5zb3J0KG4pO3JldHVybiB0aGlzLm9yZGVyKCl9LEFhLmVhY2g9ZnVuY3Rpb24obil7cmV0dXJuIFkodGhpcyxmdW5jdGlvbih0LGUscil7bi5jYWxsKHQsdC5fX2RhdGFfXyxlLHIpfSl9LEFhLmNhbGw9ZnVuY3Rpb24obil7dmFyIHQ9Y2EoYXJndW1lbnRzKTtyZXR1cm4gbi5hcHBseSh0WzBdPXRoaXMsdCksdGhpc30sQWEuZW1wdHk9ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5ub2RlKCl9LEFhLm5vZGU9ZnVuY3Rpb24oKXtmb3IodmFyIG49MCx0PXRoaXMubGVuZ3RoO3Q+bjtuKyspZm9yKHZhciBlPXRoaXNbbl0scj0wLHU9ZS5sZW5ndGg7dT5yO3IrKyl7dmFyIGk9ZVtyXTtpZihpKXJldHVybiBpfXJldHVybiBudWxsfSxBYS5zaXplPWZ1bmN0aW9uKCl7dmFyIG49MDtyZXR1cm4gWSh0aGlzLGZ1bmN0aW9uKCl7KytufSksbn07dmFyIHphPVtdO29hLnNlbGVjdGlvbi5lbnRlcj1aLG9hLnNlbGVjdGlvbi5lbnRlci5wcm90b3R5cGU9emEsemEuYXBwZW5kPUFhLmFwcGVuZCx6YS5lbXB0eT1BYS5lbXB0eSx6YS5ub2RlPUFhLm5vZGUsemEuY2FsbD1BYS5jYWxsLHphLnNpemU9QWEuc2l6ZSx6YS5zZWxlY3Q9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscix1LGksYT1bXSxvPS0xLGw9dGhpcy5sZW5ndGg7KytvPGw7KXtyPSh1PXRoaXNbb10pLnVwZGF0ZSxhLnB1c2godD1bXSksdC5wYXJlbnROb2RlPXUucGFyZW50Tm9kZTtmb3IodmFyIGM9LTEscz11Lmxlbmd0aDsrK2M8czspKGk9dVtjXSk/KHQucHVzaChyW2NdPWU9bi5jYWxsKHUucGFyZW50Tm9kZSxpLl9fZGF0YV9fLGMsbykpLGUuX19kYXRhX189aS5fX2RhdGFfXyk6dC5wdXNoKG51bGwpfXJldHVybiBFKGEpfSx6YS5pbnNlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwyJiYodD1WKHRoaXMpKSxBYS5pbnNlcnQuY2FsbCh0aGlzLG4sdCl9LG9hLnNlbGVjdD1mdW5jdGlvbih0KXt2YXIgZTtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/KGU9W2thKHQsc2EpXSxlLnBhcmVudE5vZGU9c2EuZG9jdW1lbnRFbGVtZW50KTooZT1bdF0sZS5wYXJlbnROb2RlPW4odCkpLEUoW2VdKX0sb2Euc2VsZWN0QWxsPWZ1bmN0aW9uKG4pe3ZhciB0O3JldHVybiJzdHJpbmciPT10eXBlb2Ygbj8odD1jYShOYShuLHNhKSksdC5wYXJlbnROb2RlPXNhLmRvY3VtZW50RWxlbWVudCk6KHQ9Y2EobiksdC5wYXJlbnROb2RlPW51bGwpLEUoW3RdKX0sQWEub249ZnVuY3Rpb24obix0LGUpe3ZhciByPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5yKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+ciYmKHQ9ITEpO2ZvcihlIGluIG4pdGhpcy5lYWNoKFgoZSxuW2VdLHQpKTtyZXR1cm4gdGhpc31pZigyPnIpcmV0dXJuKHI9dGhpcy5ub2RlKClbIl9fb24iK25dKSYmci5fO2U9ITF9cmV0dXJuIHRoaXMuZWFjaChYKG4sdCxlKSl9O3ZhciBMYT1vYS5tYXAoe21vdXNlZW50ZXI6Im1vdXNlb3ZlciIsbW91c2VsZWF2ZToibW91c2VvdXQifSk7c2EmJkxhLmZvckVhY2goZnVuY3Rpb24obil7Im9uIituIGluIHNhJiZMYS5yZW1vdmUobil9KTt2YXIgcWEsVGE9MDtvYS5tb3VzZT1mdW5jdGlvbihuKXtyZXR1cm4gSihuLGsoKSl9O3ZhciBSYT10aGlzLm5hdmlnYXRvciYmL1dlYktpdC8udGVzdCh0aGlzLm5hdmlnYXRvci51c2VyQWdlbnQpPy0xOjA7b2EudG91Y2g9ZnVuY3Rpb24obix0LGUpe2lmKGFyZ3VtZW50cy5sZW5ndGg8MyYmKGU9dCx0PWsoKS5jaGFuZ2VkVG91Y2hlcyksdClmb3IodmFyIHIsdT0wLGk9dC5sZW5ndGg7aT51OysrdSlpZigocj10W3VdKS5pZGVudGlmaWVyPT09ZSlyZXR1cm4gSihuLHIpfSxvYS5iZWhhdmlvci5kcmFnPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3RoaXMub24oIm1vdXNlZG93bi5kcmFnIixpKS5vbigidG91Y2hzdGFydC5kcmFnIixhKX1mdW5jdGlvbiBlKG4sdCxlLGksYSl7cmV0dXJuIGZ1bmN0aW9uKCl7ZnVuY3Rpb24gbygpe3ZhciBuLGUscj10KGgsdik7ciYmKG49clswXS1NWzBdLGU9clsxXS1NWzFdLHB8PW58ZSxNPXIsZyh7dHlwZToiZHJhZyIseDpyWzBdK2NbMF0seTpyWzFdK2NbMV0sZHg6bixkeTplfSkpfWZ1bmN0aW9uIGwoKXt0KGgsdikmJihtLm9uKGkrZCxudWxsKS5vbihhK2QsbnVsbCkseShwKSxnKHt0eXBlOiJkcmFnZW5kIn0pKX12YXIgYyxzPXRoaXMsZj1vYS5ldmVudC50YXJnZXQsaD1zLnBhcmVudE5vZGUsZz1yLm9mKHMsYXJndW1lbnRzKSxwPTAsdj1uKCksZD0iLmRyYWciKyhudWxsPT12PyIiOiItIit2KSxtPW9hLnNlbGVjdChlKGYpKS5vbihpK2Qsbykub24oYStkLGwpLHk9VyhmKSxNPXQoaCx2KTt1PyhjPXUuYXBwbHkocyxhcmd1bWVudHMpLGM9W2MueC1NWzBdLGMueS1NWzFdXSk6Yz1bMCwwXSxnKHt0eXBlOiJkcmFnc3RhcnQifSl9fXZhciByPU4obiwiZHJhZyIsImRyYWdzdGFydCIsImRyYWdlbmQiKSx1PW51bGwsaT1lKGIsb2EubW91c2UsdCwibW91c2Vtb3ZlIiwibW91c2V1cCIpLGE9ZShHLG9hLnRvdWNoLHksInRvdWNobW92ZSIsInRvdWNoZW5kIik7cmV0dXJuIG4ub3JpZ2luPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PXQsbik6dX0sb2EucmViaW5kKG4sciwib24iKX0sb2EudG91Y2hlcz1mdW5jdGlvbihuLHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDImJih0PWsoKS50b3VjaGVzKSx0P2NhKHQpLm1hcChmdW5jdGlvbih0KXt2YXIgZT1KKG4sdCk7cmV0dXJuIGUuaWRlbnRpZmllcj10LmlkZW50aWZpZXIsZX0pOltdfTt2YXIgRGE9MWUtNixQYT1EYSpEYSxVYT1NYXRoLlBJLGphPTIqVWEsRmE9amEtRGEsSGE9VWEvMixPYT1VYS8xODAsSWE9MTgwL1VhLFlhPU1hdGguU1FSVDIsWmE9MixWYT00O29hLmludGVycG9sYXRlWm9vbT1mdW5jdGlvbihuLHQpe3ZhciBlLHIsdT1uWzBdLGk9blsxXSxhPW5bMl0sbz10WzBdLGw9dFsxXSxjPXRbMl0scz1vLXUsZj1sLWksaD1zKnMrZipmO2lmKFBhPmgpcj1NYXRoLmxvZyhjL2EpL1lhLGU9ZnVuY3Rpb24obil7cmV0dXJuW3UrbipzLGkrbipmLGEqTWF0aC5leHAoWWEqbipyKV19O2Vsc2V7dmFyIGc9TWF0aC5zcXJ0KGgpLHA9KGMqYy1hKmErVmEqaCkvKDIqYSpaYSpnKSx2PShjKmMtYSphLVZhKmgpLygyKmMqWmEqZyksZD1NYXRoLmxvZyhNYXRoLnNxcnQocCpwKzEpLXApLG09TWF0aC5sb2coTWF0aC5zcXJ0KHYqdisxKS12KTtyPShtLWQpL1lhLGU9ZnVuY3Rpb24obil7dmFyIHQ9bipyLGU9cm4oZCksbz1hLyhaYSpnKSooZSp1bihZYSp0K2QpLWVuKGQpKTtyZXR1cm5bdStvKnMsaStvKmYsYSplL3JuKFlhKnQrZCldfX1yZXR1cm4gZS5kdXJhdGlvbj0xZTMqcixlfSxvYS5iZWhhdmlvci56b29tPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtuLm9uKEwsZikub24oJGErIi56b29tIixnKS5vbigiZGJsY2xpY2suem9vbSIscCkub24oUixoKX1mdW5jdGlvbiBlKG4pe3JldHVyblsoblswXS1rLngpL2suaywoblsxXS1rLnkpL2sua119ZnVuY3Rpb24gcihuKXtyZXR1cm5bblswXSprLmsray54LG5bMV0qay5rK2sueV19ZnVuY3Rpb24gdShuKXtrLms9TWF0aC5tYXgoQVswXSxNYXRoLm1pbihBWzFdLG4pKX1mdW5jdGlvbiBpKG4sdCl7dD1yKHQpLGsueCs9blswXS10WzBdLGsueSs9blsxXS10WzFdfWZ1bmN0aW9uIGEodCxlLHIsYSl7dC5fX2NoYXJ0X189e3g6ay54LHk6ay55LGs6ay5rfSx1KE1hdGgucG93KDIsYSkpLGkoZD1lLHIpLHQ9b2Euc2VsZWN0KHQpLEM+MCYmKHQ9dC50cmFuc2l0aW9uKCkuZHVyYXRpb24oQykpLHQuY2FsbChuLmV2ZW50KX1mdW5jdGlvbiBvKCl7YiYmYi5kb21haW4oeC5yYW5nZSgpLm1hcChmdW5jdGlvbihuKXtyZXR1cm4obi1rLngpL2sua30pLm1hcCh4LmludmVydCkpLHcmJncuZG9tYWluKF8ucmFuZ2UoKS5tYXAoZnVuY3Rpb24obil7cmV0dXJuKG4tay55KS9rLmt9KS5tYXAoXy5pbnZlcnQpKX1mdW5jdGlvbiBsKG4pe3orK3x8bih7dHlwZToiem9vbXN0YXJ0In0pfWZ1bmN0aW9uIGMobil7bygpLG4oe3R5cGU6Inpvb20iLHNjYWxlOmsuayx0cmFuc2xhdGU6W2sueCxrLnldfSl9ZnVuY3Rpb24gcyhuKXstLXp8fChuKHt0eXBlOiJ6b29tZW5kIn0pLGQ9bnVsbCl9ZnVuY3Rpb24gZigpe2Z1bmN0aW9uIG4oKXtvPTEsaShvYS5tb3VzZSh1KSxoKSxjKGEpfWZ1bmN0aW9uIHIoKXtmLm9uKHEsbnVsbCkub24oVCxudWxsKSxnKG8pLHMoYSl9dmFyIHU9dGhpcyxhPUQub2YodSxhcmd1bWVudHMpLG89MCxmPW9hLnNlbGVjdCh0KHUpKS5vbihxLG4pLm9uKFQsciksaD1lKG9hLm1vdXNlKHUpKSxnPVcodSk7T2wuY2FsbCh1KSxsKGEpfWZ1bmN0aW9uIGgoKXtmdW5jdGlvbiBuKCl7dmFyIG49b2EudG91Y2hlcyhwKTtyZXR1cm4gZz1rLmssbi5mb3JFYWNoKGZ1bmN0aW9uKG4pe24uaWRlbnRpZmllciBpbiBkJiYoZFtuLmlkZW50aWZpZXJdPWUobikpfSksbn1mdW5jdGlvbiB0KCl7dmFyIHQ9b2EuZXZlbnQudGFyZ2V0O29hLnNlbGVjdCh0KS5vbih4LHIpLm9uKGIsbyksXy5wdXNoKHQpO2Zvcih2YXIgZT1vYS5ldmVudC5jaGFuZ2VkVG91Y2hlcyx1PTAsaT1lLmxlbmd0aDtpPnU7Kyt1KWRbZVt1XS5pZGVudGlmaWVyXT1udWxsO3ZhciBsPW4oKSxjPURhdGUubm93KCk7aWYoMT09PWwubGVuZ3RoKXtpZig1MDA+Yy1NKXt2YXIgcz1sWzBdO2EocCxzLGRbcy5pZGVudGlmaWVyXSxNYXRoLmZsb29yKE1hdGgubG9nKGsuaykvTWF0aC5MTjIpKzEpLFMoKX1NPWN9ZWxzZSBpZihsLmxlbmd0aD4xKXt2YXIgcz1sWzBdLGY9bFsxXSxoPXNbMF0tZlswXSxnPXNbMV0tZlsxXTttPWgqaCtnKmd9fWZ1bmN0aW9uIHIoKXt2YXIgbix0LGUscixhPW9hLnRvdWNoZXMocCk7T2wuY2FsbChwKTtmb3IodmFyIG89MCxsPWEubGVuZ3RoO2w+bzsrK28scj1udWxsKWlmKGU9YVtvXSxyPWRbZS5pZGVudGlmaWVyXSl7aWYodClicmVhaztuPWUsdD1yfWlmKHIpe3ZhciBzPShzPWVbMF0tblswXSkqcysocz1lWzFdLW5bMV0pKnMsZj1tJiZNYXRoLnNxcnQocy9tKTtuPVsoblswXStlWzBdKS8yLChuWzFdK2VbMV0pLzJdLHQ9Wyh0WzBdK3JbMF0pLzIsKHRbMV0rclsxXSkvMl0sdShmKmcpfU09bnVsbCxpKG4sdCksYyh2KX1mdW5jdGlvbiBvKCl7aWYob2EuZXZlbnQudG91Y2hlcy5sZW5ndGgpe2Zvcih2YXIgdD1vYS5ldmVudC5jaGFuZ2VkVG91Y2hlcyxlPTAscj10Lmxlbmd0aDtyPmU7KytlKWRlbGV0ZSBkW3RbZV0uaWRlbnRpZmllcl07Zm9yKHZhciB1IGluIGQpcmV0dXJuIHZvaWQgbigpfW9hLnNlbGVjdEFsbChfKS5vbih5LG51bGwpLHcub24oTCxmKS5vbihSLGgpLE4oKSxzKHYpfXZhciBnLHA9dGhpcyx2PUQub2YocCxhcmd1bWVudHMpLGQ9e30sbT0wLHk9Ii56b29tLSIrb2EuZXZlbnQuY2hhbmdlZFRvdWNoZXNbMF0uaWRlbnRpZmllcix4PSJ0b3VjaG1vdmUiK3ksYj0idG91Y2hlbmQiK3ksXz1bXSx3PW9hLnNlbGVjdChwKSxOPVcocCk7dCgpLGwodiksdy5vbihMLG51bGwpLm9uKFIsdCl9ZnVuY3Rpb24gZygpe3ZhciBuPUQub2YodGhpcyxhcmd1bWVudHMpO3k/Y2xlYXJUaW1lb3V0KHkpOihPbC5jYWxsKHRoaXMpLHY9ZShkPW18fG9hLm1vdXNlKHRoaXMpKSxsKG4pKSx5PXNldFRpbWVvdXQoZnVuY3Rpb24oKXt5PW51bGwscyhuKX0sNTApLFMoKSx1KE1hdGgucG93KDIsLjAwMipYYSgpKSprLmspLGkoZCx2KSxjKG4pfWZ1bmN0aW9uIHAoKXt2YXIgbj1vYS5tb3VzZSh0aGlzKSx0PU1hdGgubG9nKGsuaykvTWF0aC5MTjI7YSh0aGlzLG4sZShuKSxvYS5ldmVudC5zaGlmdEtleT9NYXRoLmNlaWwodCktMTpNYXRoLmZsb29yKHQpKzEpfXZhciB2LGQsbSx5LE0seCxiLF8sdyxrPXt4OjAseTowLGs6MX0sRT1bOTYwLDUwMF0sQT1CYSxDPTI1MCx6PTAsTD0ibW91c2Vkb3duLnpvb20iLHE9Im1vdXNlbW92ZS56b29tIixUPSJtb3VzZXVwLnpvb20iLFI9InRvdWNoc3RhcnQuem9vbSIsRD1OKG4sInpvb21zdGFydCIsInpvb20iLCJ6b29tZW5kIik7cmV0dXJuICRhfHwoJGE9Im9ud2hlZWwiaW4gc2E/KFhhPWZ1bmN0aW9uKCl7cmV0dXJuLW9hLmV2ZW50LmRlbHRhWSoob2EuZXZlbnQuZGVsdGFNb2RlPzEyMDoxKX0sIndoZWVsIik6Im9ubW91c2V3aGVlbCJpbiBzYT8oWGE9ZnVuY3Rpb24oKXtyZXR1cm4gb2EuZXZlbnQud2hlZWxEZWx0YX0sIm1vdXNld2hlZWwiKTooWGE9ZnVuY3Rpb24oKXtyZXR1cm4tb2EuZXZlbnQuZGV0YWlsfSwiTW96TW91c2VQaXhlbFNjcm9sbCIpKSxuLmV2ZW50PWZ1bmN0aW9uKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuPUQub2YodGhpcyxhcmd1bWVudHMpLHQ9aztGbD9vYS5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0Lnpvb20iLGZ1bmN0aW9uKCl7az10aGlzLl9fY2hhcnRfX3x8e3g6MCx5OjAsazoxfSxsKG4pfSkudHdlZW4oInpvb206em9vbSIsZnVuY3Rpb24oKXt2YXIgZT1FWzBdLHI9RVsxXSx1PWQ/ZFswXTplLzIsaT1kP2RbMV06ci8yLGE9b2EuaW50ZXJwb2xhdGVab29tKFsodS1rLngpL2suaywoaS1rLnkpL2suayxlL2sua10sWyh1LXQueCkvdC5rLChpLXQueSkvdC5rLGUvdC5rXSk7cmV0dXJuIGZ1bmN0aW9uKHQpe3ZhciByPWEodCksbz1lL3JbMl07dGhpcy5fX2NoYXJ0X189az17eDp1LXJbMF0qbyx5OmktclsxXSpvLGs6b30sYyhuKX19KS5lYWNoKCJpbnRlcnJ1cHQuem9vbSIsZnVuY3Rpb24oKXtzKG4pfSkuZWFjaCgiZW5kLnpvb20iLGZ1bmN0aW9uKCl7cyhuKX0pOih0aGlzLl9fY2hhcnRfXz1rLGwobiksYyhuKSxzKG4pKX0pfSxuLnRyYW5zbGF0ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaz17eDordFswXSx5Oit0WzFdLGs6ay5rfSxvKCksbik6W2sueCxrLnldfSxuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhrPXt4OmsueCx5OmsueSxrOm51bGx9LHUoK3QpLG8oKSxuKTprLmt9LG4uc2NhbGVFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KEE9bnVsbD09dD9CYTpbK3RbMF0sK3RbMV1dLG4pOkF9LG4uY2VudGVyPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhtPXQmJlsrdFswXSwrdFsxXV0sbik6bX0sbi5zaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhFPXQmJlsrdFswXSwrdFsxXV0sbik6RX0sbi5kdXJhdGlvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oQz0rdCxuKTpDfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGI9dCx4PXQuY29weSgpLGs9e3g6MCx5OjAsazoxfSxuKTpifSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHc9dCxfPXQuY29weSgpLGs9e3g6MCx5OjAsazoxfSxuKTp3fSxvYS5yZWJpbmQobixELCJvbiIpfTt2YXIgWGEsJGEsQmE9WzAsMS8wXTtvYS5jb2xvcj1vbixvbi5wcm90b3R5cGUudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5yZ2IoKSsiIn0sb2EuaHNsPWxuO3ZhciBXYT1sbi5wcm90b3R5cGU9bmV3IG9uO1dhLmJyaWdodGVyPWZ1bmN0aW9uKG4pe3JldHVybiBuPU1hdGgucG93KC43LGFyZ3VtZW50cy5sZW5ndGg/bjoxKSxuZXcgbG4odGhpcy5oLHRoaXMucyx0aGlzLmwvbil9LFdhLmRhcmtlcj1mdW5jdGlvbihuKXtyZXR1cm4gbj1NYXRoLnBvdyguNyxhcmd1bWVudHMubGVuZ3RoP246MSksbmV3IGxuKHRoaXMuaCx0aGlzLnMsbip0aGlzLmwpfSxXYS5yZ2I9ZnVuY3Rpb24oKXtyZXR1cm4gY24odGhpcy5oLHRoaXMucyx0aGlzLmwpfSxvYS5oY2w9c247dmFyIEphPXNuLnByb3RvdHlwZT1uZXcgb247SmEuYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBzbih0aGlzLmgsdGhpcy5jLE1hdGgubWluKDEwMCx0aGlzLmwrR2EqKGFyZ3VtZW50cy5sZW5ndGg/bjoxKSkpfSxKYS5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBzbih0aGlzLmgsdGhpcy5jLE1hdGgubWF4KDAsdGhpcy5sLUdhKihhcmd1bWVudHMubGVuZ3RoP246MSkpKX0sSmEucmdiPWZ1bmN0aW9uKCl7cmV0dXJuIGZuKHRoaXMuaCx0aGlzLmMsdGhpcy5sKS5yZ2IoKX0sb2EubGFiPWhuO3ZhciBHYT0xOCxLYT0uOTUwNDcsUWE9MSxubz0xLjA4ODgzLHRvPWhuLnByb3RvdHlwZT1uZXcgb247dG8uYnJpZ2h0ZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBobihNYXRoLm1pbigxMDAsdGhpcy5sK0dhKihhcmd1bWVudHMubGVuZ3RoP246MSkpLHRoaXMuYSx0aGlzLmIpfSx0by5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG5ldyBobihNYXRoLm1heCgwLHRoaXMubC1HYSooYXJndW1lbnRzLmxlbmd0aD9uOjEpKSx0aGlzLmEsdGhpcy5iKX0sdG8ucmdiPWZ1bmN0aW9uKCl7cmV0dXJuIGduKHRoaXMubCx0aGlzLmEsdGhpcy5iKX0sb2EucmdiPXluO3ZhciBlbz15bi5wcm90b3R5cGU9bmV3IG9uO2VvLmJyaWdodGVyPWZ1bmN0aW9uKG4pe249TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpO3ZhciB0PXRoaXMucixlPXRoaXMuZyxyPXRoaXMuYix1PTMwO3JldHVybiB0fHxlfHxyPyh0JiZ1PnQmJih0PXUpLGUmJnU+ZSYmKGU9dSksciYmdT5yJiYocj11KSxuZXcgeW4oTWF0aC5taW4oMjU1LHQvbiksTWF0aC5taW4oMjU1LGUvbiksTWF0aC5taW4oMjU1LHIvbikpKTpuZXcgeW4odSx1LHUpfSxlby5kYXJrZXI9ZnVuY3Rpb24obil7cmV0dXJuIG49TWF0aC5wb3coLjcsYXJndW1lbnRzLmxlbmd0aD9uOjEpLG5ldyB5bihuKnRoaXMucixuKnRoaXMuZyxuKnRoaXMuYil9LGVvLmhzbD1mdW5jdGlvbigpe3JldHVybiB3bih0aGlzLnIsdGhpcy5nLHRoaXMuYil9LGVvLnRvU3RyaW5nPWZ1bmN0aW9uKCl7cmV0dXJuIiMiK2JuKHRoaXMucikrYm4odGhpcy5nKStibih0aGlzLmIpfTt2YXIgcm89b2EubWFwKHthbGljZWJsdWU6MTU3OTIzODMsYW50aXF1ZXdoaXRlOjE2NDQ0Mzc1LGFxdWE6NjU1MzUsYXF1YW1hcmluZTo4Mzg4NTY0LGF6dXJlOjE1Nzk0MTc1LGJlaWdlOjE2MTE5MjYwLGJpc3F1ZToxNjc3MDI0NCxibGFjazowLGJsYW5jaGVkYWxtb25kOjE2NzcyMDQ1LGJsdWU6MjU1LGJsdWV2aW9sZXQ6OTA1NTIwMixicm93bjoxMDgyNDIzNCxidXJseXdvb2Q6MTQ1OTYyMzEsY2FkZXRibHVlOjYyNjY1MjgsY2hhcnRyZXVzZTo4Mzg4MzUyLGNob2NvbGF0ZToxMzc4OTQ3MCxjb3JhbDoxNjc0NDI3Mixjb3JuZmxvd2VyYmx1ZTo2NTkxOTgxLGNvcm5zaWxrOjE2Nzc1Mzg4LGNyaW1zb246MTQ0MjMxMDAsY3lhbjo2NTUzNSxkYXJrYmx1ZToxMzksZGFya2N5YW46MzU3MjMsZGFya2dvbGRlbnJvZDoxMjA5MjkzOSxkYXJrZ3JheToxMTExOTAxNyxkYXJrZ3JlZW46MjU2MDAsZGFya2dyZXk6MTExMTkwMTcsZGFya2toYWtpOjEyNDMzMjU5LGRhcmttYWdlbnRhOjkxMDk2NDMsZGFya29saXZlZ3JlZW46NTU5Nzk5OSxkYXJrb3JhbmdlOjE2NzQ3NTIwLGRhcmtvcmNoaWQ6MTAwNDAwMTIsZGFya3JlZDo5MTA5NTA0LGRhcmtzYWxtb246MTUzMDg0MTAsZGFya3NlYWdyZWVuOjk0MTk5MTksZGFya3NsYXRlYmx1ZTo0NzM0MzQ3LGRhcmtzbGF0ZWdyYXk6MzEwMDQ5NSxkYXJrc2xhdGVncmV5OjMxMDA0OTUsZGFya3R1cnF1b2lzZTo1Mjk0NSxkYXJrdmlvbGV0Ojk2OTk1MzksZGVlcHBpbms6MTY3MTY5NDcsZGVlcHNreWJsdWU6NDkxNTEsZGltZ3JheTo2OTA4MjY1LGRpbWdyZXk6NjkwODI2NSxkb2RnZXJibHVlOjIwMDMxOTksZmlyZWJyaWNrOjExNjc0MTQ2LGZsb3JhbHdoaXRlOjE2Nzc1OTIwLGZvcmVzdGdyZWVuOjIyNjM4NDIsZnVjaHNpYToxNjcxMTkzNSxnYWluc2Jvcm86MTQ0NzQ0NjAsZ2hvc3R3aGl0ZToxNjMxNjY3MSxnb2xkOjE2NzY2NzIwLGdvbGRlbnJvZDoxNDMyOTEyMCxncmF5Ojg0MjE1MDQsZ3JlZW46MzI3NjgsZ3JlZW55ZWxsb3c6MTE0MDMwNTUsZ3JleTo4NDIxNTA0LGhvbmV5ZGV3OjE1Nzk0MTYwLGhvdHBpbms6MTY3Mzg3NDAsaW5kaWFucmVkOjEzNDU4NTI0LGluZGlnbzo0OTE1MzMwLGl2b3J5OjE2Nzc3MjAwLGtoYWtpOjE1Nzg3NjYwLGxhdmVuZGVyOjE1MTMyNDEwLGxhdmVuZGVyYmx1c2g6MTY3NzMzNjUsbGF3bmdyZWVuOjgxOTA5NzYsbGVtb25jaGlmZm9uOjE2Nzc1ODg1LGxpZ2h0Ymx1ZToxMTM5MzI1NCxsaWdodGNvcmFsOjE1NzYxNTM2LGxpZ2h0Y3lhbjoxNDc0NTU5OSxsaWdodGdvbGRlbnJvZHllbGxvdzoxNjQ0ODIxMCxsaWdodGdyYXk6MTM4ODIzMjMsbGlnaHRncmVlbjo5NDk4MjU2LGxpZ2h0Z3JleToxMzg4MjMyMyxsaWdodHBpbms6MTY3NTg0NjUsbGlnaHRzYWxtb246MTY3NTI3NjIsbGlnaHRzZWFncmVlbjoyMTQyODkwLGxpZ2h0c2t5Ymx1ZTo4OTAwMzQ2LGxpZ2h0c2xhdGVncmF5Ojc4MzM3NTMsbGlnaHRzbGF0ZWdyZXk6NzgzMzc1MyxsaWdodHN0ZWVsYmx1ZToxMTU4NDczNCxsaWdodHllbGxvdzoxNjc3NzE4NCxsaW1lOjY1MjgwLGxpbWVncmVlbjozMzI5MzMwLGxpbmVuOjE2NDQ1NjcwLG1hZ2VudGE6MTY3MTE5MzUsbWFyb29uOjgzODg2MDgsbWVkaXVtYXF1YW1hcmluZTo2NzM3MzIyLG1lZGl1bWJsdWU6MjA1LG1lZGl1bW9yY2hpZDoxMjIxMTY2NyxtZWRpdW1wdXJwbGU6OTY2MjY4MyxtZWRpdW1zZWFncmVlbjozOTc4MDk3LG1lZGl1bXNsYXRlYmx1ZTo4MDg3NzkwLG1lZGl1bXNwcmluZ2dyZWVuOjY0MTU0LG1lZGl1bXR1cnF1b2lzZTo0NzcyMzAwLG1lZGl1bXZpb2xldHJlZDoxMzA0NzE3MyxtaWRuaWdodGJsdWU6MTY0NDkxMixtaW50Y3JlYW06MTYxMjE4NTAsbWlzdHlyb3NlOjE2NzcwMjczLG1vY2Nhc2luOjE2NzcwMjI5LG5hdmFqb3doaXRlOjE2NzY4Njg1LG5hdnk6MTI4LG9sZGxhY2U6MTY2NDM1NTgsb2xpdmU6ODQyMTM3NixvbGl2ZWRyYWI6NzA0ODczOSxvcmFuZ2U6MTY3NTM5MjAsb3JhbmdlcmVkOjE2NzI5MzQ0LG9yY2hpZDoxNDMxNTczNCxwYWxlZ29sZGVucm9kOjE1NjU3MTMwLHBhbGVncmVlbjoxMDAyNTg4MCxwYWxldHVycXVvaXNlOjExNTI5OTY2LHBhbGV2aW9sZXRyZWQ6MTQzODEyMDMscGFwYXlhd2hpcDoxNjc3MzA3NyxwZWFjaHB1ZmY6MTY3Njc2NzMscGVydToxMzQ2ODk5MSxwaW5rOjE2NzYxMDM1LHBsdW06MTQ1MjQ2MzcscG93ZGVyYmx1ZToxMTU5MTkxMCxwdXJwbGU6ODM4ODczNixyZWJlY2NhcHVycGxlOjY2OTc4ODEscmVkOjE2NzExNjgwLHJvc3licm93bjoxMjM1NzUxOSxyb3lhbGJsdWU6NDI4Njk0NSxzYWRkbGVicm93bjo5MTI3MTg3LHNhbG1vbjoxNjQxNjg4MixzYW5keWJyb3duOjE2MDMyODY0LHNlYWdyZWVuOjMwNTAzMjcsc2Vhc2hlbGw6MTY3NzQ2Mzgsc2llbm5hOjEwNTA2Nzk3LHNpbHZlcjoxMjYzMjI1Nixza3libHVlOjg5MDAzMzEsc2xhdGVibHVlOjY5NzAwNjEsc2xhdGVncmF5OjczNzI5NDQsc2xhdGVncmV5OjczNzI5NDQsc25vdzoxNjc3NTkzMCxzcHJpbmdncmVlbjo2NTQwNyxzdGVlbGJsdWU6NDYyMDk4MCx0YW46MTM4MDg3ODAsdGVhbDozMjg5Nix0aGlzdGxlOjE0MjA0ODg4LHRvbWF0bzoxNjczNzA5NSx0dXJxdW9pc2U6NDI1MTg1Nix2aW9sZXQ6MTU2MzEwODYsd2hlYXQ6MTYxMTMzMzEsd2hpdGU6MTY3NzcyMTUsd2hpdGVzbW9rZToxNjExOTI4NSx5ZWxsb3c6MTY3NzY5NjAseWVsbG93Z3JlZW46MTAxNDUwNzR9KTtyby5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7cm8uc2V0KG4sTW4odCkpfSksb2EuZnVuY3Rvcj1FbixvYS54aHI9QW4oeSksb2EuZHN2PWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZShuLGUsaSl7YXJndW1lbnRzLmxlbmd0aDwzJiYoaT1lLGU9bnVsbCk7dmFyIGE9Q24obix0LG51bGw9PWU/cjp1KGUpLGkpO3JldHVybiBhLnJvdz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD9hLnJlc3BvbnNlKG51bGw9PShlPW4pP3I6dShuKSk6ZX0sYX1mdW5jdGlvbiByKG4pe3JldHVybiBlLnBhcnNlKG4ucmVzcG9uc2VUZXh0KX1mdW5jdGlvbiB1KG4pe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZS5wYXJzZSh0LnJlc3BvbnNlVGV4dCxuKX19ZnVuY3Rpb24gaSh0KXtyZXR1cm4gdC5tYXAoYSkuam9pbihuKX1mdW5jdGlvbiBhKG4pe3JldHVybiBvLnRlc3Qobik/JyInK24ucmVwbGFjZSgvXCIvZywnIiInKSsnIic6bn12YXIgbz1uZXcgUmVnRXhwKCdbIicrbisiXG5dIiksbD1uLmNoYXJDb2RlQXQoMCk7cmV0dXJuIGUucGFyc2U9ZnVuY3Rpb24obix0KXt2YXIgcjtyZXR1cm4gZS5wYXJzZVJvd3MobixmdW5jdGlvbihuLGUpe2lmKHIpcmV0dXJuIHIobixlLTEpO3ZhciB1PW5ldyBGdW5jdGlvbigiZCIsInJldHVybiB7IituLm1hcChmdW5jdGlvbihuLHQpe3JldHVybiBKU09OLnN0cmluZ2lmeShuKSsiOiBkWyIrdCsiXSJ9KS5qb2luKCIsIikrIn0iKTtyPXQ/ZnVuY3Rpb24obixlKXtyZXR1cm4gdCh1KG4pLGUpfTp1fSl9LGUucGFyc2VSb3dzPWZ1bmN0aW9uKG4sdCl7ZnVuY3Rpb24gZSgpe2lmKHM+PWMpcmV0dXJuIGE7aWYodSlyZXR1cm4gdT0hMSxpO3ZhciB0PXM7aWYoMzQ9PT1uLmNoYXJDb2RlQXQodCkpe2Zvcih2YXIgZT10O2UrKzxjOylpZigzND09PW4uY2hhckNvZGVBdChlKSl7aWYoMzQhPT1uLmNoYXJDb2RlQXQoZSsxKSlicmVhazsrK2V9cz1lKzI7dmFyIHI9bi5jaGFyQ29kZUF0KGUrMSk7cmV0dXJuIDEzPT09cj8odT0hMCwxMD09PW4uY2hhckNvZGVBdChlKzIpJiYrK3MpOjEwPT09ciYmKHU9ITApLG4uc2xpY2UodCsxLGUpLnJlcGxhY2UoLyIiL2csJyInKX1mb3IoO2M+czspe3ZhciByPW4uY2hhckNvZGVBdChzKyspLG89MTtpZigxMD09PXIpdT0hMDtlbHNlIGlmKDEzPT09cil1PSEwLDEwPT09bi5jaGFyQ29kZUF0KHMpJiYoKytzLCsrbyk7ZWxzZSBpZihyIT09bCljb250aW51ZTtyZXR1cm4gbi5zbGljZSh0LHMtbyl9cmV0dXJuIG4uc2xpY2UodCl9Zm9yKHZhciByLHUsaT17fSxhPXt9LG89W10sYz1uLmxlbmd0aCxzPTAsZj0wOyhyPWUoKSkhPT1hOyl7Zm9yKHZhciBoPVtdO3IhPT1pJiZyIT09YTspaC5wdXNoKHIpLHI9ZSgpO3QmJm51bGw9PShoPXQoaCxmKyspKXx8by5wdXNoKGgpfXJldHVybiBvfSxlLmZvcm1hdD1mdW5jdGlvbih0KXtpZihBcnJheS5pc0FycmF5KHRbMF0pKXJldHVybiBlLmZvcm1hdFJvd3ModCk7dmFyIHI9bmV3IG0sdT1bXTtyZXR1cm4gdC5mb3JFYWNoKGZ1bmN0aW9uKG4pe2Zvcih2YXIgdCBpbiBuKXIuaGFzKHQpfHx1LnB1c2goci5hZGQodCkpfSksW3UubWFwKGEpLmpvaW4obildLmNvbmNhdCh0Lm1hcChmdW5jdGlvbih0KXtyZXR1cm4gdS5tYXAoZnVuY3Rpb24obil7cmV0dXJuIGEodFtuXSl9KS5qb2luKG4pfSkpLmpvaW4oIlxuIil9LGUuZm9ybWF0Um93cz1mdW5jdGlvbihuKXtyZXR1cm4gbi5tYXAoaSkuam9pbigiXG4iKX0sZX0sb2EuY3N2PW9hLmRzdigiLCIsInRleHQvY3N2Iiksb2EudHN2PW9hLmRzdigiCSIsInRleHQvdGFiLXNlcGFyYXRlZC12YWx1ZXMiKTt2YXIgdW8saW8sYW8sb28sbG89dGhpc1t4KHRoaXMsInJlcXVlc3RBbmltYXRpb25GcmFtZSIpXXx8ZnVuY3Rpb24obil7c2V0VGltZW91dChuLDE3KX07b2EudGltZXI9ZnVuY3Rpb24oKXtxbi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LG9hLnRpbWVyLmZsdXNoPWZ1bmN0aW9uKCl7Um4oKSxEbigpfSxvYS5yb3VuZD1mdW5jdGlvbihuLHQpe3JldHVybiB0P01hdGgucm91bmQobioodD1NYXRoLnBvdygxMCx0KSkpL3Q6TWF0aC5yb3VuZChuKX07dmFyIGNvPVsieSIsInoiLCJhIiwiZiIsInAiLCJuIiwiXHhiNSIsIm0iLCIiLCJrIiwiTSIsIkciLCJUIiwiUCIsIkUiLCJaIiwiWSJdLm1hcChVbik7b2EuZm9ybWF0UHJlZml4PWZ1bmN0aW9uKG4sdCl7dmFyIGU9MDtyZXR1cm4obj0rbikmJigwPm4mJihuKj0tMSksdCYmKG49b2Eucm91bmQobixQbihuLHQpKSksZT0xK01hdGguZmxvb3IoMWUtMTIrTWF0aC5sb2cobikvTWF0aC5MTjEwKSxlPU1hdGgubWF4KC0yNCxNYXRoLm1pbigyNCwzKk1hdGguZmxvb3IoKGUtMSkvMykpKSksY29bOCtlLzNdfTt2YXIgc289Lyg/OihbXntdKT8oWzw+PV5dKSk/KFsrXC0gXSk/KFskI10pPygwKT8oXGQrKT8oLCk/KFwuLT9cZCspPyhbYS16JV0pPy9pLGZvPW9hLm1hcCh7YjpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygyKX0sYzpmdW5jdGlvbihuKXtyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKX0sbzpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZyg4KX0seDpmdW5jdGlvbihuKXtyZXR1cm4gbi50b1N0cmluZygxNil9LFg6ZnVuY3Rpb24obil7cmV0dXJuIG4udG9TdHJpbmcoMTYpLnRvVXBwZXJDYXNlKCl9LGc6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi50b1ByZWNpc2lvbih0KX0sZTpmdW5jdGlvbihuLHQpe3JldHVybiBuLnRvRXhwb25lbnRpYWwodCl9LGY6ZnVuY3Rpb24obix0KXtyZXR1cm4gbi50b0ZpeGVkKHQpfSxyOmZ1bmN0aW9uKG4sdCl7cmV0dXJuKG49b2Eucm91bmQobixQbihuLHQpKSkudG9GaXhlZChNYXRoLm1heCgwLE1hdGgubWluKDIwLFBuKG4qKDErMWUtMTUpLHQpKSkpfX0pLGhvPW9hLnRpbWU9e30sZ289RGF0ZTtIbi5wcm90b3R5cGU9e2dldERhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0RhdGUoKX0sZ2V0RGF5OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENEYXkoKX0sZ2V0RnVsbFllYXI6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ0Z1bGxZZWFyKCl9LGdldEhvdXJzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENIb3VycygpfSxnZXRNaWxsaXNlY29uZHM6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFVUQ01pbGxpc2Vjb25kcygpfSxnZXRNaW51dGVzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENNaW51dGVzKCl9LGdldE1vbnRoOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENNb250aCgpfSxnZXRTZWNvbmRzOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuXy5nZXRVVENTZWNvbmRzKCl9LGdldFRpbWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fLmdldFRpbWUoKX0sZ2V0VGltZXpvbmVPZmZzZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gMH0sdmFsdWVPZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLl8udmFsdWVPZigpfSxzZXREYXRlOmZ1bmN0aW9uKCl7cG8uc2V0VVRDRGF0ZS5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0RGF5OmZ1bmN0aW9uKCl7cG8uc2V0VVRDRGF5LmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRGdWxsWWVhcjpmdW5jdGlvbigpe3BvLnNldFVUQ0Z1bGxZZWFyLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRIb3VyczpmdW5jdGlvbigpe3BvLnNldFVUQ0hvdXJzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRNaWxsaXNlY29uZHM6ZnVuY3Rpb24oKXtwby5zZXRVVENNaWxsaXNlY29uZHMuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9LHNldE1pbnV0ZXM6ZnVuY3Rpb24oKXtwby5zZXRVVENNaW51dGVzLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRNb250aDpmdW5jdGlvbigpe3BvLnNldFVUQ01vbnRoLmFwcGx5KHRoaXMuXyxhcmd1bWVudHMpfSxzZXRTZWNvbmRzOmZ1bmN0aW9uKCl7cG8uc2V0VVRDU2Vjb25kcy5hcHBseSh0aGlzLl8sYXJndW1lbnRzKX0sc2V0VGltZTpmdW5jdGlvbigpe3BvLnNldFRpbWUuYXBwbHkodGhpcy5fLGFyZ3VtZW50cyl9fTt2YXIgcG89RGF0ZS5wcm90b3R5cGU7aG8ueWVhcj1PbihmdW5jdGlvbihuKXtyZXR1cm4gbj1oby5kYXkobiksbi5zZXRNb250aCgwLDEpLG59LGZ1bmN0aW9uKG4sdCl7bi5zZXRGdWxsWWVhcihuLmdldEZ1bGxZZWFyKCkrdCl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldEZ1bGxZZWFyKCl9KSxoby55ZWFycz1oby55ZWFyLnJhbmdlLGhvLnllYXJzLnV0Yz1oby55ZWFyLnV0Yy5yYW5nZSxoby5kYXk9T24oZnVuY3Rpb24obil7dmFyIHQ9bmV3IGdvKDJlMywwKTtyZXR1cm4gdC5zZXRGdWxsWWVhcihuLmdldEZ1bGxZZWFyKCksbi5nZXRNb250aCgpLG4uZ2V0RGF0ZSgpKSx0fSxmdW5jdGlvbihuLHQpe24uc2V0RGF0ZShuLmdldERhdGUoKSt0KX0sZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF0ZSgpLTF9KSxoby5kYXlzPWhvLmRheS5yYW5nZSxoby5kYXlzLnV0Yz1oby5kYXkudXRjLnJhbmdlLGhvLmRheU9mWWVhcj1mdW5jdGlvbihuKXt2YXIgdD1oby55ZWFyKG4pO3JldHVybiBNYXRoLmZsb29yKChuLXQtNmU0KihuLmdldFRpbWV6b25lT2Zmc2V0KCktdC5nZXRUaW1lem9uZU9mZnNldCgpKSkvODY0ZTUpfSxbInN1bmRheSIsIm1vbmRheSIsInR1ZXNkYXkiLCJ3ZWRuZXNkYXkiLCJ0aHVyc2RheSIsImZyaWRheSIsInNhdHVyZGF5Il0uZm9yRWFjaChmdW5jdGlvbihuLHQpe3Q9Ny10O3ZhciBlPWhvW25dPU9uKGZ1bmN0aW9uKG4pe3JldHVybihuPWhvLmRheShuKSkuc2V0RGF0ZShuLmdldERhdGUoKS0obi5nZXREYXkoKSt0KSU3KSxufSxmdW5jdGlvbihuLHQpe24uc2V0RGF0ZShuLmdldERhdGUoKSs3Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXt2YXIgZT1oby55ZWFyKG4pLmdldERheSgpO3JldHVybiBNYXRoLmZsb29yKChoby5kYXlPZlllYXIobikrKGUrdCklNykvNyktKGUhPT10KX0pO2hvW24rInMiXT1lLnJhbmdlLGhvW24rInMiXS51dGM9ZS51dGMucmFuZ2UsaG9bbisiT2ZZZWFyIl09ZnVuY3Rpb24obil7dmFyIGU9aG8ueWVhcihuKS5nZXREYXkoKTtyZXR1cm4gTWF0aC5mbG9vcigoaG8uZGF5T2ZZZWFyKG4pKyhlK3QpJTcpLzcpfX0pLGhvLndlZWs9aG8uc3VuZGF5LGhvLndlZWtzPWhvLnN1bmRheS5yYW5nZSxoby53ZWVrcy51dGM9aG8uc3VuZGF5LnV0Yy5yYW5nZSxoby53ZWVrT2ZZZWFyPWhvLnN1bmRheU9mWWVhcjt2YXIgdm89eyItIjoiIixfOiIgIiwwOiIwIn0sbW89L15ccypcZCsvLHlvPS9eJS87b2EubG9jYWxlPWZ1bmN0aW9uKG4pe3JldHVybntudW1iZXJGb3JtYXQ6am4obiksdGltZUZvcm1hdDpZbihuKX19O3ZhciBNbz1vYS5sb2NhbGUoe2RlY2ltYWw6Ii4iLHRob3VzYW5kczoiLCIsZ3JvdXBpbmc6WzNdLGN1cnJlbmN5OlsiJCIsIiJdLGRhdGVUaW1lOiIlYSAlYiAlZSAlWCAlWSIsZGF0ZToiJW0vJWQvJVkiLHRpbWU6IiVIOiVNOiVTIixwZXJpb2RzOlsiQU0iLCJQTSJdLGRheXM6WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLApzaG9ydERheXM6WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXSxtb250aHM6WyJKYW51YXJ5IiwiRmVicnVhcnkiLCJNYXJjaCIsIkFwcmlsIiwiTWF5IiwiSnVuZSIsIkp1bHkiLCJBdWd1c3QiLCJTZXB0ZW1iZXIiLCJPY3RvYmVyIiwiTm92ZW1iZXIiLCJEZWNlbWJlciJdLHNob3J0TW9udGhzOlsiSmFuIiwiRmViIiwiTWFyIiwiQXByIiwiTWF5IiwiSnVuIiwiSnVsIiwiQXVnIiwiU2VwIiwiT2N0IiwiTm92IiwiRGVjIl19KTtvYS5mb3JtYXQ9TW8ubnVtYmVyRm9ybWF0LG9hLmdlbz17fSxzdC5wcm90b3R5cGU9e3M6MCx0OjAsYWRkOmZ1bmN0aW9uKG4pe2Z0KG4sdGhpcy50LHhvKSxmdCh4by5zLHRoaXMucyx0aGlzKSx0aGlzLnM/dGhpcy50Kz14by50OnRoaXMucz14by50fSxyZXNldDpmdW5jdGlvbigpe3RoaXMucz10aGlzLnQ9MH0sdmFsdWVPZjpmdW5jdGlvbigpe3JldHVybiB0aGlzLnN9fTt2YXIgeG89bmV3IHN0O29hLmdlby5zdHJlYW09ZnVuY3Rpb24obix0KXtuJiZiby5oYXNPd25Qcm9wZXJ0eShuLnR5cGUpP2JvW24udHlwZV0obix0KTpodChuLHQpfTt2YXIgYm89e0ZlYXR1cmU6ZnVuY3Rpb24obix0KXtodChuLmdlb21ldHJ5LHQpfSxGZWF0dXJlQ29sbGVjdGlvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmZlYXR1cmVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspaHQoZVtyXS5nZW9tZXRyeSx0KX19LF9vPXtTcGhlcmU6ZnVuY3Rpb24obix0KXt0LnNwaGVyZSgpfSxQb2ludDpmdW5jdGlvbihuLHQpe249bi5jb29yZGluYXRlcyx0LnBvaW50KG5bMF0sblsxXSxuWzJdKX0sTXVsdGlQb2ludDpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmNvb3JkaW5hdGVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspbj1lW3JdLHQucG9pbnQoblswXSxuWzFdLG5bMl0pfSxMaW5lU3RyaW5nOmZ1bmN0aW9uKG4sdCl7Z3Qobi5jb29yZGluYXRlcyx0LDApfSxNdWx0aUxpbmVTdHJpbmc6ZnVuY3Rpb24obix0KXtmb3IodmFyIGU9bi5jb29yZGluYXRlcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWd0KGVbcl0sdCwwKX0sUG9seWdvbjpmdW5jdGlvbihuLHQpe3B0KG4uY29vcmRpbmF0ZXMsdCl9LE11bHRpUG9seWdvbjpmdW5jdGlvbihuLHQpe2Zvcih2YXIgZT1uLmNvb3JkaW5hdGVzLHI9LTEsdT1lLmxlbmd0aDsrK3I8dTspcHQoZVtyXSx0KX0sR2VvbWV0cnlDb2xsZWN0aW9uOmZ1bmN0aW9uKG4sdCl7Zm9yKHZhciBlPW4uZ2VvbWV0cmllcyxyPS0xLHU9ZS5sZW5ndGg7KytyPHU7KWh0KGVbcl0sdCl9fTtvYS5nZW8uYXJlYT1mdW5jdGlvbihuKXtyZXR1cm4gd289MCxvYS5nZW8uc3RyZWFtKG4sa28pLHdvfTt2YXIgd28sU289bmV3IHN0LGtvPXtzcGhlcmU6ZnVuY3Rpb24oKXt3bys9NCpVYX0scG9pbnQ6YixsaW5lU3RhcnQ6YixsaW5lRW5kOmIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7U28ucmVzZXQoKSxrby5saW5lU3RhcnQ9dnR9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt2YXIgbj0yKlNvO3dvKz0wPm4/NCpVYStuOm4sa28ubGluZVN0YXJ0PWtvLmxpbmVFbmQ9a28ucG9pbnQ9Yn19O29hLmdlby5ib3VuZHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4sdCl7TS5wdXNoKHg9W3M9bixoPW5dKSxmPnQmJihmPXQpLHQ+ZyYmKGc9dCl9ZnVuY3Rpb24gdCh0LGUpe3ZhciByPWR0KFt0Kk9hLGUqT2FdKTtpZihtKXt2YXIgdT15dChtLHIpLGk9W3VbMV0sLXVbMF0sMF0sYT15dChpLHUpO2J0KGEpLGE9X3QoYSk7dmFyIGw9dC1wLGM9bD4wPzE6LTEsdj1hWzBdKklhKmMsZD1NYShsKT4xODA7aWYoZF4odj5jKnAmJmMqdD52KSl7dmFyIHk9YVsxXSpJYTt5PmcmJihnPXkpfWVsc2UgaWYodj0odiszNjApJTM2MC0xODAsZF4odj5jKnAmJmMqdD52KSl7dmFyIHk9LWFbMV0qSWE7Zj55JiYoZj15KX1lbHNlIGY+ZSYmKGY9ZSksZT5nJiYoZz1lKTtkP3A+dD9vKHMsdCk+byhzLGgpJiYoaD10KTpvKHQsaCk+byhzLGgpJiYocz10KTpoPj1zPyhzPnQmJihzPXQpLHQ+aCYmKGg9dCkpOnQ+cD9vKHMsdCk+byhzLGgpJiYoaD10KTpvKHQsaCk+byhzLGgpJiYocz10KX1lbHNlIG4odCxlKTttPXIscD10fWZ1bmN0aW9uIGUoKXtiLnBvaW50PXR9ZnVuY3Rpb24gcigpe3hbMF09cyx4WzFdPWgsYi5wb2ludD1uLG09bnVsbH1mdW5jdGlvbiB1KG4sZSl7aWYobSl7dmFyIHI9bi1wO3krPU1hKHIpPjE4MD9yKyhyPjA/MzYwOi0zNjApOnJ9ZWxzZSB2PW4sZD1lO2tvLnBvaW50KG4sZSksdChuLGUpfWZ1bmN0aW9uIGkoKXtrby5saW5lU3RhcnQoKX1mdW5jdGlvbiBhKCl7dSh2LGQpLGtvLmxpbmVFbmQoKSxNYSh5KT5EYSYmKHM9LShoPTE4MCkpLHhbMF09cyx4WzFdPWgsbT1udWxsfWZ1bmN0aW9uIG8obix0KXtyZXR1cm4odC09bik8MD90KzM2MDp0fWZ1bmN0aW9uIGwobix0KXtyZXR1cm4gblswXS10WzBdfWZ1bmN0aW9uIGMobix0KXtyZXR1cm4gdFswXTw9dFsxXT90WzBdPD1uJiZuPD10WzFdOm48dFswXXx8dFsxXTxufXZhciBzLGYsaCxnLHAsdixkLG0seSxNLHgsYj17cG9pbnQ6bixsaW5lU3RhcnQ6ZSxsaW5lRW5kOnIscG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7Yi5wb2ludD11LGIubGluZVN0YXJ0PWksYi5saW5lRW5kPWEseT0wLGtvLnBvbHlnb25TdGFydCgpfSxwb2x5Z29uRW5kOmZ1bmN0aW9uKCl7a28ucG9seWdvbkVuZCgpLGIucG9pbnQ9bixiLmxpbmVTdGFydD1lLGIubGluZUVuZD1yLDA+U28/KHM9LShoPTE4MCksZj0tKGc9OTApKTp5PkRhP2c9OTA6LURhPnkmJihmPS05MCkseFswXT1zLHhbMV09aH19O3JldHVybiBmdW5jdGlvbihuKXtnPWg9LShzPWY9MS8wKSxNPVtdLG9hLmdlby5zdHJlYW0obixiKTt2YXIgdD1NLmxlbmd0aDtpZih0KXtNLnNvcnQobCk7Zm9yKHZhciBlLHI9MSx1PU1bMF0saT1bdV07dD5yOysrcillPU1bcl0sYyhlWzBdLHUpfHxjKGVbMV0sdSk/KG8odVswXSxlWzFdKT5vKHVbMF0sdVsxXSkmJih1WzFdPWVbMV0pLG8oZVswXSx1WzFdKT5vKHVbMF0sdVsxXSkmJih1WzBdPWVbMF0pKTppLnB1c2godT1lKTtmb3IodmFyIGEsZSxwPS0oMS8wKSx0PWkubGVuZ3RoLTEscj0wLHU9aVt0XTt0Pj1yO3U9ZSwrK3IpZT1pW3JdLChhPW8odVsxXSxlWzBdKSk+cCYmKHA9YSxzPWVbMF0saD11WzFdKX1yZXR1cm4gTT14PW51bGwscz09PTEvMHx8Zj09PTEvMD9bW05hTixOYU5dLFtOYU4sTmFOXV06W1tzLGZdLFtoLGddXX19KCksb2EuZ2VvLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe05vPUVvPUFvPUNvPXpvPUxvPXFvPVRvPVJvPURvPVBvPTAsb2EuZ2VvLnN0cmVhbShuLFVvKTt2YXIgdD1SbyxlPURvLHI9UG8sdT10KnQrZSplK3IqcjtyZXR1cm4gUGE+dSYmKHQ9TG8sZT1xbyxyPVRvLERhPkVvJiYodD1BbyxlPUNvLHI9em8pLHU9dCp0K2UqZStyKnIsUGE+dSk/W05hTixOYU5dOltNYXRoLmF0YW4yKGUsdCkqSWEsdG4oci9NYXRoLnNxcnQodSkpKklhXX07dmFyIE5vLEVvLEFvLENvLHpvLExvLHFvLFRvLFJvLERvLFBvLFVvPXtzcGhlcmU6Yixwb2ludDpTdCxsaW5lU3RhcnQ6TnQsbGluZUVuZDpFdCxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtVby5saW5lU3RhcnQ9QXR9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtVby5saW5lU3RhcnQ9TnR9fSxqbz1SdCh6dCxqdCxIdCxbLVVhLC1VYS8yXSksRm89MWU5O29hLmdlby5jbGlwRXh0ZW50PWZ1bmN0aW9uKCl7dmFyIG4sdCxlLHIsdSxpLGE9e3N0cmVhbTpmdW5jdGlvbihuKXtyZXR1cm4gdSYmKHUudmFsaWQ9ITEpLHU9aShuKSx1LnZhbGlkPSEwLHV9LGV4dGVudDpmdW5jdGlvbihvKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1adChuPStvWzBdWzBdLHQ9K29bMF1bMV0sZT0rb1sxXVswXSxyPStvWzFdWzFdKSx1JiYodS52YWxpZD0hMSx1PW51bGwpLGEpOltbbix0XSxbZSxyXV19fTtyZXR1cm4gYS5leHRlbnQoW1swLDBdLFs5NjAsNTAwXV0pfSwob2EuZ2VvLmNvbmljRXF1YWxBcmVhPWZ1bmN0aW9uKCl7cmV0dXJuIFZ0KFh0KX0pLnJhdz1YdCxvYS5nZW8uYWxiZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbOTYsMF0pLmNlbnRlcihbLS42LDM4LjddKS5wYXJhbGxlbHMoWzI5LjUsNDUuNV0pLnNjYWxlKDEwNzApfSxvYS5nZW8uYWxiZXJzVXNhPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXt2YXIgaT1uWzBdLGE9blsxXTtyZXR1cm4gdD1udWxsLGUoaSxhKSx0fHwocihpLGEpLHQpfHx1KGksYSksdH12YXIgdCxlLHIsdSxpPW9hLmdlby5hbGJlcnMoKSxhPW9hLmdlby5jb25pY0VxdWFsQXJlYSgpLnJvdGF0ZShbMTU0LDBdKS5jZW50ZXIoWy0yLDU4LjVdKS5wYXJhbGxlbHMoWzU1LDY1XSksbz1vYS5nZW8uY29uaWNFcXVhbEFyZWEoKS5yb3RhdGUoWzE1NywwXSkuY2VudGVyKFstMywxOS45XSkucGFyYWxsZWxzKFs4LDE4XSksbD17cG9pbnQ6ZnVuY3Rpb24obixlKXt0PVtuLGVdfX07cmV0dXJuIG4uaW52ZXJ0PWZ1bmN0aW9uKG4pe3ZhciB0PWkuc2NhbGUoKSxlPWkudHJhbnNsYXRlKCkscj0oblswXS1lWzBdKS90LHU9KG5bMV0tZVsxXSkvdDtyZXR1cm4odT49LjEyJiYuMjM0PnUmJnI+PS0uNDI1JiYtLjIxND5yP2E6dT49LjE2NiYmLjIzND51JiZyPj0tLjIxNCYmLS4xMTU+cj9vOmkpLmludmVydChuKX0sbi5zdHJlYW09ZnVuY3Rpb24obil7dmFyIHQ9aS5zdHJlYW0obiksZT1hLnN0cmVhbShuKSxyPW8uc3RyZWFtKG4pO3JldHVybntwb2ludDpmdW5jdGlvbihuLHUpe3QucG9pbnQobix1KSxlLnBvaW50KG4sdSksci5wb2ludChuLHUpfSxzcGhlcmU6ZnVuY3Rpb24oKXt0LnNwaGVyZSgpLGUuc3BoZXJlKCksci5zcGhlcmUoKX0sbGluZVN0YXJ0OmZ1bmN0aW9uKCl7dC5saW5lU3RhcnQoKSxlLmxpbmVTdGFydCgpLHIubGluZVN0YXJ0KCl9LGxpbmVFbmQ6ZnVuY3Rpb24oKXt0LmxpbmVFbmQoKSxlLmxpbmVFbmQoKSxyLmxpbmVFbmQoKX0scG9seWdvblN0YXJ0OmZ1bmN0aW9uKCl7dC5wb2x5Z29uU3RhcnQoKSxlLnBvbHlnb25TdGFydCgpLHIucG9seWdvblN0YXJ0KCl9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXt0LnBvbHlnb25FbmQoKSxlLnBvbHlnb25FbmQoKSxyLnBvbHlnb25FbmQoKX19fSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaS5wcmVjaXNpb24odCksYS5wcmVjaXNpb24odCksby5wcmVjaXNpb24odCksbik6aS5wcmVjaXNpb24oKX0sbi5zY2FsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaS5zY2FsZSh0KSxhLnNjYWxlKC4zNSp0KSxvLnNjYWxlKHQpLG4udHJhbnNsYXRlKGkudHJhbnNsYXRlKCkpKTppLnNjYWxlKCl9LG4udHJhbnNsYXRlPWZ1bmN0aW9uKHQpe2lmKCFhcmd1bWVudHMubGVuZ3RoKXJldHVybiBpLnRyYW5zbGF0ZSgpO3ZhciBjPWkuc2NhbGUoKSxzPSt0WzBdLGY9K3RbMV07cmV0dXJuIGU9aS50cmFuc2xhdGUodCkuY2xpcEV4dGVudChbW3MtLjQ1NSpjLGYtLjIzOCpjXSxbcysuNDU1KmMsZisuMjM4KmNdXSkuc3RyZWFtKGwpLnBvaW50LHI9YS50cmFuc2xhdGUoW3MtLjMwNypjLGYrLjIwMSpjXSkuY2xpcEV4dGVudChbW3MtLjQyNSpjK0RhLGYrLjEyKmMrRGFdLFtzLS4yMTQqYy1EYSxmKy4yMzQqYy1EYV1dKS5zdHJlYW0obCkucG9pbnQsdT1vLnRyYW5zbGF0ZShbcy0uMjA1KmMsZisuMjEyKmNdKS5jbGlwRXh0ZW50KFtbcy0uMjE0KmMrRGEsZisuMTY2KmMrRGFdLFtzLS4xMTUqYy1EYSxmKy4yMzQqYy1EYV1dKS5zdHJlYW0obCkucG9pbnQsbn0sbi5zY2FsZSgxMDcwKX07dmFyIEhvLE9vLElvLFlvLFpvLFZvLFhvPXtwb2ludDpiLGxpbmVTdGFydDpiLGxpbmVFbmQ6Yixwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtPbz0wLFhvLmxpbmVTdGFydD0kdH0scG9seWdvbkVuZDpmdW5jdGlvbigpe1hvLmxpbmVTdGFydD1Yby5saW5lRW5kPVhvLnBvaW50PWIsSG8rPU1hKE9vLzIpfX0sJG89e3BvaW50OkJ0LGxpbmVTdGFydDpiLGxpbmVFbmQ6Yixwb2x5Z29uU3RhcnQ6Yixwb2x5Z29uRW5kOmJ9LEJvPXtwb2ludDpHdCxsaW5lU3RhcnQ6S3QsbGluZUVuZDpRdCxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXtCby5saW5lU3RhcnQ9bmV9LHBvbHlnb25FbmQ6ZnVuY3Rpb24oKXtCby5wb2ludD1HdCxCby5saW5lU3RhcnQ9S3QsQm8ubGluZUVuZD1RdH19O29hLmdlby5wYXRoPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuKXtyZXR1cm4gbiYmKCJmdW5jdGlvbiI9PXR5cGVvZiBvJiZpLnBvaW50UmFkaXVzKCtvLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksYSYmYS52YWxpZHx8KGE9dShpKSksb2EuZ2VvLnN0cmVhbShuLGEpKSxpLnJlc3VsdCgpfWZ1bmN0aW9uIHQoKXtyZXR1cm4gYT1udWxsLG59dmFyIGUscix1LGksYSxvPTQuNTtyZXR1cm4gbi5hcmVhPWZ1bmN0aW9uKG4pe3JldHVybiBIbz0wLG9hLmdlby5zdHJlYW0obix1KFhvKSksSG99LG4uY2VudHJvaWQ9ZnVuY3Rpb24obil7cmV0dXJuIEFvPUNvPXpvPUxvPXFvPVRvPVJvPURvPVBvPTAsb2EuZ2VvLnN0cmVhbShuLHUoQm8pKSxQbz9bUm8vUG8sRG8vUG9dOlRvP1tMby9Ubyxxby9Ub106em8/W0FvL3pvLENvL3pvXTpbTmFOLE5hTl19LG4uYm91bmRzPWZ1bmN0aW9uKG4pe3JldHVybiBabz1Wbz0tKElvPVlvPTEvMCksb2EuZ2VvLnN0cmVhbShuLHUoJG8pKSxbW0lvLFlvXSxbWm8sVm9dXX0sbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PShlPW4pP24uc3RyZWFtfHxyZShuKTp5LHQoKSk6ZX0sbi5jb250ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPW51bGw9PShyPW4pP25ldyBXdDpuZXcgdGUobiksImZ1bmN0aW9uIiE9dHlwZW9mIG8mJmkucG9pbnRSYWRpdXMobyksdCgpKTpyfSxuLnBvaW50UmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6KGkucG9pbnRSYWRpdXMoK3QpLCt0KSxuKTpvfSxuLnByb2plY3Rpb24ob2EuZ2VvLmFsYmVyc1VzYSgpKS5jb250ZXh0KG51bGwpfSxvYS5nZW8udHJhbnNmb3JtPWZ1bmN0aW9uKG4pe3JldHVybntzdHJlYW06ZnVuY3Rpb24odCl7dmFyIGU9bmV3IHVlKHQpO2Zvcih2YXIgciBpbiBuKWVbcl09bltyXTtyZXR1cm4gZX19fSx1ZS5wcm90b3R5cGU9e3BvaW50OmZ1bmN0aW9uKG4sdCl7dGhpcy5zdHJlYW0ucG9pbnQobix0KX0sc3BoZXJlOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0uc3BoZXJlKCl9LGxpbmVTdGFydDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLmxpbmVTdGFydCgpfSxsaW5lRW5kOmZ1bmN0aW9uKCl7dGhpcy5zdHJlYW0ubGluZUVuZCgpfSxwb2x5Z29uU3RhcnQ6ZnVuY3Rpb24oKXt0aGlzLnN0cmVhbS5wb2x5Z29uU3RhcnQoKX0scG9seWdvbkVuZDpmdW5jdGlvbigpe3RoaXMuc3RyZWFtLnBvbHlnb25FbmQoKX19LG9hLmdlby5wcm9qZWN0aW9uPWFlLG9hLmdlby5wcm9qZWN0aW9uTXV0YXRvcj1vZSwob2EuZ2VvLmVxdWlyZWN0YW5ndWxhcj1mdW5jdGlvbigpe3JldHVybiBhZShjZSl9KS5yYXc9Y2UuaW52ZXJ0PWNlLG9hLmdlby5yb3RhdGlvbj1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KHQpe3JldHVybiB0PW4odFswXSpPYSx0WzFdKk9hKSx0WzBdKj1JYSx0WzFdKj1JYSx0fXJldHVybiBuPWZlKG5bMF0lMzYwKk9hLG5bMV0qT2Esbi5sZW5ndGg+Mj9uWzJdKk9hOjApLHQuaW52ZXJ0PWZ1bmN0aW9uKHQpe3JldHVybiB0PW4uaW52ZXJ0KHRbMF0qT2EsdFsxXSpPYSksdFswXSo9SWEsdFsxXSo9SWEsdH0sdH0sc2UuaW52ZXJ0PWNlLG9hLmdlby5jaXJjbGU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7dmFyIG49ImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6cix0PWZlKC1uWzBdKk9hLC1uWzFdKk9hLDApLmludmVydCx1PVtdO3JldHVybiBlKG51bGwsbnVsbCwxLHtwb2ludDpmdW5jdGlvbihuLGUpe3UucHVzaChuPXQobixlKSksblswXSo9SWEsblsxXSo9SWF9fSkse3R5cGU6IlBvbHlnb24iLGNvb3JkaW5hdGVzOlt1XX19dmFyIHQsZSxyPVswLDBdLHU9NjtyZXR1cm4gbi5vcmlnaW49ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxuLmFuZ2xlPWZ1bmN0aW9uKHIpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXZlKCh0PStyKSpPYSx1Kk9hKSxuKTp0fSxuLnByZWNpc2lvbj1mdW5jdGlvbihyKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT12ZSh0Kk9hLCh1PStyKSpPYSksbik6dX0sbi5hbmdsZSg5MCl9LG9hLmdlby5kaXN0YW5jZT1mdW5jdGlvbihuLHQpe3ZhciBlLHI9KHRbMF0tblswXSkqT2EsdT1uWzFdKk9hLGk9dFsxXSpPYSxhPU1hdGguc2luKHIpLG89TWF0aC5jb3MociksbD1NYXRoLnNpbih1KSxjPU1hdGguY29zKHUpLHM9TWF0aC5zaW4oaSksZj1NYXRoLmNvcyhpKTtyZXR1cm4gTWF0aC5hdGFuMihNYXRoLnNxcnQoKGU9ZiphKSplKyhlPWMqcy1sKmYqbykqZSksbCpzK2MqZipvKX0sb2EuZ2VvLmdyYXRpY3VsZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXtyZXR1cm57dHlwZToiTXVsdGlMaW5lU3RyaW5nIixjb29yZGluYXRlczp0KCl9fWZ1bmN0aW9uIHQoKXtyZXR1cm4gb2EucmFuZ2UoTWF0aC5jZWlsKGkvZCkqZCx1LGQpLm1hcChoKS5jb25jYXQob2EucmFuZ2UoTWF0aC5jZWlsKGMvbSkqbSxsLG0pLm1hcChnKSkuY29uY2F0KG9hLnJhbmdlKE1hdGguY2VpbChyL3ApKnAsZSxwKS5maWx0ZXIoZnVuY3Rpb24obil7cmV0dXJuIE1hKG4lZCk+RGF9KS5tYXAocykpLmNvbmNhdChvYS5yYW5nZShNYXRoLmNlaWwoby92KSp2LGEsdikuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBNYShuJW0pPkRhfSkubWFwKGYpKX12YXIgZSxyLHUsaSxhLG8sbCxjLHMsZixoLGcscD0xMCx2PXAsZD05MCxtPTM2MCx5PTIuNTtyZXR1cm4gbi5saW5lcz1mdW5jdGlvbigpe3JldHVybiB0KCkubWFwKGZ1bmN0aW9uKG4pe3JldHVybnt0eXBlOiJMaW5lU3RyaW5nIixjb29yZGluYXRlczpufX0pfSxuLm91dGxpbmU9ZnVuY3Rpb24oKXtyZXR1cm57dHlwZToiUG9seWdvbiIsY29vcmRpbmF0ZXM6W2goaSkuY29uY2F0KGcobCkuc2xpY2UoMSksaCh1KS5yZXZlcnNlKCkuc2xpY2UoMSksZyhjKS5yZXZlcnNlKCkuc2xpY2UoMSkpXX19LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JFeHRlbnQodCkubWlub3JFeHRlbnQodCk6bi5taW5vckV4dGVudCgpfSxuLm1ham9yRXh0ZW50PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0WzBdWzBdLHU9K3RbMV1bMF0sYz0rdFswXVsxXSxsPSt0WzFdWzFdLGk+dSYmKHQ9aSxpPXUsdT10KSxjPmwmJih0PWMsYz1sLGw9dCksbi5wcmVjaXNpb24oeSkpOltbaSxjXSxbdSxsXV19LG4ubWlub3JFeHRlbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9K3RbMF1bMF0sZT0rdFsxXVswXSxvPSt0WzBdWzFdLGE9K3RbMV1bMV0scj5lJiYodD1yLHI9ZSxlPXQpLG8+YSYmKHQ9byxvPWEsYT10KSxuLnByZWNpc2lvbih5KSk6W1tyLG9dLFtlLGFdXX0sbi5zdGVwPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP24ubWFqb3JTdGVwKHQpLm1pbm9yU3RlcCh0KTpuLm1pbm9yU3RlcCgpfSxuLm1ham9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZD0rdFswXSxtPSt0WzFdLG4pOltkLG1dfSxuLm1pbm9yU3RlcD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0rdFswXSx2PSt0WzFdLG4pOltwLHZdfSxuLnByZWNpc2lvbj1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oeT0rdCxzPW1lKG8sYSw5MCksZj15ZShyLGUseSksaD1tZShjLGwsOTApLGc9eWUoaSx1LHkpLG4pOnl9LG4ubWFqb3JFeHRlbnQoW1stMTgwLC05MCtEYV0sWzE4MCw5MC1EYV1dKS5taW5vckV4dGVudChbWy0xODAsLTgwLURhXSxbMTgwLDgwK0RhXV0pfSxvYS5nZW8uZ3JlYXRBcmM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKCl7cmV0dXJue3R5cGU6IkxpbmVTdHJpbmciLGNvb3JkaW5hdGVzOlt0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKV19fXZhciB0LGUscj1NZSx1PXhlO3JldHVybiBuLmRpc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLmdlby5kaXN0YW5jZSh0fHxyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlfHx1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSl9LG4uc291cmNlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPWUsdD0iZnVuY3Rpb24iPT10eXBlb2YgZT9udWxsOmUsbik6cn0sbi50YXJnZXQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9dCxlPSJmdW5jdGlvbiI9PXR5cGVvZiB0P251bGw6dCxuKTp1fSxuLnByZWNpc2lvbj1mdW5jdGlvbigpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP246MH0sbn0sb2EuZ2VvLmludGVycG9sYXRlPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIGJlKG5bMF0qT2EsblsxXSpPYSx0WzBdKk9hLHRbMV0qT2EpfSxvYS5nZW8ubGVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBXbz0wLG9hLmdlby5zdHJlYW0obixKbyksV299O3ZhciBXbyxKbz17c3BoZXJlOmIscG9pbnQ6YixsaW5lU3RhcnQ6X2UsbGluZUVuZDpiLHBvbHlnb25TdGFydDpiLHBvbHlnb25FbmQ6Yn0sR289d2UoZnVuY3Rpb24obil7cmV0dXJuIE1hdGguc3FydCgyLygxK24pKX0sZnVuY3Rpb24obil7cmV0dXJuIDIqTWF0aC5hc2luKG4vMil9KTsob2EuZ2VvLmF6aW11dGhhbEVxdWFsQXJlYT1mdW5jdGlvbigpe3JldHVybiBhZShHbyl9KS5yYXc9R287dmFyIEtvPXdlKGZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguYWNvcyhuKTtyZXR1cm4gdCYmdC9NYXRoLnNpbih0KX0seSk7KG9hLmdlby5hemltdXRoYWxFcXVpZGlzdGFudD1mdW5jdGlvbigpe3JldHVybiBhZShLbyl9KS5yYXc9S28sKG9hLmdlby5jb25pY0NvbmZvcm1hbD1mdW5jdGlvbigpe3JldHVybiBWdChTZSl9KS5yYXc9U2UsKG9hLmdlby5jb25pY0VxdWlkaXN0YW50PWZ1bmN0aW9uKCl7cmV0dXJuIFZ0KGtlKX0pLnJhdz1rZTt2YXIgUW89d2UoZnVuY3Rpb24obil7cmV0dXJuIDEvbn0sTWF0aC5hdGFuKTsob2EuZ2VvLmdub21vbmljPWZ1bmN0aW9uKCl7cmV0dXJuIGFlKFFvKX0pLnJhdz1RbyxOZS5pbnZlcnQ9ZnVuY3Rpb24obix0KXtyZXR1cm5bbiwyKk1hdGguYXRhbihNYXRoLmV4cCh0KSktSGFdfSwob2EuZ2VvLm1lcmNhdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIEVlKE5lKX0pLnJhdz1OZTt2YXIgbmw9d2UoZnVuY3Rpb24oKXtyZXR1cm4gMX0sTWF0aC5hc2luKTsob2EuZ2VvLm9ydGhvZ3JhcGhpYz1mdW5jdGlvbigpe3JldHVybiBhZShubCl9KS5yYXc9bmw7dmFyIHRsPXdlKGZ1bmN0aW9uKG4pe3JldHVybiAxLygxK24pfSxmdW5jdGlvbihuKXtyZXR1cm4gMipNYXRoLmF0YW4obil9KTsob2EuZ2VvLnN0ZXJlb2dyYXBoaWM9ZnVuY3Rpb24oKXtyZXR1cm4gYWUodGwpfSkucmF3PXRsLEFlLmludmVydD1mdW5jdGlvbihuLHQpe3JldHVyblstdCwyKk1hdGguYXRhbihNYXRoLmV4cChuKSktSGFdfSwob2EuZ2VvLnRyYW5zdmVyc2VNZXJjYXRvcj1mdW5jdGlvbigpe3ZhciBuPUVlKEFlKSx0PW4uY2VudGVyLGU9bi5yb3RhdGU7cmV0dXJuIG4uY2VudGVyPWZ1bmN0aW9uKG4pe3JldHVybiBuP3QoWy1uWzFdLG5bMF1dKToobj10KCksW25bMV0sLW5bMF1dKX0sbi5yb3RhdGU9ZnVuY3Rpb24obil7cmV0dXJuIG4/ZShbblswXSxuWzFdLG4ubGVuZ3RoPjI/blsyXSs5MDo5MF0pOihuPWUoKSxbblswXSxuWzFdLG5bMl0tOTBdKX0sZShbMCwwLDkwXSl9KS5yYXc9QWUsb2EuZ2VvbT17fSxvYS5nZW9tLmh1bGw9ZnVuY3Rpb24obil7ZnVuY3Rpb24gdChuKXtpZihuLmxlbmd0aDwzKXJldHVybltdO3ZhciB0LHU9RW4oZSksaT1FbihyKSxhPW4ubGVuZ3RoLG89W10sbD1bXTtmb3IodD0wO2E+dDt0Kyspby5wdXNoKFsrdS5jYWxsKHRoaXMsblt0XSx0KSwraS5jYWxsKHRoaXMsblt0XSx0KSx0XSk7Zm9yKG8uc29ydChxZSksdD0wO2E+dDt0KyspbC5wdXNoKFtvW3RdWzBdLC1vW3RdWzFdXSk7dmFyIGM9TGUobykscz1MZShsKSxmPXNbMF09PT1jWzBdLGg9c1tzLmxlbmd0aC0xXT09PWNbYy5sZW5ndGgtMV0sZz1bXTtmb3IodD1jLmxlbmd0aC0xO3Q+PTA7LS10KWcucHVzaChuW29bY1t0XV1bMl1dKTtmb3IodD0rZjt0PHMubGVuZ3RoLWg7Kyt0KWcucHVzaChuW29bc1t0XV1bMl1dKTtyZXR1cm4gZ312YXIgZT1DZSxyPXplO3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3Qobik6KHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1uLHQpOmV9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj1uLHQpOnJ9LHQpfSxvYS5nZW9tLnBvbHlnb249ZnVuY3Rpb24obil7cmV0dXJuIFNhKG4sZWwpLG59O3ZhciBlbD1vYS5nZW9tLnBvbHlnb24ucHJvdG90eXBlPVtdO2VsLmFyZWE9ZnVuY3Rpb24oKXtmb3IodmFyIG4sdD0tMSxlPXRoaXMubGVuZ3RoLHI9dGhpc1tlLTFdLHU9MDsrK3Q8ZTspbj1yLHI9dGhpc1t0XSx1Kz1uWzFdKnJbMF0tblswXSpyWzFdO3JldHVybi41KnV9LGVsLmNlbnRyb2lkPWZ1bmN0aW9uKG4pe3ZhciB0LGUscj0tMSx1PXRoaXMubGVuZ3RoLGk9MCxhPTAsbz10aGlzW3UtMV07Zm9yKGFyZ3VtZW50cy5sZW5ndGh8fChuPS0xLyg2KnRoaXMuYXJlYSgpKSk7KytyPHU7KXQ9byxvPXRoaXNbcl0sZT10WzBdKm9bMV0tb1swXSp0WzFdLGkrPSh0WzBdK29bMF0pKmUsYSs9KHRbMV0rb1sxXSkqZTtyZXR1cm5baSpuLGEqbl19LGVsLmNsaXA9ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscix1LGksYSxvPURlKG4pLGw9LTEsYz10aGlzLmxlbmd0aC1EZSh0aGlzKSxzPXRoaXNbYy0xXTsrK2w8Yzspe2Zvcih0PW4uc2xpY2UoKSxuLmxlbmd0aD0wLHU9dGhpc1tsXSxpPXRbKHI9dC5sZW5ndGgtbyktMV0sZT0tMTsrK2U8cjspYT10W2VdLFRlKGEscyx1KT8oVGUoaSxzLHUpfHxuLnB1c2goUmUoaSxhLHMsdSkpLG4ucHVzaChhKSk6VGUoaSxzLHUpJiZuLnB1c2goUmUoaSxhLHMsdSkpLGk9YTtvJiZuLnB1c2goblswXSkscz11fXJldHVybiBufTt2YXIgcmwsdWwsaWwsYWwsb2wsbGw9W10sY2w9W107WWUucHJvdG90eXBlLnByZXBhcmU9ZnVuY3Rpb24oKXtmb3IodmFyIG4sdD10aGlzLmVkZ2VzLGU9dC5sZW5ndGg7ZS0tOyluPXRbZV0uZWRnZSxuLmImJm4uYXx8dC5zcGxpY2UoZSwxKTtyZXR1cm4gdC5zb3J0KFZlKSx0Lmxlbmd0aH0sdHIucHJvdG90eXBlPXtzdGFydDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVkZ2UubD09PXRoaXMuc2l0ZT90aGlzLmVkZ2UuYTp0aGlzLmVkZ2UuYn0sZW5kOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWRnZS5sPT09dGhpcy5zaXRlP3RoaXMuZWRnZS5iOnRoaXMuZWRnZS5hfX0sZXIucHJvdG90eXBlPXtpbnNlcnQ6ZnVuY3Rpb24obix0KXt2YXIgZSxyLHU7aWYobil7aWYodC5QPW4sdC5OPW4uTixuLk4mJihuLk4uUD10KSxuLk49dCxuLlIpe2ZvcihuPW4uUjtuLkw7KW49bi5MO24uTD10fWVsc2Ugbi5SPXQ7ZT1ufWVsc2UgdGhpcy5fPyhuPWFyKHRoaXMuXyksdC5QPW51bGwsdC5OPW4sbi5QPW4uTD10LGU9bik6KHQuUD10Lk49bnVsbCx0aGlzLl89dCxlPW51bGwpO2Zvcih0Lkw9dC5SPW51bGwsdC5VPWUsdC5DPSEwLG49dDtlJiZlLkM7KXI9ZS5VLGU9PT1yLkw/KHU9ci5SLHUmJnUuQz8oZS5DPXUuQz0hMSxyLkM9ITAsbj1yKToobj09PWUuUiYmKHVyKHRoaXMsZSksbj1lLGU9bi5VKSxlLkM9ITEsci5DPSEwLGlyKHRoaXMscikpKToodT1yLkwsdSYmdS5DPyhlLkM9dS5DPSExLHIuQz0hMCxuPXIpOihuPT09ZS5MJiYoaXIodGhpcyxlKSxuPWUsZT1uLlUpLGUuQz0hMSxyLkM9ITAsdXIodGhpcyxyKSkpLGU9bi5VO3RoaXMuXy5DPSExfSxyZW1vdmU6ZnVuY3Rpb24obil7bi5OJiYobi5OLlA9bi5QKSxuLlAmJihuLlAuTj1uLk4pLG4uTj1uLlA9bnVsbDt2YXIgdCxlLHIsdT1uLlUsaT1uLkwsYT1uLlI7aWYoZT1pP2E/YXIoYSk6aTphLHU/dS5MPT09bj91Lkw9ZTp1LlI9ZTp0aGlzLl89ZSxpJiZhPyhyPWUuQyxlLkM9bi5DLGUuTD1pLGkuVT1lLGUhPT1hPyh1PWUuVSxlLlU9bi5VLG49ZS5SLHUuTD1uLGUuUj1hLGEuVT1lKTooZS5VPXUsdT1lLG49ZS5SKSk6KHI9bi5DLG49ZSksbiYmKG4uVT11KSwhcil7aWYobiYmbi5DKXJldHVybiB2b2lkKG4uQz0hMSk7ZG97aWYobj09PXRoaXMuXylicmVhaztpZihuPT09dS5MKXtpZih0PXUuUix0LkMmJih0LkM9ITEsdS5DPSEwLHVyKHRoaXMsdSksdD11LlIpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuUiYmdC5SLkN8fCh0LkwuQz0hMSx0LkM9ITAsaXIodGhpcyx0KSx0PXUuUiksdC5DPXUuQyx1LkM9dC5SLkM9ITEsdXIodGhpcyx1KSxuPXRoaXMuXzticmVha319ZWxzZSBpZih0PXUuTCx0LkMmJih0LkM9ITEsdS5DPSEwLGlyKHRoaXMsdSksdD11LkwpLHQuTCYmdC5MLkN8fHQuUiYmdC5SLkMpe3QuTCYmdC5MLkN8fCh0LlIuQz0hMSx0LkM9ITAsdXIodGhpcyx0KSx0PXUuTCksdC5DPXUuQyx1LkM9dC5MLkM9ITEsaXIodGhpcyx1KSxuPXRoaXMuXzticmVha310LkM9ITAsbj11LHU9dS5VfXdoaWxlKCFuLkMpO24mJihuLkM9ITEpfX19LG9hLmdlb20udm9yb25vaT1mdW5jdGlvbihuKXtmdW5jdGlvbiB0KG4pe3ZhciB0PW5ldyBBcnJheShuLmxlbmd0aCkscj1vWzBdWzBdLHU9b1swXVsxXSxpPW9bMV1bMF0sYT1vWzFdWzFdO3JldHVybiBvcihlKG4pLG8pLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxvKXt2YXIgbD1lLmVkZ2VzLGM9ZS5zaXRlLHM9dFtvXT1sLmxlbmd0aD9sLm1hcChmdW5jdGlvbihuKXt2YXIgdD1uLnN0YXJ0KCk7cmV0dXJuW3QueCx0LnldfSk6Yy54Pj1yJiZjLng8PWkmJmMueT49dSYmYy55PD1hP1tbcixhXSxbaSxhXSxbaSx1XSxbcix1XV06W107cy5wb2ludD1uW29dfSksdH1mdW5jdGlvbiBlKG4pe3JldHVybiBuLm1hcChmdW5jdGlvbihuLHQpe3JldHVybnt4Ok1hdGgucm91bmQoaShuLHQpL0RhKSpEYSx5Ok1hdGgucm91bmQoYShuLHQpL0RhKSpEYSxpOnR9fSl9dmFyIHI9Q2UsdT16ZSxpPXIsYT11LG89c2w7cmV0dXJuIG4/dChuKToodC5saW5rcz1mdW5jdGlvbihuKXtyZXR1cm4gb3IoZShuKSkuZWRnZXMuZmlsdGVyKGZ1bmN0aW9uKG4pe3JldHVybiBuLmwmJm4ucn0pLm1hcChmdW5jdGlvbih0KXtyZXR1cm57c291cmNlOm5bdC5sLmldLHRhcmdldDpuW3Quci5pXX19KX0sdC50cmlhbmdsZXM9ZnVuY3Rpb24obil7dmFyIHQ9W107cmV0dXJuIG9yKGUobikpLmNlbGxzLmZvckVhY2goZnVuY3Rpb24oZSxyKXtmb3IodmFyIHUsaSxhPWUuc2l0ZSxvPWUuZWRnZXMuc29ydChWZSksbD0tMSxjPW8ubGVuZ3RoLHM9b1tjLTFdLmVkZ2UsZj1zLmw9PT1hP3MucjpzLmw7KytsPGM7KXU9cyxpPWYscz1vW2xdLmVkZ2UsZj1zLmw9PT1hP3MucjpzLmwscjxpLmkmJnI8Zi5pJiZjcihhLGksZik8MCYmdC5wdXNoKFtuW3JdLG5baS5pXSxuW2YuaV1dKX0pLHR9LHQueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oaT1FbihyPW4pLHQpOnJ9LHQueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1Fbih1PW4pLHQpOnV9LHQuY2xpcEV4dGVudD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1udWxsPT1uP3NsOm4sdCk6bz09PXNsP251bGw6b30sdC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP3QuY2xpcEV4dGVudChuJiZbWzAsMF0sbl0pOm89PT1zbD9udWxsOm8mJm9bMV19LHQpfTt2YXIgc2w9W1stMWU2LC0xZTZdLFsxZTYsMWU2XV07b2EuZ2VvbS5kZWxhdW5heT1mdW5jdGlvbihuKXtyZXR1cm4gb2EuZ2VvbS52b3Jvbm9pKCkudHJpYW5nbGVzKG4pfSxvYS5nZW9tLnF1YWR0cmVlPWZ1bmN0aW9uKG4sdCxlLHIsdSl7ZnVuY3Rpb24gaShuKXtmdW5jdGlvbiBpKG4sdCxlLHIsdSxpLGEsbyl7aWYoIWlzTmFOKGUpJiYhaXNOYU4ocikpaWYobi5sZWFmKXt2YXIgbD1uLngscz1uLnk7aWYobnVsbCE9bClpZihNYShsLWUpK01hKHMtcik8LjAxKWMobix0LGUscix1LGksYSxvKTtlbHNle3ZhciBmPW4ucG9pbnQ7bi54PW4ueT1uLnBvaW50PW51bGwsYyhuLGYsbCxzLHUsaSxhLG8pLGMobix0LGUscix1LGksYSxvKX1lbHNlIG4ueD1lLG4ueT1yLG4ucG9pbnQ9dH1lbHNlIGMobix0LGUscix1LGksYSxvKX1mdW5jdGlvbiBjKG4sdCxlLHIsdSxhLG8sbCl7dmFyIGM9LjUqKHUrbykscz0uNSooYStsKSxmPWU+PWMsaD1yPj1zLGc9aDw8MXxmO24ubGVhZj0hMSxuPW4ubm9kZXNbZ118fChuLm5vZGVzW2ddPWhyKCkpLGY/dT1jOm89YyxoP2E9czpsPXMsaShuLHQsZSxyLHUsYSxvLGwpfXZhciBzLGYsaCxnLHAsdixkLG0seSxNPUVuKG8pLHg9RW4obCk7aWYobnVsbCE9dCl2PXQsZD1lLG09cix5PXU7ZWxzZSBpZihtPXk9LSh2PWQ9MS8wKSxmPVtdLGg9W10scD1uLmxlbmd0aCxhKWZvcihnPTA7cD5nOysrZylzPW5bZ10scy54PHYmJih2PXMueCkscy55PGQmJihkPXMueSkscy54Pm0mJihtPXMueCkscy55PnkmJih5PXMueSksZi5wdXNoKHMueCksaC5wdXNoKHMueSk7ZWxzZSBmb3IoZz0wO3A+ZzsrK2cpe3ZhciBiPStNKHM9bltnXSxnKSxfPSt4KHMsZyk7dj5iJiYodj1iKSxkPl8mJihkPV8pLGI+bSYmKG09YiksXz55JiYoeT1fKSxmLnB1c2goYiksaC5wdXNoKF8pfXZhciB3PW0tdixTPXktZDt3PlM/eT1kK3c6bT12K1M7dmFyIGs9aHIoKTtpZihrLmFkZD1mdW5jdGlvbihuKXtpKGssbiwrTShuLCsrZyksK3gobixnKSx2LGQsbSx5KX0say52aXNpdD1mdW5jdGlvbihuKXtncihuLGssdixkLG0seSl9LGsuZmluZD1mdW5jdGlvbihuKXtyZXR1cm4gcHIoayxuWzBdLG5bMV0sdixkLG0seSl9LGc9LTEsbnVsbD09dCl7Zm9yKDsrK2c8cDspaShrLG5bZ10sZltnXSxoW2ddLHYsZCxtLHkpOy0tZ31lbHNlIG4uZm9yRWFjaChrLmFkZCk7cmV0dXJuIGY9aD1uPXM9bnVsbCxrfXZhciBhLG89Q2UsbD16ZTtyZXR1cm4oYT1hcmd1bWVudHMubGVuZ3RoKT8obz1zcixsPWZyLDM9PT1hJiYodT1lLHI9dCxlPXQ9MCksaShuKSk6KGkueD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLGkpOm99LGkueT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1uLGkpOmx9LGkuZXh0ZW50PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhudWxsPT1uP3Q9ZT1yPXU9bnVsbDoodD0rblswXVswXSxlPStuWzBdWzFdLHI9K25bMV1bMF0sdT0rblsxXVsxXSksaSk6bnVsbD09dD9udWxsOltbdCxlXSxbcix1XV19LGkuc2l6ZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obnVsbD09bj90PWU9cj11PW51bGw6KHQ9ZT0wLHI9K25bMF0sdT0rblsxXSksaSk6bnVsbD09dD9udWxsOltyLXQsdS1lXX0saSl9LG9hLmludGVycG9sYXRlUmdiPXZyLG9hLmludGVycG9sYXRlT2JqZWN0PWRyLG9hLmludGVycG9sYXRlTnVtYmVyPW1yLG9hLmludGVycG9sYXRlU3RyaW5nPXlyO3ZhciBmbD0vWy0rXT8oPzpcZCtcLj9cZCp8XC4/XGQrKSg/OltlRV1bLStdP1xkKyk/L2csaGw9bmV3IFJlZ0V4cChmbC5zb3VyY2UsImciKTtvYS5pbnRlcnBvbGF0ZT1NcixvYS5pbnRlcnBvbGF0b3JzPVtmdW5jdGlvbihuLHQpe3ZhciBlPXR5cGVvZiB0O3JldHVybigic3RyaW5nIj09PWU/cm8uaGFzKHQudG9Mb3dlckNhc2UoKSl8fC9eKCN8cmdiXCh8aHNsXCgpL2kudGVzdCh0KT92cjp5cjp0IGluc3RhbmNlb2Ygb24/dnI6QXJyYXkuaXNBcnJheSh0KT94cjoib2JqZWN0Ij09PWUmJmlzTmFOKHQpP2RyOm1yKShuLHQpfV0sb2EuaW50ZXJwb2xhdGVBcnJheT14cjt2YXIgZ2w9ZnVuY3Rpb24oKXtyZXR1cm4geX0scGw9b2EubWFwKHtsaW5lYXI6Z2wscG9seTpFcixxdWFkOmZ1bmN0aW9uKCl7cmV0dXJuIFNyfSxjdWJpYzpmdW5jdGlvbigpe3JldHVybiBrcn0sc2luOmZ1bmN0aW9uKCl7cmV0dXJuIEFyfSxleHA6ZnVuY3Rpb24oKXtyZXR1cm4gQ3J9LGNpcmNsZTpmdW5jdGlvbigpe3JldHVybiB6cn0sZWxhc3RpYzpMcixiYWNrOnFyLGJvdW5jZTpmdW5jdGlvbigpe3JldHVybiBUcn19KSx2bD1vYS5tYXAoeyJpbiI6eSxvdXQ6X3IsImluLW91dCI6d3IsIm91dC1pbiI6ZnVuY3Rpb24obil7cmV0dXJuIHdyKF9yKG4pKX19KTtvYS5lYXNlPWZ1bmN0aW9uKG4pe3ZhciB0PW4uaW5kZXhPZigiLSIpLGU9dD49MD9uLnNsaWNlKDAsdCk6bixyPXQ+PTA/bi5zbGljZSh0KzEpOiJpbiI7cmV0dXJuIGU9cGwuZ2V0KGUpfHxnbCxyPXZsLmdldChyKXx8eSxicihyKGUuYXBwbHkobnVsbCxsYS5jYWxsKGFyZ3VtZW50cywxKSkpKX0sb2EuaW50ZXJwb2xhdGVIY2w9UnIsb2EuaW50ZXJwb2xhdGVIc2w9RHIsb2EuaW50ZXJwb2xhdGVMYWI9UHIsb2EuaW50ZXJwb2xhdGVSb3VuZD1VcixvYS50cmFuc2Zvcm09ZnVuY3Rpb24obil7dmFyIHQ9c2EuY3JlYXRlRWxlbWVudE5TKG9hLm5zLnByZWZpeC5zdmcsImciKTtyZXR1cm4ob2EudHJhbnNmb3JtPWZ1bmN0aW9uKG4pe2lmKG51bGwhPW4pe3Quc2V0QXR0cmlidXRlKCJ0cmFuc2Zvcm0iLG4pO3ZhciBlPXQudHJhbnNmb3JtLmJhc2VWYWwuY29uc29saWRhdGUoKX1yZXR1cm4gbmV3IGpyKGU/ZS5tYXRyaXg6ZGwpfSkobil9LGpyLnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3JldHVybiJ0cmFuc2xhdGUoIit0aGlzLnRyYW5zbGF0ZSsiKXJvdGF0ZSgiK3RoaXMucm90YXRlKyIpc2tld1goIit0aGlzLnNrZXcrIilzY2FsZSgiK3RoaXMuc2NhbGUrIikifTt2YXIgZGw9e2E6MSxiOjAsYzowLGQ6MSxlOjAsZjowfTtvYS5pbnRlcnBvbGF0ZVRyYW5zZm9ybT0kcixvYS5sYXlvdXQ9e30sb2EubGF5b3V0LmJ1bmRsZT1mdW5jdGlvbigpe3JldHVybiBmdW5jdGlvbihuKXtmb3IodmFyIHQ9W10sZT0tMSxyPW4ubGVuZ3RoOysrZTxyOyl0LnB1c2goSnIobltlXSkpO3JldHVybiB0fX0sb2EubGF5b3V0LmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbigpe3ZhciBuLGMsZixoLGcscD17fSx2PVtdLGQ9b2EucmFuZ2UoaSksbT1bXTtmb3IoZT1bXSxyPVtdLG49MCxoPS0xOysraDxpOyl7Zm9yKGM9MCxnPS0xOysrZzxpOyljKz11W2hdW2ddO3YucHVzaChjKSxtLnB1c2gob2EucmFuZ2UoaSkpLG4rPWN9Zm9yKGEmJmQuc29ydChmdW5jdGlvbihuLHQpe3JldHVybiBhKHZbbl0sdlt0XSl9KSxvJiZtLmZvckVhY2goZnVuY3Rpb24obix0KXtuLnNvcnQoZnVuY3Rpb24obixlKXtyZXR1cm4gbyh1W3RdW25dLHVbdF1bZV0pfSl9KSxuPShqYS1zKmkpL24sYz0wLGg9LTE7KytoPGk7KXtmb3IoZj1jLGc9LTE7KytnPGk7KXt2YXIgeT1kW2hdLE09bVt5XVtnXSx4PXVbeV1bTV0sYj1jLF89Yys9eCpuO3BbeSsiLSIrTV09e2luZGV4Onksc3ViaW5kZXg6TSxzdGFydEFuZ2xlOmIsZW5kQW5nbGU6Xyx2YWx1ZTp4fX1yW3ldPXtpbmRleDp5LHN0YXJ0QW5nbGU6ZixlbmRBbmdsZTpjLHZhbHVlOnZbeV19LGMrPXN9Zm9yKGg9LTE7KytoPGk7KWZvcihnPWgtMTsrK2c8aTspe3ZhciB3PXBbaCsiLSIrZ10sUz1wW2crIi0iK2hdOyh3LnZhbHVlfHxTLnZhbHVlKSYmZS5wdXNoKHcudmFsdWU8Uy52YWx1ZT97c291cmNlOlMsdGFyZ2V0Ond9Ontzb3VyY2U6dyx0YXJnZXQ6U30pfWwmJnQoKX1mdW5jdGlvbiB0KCl7ZS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIGwoKG4uc291cmNlLnZhbHVlK24udGFyZ2V0LnZhbHVlKS8yLCh0LnNvdXJjZS52YWx1ZSt0LnRhcmdldC52YWx1ZSkvMil9KX12YXIgZSxyLHUsaSxhLG8sbCxjPXt9LHM9MDtyZXR1cm4gYy5tYXRyaXg9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9KHU9bikmJnUubGVuZ3RoLGU9cj1udWxsLGMpOnV9LGMucGFkZGluZz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz1uLGU9cj1udWxsLGMpOnN9LGMuc29ydEdyb3Vwcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYT1uLGU9cj1udWxsLGMpOmF9LGMuc29ydFN1Ymdyb3Vwcz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1uLGU9bnVsbCxjKTpvfSxjLnNvcnRDaG9yZHM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGw9bixlJiZ0KCksYyk6bH0sYy5jaG9yZHM9ZnVuY3Rpb24oKXtyZXR1cm4gZXx8bigpLGV9LGMuZ3JvdXBzPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fG4oKSxyfSxjfSxvYS5sYXlvdXQuZm9yY2U9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe3JldHVybiBmdW5jdGlvbih0LGUscix1KXtpZih0LnBvaW50IT09bil7dmFyIGk9dC5jeC1uLngsYT10LmN5LW4ueSxvPXUtZSxsPWkqaSthKmE7aWYobD5vKm8vbSl7aWYodj5sKXt2YXIgYz10LmNoYXJnZS9sO24ucHgtPWkqYyxuLnB5LT1hKmN9cmV0dXJuITB9aWYodC5wb2ludCYmbCYmdj5sKXt2YXIgYz10LnBvaW50Q2hhcmdlL2w7bi5weC09aSpjLG4ucHktPWEqY319cmV0dXJuIXQuY2hhcmdlfX1mdW5jdGlvbiB0KG4pe24ucHg9b2EuZXZlbnQueCxuLnB5PW9hLmV2ZW50LnksbC5yZXN1bWUoKX12YXIgZSxyLHUsaSxhLG8sbD17fSxjPW9hLmRpc3BhdGNoKCJzdGFydCIsInRpY2siLCJlbmQiKSxzPVsxLDFdLGY9LjksaD1tbCxnPXlsLHA9LTMwLHY9TWwsZD0uMSxtPS42NCxNPVtdLHg9W107cmV0dXJuIGwudGljaz1mdW5jdGlvbigpe2lmKCh1Kj0uOTkpPC4wMDUpcmV0dXJuIGU9bnVsbCxjLmVuZCh7dHlwZToiZW5kIixhbHBoYTp1PTB9KSwhMDt2YXIgdCxyLGwsaCxnLHYsbSx5LGIsXz1NLmxlbmd0aCx3PXgubGVuZ3RoO2ZvcihyPTA7dz5yOysrcilsPXhbcl0saD1sLnNvdXJjZSxnPWwudGFyZ2V0LHk9Zy54LWgueCxiPWcueS1oLnksKHY9eSp5K2IqYikmJih2PXUqYVtyXSooKHY9TWF0aC5zcXJ0KHYpKS1pW3JdKS92LHkqPXYsYio9dixnLngtPXkqKG09aC53ZWlnaHQrZy53ZWlnaHQ/aC53ZWlnaHQvKGgud2VpZ2h0K2cud2VpZ2h0KTouNSksZy55LT1iKm0saC54Kz15KihtPTEtbSksaC55Kz1iKm0pO2lmKChtPXUqZCkmJih5PXNbMF0vMixiPXNbMV0vMixyPS0xLG0pKWZvcig7KytyPF87KWw9TVtyXSxsLngrPSh5LWwueCkqbSxsLnkrPShiLWwueSkqbTtpZihwKWZvcihydSh0PW9hLmdlb20ucXVhZHRyZWUoTSksdSxvKSxyPS0xOysrcjxfOykobD1NW3JdKS5maXhlZHx8dC52aXNpdChuKGwpKTtmb3Iocj0tMTsrK3I8XzspbD1NW3JdLGwuZml4ZWQ/KGwueD1sLnB4LGwueT1sLnB5KToobC54LT0obC5weC0obC5weD1sLngpKSpmLGwueS09KGwucHktKGwucHk9bC55KSkqZik7Yy50aWNrKHt0eXBlOiJ0aWNrIixhbHBoYTp1fSl9LGwubm9kZXM9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KE09bixsKTpNfSxsLmxpbmtzPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh4PW4sbCk6eH0sbC5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhzPW4sbCk6c30sbC5saW5rRGlzdGFuY2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9ImZ1bmN0aW9uIj09dHlwZW9mIG4/bjorbixsKTpofSxsLmRpc3RhbmNlPWwubGlua0Rpc3RhbmNlLGwubGlua1N0cmVuZ3RoPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhnPSJmdW5jdGlvbiI9PXR5cGVvZiBuP246K24sbCk6Z30sbC5mcmljdGlvbj1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZj0rbixsKTpmfSxsLmNoYXJnZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD0iZnVuY3Rpb24iPT10eXBlb2Ygbj9uOituLGwpOnB9LGwuY2hhcmdlRGlzdGFuY2U9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHY9bipuLGwpOk1hdGguc3FydCh2KX0sbC5ncmF2aXR5PWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhkPStuLGwpOmR9LGwudGhldGE9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG09bipuLGwpOk1hdGguc3FydChtKX0sbC5hbHBoYT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obj0rbix1P24+MD91PW46KGUuYz1udWxsLGUudD1OYU4sZT1udWxsLGMuZW5kKHt0eXBlOiJlbmQiLGFscGhhOnU9MH0pKTpuPjAmJihjLnN0YXJ0KHt0eXBlOiJzdGFydCIsYWxwaGE6dT1ufSksZT1xbihsLnRpY2spKSxsKTp1fSxsLnN0YXJ0PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHIpe2lmKCFlKXtmb3IoZT1uZXcgQXJyYXkodSksbD0wO3U+bDsrK2wpZVtsXT1bXTtmb3IobD0wO2M+bDsrK2wpe3ZhciBpPXhbbF07ZVtpLnNvdXJjZS5pbmRleF0ucHVzaChpLnRhcmdldCksZVtpLnRhcmdldC5pbmRleF0ucHVzaChpLnNvdXJjZSl9fWZvcih2YXIgYSxvPWVbdF0sbD0tMSxzPW8ubGVuZ3RoOysrbDxzOylpZighaXNOYU4oYT1vW2xdW25dKSlyZXR1cm4gYTtyZXR1cm4gTWF0aC5yYW5kb20oKSpyfXZhciB0LGUscix1PU0ubGVuZ3RoLGM9eC5sZW5ndGgsZj1zWzBdLHY9c1sxXTtmb3IodD0wO3U+dDsrK3QpKHI9TVt0XSkuaW5kZXg9dCxyLndlaWdodD0wO2Zvcih0PTA7Yz50OysrdClyPXhbdF0sIm51bWJlciI9PXR5cGVvZiByLnNvdXJjZSYmKHIuc291cmNlPU1bci5zb3VyY2VdKSwibnVtYmVyIj09dHlwZW9mIHIudGFyZ2V0JiYoci50YXJnZXQ9TVtyLnRhcmdldF0pLCsrci5zb3VyY2Uud2VpZ2h0LCsrci50YXJnZXQud2VpZ2h0O2Zvcih0PTA7dT50OysrdClyPU1bdF0saXNOYU4oci54KSYmKHIueD1uKCJ4IixmKSksaXNOYU4oci55KSYmKHIueT1uKCJ5Iix2KSksaXNOYU4oci5weCkmJihyLnB4PXIueCksaXNOYU4oci5weSkmJihyLnB5PXIueSk7aWYoaT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgaClmb3IodD0wO2M+dDsrK3QpaVt0XT0raC5jYWxsKHRoaXMseFt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClpW3RdPWg7aWYoYT1bXSwiZnVuY3Rpb24iPT10eXBlb2YgZylmb3IodD0wO2M+dDsrK3QpYVt0XT0rZy5jYWxsKHRoaXMseFt0XSx0KTtlbHNlIGZvcih0PTA7Yz50OysrdClhW3RdPWc7aWYobz1bXSwiZnVuY3Rpb24iPT10eXBlb2YgcClmb3IodD0wO3U+dDsrK3Qpb1t0XT0rcC5jYWxsKHRoaXMsTVt0XSx0KTtlbHNlIGZvcih0PTA7dT50OysrdClvW3RdPXA7cmV0dXJuIGwucmVzdW1lKCl9LGwucmVzdW1lPWZ1bmN0aW9uKCl7cmV0dXJuIGwuYWxwaGEoLjEpfSxsLnN0b3A9ZnVuY3Rpb24oKXtyZXR1cm4gbC5hbHBoYSgwKX0sbC5kcmFnPWZ1bmN0aW9uKCl7cmV0dXJuIHJ8fChyPW9hLmJlaGF2aW9yLmRyYWcoKS5vcmlnaW4oeSkub24oImRyYWdzdGFydC5mb3JjZSIsUXIpLm9uKCJkcmFnLmZvcmNlIix0KS5vbigiZHJhZ2VuZC5mb3JjZSIsbnUpKSxhcmd1bWVudHMubGVuZ3RoP3ZvaWQgdGhpcy5vbigibW91c2VvdmVyLmZvcmNlIix0dSkub24oIm1vdXNlb3V0LmZvcmNlIixldSkuY2FsbChyKTpyfSxvYS5yZWJpbmQobCxjLCJvbiIpfTt2YXIgbWw9MjAseWw9MSxNbD0xLzA7b2EubGF5b3V0LmhpZXJhcmNoeT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odSl7dmFyIGksYT1bdV0sbz1bXTtmb3IodS5kZXB0aD0wO251bGwhPShpPWEucG9wKCkpOylpZihvLnB1c2goaSksKGM9ZS5jYWxsKG4saSxpLmRlcHRoKSkmJihsPWMubGVuZ3RoKSl7Zm9yKHZhciBsLGMsczstLWw+PTA7KWEucHVzaChzPWNbbF0pLHMucGFyZW50PWkscy5kZXB0aD1pLmRlcHRoKzE7ciYmKGkudmFsdWU9MCksaS5jaGlsZHJlbj1jfWVsc2UgciYmKGkudmFsdWU9K3IuY2FsbChuLGksaS5kZXB0aCl8fDApLGRlbGV0ZSBpLmNoaWxkcmVuO3JldHVybiBhdSh1LGZ1bmN0aW9uKG4pe3ZhciBlLHU7dCYmKGU9bi5jaGlsZHJlbikmJmUuc29ydCh0KSxyJiYodT1uLnBhcmVudCkmJih1LnZhbHVlKz1uLnZhbHVlKX0pLG99dmFyIHQ9Y3UsZT1vdSxyPWx1O3JldHVybiBuLnNvcnQ9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ZSxuKTp0fSxuLmNoaWxkcmVuPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocj10LG4pOnJ9LG4ucmV2YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gciYmKGl1KHQsZnVuY3Rpb24obil7bi5jaGlsZHJlbiYmKG4udmFsdWU9MCl9KSxhdSh0LGZ1bmN0aW9uKHQpe3ZhciBlO3QuY2hpbGRyZW58fCh0LnZhbHVlPStyLmNhbGwobix0LHQuZGVwdGgpfHwwKSwoZT10LnBhcmVudCkmJihlLnZhbHVlKz10LnZhbHVlKX0pKSx0fSxufSxvYS5sYXlvdXQucGFydGl0aW9uPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbih0LGUscix1KXt2YXIgaT10LmNoaWxkcmVuO2lmKHQueD1lLHQueT10LmRlcHRoKnUsdC5keD1yLHQuZHk9dSxpJiYoYT1pLmxlbmd0aCkpe3ZhciBhLG8sbCxjPS0xO2ZvcihyPXQudmFsdWU/ci90LnZhbHVlOjA7KytjPGE7KW4obz1pW2NdLGUsbD1vLnZhbHVlKnIsdSksZSs9bH19ZnVuY3Rpb24gdChuKXt2YXIgZT1uLmNoaWxkcmVuLHI9MDtpZihlJiYodT1lLmxlbmd0aCkpZm9yKHZhciB1LGk9LTE7KytpPHU7KXI9TWF0aC5tYXgocix0KGVbaV0pKTtyZXR1cm4gMStyfWZ1bmN0aW9uIGUoZSxpKXt2YXIgYT1yLmNhbGwodGhpcyxlLGkpO3JldHVybiBuKGFbMF0sMCx1WzBdLHVbMV0vdChhWzBdKSksYX12YXIgcj1vYS5sYXlvdXQuaGllcmFyY2h5KCksdT1bMSwxXTtyZXR1cm4gZS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PW4sZSk6dX0sdXUoZSxyKX0sb2EubGF5b3V0LnBpZT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oYSl7dmFyIG8sbD1hLmxlbmd0aCxjPWEubWFwKGZ1bmN0aW9uKGUscil7cmV0dXJuK3QuY2FsbChuLGUscil9KSxzPSsoImZ1bmN0aW9uIj09dHlwZW9mIHI/ci5hcHBseSh0aGlzLGFyZ3VtZW50cyk6ciksZj0oImZ1bmN0aW9uIj09dHlwZW9mIHU/dS5hcHBseSh0aGlzLGFyZ3VtZW50cyk6dSktcyxoPU1hdGgubWluKE1hdGguYWJzKGYpL2wsKygiZnVuY3Rpb24iPT10eXBlb2YgaT9pLmFwcGx5KHRoaXMsYXJndW1lbnRzKTppKSksZz1oKigwPmY/LTE6MSkscD1vYS5zdW0oYyksdj1wPyhmLWwqZykvcDowLGQ9b2EucmFuZ2UobCksbT1bXTtyZXR1cm4gbnVsbCE9ZSYmZC5zb3J0KGU9PT14bD9mdW5jdGlvbihuLHQpe3JldHVybiBjW3RdLWNbbl19OmZ1bmN0aW9uKG4sdCl7cmV0dXJuIGUoYVtuXSxhW3RdKX0pLGQuZm9yRWFjaChmdW5jdGlvbihuKXttW25dPXtkYXRhOmFbbl0sdmFsdWU6bz1jW25dLHN0YXJ0QW5nbGU6cyxlbmRBbmdsZTpzKz1vKnYrZyxwYWRBbmdsZTpofX0pLG19dmFyIHQ9TnVtYmVyLGU9eGwscj0wLHU9amEsaT0wO3JldHVybiBuLnZhbHVlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PWUsbik6dH0sbi5zb3J0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPXQsbik6cn0sbi5lbmRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucGFkQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxufTt2YXIgeGw9e307b2EubGF5b3V0LnN0YWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihvLGwpe2lmKCEoaD1vLmxlbmd0aCkpcmV0dXJuIG87dmFyIGM9by5tYXAoZnVuY3Rpb24oZSxyKXtyZXR1cm4gdC5jYWxsKG4sZSxyKX0pLHM9Yy5tYXAoZnVuY3Rpb24odCl7cmV0dXJuIHQubWFwKGZ1bmN0aW9uKHQsZSl7cmV0dXJuW2kuY2FsbChuLHQsZSksYS5jYWxsKG4sdCxlKV19KX0pLGY9ZS5jYWxsKG4scyxsKTtjPW9hLnBlcm11dGUoYyxmKSxzPW9hLnBlcm11dGUocyxmKTt2YXIgaCxnLHAsdixkPXIuY2FsbChuLHMsbCksbT1jWzBdLmxlbmd0aDtmb3IocD0wO20+cDsrK3ApZm9yKHUuY2FsbChuLGNbMF1bcF0sdj1kW3BdLHNbMF1bcF1bMV0pLGc9MTtoPmc7KytnKXUuY2FsbChuLGNbZ11bcF0sdis9c1tnLTFdW3BdWzFdLHNbZ11bcF1bMV0pO3JldHVybiBvfXZhciB0PXksZT1wdSxyPXZ1LHU9Z3UsaT1mdSxhPWh1O3JldHVybiBuLnZhbHVlcz1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4ub3JkZXI9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9ImZ1bmN0aW9uIj09dHlwZW9mIHQ/dDpibC5nZXQodCl8fHB1LG4pOmV9LG4ub2Zmc2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSJmdW5jdGlvbiI9PXR5cGVvZiB0P3Q6X2wuZ2V0KHQpfHx2dSxuKTpyfSxuLng9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dCxuKTppfSxuLnk9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9dCxuKTphfSxuLm91dD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG59O3ZhciBibD1vYS5tYXAoeyJpbnNpZGUtb3V0IjpmdW5jdGlvbihuKXt2YXIgdCxlLHI9bi5sZW5ndGgsdT1uLm1hcChkdSksaT1uLm1hcChtdSksYT1vYS5yYW5nZShyKS5zb3J0KGZ1bmN0aW9uKG4sdCl7cmV0dXJuIHVbbl0tdVt0XX0pLG89MCxsPTAsYz1bXSxzPVtdO2Zvcih0PTA7cj50OysrdCllPWFbdF0sbD5vPyhvKz1pW2VdLGMucHVzaChlKSk6KGwrPWlbZV0scy5wdXNoKGUpKTtyZXR1cm4gcy5yZXZlcnNlKCkuY29uY2F0KGMpfSxyZXZlcnNlOmZ1bmN0aW9uKG4pe3JldHVybiBvYS5yYW5nZShuLmxlbmd0aCkucmV2ZXJzZSgpfSwiZGVmYXVsdCI6cHV9KSxfbD1vYS5tYXAoe3NpbGhvdWV0dGU6ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9bi5sZW5ndGgsaT1uWzBdLmxlbmd0aCxhPVtdLG89MCxsPVtdO2ZvcihlPTA7aT5lOysrZSl7Zm9yKHQ9MCxyPTA7dT50O3QrKylyKz1uW3RdW2VdWzFdO3I+byYmKG89ciksYS5wdXNoKHIpfWZvcihlPTA7aT5lOysrZSlsW2VdPShvLWFbZV0pLzI7cmV0dXJuIGx9LHdpZ2dsZTpmdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLGEsbyxsLGMscz1uLmxlbmd0aCxmPW5bMF0saD1mLmxlbmd0aCxnPVtdO2ZvcihnWzBdPWw9Yz0wLGU9MTtoPmU7KytlKXtmb3IodD0wLHU9MDtzPnQ7Kyt0KXUrPW5bdF1bZV1bMV07Zm9yKHQ9MCxpPTAsbz1mW2VdWzBdLWZbZS0xXVswXTtzPnQ7Kyt0KXtmb3Iocj0wLGE9KG5bdF1bZV1bMV0tblt0XVtlLTFdWzFdKS8oMipvKTt0PnI7KytyKWErPShuW3JdW2VdWzFdLW5bcl1bZS0xXVsxXSkvbztpKz1hKm5bdF1bZV1bMV19Z1tlXT1sLT11P2kvdSpvOjAsYz5sJiYoYz1sKX1mb3IoZT0wO2g+ZTsrK2UpZ1tlXS09YztyZXR1cm4gZ30sZXhwYW5kOmZ1bmN0aW9uKG4pe3ZhciB0LGUscix1PW4ubGVuZ3RoLGk9blswXS5sZW5ndGgsYT0xL3Usbz1bXTtmb3IoZT0wO2k+ZTsrK2Upe2Zvcih0PTAscj0wO3U+dDt0Kyspcis9blt0XVtlXVsxXTtpZihyKWZvcih0PTA7dT50O3QrKyluW3RdW2VdWzFdLz1yO2Vsc2UgZm9yKHQ9MDt1PnQ7dCsrKW5bdF1bZV1bMV09YX1mb3IoZT0wO2k+ZTsrK2Upb1tlXT0wO3JldHVybiBvfSx6ZXJvOnZ1fSk7b2EubGF5b3V0Lmhpc3RvZ3JhbT1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixpKXtmb3IodmFyIGEsbyxsPVtdLGM9bi5tYXAoZSx0aGlzKSxzPXIuY2FsbCh0aGlzLGMsaSksZj11LmNhbGwodGhpcyxzLGMsaSksaT0tMSxoPWMubGVuZ3RoLGc9Zi5sZW5ndGgtMSxwPXQ/MToxL2g7KytpPGc7KWE9bFtpXT1bXSxhLmR4PWZbaSsxXS0oYS54PWZbaV0pLGEueT0wO2lmKGc+MClmb3IoaT0tMTsrK2k8aDspbz1jW2ldLG8+PXNbMF0mJm88PXNbMV0mJihhPWxbb2EuYmlzZWN0KGYsbywxLGcpLTFdLGEueSs9cCxhLnB1c2gobltpXSkpO3JldHVybiBsfXZhciB0PSEwLGU9TnVtYmVyLHI9YnUsdT1NdTtyZXR1cm4gbi52YWx1ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT10LG4pOmV9LG4ucmFuZ2U9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RW4odCksbik6cn0sbi5iaW5zPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh1PSJudW1iZXIiPT10eXBlb2YgdD9mdW5jdGlvbihuKXtyZXR1cm4geHUobix0KX06RW4odCksbik6dX0sbi5mcmVxdWVuY3k9ZnVuY3Rpb24oZSl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHQ9ISFlLG4pOnR9LG59LG9hLmxheW91dC5wYWNrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLGkpe3ZhciBhPWUuY2FsbCh0aGlzLG4saSksbz1hWzBdLGw9dVswXSxjPXVbMV0scz1udWxsPT10P01hdGguc3FydDoiZnVuY3Rpb24iPT10eXBlb2YgdD90OmZ1bmN0aW9uKCl7cmV0dXJuIHR9O2lmKG8ueD1vLnk9MCxhdShvLGZ1bmN0aW9uKG4pe24ucj0rcyhuLnZhbHVlKX0pLGF1KG8sTnUpLHIpe3ZhciBmPXIqKHQ/MTpNYXRoLm1heCgyKm8uci9sLDIqby5yL2MpKS8yO2F1KG8sZnVuY3Rpb24obil7bi5yKz1mfSksYXUobyxOdSksYXUobyxmdW5jdGlvbihuKXtuLnItPWZ9KX1yZXR1cm4gQ3UobyxsLzIsYy8yLHQ/MToxL01hdGgubWF4KDIqby5yL2wsMipvLnIvYykpLGF9dmFyIHQsZT1vYS5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChfdSkscj0wLHU9WzEsMV07cmV0dXJuIG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odT10LG4pOnV9LG4ucmFkaXVzPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PW51bGw9PWV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlP2U6K2Usbik6dH0sbi5wYWRkaW5nPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhyPSt0LG4pOnJ9LHV1KG4sZSl9LG9hLmxheW91dC50cmVlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHUpe3ZhciBzPWEuY2FsbCh0aGlzLG4sdSksZj1zWzBdLGg9dChmKTtpZihhdShoLGUpLGgucGFyZW50Lm09LWgueixpdShoLHIpLGMpaXUoZixpKTtlbHNle3ZhciBnPWYscD1mLHY9ZjtpdShmLGZ1bmN0aW9uKG4pe24ueDxnLngmJihnPW4pLG4ueD5wLngmJihwPW4pLG4uZGVwdGg+di5kZXB0aCYmKHY9bil9KTt2YXIgZD1vKGcscCkvMi1nLngsbT1sWzBdLyhwLngrbyhwLGcpLzIrZCkseT1sWzFdLyh2LmRlcHRofHwxKTtpdShmLGZ1bmN0aW9uKG4pe24ueD0obi54K2QpKm0sbi55PW4uZGVwdGgqeX0pfXJldHVybiBzfWZ1bmN0aW9uIHQobil7Zm9yKHZhciB0LGU9e0E6bnVsbCxjaGlsZHJlbjpbbl19LHI9W2VdO251bGwhPSh0PXIucG9wKCkpOylmb3IodmFyIHUsaT10LmNoaWxkcmVuLGE9MCxvPWkubGVuZ3RoO28+YTsrK2Epci5wdXNoKChpW2FdPXU9e186aVthXSxwYXJlbnQ6dCxjaGlsZHJlbjoodT1pW2FdLmNoaWxkcmVuKSYmdS5zbGljZSgpfHxbXSxBOm51bGwsYTpudWxsLHo6MCxtOjAsYzowLHM6MCx0Om51bGwsaTphfSkuYT11KTtyZXR1cm4gZS5jaGlsZHJlblswXX1mdW5jdGlvbiBlKG4pe3ZhciB0PW4uY2hpbGRyZW4sZT1uLnBhcmVudC5jaGlsZHJlbixyPW4uaT9lW24uaS0xXTpudWxsO2lmKHQubGVuZ3RoKXtEdShuKTt2YXIgaT0odFswXS56K3RbdC5sZW5ndGgtMV0ueikvMjtyPyhuLno9ci56K28obi5fLHIuXyksbi5tPW4uei1pKTpuLno9aX1lbHNlIHImJihuLno9ci56K28obi5fLHIuXykpO24ucGFyZW50LkE9dShuLHIsbi5wYXJlbnQuQXx8ZVswXSl9ZnVuY3Rpb24gcihuKXtuLl8ueD1uLnorbi5wYXJlbnQubSxuLm0rPW4ucGFyZW50Lm19ZnVuY3Rpb24gdShuLHQsZSl7aWYodCl7Zm9yKHZhciByLHU9bixpPW4sYT10LGw9dS5wYXJlbnQuY2hpbGRyZW5bMF0sYz11Lm0scz1pLm0sZj1hLm0saD1sLm07YT1UdShhKSx1PXF1KHUpLGEmJnU7KWw9cXUobCksaT1UdShpKSxpLmE9bixyPWEueitmLXUuei1jK28oYS5fLHUuXykscj4wJiYoUnUoUHUoYSxuLGUpLG4sciksYys9cixzKz1yKSxmKz1hLm0sYys9dS5tLGgrPWwubSxzKz1pLm07YSYmIVR1KGkpJiYoaS50PWEsaS5tKz1mLXMpLHUmJiFxdShsKSYmKGwudD11LGwubSs9Yy1oLGU9bil9cmV0dXJuIGV9ZnVuY3Rpb24gaShuKXtuLngqPWxbMF0sbi55PW4uZGVwdGgqbFsxXX12YXIgYT1vYS5sYXlvdXQuaGllcmFyY2h5KCkuc29ydChudWxsKS52YWx1ZShudWxsKSxvPUx1LGw9WzEsMV0sYz1udWxsO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89dCxuKTpvfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGM9bnVsbD09KGw9dCk/aTpudWxsLG4pOmM/bnVsbDpsfSxuLm5vZGVTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW51bGw9PShsPXQpP251bGw6aSxuKTpjP2w6bnVsbH0sdXUobixhKX0sb2EubGF5b3V0LmNsdXN0ZXI9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4saSl7dmFyIGEsbz10LmNhbGwodGhpcyxuLGkpLGw9b1swXSxjPTA7YXUobCxmdW5jdGlvbihuKXt2YXIgdD1uLmNoaWxkcmVuO3QmJnQubGVuZ3RoPyhuLng9anUodCksbi55PVV1KHQpKToobi54PWE/Yys9ZShuLGEpOjAsbi55PTAsYT1uKX0pO3ZhciBzPUZ1KGwpLGY9SHUobCksaD1zLngtZShzLGYpLzIsZz1mLngrZShmLHMpLzI7cmV0dXJuIGF1KGwsdT9mdW5jdGlvbihuKXtuLng9KG4ueC1sLngpKnJbMF0sbi55PShsLnktbi55KSpyWzFdfTpmdW5jdGlvbihuKXtuLng9KG4ueC1oKS8oZy1oKSpyWzBdLG4ueT0oMS0obC55P24ueS9sLnk6MSkpKnJbMV19KSxvfXZhciB0PW9hLmxheW91dC5oaWVyYXJjaHkoKS5zb3J0KG51bGwpLnZhbHVlKG51bGwpLGU9THUscj1bMSwxXSx1PSExO3JldHVybiBuLnNlcGFyYXRpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGU9dCxuKTplfSxuLnNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbD09KHI9dCksbik6dT9udWxsOnJ9LG4ubm9kZVNpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9bnVsbCE9KHI9dCksbik6dT9yOm51bGx9LHV1KG4sdCl9LG9hLmxheW91dC50cmVlbWFwPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLHQpe2Zvcih2YXIgZSxyLHU9LTEsaT1uLmxlbmd0aDsrK3U8aTspcj0oZT1uW3VdKS52YWx1ZSooMD50PzA6dCksZS5hcmVhPWlzTmFOKHIpfHwwPj1yPzA6cn1mdW5jdGlvbiB0KGUpe3ZhciBpPWUuY2hpbGRyZW47aWYoaSYmaS5sZW5ndGgpe3ZhciBhLG8sbCxjPWYoZSkscz1bXSxoPWkuc2xpY2UoKSxwPTEvMCx2PSJzbGljZSI9PT1nP2MuZHg6ImRpY2UiPT09Zz9jLmR5OiJzbGljZS1kaWNlIj09PWc/MSZlLmRlcHRoP2MuZHk6Yy5keDpNYXRoLm1pbihjLmR4LGMuZHkpO2ZvcihuKGgsYy5keCpjLmR5L2UudmFsdWUpLHMuYXJlYT0wOyhsPWgubGVuZ3RoKT4wOylzLnB1c2goYT1oW2wtMV0pLHMuYXJlYSs9YS5hcmVhLCJzcXVhcmlmeSIhPT1nfHwobz1yKHMsdikpPD1wPyhoLnBvcCgpLHA9byk6KHMuYXJlYS09cy5wb3AoKS5hcmVhLHUocyx2LGMsITEpLHY9TWF0aC5taW4oYy5keCxjLmR5KSxzLmxlbmd0aD1zLmFyZWE9MCxwPTEvMCk7cy5sZW5ndGgmJih1KHMsdixjLCEwKSxzLmxlbmd0aD1zLmFyZWE9MCksaS5mb3JFYWNoKHQpfX1mdW5jdGlvbiBlKHQpe3ZhciByPXQuY2hpbGRyZW47aWYociYmci5sZW5ndGgpe3ZhciBpLGE9Zih0KSxvPXIuc2xpY2UoKSxsPVtdO2ZvcihuKG8sYS5keCphLmR5L3QudmFsdWUpLGwuYXJlYT0wO2k9by5wb3AoKTspbC5wdXNoKGkpLGwuYXJlYSs9aS5hcmVhLG51bGwhPWkueiYmKHUobCxpLno/YS5keDphLmR5LGEsIW8ubGVuZ3RoKSxsLmxlbmd0aD1sLmFyZWE9MCk7ci5mb3JFYWNoKGUpfX1mdW5jdGlvbiByKG4sdCl7Zm9yKHZhciBlLHI9bi5hcmVhLHU9MCxpPTEvMCxhPS0xLG89bi5sZW5ndGg7KythPG87KShlPW5bYV0uYXJlYSkmJihpPmUmJihpPWUpLGU+dSYmKHU9ZSkpO3JldHVybiByKj1yLHQqPXQscj9NYXRoLm1heCh0KnUqcC9yLHIvKHQqaSpwKSk6MS8wfWZ1bmN0aW9uIHUobix0LGUscil7dmFyIHUsaT0tMSxhPW4ubGVuZ3RoLG89ZS54LGM9ZS55LHM9dD9sKG4uYXJlYS90KTowOwppZih0PT1lLmR4KXtmb3IoKHJ8fHM+ZS5keSkmJihzPWUuZHkpOysraTxhOyl1PW5baV0sdS54PW8sdS55PWMsdS5keT1zLG8rPXUuZHg9TWF0aC5taW4oZS54K2UuZHgtbyxzP2wodS5hcmVhL3MpOjApO3Uuej0hMCx1LmR4Kz1lLngrZS5keC1vLGUueSs9cyxlLmR5LT1zfWVsc2V7Zm9yKChyfHxzPmUuZHgpJiYocz1lLmR4KTsrK2k8YTspdT1uW2ldLHUueD1vLHUueT1jLHUuZHg9cyxjKz11LmR5PU1hdGgubWluKGUueStlLmR5LWMscz9sKHUuYXJlYS9zKTowKTt1Lno9ITEsdS5keSs9ZS55K2UuZHktYyxlLngrPXMsZS5keC09c319ZnVuY3Rpb24gaShyKXt2YXIgdT1hfHxvKHIpLGk9dVswXTtyZXR1cm4gaS54PWkueT0wLGkudmFsdWU/KGkuZHg9Y1swXSxpLmR5PWNbMV0pOmkuZHg9aS5keT0wLGEmJm8ucmV2YWx1ZShpKSxuKFtpXSxpLmR4KmkuZHkvaS52YWx1ZSksKGE/ZTp0KShpKSxoJiYoYT11KSx1fXZhciBhLG89b2EubGF5b3V0LmhpZXJhcmNoeSgpLGw9TWF0aC5yb3VuZCxjPVsxLDFdLHM9bnVsbCxmPU91LGg9ITEsZz0ic3F1YXJpZnkiLHA9LjUqKDErTWF0aC5zcXJ0KDUpKTtyZXR1cm4gaS5zaXplPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPW4saSk6Y30saS5wYWRkaW5nPWZ1bmN0aW9uKG4pe2Z1bmN0aW9uIHQodCl7dmFyIGU9bi5jYWxsKGksdCx0LmRlcHRoKTtyZXR1cm4gbnVsbD09ZT9PdSh0KTpJdSh0LCJudW1iZXIiPT10eXBlb2YgZT9bZSxlLGUsZV06ZSl9ZnVuY3Rpb24gZSh0KXtyZXR1cm4gSXUodCxuKX1pZighYXJndW1lbnRzLmxlbmd0aClyZXR1cm4gczt2YXIgcjtyZXR1cm4gZj1udWxsPT0ocz1uKT9PdToiZnVuY3Rpb24iPT0ocj10eXBlb2Ygbik/dDoibnVtYmVyIj09PXI/KG49W24sbixuLG5dLGUpOmUsaX0saS5yb3VuZD1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1uP01hdGgucm91bmQ6TnVtYmVyLGkpOmwhPU51bWJlcn0saS5zdGlja3k9ZnVuY3Rpb24obil7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGg9bixhPW51bGwsaSk6aH0saS5yYXRpbz1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocD1uLGkpOnB9LGkubW9kZT1mdW5jdGlvbihuKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZz1uKyIiLGkpOmd9LHV1KGksbyl9LG9hLnJhbmRvbT17bm9ybWFsOmZ1bmN0aW9uKG4sdCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtyZXR1cm4gMj5lJiYodD0xKSwxPmUmJihuPTApLGZ1bmN0aW9uKCl7dmFyIGUscix1O2RvIGU9MipNYXRoLnJhbmRvbSgpLTEscj0yKk1hdGgucmFuZG9tKCktMSx1PWUqZStyKnI7d2hpbGUoIXV8fHU+MSk7cmV0dXJuIG4rdCplKk1hdGguc3FydCgtMipNYXRoLmxvZyh1KS91KX19LGxvZ05vcm1hbDpmdW5jdGlvbigpe3ZhciBuPW9hLnJhbmRvbS5ub3JtYWwuYXBwbHkob2EsYXJndW1lbnRzKTtyZXR1cm4gZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5leHAobigpKX19LGJhdGVzOmZ1bmN0aW9uKG4pe3ZhciB0PW9hLnJhbmRvbS5pcndpbkhhbGwobik7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHQoKS9ufX0saXJ3aW5IYWxsOmZ1bmN0aW9uKG4pe3JldHVybiBmdW5jdGlvbigpe2Zvcih2YXIgdD0wLGU9MDtuPmU7ZSsrKXQrPU1hdGgucmFuZG9tKCk7cmV0dXJuIHR9fX0sb2Euc2NhbGU9e307dmFyIHdsPXtmbG9vcjp5LGNlaWw6eX07b2Euc2NhbGUubGluZWFyPWZ1bmN0aW9uKCl7cmV0dXJuIFd1KFswLDFdLFswLDFdLE1yLCExKX07dmFyIFNsPXtzOjEsZzoxLHA6MSxyOjEsZToxfTtvYS5zY2FsZS5sb2c9ZnVuY3Rpb24oKXtyZXR1cm4gcmkob2Euc2NhbGUubGluZWFyKCkuZG9tYWluKFswLDFdKSwxMCwhMCxbMSwxMF0pfTt2YXIga2w9b2EuZm9ybWF0KCIuMGUiKSxObD17Zmxvb3I6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguY2VpbCgtbil9LGNlaWw6ZnVuY3Rpb24obil7cmV0dXJuLU1hdGguZmxvb3IoLW4pfX07b2Euc2NhbGUucG93PWZ1bmN0aW9uKCl7cmV0dXJuIHVpKG9hLnNjYWxlLmxpbmVhcigpLDEsWzAsMV0pfSxvYS5zY2FsZS5zcXJ0PWZ1bmN0aW9uKCl7cmV0dXJuIG9hLnNjYWxlLnBvdygpLmV4cG9uZW50KC41KX0sb2Euc2NhbGUub3JkaW5hbD1mdW5jdGlvbigpe3JldHVybiBhaShbXSx7dDoicmFuZ2UiLGE6W1tdXX0pfSxvYS5zY2FsZS5jYXRlZ29yeTEwPWZ1bmN0aW9uKCl7cmV0dXJuIG9hLnNjYWxlLm9yZGluYWwoKS5yYW5nZShFbCl9LG9hLnNjYWxlLmNhdGVnb3J5MjA9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKEFsKX0sb2Euc2NhbGUuY2F0ZWdvcnkyMGI9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKENsKX0sb2Euc2NhbGUuY2F0ZWdvcnkyMGM9ZnVuY3Rpb24oKXtyZXR1cm4gb2Euc2NhbGUub3JkaW5hbCgpLnJhbmdlKHpsKX07dmFyIEVsPVsyMDYyMjYwLDE2NzQ0MjA2LDI5MjQ1ODgsMTQwMzQ3MjgsOTcyNTg4NSw5MTk3MTMxLDE0OTA3MzMwLDgzNTU3MTEsMTIzNjkxODYsMTU1NjE3NV0ubWFwKHhuKSxBbD1bMjA2MjI2MCwxMTQ1NDQ0MCwxNjc0NDIwNiwxNjc1OTY3MiwyOTI0NTg4LDEwMDE4Njk4LDE0MDM0NzI4LDE2NzUwNzQyLDk3MjU4ODUsMTI5NTU4NjEsOTE5NzEzMSwxMjg4NTE0MCwxNDkwNzMzMCwxNjIzNDE5NCw4MzU1NzExLDEzMDkyODA3LDEyMzY5MTg2LDE0NDA4NTg5LDE1NTYxNzUsMTA0MTA3MjVdLm1hcCh4biksQ2w9WzM3NTA3NzcsNTM5NTYxOSw3MDQwNzE5LDEwMjY0Mjg2LDY1MTkwOTcsOTIxNjU5NCwxMTkxNTExNSwxMzU1NjYzNiw5MjAyOTkzLDEyNDI2ODA5LDE1MTg2NTE0LDE1MTkwOTMyLDg2NjYxNjksMTEzNTY0OTAsMTQwNDk2NDMsMTUxNzczNzIsODA3NzY4MywxMDgzNDMyNCwxMzUyODUwOSwxNDU4OTY1NF0ubWFwKHhuKSx6bD1bMzI0NDczMyw3MDU3MTEwLDEwNDA2NjI1LDEzMDMyNDMxLDE1MDk1MDUzLDE2NjE2NzY0LDE2NjI1MjU5LDE2NjM0MDE4LDMyNTMwNzYsNzY1MjQ3MCwxMDYwNzAwMywxMzEwMTUwNCw3Njk1MjgxLDEwMzk0MzEyLDEyMzY5MzcyLDE0MzQyODkxLDY1MTM1MDcsOTg2ODk1MCwxMjQzNDg3NywxNDI3NzA4MV0ubWFwKHhuKTtvYS5zY2FsZS5xdWFudGlsZT1mdW5jdGlvbigpe3JldHVybiBvaShbXSxbXSl9LG9hLnNjYWxlLnF1YW50aXplPWZ1bmN0aW9uKCl7cmV0dXJuIGxpKDAsMSxbMCwxXSl9LG9hLnNjYWxlLnRocmVzaG9sZD1mdW5jdGlvbigpe3JldHVybiBjaShbLjVdLFswLDFdKX0sb2Euc2NhbGUuaWRlbnRpdHk9ZnVuY3Rpb24oKXtyZXR1cm4gc2koWzAsMV0pfSxvYS5zdmc9e30sb2Euc3ZnLmFyYz1mdW5jdGlvbigpe2Z1bmN0aW9uIG4oKXt2YXIgbj1NYXRoLm1heCgwLCtlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSksYz1NYXRoLm1heCgwLCtyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSkscz1hLmFwcGx5KHRoaXMsYXJndW1lbnRzKS1IYSxmPW8uYXBwbHkodGhpcyxhcmd1bWVudHMpLUhhLGg9TWF0aC5hYnMoZi1zKSxnPXM+Zj8wOjE7aWYobj5jJiYocD1jLGM9bixuPXApLGg+PUZhKXJldHVybiB0KGMsZykrKG4/dChuLDEtZyk6IiIpKyJaIjt2YXIgcCx2LGQsbSx5LE0seCxiLF8sdyxTLGssTj0wLEU9MCxBPVtdO2lmKChtPSgrbC5hcHBseSh0aGlzLGFyZ3VtZW50cyl8fDApLzIpJiYoZD1pPT09TGw/TWF0aC5zcXJ0KG4qbitjKmMpOitpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxnfHwoRSo9LTEpLGMmJihFPXRuKGQvYypNYXRoLnNpbihtKSkpLG4mJihOPXRuKGQvbipNYXRoLnNpbihtKSkpKSxjKXt5PWMqTWF0aC5jb3MocytFKSxNPWMqTWF0aC5zaW4ocytFKSx4PWMqTWF0aC5jb3MoZi1FKSxiPWMqTWF0aC5zaW4oZi1FKTt2YXIgQz1NYXRoLmFicyhmLXMtMipFKTw9VWE/MDoxO2lmKEUmJm1pKHksTSx4LGIpPT09Z15DKXt2YXIgej0ocytmKS8yO3k9YypNYXRoLmNvcyh6KSxNPWMqTWF0aC5zaW4oeikseD1iPW51bGx9fWVsc2UgeT1NPTA7aWYobil7Xz1uKk1hdGguY29zKGYtTiksdz1uKk1hdGguc2luKGYtTiksUz1uKk1hdGguY29zKHMrTiksaz1uKk1hdGguc2luKHMrTik7dmFyIEw9TWF0aC5hYnMocy1mKzIqTik8PVVhPzA6MTtpZihOJiZtaShfLHcsUyxrKT09PTEtZ15MKXt2YXIgcT0ocytmKS8yO189bipNYXRoLmNvcyhxKSx3PW4qTWF0aC5zaW4ocSksUz1rPW51bGx9fWVsc2UgXz13PTA7aWYoaD5EYSYmKHA9TWF0aC5taW4oTWF0aC5hYnMoYy1uKS8yLCt1LmFwcGx5KHRoaXMsYXJndW1lbnRzKSkpPi4wMDEpe3Y9Yz5uXmc/MDoxO3ZhciBUPXAsUj1wO2lmKFVhPmgpe3ZhciBEPW51bGw9PVM/W18sd106bnVsbD09eD9beSxNXTpSZShbeSxNXSxbUyxrXSxbeCxiXSxbXyx3XSksUD15LURbMF0sVT1NLURbMV0saj14LURbMF0sRj1iLURbMV0sSD0xL01hdGguc2luKE1hdGguYWNvcygoUCpqK1UqRikvKE1hdGguc3FydChQKlArVSpVKSpNYXRoLnNxcnQoaipqK0YqRikpKS8yKSxPPU1hdGguc3FydChEWzBdKkRbMF0rRFsxXSpEWzFdKTtSPU1hdGgubWluKHAsKG4tTykvKEgtMSkpLFQ9TWF0aC5taW4ocCwoYy1PKS8oSCsxKSl9aWYobnVsbCE9eCl7dmFyIEk9eWkobnVsbD09Uz9bXyx3XTpbUyxrXSxbeSxNXSxjLFQsZyksWT15aShbeCxiXSxbXyx3XSxjLFQsZyk7cD09PVQ/QS5wdXNoKCJNIixJWzBdLCJBIixULCIsIixULCIgMCAwLCIsdiwiICIsSVsxXSwiQSIsYywiLCIsYywiIDAgIiwxLWdebWkoSVsxXVswXSxJWzFdWzFdLFlbMV1bMF0sWVsxXVsxXSksIiwiLGcsIiAiLFlbMV0sIkEiLFQsIiwiLFQsIiAwIDAsIix2LCIgIixZWzBdKTpBLnB1c2goIk0iLElbMF0sIkEiLFQsIiwiLFQsIiAwIDEsIix2LCIgIixZWzBdKX1lbHNlIEEucHVzaCgiTSIseSwiLCIsTSk7aWYobnVsbCE9Uyl7dmFyIFo9eWkoW3ksTV0sW1Msa10sbiwtUixnKSxWPXlpKFtfLHddLG51bGw9PXg/W3ksTV06W3gsYl0sbiwtUixnKTtwPT09Uj9BLnB1c2goIkwiLFZbMF0sIkEiLFIsIiwiLFIsIiAwIDAsIix2LCIgIixWWzFdLCJBIixuLCIsIixuLCIgMCAiLGdebWkoVlsxXVswXSxWWzFdWzFdLFpbMV1bMF0sWlsxXVsxXSksIiwiLDEtZywiICIsWlsxXSwiQSIsUiwiLCIsUiwiIDAgMCwiLHYsIiAiLFpbMF0pOkEucHVzaCgiTCIsVlswXSwiQSIsUiwiLCIsUiwiIDAgMCwiLHYsIiAiLFpbMF0pfWVsc2UgQS5wdXNoKCJMIixfLCIsIix3KX1lbHNlIEEucHVzaCgiTSIseSwiLCIsTSksbnVsbCE9eCYmQS5wdXNoKCJBIixjLCIsIixjLCIgMCAiLEMsIiwiLGcsIiAiLHgsIiwiLGIpLEEucHVzaCgiTCIsXywiLCIsdyksbnVsbCE9UyYmQS5wdXNoKCJBIixuLCIsIixuLCIgMCAiLEwsIiwiLDEtZywiICIsUywiLCIsayk7cmV0dXJuIEEucHVzaCgiWiIpLEEuam9pbigiIil9ZnVuY3Rpb24gdChuLHQpe3JldHVybiJNMCwiK24rIkEiK24rIiwiK24rIiAwIDEsIit0KyIgMCwiKy1uKyJBIituKyIsIituKyIgMCAxLCIrdCsiIDAsIitufXZhciBlPWhpLHI9Z2ksdT1maSxpPUxsLGE9cGksbz12aSxsPWRpO3JldHVybiBuLmlubmVyUmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPUVuKHQpLG4pOmV9LG4ub3V0ZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9RW4odCksbik6cn0sbi5jb3JuZXJSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9RW4odCksbik6dX0sbi5wYWRSYWRpdXM9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGk9dD09TGw/TGw6RW4odCksbik6aX0sbi5zdGFydEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUVuKHQpLG4pOmF9LG4uZW5kQW5nbGU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KG89RW4odCksbik6b30sbi5wYWRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1Fbih0KSxuKTpsfSxuLmNlbnRyb2lkPWZ1bmN0aW9uKCl7dmFyIG49KCtlLmFwcGx5KHRoaXMsYXJndW1lbnRzKSsgK3IuYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLHQ9KCthLmFwcGx5KHRoaXMsYXJndW1lbnRzKSsgK28uYXBwbHkodGhpcyxhcmd1bWVudHMpKS8yLUhhO3JldHVybltNYXRoLmNvcyh0KSpuLE1hdGguc2luKHQpKm5dfSxufTt2YXIgTGw9ImF1dG8iO29hLnN2Zy5saW5lPWZ1bmN0aW9uKCl7cmV0dXJuIE1pKHkpfTt2YXIgcWw9b2EubWFwKHtsaW5lYXI6eGksImxpbmVhci1jbG9zZWQiOmJpLHN0ZXA6X2ksInN0ZXAtYmVmb3JlIjp3aSwic3RlcC1hZnRlciI6U2ksYmFzaXM6emksImJhc2lzLW9wZW4iOkxpLCJiYXNpcy1jbG9zZWQiOnFpLGJ1bmRsZTpUaSxjYXJkaW5hbDpFaSwiY2FyZGluYWwtb3BlbiI6a2ksImNhcmRpbmFsLWNsb3NlZCI6TmksbW9ub3RvbmU6Rml9KTtxbC5mb3JFYWNoKGZ1bmN0aW9uKG4sdCl7dC5rZXk9bix0LmNsb3NlZD0vLWNsb3NlZCQvLnRlc3Qobil9KTt2YXIgVGw9WzAsMi8zLDEvMywwXSxSbD1bMCwxLzMsMi8zLDBdLERsPVswLDEvNiwyLzMsMS82XTtvYS5zdmcubGluZS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1NaShIaSk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uYW5nbGU9bi55LGRlbGV0ZSBuLnksbn0sd2kucmV2ZXJzZT1TaSxTaS5yZXZlcnNlPXdpLG9hLnN2Zy5hcmVhPWZ1bmN0aW9uKCl7cmV0dXJuIE9pKHkpfSxvYS5zdmcuYXJlYS5yYWRpYWw9ZnVuY3Rpb24oKXt2YXIgbj1PaShIaSk7cmV0dXJuIG4ucmFkaXVzPW4ueCxkZWxldGUgbi54LG4uaW5uZXJSYWRpdXM9bi54MCxkZWxldGUgbi54MCxuLm91dGVyUmFkaXVzPW4ueDEsZGVsZXRlIG4ueDEsbi5hbmdsZT1uLnksZGVsZXRlIG4ueSxuLnN0YXJ0QW5nbGU9bi55MCxkZWxldGUgbi55MCxuLmVuZEFuZ2xlPW4ueTEsZGVsZXRlIG4ueTEsbn0sb2Euc3ZnLmNob3JkPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gbihuLG8pe3ZhciBsPXQodGhpcyxpLG4sbyksYz10KHRoaXMsYSxuLG8pO3JldHVybiJNIitsLnAwK3IobC5yLGwucDEsbC5hMS1sLmEwKSsoZShsLGMpP3UobC5yLGwucDEsbC5yLGwucDApOnUobC5yLGwucDEsYy5yLGMucDApK3IoYy5yLGMucDEsYy5hMS1jLmEwKSt1KGMucixjLnAxLGwucixsLnAwKSkrIloifWZ1bmN0aW9uIHQobix0LGUscil7dmFyIHU9dC5jYWxsKG4sZSxyKSxpPW8uY2FsbChuLHUsciksYT1sLmNhbGwobix1LHIpLUhhLHM9Yy5jYWxsKG4sdSxyKS1IYTtyZXR1cm57cjppLGEwOmEsYTE6cyxwMDpbaSpNYXRoLmNvcyhhKSxpKk1hdGguc2luKGEpXSxwMTpbaSpNYXRoLmNvcyhzKSxpKk1hdGguc2luKHMpXX19ZnVuY3Rpb24gZShuLHQpe3JldHVybiBuLmEwPT10LmEwJiZuLmExPT10LmExfWZ1bmN0aW9uIHIobix0LGUpe3JldHVybiJBIituKyIsIituKyIgMCAiKyArKGU+VWEpKyIsMSAiK3R9ZnVuY3Rpb24gdShuLHQsZSxyKXtyZXR1cm4iUSAwLDAgIityfXZhciBpPU1lLGE9eGUsbz1JaSxsPXBpLGM9dmk7cmV0dXJuIG4ucmFkaXVzPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhvPUVuKHQpLG4pOm99LG4uc291cmNlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPUVuKHQpLG4pOml9LG4udGFyZ2V0PWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhhPUVuKHQpLG4pOmF9LG4uc3RhcnRBbmdsZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD1Fbih0KSxuKTpsfSxuLmVuZEFuZ2xlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhjPUVuKHQpLG4pOmN9LG59LG9hLnN2Zy5kaWFnb25hbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obix1KXt2YXIgaT10LmNhbGwodGhpcyxuLHUpLGE9ZS5jYWxsKHRoaXMsbix1KSxvPShpLnkrYS55KS8yLGw9W2kse3g6aS54LHk6b30se3g6YS54LHk6b30sYV07cmV0dXJuIGw9bC5tYXAociksIk0iK2xbMF0rIkMiK2xbMV0rIiAiK2xbMl0rIiAiK2xbM119dmFyIHQ9TWUsZT14ZSxyPVlpO3JldHVybiBuLnNvdXJjZT1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1FbihlKSxuKTp0fSxuLnRhcmdldD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1Fbih0KSxuKTplfSxuLnByb2plY3Rpb249ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCxuKTpyfSxufSxvYS5zdmcuZGlhZ29uYWwucmFkaWFsPWZ1bmN0aW9uKCl7dmFyIG49b2Euc3ZnLmRpYWdvbmFsKCksdD1ZaSxlPW4ucHJvamVjdGlvbjtyZXR1cm4gbi5wcm9qZWN0aW9uPWZ1bmN0aW9uKG4pe3JldHVybiBhcmd1bWVudHMubGVuZ3RoP2UoWmkodD1uKSk6dH0sbn0sb2Euc3ZnLnN5bWJvbD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4obixyKXtyZXR1cm4oUGwuZ2V0KHQuY2FsbCh0aGlzLG4scikpfHwkaSkoZS5jYWxsKHRoaXMsbixyKSl9dmFyIHQ9WGksZT1WaTtyZXR1cm4gbi50eXBlPWZ1bmN0aW9uKGUpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyh0PUVuKGUpLG4pOnR9LG4uc2l6ZT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oZT1Fbih0KSxuKTplfSxufTt2YXIgUGw9b2EubWFwKHtjaXJjbGU6JGksY3Jvc3M6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4vNSkvMjtyZXR1cm4iTSIrLTMqdCsiLCIrLXQrIkgiKy10KyJWIistMyp0KyJIIit0KyJWIistdCsiSCIrMyp0KyJWIit0KyJIIit0KyJWIiszKnQrIkgiKy10KyJWIit0KyJIIistMyp0KyJaIn0sZGlhbW9uZDpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi8oMipqbCkpLGU9dCpqbDtyZXR1cm4iTTAsIistdCsiTCIrZSsiLDAgMCwiK3QrIiAiKy1lKyIsMFoifSxzcXVhcmU6ZnVuY3Rpb24obil7dmFyIHQ9TWF0aC5zcXJ0KG4pLzI7cmV0dXJuIk0iKy10KyIsIistdCsiTCIrdCsiLCIrLXQrIiAiK3QrIiwiK3QrIiAiKy10KyIsIit0KyJaIn0sInRyaWFuZ2xlLWRvd24iOmZ1bmN0aW9uKG4pe3ZhciB0PU1hdGguc3FydChuL1VsKSxlPXQqVWwvMjtyZXR1cm4iTTAsIitlKyJMIit0KyIsIistZSsiICIrLXQrIiwiKy1lKyJaIn0sInRyaWFuZ2xlLXVwIjpmdW5jdGlvbihuKXt2YXIgdD1NYXRoLnNxcnQobi9VbCksZT10KlVsLzI7cmV0dXJuIk0wLCIrLWUrIkwiK3QrIiwiK2UrIiAiKy10KyIsIitlKyJaIn19KTtvYS5zdmcuc3ltYm9sVHlwZXM9UGwua2V5cygpO3ZhciBVbD1NYXRoLnNxcnQoMyksamw9TWF0aC50YW4oMzAqT2EpO0FhLnRyYW5zaXRpb249ZnVuY3Rpb24obil7Zm9yKHZhciB0LGUscj1GbHx8KytZbCx1PUtpKG4pLGk9W10sYT1IbHx8e3RpbWU6RGF0ZS5ub3coKSxlYXNlOk5yLGRlbGF5OjAsZHVyYXRpb246MjUwfSxvPS0xLGw9dGhpcy5sZW5ndGg7KytvPGw7KXtpLnB1c2godD1bXSk7Zm9yKHZhciBjPXRoaXNbb10scz0tMSxmPWMubGVuZ3RoOysrczxmOykoZT1jW3NdKSYmUWkoZSxzLHUscixhKSx0LnB1c2goZSl9cmV0dXJuIFdpKGksdSxyKX0sQWEuaW50ZXJydXB0PWZ1bmN0aW9uKG4pe3JldHVybiB0aGlzLmVhY2gobnVsbD09bj9PbDpCaShLaShuKSkpfTt2YXIgRmwsSGwsT2w9QmkoS2koKSksSWw9W10sWWw9MDtJbC5jYWxsPUFhLmNhbGwsSWwuZW1wdHk9QWEuZW1wdHksSWwubm9kZT1BYS5ub2RlLElsLnNpemU9QWEuc2l6ZSxvYS50cmFuc2l0aW9uPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIG4mJm4udHJhbnNpdGlvbj9GbD9uLnRyYW5zaXRpb24odCk6bjpvYS5zZWxlY3Rpb24oKS50cmFuc2l0aW9uKG4pfSxvYS50cmFuc2l0aW9uLnByb3RvdHlwZT1JbCxJbC5zZWxlY3Q9ZnVuY3Rpb24obil7dmFyIHQsZSxyLHU9dGhpcy5pZCxpPXRoaXMubmFtZXNwYWNlLGE9W107bj1BKG4pO2Zvcih2YXIgbz0tMSxsPXRoaXMubGVuZ3RoOysrbzxsOyl7YS5wdXNoKHQ9W10pO2Zvcih2YXIgYz10aGlzW29dLHM9LTEsZj1jLmxlbmd0aDsrK3M8ZjspKHI9Y1tzXSkmJihlPW4uY2FsbChyLHIuX19kYXRhX18scyxvKSk/KCJfX2RhdGFfXyJpbiByJiYoZS5fX2RhdGFfXz1yLl9fZGF0YV9fKSxRaShlLHMsaSx1LHJbaV1bdV0pLHQucHVzaChlKSk6dC5wdXNoKG51bGwpfXJldHVybiBXaShhLGksdSl9LElsLnNlbGVjdEFsbD1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdSxpLGE9dGhpcy5pZCxvPXRoaXMubmFtZXNwYWNlLGw9W107bj1DKG4pO2Zvcih2YXIgYz0tMSxzPXRoaXMubGVuZ3RoOysrYzxzOylmb3IodmFyIGY9dGhpc1tjXSxoPS0xLGc9Zi5sZW5ndGg7KytoPGc7KWlmKHI9ZltoXSl7aT1yW29dW2FdLGU9bi5jYWxsKHIsci5fX2RhdGFfXyxoLGMpLGwucHVzaCh0PVtdKTtmb3IodmFyIHA9LTEsdj1lLmxlbmd0aDsrK3A8djspKHU9ZVtwXSkmJlFpKHUscCxvLGEsaSksdC5wdXNoKHUpfXJldHVybiBXaShsLG8sYSl9LElsLmZpbHRlcj1mdW5jdGlvbihuKXt2YXIgdCxlLHIsdT1bXTsiZnVuY3Rpb24iIT10eXBlb2YgbiYmKG49TyhuKSk7Zm9yKHZhciBpPTAsYT10aGlzLmxlbmd0aDthPmk7aSsrKXt1LnB1c2godD1bXSk7Zm9yKHZhciBlPXRoaXNbaV0sbz0wLGw9ZS5sZW5ndGg7bD5vO28rKykocj1lW29dKSYmbi5jYWxsKHIsci5fX2RhdGFfXyxvLGkpJiZ0LnB1c2gocil9cmV0dXJuIFdpKHUsdGhpcy5uYW1lc3BhY2UsdGhpcy5pZCl9LElsLnR3ZWVuPWZ1bmN0aW9uKG4sdCl7dmFyIGU9dGhpcy5pZCxyPXRoaXMubmFtZXNwYWNlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDI/dGhpcy5ub2RlKClbcl1bZV0udHdlZW4uZ2V0KG4pOlkodGhpcyxudWxsPT10P2Z1bmN0aW9uKHQpe3Rbcl1bZV0udHdlZW4ucmVtb3ZlKG4pfTpmdW5jdGlvbih1KXt1W3JdW2VdLnR3ZWVuLnNldChuLHQpfSl9LElsLmF0dHI9ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKCl7dGhpcy5yZW1vdmVBdHRyaWJ1dGUobyl9ZnVuY3Rpb24gcigpe3RoaXMucmVtb3ZlQXR0cmlidXRlTlMoby5zcGFjZSxvLmxvY2FsKX1mdW5jdGlvbiB1KG4pe3JldHVybiBudWxsPT1uP2U6KG4rPSIiLGZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmdldEF0dHJpYnV0ZShvKTtyZXR1cm4gZSE9PW4mJih0PWEoZSxuKSxmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZShvLHQobikpfSl9KX1mdW5jdGlvbiBpKG4pe3JldHVybiBudWxsPT1uP3I6KG4rPSIiLGZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmdldEF0dHJpYnV0ZU5TKG8uc3BhY2Usby5sb2NhbCk7cmV0dXJuIGUhPT1uJiYodD1hKGUsbiksZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGVOUyhvLnNwYWNlLG8ubG9jYWwsdChuKSl9KX0pfWlmKGFyZ3VtZW50cy5sZW5ndGg8Mil7Zm9yKHQgaW4gbil0aGlzLmF0dHIodCxuW3RdKTtyZXR1cm4gdGhpc312YXIgYT0idHJhbnNmb3JtIj09bj8kcjpNcixvPW9hLm5zLnF1YWxpZnkobik7cmV0dXJuIEppKHRoaXMsImF0dHIuIituLHQsby5sb2NhbD9pOnUpfSxJbC5hdHRyVHdlZW49ZnVuY3Rpb24obix0KXtmdW5jdGlvbiBlKG4sZSl7dmFyIHI9dC5jYWxsKHRoaXMsbixlLHRoaXMuZ2V0QXR0cmlidXRlKHUpKTtyZXR1cm4gciYmZnVuY3Rpb24obil7dGhpcy5zZXRBdHRyaWJ1dGUodSxyKG4pKX19ZnVuY3Rpb24gcihuLGUpe3ZhciByPXQuY2FsbCh0aGlzLG4sZSx0aGlzLmdldEF0dHJpYnV0ZU5TKHUuc3BhY2UsdS5sb2NhbCkpO3JldHVybiByJiZmdW5jdGlvbihuKXt0aGlzLnNldEF0dHJpYnV0ZU5TKHUuc3BhY2UsdS5sb2NhbCxyKG4pKX19dmFyIHU9b2EubnMucXVhbGlmeShuKTtyZXR1cm4gdGhpcy50d2VlbigiYXR0ci4iK24sdS5sb2NhbD9yOmUpfSxJbC5zdHlsZT1mdW5jdGlvbihuLGUscil7ZnVuY3Rpb24gdSgpe3RoaXMuc3R5bGUucmVtb3ZlUHJvcGVydHkobil9ZnVuY3Rpb24gaShlKXtyZXR1cm4gbnVsbD09ZT91OihlKz0iIixmdW5jdGlvbigpe3ZhciB1LGk9dCh0aGlzKS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKTtyZXR1cm4gaSE9PWUmJih1PU1yKGksZSksZnVuY3Rpb24odCl7dGhpcy5zdHlsZS5zZXRQcm9wZXJ0eShuLHUodCkscil9KX0pfXZhciBhPWFyZ3VtZW50cy5sZW5ndGg7aWYoMz5hKXtpZigic3RyaW5nIiE9dHlwZW9mIG4pezI+YSYmKGU9IiIpO2ZvcihyIGluIG4pdGhpcy5zdHlsZShyLG5bcl0sZSk7cmV0dXJuIHRoaXN9cj0iIn1yZXR1cm4gSmkodGhpcywic3R5bGUuIituLGUsaSl9LElsLnN0eWxlVHdlZW49ZnVuY3Rpb24obixlLHIpe2Z1bmN0aW9uIHUodSxpKXt2YXIgYT1lLmNhbGwodGhpcyx1LGksdCh0aGlzKS5nZXRDb21wdXRlZFN0eWxlKHRoaXMsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShuKSk7cmV0dXJuIGEmJmZ1bmN0aW9uKHQpe3RoaXMuc3R5bGUuc2V0UHJvcGVydHkobixhKHQpLHIpfX1yZXR1cm4gYXJndW1lbnRzLmxlbmd0aDwzJiYocj0iIiksdGhpcy50d2Vlbigic3R5bGUuIituLHUpfSxJbC50ZXh0PWZ1bmN0aW9uKG4pe3JldHVybiBKaSh0aGlzLCJ0ZXh0IixuLEdpKX0sSWwucmVtb3ZlPWZ1bmN0aW9uKCl7dmFyIG49dGhpcy5uYW1lc3BhY2U7cmV0dXJuIHRoaXMuZWFjaCgiZW5kLnRyYW5zaXRpb24iLGZ1bmN0aW9uKCl7dmFyIHQ7dGhpc1tuXS5jb3VudDwyJiYodD10aGlzLnBhcmVudE5vZGUpJiZ0LnJlbW92ZUNoaWxkKHRoaXMpfSl9LElsLmVhc2U9ZnVuY3Rpb24obil7dmFyIHQ9dGhpcy5pZCxlPXRoaXMubmFtZXNwYWNlO3JldHVybiBhcmd1bWVudHMubGVuZ3RoPDE/dGhpcy5ub2RlKClbZV1bdF0uZWFzZTooImZ1bmN0aW9uIiE9dHlwZW9mIG4mJihuPW9hLmVhc2UuYXBwbHkob2EsYXJndW1lbnRzKSksWSh0aGlzLGZ1bmN0aW9uKHIpe3JbZV1bdF0uZWFzZT1ufSkpfSxJbC5kZWxheT1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkLGU9dGhpcy5uYW1lc3BhY2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKVtlXVt0XS5kZWxheTpZKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocix1LGkpe3JbZV1bdF0uZGVsYXk9K24uY2FsbChyLHIuX19kYXRhX18sdSxpKX06KG49K24sZnVuY3Rpb24ocil7cltlXVt0XS5kZWxheT1ufSkpfSxJbC5kdXJhdGlvbj1mdW5jdGlvbihuKXt2YXIgdD10aGlzLmlkLGU9dGhpcy5uYW1lc3BhY2U7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg8MT90aGlzLm5vZGUoKVtlXVt0XS5kdXJhdGlvbjpZKHRoaXMsImZ1bmN0aW9uIj09dHlwZW9mIG4/ZnVuY3Rpb24ocix1LGkpe3JbZV1bdF0uZHVyYXRpb249TWF0aC5tYXgoMSxuLmNhbGwocixyLl9fZGF0YV9fLHUsaSkpfToobj1NYXRoLm1heCgxLG4pLGZ1bmN0aW9uKHIpe3JbZV1bdF0uZHVyYXRpb249bn0pKX0sSWwuZWFjaD1mdW5jdGlvbihuLHQpe3ZhciBlPXRoaXMuaWQscj10aGlzLm5hbWVzcGFjZTtpZihhcmd1bWVudHMubGVuZ3RoPDIpe3ZhciB1PUhsLGk9Rmw7dHJ5e0ZsPWUsWSh0aGlzLGZ1bmN0aW9uKHQsdSxpKXtIbD10W3JdW2VdLG4uY2FsbCh0LHQuX19kYXRhX18sdSxpKX0pfWZpbmFsbHl7SGw9dSxGbD1pfX1lbHNlIFkodGhpcyxmdW5jdGlvbih1KXt2YXIgaT11W3JdW2VdOyhpLmV2ZW50fHwoaS5ldmVudD1vYS5kaXNwYXRjaCgic3RhcnQiLCJlbmQiLCJpbnRlcnJ1cHQiKSkpLm9uKG4sdCl9KTtyZXR1cm4gdGhpc30sSWwudHJhbnNpdGlvbj1mdW5jdGlvbigpe2Zvcih2YXIgbix0LGUscix1PXRoaXMuaWQsaT0rK1lsLGE9dGhpcy5uYW1lc3BhY2Usbz1bXSxsPTAsYz10aGlzLmxlbmd0aDtjPmw7bCsrKXtvLnB1c2gobj1bXSk7Zm9yKHZhciB0PXRoaXNbbF0scz0wLGY9dC5sZW5ndGg7Zj5zO3MrKykoZT10W3NdKSYmKHI9ZVthXVt1XSxRaShlLHMsYSxpLHt0aW1lOnIudGltZSxlYXNlOnIuZWFzZSxkZWxheTpyLmRlbGF5K3IuZHVyYXRpb24sZHVyYXRpb246ci5kdXJhdGlvbn0pKSxuLnB1c2goZSl9cmV0dXJuIFdpKG8sYSxpKX0sb2Euc3ZnLmF4aXM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBuKG4pe24uZWFjaChmdW5jdGlvbigpe3ZhciBuLGM9b2Euc2VsZWN0KHRoaXMpLHM9dGhpcy5fX2NoYXJ0X198fGUsZj10aGlzLl9fY2hhcnRfXz1lLmNvcHkoKSxoPW51bGw9PWw/Zi50aWNrcz9mLnRpY2tzLmFwcGx5KGYsbyk6Zi5kb21haW4oKTpsLGc9bnVsbD09dD9mLnRpY2tGb3JtYXQ/Zi50aWNrRm9ybWF0LmFwcGx5KGYsbyk6eTp0LHA9Yy5zZWxlY3RBbGwoIi50aWNrIikuZGF0YShoLGYpLHY9cC5lbnRlcigpLmluc2VydCgiZyIsIi5kb21haW4iKS5hdHRyKCJjbGFzcyIsInRpY2siKS5zdHlsZSgib3BhY2l0eSIsRGEpLGQ9b2EudHJhbnNpdGlvbihwLmV4aXQoKSkuc3R5bGUoIm9wYWNpdHkiLERhKS5yZW1vdmUoKSxtPW9hLnRyYW5zaXRpb24ocC5vcmRlcigpKS5zdHlsZSgib3BhY2l0eSIsMSksTT1NYXRoLm1heCh1LDApK2EseD1adShmKSxiPWMuc2VsZWN0QWxsKCIuZG9tYWluIikuZGF0YShbMF0pLF89KGIuZW50ZXIoKS5hcHBlbmQoInBhdGgiKS5hdHRyKCJjbGFzcyIsImRvbWFpbiIpLG9hLnRyYW5zaXRpb24oYikpO3YuYXBwZW5kKCJsaW5lIiksdi5hcHBlbmQoInRleHQiKTt2YXIgdyxTLGssTixFPXYuc2VsZWN0KCJsaW5lIiksQT1tLnNlbGVjdCgibGluZSIpLEM9cC5zZWxlY3QoInRleHQiKS50ZXh0KGcpLHo9di5zZWxlY3QoInRleHQiKSxMPW0uc2VsZWN0KCJ0ZXh0IikscT0idG9wIj09PXJ8fCJsZWZ0Ij09PXI/LTE6MTtpZigiYm90dG9tIj09PXJ8fCJ0b3AiPT09cj8obj1uYSx3PSJ4IixrPSJ5IixTPSJ4MiIsTj0ieTIiLEMuYXR0cigiZHkiLDA+cT8iMGVtIjoiLjcxZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLCJtaWRkbGUiKSxfLmF0dHIoImQiLCJNIit4WzBdKyIsIitxKmkrIlYwSCIreFsxXSsiViIrcSppKSk6KG49dGEsdz0ieSIsaz0ieCIsUz0ieTIiLE49IngyIixDLmF0dHIoImR5IiwiLjMyZW0iKS5zdHlsZSgidGV4dC1hbmNob3IiLDA+cT8iZW5kIjoic3RhcnQiKSxfLmF0dHIoImQiLCJNIitxKmkrIiwiK3hbMF0rIkgwViIreFsxXSsiSCIrcSppKSksRS5hdHRyKE4scSp1KSx6LmF0dHIoayxxKk0pLEEuYXR0cihTLDApLmF0dHIoTixxKnUpLEwuYXR0cih3LDApLmF0dHIoayxxKk0pLGYucmFuZ2VCYW5kKXt2YXIgVD1mLFI9VC5yYW5nZUJhbmQoKS8yO3M9Zj1mdW5jdGlvbihuKXtyZXR1cm4gVChuKStSfX1lbHNlIHMucmFuZ2VCYW5kP3M9ZjpkLmNhbGwobixmLHMpO3YuY2FsbChuLHMsZiksbS5jYWxsKG4sZixmKX0pfXZhciB0LGU9b2Euc2NhbGUubGluZWFyKCkscj1abCx1PTYsaT02LGE9MyxvPVsxMF0sbD1udWxsO3JldHVybiBuLnNjYWxlPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhlPXQsbik6ZX0sbi5vcmllbnQ9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHI9dCBpbiBWbD90KyIiOlpsLG4pOnJ9LG4udGlja3M9ZnVuY3Rpb24oKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obz1jYShhcmd1bWVudHMpLG4pOm99LG4udGlja1ZhbHVlcz1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8obD10LG4pOmx9LG4udGlja0Zvcm1hdD1mdW5jdGlvbihlKXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8odD1lLG4pOnR9LG4udGlja1NpemU9ZnVuY3Rpb24odCl7dmFyIGU9YXJndW1lbnRzLmxlbmd0aDtyZXR1cm4gZT8odT0rdCxpPSthcmd1bWVudHNbZS0xXSxuKTp1fSxuLmlubmVyVGlja1NpemU9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KHU9K3Qsbik6dX0sbi5vdXRlclRpY2tTaXplPWZ1bmN0aW9uKHQpe3JldHVybiBhcmd1bWVudHMubGVuZ3RoPyhpPSt0LG4pOml9LG4udGlja1BhZGRpbmc9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGE9K3Qsbik6YX0sbi50aWNrU3ViZGl2aWRlPWZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGgmJm59LG59O3ZhciBabD0iYm90dG9tIixWbD17dG9wOjEscmlnaHQ6MSxib3R0b206MSxsZWZ0OjF9O29hLnN2Zy5icnVzaD1mdW5jdGlvbigpe2Z1bmN0aW9uIG4odCl7dC5lYWNoKGZ1bmN0aW9uKCl7dmFyIHQ9b2Euc2VsZWN0KHRoaXMpLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnN0eWxlKCItd2Via2l0LXRhcC1oaWdobGlnaHQtY29sb3IiLCJyZ2JhKDAsMCwwLDApIikub24oIm1vdXNlZG93bi5icnVzaCIsaSkub24oInRvdWNoc3RhcnQuYnJ1c2giLGkpLGE9dC5zZWxlY3RBbGwoIi5iYWNrZ3JvdW5kIikuZGF0YShbMF0pO2EuZW50ZXIoKS5hcHBlbmQoInJlY3QiKS5hdHRyKCJjbGFzcyIsImJhY2tncm91bmQiKS5zdHlsZSgidmlzaWJpbGl0eSIsImhpZGRlbiIpLnN0eWxlKCJjdXJzb3IiLCJjcm9zc2hhaXIiKSx0LnNlbGVjdEFsbCgiLmV4dGVudCIpLmRhdGEoWzBdKS5lbnRlcigpLmFwcGVuZCgicmVjdCIpLmF0dHIoImNsYXNzIiwiZXh0ZW50Iikuc3R5bGUoImN1cnNvciIsIm1vdmUiKTt2YXIgbz10LnNlbGVjdEFsbCgiLnJlc2l6ZSIpLmRhdGEodix5KTtvLmV4aXQoKS5yZW1vdmUoKSxvLmVudGVyKCkuYXBwZW5kKCJnIikuYXR0cigiY2xhc3MiLGZ1bmN0aW9uKG4pe3JldHVybiJyZXNpemUgIitufSkuc3R5bGUoImN1cnNvciIsZnVuY3Rpb24obil7cmV0dXJuIFhsW25dfSkuYXBwZW5kKCJyZWN0IikuYXR0cigieCIsZnVuY3Rpb24obil7cmV0dXJuL1tld10kLy50ZXN0KG4pPy0zOm51bGx9KS5hdHRyKCJ5IixmdW5jdGlvbihuKXtyZXR1cm4vXltuc10vLnRlc3Qobik/LTM6bnVsbH0pLmF0dHIoIndpZHRoIiw2KS5hdHRyKCJoZWlnaHQiLDYpLnN0eWxlKCJ2aXNpYmlsaXR5IiwiaGlkZGVuIiksby5zdHlsZSgiZGlzcGxheSIsbi5lbXB0eSgpPyJub25lIjpudWxsKTt2YXIgbCxmPW9hLnRyYW5zaXRpb24odCksaD1vYS50cmFuc2l0aW9uKGEpO2MmJihsPVp1KGMpLGguYXR0cigieCIsbFswXSkuYXR0cigid2lkdGgiLGxbMV0tbFswXSkscihmKSkscyYmKGw9WnUocyksaC5hdHRyKCJ5IixsWzBdKS5hdHRyKCJoZWlnaHQiLGxbMV0tbFswXSksdShmKSksZShmKX0pfWZ1bmN0aW9uIGUobil7bi5zZWxlY3RBbGwoIi5yZXNpemUiKS5hdHRyKCJ0cmFuc2Zvcm0iLGZ1bmN0aW9uKG4pe3JldHVybiJ0cmFuc2xhdGUoIitmWysvZSQvLnRlc3QobildKyIsIitoWysvXnMvLnRlc3QobildKyIpIn0pfWZ1bmN0aW9uIHIobil7bi5zZWxlY3QoIi5leHRlbnQiKS5hdHRyKCJ4IixmWzBdKSxuLnNlbGVjdEFsbCgiLmV4dGVudCwubj5yZWN0LC5zPnJlY3QiKS5hdHRyKCJ3aWR0aCIsZlsxXS1mWzBdKX1mdW5jdGlvbiB1KG4pe24uc2VsZWN0KCIuZXh0ZW50IikuYXR0cigieSIsaFswXSksbi5zZWxlY3RBbGwoIi5leHRlbnQsLmU+cmVjdCwudz5yZWN0IikuYXR0cigiaGVpZ2h0IixoWzFdLWhbMF0pfWZ1bmN0aW9uIGkoKXtmdW5jdGlvbiBpKCl7MzI9PW9hLmV2ZW50LmtleUNvZGUmJihDfHwoTT1udWxsLExbMF0tPWZbMV0sTFsxXS09aFsxXSxDPTIpLFMoKSl9ZnVuY3Rpb24gdigpezMyPT1vYS5ldmVudC5rZXlDb2RlJiYyPT1DJiYoTFswXSs9ZlsxXSxMWzFdKz1oWzFdLEM9MCxTKCkpfWZ1bmN0aW9uIGQoKXt2YXIgbj1vYS5tb3VzZShiKSx0PSExO3gmJihuWzBdKz14WzBdLG5bMV0rPXhbMV0pLEN8fChvYS5ldmVudC5hbHRLZXk/KE18fChNPVsoZlswXStmWzFdKS8yLChoWzBdK2hbMV0pLzJdKSxMWzBdPWZbKyhuWzBdPE1bMF0pXSxMWzFdPWhbKyhuWzFdPE1bMV0pXSk6TT1udWxsKSxFJiZtKG4sYywwKSYmKHIoayksdD0hMCksQSYmbShuLHMsMSkmJih1KGspLHQ9ITApLHQmJihlKGspLHcoe3R5cGU6ImJydXNoIixtb2RlOkM/Im1vdmUiOiJyZXNpemUifSkpfWZ1bmN0aW9uIG0obix0LGUpe3ZhciByLHUsaT1adSh0KSxsPWlbMF0sYz1pWzFdLHM9TFtlXSx2PWU/aDpmLGQ9dlsxXS12WzBdO3JldHVybiBDJiYobC09cyxjLT1kK3MpLHI9KGU/cDpnKT9NYXRoLm1heChsLE1hdGgubWluKGMsbltlXSkpOm5bZV0sQz91PShyKz1zKStkOihNJiYocz1NYXRoLm1heChsLE1hdGgubWluKGMsMipNW2VdLXIpKSkscj5zPyh1PXIscj1zKTp1PXMpLHZbMF0hPXJ8fHZbMV0hPXU/KGU/bz1udWxsOmE9bnVsbCx2WzBdPXIsdlsxXT11LCEwKTp2b2lkIDB9ZnVuY3Rpb24geSgpe2QoKSxrLnN0eWxlKCJwb2ludGVyLWV2ZW50cyIsImFsbCIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixuLmVtcHR5KCk/Im5vbmUiOm51bGwpLG9hLnNlbGVjdCgiYm9keSIpLnN0eWxlKCJjdXJzb3IiLG51bGwpLHEub24oIm1vdXNlbW92ZS5icnVzaCIsbnVsbCkub24oIm1vdXNldXAuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaG1vdmUuYnJ1c2giLG51bGwpLm9uKCJ0b3VjaGVuZC5icnVzaCIsbnVsbCkub24oImtleWRvd24uYnJ1c2giLG51bGwpLm9uKCJrZXl1cC5icnVzaCIsbnVsbCkseigpLHcoe3R5cGU6ImJydXNoZW5kIn0pfXZhciBNLHgsYj10aGlzLF89b2Euc2VsZWN0KG9hLmV2ZW50LnRhcmdldCksdz1sLm9mKGIsYXJndW1lbnRzKSxrPW9hLnNlbGVjdChiKSxOPV8uZGF0dW0oKSxFPSEvXihufHMpJC8udGVzdChOKSYmYyxBPSEvXihlfHcpJC8udGVzdChOKSYmcyxDPV8uY2xhc3NlZCgiZXh0ZW50Iiksej1XKGIpLEw9b2EubW91c2UoYikscT1vYS5zZWxlY3QodChiKSkub24oImtleWRvd24uYnJ1c2giLGkpLm9uKCJrZXl1cC5icnVzaCIsdik7aWYob2EuZXZlbnQuY2hhbmdlZFRvdWNoZXM/cS5vbigidG91Y2htb3ZlLmJydXNoIixkKS5vbigidG91Y2hlbmQuYnJ1c2giLHkpOnEub24oIm1vdXNlbW92ZS5icnVzaCIsZCkub24oIm1vdXNldXAuYnJ1c2giLHkpLGsuaW50ZXJydXB0KCkuc2VsZWN0QWxsKCIqIikuaW50ZXJydXB0KCksQylMWzBdPWZbMF0tTFswXSxMWzFdPWhbMF0tTFsxXTtlbHNlIGlmKE4pe3ZhciBUPSsvdyQvLnRlc3QoTiksUj0rL15uLy50ZXN0KE4pO3g9W2ZbMS1UXS1MWzBdLGhbMS1SXS1MWzFdXSxMWzBdPWZbVF0sTFsxXT1oW1JdfWVsc2Ugb2EuZXZlbnQuYWx0S2V5JiYoTT1MLnNsaWNlKCkpO2suc3R5bGUoInBvaW50ZXItZXZlbnRzIiwibm9uZSIpLnNlbGVjdEFsbCgiLnJlc2l6ZSIpLnN0eWxlKCJkaXNwbGF5IixudWxsKSxvYS5zZWxlY3QoImJvZHkiKS5zdHlsZSgiY3Vyc29yIixfLnN0eWxlKCJjdXJzb3IiKSksdyh7dHlwZToiYnJ1c2hzdGFydCJ9KSxkKCl9dmFyIGEsbyxsPU4obiwiYnJ1c2hzdGFydCIsImJydXNoIiwiYnJ1c2hlbmQiKSxjPW51bGwscz1udWxsLGY9WzAsMF0saD1bMCwwXSxnPSEwLHA9ITAsdj0kbFswXTtyZXR1cm4gbi5ldmVudD1mdW5jdGlvbihuKXtuLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1sLm9mKHRoaXMsYXJndW1lbnRzKSx0PXt4OmYseTpoLGk6YSxqOm99LGU9dGhpcy5fX2NoYXJ0X198fHQ7dGhpcy5fX2NoYXJ0X189dCxGbD9vYS5zZWxlY3QodGhpcykudHJhbnNpdGlvbigpLmVhY2goInN0YXJ0LmJydXNoIixmdW5jdGlvbigpe2E9ZS5pLG89ZS5qLGY9ZS54LGg9ZS55LG4oe3R5cGU6ImJydXNoc3RhcnQifSl9KS50d2VlbigiYnJ1c2g6YnJ1c2giLGZ1bmN0aW9uKCl7dmFyIGU9eHIoZix0LngpLHI9eHIoaCx0LnkpO3JldHVybiBhPW89bnVsbCxmdW5jdGlvbih1KXtmPXQueD1lKHUpLGg9dC55PXIodSksbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KX19KS5lYWNoKCJlbmQuYnJ1c2giLGZ1bmN0aW9uKCl7YT10Lmksbz10Lmosbih7dHlwZToiYnJ1c2giLG1vZGU6InJlc2l6ZSJ9KSxuKHt0eXBlOiJicnVzaGVuZCJ9KX0pOihuKHt0eXBlOiJicnVzaHN0YXJ0In0pLG4oe3R5cGU6ImJydXNoIixtb2RlOiJyZXNpemUifSksbih7dHlwZToiYnJ1c2hlbmQifSkpfSl9LG4ueD1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8oYz10LHY9JGxbIWM8PDF8IXNdLG4pOmN9LG4ueT1mdW5jdGlvbih0KXtyZXR1cm4gYXJndW1lbnRzLmxlbmd0aD8ocz10LHY9JGxbIWM8PDF8IXNdLG4pOnN9LG4uY2xhbXA9ZnVuY3Rpb24odCl7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJnM/KGc9ISF0WzBdLHA9ISF0WzFdKTpjP2c9ISF0OnMmJihwPSEhdCksbik6YyYmcz9bZyxwXTpjP2c6cz9wOm51bGx9LG4uZXh0ZW50PWZ1bmN0aW9uKHQpe3ZhciBlLHIsdSxpLGw7cmV0dXJuIGFyZ3VtZW50cy5sZW5ndGg/KGMmJihlPXRbMF0scj10WzFdLHMmJihlPWVbMF0scj1yWzBdKSxhPVtlLHJdLGMuaW52ZXJ0JiYoZT1jKGUpLHI9YyhyKSksZT5yJiYobD1lLGU9cixyPWwpLChlIT1mWzBdfHxyIT1mWzFdKSYmKGY9W2Uscl0pKSxzJiYodT10WzBdLGk9dFsxXSxjJiYodT11WzFdLGk9aVsxXSksbz1bdSxpXSxzLmludmVydCYmKHU9cyh1KSxpPXMoaSkpLHU+aSYmKGw9dSx1PWksaT1sKSwodSE9aFswXXx8aSE9aFsxXSkmJihoPVt1LGldKSksbik6KGMmJihhPyhlPWFbMF0scj1hWzFdKTooZT1mWzBdLHI9ZlsxXSxjLmludmVydCYmKGU9Yy5pbnZlcnQoZSkscj1jLmludmVydChyKSksZT5yJiYobD1lLGU9cixyPWwpKSkscyYmKG8/KHU9b1swXSxpPW9bMV0pOih1PWhbMF0saT1oWzFdLHMuaW52ZXJ0JiYodT1zLmludmVydCh1KSxpPXMuaW52ZXJ0KGkpKSx1PmkmJihsPXUsdT1pLGk9bCkpKSxjJiZzP1tbZSx1XSxbcixpXV06Yz9bZSxyXTpzJiZbdSxpXSl9LG4uY2xlYXI9ZnVuY3Rpb24oKXtyZXR1cm4gbi5lbXB0eSgpfHwoZj1bMCwwXSxoPVswLDBdLGE9bz1udWxsKSxufSxuLmVtcHR5PWZ1bmN0aW9uKCl7cmV0dXJuISFjJiZmWzBdPT1mWzFdfHwhIXMmJmhbMF09PWhbMV19LG9hLnJlYmluZChuLGwsIm9uIil9O3ZhciBYbD17bjoibnMtcmVzaXplIixlOiJldy1yZXNpemUiLHM6Im5zLXJlc2l6ZSIsdzoiZXctcmVzaXplIixudzoibndzZS1yZXNpemUiLG5lOiJuZXN3LXJlc2l6ZSIsc2U6Im53c2UtcmVzaXplIixzdzoibmVzdy1yZXNpemUifSwkbD1bWyJuIiwiZSIsInMiLCJ3IiwibnciLCJuZSIsInNlIiwic3ciXSxbImUiLCJ3Il0sWyJuIiwicyJdLFtdXSxCbD1oby5mb3JtYXQ9TW8udGltZUZvcm1hdCxXbD1CbC51dGMsSmw9V2woIiVZLSVtLSVkVCVIOiVNOiVTLiVMWiIpO0JsLmlzbz1EYXRlLnByb3RvdHlwZS50b0lTT1N0cmluZyYmK25ldyBEYXRlKCIyMDAwLTAxLTAxVDAwOjAwOjAwLjAwMFoiKT9lYTpKbCxlYS5wYXJzZT1mdW5jdGlvbihuKXt2YXIgdD1uZXcgRGF0ZShuKTtyZXR1cm4gaXNOYU4odCk/bnVsbDp0fSxlYS50b1N0cmluZz1KbC50b1N0cmluZyxoby5zZWNvbmQ9T24oZnVuY3Rpb24obil7cmV0dXJuIG5ldyBnbygxZTMqTWF0aC5mbG9vcihuLzFlMykpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSsxZTMqTWF0aC5mbG9vcih0KSl9LGZ1bmN0aW9uKG4pe3JldHVybiBuLmdldFNlY29uZHMoKX0pLGhvLnNlY29uZHM9aG8uc2Vjb25kLnJhbmdlLGhvLnNlY29uZHMudXRjPWhvLnNlY29uZC51dGMucmFuZ2UsaG8ubWludXRlPU9uKGZ1bmN0aW9uKG4pe3JldHVybiBuZXcgZ28oNmU0Kk1hdGguZmxvb3Iobi82ZTQpKX0sZnVuY3Rpb24obix0KXtuLnNldFRpbWUobi5nZXRUaW1lKCkrNmU0Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9KSxoby5taW51dGVzPWhvLm1pbnV0ZS5yYW5nZSxoby5taW51dGVzLnV0Yz1oby5taW51dGUudXRjLnJhbmdlLGhvLmhvdXI9T24oZnVuY3Rpb24obil7dmFyIHQ9bi5nZXRUaW1lem9uZU9mZnNldCgpLzYwO3JldHVybiBuZXcgZ28oMzZlNSooTWF0aC5mbG9vcihuLzM2ZTUtdCkrdCkpfSxmdW5jdGlvbihuLHQpe24uc2V0VGltZShuLmdldFRpbWUoKSszNmU1Kk1hdGguZmxvb3IodCkpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfSksaG8uaG91cnM9aG8uaG91ci5yYW5nZSxoby5ob3Vycy51dGM9aG8uaG91ci51dGMucmFuZ2UsaG8ubW9udGg9T24oZnVuY3Rpb24obil7cmV0dXJuIG49aG8uZGF5KG4pLG4uc2V0RGF0ZSgxKSxufSxmdW5jdGlvbihuLHQpe24uc2V0TW9udGgobi5nZXRNb250aCgpK3QpfSxmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNb250aCgpfSksaG8ubW9udGhzPWhvLm1vbnRoLnJhbmdlLGhvLm1vbnRocy51dGM9aG8ubW9udGgudXRjLnJhbmdlO3ZhciBHbD1bMWUzLDVlMywxNWUzLDNlNCw2ZTQsM2U1LDllNSwxOGU1LDM2ZTUsMTA4ZTUsMjE2ZTUsNDMyZTUsODY0ZTUsMTcyOGU1LDYwNDhlNSwyNTkyZTYsNzc3NmU2LDMxNTM2ZTZdLEtsPVtbaG8uc2Vjb25kLDFdLFtoby5zZWNvbmQsNV0sW2hvLnNlY29uZCwxNV0sW2hvLnNlY29uZCwzMF0sW2hvLm1pbnV0ZSwxXSxbaG8ubWludXRlLDVdLFtoby5taW51dGUsMTVdLFtoby5taW51dGUsMzBdLFtoby5ob3VyLDFdLFtoby5ob3VyLDNdLFtoby5ob3VyLDZdLFtoby5ob3VyLDEyXSxbaG8uZGF5LDFdLFtoby5kYXksMl0sW2hvLndlZWssMV0sW2hvLm1vbnRoLDFdLFtoby5tb250aCwzXSxbaG8ueWVhciwxXV0sUWw9QmwubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0RGF5KCkmJjEhPW4uZ2V0RGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0RGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0TW9udGgoKX1dLFsiJVkiLHp0XV0pLG5jPXtyYW5nZTpmdW5jdGlvbihuLHQsZSl7cmV0dXJuIG9hLnJhbmdlKE1hdGguY2VpbChuL2UpKmUsK3QsZSkubWFwKHVhKX0sZmxvb3I6eSxjZWlsOnl9O0tsLnllYXI9aG8ueWVhcixoby5zY2FsZT1mdW5jdGlvbigpe3JldHVybiByYShvYS5zY2FsZS5saW5lYXIoKSxLbCxRbCl9O3ZhciB0Yz1LbC5tYXAoZnVuY3Rpb24obil7cmV0dXJuW25bMF0udXRjLG5bMV1dfSksZWM9V2wubXVsdGkoW1siLiVMIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNaWxsaXNlY29uZHMoKX1dLFsiOiVTIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENTZWNvbmRzKCl9XSxbIiVJOiVNIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENNaW51dGVzKCl9XSxbIiVJICVwIixmdW5jdGlvbihuKXtyZXR1cm4gbi5nZXRVVENIb3VycygpfV0sWyIlYSAlZCIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDRGF5KCkmJjEhPW4uZ2V0VVRDRGF0ZSgpfV0sWyIlYiAlZCIsZnVuY3Rpb24obil7cmV0dXJuIDEhPW4uZ2V0VVRDRGF0ZSgpfV0sWyIlQiIsZnVuY3Rpb24obil7cmV0dXJuIG4uZ2V0VVRDTW9udGgoKX1dLFsiJVkiLHp0XV0pO3RjLnllYXI9aG8ueWVhci51dGMsaG8uc2NhbGUudXRjPWZ1bmN0aW9uKCl7cmV0dXJuIHJhKG9hLnNjYWxlLmxpbmVhcigpLHRjLGVjKX0sb2EudGV4dD1BbihmdW5jdGlvbihuKXtyZXR1cm4gbi5yZXNwb25zZVRleHR9KSxvYS5qc29uPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIENuKG4sImFwcGxpY2F0aW9uL2pzb24iLGlhLHQpfSxvYS5odG1sPWZ1bmN0aW9uKG4sdCl7cmV0dXJuIENuKG4sInRleHQvaHRtbCIsYWEsdCl9LG9hLnhtbD1BbihmdW5jdGlvbihuKXtyZXR1cm4gbi5yZXNwb25zZVhNTH0pLCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQ/KHRoaXMuZDM9b2EsZGVmaW5lKG9hKSk6Im9iamVjdCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZS5leHBvcnRzP21vZHVsZS5leHBvcnRzPW9hOnRoaXMuZDM9b2F9KCk7"></script>
<script src="data:application/x-javascript;base64,LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjIuMS40CiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDUsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE1LTA0LTI4VDE2OjAxWgogKi8KCihmdW5jdGlvbiggZ2xvYmFsLCBmYWN0b3J5ICkgewoKCWlmICggdHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAib2JqZWN0IiApIHsKCQkvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIGB3aW5kb3dgCgkJLy8gaXMgcHJlc2VudCwgZXhlY3V0ZSB0aGUgZmFjdG9yeSBhbmQgZ2V0IGpRdWVyeS4KCQkvLyBGb3IgZW52aXJvbm1lbnRzIHRoYXQgZG8gbm90IGhhdmUgYSBgd2luZG93YCB3aXRoIGEgYGRvY3VtZW50YAoJCS8vIChzdWNoIGFzIE5vZGUuanMpLCBleHBvc2UgYSBmYWN0b3J5IGFzIG1vZHVsZS5leHBvcnRzLgoJCS8vIFRoaXMgYWNjZW50dWF0ZXMgdGhlIG5lZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiBhIHJlYWwgYHdpbmRvd2AuCgkJLy8gZS5nLiB2YXIgalF1ZXJ5ID0gcmVxdWlyZSgianF1ZXJ5Iikod2luZG93KTsKCQkvLyBTZWUgdGlja2V0ICMxNDU0OSBmb3IgbW9yZSBpbmZvLgoJCW1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLmRvY3VtZW50ID8KCQkJZmFjdG9yeSggZ2xvYmFsLCB0cnVlICkgOgoJCQlmdW5jdGlvbiggdyApIHsKCQkJCWlmICggIXcuZG9jdW1lbnQgKSB7CgkJCQkJdGhyb3cgbmV3IEVycm9yKCAialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIgKTsKCQkJCX0KCQkJCXJldHVybiBmYWN0b3J5KCB3ICk7CgkJCX07Cgl9IGVsc2UgewoJCWZhY3RvcnkoIGdsb2JhbCApOwoJfQoKLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKfSh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uKCB3aW5kb3csIG5vR2xvYmFsICkgewoKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8gQ2FuJ3QgYmUgaW4gc3RyaWN0IG1vZGUsIHNldmVyYWwgbGlicyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8KCnZhciBhcnIgPSBbXTsKCnZhciBzbGljZSA9IGFyci5zbGljZTsKCnZhciBjb25jYXQgPSBhcnIuY29uY2F0OwoKdmFyIHB1c2ggPSBhcnIucHVzaDsKCnZhciBpbmRleE9mID0gYXJyLmluZGV4T2Y7Cgp2YXIgY2xhc3MydHlwZSA9IHt9OwoKdmFyIHRvU3RyaW5nID0gY2xhc3MydHlwZS50b1N0cmluZzsKCnZhciBoYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5OwoKdmFyIHN1cHBvcnQgPSB7fTsKCgoKdmFyCgkvLyBVc2UgdGhlIGNvcnJlY3QgZG9jdW1lbnQgYWNjb3JkaW5nbHkgd2l0aCB3aW5kb3cgYXJndW1lbnQgKHNhbmRib3gpCglkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwKCgl2ZXJzaW9uID0gIjIuMS40IiwKCgkvLyBEZWZpbmUgYSBsb2NhbCBjb3B5IG9mIGpRdWVyeQoJalF1ZXJ5ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCS8vIFRoZSBqUXVlcnkgb2JqZWN0IGlzIGFjdHVhbGx5IGp1c3QgdGhlIGluaXQgY29uc3RydWN0b3IgJ2VuaGFuY2VkJwoJCS8vIE5lZWQgaW5pdCBpZiBqUXVlcnkgaXMgY2FsbGVkIChqdXN0IGFsbG93IGVycm9yIHRvIGJlIHRocm93biBpZiBub3QgaW5jbHVkZWQpCgkJcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKTsKCX0sCgoJLy8gU3VwcG9ydDogQW5kcm9pZDw0LjEKCS8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUAoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gTWF0Y2hlcyBkYXNoZWQgc3RyaW5nIGZvciBjYW1lbGl6aW5nCglybXNQcmVmaXggPSAvXi1tcy0vLAoJcmRhc2hBbHBoYSA9IC8tKFtcZGEtel0pL2dpLAoKCS8vIFVzZWQgYnkgalF1ZXJ5LmNhbWVsQ2FzZSBhcyBjYWxsYmFjayB0byByZXBsYWNlKCkKCWZjYW1lbENhc2UgPSBmdW5jdGlvbiggYWxsLCBsZXR0ZXIgKSB7CgkJcmV0dXJuIGxldHRlci50b1VwcGVyQ2FzZSgpOwoJfTsKCmpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7CgkvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkCglqcXVlcnk6IHZlcnNpb24sCgoJY29uc3RydWN0b3I6IGpRdWVyeSwKCgkvLyBTdGFydCB3aXRoIGFuIGVtcHR5IHNlbGVjdG9yCglzZWxlY3RvcjogIiIsCgoJLy8gVGhlIGRlZmF1bHQgbGVuZ3RoIG9mIGEgalF1ZXJ5IG9iamVjdCBpcyAwCglsZW5ndGg6IDAsCgoJdG9BcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtICE9IG51bGwgPwoKCQkJLy8gUmV0dXJuIGp1c3QgdGhlIG9uZSBlbGVtZW50IGZyb20gdGhlIHNldAoJCQkoIG51bSA8IDAgPyB0aGlzWyBudW0gKyB0aGlzLmxlbmd0aCBdIDogdGhpc1sgbnVtIF0gKSA6CgoJCQkvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBpbiBhIGNsZWFuIGFycmF5CgkJCXNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawoJLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpCglwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsKCgkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKCQl2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zICk7CgoJCS8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpCgkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoJCXJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0OwoKCQkvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldAoJCXJldHVybiByZXQ7Cgl9LAoKCS8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuCgkvLyAoWW91IGNhbiBzZWVkIHRoZSBhcmd1bWVudHMgd2l0aCBhbiBhcnJheSBvZiBhcmdzLCBidXQgdGhpcyBpcwoJLy8gb25seSB1c2VkIGludGVybmFsbHkuKQoJZWFjaDogZnVuY3Rpb24oIGNhbGxiYWNrLCBhcmdzICkgewoJCXJldHVybiBqUXVlcnkuZWFjaCggdGhpcywgY2FsbGJhY2ssIGFyZ3MgKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJc2xpY2U6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggc2xpY2UuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApICk7Cgl9LAoKCWZpcnN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggMCApOwoJfSwKCglsYXN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggLTEgKTsKCX0sCgoJZXE6IGZ1bmN0aW9uKCBpICkgewoJCXZhciBsZW4gPSB0aGlzLmxlbmd0aCwKCQkJaiA9ICtpICsgKCBpIDwgMCA/IGxlbiA6IDAgKTsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGogPj0gMCAmJiBqIDwgbGVuID8gWyB0aGlzW2pdIF0gOiBbXSApOwoJfSwKCgllbmQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcihudWxsKTsKCX0sCgoJLy8gRm9yIGludGVybmFsIHVzZSBvbmx5LgoJLy8gQmVoYXZlcyBsaWtlIGFuIEFycmF5J3MgbWV0aG9kLCBub3QgbGlrZSBhIGpRdWVyeSBtZXRob2QuCglwdXNoOiBwdXNoLAoJc29ydDogYXJyLnNvcnQsCglzcGxpY2U6IGFyci5zcGxpY2UKfTsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgb3B0aW9ucywgbmFtZSwgc3JjLCBjb3B5LCBjb3B5SXNBcnJheSwgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgoJCS8vIFNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQl0YXJnZXQgPSBhcmd1bWVudHNbIGkgXSB8fCB7fTsKCQlpKys7Cgl9CgoJLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCglpZiAoIHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiICYmICFqUXVlcnkuaXNGdW5jdGlvbih0YXJnZXQpICkgewoJCXRhcmdldCA9IHt9OwoJfQoKCS8vIEV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJaWYgKCBpID09PSBsZW5ndGggKSB7CgkJdGFyZ2V0ID0gdGhpczsKCQlpLS07Cgl9CgoJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcwoJCWlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHsKCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAoJCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJCQlzcmMgPSB0YXJnZXRbIG5hbWUgXTsKCQkJCWNvcHkgPSBvcHRpb25zWyBuYW1lIF07CgoJCQkJLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcAoJCQkJaWYgKCB0YXJnZXQgPT09IGNvcHkgKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIHBsYWluIG9iamVjdHMgb3IgYXJyYXlzCgkJCQlpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KGNvcHkpKSApICkgewoJCQkJCWlmICggY29weUlzQXJyYXkgKSB7CgkJCQkJCWNvcHlJc0FycmF5ID0gZmFsc2U7CgkJCQkJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9OwoJCQkJCX0KCgkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOwoKCQkJCS8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMKCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCXJldHVybiB0YXJnZXQ7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZQoJZXhwYW5kbzogImpRdWVyeSIgKyAoIHZlcnNpb24gKyBNYXRoLnJhbmRvbSgpICkucmVwbGFjZSggL1xEL2csICIiICksCgoJLy8gQXNzdW1lIGpRdWVyeSBpcyByZWFkeSB3aXRob3V0IHRoZSByZWFkeSBtb2R1bGUKCWlzUmVhZHk6IHRydWUsCgoJZXJyb3I6IGZ1bmN0aW9uKCBtc2cgKSB7CgkJdGhyb3cgbmV3IEVycm9yKCBtc2cgKTsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT09IG9iai53aW5kb3c7Cgl9LAoKCWlzTnVtZXJpYzogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBwYXJzZUZsb2F0IE5hTnMgbnVtZXJpYy1jYXN0IGZhbHNlIHBvc2l0aXZlcyAobnVsbHx0cnVlfGZhbHNlfCIiKQoJCS8vIC4uLmJ1dCBtaXNpbnRlcnByZXRzIGxlYWRpbmctbnVtYmVyIHN0cmluZ3MsIHBhcnRpY3VsYXJseSBoZXggbGl0ZXJhbHMgKCIweC4uLiIpCgkJLy8gc3VidHJhY3Rpb24gZm9yY2VzIGluZmluaXRpZXMgdG8gTmFOCgkJLy8gYWRkaW5nIDEgY29ycmVjdHMgbG9zcyBvZiBwcmVjaXNpb24gZnJvbSBwYXJzZUZsb2F0ICgjMTUxMDApCgkJcmV0dXJuICFqUXVlcnkuaXNBcnJheSggb2JqICkgJiYgKG9iaiAtIHBhcnNlRmxvYXQoIG9iaiApICsgMSkgPj0gMDsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBOb3QgcGxhaW4gb2JqZWN0czoKCQkvLyAtIEFueSBvYmplY3Qgb3IgdmFsdWUgd2hvc2UgaW50ZXJuYWwgW1tDbGFzc11dIHByb3BlcnR5IGlzIG5vdCAiW29iamVjdCBPYmplY3RdIgoJCS8vIC0gRE9NIG5vZGVzCgkJLy8gLSB3aW5kb3cKCQlpZiAoIGpRdWVyeS50eXBlKCBvYmogKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICggb2JqLmNvbnN0cnVjdG9yICYmCgkJCQkhaGFzT3duLmNhbGwoIG9iai5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIiApICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBJZiB0aGUgZnVuY3Rpb24gaGFzbid0IHJldHVybmVkIGFscmVhZHksIHdlJ3JlIGNvbmZpZGVudCB0aGF0CgkJLy8gfG9ianwgaXMgYSBwbGFpbiBvYmplY3QsIGNyZWF0ZWQgYnkge30gb3IgY29uc3RydWN0ZWQgd2l0aCBuZXcgT2JqZWN0CgkJcmV0dXJuIHRydWU7Cgl9LAoKCWlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7CgkJdmFyIG5hbWU7CgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9LAoKCXR5cGU6IGZ1bmN0aW9uKCBvYmogKSB7CgkJaWYgKCBvYmogPT0gbnVsbCApIHsKCQkJcmV0dXJuIG9iaiArICIiOwoJCX0KCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMCwgaU9TPDYgKGZ1bmN0aW9uaXNoIFJlZ0V4cCkKCQlyZXR1cm4gdHlwZW9mIG9iaiA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG9iaiA9PT0gImZ1bmN0aW9uIiA/CgkJCWNsYXNzMnR5cGVbIHRvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBjb2RlICkgewoJCXZhciBzY3JpcHQsCgkJCWluZGlyZWN0ID0gZXZhbDsKCgkJY29kZSA9IGpRdWVyeS50cmltKCBjb2RlICk7CgoJCWlmICggY29kZSApIHsKCQkJLy8gSWYgdGhlIGNvZGUgaW5jbHVkZXMgYSB2YWxpZCwgcHJvbG9ndWUgcG9zaXRpb24KCQkJLy8gc3RyaWN0IG1vZGUgcHJhZ21hLCBleGVjdXRlIGNvZGUgYnkgaW5qZWN0aW5nIGEKCQkJLy8gc2NyaXB0IHRhZyBpbnRvIHRoZSBkb2N1bWVudC4KCQkJaWYgKCBjb2RlLmluZGV4T2YoInVzZSBzdHJpY3QiKSA9PT0gMSApIHsKCQkJCXNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwoJCQkJc2NyaXB0LnRleHQgPSBjb2RlOwoJCQkJZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggc2NyaXB0ICkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCX0gZWxzZSB7CgkJCS8vIE90aGVyd2lzZSwgYXZvaWQgdGhlIERPTSBub2RlIGNyZWF0aW9uLCBpbnNlcnRpb24KCQkJLy8gYW5kIHJlbW92YWwgYnkgdXNpbmcgYW4gaW5kaXJlY3QgZ2xvYmFsIGV2YWwKCQkJCWluZGlyZWN0KCBjb2RlICk7CgkJCX0KCQl9Cgl9LAoKCS8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKCS8vIFN1cHBvcnQ6IElFOS0xMSsKCS8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MikKCWNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHsKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7Cgl9LAoKCW5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0sCgoJLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJZWFjaDogZnVuY3Rpb24oIG9iaiwgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHZhbHVlLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBvYmogKTsKCgkJaWYgKCBhcmdzICkgewoJCQlpZiAoIGlzQXJyYXkgKSB7CgkJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaSBpbiBvYmogKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5hcHBseSggb2JqWyBpIF0sIGFyZ3MgKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaAoJCX0gZWxzZSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmNhbGwoIG9ialsgaSBdLCBpLCBvYmpbIGkgXSApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMQoJdHJpbTogZnVuY3Rpb24oIHRleHQgKSB7CgkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCSIiIDoKCQkJKCB0ZXh0ICsgIiIgKS5yZXBsYWNlKCBydHJpbSwgIiIgKTsKCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQlwdXNoLmNhbGwoIHJldCwgYXJyICk7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9LAoKCWluQXJyYXk6IGZ1bmN0aW9uKCBlbGVtLCBhcnIsIGkgKSB7CgkJcmV0dXJuIGFyciA9PSBudWxsID8gLTEgOiBpbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJfSwKCgltZXJnZTogZnVuY3Rpb24oIGZpcnN0LCBzZWNvbmQgKSB7CgkJdmFyIGxlbiA9ICtzZWNvbmQubGVuZ3RoLAoJCQlqID0gMCwKCQkJaSA9IGZpcnN0Lmxlbmd0aDsKCgkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaiBdOwoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnZlcnQgKSB7CgkJdmFyIGNhbGxiYWNrSW52ZXJzZSwKCQkJbWF0Y2hlcyA9IFtdLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCQljYWxsYmFja0V4cGVjdCA9ICFpbnZlcnQ7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQljYWxsYmFja0ludmVyc2UgPSAhY2FsbGJhY2soIGVsZW1zWyBpIF0sIGkgKTsKCQkJaWYgKCBjYWxsYmFja0ludmVyc2UgIT09IGNhbGxiYWNrRXhwZWN0ICkgewoJCQkJbWF0Y2hlcy5wdXNoKCBlbGVtc1sgaSBdICk7CgkJCX0KCQl9CgoJCXJldHVybiBtYXRjaGVzOwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyIG5ldyB2YWx1ZXMKCQlpZiAoIGlzQXJyYXkgKSB7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJdmFsdWUgPSBjYWxsYmFjayggZWxlbXNbIGkgXSwgaSwgYXJnICk7CgoJCQkJaWYgKCB2YWx1ZSAhPSBudWxsICkgewoJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXQucHVzaCggdmFsdWUgKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cwoJCXJldHVybiBjb25jYXQuYXBwbHkoIFtdLCByZXQgKTsKCX0sCgoJLy8gQSBnbG9iYWwgR1VJRCBjb3VudGVyIGZvciBvYmplY3RzCglndWlkOiAxLAoKCS8vIEJpbmQgYSBmdW5jdGlvbiB0byBhIGNvbnRleHQsIG9wdGlvbmFsbHkgcGFydGlhbGx5IGFwcGx5aW5nIGFueQoJLy8gYXJndW1lbnRzLgoJcHJveHk6IGZ1bmN0aW9uKCBmbiwgY29udGV4dCApIHsKCQl2YXIgdG1wLCBhcmdzLCBwcm94eTsKCgkJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gInN0cmluZyIgKSB7CgkJCXRtcCA9IGZuWyBjb250ZXh0IF07CgkJCWNvbnRleHQgPSBmbjsKCQkJZm4gPSB0bXA7CgkJfQoKCQkvLyBRdWljayBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGFyZ2V0IGlzIGNhbGxhYmxlLCBpbiB0aGUgc3BlYwoJCS8vIHRoaXMgdGhyb3dzIGEgVHlwZUVycm9yLCBidXQgd2Ugd2lsbCBqdXN0IHJldHVybiB1bmRlZmluZWQuCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIGZuICkgKSB7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoKCQkvLyBTaW11bGF0ZWQgYmluZAoJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApICkgKTsKCQl9OwoKCQkvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQKCQlwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKzsKCgkJcmV0dXJuIHByb3h5OwoJfSwKCglub3c6IERhdGUubm93LAoKCS8vIGpRdWVyeS5zdXBwb3J0IGlzIG5vdCB1c2VkIGluIENvcmUgYnV0IG90aGVyIHByb2plY3RzIGF0dGFjaCB0aGVpcgoJLy8gcHJvcGVydGllcyB0byBpdCBzbyBpdCBuZWVkcyB0byBleGlzdC4KCXN1cHBvcnQ6IHN1cHBvcnQKfSk7CgovLyBQb3B1bGF0ZSB0aGUgY2xhc3MydHlwZSBtYXAKalF1ZXJ5LmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGksIG5hbWUpIHsKCWNsYXNzMnR5cGVbICJbb2JqZWN0ICIgKyBuYW1lICsgIl0iIF0gPSBuYW1lLnRvTG93ZXJDYXNlKCk7Cn0pOwoKZnVuY3Rpb24gaXNBcnJheWxpa2UoIG9iaiApIHsKCgkvLyBTdXBwb3J0OiBpT1MgOC4yIChub3QgcmVwcm9kdWNpYmxlIGluIHNpbXVsYXRvcikKCS8vIGBpbmAgY2hlY2sgdXNlZCB0byBwcmV2ZW50IEpJVCBlcnJvciAoZ2gtMjE0NSkKCS8vIGhhc093biBpc24ndCB1c2VkIGhlcmUgZHVlIHRvIGZhbHNlIG5lZ2F0aXZlcwoJLy8gcmVnYXJkaW5nIE5vZGVsaXN0IGxlbmd0aCBpbiBJRQoJdmFyIGxlbmd0aCA9ICJsZW5ndGgiIGluIG9iaiAmJiBvYmoubGVuZ3RoLAoJCXR5cGUgPSBqUXVlcnkudHlwZSggb2JqICk7CgoJaWYgKCB0eXBlID09PSAiZnVuY3Rpb24iIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCWlmICggb2JqLm5vZGVUeXBlID09PSAxICYmIGxlbmd0aCApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglyZXR1cm4gdHlwZSA9PT0gImFycmF5IiB8fCBsZW5ndGggPT09IDAgfHwKCQl0eXBlb2YgbGVuZ3RoID09PSAibnVtYmVyIiAmJiBsZW5ndGggPiAwICYmICggbGVuZ3RoIC0gMSApIGluIG9iajsKfQp2YXIgU2l6emxlID0KLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHYyLjIuMC1wcmUKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDgsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE0LTEyLTE2CiAqLwooZnVuY3Rpb24oIHdpbmRvdyApIHsKCnZhciBpLAoJc3VwcG9ydCwKCUV4cHIsCglnZXRUZXh0LAoJaXNYTUwsCgl0b2tlbml6ZSwKCWNvbXBpbGUsCglzZWxlY3QsCglvdXRlcm1vc3RDb250ZXh0LAoJc29ydElucHV0LAoJaGFzRHVwbGljYXRlLAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc0hUTUwsCglyYnVnZ3lRU0EsCglyYnVnZ3lNYXRjaGVzLAoJbWF0Y2hlcywKCWNvbnRhaW5zLAoKCS8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGEKCWV4cGFuZG8gPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSgpLAoJcHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LAoJZGlycnVucyA9IDAsCglkb25lID0gMCwKCWNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJdG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgljb21waWxlckNhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXNvcnRPcmRlciA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQl9CgkJcmV0dXJuIDA7Cgl9LAoKCS8vIEdlbmVyYWwtcHVycG9zZSBjb25zdGFudHMKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gSW5zdGFuY2UgbWV0aG9kcwoJaGFzT3duID0gKHt9KS5oYXNPd25Qcm9wZXJ0eSwKCWFyciA9IFtdLAoJcG9wID0gYXJyLnBvcCwKCXB1c2hfbmF0aXZlID0gYXJyLnB1c2gsCglwdXNoID0gYXJyLnB1c2gsCglzbGljZSA9IGFyci5zbGljZSwKCS8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBhcyBpdCdzIGZhc3RlciB0aGFuIG5hdGl2ZQoJLy8gaHR0cDovL2pzcGVyZi5jb20vdGhvci1pbmRleG9mLXZzLWZvci81CglpbmRleE9mID0gZnVuY3Rpb24oIGxpc3QsIGVsZW0gKSB7CgkJdmFyIGkgPSAwLAoJCQlsZW4gPSBsaXN0Lmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJaWYgKCBsaXN0W2ldID09PSBlbGVtICkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfSwKCglib29sZWFucyA9ICJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsCgoJLy8gUmVndWxhciBleHByZXNzaW9ucwoKCS8vIFdoaXRlc3BhY2UgY2hhcmFjdGVycyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZQoJd2hpdGVzcGFjZSA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwKCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc3ludGF4LyNjaGFyYWN0ZXJzCgljaGFyYWN0ZXJFbmNvZGluZyA9ICIoPzpcXFxcLnxbXFx3LV18W15cXHgwMC1cXHhhMF0pKyIsCgoJLy8gTG9vc2VseSBtb2RlbGVkIG9uIENTUyBpZGVudGlmaWVyIGNoYXJhY3RlcnMKCS8vIEFuIHVucXVvdGVkIHZhbHVlIHNob3VsZCBiZSBhIENTUyBpZGVudGlmaWVyIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCgkvLyBQcm9wZXIgc3ludGF4OiBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjdmFsdWUtZGVmLWlkZW50aWZpZXIKCWlkZW50aWZpZXIgPSBjaGFyYWN0ZXJFbmNvZGluZy5yZXBsYWNlKCAidyIsICJ3IyIgKSwKCgkvLyBBdHRyaWJ1dGUgc2VsZWN0b3JzOiBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OiIgKyB3aGl0ZXNwYWNlICsKCQkvLyBPcGVyYXRvciAoY2FwdHVyZSAyKQoJCSIqKFsqXiR8IX5dPz0pIiArIHdoaXRlc3BhY2UgKwoJCS8vICJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdIgoJCSIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIgKyBpZGVudGlmaWVyICsgIikpfCkiICsgd2hpdGVzcGFjZSArCgkJIipcXF0iLAoKCXBzZXVkb3MgPSAiOigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OlxcKCgiICsKCQkvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgoJCS8vIDEuIHF1b3RlZCAoY2FwdHVyZSAzOyBjYXB0dXJlIDQgb3IgY2FwdHVyZSA1KQoJCSIoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCIgKwoJCS8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQoJCSIoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgYXR0cmlidXRlcyArICIpKil8IiArCgkJLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKQoJCSIuKiIgKwoJCSIpXFwpfCkiLAoKCS8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXIKCXJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCggd2hpdGVzcGFjZSArICIrIiwgImciICksCglydHJpbSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIHdoaXRlc3BhY2UgKyAiKyQiLCAiZyIgKSwKCglyY29tbWEgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiosIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCXJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKihbPit+XXwiICsgd2hpdGVzcGFjZSArICIpIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCglyYXR0cmlidXRlUXVvdGVzID0gbmV3IFJlZ0V4cCggIj0iICsgd2hpdGVzcGFjZSArICIqKFteXFxdJ1wiXSo/KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLCAiZyIgKSwKCglycHNldWRvID0gbmV3IFJlZ0V4cCggcHNldWRvcyApLAoJcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCAiXiIgKyBpZGVudGlmaWVyICsgIiQiICksCgoJbWF0Y2hFeHByID0gewoJCSJJRCI6IG5ldyBSZWdFeHAoICJeIygiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiQ0xBU1MiOiBuZXcgUmVnRXhwKCAiXlxcLigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiVEFHIjogbmV3IFJlZ0V4cCggIl4oIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoICJ3IiwgIncqIiApICsgIikiICksCgkJIkFUVFIiOiBuZXcgUmVnRXhwKCAiXiIgKyBhdHRyaWJ1dGVzICksCgkJIlBTRVVETyI6IG5ldyBSZWdFeHAoICJeIiArIHBzZXVkb3MgKSwKCQkiQ0hJTEQiOiBuZXcgUmVnRXhwKCAiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIHdoaXRlc3BhY2UgKwoJCQkiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKwoJCQkiKihcXGQrKXwpKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSIsICJpIiApLAoJCSJib29sIjogbmV3IFJlZ0V4cCggIl4oPzoiICsgYm9vbGVhbnMgKyAiKSQiLCAiaSIgKSwKCQkvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKCQkvLyBXZSB1c2UgdGhpcyBmb3IgUE9TIG1hdGNoaW5nIGluIGBzZWxlY3RgCgkJIm5lZWRzQ29udGV4dCI6IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKls+K35dfDooZXZlbnxvZGR8ZXF8Z3R8bHR8bnRofGZpcnN0fGxhc3QpKD86XFwoIiArCgkJCXdoaXRlc3BhY2UgKyAiKigoPzotXFxkKT9cXGQqKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSg/PVteLV18JCkiLCAiaSIgKQoJfSwKCglyaW5wdXRzID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKCXJoZWFkZXIgPSAvXmhcZCQvaSwKCglybmF0aXZlID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcnNpYmxpbmcgPSAvWyt+XS8sCglyZXNjYXBlID0gLyd8XFwvZywKCgkvLyBDU1MgZXNjYXBlcyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjZXNjYXBlZC1jaGFyYWN0ZXJzCglydW5lc2NhcGUgPSBuZXcgUmVnRXhwKCAiXFxcXChbXFxkYS1mXXsxLDZ9IiArIHdoaXRlc3BhY2UgKyAiP3woIiArIHdoaXRlc3BhY2UgKyAiKXwuKSIsICJpZyIgKSwKCWZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHsKCQl2YXIgaGlnaCA9ICIweCIgKyBlc2NhcGVkIC0gMHgxMDAwMDsKCQkvLyBOYU4gbWVhbnMgbm9uLWNvZGVwb2ludAoJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjQKCQkvLyBXb3JrYXJvdW5kIGVycm9uZW91cyBudW1lcmljIGludGVycHJldGF0aW9uIG9mICsiMHgiCgkJcmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgPwoJCQllc2NhcGVkIDoKCQkJaGlnaCA8IDAgPwoJCQkJLy8gQk1QIGNvZGVwb2ludAoJCQkJU3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCArIDB4MTAwMDAgKSA6CgkJCQkvLyBTdXBwbGVtZW50YWwgUGxhbmUgY29kZXBvaW50IChzdXJyb2dhdGUgcGFpcikKCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggPj4gMTAgfCAweEQ4MDAsIGhpZ2ggJiAweDNGRiB8IDB4REMwMCApOwoJfSwKCgkvLyBVc2VkIGZvciBpZnJhbWVzCgkvLyBTZWUgc2V0RG9jdW1lbnQoKQoJLy8gUmVtb3ZpbmcgdGhlIGZ1bmN0aW9uIHdyYXBwZXIgY2F1c2VzIGEgIlBlcm1pc3Npb24gRGVuaWVkIgoJLy8gZXJyb3IgaW4gSUUKCXVubG9hZEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKCQlzZXREb2N1bWVudCgpOwoJfTsKCi8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApCnRyeSB7CglwdXNoLmFwcGx5KAoJCShhcnIgPSBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuY2hpbGROb2RlcyApKSwKCQlwcmVmZXJyZWREb2MuY2hpbGROb2RlcwoJKTsKCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5CglhcnJbIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aCBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXB1c2ggPSB7IGFwcGx5OiBhcnIubGVuZ3RoID8KCgkJLy8gTGV2ZXJhZ2Ugc2xpY2UgaWYgcG9zc2libGUKCQlmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7CgkJCXB1c2hfbmF0aXZlLmFwcGx5KCB0YXJnZXQsIHNsaWNlLmNhbGwoZWxzKSApOwoJCX0gOgoKCQkvLyBTdXBwb3J0OiBJRTw5CgkJLy8gT3RoZXJ3aXNlIGFwcGVuZCBkaXJlY3RseQoJCWZ1bmN0aW9uKCB0YXJnZXQsIGVscyApIHsKCQkJdmFyIGogPSB0YXJnZXQubGVuZ3RoLAoJCQkJaSA9IDA7CgkJCS8vIENhbid0IHRydXN0IE5vZGVMaXN0Lmxlbmd0aAoJCQl3aGlsZSAoICh0YXJnZXRbaisrXSA9IGVsc1tpKytdKSApIHt9CgkJCXRhcmdldC5sZW5ndGggPSBqIC0gMTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkgewoJdmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSwKCQkvLyBRU0EgdmFycwoJCWksIGdyb3Vwcywgb2xkLCBuaWQsIG5ld0NvbnRleHQsIG5ld1NlbGVjdG9yOwoKCWlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCgljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoJbm9kZVR5cGUgPSBjb250ZXh0Lm5vZGVUeXBlOwoKCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwKCQlub2RlVHlwZSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSAmJiBub2RlVHlwZSAhPT0gMTEgKSB7CgoJCXJldHVybiByZXN1bHRzOwoJfQoKCWlmICggIXNlZWQgJiYgZG9jdW1lbnRJc0hUTUwgKSB7CgoJCS8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgd2hlbiBwb3NzaWJsZSAoZS5nLiwgbm90IHVuZGVyIERvY3VtZW50RnJhZ21lbnQpCgkJaWYgKCBub2RlVHlwZSAhPT0gMTEgJiYgKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApKSApIHsKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiI0lEIikKCQkJaWYgKCAobSA9IG1hdGNoWzFdKSApIHsKCQkJCWlmICggbm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG0gKTsKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKGpRdWVyeSAjNjk2MykKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUsIE9wZXJhLCBhbmQgV2Via2l0IHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkID09PSBtICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJLy8gQ29udGV4dCBpcyBub3QgYSBkb2N1bWVudAoJCQkJCWlmICggY29udGV4dC5vd25lckRvY3VtZW50ICYmIChlbGVtID0gY29udGV4dC5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtICkpICYmCgkJCQkJCWNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICkgJiYgZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0KCgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIlRBRyIpCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzJdICkgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCIuQ0xBU1MiKQoJCQl9IGVsc2UgaWYgKCAobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAoIXJidWdneVFTQSB8fCAhcmJ1Z2d5UVNBLnRlc3QoIHNlbGVjdG9yICkpICkgewoJCQluaWQgPSBvbGQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSAhPT0gMSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywKCQkJCQkJbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApCgkJCQkJKTsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0gY2F0Y2gocXNhRXJyb3IpIHsKCQkJCX0gZmluYWxseSB7CgkJCQkJaWYgKCAhb2xkICkgewoJCQkJCQljb250ZXh0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gQWxsIG90aGVycwoJcmV0dXJuIHNlbGVjdCggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sICIkMSIgKSwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApOwp9CgovKioKICogQ3JlYXRlIGtleS12YWx1ZSBjYWNoZXMgb2YgbGltaXRlZCBzaXplCiAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgKICoJcHJvcGVydHkgbmFtZSB0aGUgKHNwYWNlLXN1ZmZpeGVkKSBzdHJpbmcgYW5kIChpZiB0aGUgY2FjaGUgaXMgbGFyZ2VyIHRoYW4gRXhwci5jYWNoZUxlbmd0aCkKICoJZGVsZXRpbmcgdGhlIG9sZGVzdCBlbnRyeQogKi8KZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7Cgl2YXIga2V5cyA9IFtdOwoKCWZ1bmN0aW9uIGNhY2hlKCBrZXksIHZhbHVlICkgewoJCS8vIFVzZSAoa2V5ICsgIiAiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KQoJCWlmICgga2V5cy5wdXNoKCBrZXkgKyAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgKyAiICIgXSA9IHZhbHVlKTsKCX0KCXJldHVybiBjYWNoZTsKfQoKLyoqCiAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrCiAqLwpmdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkgewoJZm5bIGV4cGFuZG8gXSA9IHRydWU7CglyZXR1cm4gZm47Cn0KCi8qKgogKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHQKICovCmZ1bmN0aW9uIGFzc2VydCggZm4gKSB7Cgl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgoJdHJ5IHsKCQlyZXR1cm4gISFmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyBSZW1vdmUgZnJvbSBpdHMgcGFyZW50IGJ5IGRlZmF1bHQKCQlpZiAoIGRpdi5wYXJlbnROb2RlICkgewoJCQlkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZGl2ICk7CgkJfQoJCS8vIHJlbGVhc2UgbWVtb3J5IGluIElFCgkJZGl2ID0gbnVsbDsKCX0KfQoKLyoqCiAqIEFkZHMgdGhlIHNhbWUgaGFuZGxlciBmb3IgYWxsIG9mIHRoZSBzcGVjaWZpZWQgYXR0cnMKICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBtZXRob2QgdGhhdCB3aWxsIGJlIGFwcGxpZWQKICovCmZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7Cgl2YXIgYXJyID0gYXR0cnMuc3BsaXQoInwiKSwKCQlpID0gYXR0cnMubGVuZ3RoOwoKCXdoaWxlICggaS0tICkgewoJCUV4cHIuYXR0ckhhbmRsZVsgYXJyW2ldIF0gPSBoYW5kbGVyOwoJfQp9CgovKioKICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5ncwogKiBAcGFyYW0ge0VsZW1lbnR9IGEKICogQHBhcmFtIHtFbGVtZW50fSBiCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYgogKi8KZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkgewoJdmFyIGN1ciA9IGIgJiYgYSwKCQlkaWZmID0gY3VyICYmIGEubm9kZVR5cGUgPT09IDEgJiYgYi5ub2RlVHlwZSA9PT0gMSAmJgoJCQkoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC0KCQkJKCB+YS5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKTsKCgkvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXMKCWlmICggZGlmZiApIHsKCQlyZXR1cm4gZGlmZjsKCX0KCgkvLyBDaGVjayBpZiBiIGZvbGxvd3MgYQoJaWYgKCBjdXIgKSB7CgkJd2hpbGUgKCAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSApIHsKCQkJaWYgKCBjdXIgPT09IGIgKSB7CgkJCQlyZXR1cm4gLTE7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGEgPyAxIDogLTE7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVJbnB1dFBzZXVkbyggdHlwZSApIHsKCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlyZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKi8KZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBhcmd1bWVudCApIHsKCQlhcmd1bWVudCA9ICthcmd1bWVudDsKCQlyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQl2YXIgaiwKCQkJCW1hdGNoSW5kZXhlcyA9IGZuKCBbXSwgc2VlZC5sZW5ndGgsIGFyZ3VtZW50ICksCgkJCQlpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCgkJCS8vIE1hdGNoIGVsZW1lbnRzIGZvdW5kIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXhlcwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7CgkJCQkJc2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKLyoqCiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHQKICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHQKICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlCiAqLwpmdW5jdGlvbiB0ZXN0Q29udGV4dCggY29udGV4dCApIHsKCXJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSAidW5kZWZpbmVkIiAmJiBjb250ZXh0Owp9CgovLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZQpzdXBwb3J0ID0gU2l6emxlLnN1cHBvcnQgPSB7fTsKCi8qKgogKiBEZXRlY3RzIFhNTCBub2RlcwogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudAogKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlCiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGhhc0NvbXBhcmUsIHBhcmVudCwKCQlkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7CgoJLy8gSWYgbm8gZG9jdW1lbnQgYW5kIGRvY3VtZW50RWxlbWVudCBpcyBhdmFpbGFibGUsIHJldHVybgoJaWYgKCBkb2MgPT09IGRvY3VtZW50IHx8IGRvYy5ub2RlVHlwZSAhPT0gOSB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCApIHsKCQlyZXR1cm4gZG9jdW1lbnQ7Cgl9CgoJLy8gU2V0IG91ciBkb2N1bWVudAoJZG9jdW1lbnQgPSBkb2M7Cglkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsKCXBhcmVudCA9IGRvYy5kZWZhdWx0VmlldzsKCgkvLyBTdXBwb3J0OiBJRT44CgkvLyBJZiBpZnJhbWUgZG9jdW1lbnQgaXMgYXNzaWduZWQgdG8gImRvY3VtZW50IiB2YXJpYWJsZSBhbmQgaWYgaWZyYW1lIGhhcyBiZWVuIHJlbG9hZGVkLAoJLy8gSUUgd2lsbCB0aHJvdyAicGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gYWNjZXNzaW5nICJkb2N1bWVudCIgdmFyaWFibGUsIHNlZSBqUXVlcnkgIzEzOTM2CgkvLyBJRTYtOCBkbyBub3Qgc3VwcG9ydCB0aGUgZGVmYXVsdFZpZXcgcHJvcGVydHkgc28gcGFyZW50IHdpbGwgYmUgdW5kZWZpbmVkCglpZiAoIHBhcmVudCAmJiBwYXJlbnQgIT09IHBhcmVudC50b3AgKSB7CgkJLy8gSUUxMSBkb2VzIG5vdCBoYXZlIGF0dGFjaEV2ZW50LCBzbyBhbGwgbXVzdCBzdWZmZXIKCQlpZiAoIHBhcmVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciggInVubG9hZCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlICk7CgkJfSBlbHNlIGlmICggcGFyZW50LmF0dGFjaEV2ZW50ICkgewoJCQlwYXJlbnQuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIHVubG9hZEhhbmRsZXIgKTsKCQl9Cgl9CgoJLyogU3VwcG9ydCB0ZXN0cwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJZG9jdW1lbnRJc0hUTUwgPSAhaXNYTUwoIGRvYyApOwoKCS8qIEF0dHJpYnV0ZXMKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBTdXBwb3J0OiBJRTw4CgkvLyBWZXJpZnkgdGhhdCBnZXRBdHRyaWJ1dGUgcmVhbGx5IHJldHVybnMgYXR0cmlidXRlcyBhbmQgbm90IHByb3BlcnRpZXMKCS8vIChleGNlcHRpbmcgSUU4IGJvb2xlYW5zKQoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmNsYXNzTmFtZSA9ICJpIjsKCQlyZXR1cm4gIWRpdi5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpOwoJfSk7CgoJLyogZ2V0RWxlbWVudChzKUJ5KgoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCS8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzCglzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmFwcGVuZENoaWxkKCBkb2MuY3JlYXRlQ29tbWVudCgiIikgKTsKCQlyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKCX0pOwoKCS8vIFN1cHBvcnQ6IElFPDkKCXN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKTsKCgkvLyBTdXBwb3J0OiBJRTwxMAoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBUaGUgYnJva2VuIGdldEVsZW1lbnRCeUlkIG1ldGhvZHMgZG9uJ3QgcGljayB1cCBwcm9ncmFtYXRpY2FsbHktc2V0IG5hbWVzLAoJLy8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0CglzdXBwb3J0LmdldEJ5SWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBkaXYgKS5pZCA9IGV4cGFuZG87CgkJcmV0dXJuICFkb2MuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aDsKCX0pOwoKCS8vIElEIGZpbmQgYW5kIGZpbHRlcgoJaWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJCXZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTsKCQkJCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zCgkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQlyZXR1cm4gbSAmJiBtLnBhcmVudE5vZGUgPyBbIG0gXSA6IFtdOwoJCQl9CgkJfTsKCQlFeHByLmZpbHRlclsiSUQiXSA9IGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9IGVsc2UgewoJCS8vIFN1cHBvcnQ6IElFNi83CgkJLy8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dAoJCWRlbGV0ZSBFeHByLmZpbmRbIklEIl07CgoJCUV4cHIuZmlsdGVyWyJJRCJdID0gIGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBEb2N1bWVudEZyYWdtZW50IG5vZGVzIGRvbid0IGhhdmUgZ0VCVE4KCQkJfSBlbHNlIGlmICggc3VwcG9ydC5xc2EgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgKTsKCQkJfQoJCX0gOgoKCQlmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCQl2YXIgZWxlbSwKCQkJCXRtcCA9IFtdLAoJCQkJaSA9IDAsCgkJCQkvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vCgkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBGaWx0ZXIgb3V0IHBvc3NpYmxlIGNvbW1lbnRzCgkJCWlmICggdGFnID09PSAiKiIgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCXRtcC5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoKCQkJCXJldHVybiB0bXA7CgkJCX0KCQkJcmV0dXJuIHJlc3VsdHM7CgkJfTsKCgkvLyBDbGFzcwoJRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCBkb2N1bWVudElzSFRNTCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7CgkJfQoJfTsKCgkvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yCgktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSkKCS8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvcgoJLy8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZQoJLy8gU28sIHdlIGFsbG93IDpmb2N1cyB0byBwYXNzIHRocm91Z2ggUVNBIGFsbCB0aGUgdGltZSB0byBhdm9pZCB0aGUgSUUgZXJyb3IKCS8vIFNlZSBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMzM3OAoJcmJ1Z2d5UVNBID0gW107CgoJaWYgKCAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoIGRvYy5xdWVyeVNlbGVjdG9yQWxsICkpICkgewoJCS8vIEJ1aWxkIFFTQSByZWdleAoJCS8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmkKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZQoJCQkvLyBUaGlzIGlzIHRvIHRlc3QgSUUncyB0cmVhdG1lbnQgb2Ygbm90IGV4cGxpY2l0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIGV4cGFuZG8gKyAiJz48L2E+IiArCgkJCQkiPHNlbGVjdCBpZD0nIiArIGV4cGFuZG8gKyAiLVxmXScgbXNhbGxvd2NhcHR1cmU9Jyc+IiArCgkJCQkiPG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOwoKCQkJLy8gU3VwcG9ydDogSUU4LCBPcGVyYSAxMS0xMi4xNgoJCQkvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9CgkJCS8vIFRoZSB0ZXN0IGF0dHJpYnV0ZSBtdXN0IGJlIHVua25vd24gaW4gT3BlcmEgYnV0ICJzYWZlIiBmb3IgV2luUlQKCQkJLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2hoNDY1Mzg4LmFzcHgjYXR0cmlidXRlX3NlY3Rpb24KCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW21zYWxsb3djYXB0dXJlXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzonJ3xcIlwiKSIgKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU4CgkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBhbmQgInZhbHVlIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86dmFsdWV8IiArIGJvb2xlYW5zICsgIikiICk7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjIrLCBTYWZhcmk8Ny4wKywgaU9TPDcuMCssIFBoYW50b21KUzwxLjkuNysKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJbaWR+PSIgKyBleHBhbmRvICsgIi1dIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCJ+PSIpOwoJCQl9CgoJCQkvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50cwoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZAoJCQkvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0cwoJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCgiOmNoZWNrZWQiKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogU2FmYXJpIDgrLCBpT1MgOCsKCQkJLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MQoJCQkvLyBJbi1wYWdlIGBzZWxlY3RvciNpZCBzaWJpbmctY29tYmluYXRvciBzZWxlY3RvcmAgZmFpbHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJhIyIgKyBleHBhbmRvICsgIisqIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCIuIy4rWyt+XSIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQkvLyBTdXBwb3J0OiBXaW5kb3dzIDggTmF0aXZlIEFwcHMKCQkJLy8gVGhlIHR5cGUgYW5kIG5hbWUgYXR0cmlidXRlcyBhcmUgcmVzdHJpY3RlZCBkdXJpbmcgLmlubmVySFRNTCBhc3NpZ25tZW50CgkJCXZhciBpbnB1dCA9IGRvYy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImhpZGRlbiIgKTsKCQkJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApLnNldEF0dHJpYnV0ZSggIm5hbWUiLCAiRCIgKTsKCgkJCS8vIFN1cHBvcnQ6IElFOAoJCQkvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGUKCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW25hbWU9ZF0iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIm5hbWUiICsgd2hpdGVzcGFjZSArICIqWypeJHwhfl0/PSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBybmF0aXZlLnRlc3QoIChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkgewoKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gQ2hlY2sgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZG8gbWF0Y2hlc1NlbGVjdG9yCgkJCS8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkpCgkJCXN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoIGRpdiwgImRpdiIgKTsKCgkJCS8vIFRoaXMgc2hvdWxkIGZhaWwgd2l0aCBhbiBleGNlcHRpb24KCQkJLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAoJCQltYXRjaGVzLmNhbGwoIGRpdiwgIltzIT0nJ106eCIgKTsKCQkJcmJ1Z2d5TWF0Y2hlcy5wdXNoKCAiIT0iLCBwc2V1ZG9zICk7CgkJfSk7Cgl9CgoJcmJ1Z2d5UVNBID0gcmJ1Z2d5UVNBLmxlbmd0aCAmJiBuZXcgUmVnRXhwKCByYnVnZ3lRU0Euam9pbigifCIpICk7CglyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikgKTsKCgkvKiBDb250YWlucwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJaGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8qIFNvcnRpbmcKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nCglzb3J0T3JkZXIgPSBoYXNDb21wYXJlID8KCWZ1bmN0aW9uKCBhLCBiICkgewoKCQkvLyBGbGFnIGZvciBkdXBsaWNhdGUgcmVtb3ZhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQkvLyBTb3J0IG9uIG1ldGhvZCBleGlzdGVuY2UgaWYgb25seSBvbmUgaW5wdXQgaGFzIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uCgkJdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOwoJCWlmICggY29tcGFyZSApIHsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoKCQkvLyBDYWxjdWxhdGUgcG9zaXRpb24gaWYgYm90aCBpbnB1dHMgYmVsb25nIHRvIHRoZSBzYW1lIGRvY3VtZW50CgkJY29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID8KCQkJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYiApIDoKCgkJCS8vIE90aGVyd2lzZSB3ZSBrbm93IHRoZXkgYXJlIGRpc2Nvbm5lY3RlZAoJCQkxOwoKCQkvLyBEaXNjb25uZWN0ZWQgbm9kZXMKCQlpZiAoIGNvbXBhcmUgJiAxIHx8CgkJCSghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHsKCgkJCS8vIENob29zZSB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IGlzIHJlbGF0ZWQgdG8gb3VyIHByZWZlcnJlZCBkb2N1bWVudAoJCQlpZiAoIGEgPT09IGRvYyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJCWlmICggYiA9PT0gZG9jIHx8IGIub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikgKSB7CgkJCQlyZXR1cm4gMTsKCQkJfQoKCQkJLy8gTWFpbnRhaW4gb3JpZ2luYWwgb3JkZXIKCQkJcmV0dXJuIHNvcnRJbnB1dCA/CgkJCQkoIGluZGV4T2YoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZiggc29ydElucHV0LCBiICkgKSA6CgkJCQkwOwoJCX0KCgkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJfSA6CglmdW5jdGlvbiggYSwgYiApIHsKCQkvLyBFeGl0IGVhcmx5IGlmIHRoZSBub2RlcyBhcmUgaWRlbnRpY2FsCgkJaWYgKCBhID09PSBiICkgewoJCQloYXNEdXBsaWNhdGUgPSB0cnVlOwoJCQlyZXR1cm4gMDsKCQl9CgoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gUGFyZW50bGVzcyBub2RlcyBhcmUgZWl0aGVyIGRvY3VtZW50cyBvciBkaXNjb25uZWN0ZWQKCQlpZiAoICFhdXAgfHwgIWJ1cCApIHsKCQkJcmV0dXJuIGEgPT09IGRvYyA/IC0xIDoKCQkJCWIgPT09IGRvYyA/IDEgOgoJCQkJYXVwID8gLTEgOgoJCQkJYnVwID8gMSA6CgkJCQlzb3J0SW5wdXQgPwoJCQkJKCBpbmRleE9mKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YoIHNvcnRJbnB1dCwgYiApICkgOgoJCQkJMDsKCgkJLy8gSWYgdGhlIG5vZGVzIGFyZSBzaWJsaW5ncywgd2UgY2FuIGRvIGEgcXVpY2sgY2hlY2sKCQl9IGVsc2UgaWYgKCBhdXAgPT09IGJ1cCApIHsKCQkJcmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlIHdlIG5lZWQgZnVsbCBsaXN0cyBvZiB0aGVpciBhbmNlc3RvcnMgZm9yIGNvbXBhcmlzb24KCQljdXIgPSBhOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYXAudW5zaGlmdCggY3VyICk7CgkJfQoJCWN1ciA9IGI7CgkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQlicC51bnNoaWZ0KCBjdXIgKTsKCQl9CgoJCS8vIFdhbGsgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5CgkJd2hpbGUgKCBhcFtpXSA9PT0gYnBbaV0gKSB7CgkJCWkrKzsKCQl9CgoJCXJldHVybiBpID8KCQkJLy8gRG8gYSBzaWJsaW5nIGNoZWNrIGlmIHRoZSBub2RlcyBoYXZlIGEgY29tbW9uIGFuY2VzdG9yCgkJCXNpYmxpbmdDaGVjayggYXBbaV0sIGJwW2ldICkgOgoKCQkJLy8gT3RoZXJ3aXNlIG5vZGVzIGluIG91ciBkb2N1bWVudCBzb3J0IGZpcnN0CgkJCWFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6CgkJCWJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDoKCQkJMDsKCX07CgoJcmV0dXJuIGRvYzsKfTsKClNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkgewoJcmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgZWxlbWVudHMgKTsKfTsKClNpenpsZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiggZWxlbSwgZXhwciApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJLy8gTWFrZSBzdXJlIHRoYXQgYXR0cmlidXRlIHNlbGVjdG9ycyBhcmUgcXVvdGVkCglleHByID0gZXhwci5yZXBsYWNlKCByYXR0cmlidXRlUXVvdGVzLCAiPSckMSddIiApOwoKCWlmICggc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgJiYgZG9jdW1lbnRJc0hUTUwgJiYKCQkoICFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoIGV4cHIgKSApICYmCgkJKCAhcmJ1Z2d5UVNBICAgICB8fCAhcmJ1Z2d5UVNBLnRlc3QoIGV4cHIgKSApICkgewoKCQl0cnkgewoJCQl2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKCBlbGVtLCBleHByICk7CgoJCQkvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzCgkJCWlmICggcmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwKCQkJCQkvLyBBcyB3ZWxsLCBkaXNjb25uZWN0ZWQgbm9kZXMgYXJlIHNhaWQgdG8gYmUgaW4gYSBkb2N1bWVudAoJCQkJCS8vIGZyYWdtZW50IGluIElFIDkKCQkJCQllbGVtLmRvY3VtZW50ICYmIGVsZW0uZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0gY2F0Y2ggKGUpIHt9Cgl9CgoJcmV0dXJuIFNpenpsZSggZXhwciwgZG9jdW1lbnQsIG51bGwsIFsgZWxlbSBdICkubGVuZ3RoID4gMDsKfTsKClNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCXJldHVybiBjb250YWlucyggY29udGV4dCwgZWxlbSApOwp9OwoKU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJdmFyIGZuID0gRXhwci5hdHRySGFuZGxlWyBuYW1lLnRvTG93ZXJDYXNlKCkgXSwKCQkvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoalF1ZXJ5ICMxMzgwNykKCQl2YWwgPSBmbiAmJiBoYXNPd24uY2FsbCggRXhwci5hdHRySGFuZGxlLCBuYW1lLnRvTG93ZXJDYXNlKCkgKSA/CgkJCWZuKCBlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwgKSA6CgkJCXVuZGVmaW5lZDsKCglyZXR1cm4gdmFsICE9PSB1bmRlZmluZWQgPwoJCXZhbCA6CgkJc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFkb2N1bWVudElzSFRNTCA/CgkJCWVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgOgoJCQkodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8KCQkJCXZhbC52YWx1ZSA6CgkJCQludWxsOwp9OwoKU2l6emxlLmVycm9yID0gZnVuY3Rpb24oIG1zZyApIHsKCXRocm93IG5ldyBFcnJvciggIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBtc2cgKTsKfTsKCi8qKgogKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzCiAqIEBwYXJhbSB7QXJyYXlMaWtlfSByZXN1bHRzCiAqLwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWogPSAwLAoJCWkgPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7Cglzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoIDAgKTsKCXJlc3VsdHMuc29ydCggc29ydE9yZGVyICk7CgoJaWYgKCBoYXNEdXBsaWNhdGUgKSB7CgkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCWlmICggZWxlbSA9PT0gcmVzdWx0c1sgaSBdICkgewoJCQkJaiA9IGR1cGxpY2F0ZXMucHVzaCggaSApOwoJCQl9CgkJfQoJCXdoaWxlICggai0tICkgewoJCQlyZXN1bHRzLnNwbGljZSggZHVwbGljYXRlc1sgaiBdLCAxICk7CgkJfQoJfQoKCS8vIENsZWFyIGlucHV0IGFmdGVyIHNvcnRpbmcgdG8gcmVsZWFzZSBvYmplY3RzCgkvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvcHVsbC8yMjUKCXNvcnRJbnB1dCA9IG51bGw7CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgovKioKICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXMKICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtCiAqLwpnZXRUZXh0ID0gU2l6emxlLmdldFRleHQgPSBmdW5jdGlvbiggZWxlbSApIHsKCXZhciBub2RlLAoJCXJldCA9ICIiLAoJCWkgPSAwLAoJCW5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsKCglpZiAoICFub2RlVHlwZSApIHsKCQkvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheQoJCXdoaWxlICggKG5vZGUgPSBlbGVtW2krK10pICkgewoJCQkvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2RlcwoJCQlyZXQgKz0gZ2V0VGV4dCggbm9kZSApOwoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSApIHsKCQkvLyBVc2UgdGV4dENvbnRlbnQgZm9yIGVsZW1lbnRzCgkJLy8gaW5uZXJUZXh0IHVzYWdlIHJlbW92ZWQgZm9yIGNvbnNpc3RlbmN5IG9mIG5ldyBsaW5lcyAoalF1ZXJ5ICMxMTE1MykKCQlpZiAoIHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7CgkJfSBlbHNlIHsKCQkJLy8gVHJhdmVyc2UgaXRzIGNoaWxkcmVuCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJcmV0ICs9IGdldFRleHQoIGVsZW0gKTsKCQkJfQoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgewoJCXJldHVybiBlbGVtLm5vZGVWYWx1ZTsKCX0KCS8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2RlcwoKCXJldHVybiByZXQ7Cn07CgpFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKCgkvLyBDYW4gYmUgYWRqdXN0ZWQgYnkgdGhlIHVzZXIKCWNhY2hlTGVuZ3RoOiA1MCwKCgljcmVhdGVQc2V1ZG86IG1hcmtGdW5jdGlvbiwKCgltYXRjaDogbWF0Y2hFeHByLAoKCWF0dHJIYW5kbGU6IHt9LAoKCWZpbmQ6IHt9LAoKCXJlbGF0aXZlOiB7CgkJIj4iOiB7IGRpcjogInBhcmVudE5vZGUiLCBmaXJzdDogdHJ1ZSB9LAoJCSIgIjogeyBkaXI6ICJwYXJlbnROb2RlIiB9LAoJCSIrIjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciLCBmaXJzdDogdHJ1ZSB9LAoJCSJ+IjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciIH0KCX0sCgoJcHJlRmlsdGVyOiB7CgkJIkFUVFIiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCW1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCS8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkCgkJCW1hdGNoWzNdID0gKCBtYXRjaFszXSB8fCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIiApLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgoJCQlpZiAoIG1hdGNoWzJdID09PSAifj0iICkgewoJCQkJbWF0Y2hbM10gPSAiICIgKyBtYXRjaFszXSArICIgIjsKCQkJfQoKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7CgkJfSwKCgkJIkNISUxEIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQkvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByWyJDSElMRCJdCgkJCQkxIHR5cGUgKG9ubHl8bnRofC4uLikKCQkJCTIgd2hhdCAoY2hpbGR8b2YtdHlwZSkKCQkJCTMgYXJndW1lbnQgKGV2ZW58b2RkfFxkKnxcZCpuKFsrLV1cZCspP3wuLi4pCgkJCQk0IHhuLWNvbXBvbmVudCBvZiB4bit5IGFyZ3VtZW50IChbKy1dP1xkKm58KQoJCQkJNSBzaWduIG9mIHhuLWNvbXBvbmVudAoJCQkJNiB4IG9mIHhuLWNvbXBvbmVudAoJCQkJNyBzaWduIG9mIHktY29tcG9uZW50CgkJCQk4IHkgb2YgeS1jb21wb25lbnQKCQkJKi8KCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOwoKCQkJaWYgKCBtYXRjaFsxXS5zbGljZSggMCwgMyApID09PSAibnRoIiApIHsKCQkJCS8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50CgkJCQlpZiAoICFtYXRjaFszXSApIHsKCQkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCQl9CgoJCQkJLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxECgkJCQkvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xCgkJCQltYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gImV2ZW4iIHx8IG1hdGNoWzNdID09PSAib2RkIiApICk7CgkJCQltYXRjaFs1XSA9ICsoICggbWF0Y2hbN10gKyBtYXRjaFs4XSApIHx8IG1hdGNoWzNdID09PSAib2RkIiApOwoKCQkJLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzNdICkgewoJCQkJU2l6emxlLmVycm9yKCBtYXRjaFswXSApOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2g7CgkJfSwKCgkJIlBTRVVETyI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJdmFyIGV4Y2VzcywKCQkJCXVucXVvdGVkID0gIW1hdGNoWzZdICYmIG1hdGNoWzJdOwoKCQkJaWYgKCBtYXRjaEV4cHJbIkNISUxEIl0udGVzdCggbWF0Y2hbMF0gKSApIHsKCQkJCXJldHVybiBudWxsOwoJCQl9CgoJCQkvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcwoJCQlpZiAoIG1hdGNoWzNdICkgewoJCQkJbWF0Y2hbMl0gPSBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIjsKCgkJCS8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJgoJCQkJLy8gR2V0IGV4Y2VzcyBmcm9tIHRva2VuaXplIChyZWN1cnNpdmVseSkKCQkJCShleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiYKCQkJCS8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcwoJCQkJKGV4Y2VzcyA9IHVucXVvdGVkLmluZGV4T2YoICIpIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkgewoKCQkJCS8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4CgkJCQltYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwLCBleGNlc3MgKTsKCQkJCW1hdGNoWzJdID0gdW5xdW90ZWQuc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQl9CgoJCQkvLyBSZXR1cm4gb25seSBjYXB0dXJlcyBuZWVkZWQgYnkgdGhlIHBzZXVkbyBmaWx0ZXIgbWV0aG9kICh0eXBlIGFuZCBhcmd1bWVudCkKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCAzICk7CgkJfQoJfSwKCglmaWx0ZXI6IHsKCgkJIlRBRyI6IGZ1bmN0aW9uKCBub2RlTmFtZVNlbGVjdG9yICkgewoJCQl2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5vZGVOYW1lU2VsZWN0b3IgPT09ICIqIiA/CgkJCQlmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH0gOgoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJCX07CgkJfSwKCgkJIkNMQVNTIjogZnVuY3Rpb24oIGNsYXNzTmFtZSApIHsKCQkJdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyAiICIgXTsKCgkJCXJldHVybiBwYXR0ZXJuIHx8CgkJCQkocGF0dGVybiA9IG5ldyBSZWdFeHAoICIoXnwiICsgd2hpdGVzcGFjZSArICIpIiArIGNsYXNzTmFtZSArICIoIiArIHdoaXRlc3BhY2UgKyAifCQpIiApKSAmJgoJCQkJY2xhc3NDYWNoZSggY2xhc3NOYW1lLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gcGF0dGVybi50ZXN0KCB0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09ICJzdHJpbmciICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQucmVwbGFjZSggcndoaXRlc3BhY2UsICIgIiApICsgIiAiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoKCQkJCQlvcGVyYXRvciA9PT0gInw9IiA/IHJlc3VsdCA9PT0gY2hlY2sgfHwgcmVzdWx0LnNsaWNlKCAwLCBjaGVjay5sZW5ndGggKyAxICkgPT09IGNoZWNrICsgIi0iIDoKCQkJCQlmYWxzZTsKCQkJfTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggdHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0ICkgewoJCQl2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSAibnRoIiwKCQkJCWZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSAibGFzdCIsCgkJCQlvZlR5cGUgPSB3aGF0ID09PSAib2YtdHlwZSI7CgoJCQlyZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/CgoJCQkJLy8gU2hvcnRjdXQgZm9yIDpudGgtKihuKQoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOwoJCQkJfSA6CgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQl2YXIgY2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIGRpZmYsIG5vZGVJbmRleCwgc3RhcnQsCgkJCQkJCWRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwKCQkJCQkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLAoJCQkJCQluYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKCQkJCQkJdXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGU7CgoJCQkJCWlmICggcGFyZW50ICkgewoKCQkJCQkJLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKQoJCQkJCQlpZiAoIHNpbXBsZSApIHsKCQkJCQkJCXdoaWxlICggZGlyICkgewoJCQkJCQkJCW5vZGUgPSBlbGVtOwoJCQkJCQkJCXdoaWxlICggKG5vZGUgPSBub2RlWyBkaXIgXSkgKSB7CgkJCQkJCQkJCWlmICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQkvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykKCQkJCQkJCQlzdGFydCA9IGRpciA9IHR5cGUgPT09ICJvbmx5IiAmJiAhc3RhcnQgJiYgIm5leHRTaWJsaW5nIjsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgoJCQkJCQlzdGFydCA9IFsgZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZCBdOwoKCQkJCQkJLy8gbm9uLXhtbCA6bnRoLWNoaWxkKC4uLikgc3RvcmVzIGNhY2hlIGRhdGEgb24gYHBhcmVudGAKCQkJCQkJaWYgKCBmb3J3YXJkICYmIHVzZUNhY2hlICkgewoJCQkJCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CgkJCQkJCQlvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyB0eXBlIF0gfHwgW107CgkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTsKCQkJCQkJCWRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTsKCQkJCQkJCW5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbIG5vZGVJbmRleCBdOwoKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgoJCQkJCQkJCS8vIEZhbGxiYWNrIHRvIHNlZWtpbmcgYGVsZW1gIGZyb20gdGhlIHN0YXJ0CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCS8vIFdoZW4gZm91bmQsIGNhY2hlIGluZGV4ZXMgb24gYHBhcmVudGAgYW5kIGJyZWFrCgkJCQkJCQkJaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQlvdXRlckNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZiBdOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKCQkJCQkJfSBlbHNlIGlmICggdXNlQ2FjaGUgJiYgKGNhY2hlID0gKGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdKSAmJiBjYWNoZVswXSA9PT0gZGlycnVucyApIHsKCQkJCQkJCWRpZmYgPSBjYWNoZVsxXTsKCgkJCQkJCS8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCWlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkgewoJCQkJCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CgkJCQkJCQkJCWlmICggdXNlQ2FjaGUgKSB7CgkJCQkJCQkJCQkobm9kZVsgZXhwYW5kbyBdIHx8IChub2RlWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIGRpZmYgXTsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKCBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplCgkJCQkJCWRpZmYgLT0gbGFzdDsKCQkJCQkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJfQoJCQkJfTsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7CgkJCS8vIHBzZXVkby1jbGFzcyBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZQoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzCgkJCS8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCgkJCS8vIFJlbWVtYmVyIHRoYXQgc2V0RmlsdGVycyBpbmhlcml0cyBmcm9tIHBzZXVkb3MKCQkJdmFyIGFyZ3MsCgkJCQlmbiA9IEV4cHIucHNldWRvc1sgcHNldWRvIF0gfHwgRXhwci5zZXRGaWx0ZXJzWyBwc2V1ZG8udG9Mb3dlckNhc2UoKSBdIHx8CgkJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvICk7CgoJCQkvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CgkJCS8vIGFyZ3VtZW50cyBhcmUgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgZmlsdGVyIGZ1bmN0aW9uCgkJCS8vIGp1c3QgYXMgU2l6emxlIGRvZXMKCQkJaWYgKCBmblsgZXhwYW5kbyBdICkgewoJCQkJcmV0dXJuIGZuKCBhcmd1bWVudCApOwoJCQl9CgoJCQkvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCQkJaWYgKCBmbi5sZW5ndGggPiAxICkgewoJCQkJYXJncyA9IFsgcHNldWRvLCBwc2V1ZG8sICIiLCBhcmd1bWVudCBdOwoJCQkJcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/CgkJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQkJCQl2YXIgaWR4LAoJCQkJCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLAoJCQkJCQkJaSA9IG1hdGNoZWQubGVuZ3RoOwoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlkeCA9IGluZGV4T2YoIHNlZWQsIG1hdGNoZWRbaV0gKTsKCQkJCQkJCXNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7CgkJCQkJCX0KCQkJCQl9KSA6CgkJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJCXJldHVybiBmbiggZWxlbSwgMCwgYXJncyApOwoJCQkJCX07CgkJCX0KCgkJCXJldHVybiBmbjsKCQl9Cgl9LAoKCXBzZXVkb3M6IHsKCQkvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKCQkibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKCQkJLy8gdG8gYXZvaWQgdHJlYXRpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcKCQkJLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzCgkJCXZhciBpbnB1dCA9IFtdLAoJCQkJcmVzdWx0cyA9IFtdLAoJCQkJbWF0Y2hlciA9IGNvbXBpbGUoIHNlbGVjdG9yLnJlcGxhY2UoIHJ0cmltLCAiJDEiICkgKTsKCgkJCXJldHVybiBtYXRjaGVyWyBleHBhbmRvIF0gPwoJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJdmFyIGVsZW0sCgkJCQkJCXVubWF0Y2hlZCA9IG1hdGNoZXIoIHNlZWQsIG51bGwsIHhtbCwgW10gKSwKCQkJCQkJaSA9IHNlZWQubGVuZ3RoOwoKCQkJCQkvLyBNYXRjaCBlbGVtZW50cyB1bm1hdGNoZWQgYnkgYG1hdGNoZXJgCgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQkJCQkJc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSkgOgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQlpbnB1dFswXSA9IGVsZW07CgkJCQkJbWF0Y2hlciggaW5wdXQsIG51bGwsIHhtbCwgcmVzdWx0cyApOwoJCQkJCS8vIERvbid0IGtlZXAgdGhlIGVsZW1lbnQgKGlzc3VlICMyOTkpCgkJCQkJaW5wdXRbMF0gPSBudWxsOwoJCQkJCXJldHVybiAhcmVzdWx0cy5wb3AoKTsKCQkJCX07CgkJfSksCgoJCSJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7CgkJCX07CgkJfSksCgoJCSJjb250YWlucyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggdGV4dCApIHsKCQkJdGV4dCA9IHRleHQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuICggZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KCBlbGVtICkgKS5pbmRleE9mKCB0ZXh0ICkgPiAtMTsKCQkJfTsKCQl9KSwKCgkJLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKCQkvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZQoJCS8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsCgkJLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCgkJLy8gVGhlIG1hdGNoaW5nIG9mIEMgYWdhaW5zdCB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlIGlzIHBlcmZvcm1lZCBjYXNlLWluc2Vuc2l0aXZlbHkuCgkJLy8gVGhlIGlkZW50aWZpZXIgQyBkb2VzIG5vdCBoYXZlIHRvIGJlIGEgdmFsaWQgbGFuZ3VhZ2UgbmFtZS4iCgkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwoJCSJsYW5nIjogbWFya0Z1bmN0aW9uKCBmdW5jdGlvbiggbGFuZyApIHsKCQkJLy8gbGFuZyB2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgaWRlbnRpZmllcgoJCQlpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgewoJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcgKTsKCQkJfQoJCQlsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBlbGVtTGFuZzsKCQkJCWRvIHsKCQkJCQlpZiAoIChlbGVtTGFuZyA9IGRvY3VtZW50SXNIVE1MID8KCQkJCQkJZWxlbS5sYW5nIDoKCQkJCQkJZWxlbS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgKSB7CgoJCQkJCQllbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CgkJCQkJCXJldHVybiBlbGVtTGFuZyA9PT0gbGFuZyB8fCBlbGVtTGFuZy5pbmRleE9mKCBsYW5nICsgIi0iICkgPT09IDA7CgkJCQkJfQoJCQkJfSB3aGlsZSAoIChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX07CgkJfSksCgoJCS8vIE1pc2NlbGxhbmVvdXMKCQkidGFyZ2V0IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoJCQlyZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKCAxICkgPT09IGVsZW0uaWQ7CgkJfSwKCgkJInJvb3QiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGRvY0VsZW07CgkJfSwKCgkJImZvY3VzIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7CgkJfSwKCgkJLy8gQm9vbGVhbiBwcm9wZXJ0aWVzCgkJImVuYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlOwoJCX0sCgoJCSJkaXNhYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkiY2hlY2tlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKCQkJdmFyIG5vZGVOYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5vZGVOYW1lID09PSAiaW5wdXQiICYmICEhZWxlbS5jaGVja2VkKSB8fCAobm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZCk7CgkJfSwKCgkJInNlbGVjdGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCS8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKCQkJLy8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseQoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQl9CgoJCQlyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkvLyBDb250ZW50cwoJCSJlbXB0eSI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2VtcHR5LXBzZXVkbwoJCQkvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksCgkJCS8vICAgYnV0IG5vdCBieSBvdGhlcnMgKGNvbW1lbnQ6IDg7IHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb246IDc7IGV0Yy4pCgkJCS8vIG5vZGVUeXBlIDwgNiB3b3JrcyBiZWNhdXNlIGF0dHJpYnV0ZXMgKDIpIGRvIG5vdCBhcHBlYXIgYXMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPCA2ICkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9LAoKCQkicGFyZW50IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKCBlbGVtICk7CgkJfSwKCgkJLy8gRWxlbWVudC9pbnB1dCB0eXBlcwoJCSJoZWFkZXIiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJpbnB1dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gcmlucHV0cy50ZXN0KCBlbGVtLm5vZGVOYW1lICk7CgkJfSwKCgkJImJ1dHRvbiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSAiYnV0dG9uIiB8fCBuYW1lID09PSAiYnV0dG9uIjsKCQl9LAoKCQkidGV4dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgYXR0cjsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCgkJCQkvLyBTdXBwb3J0OiBJRTw4CgkJCQkvLyBOZXcgSFRNTDUgYXR0cmlidXRlIHZhbHVlcyAoZS5nLiwgInNlYXJjaCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gInRleHQiCgkJCQkoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09ICJ0ZXh0IiApOwoJCX0sCgoJCS8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24KCQkiZmlyc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gWyAwIF07CgkJfSksCgoJCSJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXJldHVybiBbIGxlbmd0aCAtIDEgXTsKCQl9KSwKCgkJImVxIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQlyZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07CgkJfSksCgoJCSJldmVuIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXZhciBpID0gMDsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAxOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQl2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CgkJCWZvciAoIDsgLS1pID49IDA7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkiZ3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyArK2kgPCBsZW5ndGg7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pCgl9Cn07CgpFeHByLnBzZXVkb3NbIm50aCJdID0gRXhwci5wc2V1ZG9zWyJlcSJdOwoKLy8gQWRkIGJ1dHRvbi9pbnB1dCB0eXBlIHBzZXVkb3MKZm9yICggaSBpbiB7IHJhZGlvOiB0cnVlLCBjaGVja2JveDogdHJ1ZSwgZmlsZTogdHJ1ZSwgcGFzc3dvcmQ6IHRydWUsIGltYWdlOiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUlucHV0UHNldWRvKCBpICk7Cn0KZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHsKCUV4cHIucHNldWRvc1sgaSBdID0gY3JlYXRlQnV0dG9uUHNldWRvKCBpICk7Cn0KCi8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwpmdW5jdGlvbiBzZXRGaWx0ZXJzKCkge30Kc2V0RmlsdGVycy5wcm90b3R5cGUgPSBFeHByLmZpbHRlcnMgPSBFeHByLnBzZXVkb3M7CkV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7Cgp0b2tlbml6ZSA9IFNpenpsZS50b2tlbml6ZSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgcGFyc2VPbmx5ICkgewoJdmFyIG1hdGNoZWQsIG1hdGNoLCB0b2tlbnMsIHR5cGUsCgkJc29GYXIsIGdyb3VwcywgcHJlRmlsdGVycywKCQljYWNoZWQgPSB0b2tlbkNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggY2FjaGVkICkgewoJCXJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7Cgl9CgoJc29GYXIgPSBzZWxlY3RvcjsKCWdyb3VwcyA9IFtdOwoJcHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyOwoKCXdoaWxlICggc29GYXIgKSB7CgoJCS8vIENvbW1hIGFuZCBmaXJzdCBydW4KCQlpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHsKCQkJaWYgKCBtYXRjaCApIHsKCQkJCS8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCgkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaFswXS5sZW5ndGggKSB8fCBzb0ZhcjsKCQkJfQoJCQlncm91cHMucHVzaCggKHRva2VucyA9IFtdKSApOwoJCX0KCgkJbWF0Y2hlZCA9IGZhbHNlOwoKCQkvLyBDb21iaW5hdG9ycwoJCWlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkgewoJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJdG9rZW5zLnB1c2goewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9KTsKCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQl9CgoJCS8vIEZpbHRlcnMKCQlmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkgewoJCQlpZiAoIChtYXRjaCA9IG1hdGNoRXhwclsgdHlwZSBdLmV4ZWMoIHNvRmFyICkpICYmICghcHJlRmlsdGVyc1sgdHlwZSBdIHx8CgkJCQkobWF0Y2ggPSBwcmVGaWx0ZXJzWyB0eXBlIF0oIG1hdGNoICkpKSApIHsKCQkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQkJdG9rZW5zLnB1c2goewoJCQkJCXZhbHVlOiBtYXRjaGVkLAoJCQkJCXR5cGU6IHR5cGUsCgkJCQkJbWF0Y2hlczogbWF0Y2gKCQkJCX0pOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9OwoKZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJc2VsZWN0b3IgPSAiIjsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCXNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsKCX0KCXJldHVybiBzZWxlY3RvcjsKfQoKZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHsKCXZhciBkaXIgPSBjb21iaW5hdG9yLmRpciwKCQljaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwKCQlkb25lTmFtZSA9IGRvbmUrKzsKCglyZXR1cm4gY29tYmluYXRvci5maXJzdCA/CgkJLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50CgkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCXJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTsKCQkJCX0KCQkJfQoJCX0gOgoKCQkvLyBDaGVjayBhZ2FpbnN0IGFsbCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudHMKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgb2xkQ2FjaGUsIG91dGVyQ2FjaGUsCgkJCQluZXdDYWNoZSA9IFsgZGlycnVucywgZG9uZU5hbWUgXTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChvbGRDYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJgoJCQkJCQkJb2xkQ2FjaGVbIDAgXSA9PT0gZGlycnVucyAmJiBvbGRDYWNoZVsgMSBdID09PSBkb25lTmFtZSApIHsKCgkJCQkJCQkvLyBBc3NpZ24gdG8gbmV3Q2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50cwoJCQkJCQkJcmV0dXJuIChuZXdDYWNoZVsgMiBdID0gb2xkQ2FjaGVbIDIgXSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBSZXVzZSBuZXdjYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCgkJCQkJCQlvdXRlckNhY2hlWyBkaXIgXSA9IG5ld0NhY2hlOwoKCQkJCQkJCS8vIEEgbWF0Y2ggbWVhbnMgd2UncmUgZG9uZTsgYSBmYWlsIG1lYW5zIHdlIGhhdmUgdG8ga2VlcCBjaGVja2luZwoJCQkJCQkJaWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX07Cn0KCmZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsKCXJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8KCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0gOgoJCW1hdGNoZXJzWzBdOwp9CgpmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gY29udGV4dHMubGVuZ3RoOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJU2l6emxlKCBzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMgKTsKCX0KCXJldHVybiByZXN1bHRzOwp9CgpmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgewoJdmFyIGVsZW0sCgkJbmV3VW5tYXRjaGVkID0gW10sCgkJaSA9IDAsCgkJbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKCQltYXBwZWQgPSBtYXAgIT0gbnVsbDsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJaWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQluZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJaWYgKCBtYXBwZWQgKSB7CgkJCQkJbWFwLnB1c2goIGkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCglyZXR1cm4gbmV3VW5tYXRjaGVkOwp9CgpmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7CglpZiAoIHBvc3RGaWx0ZXIgJiYgIXBvc3RGaWx0ZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmlsdGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbHRlciApOwoJfQoJaWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7CgkJcG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApOwoJfQoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkgewoJCXZhciB0ZW1wLCBpLCBlbGVtLAoJCQlwcmVNYXAgPSBbXSwKCQkJcG9zdE1hcCA9IFtdLAoJCQlwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAoKCQkJLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKCQkJZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFsgY29udGV4dCBdIDogY29udGV4dCwgW10gKSwKCgkJCS8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbgoJCQltYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8KCQkJCWNvbmRlbnNlKCBlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCApIDoKCQkJCWVsZW1zLAoKCQkJbWF0Y2hlck91dCA9IG1hdGNoZXIgPwoJCQkJLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cywKCQkJCXBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID8KCgkJCQkJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CgkJCQkJW10gOgoKCQkJCQkvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkKCQkJCQlyZXN1bHRzIDoKCQkJCW1hdGNoZXJJbjsKCgkJLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMKCQlpZiAoIG1hdGNoZXIgKSB7CgkJCW1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7CgkJfQoKCQkvLyBBcHBseSBwb3N0RmlsdGVyCgkJaWYgKCBwb3N0RmlsdGVyICkgewoJCQl0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTsKCQkJcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOwoKCQkJLy8gVW4tbWF0Y2ggZmFpbGluZyBlbGVtZW50cyBieSBtb3ZpbmcgdGhlbSBiYWNrIHRvIG1hdGNoZXJJbgoJCQlpID0gdGVtcC5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJaWYgKCAoZWxlbSA9IHRlbXBbaV0pICkgewoJCQkJCW1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKCBzZWVkICkgewoJCQlpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkgewoJCQkJaWYgKCBwb3N0RmluZGVyICkgewoJCQkJCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwoJCQkJCXRlbXAgPSBbXTsKCQkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHsKCQkJCQkJCS8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoCgkJCQkJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsKCQkJCX0KCgkJCQkvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZAoJCQkJaSA9IG1hdGNoZXJPdXQubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmCgkJCQkJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YoIHNlZWQsIGVsZW0gKSA6IHByZU1hcFtpXSkgPiAtMSApIHsKCgkJCQkJCXNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJLy8gQWRkIGVsZW1lbnRzIHRvIHJlc3VsdHMsIHRocm91Z2ggcG9zdEZpbmRlciBpZiBkZWZpbmVkCgkJfSBlbHNlIHsKCQkJbWF0Y2hlck91dCA9IGNvbmRlbnNlKAoJCQkJbWF0Y2hlck91dCA9PT0gcmVzdWx0cyA/CgkJCQkJbWF0Y2hlck91dC5zcGxpY2UoIHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCApIDoKCQkJCQltYXRjaGVyT3V0CgkJCSk7CgkJCWlmICggcG9zdEZpbmRlciApIHsKCQkJCXBvc3RGaW5kZXIoIG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCApOwoJCQl9IGVsc2UgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApOwoJCQl9CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMgKSB7Cgl2YXIgY2hlY2tDb250ZXh0LCBtYXRjaGVyLCBqLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzBdLnR5cGUgXSwKCQlpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKCQlpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsCgoJCS8vIFRoZSBmb3VuZGF0aW9uYWwgbWF0Y2hlciBlbnN1cmVzIHRoYXQgZWxlbWVudHMgYXJlIHJlYWNoYWJsZSBmcm9tIHRvcC1sZXZlbCBjb250ZXh0KHMpCgkJbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7CgkJfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLAoJCW1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gaW5kZXhPZiggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciByZXQgPSAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJCS8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KQoJCQljaGVja0NvbnRleHQgPSBudWxsOwoJCQlyZXR1cm4gcmV0OwoJCX0gXTsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7CgkJCW1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdOwoJCX0gZWxzZSB7CgkJCW1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTsKCgkJCS8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyCgkJCWlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgewoJCQkJLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nCgkJCQlqID0gKytpOwoJCQkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gc2V0TWF0Y2hlcigKCQkJCQlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwKCQkJCQlpID4gMSAmJiB0b1NlbGVjdG9yKAoJCQkJCQkvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYAoJCQkJCQl0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSAiICIgPyAiKiIgOiAiIiB9KQoJCQkJCSkucmVwbGFjZSggcnRyaW0sICIkMSIgKSwKCQkJCQltYXRjaGVyLAoJCQkJCWkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLAoJCQkJCWogPCBsZW4gJiYgbWF0Y2hlckZyb21Ub2tlbnMoICh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoIGogKSkgKSwKCQkJCQlqIDwgbGVuICYmIHRvU2VsZWN0b3IoIHRva2VucyApCgkJCQkpOwoJCQl9CgkJCW1hdGNoZXJzLnB1c2goIG1hdGNoZXIgKTsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSB7Cgl2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAoJCWJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAoJCXN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3Igb3V0ZXJtb3N0IGNvbnRleHQKCQkJCWVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBvdXRlcm1vc3QgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSwKCQkJCWxlbiA9IGVsZW1zLmxlbmd0aDsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJLy8gU3VwcG9ydDogSUU8OSwgU2FmYXJpCgkJCS8vIFRvbGVyYXRlIE5vZGVMaXN0IHByb3BlcnRpZXMgKElFOiAibGVuZ3RoIjsgU2FmYXJpOiA8bnVtYmVyPikgbWF0Y2hpbmcgZWxlbWVudHMgYnkgaWQKCQkJZm9yICggOyBpICE9PSBsZW4gJiYgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQkJaWYgKCBieUVsZW1lbnQgJiYgZWxlbSApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkgewoJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIG1hdGNoIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFtYXRjaCApIHsKCQkJbWF0Y2ggPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IG1hdGNoLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIG1hdGNoW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7CgoJCS8vIFNhdmUgc2VsZWN0b3IgYW5kIHRva2VuaXphdGlvbgoJCWNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yOwoJfQoJcmV0dXJuIGNhY2hlZDsKfTsKCi8qKgogKiBBIGxvdy1sZXZlbCBzZWxlY3Rpb24gZnVuY3Rpb24gdGhhdCB3b3JrcyB3aXRoIFNpenpsZSdzIGNvbXBpbGVkCiAqICBzZWxlY3RvciBmdW5jdGlvbnMKICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IHNlbGVjdG9yIEEgc2VsZWN0b3Igb3IgYSBwcmUtY29tcGlsZWQKICogIHNlbGVjdG9yIGZ1bmN0aW9uIGJ1aWx0IHdpdGggU2l6emxlLmNvbXBpbGUKICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0CiAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHRzXQogKiBAcGFyYW0ge0FycmF5fSBbc2VlZF0gQSBzZXQgb2YgZWxlbWVudHMgdG8gbWF0Y2ggYWdhaW5zdAogKi8Kc2VsZWN0ID0gU2l6emxlLnNlbGVjdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCWNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICYmIHNlbGVjdG9yLAoJCW1hdGNoID0gIXNlZWQgJiYgdG9rZW5pemUoIChzZWxlY3RvciA9IGNvbXBpbGVkLnNlbGVjdG9yIHx8IHNlbGVjdG9yKSApOwoKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoKCS8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG5vIHNlZWQgYW5kIG9ubHkgb25lIGdyb3VwCglpZiAoIG1hdGNoLmxlbmd0aCA9PT0gMSApIHsKCgkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQl0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwICk7CgkJaWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09ICJJRCIgJiYKCQkJCXN1cHBvcnQuZ2V0QnlJZCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSA5ICYmIGRvY3VtZW50SXNIVE1MICYmCgkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJY29udGV4dCA9ICggRXhwci5maW5kWyJJRCJdKCB0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCBjb250ZXh0ICkgfHwgW10gKVswXTsKCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbAoJCQl9IGVsc2UgaWYgKCBjb21waWxlZCApIHsKCQkJCWNvbnRleHQgPSBjb250ZXh0LnBhcmVudE5vZGU7CgkJCX0KCgkJCXNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApOwoJCX0KCgkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCWkgPSBtYXRjaEV4cHJbIm5lZWRzQ29udGV4dCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yCgkJCWlmICggRXhwci5yZWxhdGl2ZVsgKHR5cGUgPSB0b2tlbi50eXBlKSBdICkgewoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAoZmluZCA9IEV4cHIuZmluZFsgdHlwZSBdKSApIHsKCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJaWYgKCAoc2VlZCA9IGZpbmQoCgkJCQkJdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLAoJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHQKCQkJCSkpICkgewoKCQkJCQkvLyBJZiBzZWVkIGlzIGVtcHR5IG9yIG5vIHRva2VucyByZW1haW4sIHdlIGNhbiByZXR1cm4gZWFybHkKCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJc2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKTsKCQkJCQlpZiAoICFzZWxlY3RvciApIHsKCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2VlZCApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24gaWYgb25lIGlzIG5vdCBwcm92aWRlZAoJLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZQoJKCBjb21waWxlZCB8fCBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSApKAoJCXNlZWQsCgkJY29udGV4dCwKCQkhZG9jdW1lbnRJc0hUTUwsCgkJcmVzdWx0cywKCQlyc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0CgkpOwoJcmV0dXJuIHJlc3VsdHM7Cn07CgovLyBPbmUtdGltZSBhc3NpZ25tZW50cwoKLy8gU29ydCBzdGFiaWxpdHkKc3VwcG9ydC5zb3J0U3RhYmxlID0gZXhwYW5kby5zcGxpdCgiIikuc29ydCggc29ydE9yZGVyICkuam9pbigiIikgPT09IGV4cGFuZG87CgovLyBTdXBwb3J0OiBDaHJvbWUgMTQtMzUrCi8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24Kc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7CgovLyBJbml0aWFsaXplIGFnYWluc3QgdGhlIGRlZmF1bHQgZG9jdW1lbnQKc2V0RG9jdW1lbnQoKTsKCi8vIFN1cHBvcnQ6IFdlYmtpdDw1MzcuMzIgLSBTYWZhcmkgNi4wLjMvQ2hyb21lIDI1IChmaXhlZCBpbiBDaHJvbWUgMjcpCi8vIERldGFjaGVkIG5vZGVzIGNvbmZvdW5kaW5nbHkgZm9sbG93ICplYWNoIG90aGVyKgpzdXBwb3J0LnNvcnREZXRhY2hlZCA9IGFzc2VydChmdW5jdGlvbiggZGl2MSApIHsKCS8vIFNob3VsZCByZXR1cm4gMSwgYnV0IHJldHVybnMgNCAoZm9sbG93aW5nKQoJcmV0dXJuIGRpdjEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpICkgJiAxOwp9KTsKCi8vIFN1cHBvcnQ6IElFPDgKLy8gUHJldmVudCBhdHRyaWJ1dGUvcHJvcGVydHkgImludGVycG9sYXRpb24iCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJcmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiIyIgOwp9KSApIHsKCWFkZEhhbmRsZSggInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSAidHlwZSIgPyAxIDogMiApOwoJCX0KCX0pOwp9CgovLyBTdXBwb3J0OiBJRTw5Ci8vIFVzZSBkZWZhdWx0VmFsdWUgaW4gcGxhY2Ugb2YgZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpCmlmICggIXN1cHBvcnQuYXR0cmlidXRlcyB8fCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxpbnB1dC8+IjsKCWRpdi5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSggInZhbHVlIiwgIiIgKTsKCXJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoICJ2YWx1ZSIgKSA9PT0gIiI7Cn0pICkgewoJYWRkSGFuZGxlKCAidmFsdWUiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICkgewoJCQlyZXR1cm4gZWxlbS5kZWZhdWx0VmFsdWU7CgkJfQoJfSk7Cn0KCi8vIFN1cHBvcnQ6IElFPDkKLy8gVXNlIGdldEF0dHJpYnV0ZU5vZGUgdG8gZmV0Y2ggYm9vbGVhbnMgd2hlbiBnZXRBdHRyaWJ1dGUgbGllcwppZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCXJldHVybiBkaXYuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09IG51bGw7Cn0pICkgewoJYWRkSGFuZGxlKCBib29sZWFucywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCXZhciB2YWw7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtWyBuYW1lIF0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCSh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSkgJiYgdmFsLnNwZWNpZmllZCA/CgkJCQkJdmFsLnZhbHVlIDoKCQkJCW51bGw7CgkJfQoJfSk7Cn0KCnJldHVybiBTaXp6bGU7Cgp9KSggd2luZG93ICk7CgoKCmpRdWVyeS5maW5kID0gU2l6emxlOwpqUXVlcnkuZXhwciA9IFNpenpsZS5zZWxlY3RvcnM7CmpRdWVyeS5leHByWyI6Il0gPSBqUXVlcnkuZXhwci5wc2V1ZG9zOwpqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7CmpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7CmpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDsKalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zOwoKCgp2YXIgcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dDsKCnZhciByc2luZ2xlVGFnID0gKC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8pOwoKCgp2YXIgcmlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLzsKCi8vIEltcGxlbWVudCB0aGUgaWRlbnRpY2FsIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbHRlciBhbmQgbm90CmZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwgbm90ICkgewoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7CgkJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCS8qIGpzaGludCAtVzAxOCAqLwoJCQlyZXR1cm4gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApICE9PSBub3Q7CgkJfSk7CgoJfQoKCWlmICggcXVhbGlmaWVyLm5vZGVUeXBlICkgewoJCXJldHVybiBqUXVlcnkuZ3JlcCggZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSAhPT0gbm90OwoJCX0pOwoKCX0KCglpZiAoIHR5cGVvZiBxdWFsaWZpZXIgPT09ICJzdHJpbmciICkgewoJCWlmICggcmlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBlbGVtZW50cywgbm90ICk7CgkJfQoKCQlxdWFsaWZpZXIgPSBqUXVlcnkuZmlsdGVyKCBxdWFsaWZpZXIsIGVsZW1lbnRzICk7Cgl9CgoJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuICggaW5kZXhPZi5jYWxsKCBxdWFsaWZpZXIsIGVsZW0gKSA+PSAwICkgIT09IG5vdDsKCX0pOwp9CgpqUXVlcnkuZmlsdGVyID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7Cgl2YXIgZWxlbSA9IGVsZW1zWyAwIF07CgoJaWYgKCBub3QgKSB7CgkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJfQoKCXJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSA/CgkJalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKCBlbGVtLCBleHByICkgPyBbIGVsZW0gXSA6IFtdIDoKCQlqUXVlcnkuZmluZC5tYXRjaGVzKCBleHByLCBqUXVlcnkuZ3JlcCggZWxlbXMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMTsKCQl9KSk7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgaSwKCQkJbGVuID0gdGhpcy5sZW5ndGgsCgkJCXJldCA9IFtdLAoJCQlzZWxmID0gdGhpczsKCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCBzZWxmWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgPyB0aGlzLnNlbGVjdG9yICsgIiAiICsgc2VsZWN0b3IgOiBzZWxlY3RvcjsKCQlyZXR1cm4gcmV0OwoJfSwKCWZpbHRlcjogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yIHx8IFtdLCBmYWxzZSkgKTsKCX0sCglub3Q6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciB8fCBbXSwgdHJ1ZSkgKTsKCX0sCglpczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiAhIXdpbm5vdygKCQkJdGhpcywKCgkJCS8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQKCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQl0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICYmIHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSA/CgkJCQlqUXVlcnkoIHNlbGVjdG9yICkgOgoJCQkJc2VsZWN0b3IgfHwgW10sCgkJCWZhbHNlCgkJKS5sZW5ndGg7Cgl9Cn0pOwoKCi8vIEluaXRpYWxpemUgYSBqUXVlcnkgb2JqZWN0CgoKLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCnZhciByb290alF1ZXJ5LAoKCS8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzCgkvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpCgkvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkKCXJxdWlja0V4cHIgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLAoKCWluaXQgPSBqUXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQl2YXIgbWF0Y2gsIGVsZW07CgoJCS8vIEhBTkRMRTogJCgiIiksICQobnVsbCksICQodW5kZWZpbmVkKSwgJChmYWxzZSkKCQlpZiAoICFzZWxlY3RvciApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICkgewoJCQlpZiAoIHNlbGVjdG9yWzBdID09PSAiPCIgJiYgc2VsZWN0b3JbIHNlbGVjdG9yLmxlbmd0aCAtIDEgXSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gT3B0aW9uIHRvIHJ1biBzY3JpcHRzIGlzIHRydWUgZm9yIGJhY2stY29tcGF0CgkJCQkJLy8gSW50ZW50aW9uYWxseSBsZXQgdGhlIGVycm9yIGJlIHRocm93biBpZiBwYXJzZUhUTUwgaXMgbm90IHByZXNlbnQKCQkJCQlqUXVlcnkubWVyZ2UoIHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwoCgkJCQkJCW1hdGNoWzFdLAoJCQkJCQljb250ZXh0ICYmIGNvbnRleHQubm9kZVR5cGUgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IGRvY3VtZW50LAoJCQkJCQl0cnVlCgkJCQkJKSApOwoKCQkJCQkvLyBIQU5ETEU6ICQoaHRtbCwgcHJvcHMpCgkJCQkJaWYgKCByc2luZ2xlVGFnLnRlc3QoIG1hdGNoWzFdICkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvbnRleHQgKSApIHsKCQkJCQkJZm9yICggbWF0Y2ggaW4gY29udGV4dCApIHsKCQkJCQkJCS8vIFByb3BlcnRpZXMgb2YgY29udGV4dCBhcmUgY2FsbGVkIGFzIG1ldGhvZHMgaWYgcG9zc2libGUKCQkJCQkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHRoaXNbIG1hdGNoIF0gKSApIHsKCQkJCQkJCQl0aGlzWyBtYXRjaCBdKCBjb250ZXh0WyBtYXRjaCBdICk7CgoJCQkJCQkJLy8gLi4uYW5kIG90aGVyd2lzZSBzZXQgYXMgYXR0cmlidXRlcwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmF0dHIoIG1hdGNoLCBjb250ZXh0WyBtYXRjaCBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiB0aGlzOwoKCQkJCS8vIEhBTkRMRTogJCgjaWQpCgkJCQl9IGVsc2UgewoJCQkJCWVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbWF0Y2hbMl0gKTsKCgkJCQkJLy8gU3VwcG9ydDogQmxhY2tiZXJyeSA0LjYKCQkJCQkvLyBnRUJJRCByZXR1cm5zIG5vZGVzIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKCM2OTYzKQoJCQkJCWlmICggZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQkJCS8vIEluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgkJCQkJCXRoaXMubGVuZ3RoID0gMTsKCQkJCQkJdGhpc1swXSA9IGVsZW07CgkJCQkJfQoKCQkJCQl0aGlzLmNvbnRleHQgPSBkb2N1bWVudDsKCQkJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQoJCQl9IGVsc2UgaWYgKCAhY29udGV4dCB8fCBjb250ZXh0LmpxdWVyeSApIHsKCQkJCXJldHVybiAoIGNvbnRleHQgfHwgcm9vdGpRdWVyeSApLmZpbmQoIHNlbGVjdG9yICk7CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgY29udGV4dCkKCQkJLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpCgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciggY29udGV4dCApLmZpbmQoIHNlbGVjdG9yICk7CgkJCX0KCgkJLy8gSEFORExFOiAkKERPTUVsZW1lbnQpCgkJfSBlbHNlIGlmICggc2VsZWN0b3Iubm9kZVR5cGUgKSB7CgkJCXRoaXMuY29udGV4dCA9IHRoaXNbMF0gPSBzZWxlY3RvcjsKCQkJdGhpcy5sZW5ndGggPSAxOwoJCQlyZXR1cm4gdGhpczsKCgkJLy8gSEFORExFOiAkKGZ1bmN0aW9uKQoJCS8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQoJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkgewoJCQlyZXR1cm4gdHlwZW9mIHJvb3RqUXVlcnkucmVhZHkgIT09ICJ1bmRlZmluZWQiID8KCQkJCXJvb3RqUXVlcnkucmVhZHkoIHNlbGVjdG9yICkgOgoJCQkJLy8gRXhlY3V0ZSBpbW1lZGlhdGVseSBpZiByZWFkeSBpcyBub3QgcHJlc2VudAoJCQkJc2VsZWN0b3IoIGpRdWVyeSApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmluaXQucHJvdG90eXBlID0galF1ZXJ5LmZuOwoKLy8gSW5pdGlhbGl6ZSBjZW50cmFsIHJlZmVyZW5jZQpyb290alF1ZXJ5ID0galF1ZXJ5KCBkb2N1bWVudCApOwoKCnZhciBycGFyZW50c3ByZXYgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywKCS8vIE1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5leHRlbmQoewoJZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdLAoJCQl0cnVuY2F0ZSA9IHVudGlsICE9PSB1bmRlZmluZWQ7CgoJCXdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgJiYgZWxlbS5ub2RlVHlwZSAhPT0gOSApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJaWYgKCB0cnVuY2F0ZSAmJiBqUXVlcnkoIGVsZW0gKS5pcyggdW50aWwgKSApIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCW1hdGNoZWQucHVzaCggZWxlbSApOwoJCQl9CgkJfQoJCXJldHVybiBtYXRjaGVkOwoJfSwKCglzaWJsaW5nOiBmdW5jdGlvbiggbiwgZWxlbSApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdOwoKCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCQlpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHsKCQkJCW1hdGNoZWQucHVzaCggbiApOwoJCQl9CgkJfQoKCQlyZXR1cm4gbWF0Y2hlZDsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWhhczogZnVuY3Rpb24oIHRhcmdldCApIHsKCQl2YXIgdGFyZ2V0cyA9IGpRdWVyeSggdGFyZ2V0LCB0aGlzICksCgkJCWwgPSB0YXJnZXRzLmxlbmd0aDsKCgkJcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQl2YXIgaSA9IDA7CgkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJY2xvc2VzdDogZnVuY3Rpb24oIHNlbGVjdG9ycywgY29udGV4dCApIHsKCQl2YXIgY3VyLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQltYXRjaGVkID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlmb3IgKCBjdXIgPSB0aGlzW2ldOyBjdXIgJiYgY3VyICE9PSBjb250ZXh0OyBjdXIgPSBjdXIucGFyZW50Tm9kZSApIHsKCQkJCS8vIEFsd2F5cyBza2lwIGRvY3VtZW50IGZyYWdtZW50cwoJCQkJaWYgKCBjdXIubm9kZVR5cGUgPCAxMSAmJiAocG9zID8KCQkJCQlwb3MuaW5kZXgoY3VyKSA+IC0xIDoKCgkJCQkJLy8gRG9uJ3QgcGFzcyBub24tZWxlbWVudHMgdG8gU2l6emxlCgkJCQkJY3VyLm5vZGVUeXBlID09PSAxICYmCgkJCQkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihjdXIsIHNlbGVjdG9ycykpICkgewoKCQkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIG1hdGNoZWQubGVuZ3RoID4gMSA/IGpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKSA6IG1hdGNoZWQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbiB0aGUgc2V0CglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1sgMCBdICYmIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOwoJCX0KCgkJLy8gSW5kZXggaW4gc2VsZWN0b3IKCQlpZiAoIHR5cGVvZiBlbGVtID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggalF1ZXJ5KCBlbGVtICksIHRoaXNbIDAgXSApOwoJCX0KCgkJLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50CgkJcmV0dXJuIGluZGV4T2YuY2FsbCggdGhpcywKCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bIDAgXSA6IGVsZW0KCQkpOwoJfSwKCglhZGQ6IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soCgkJCWpRdWVyeS51bmlxdWUoCgkJCQlqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSApCgkJCSkKCQkpOwoJfSwKCglhZGRCYWNrOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihzZWxlY3RvcikKCQkpOwoJfQp9KTsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJd2hpbGUgKCAoY3VyID0gY3VyW2Rpcl0pICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApIHt9CglyZXR1cm4gY3VyOwp9CgpqUXVlcnkuZWFjaCh7CglwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDsKCX0sCglwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiICk7Cgl9LAoJcGFyZW50c1VudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwYXJlbnROb2RlIiwgdW50aWwgKTsKCX0sCgluZXh0OiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZyggZWxlbSwgIm5leHRTaWJsaW5nIiApOwoJfSwKCXByZXY6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiApOwoJfSwKCW5leHRBbGw6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dFVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsICk7Cgl9LAoJcHJldlVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciLCB1bnRpbCApOwoJfSwKCXNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoICggZWxlbS5wYXJlbnROb2RlIHx8IHt9ICkuZmlyc3RDaGlsZCwgZWxlbSApOwoJfSwKCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApOwoJfSwKCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7Cgl9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQl2YXIgbWF0Y2hlZCA9IGpRdWVyeS5tYXAoIHRoaXMsIGZuLCB1bnRpbCApOwoKCQlpZiAoIG5hbWUuc2xpY2UoIC01ICkgIT09ICJVbnRpbCIgKSB7CgkJCXNlbGVjdG9yID0gdW50aWw7CgkJfQoKCQlpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgkJCW1hdGNoZWQgPSBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgbWF0Y2hlZCApOwoJCX0KCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgKSB7CgkJCS8vIFJlbW92ZSBkdXBsaWNhdGVzCgkJCWlmICggIWd1YXJhbnRlZWRVbmlxdWVbIG5hbWUgXSApIHsKCQkJCWpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKTsKCQkJfQoKCQkJLy8gUmV2ZXJzZSBvcmRlciBmb3IgcGFyZW50cyogYW5kIHByZXYtZGVyaXZhdGl2ZXMKCQkJaWYgKCBycGFyZW50c3ByZXYudGVzdCggbmFtZSApICkgewoJCQkJbWF0Y2hlZC5yZXZlcnNlKCk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggbWF0Y2hlZCApOwoJfTsKfSk7CnZhciBybm90d2hpdGUgPSAoL1xTKy9nKTsKCgoKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdLCBmdW5jdGlvbiggXywgZmxhZyApIHsKCQlvYmplY3RbIGZsYWcgXSA9IHRydWU7Cgl9KTsKCXJldHVybiBvYmplY3Q7Cn0KCi8qCiAqIENyZWF0ZSBhIGNhbGxiYWNrIGxpc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgogKgogKglvcHRpb25zOiBhbiBvcHRpb25hbCBsaXN0IG9mIHNwYWNlLXNlcGFyYXRlZCBvcHRpb25zIHRoYXQgd2lsbCBjaGFuZ2UgaG93CiAqCQkJdGhlIGNhbGxiYWNrIGxpc3QgYmVoYXZlcyBvciBhIG1vcmUgdHJhZGl0aW9uYWwgb3B0aW9uIG9iamVjdAogKgogKiBCeSBkZWZhdWx0IGEgY2FsbGJhY2sgbGlzdCB3aWxsIGFjdCBsaWtlIGFuIGV2ZW50IGNhbGxiYWNrIGxpc3QgYW5kIGNhbiBiZQogKiAiZmlyZWQiIG11bHRpcGxlIHRpbWVzLgogKgogKiBQb3NzaWJsZSBvcHRpb25zOgogKgogKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJbWVtb3J5OgkJCXdpbGwga2VlcCB0cmFjayBvZiBwcmV2aW91cyB2YWx1ZXMgYW5kIHdpbGwgY2FsbCBhbnkgY2FsbGJhY2sgYWRkZWQKICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiCiAqCQkJCQl2YWx1ZXMgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQogKgogKglzdG9wT25GYWxzZToJaW50ZXJydXB0IGNhbGxpbmdzIHdoZW4gYSBjYWxsYmFjayByZXR1cm5zIGZhbHNlCiAqCiAqLwpqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgoJLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZAoJLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KQoJb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/CgkJKCBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSB8fCBjcmVhdGVPcHRpb25zKCBvcHRpb25zICkgKSA6CgkJalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsKCgl2YXIgLy8gTGFzdCBmaXJlIHZhbHVlIChmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzKQoJCW1lbW9yeSwKCQkvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCB3YXMgYWxyZWFkeSBmaXJlZAoJCWZpcmVkLAoJCS8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IGlzIGN1cnJlbnRseSBmaXJpbmcKCQlmaXJpbmcsCgkJLy8gRmlyc3QgY2FsbGJhY2sgdG8gZmlyZSAodXNlZCBpbnRlcm5hbGx5IGJ5IGFkZCBhbmQgZmlyZVdpdGgpCgkJZmlyaW5nU3RhcnQsCgkJLy8gRW5kIG9mIHRoZSBsb29wIHdoZW4gZmlyaW5nCgkJZmlyaW5nTGVuZ3RoLAoJCS8vIEluZGV4IG9mIGN1cnJlbnRseSBmaXJpbmcgY2FsbGJhY2sgKG1vZGlmaWVkIGJ5IHJlbW92ZSBpZiBuZWVkZWQpCgkJZmlyaW5nSW5kZXgsCgkJLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3QKCQlsaXN0ID0gW10sCgkJLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0cwoJCXN0YWNrID0gIW9wdGlvbnMub25jZSAmJiBbXSwKCQkvLyBGaXJlIGNhbGxiYWNrcwoJCWZpcmUgPSBmdW5jdGlvbiggZGF0YSApIHsKCQkJbWVtb3J5ID0gb3B0aW9ucy5tZW1vcnkgJiYgZGF0YTsKCQkJZmlyZWQgPSB0cnVlOwoJCQlmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7CgkJCWZpcmluZ1N0YXJ0ID0gMDsKCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCWZpcmluZyA9IHRydWU7CgkJCWZvciAoIDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKyApIHsKCQkJCWlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggZGF0YVsgMCBdLCBkYXRhWyAxIF0gKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSApIHsKCQkJCQltZW1vcnkgPSBmYWxzZTsgLy8gVG8gcHJldmVudCBmdXJ0aGVyIGNhbGxzIHVzaW5nIGFkZAoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWZpcmluZyA9IGZhbHNlOwoJCQlpZiAoIGxpc3QgKSB7CgkJCQlpZiAoIHN0YWNrICkgewoJCQkJCWlmICggc3RhY2subGVuZ3RoICkgewoJCQkJCQlmaXJlKCBzdGFjay5zaGlmdCgpICk7CgkJCQkJfQoJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCWxpc3QgPSBbXTsKCQkJCX0gZWxzZSB7CgkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQl9CgkJCX0KCQl9LAoJCS8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0CgkJc2VsZiA9IHsKCQkJLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdAoJCQlhZGQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCS8vIEZpcnN0LCB3ZSBzYXZlIHRoZSBjdXJyZW50IGxlbmd0aAoJCQkJCXZhciBzdGFydCA9IGxpc3QubGVuZ3RoOwoJCQkJCShmdW5jdGlvbiBhZGQoIGFyZ3MgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCBhcmdzLCBmdW5jdGlvbiggXywgYXJnICkgewoJCQkJCQkJdmFyIHR5cGUgPSBqUXVlcnkudHlwZSggYXJnICk7CgkJCQkJCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQkJCQkJaWYgKCAhb3B0aW9ucy51bmlxdWUgfHwgIXNlbGYuaGFzKCBhcmcgKSApIHsKCQkJCQkJCQkJbGlzdC5wdXNoKCBhcmcgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgaWYgKCBhcmcgJiYgYXJnLmxlbmd0aCAmJiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJCQkJCQkvLyBJbnNwZWN0IHJlY3Vyc2l2ZWx5CgkJCQkJCQkJYWRkKCBhcmcgKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSkoIGFyZ3VtZW50cyApOwoJCQkJCS8vIERvIHdlIG5lZWQgdG8gYWRkIHRoZSBjYWxsYmFja3MgdG8gdGhlCgkJCQkJLy8gY3VycmVudCBmaXJpbmcgYmF0Y2g/CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCWZpcmluZ0xlbmd0aCA9IGxpc3QubGVuZ3RoOwoJCQkJCS8vIFdpdGggbWVtb3J5LCBpZiB3ZSdyZSBub3QgZmlyaW5nIHRoZW4KCQkJCQkvLyB3ZSBzaG91bGQgY2FsbCByaWdodCBhd2F5CgkJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCQlmaXJpbmdTdGFydCA9IHN0YXJ0OwoJCQkJCQlmaXJlKCBtZW1vcnkgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gUmVtb3ZlIGEgY2FsbGJhY2sgZnJvbSB0aGUgbGlzdAoJCQlyZW1vdmU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCWpRdWVyeS5lYWNoKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCXZhciBpbmRleDsKCQkJCQkJd2hpbGUgKCAoIGluZGV4ID0galF1ZXJ5LmluQXJyYXkoIGFyZywgbGlzdCwgaW5kZXggKSApID4gLTEgKSB7CgkJCQkJCQlsaXN0LnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCQkJCS8vIEhhbmRsZSBmaXJpbmcgaW5kZXhlcwoJCQkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdMZW5ndGggKSB7CgkJCQkJCQkJCWZpcmluZ0xlbmd0aC0tOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoIGluZGV4IDw9IGZpcmluZ0luZGV4ICkgewoJCQkJCQkJCQlmaXJpbmdJbmRleC0tOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENoZWNrIGlmIGEgZ2l2ZW4gY2FsbGJhY2sgaXMgaW4gdGhlIGxpc3QuCgkJCS8vIElmIG5vIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gd2hldGhlciBvciBub3QgbGlzdCBoYXMgY2FsbGJhY2tzIGF0dGFjaGVkLgoJCQloYXM6IGZ1bmN0aW9uKCBmbiApIHsKCQkJCXJldHVybiBmbiA/IGpRdWVyeS5pbkFycmF5KCBmbiwgbGlzdCApID4gLTEgOiAhISggbGlzdCAmJiBsaXN0Lmxlbmd0aCApOwoJCQl9LAoJCQkvLyBSZW1vdmUgYWxsIGNhbGxiYWNrcyBmcm9tIHRoZSBsaXN0CgkJCWVtcHR5OiBmdW5jdGlvbigpIHsKCQkJCWxpc3QgPSBbXTsKCQkJCWZpcmluZ0xlbmd0aCA9IDA7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQkJYXJncyA9IFsgY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3MgXTsKCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJc3RhY2sucHVzaCggYXJncyApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWZpcmUoIGFyZ3MgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKCQkJZmlyZTogZnVuY3Rpb24oKSB7CgkJCQlzZWxmLmZpcmVXaXRoKCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBUbyBrbm93IGlmIHRoZSBjYWxsYmFja3MgaGF2ZSBhbHJlYWR5IGJlZW4gY2FsbGVkIGF0IGxlYXN0IG9uY2UKCQkJZmlyZWQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICEhZmlyZWQ7CgkJCX0KCQl9OwoKCXJldHVybiBzZWxmOwp9OwoKCmpRdWVyeS5leHRlbmQoewoKCURlZmVycmVkOiBmdW5jdGlvbiggZnVuYyApIHsKCQl2YXIgdHVwbGVzID0gWwoJCQkJLy8gYWN0aW9uLCBhZGQgbGlzdGVuZXIsIGxpc3RlbmVyIGxpc3QsIGZpbmFsIHN0YXRlCgkJCQlbICJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiIF0sCgkJCQlbICJyZWplY3QiLCAiZmFpbCIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZWplY3RlZCIgXSwKCQkJCVsgIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpIF0KCQkJXSwKCQkJc3RhdGUgPSAicGVuZGluZyIsCgkJCXByb21pc2UgPSB7CgkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJfSwKCQkJCWFsd2F5czogZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoJCQkJdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgewoJCQkJCXZhciBmbnMgPSBhcmd1bWVudHM7CgkJCQkJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCB0dXBsZXMsIGZ1bmN0aW9uKCBpLCB0dXBsZSApIHsKCQkJCQkJCXZhciBmbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBmbnNbIGkgXSApICYmIGZuc1sgaSBdOwoJCQkJCQkJLy8gZGVmZXJyZWRbIGRvbmUgfCBmYWlsIHwgcHJvZ3Jlc3MgXSBmb3IgZm9yd2FyZGluZyBhY3Rpb25zIHRvIG5ld0RlZmVyCgkJCQkJCQlkZWZlcnJlZFsgdHVwbGVbMV0gXShmdW5jdGlvbigpIHsKCQkJCQkJCQl2YXIgcmV0dXJuZWQgPSBmbiAmJiBmbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQkJCQkJaWYgKCByZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmV0dXJuZWQucHJvbWlzZSApICkgewoJCQkJCQkJCQlyZXR1cm5lZC5wcm9taXNlKCkKCQkJCQkJCQkJCS5kb25lKCBuZXdEZWZlci5yZXNvbHZlICkKCQkJCQkJCQkJCS5mYWlsKCBuZXdEZWZlci5yZWplY3QgKQoJCQkJCQkJCQkJLnByb2dyZXNzKCBuZXdEZWZlci5ub3RpZnkgKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQluZXdEZWZlclsgdHVwbGVbIDAgXSArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWxlbmd0aCA9IHJlc29sdmVWYWx1ZXMubGVuZ3RoLAoKCQkJLy8gdGhlIGNvdW50IG9mIHVuY29tcGxldGVkIHN1Ym9yZGluYXRlcwoJCQlyZW1haW5pbmcgPSBsZW5ndGggIT09IDEgfHwgKCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggc3Vib3JkaW5hdGUucHJvbWlzZSApICkgPyBsZW5ndGggOiAwLAoKCQkJLy8gdGhlIG1hc3RlciBEZWZlcnJlZC4gSWYgcmVzb2x2ZVZhbHVlcyBjb25zaXN0IG9mIG9ubHkgYSBzaW5nbGUgRGVmZXJyZWQsIGp1c3QgdXNlIHRoYXQuCgkJCWRlZmVycmVkID0gcmVtYWluaW5nID09PSAxID8gc3Vib3JkaW5hdGUgOiBqUXVlcnkuRGVmZXJyZWQoKSwKCgkJCS8vIFVwZGF0ZSBmdW5jdGlvbiBmb3IgYm90aCByZXNvbHZlIGFuZCBwcm9ncmVzcyB2YWx1ZXMKCQkJdXBkYXRlRnVuYyA9IGZ1bmN0aW9uKCBpLCBjb250ZXh0cywgdmFsdWVzICkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCQljb250ZXh0c1sgaSBdID0gdGhpczsKCQkJCQl2YWx1ZXNbIGkgXSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gc2xpY2UuY2FsbCggYXJndW1lbnRzICkgOiB2YWx1ZTsKCQkJCQlpZiAoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBBZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CgoKLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5CnZhciByZWFkeUxpc3Q7CgpqUXVlcnkuZm4ucmVhZHkgPSBmdW5jdGlvbiggZm4gKSB7CgkvLyBBZGQgdGhlIGNhbGxiYWNrCglqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJcmV0dXJuIHRoaXM7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIElzIHRoZSBET00gcmVhZHkgdG8gYmUgdXNlZD8gU2V0IHRvIHRydWUgb25jZSBpdCBvY2N1cnMuCglpc1JlYWR5OiBmYWxzZSwKCgkvLyBBIGNvdW50ZXIgdG8gdHJhY2sgaG93IG1hbnkgaXRlbXMgdG8gd2FpdCBmb3IgYmVmb3JlCgkvLyB0aGUgcmVhZHkgZXZlbnQgZmlyZXMuIFNlZSAjNjc4MQoJcmVhZHlXYWl0OiAxLAoKCS8vIEhvbGQgKG9yIHJlbGVhc2UpIHRoZSByZWFkeSBldmVudAoJaG9sZFJlYWR5OiBmdW5jdGlvbiggaG9sZCApIHsKCQlpZiAoIGhvbGQgKSB7CgkJCWpRdWVyeS5yZWFkeVdhaXQrKzsKCQl9IGVsc2UgewoJCQlqUXVlcnkucmVhZHkoIHRydWUgKTsKCQl9Cgl9LAoKCS8vIEhhbmRsZSB3aGVuIHRoZSBET00gaXMgcmVhZHkKCXJlYWR5OiBmdW5jdGlvbiggd2FpdCApIHsKCgkJLy8gQWJvcnQgaWYgdGhlcmUgYXJlIHBlbmRpbmcgaG9sZHMgb3Igd2UncmUgYWxyZWFkeSByZWFkeQoJCWlmICggd2FpdCA9PT0gdHJ1ZSA/IC0talF1ZXJ5LnJlYWR5V2FpdCA6IGpRdWVyeS5pc1JlYWR5ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkKCQlqUXVlcnkuaXNSZWFkeSA9IHRydWU7CgoJCS8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlCgkJaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKCQlyZWFkeUxpc3QucmVzb2x2ZVdpdGgoIGRvY3VtZW50LCBbIGpRdWVyeSBdICk7CgoJCS8vIFRyaWdnZXIgYW55IGJvdW5kIHJlYWR5IGV2ZW50cwoJCWlmICggalF1ZXJ5LmZuLnRyaWdnZXJIYW5kbGVyICkgewoJCQlqUXVlcnkoIGRvY3VtZW50ICkudHJpZ2dlckhhbmRsZXIoICJyZWFkeSIgKTsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLm9mZiggInJlYWR5IiApOwoJCX0KCX0KfSk7CgovKioKICogVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIgYW5kIHNlbGYgY2xlYW51cCBtZXRob2QKICovCmZ1bmN0aW9uIGNvbXBsZXRlZCgpIHsKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJalF1ZXJ5LnJlYWR5KCk7Cn0KCmpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oIG9iaiApIHsKCWlmICggIXJlYWR5TGlzdCApIHsKCgkJcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7CgoJCS8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZSBicm93c2VyIGV2ZW50IGhhcyBhbHJlYWR5IG9jY3VycmVkLgoJCS8vIFdlIG9uY2UgdHJpZWQgdG8gdXNlIHJlYWR5U3RhdGUgImludGVyYWN0aXZlIiBoZXJlLCBidXQgaXQgY2F1c2VkIGlzc3VlcyBsaWtlIHRoZSBvbmUKCQkvLyBkaXNjb3ZlcmVkIGJ5IENocmlzUyBoZXJlOiBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMjI4MiNjb21tZW50OjE1CgkJaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQkvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKCQkJc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5ICk7CgoJCX0gZWxzZSB7CgoJCQkvLyBVc2UgdGhlIGhhbmR5IGV2ZW50IGNhbGxiYWNrCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJCX0KCX0KCXJldHVybiByZWFkeUxpc3QucHJvbWlzZSggb2JqICk7Cn07CgovLyBLaWNrIG9mZiB0aGUgRE9NIHJlYWR5IGNoZWNrIGV2ZW4gaWYgdGhlIHVzZXIgZG9lcyBub3QKalF1ZXJ5LnJlYWR5LnByb21pc2UoKTsKCgoKCi8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgovLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb24KdmFyIGFjY2VzcyA9IGpRdWVyeS5hY2Nlc3MgPSBmdW5jdGlvbiggZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gZWxlbXMubGVuZ3RoLAoJCWJ1bGsgPSBrZXkgPT0gbnVsbDsKCgkvLyBTZXRzIG1hbnkgdmFsdWVzCglpZiAoIGpRdWVyeS50eXBlKCBrZXkgKSA9PT0gIm9iamVjdCIgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCQlmb3IgKCBpIGluIGtleSApIHsKCQkJalF1ZXJ5LmFjY2VzcyggZWxlbXMsIGZuLCBpLCBrZXlbaV0sIHRydWUsIGVtcHR5R2V0LCByYXcgKTsKCQl9CgoJLy8gU2V0cyBvbmUgdmFsdWUKCX0gZWxzZSBpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJhdyA9IHRydWU7CgkJfQoKCQlpZiAoIGJ1bGsgKSB7CgkJCS8vIEJ1bGsgb3BlcmF0aW9ucyBydW4gYWdhaW5zdCB0aGUgZW50aXJlIHNldAoJCQlpZiAoIHJhdyApIHsKCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJZm4gPSBudWxsOwoKCQkJLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcwoJCQl9IGVsc2UgewoJCQkJYnVsayA9IGZuOwoJCQkJZm4gPSBmdW5jdGlvbiggZWxlbSwga2V5LCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCX07CgkJCX0KCQl9CgoJCWlmICggZm4gKSB7CgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQl9CgkJfQoJfQoKCXJldHVybiBjaGFpbmFibGUgPwoJCWVsZW1zIDoKCgkJLy8gR2V0cwoJCWJ1bGsgPwoJCQlmbi5jYWxsKCBlbGVtcyApIDoKCQkJbGVuID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0Owp9OwoKCi8qKgogKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gb2JqZWN0IGNhbiBoYXZlIGRhdGEKICovCmpRdWVyeS5hY2NlcHREYXRhID0gZnVuY3Rpb24oIG93bmVyICkgewoJLy8gQWNjZXB0cyBvbmx5OgoJLy8gIC0gTm9kZQoJLy8gICAgLSBOb2RlLkVMRU1FTlRfTk9ERQoJLy8gICAgLSBOb2RlLkRPQ1VNRU5UX05PREUKCS8vICAtIE9iamVjdAoJLy8gICAgLSBBbnkKCS8qIGpzaGludCAtVzAxOCAqLwoJcmV0dXJuIG93bmVyLm5vZGVUeXBlID09PSAxIHx8IG93bmVyLm5vZGVUeXBlID09PSA5IHx8ICEoICtvd25lci5ub2RlVHlwZSApOwp9OwoKCmZ1bmN0aW9uIERhdGEoKSB7CgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQsCgkvLyBPbGQgV2ViS2l0IGRvZXMgbm90IGhhdmUgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zL2ZyZWV6ZSBtZXRob2QsCgkvLyByZXR1cm4gbmV3IGVtcHR5IG9iamVjdCBpbnN0ZWFkIHdpdGggbm8gW1tzZXRdXSBhY2Nlc3NvcgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLmNhY2hlID0ge30sIDAsIHsKCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4ge307CgkJfQoJfSk7CgoJdGhpcy5leHBhbmRvID0galF1ZXJ5LmV4cGFuZG8gKyBEYXRhLnVpZCsrOwp9CgpEYXRhLnVpZCA9IDE7CkRhdGEuYWNjZXB0cyA9IGpRdWVyeS5hY2NlcHREYXRhOwoKRGF0YS5wcm90b3R5cGUgPSB7CglrZXk6IGZ1bmN0aW9uKCBvd25lciApIHsKCQkvLyBXZSBjYW4gYWNjZXB0IGRhdGEgZm9yIG5vbi1lbGVtZW50IG5vZGVzIGluIG1vZGVybiBicm93c2VycywKCQkvLyBidXQgd2Ugc2hvdWxkIG5vdCwgc2VlICM4MzM1LgoJCS8vIEFsd2F5cyByZXR1cm4gdGhlIGtleSBmb3IgYSBmcm96ZW4gb2JqZWN0LgoJCWlmICggIURhdGEuYWNjZXB0cyggb3duZXIgKSApIHsKCQkJcmV0dXJuIDA7CgkJfQoKCQl2YXIgZGVzY3JpcHRvciA9IHt9LAoJCQkvLyBDaGVjayBpZiB0aGUgb3duZXIgb2JqZWN0IGFscmVhZHkgaGFzIGEgY2FjaGUga2V5CgkJCXVubG9jayA9IG93bmVyWyB0aGlzLmV4cGFuZG8gXTsKCgkJLy8gSWYgbm90LCBjcmVhdGUgb25lCgkJaWYgKCAhdW5sb2NrICkgewoJCQl1bmxvY2sgPSBEYXRhLnVpZCsrOwoKCQkJLy8gU2VjdXJlIGl0IGluIGEgbm9uLWVudW1lcmFibGUsIG5vbi13cml0YWJsZSBwcm9wZXJ0eQoJCQl0cnkgewoJCQkJZGVzY3JpcHRvclsgdGhpcy5leHBhbmRvIF0gPSB7IHZhbHVlOiB1bmxvY2sgfTsKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBvd25lciwgZGVzY3JpcHRvciApOwoKCQkJLy8gU3VwcG9ydDogQW5kcm9pZDw0CgkJCS8vIEZhbGxiYWNrIHRvIGEgbGVzcyBzZWN1cmUgZGVmaW5pdGlvbgoJCQl9IGNhdGNoICggZSApIHsKCQkJCWRlc2NyaXB0b3JbIHRoaXMuZXhwYW5kbyBdID0gdW5sb2NrOwoJCQkJalF1ZXJ5LmV4dGVuZCggb3duZXIsIGRlc2NyaXB0b3IgKTsKCQkJfQoJCX0KCgkJLy8gRW5zdXJlIHRoZSBjYWNoZSBvYmplY3QKCQlpZiAoICF0aGlzLmNhY2hlWyB1bmxvY2sgXSApIHsKCQkJdGhpcy5jYWNoZVsgdW5sb2NrIF0gPSB7fTsKCQl9CgoJCXJldHVybiB1bmxvY2s7Cgl9LAoJc2V0OiBmdW5jdGlvbiggb3duZXIsIGRhdGEsIHZhbHVlICkgewoJCXZhciBwcm9wLAoJCQkvLyBUaGVyZSBtYXkgYmUgYW4gdW5sb2NrIGFzc2lnbmVkIHRvIHRoaXMgbm9kZSwKCQkJLy8gaWYgdGhlcmUgaXMgbm8gZW50cnkgZm9yIHRoaXMgIm93bmVyIiwgY3JlYXRlIG9uZSBpbmxpbmUKCQkJLy8gYW5kIHNldCB0aGUgdW5sb2NrIGFzIHRob3VnaCBhbiBvd25lciBlbnRyeSBoYWQgYWx3YXlzIGV4aXN0ZWQKCQkJdW5sb2NrID0gdGhpcy5rZXkoIG93bmVyICksCgkJCWNhY2hlID0gdGhpcy5jYWNoZVsgdW5sb2NrIF07CgoJCS8vIEhhbmRsZTogWyBvd25lciwga2V5LCB2YWx1ZSBdIGFyZ3MKCQlpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsKCQkJY2FjaGVbIGRhdGEgXSA9IHZhbHVlOwoKCQkvLyBIYW5kbGU6IFsgb3duZXIsIHsgcHJvcGVydGllcyB9IF0gYXJncwoJCX0gZWxzZSB7CgkJCS8vIEZyZXNoIGFzc2lnbm1lbnRzIGJ5IG9iamVjdCBhcmUgc2hhbGxvdyBjb3BpZWQKCQkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggY2FjaGUgKSApIHsKCQkJCWpRdWVyeS5leHRlbmQoIHRoaXMuY2FjaGVbIHVubG9jayBdLCBkYXRhICk7CgkJCS8vIE90aGVyd2lzZSwgY29weSB0aGUgcHJvcGVydGllcyBvbmUtYnktb25lIHRvIHRoZSBjYWNoZSBvYmplY3QKCQkJfSBlbHNlIHsKCQkJCWZvciAoIHByb3AgaW4gZGF0YSApIHsKCQkJCQljYWNoZVsgcHJvcCBdID0gZGF0YVsgcHJvcCBdOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjYWNoZTsKCX0sCglnZXQ6IGZ1bmN0aW9uKCBvd25lciwga2V5ICkgewoJCS8vIEVpdGhlciBhIHZhbGlkIGNhY2hlIGlzIGZvdW5kLCBvciB3aWxsIGJlIGNyZWF0ZWQuCgkJLy8gTmV3IGNhY2hlcyB3aWxsIGJlIGNyZWF0ZWQgYW5kIHRoZSB1bmxvY2sgcmV0dXJuZWQsCgkJLy8gYWxsb3dpbmcgZGlyZWN0IGFjY2VzcyB0byB0aGUgbmV3bHkgY3JlYXRlZAoJCS8vIGVtcHR5IGRhdGEgb2JqZWN0LiBBIHZhbGlkIG93bmVyIG9iamVjdCBtdXN0IGJlIHByb3ZpZGVkLgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGVbIHRoaXMua2V5KCBvd25lciApIF07CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCA/CgkJCWNhY2hlIDogY2FjaGVbIGtleSBdOwoJfSwKCWFjY2VzczogZnVuY3Rpb24oIG93bmVyLCBrZXksIHZhbHVlICkgewoJCXZhciBzdG9yZWQ7CgkJLy8gSW4gY2FzZXMgd2hlcmUgZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBObyBrZXkgd2FzIHNwZWNpZmllZAoJCS8vICAgMi4gQSBzdHJpbmcga2V5IHdhcyBzcGVjaWZpZWQsIGJ1dCBubyB2YWx1ZSBwcm92aWRlZAoJCS8vCgkJLy8gVGFrZSB0aGUgInJlYWQiIHBhdGggYW5kIGFsbG93IHRoZSBnZXQgbWV0aG9kIHRvIGRldGVybWluZQoJCS8vIHdoaWNoIHZhbHVlIHRvIHJldHVybiwgcmVzcGVjdGl2ZWx5IGVpdGhlcjoKCQkvLwoJCS8vICAgMS4gVGhlIGVudGlyZSBjYWNoZSBvYmplY3QKCQkvLyAgIDIuIFRoZSBkYXRhIHN0b3JlZCBhdCB0aGUga2V5CgkJLy8KCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkIHx8CgkJCQkoKGtleSAmJiB0eXBlb2Yga2V5ID09PSAic3RyaW5nIikgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCkgKSB7CgoJCQlzdG9yZWQgPSB0aGlzLmdldCggb3duZXIsIGtleSApOwoKCQkJcmV0dXJuIHN0b3JlZCAhPT0gdW5kZWZpbmVkID8KCQkJCXN0b3JlZCA6IHRoaXMuZ2V0KCBvd25lciwgalF1ZXJ5LmNhbWVsQ2FzZShrZXkpICk7CgkJfQoKCQkvLyBbKl1XaGVuIHRoZSBrZXkgaXMgbm90IGEgc3RyaW5nLCBvciBib3RoIGEga2V5IGFuZCB2YWx1ZQoJCS8vIGFyZSBzcGVjaWZpZWQsIHNldCBvciBleHRlbmQgKGV4aXN0aW5nIG9iamVjdHMpIHdpdGggZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBBbiBvYmplY3Qgb2YgcHJvcGVydGllcwoJCS8vICAgMi4gQSBrZXkgYW5kIHZhbHVlCgkJLy8KCQl0aGlzLnNldCggb3duZXIsIGtleSwgdmFsdWUgKTsKCgkJLy8gU2luY2UgdGhlICJzZXQiIHBhdGggY2FuIGhhdmUgdHdvIHBvc3NpYmxlIGVudHJ5IHBvaW50cwoJCS8vIHJldHVybiB0aGUgZXhwZWN0ZWQgZGF0YSBiYXNlZCBvbiB3aGljaCBwYXRoIHdhcyB0YWtlblsqXQoJCXJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiBrZXk7Cgl9LAoJcmVtb3ZlOiBmdW5jdGlvbiggb3duZXIsIGtleSApIHsKCQl2YXIgaSwgbmFtZSwgY2FtZWwsCgkJCXVubG9jayA9IHRoaXMua2V5KCBvd25lciApLAoJCQljYWNoZSA9IHRoaXMuY2FjaGVbIHVubG9jayBdOwoKCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLmNhY2hlWyB1bmxvY2sgXSA9IHt9OwoKCQl9IGVsc2UgewoJCQkvLyBTdXBwb3J0IGFycmF5IG9yIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgb2Yga2V5cwoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBrZXkgKSApIHsKCQkJCS8vIElmICJuYW1lIiBpcyBhbiBhcnJheSBvZiBrZXlzLi4uCgkJCQkvLyBXaGVuIGRhdGEgaXMgaW5pdGlhbGx5IGNyZWF0ZWQsIHZpYSAoImtleSIsICJ2YWwiKSBzaWduYXR1cmUsCgkJCQkvLyBrZXlzIHdpbGwgYmUgY29udmVydGVkIHRvIGNhbWVsQ2FzZS4KCQkJCS8vIFNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byB0ZWxsIF9ob3dfIGEga2V5IHdhcyBhZGRlZCwgcmVtb3ZlCgkJCQkvLyBib3RoIHBsYWluIGtleSBhbmQgY2FtZWxDYXNlIGtleS4gIzEyNzg2CgkJCQkvLyBUaGlzIHdpbGwgb25seSBwZW5hbGl6ZSB0aGUgYXJyYXkgYXJndW1lbnQgcGF0aC4KCQkJCW5hbWUgPSBrZXkuY29uY2F0KCBrZXkubWFwKCBqUXVlcnkuY2FtZWxDYXNlICkgKTsKCQkJfSBlbHNlIHsKCQkJCWNhbWVsID0galF1ZXJ5LmNhbWVsQ2FzZSgga2V5ICk7CgkJCQkvLyBUcnkgdGhlIHN0cmluZyBhcyBhIGtleSBiZWZvcmUgYW55IG1hbmlwdWxhdGlvbgoJCQkJaWYgKCBrZXkgaW4gY2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsga2V5LCBjYW1lbCBdOwoJCQkJfSBlbHNlIHsKCQkJCQkvLyBJZiBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzLCB1c2UgaXQuCgkJCQkJLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYW4gYXJyYXkgYnkgbWF0Y2hpbmcgbm9uLXdoaXRlc3BhY2UKCQkJCQluYW1lID0gY2FtZWw7CgkJCQkJbmFtZSA9IG5hbWUgaW4gY2FjaGUgPwoJCQkJCQlbIG5hbWUgXSA6ICggbmFtZS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW10gKTsKCQkJCX0KCQkJfQoKCQkJaSA9IG5hbWUubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWRlbGV0ZSBjYWNoZVsgbmFtZVsgaSBdIF07CgkJCX0KCQl9Cgl9LAoJaGFzRGF0YTogZnVuY3Rpb24oIG93bmVyICkgewoJCXJldHVybiAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoCgkJCXRoaXMuY2FjaGVbIG93bmVyWyB0aGlzLmV4cGFuZG8gXSBdIHx8IHt9CgkJKTsKCX0sCglkaXNjYXJkOiBmdW5jdGlvbiggb3duZXIgKSB7CgkJaWYgKCBvd25lclsgdGhpcy5leHBhbmRvIF0gKSB7CgkJCWRlbGV0ZSB0aGlzLmNhY2hlWyBvd25lclsgdGhpcy5leHBhbmRvIF0gXTsKCQl9Cgl9Cn07CnZhciBkYXRhX3ByaXYgPSBuZXcgRGF0YSgpOwoKdmFyIGRhdGFfdXNlciA9IG5ldyBEYXRhKCk7CgoKCi8vCUltcGxlbWVudGF0aW9uIFN1bW1hcnkKLy8KLy8JMS4gRW5mb3JjZSBBUEkgc3VyZmFjZSBhbmQgc2VtYW50aWMgY29tcGF0aWJpbGl0eSB3aXRoIDEuOS54IGJyYW5jaAovLwkyLiBJbXByb3ZlIHRoZSBtb2R1bGUncyBtYWludGFpbmFiaWxpdHkgYnkgcmVkdWNpbmcgdGhlIHN0b3JhZ2UKLy8JCXBhdGhzIHRvIGEgc2luZ2xlIG1lY2hhbmlzbS4KLy8JMy4gVXNlIHRoZSBzYW1lIHNpbmdsZSBtZWNoYW5pc20gdG8gc3VwcG9ydCAicHJpdmF0ZSIgYW5kICJ1c2VyIiBkYXRhLgovLwk0LiBfTmV2ZXJfIGV4cG9zZSAicHJpdmF0ZSIgZGF0YSB0byB1c2VyIGNvZGUgKFRPRE86IERyb3AgX2RhdGEsIF9yZW1vdmVEYXRhKQovLwk1LiBBdm9pZCBleHBvc2luZyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIG9uIHVzZXIgb2JqZWN0cyAoZWcuIGV4cGFuZG8gcHJvcGVydGllcykKLy8JNi4gUHJvdmlkZSBhIGNsZWFyIHBhdGggZm9yIGltcGxlbWVudGF0aW9uIHVwZ3JhZGUgdG8gV2Vha01hcCBpbiAyMDE0Cgp2YXIgcmJyYWNlID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywKCXJtdWx0aURhc2ggPSAvKFtBLVpdKS9nOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCXZhciBuYW1lOwoKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQluYW1lID0gImRhdGEtIiArIGtleS5yZXBsYWNlKCBybXVsdGlEYXNoLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7CgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCWRhdGE7CgkJCX0gY2F0Y2goIGUgKSB7fQoKCQkJLy8gTWFrZSBzdXJlIHdlIHNldCB0aGUgZGF0YSBzbyBpdCBpc24ndCBjaGFuZ2VkIGxhdGVyCgkJCWRhdGFfdXNlci5zZXQoIGVsZW0sIGtleSwgZGF0YSApOwoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoJcmV0dXJuIGRhdGE7Cn0KCmpRdWVyeS5leHRlbmQoewoJaGFzRGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5oYXNEYXRhKCBlbGVtICkgfHwgZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5hY2Nlc3MoIGVsZW0sIG5hbWUsIGRhdGEgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJZGF0YV91c2VyLnJlbW92ZSggZWxlbSwgbmFtZSApOwoJfSwKCgkvLyBUT0RPOiBOb3cgdGhhdCBhbGwgY2FsbHMgdG8gX2RhdGEgYW5kIF9yZW1vdmVEYXRhIGhhdmUgYmVlbiByZXBsYWNlZAoJLy8gd2l0aCBkaXJlY3QgY2FsbHMgdG8gZGF0YV9wcml2IG1ldGhvZHMsIHRoZXNlIGNhbiBiZSBkZXByZWNhdGVkLgoJX2RhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkgewoJCXJldHVybiBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBuYW1lLCBkYXRhICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCBuYW1lICk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgaSwgbmFtZSwgZGF0YSwKCQkJZWxlbSA9IHRoaXNbIDAgXSwKCQkJYXR0cnMgPSBlbGVtICYmIGVsZW0uYXR0cmlidXRlczsKCgkJLy8gR2V0cyBhbGwgdmFsdWVzCgkJaWYgKCBrZXkgPT09IHVuZGVmaW5lZCApIHsKCQkJaWYgKCB0aGlzLmxlbmd0aCApIHsKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtICk7CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFkYXRhX3ByaXYuZ2V0KCBlbGVtLCAiaGFzRGF0YUF0dHJzIiApICkgewoJCQkJCWkgPSBhdHRycy5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgoJCQkJCQkvLyBTdXBwb3J0OiBJRTExKwoJCQkJCQkvLyBUaGUgYXR0cnMgZWxlbWVudHMgY2FuIGJlIG51bGwgKCMxNDg5NCkKCQkJCQkJaWYgKCBhdHRyc1sgaSBdICkgewoJCQkJCQkJbmFtZSA9IGF0dHJzWyBpIF0ubmFtZTsKCQkJCQkJCWlmICggbmFtZS5pbmRleE9mKCAiZGF0YS0iICkgPT09IDAgKSB7CgkJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCQkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJZGF0YV9wcml2LnNldCggZWxlbSwgImhhc0RhdGFBdHRycyIsIHRydWUgKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGRhdGE7CgkJfQoKCQkvLyBTZXRzIG11bHRpcGxlIHZhbHVlcwoJCWlmICggdHlwZW9mIGtleSA9PT0gIm9iamVjdCIgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlkYXRhX3VzZXIuc2V0KCB0aGlzLCBrZXkgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBkYXRhLAoJCQkJY2FtZWxLZXkgPSBqUXVlcnkuY2FtZWxDYXNlKCBrZXkgKTsKCgkJCS8vIFRoZSBjYWxsaW5nIGpRdWVyeSBvYmplY3QgKGVsZW1lbnQgbWF0Y2hlcykgaXMgbm90IGVtcHR5CgkJCS8vIChhbmQgdGhlcmVmb3JlIGhhcyBhbiBlbGVtZW50IGFwcGVhcnMgYXQgdGhpc1sgMCBdKSBhbmQgdGhlCgkJCS8vIGB2YWx1ZWAgcGFyYW1ldGVyIHdhcyBub3QgdW5kZWZpbmVkLiBBbiBlbXB0eSBqUXVlcnkgb2JqZWN0CgkJCS8vIHdpbGwgcmVzdWx0IGluIGB1bmRlZmluZWRgIGZvciBlbGVtID0gdGhpc1sgMCBdIHdoaWNoIHdpbGwKCQkJLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFuIGF0dGVtcHQgdG8gcmVhZCBhIGRhdGEgY2FjaGUgaXMgbWFkZS4KCQkJaWYgKCBlbGVtICYmIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBBdHRlbXB0IHRvIGdldCBkYXRhIGZyb20gdGhlIGNhY2hlCgkJCQkvLyB3aXRoIHRoZSBrZXkgYXMtaXMKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBrZXkgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIEF0dGVtcHQgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgY2FjaGUKCQkJCS8vIHdpdGggdGhlIGtleSBjYW1lbGl6ZWQKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBjYW1lbEtleSApOwoJCQkJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9CgoJCQkJLy8gQXR0ZW1wdCB0byAiZGlzY292ZXIiIHRoZSBkYXRhIGluCgkJCQkvLyBIVE1MNSBjdXN0b20gZGF0YS0qIGF0dHJzCgkJCQlkYXRhID0gZGF0YUF0dHIoIGVsZW0sIGNhbWVsS2V5LCB1bmRlZmluZWQgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIFdlIHRyaWVkIHJlYWxseSBoYXJkLCBidXQgdGhlIGRhdGEgZG9lc24ndCBleGlzdC4KCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU2V0IHRoZSBkYXRhLi4uCgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCS8vIEZpcnN0LCBhdHRlbXB0IHRvIHN0b3JlIGEgY29weSBvciByZWZlcmVuY2Ugb2YgYW55CgkJCQkvLyBkYXRhIHRoYXQgbWlnaHQndmUgYmVlbiBzdG9yZSB3aXRoIGEgY2FtZWxDYXNlZCBrZXkuCgkJCQl2YXIgZGF0YSA9IGRhdGFfdXNlci5nZXQoIHRoaXMsIGNhbWVsS2V5ICk7CgoJCQkJLy8gRm9yIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGUgaW50ZXJvcCwgd2UgaGF2ZSB0bwoJCQkJLy8gc3RvcmUgcHJvcGVydHkgbmFtZXMgd2l0aCBkYXNoZXMgaW4gYSBjYW1lbENhc2UgZm9ybS4KCQkJCS8vIFRoaXMgbWlnaHQgbm90IGFwcGx5IHRvIGFsbCBwcm9wZXJ0aWVzLi4uKgoJCQkJZGF0YV91c2VyLnNldCggdGhpcywgY2FtZWxLZXksIHZhbHVlICk7CgoJCQkJLy8gKi4uLiBJbiB0aGUgY2FzZSBvZiBwcm9wZXJ0aWVzIHRoYXQgbWlnaHQgX2FjdHVhbGx5XwoJCQkJLy8gaGF2ZSBkYXNoZXMsIHdlIG5lZWQgdG8gYWxzbyBzdG9yZSBhIGNvcHkgb2YgdGhhdAoJCQkJLy8gdW5jaGFuZ2VkIHByb3BlcnR5LgoJCQkJaWYgKCBrZXkuaW5kZXhPZigiLSIpICE9PSAtMSAmJiBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJZGF0YV91c2VyLnNldCggdGhpcywga2V5LCB2YWx1ZSApOwoJCQkJfQoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlkYXRhX3VzZXIucmVtb3ZlKCB0aGlzLCBrZXkgKTsKCQl9KTsKCX0KfSk7CgoKalF1ZXJ5LmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHF1ZXVlOwoKCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgInF1ZXVlIjsKCQkJcXVldWUgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KCBkYXRhICkgKSB7CgkJCQkJcXVldWUgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gQ2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBOb3QgcHVibGljIC0gZ2VuZXJhdGUgYSBxdWV1ZUhvb2tzIG9iamVjdCwgb3IgcmV0dXJuIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBkYXRhX3ByaXYuZ2V0KCBlbGVtLCBrZXkgKSB8fCBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBrZXksIHsKCQkJZW1wdHk6IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uKCkgewoJCQkJZGF0YV9wcml2LnJlbW92ZSggZWxlbSwgWyB0eXBlICsgInF1ZXVlIiwga2V5IF0gKTsKCQkJfSkKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQl2YXIgc2V0dGVyID0gMjsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWRhdGEgPSB0eXBlOwoJCQl0eXBlID0gImZ4IjsKCQkJc2V0dGVyLS07CgkJfQoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPCBzZXR0ZXIgKSB7CgkJCXJldHVybiBqUXVlcnkucXVldWUoIHRoaXNbMF0sIHR5cGUgKTsKCQl9CgoJCXJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPwoJCQl0aGlzIDoKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBkYXRhICk7CgoJCQkJLy8gRW5zdXJlIGEgaG9va3MgZm9yIHRoaXMgcXVldWUKCQkJCWpRdWVyeS5fcXVldWVIb29rcyggdGhpcywgdHlwZSApOwoKCQkJCWlmICggdHlwZSA9PT0gImZ4IiAmJiBxdWV1ZVswXSAhPT0gImlucHJvZ3Jlc3MiICkgewoJCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCQl9CgkJCX0pOwoJfSwKCWRlcXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJfSk7Cgl9LAoJY2xlYXJRdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJcmV0dXJuIHRoaXMucXVldWUoIHR5cGUgfHwgImZ4IiwgW10gKTsKCX0sCgkvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlCgkvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkKCXByb21pc2U6IGZ1bmN0aW9uKCB0eXBlLCBvYmogKSB7CgkJdmFyIHRtcCwKCQkJY291bnQgPSAxLAoJCQlkZWZlciA9IGpRdWVyeS5EZWZlcnJlZCgpLAoJCQllbGVtZW50cyA9IHRoaXMsCgkJCWkgPSB0aGlzLmxlbmd0aCwKCQkJcmVzb2x2ZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhKCAtLWNvdW50ICkgKSB7CgkJCQkJZGVmZXIucmVzb2x2ZVdpdGgoIGVsZW1lbnRzLCBbIGVsZW1lbnRzIF0gKTsKCQkJCX0KCQkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCW9iaiA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXdoaWxlICggaS0tICkgewoJCQl0bXAgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBwbnVtID0gKC9bKy1dPyg/OlxkKlwufClcZCsoPzpbZUVdWystXT9cZCt8KS8pLnNvdXJjZTsKCnZhciBjc3NFeHBhbmQgPSBbICJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiIF07Cgp2YXIgaXNIaWRkZW4gPSBmdW5jdGlvbiggZWxlbSwgZWwgKSB7CgkJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCQkvLyBpbiB0aGF0IGNhc2UsIGVsZW1lbnQgd2lsbCBiZSBzZWNvbmQgYXJndW1lbnQKCQllbGVtID0gZWwgfHwgZWxlbTsKCQlyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCX07Cgp2YXIgcmNoZWNrYWJsZVR5cGUgPSAoL14oPzpjaGVja2JveHxyYWRpbykkL2kpOwoKCgooZnVuY3Rpb24oKSB7Cgl2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJZGl2ID0gZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKSwKCQlpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCgkvLyBTdXBwb3J0OiBTYWZhcmk8PTUuMQoJLy8gQ2hlY2sgc3RhdGUgbG9zdCBpZiB0aGUgbmFtZSBpcyBzZXQgKCMxMTIxNykKCS8vIFN1cHBvcnQ6IFdpbmRvd3MgV2ViIEFwcHMgKFdXQSkKCS8vIGBuYW1lYCBhbmQgYHR5cGVgIG11c3QgdXNlIC5zZXRBdHRyaWJ1dGUgZm9yIFdXQSAoIzE0OTAxKQoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggImNoZWNrZWQiLCAiY2hlY2tlZCIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggIm5hbWUiLCAidCIgKTsKCglkaXYuYXBwZW5kQ2hpbGQoIGlucHV0ICk7CgoJLy8gU3VwcG9ydDogU2FmYXJpPD01LjEsIEFuZHJvaWQ8NC4yCgkvLyBPbGRlciBXZWJLaXQgZG9lc24ndCBjbG9uZSBjaGVja2VkIHN0YXRlIGNvcnJlY3RseSBpbiBmcmFnbWVudHMKCXN1cHBvcnQuY2hlY2tDbG9uZSA9IGRpdi5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAoJZGl2LmlubmVySFRNTCA9ICI8dGV4dGFyZWE+eDwvdGV4dGFyZWE+IjsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSAhIWRpdi5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuZGVmYXVsdFZhbHVlOwp9KSgpOwp2YXIgc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZDsKCgoKc3VwcG9ydC5mb2N1c2luQnViYmxlcyA9ICJvbmZvY3VzaW4iIGluIHdpbmRvdzsKCgp2YXIKCXJrZXlFdmVudCA9IC9ea2V5LywKCXJtb3VzZUV2ZW50ID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51KXxjbGljay8sCglyZm9jdXNNb3JwaCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywKCXJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkkLzsKCmZ1bmN0aW9uIHJldHVyblRydWUoKSB7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIHNhZmVBY3RpdmVFbGVtZW50KCkgewoJdHJ5IHsKCQlyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCX0gY2F0Y2ggKCBlcnIgKSB7IH0KfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoKCQl2YXIgaGFuZGxlT2JqSW4sIGV2ZW50SGFuZGxlLCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2LmdldCggZWxlbSApOwoKCQkvLyBEb24ndCBhdHRhY2ggZXZlbnRzIHRvIG5vRGF0YSBvciB0ZXh0L2NvbW1lbnQgbm9kZXMgKGJ1dCBhbGxvdyBwbGFpbiBvYmplY3RzKQoJCWlmICggIWVsZW1EYXRhICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKCQlpZiAoIGhhbmRsZXIuaGFuZGxlciApIHsKCQkJaGFuZGxlT2JqSW4gPSBoYW5kbGVyOwoJCQloYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKCQkJc2VsZWN0b3IgPSBoYW5kbGVPYmpJbi5zZWxlY3RvcjsKCQl9CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgoJCWlmICggIWhhbmRsZXIuZ3VpZCApIHsKCQkJaGFuZGxlci5ndWlkID0galF1ZXJ5Lmd1aWQrKzsKCQl9CgoJCS8vIEluaXQgdGhlIGVsZW1lbnQncyBldmVudCBzdHJ1Y3R1cmUgYW5kIG1haW4gaGFuZGxlciwgaWYgdGhpcyBpcyB0aGUgZmlyc3QKCQlpZiAoICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzID0ge307CgkJfQoJCWlmICggIShldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSkgKSB7CgkJCWV2ZW50SGFuZGxlID0gZWxlbURhdGEuaGFuZGxlID0gZnVuY3Rpb24oIGUgKSB7CgkJCQkvLyBEaXNjYXJkIHRoZSBzZWNvbmQgZXZlbnQgb2YgYSBqUXVlcnkuZXZlbnQudHJpZ2dlcigpIGFuZAoJCQkJLy8gd2hlbiBhbiBldmVudCBpcyBjYWxsZWQgYWZ0ZXIgYSBwYWdlIGhhcyB1bmxvYWRlZAoJCQkJcmV0dXJuIHR5cGVvZiBqUXVlcnkgIT09IHN0cnVuZGVmaW5lZCAmJiBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgPwoJCQkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZWxlbSwgYXJndW1lbnRzICkgOiB1bmRlZmluZWQ7CgkJCX07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBUaGVyZSAqbXVzdCogYmUgYSB0eXBlLCBubyBhdHRhY2hpbmcgbmFtZXNwYWNlLW9ubHkgaGFuZGxlcnMKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBJZiBldmVudCBjaGFuZ2VzIGl0cyB0eXBlLCB1c2UgdGhlIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBjaGFuZ2VkIHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBJZiBzZWxlY3RvciBkZWZpbmVkLCBkZXRlcm1pbmUgc3BlY2lhbCBldmVudCBhcGkgdHlwZSwgb3RoZXJ3aXNlIGdpdmVuIHR5cGUKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoKCQkJLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCgkJCS8vIGhhbmRsZU9iaiBpcyBwYXNzZWQgdG8gYWxsIGV2ZW50IGhhbmRsZXJzCgkJCWhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoewoJCQkJdHlwZTogdHlwZSwKCQkJCW9yaWdUeXBlOiBvcmlnVHlwZSwKCQkJCWRhdGE6IGRhdGEsCgkJCQloYW5kbGVyOiBoYW5kbGVyLAoJCQkJZ3VpZDogaGFuZGxlci5ndWlkLAoJCQkJc2VsZWN0b3I6IHNlbGVjdG9yLAoJCQkJbmVlZHNDb250ZXh0OiBzZWxlY3RvciAmJiBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSwKCQkJCW5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKCIuIikKCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCS8vIEluaXQgdGhlIGV2ZW50IGhhbmRsZXIgcXVldWUgaWYgd2UncmUgdGhlIGZpcnN0CgkJCWlmICggIShoYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdKSApIHsKCQkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gPSBbXTsKCQkJCWhhbmRsZXJzLmRlbGVnYXRlQ291bnQgPSAwOwoKCQkJCS8vIE9ubHkgdXNlIGFkZEV2ZW50TGlzdGVuZXIgaWYgdGhlIHNwZWNpYWwgZXZlbnRzIGhhbmRsZXIgcmV0dXJucyBmYWxzZQoJCQkJaWYgKCAhc3BlY2lhbC5zZXR1cCB8fCBzcGVjaWFsLnNldHVwLmNhbGwoIGVsZW0sIGRhdGEsIG5hbWVzcGFjZXMsIGV2ZW50SGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKCBzcGVjaWFsLmFkZCApIHsKCQkJCXNwZWNpYWwuYWRkLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoKCQkJCWlmICggIWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgKSB7CgkJCQkJaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCA9IGhhbmRsZXIuZ3VpZDsKCQkJCX0KCQkJfQoKCQkJLy8gQWRkIHRvIHRoZSBlbGVtZW50J3MgaGFuZGxlciBsaXN0LCBkZWxlZ2F0ZXMgaW4gZnJvbnQKCQkJaWYgKCBzZWxlY3RvciApIHsKCQkJCWhhbmRsZXJzLnNwbGljZSggaGFuZGxlcnMuZGVsZWdhdGVDb3VudCsrLCAwLCBoYW5kbGVPYmogKTsKCQkJfSBlbHNlIHsKCQkJCWhhbmRsZXJzLnB1c2goIGhhbmRsZU9iaiApOwoJCQl9CgoJCQkvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGV2ZW50cyBoYXZlIGV2ZXIgYmVlbiB1c2VkLCBmb3IgZXZlbnQgb3B0aW1pemF0aW9uCgkJCWpRdWVyeS5ldmVudC5nbG9iYWxbIHR5cGUgXSA9IHRydWU7CgkJfQoKCX0sCgoJLy8gRGV0YWNoIGFuIGV2ZW50IG9yIHNldCBvZiBldmVudHMgZnJvbSBhbiBlbGVtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgc2VsZWN0b3IsIG1hcHBlZFR5cGVzICkgewoKCQl2YXIgaiwgb3JpZ0NvdW50LCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKSAmJiBkYXRhX3ByaXYuZ2V0KCBlbGVtICk7CgoJCWlmICggIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbICIiIF07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gVW5iaW5kIGFsbCBldmVudHMgKG9uIHRoaXMgbmFtZXNwYWNlLCBpZiBwcm92aWRlZCkgZm9yIHRoZSBlbGVtZW50CgkJCWlmICggIXR5cGUgKSB7CgkJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICsgdHlwZXNbIHQgXSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUgKTsKCQkJCX0KCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdOwoJCQl0bXAgPSB0bXBbMl0gJiYgbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKTsKCgkJCS8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMKCQkJb3JpZ0NvdW50ID0gaiA9IGhhbmRsZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaiBdOwoKCQkJCWlmICggKCBtYXBwZWRUeXBlcyB8fCBvcmlnVHlwZSA9PT0gaGFuZGxlT2JqLm9yaWdUeXBlICkgJiYKCQkJCQkoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJgoJCQkJCSggIXRtcCB8fCB0bXAudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgJiYKCQkJCQkoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgewoJCQkJCWhhbmRsZXJzLnNwbGljZSggaiwgMSApOwoKCQkJCQlpZiAoIGhhbmRsZU9iai5zZWxlY3RvciApIHsKCQkJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOwoJCQkJCX0KCQkJCQlpZiAoIHNwZWNpYWwucmVtb3ZlICkgewoJCQkJCQlzcGVjaWFsLnJlbW92ZS5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFJlbW92ZSBnZW5lcmljIGV2ZW50IGhhbmRsZXIgaWYgd2UgcmVtb3ZlZCBzb21ldGhpbmcgYW5kIG5vIG1vcmUgaGFuZGxlcnMgZXhpc3QKCQkJLy8gKGF2b2lkcyBwb3RlbnRpYWwgZm9yIGVuZGxlc3MgcmVjdXJzaW9uIGR1cmluZyByZW1vdmFsIG9mIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMpCgkJCWlmICggb3JpZ0NvdW50ICYmICFoYW5kbGVycy5sZW5ndGggKSB7CgkJCQlpZiAoICFzcGVjaWFsLnRlYXJkb3duIHx8IHNwZWNpYWwudGVhcmRvd24uY2FsbCggZWxlbSwgbmFtZXNwYWNlcywgZWxlbURhdGEuaGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlICk7CgkJCQl9CgoJCQkJZGVsZXRlIGV2ZW50c1sgdHlwZSBdOwoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZAoJCWlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkgewoJCQlkZWxldGUgZWxlbURhdGEuaGFuZGxlOwoJCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgoJCXZhciBpLCBjdXIsIHRtcCwgYnViYmxlVHlwZSwgb250eXBlLCBoYW5kbGUsIHNwZWNpYWwsCgkJCWV2ZW50UGF0aCA9IFsgZWxlbSB8fCBkb2N1bWVudCBdLAoJCQl0eXBlID0gaGFzT3duLmNhbGwoIGV2ZW50LCAidHlwZSIgKSA/IGV2ZW50LnR5cGUgOiBldmVudCwKCQkJbmFtZXNwYWNlcyA9IGhhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCS8vIFRyaWdnZXIgYml0bWFzazogJiAxIGZvciBuYXRpdmUgaGFuZGxlcnM7ICYgMiBmb3IgalF1ZXJ5IChhbHdheXMgdHJ1ZSkKCQlldmVudC5pc1RyaWdnZXIgPSBvbmx5SGFuZGxlcnMgPyAyIDogMzsKCQlldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oIi4iKTsKCQlldmVudC5uYW1lc3BhY2VfcmUgPSBldmVudC5uYW1lc3BhY2UgPwoJCQluZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApIDoKCQkJbnVsbDsKCgkJLy8gQ2xlYW4gdXAgdGhlIGV2ZW50IGluIGNhc2UgaXQgaXMgYmVpbmcgcmV1c2VkCgkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gZWxlbTsKCQl9CgoJCS8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3QKCQlkYXRhID0gZGF0YSA9PSBudWxsID8KCQkJWyBldmVudCBdIDoKCQkJalF1ZXJ5Lm1ha2VBcnJheSggZGF0YSwgWyBldmVudCBdICk7CgoJCS8vIEFsbG93IHNwZWNpYWwgZXZlbnRzIHRvIGRyYXcgb3V0c2lkZSB0aGUgbGluZXMKCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgc3BlY2lhbC50cmlnZ2VyICYmIHNwZWNpYWwudHJpZ2dlci5hcHBseSggZWxlbSwgZGF0YSApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIGV2ZW50IHByb3BhZ2F0aW9uIHBhdGggaW4gYWR2YW5jZSwgcGVyIFczQyBldmVudHMgc3BlYyAoIzk5NTEpCgkJLy8gQnViYmxlIHVwIHRvIGRvY3VtZW50LCB0aGVuIHRvIHdpbmRvdzsgd2F0Y2ggZm9yIGEgZ2xvYmFsIG93bmVyRG9jdW1lbnQgdmFyICgjOTcyNCkKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgkJCWlmICggIXJmb2N1c01vcnBoLnRlc3QoIGJ1YmJsZVR5cGUgKyB0eXBlICkgKSB7CgkJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQkJfQoJCQlmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgkJCQlldmVudFBhdGgucHVzaCggY3VyICk7CgkJCQl0bXAgPSBjdXI7CgkJCX0KCgkJCS8vIE9ubHkgYWRkIHdpbmRvdyBpZiB3ZSBnb3QgdG8gZG9jdW1lbnQgKGUuZy4sIG5vdCBwbGFpbiBvYmogb3IgZGV0YWNoZWQgRE9NKQoJCQlpZiAoIHRtcCA9PT0gKGVsZW0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgKSB7CgkJCQlldmVudFBhdGgucHVzaCggdG1wLmRlZmF1bHRWaWV3IHx8IHRtcC5wYXJlbnRXaW5kb3cgfHwgd2luZG93ICk7CgkJCX0KCQl9CgoJCS8vIEZpcmUgaGFuZGxlcnMgb24gdGhlIGV2ZW50IHBhdGgKCQlpID0gMDsKCQl3aGlsZSAoIChjdXIgPSBldmVudFBhdGhbaSsrXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgoJCQlldmVudC50eXBlID0gaSA+IDEgPwoJCQkJYnViYmxlVHlwZSA6CgkJCQlzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGU7CgoJCQkvLyBqUXVlcnkgaGFuZGxlcgoJCQloYW5kbGUgPSAoIGRhdGFfcHJpdi5nZXQoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgZGF0YV9wcml2LmdldCggY3VyLCAiaGFuZGxlIiApOwoJCQlpZiAoIGhhbmRsZSApIHsKCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCX0KCgkJCS8vIE5hdGl2ZSBoYW5kbGVyCgkJCWhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOwoJCQlpZiAoIGhhbmRsZSAmJiBoYW5kbGUuYXBwbHkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGN1ciApICkgewoJCQkJZXZlbnQucmVzdWx0ID0gaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJCWlmICggZXZlbnQucmVzdWx0ID09PSBmYWxzZSApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJfQoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGV2ZW50UGF0aC5wb3AoKSwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCWpRdWVyeS5hY2NlcHREYXRhKCBlbGVtICkgKSB7CgoJCQkJLy8gQ2FsbCBhIG5hdGl2ZSBET00gbWV0aG9kIG9uIHRoZSB0YXJnZXQgd2l0aCB0aGUgc2FtZSBuYW1lIG5hbWUgYXMgdGhlIGV2ZW50LgoJCQkJLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQoJCQkJaWYgKCBvbnR5cGUgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIGVsZW1bIHR5cGUgXSApICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCQkJLy8gRG9uJ3QgcmUtdHJpZ2dlciBhbiBvbkZPTyBldmVudCB3aGVuIHdlIGNhbGwgaXRzIEZPTygpIG1ldGhvZAoJCQkJCXRtcCA9IGVsZW1bIG9udHlwZSBdOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSBudWxsOwoJCQkJCX0KCgkJCQkJLy8gUHJldmVudCByZS10cmlnZ2VyaW5nIG9mIHRoZSBzYW1lIGV2ZW50LCBzaW5jZSB3ZSBhbHJlYWR5IGJ1YmJsZWQgaXQgYWJvdmUKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTsKCQkJCQllbGVtWyB0eXBlIF0oKTsKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSB0bXA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gZXZlbnQucmVzdWx0OwoJfSwKCglkaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkvLyBNYWtlIGEgd3JpdGFibGUgalF1ZXJ5LkV2ZW50IGZyb20gdGhlIG5hdGl2ZSBldmVudCBvYmplY3QKCQlldmVudCA9IGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICk7CgoJCXZhciBpLCBqLCByZXQsIG1hdGNoZWQsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJaGFuZGxlcnMgPSAoIGRhdGFfcHJpdi5nZXQoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IgMikgaGF2ZSBuYW1lc3BhY2UocykKCQkJCS8vIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBpLCBtYXRjaGVzLCBzZWwsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHsKCgkJCQkvLyBEb24ndCBwcm9jZXNzIGNsaWNrcyBvbiBkaXNhYmxlZCBlbGVtZW50cyAoIzY5MTEsICM4MTY1LCAjMTEzODIsICMxMTc2NCkKCQkJCWlmICggY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIgKSB7CgkJCQkJbWF0Y2hlcyA9IFtdOwoJCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaSBdOwoKCQkJCQkJLy8gRG9uJ3QgY29uZmxpY3Qgd2l0aCBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKCMxMzIwMykKCQkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yICsgIiAiOwoKCQkJCQkJaWYgKCBtYXRjaGVzWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkgewoJCQkJCQkJbWF0Y2hlc1sgc2VsIF0gPSBoYW5kbGVPYmoubmVlZHNDb250ZXh0ID8KCQkJCQkJCQlqUXVlcnkoIHNlbCwgdGhpcyApLmluZGV4KCBjdXIgKSA+PSAwIDoKCQkJCQkJCQlqUXVlcnkuZmluZCggc2VsLCB0aGlzLCBudWxsLCBbIGN1ciBdICkubGVuZ3RoOwoJCQkJCQl9CgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gKSB7CgkJCQkJCQltYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggbWF0Y2hlcy5sZW5ndGggKSB7CgkJCQkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogY3VyLCBoYW5kbGVyczogbWF0Y2hlcyB9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEFkZCB0aGUgcmVtYWluaW5nIChkaXJlY3RseS1ib3VuZCkgaGFuZGxlcnMKCQlpZiAoIGRlbGVnYXRlQ291bnQgPCBoYW5kbGVycy5sZW5ndGggKSB7CgkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogdGhpcywgaGFuZGxlcnM6IGhhbmRsZXJzLnNsaWNlKCBkZWxlZ2F0ZUNvdW50ICkgfSk7CgkJfQoKCQlyZXR1cm4gaGFuZGxlclF1ZXVlOwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBldmVudERvYywgZG9jLCBib2R5LAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uOwoKCQkJLy8gQ2FsY3VsYXRlIHBhZ2VYL1kgaWYgbWlzc2luZyBhbmQgY2xpZW50WC9ZIGF2YWlsYWJsZQoJCQlpZiAoIGV2ZW50LnBhZ2VYID09IG51bGwgJiYgb3JpZ2luYWwuY2xpZW50WCAhPSBudWxsICkgewoJCQkJZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsKCQkJCWRvYyA9IGV2ZW50RG9jLmRvY3VtZW50RWxlbWVudDsKCQkJCWJvZHkgPSBldmVudERvYy5ib2R5OwoKCQkJCWV2ZW50LnBhZ2VYID0gb3JpZ2luYWwuY2xpZW50WCArICggZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCWV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArICggZG9jICYmIGRvYy5zY3JvbGxUb3AgIHx8IGJvZHkgJiYgYm9keS5zY3JvbGxUb3AgIHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRUb3AgIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgIHx8IDAgKTsKCQkJfQoKCQkJLy8gQWRkIHdoaWNoIGZvciBjbGljazogMSA9PT0gbGVmdDsgMiA9PT0gbWlkZGxlOyAzID09PSByaWdodAoJCQkvLyBOb3RlOiBidXR0b24gaXMgbm90IG5vcm1hbGl6ZWQsIHNvIGRvbid0IHVzZSBpdAoJCQlpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHsKCQkJCWV2ZW50LndoaWNoID0gKCBidXR0b24gJiAxID8gMSA6ICggYnV0dG9uICYgMiA/IDMgOiAoIGJ1dHRvbiAmIDQgPyAyIDogMCApICkgKTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogQ29yZG92YSAyLjUgKFdlYktpdCkgKCMxMzI1NSkKCQkvLyBBbGwgZXZlbnRzIHNob3VsZCBoYXZlIGEgdGFyZ2V0OyBDb3Jkb3ZhIGRldmljZXJlYWR5IGRvZXNuJ3QKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogU2FmYXJpIDYuMCssIENocm9tZTwyOAoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsKCX0sCgoJc3BlY2lhbDogewoJCWxvYWQ6IHsKCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQlub0J1YmJsZTogdHJ1ZQoJCX0sCgkJZm9jdXM6IHsKCQkJLy8gRmlyZSBuYXRpdmUgZXZlbnQgaWYgcG9zc2libGUgc28gYmx1ci9mb2N1cyBzZXF1ZW5jZSBpcyBjb3JyZWN0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzICE9PSBzYWZlQWN0aXZlRWxlbWVudCgpICYmIHRoaXMuZm9jdXMgKSB7CgkJCQkJdGhpcy5mb2N1cygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNpbiIKCQl9LAoJCWJsdXI6IHsKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgPT09IHNhZmVBY3RpdmVFbGVtZW50KCkgJiYgdGhpcy5ibHVyICkgewoJCQkJCXRoaXMuYmx1cigpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNvdXQiCgkJfSwKCQljbGljazogewoJCQkvLyBGb3IgY2hlY2tib3gsIGZpcmUgbmF0aXZlIGV2ZW50IHNvIGNoZWNrZWQgc3RhdGUgd2lsbCBiZSByaWdodAoJCQl0cmlnZ2VyOiBmdW5jdGlvbigpIHsKCQkJCWlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2sgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiaW5wdXQiICkgKSB7CgkJCQkJdGhpcy5jbGljaygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCgkJCS8vIEZvciBjcm9zcy1icm93c2VyIGNvbnNpc3RlbmN5LCBkb24ndCBmaXJlIG5hdGl2ZSAuY2xpY2soKSBvbiBsaW5rcwoJCQlfZGVmYXVsdDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZXZlbnQudGFyZ2V0LCAiYSIgKTsKCQkJfQoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBTdXBwb3J0OiBGaXJlZm94IDIwKwoJCQkJLy8gRmlyZWZveCBkb2Vzbid0IGFsZXJ0IGlmIHRoZSByZXR1cm5WYWx1ZSBmaWVsZCBpcyBub3Qgc2V0LgoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCAmJiBldmVudC5vcmlnaW5hbEV2ZW50ICkgewoJCQkJCWV2ZW50Lm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBldmVudC5yZXN1bHQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXNpbXVsYXRlOiBmdW5jdGlvbiggdHlwZSwgZWxlbSwgZXZlbnQsIGJ1YmJsZSApIHsKCQkvLyBQaWdneWJhY2sgb24gYSBkb25vciBldmVudCB0byBzaW11bGF0ZSBhIGRpZmZlcmVudCBvbmUuCgkJLy8gRmFrZSBvcmlnaW5hbEV2ZW50IHRvIGF2b2lkIGRvbm9yJ3Mgc3RvcFByb3BhZ2F0aW9uLCBidXQgaWYgdGhlCgkJLy8gc2ltdWxhdGVkIGV2ZW50IHByZXZlbnRzIGRlZmF1bHQgdGhlbiB3ZSBkbyB0aGUgc2FtZSBvbiB0aGUgZG9ub3IuCgkJdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKAoJCQluZXcgalF1ZXJ5LkV2ZW50KCksCgkJCWV2ZW50LAoJCQl7CgkJCQl0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCWVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgaGFuZGxlLCBmYWxzZSApOwoJfQp9OwoKalF1ZXJ5LkV2ZW50ID0gZnVuY3Rpb24oIHNyYywgcHJvcHMgKSB7CgkvLyBBbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgdGhlICduZXcnIGtleXdvcmQKCWlmICggISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSApIHsKCQlyZXR1cm4gbmV3IGpRdWVyeS5FdmVudCggc3JjLCBwcm9wcyApOwoJfQoKCS8vIEV2ZW50IG9iamVjdAoJaWYgKCBzcmMgJiYgc3JjLnR5cGUgKSB7CgkJdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwoJCXRoaXMudHlwZSA9IHNyYy50eXBlOwoKCQkvLyBFdmVudHMgYnViYmxpbmcgdXAgdGhlIGRvY3VtZW50IG1heSBoYXZlIGJlZW4gbWFya2VkIGFzIHByZXZlbnRlZAoJCS8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gc3JjLmRlZmF1bHRQcmV2ZW50ZWQgfHwKCQkJCXNyYy5kZWZhdWx0UHJldmVudGVkID09PSB1bmRlZmluZWQgJiYKCQkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkJCQlzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlID8KCQkJcmV0dXJuVHJ1ZSA6CgkJCXJldHVybkZhbHNlOwoKCS8vIEV2ZW50IHR5cGUKCX0gZWxzZSB7CgkJdGhpcy50eXBlID0gc3JjOwoJfQoKCS8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0CglpZiAoIHByb3BzICkgewoJCWpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7Cgl9CgoJLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUKCXRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOwoKCS8vIE1hcmsgaXQgYXMgZml4ZWQKCXRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlOwp9OwoKLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nCi8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDMvV0QtRE9NLUxldmVsLTMtRXZlbnRzLTIwMDMwMzMxL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbApqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewoJaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwKCWlzUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCWlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCglwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7CgkJdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7CgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuVHJ1ZTsKCgkJaWYgKCBlICYmIGUucHJldmVudERlZmF1bHQgKSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQl9CgoJCXRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7Cgl9Cn07CgovLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKLy8gU3VwcG9ydDogQ2hyb21lIDE1KwpqUXVlcnkuZWFjaCh7Cgltb3VzZWVudGVyOiAibW91c2VvdmVyIiwKCW1vdXNlbGVhdmU6ICJtb3VzZW91dCIsCglwb2ludGVyZW50ZXI6ICJwb2ludGVyb3ZlciIsCglwb2ludGVybGVhdmU6ICJwb2ludGVyb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBGaXJlZm94LCBDaHJvbWUsIFNhZmFyaQovLyBDcmVhdGUgImJ1YmJsaW5nIiBmb2N1cyBhbmQgYmx1ciBldmVudHMKaWYgKCAhc3VwcG9ydC5mb2N1c2luQnViYmxlcyApIHsKCWpRdWVyeS5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoKCQkvLyBBdHRhY2ggYSBzaW5nbGUgY2FwdHVyaW5nIGhhbmRsZXIgb24gdGhlIGRvY3VtZW50IHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAoJCXZhciBoYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQlhdHRhY2hlcyA9IGRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4ICk7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLmFkZEV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCX0KCQkJCWRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4LCAoIGF0dGFjaGVzIHx8IDAgKSArIDEgKTsKCQkJfSwKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJdmFyIGRvYyA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzLAoJCQkJCWF0dGFjaGVzID0gZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXggKSAtIDE7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQlkYXRhX3ByaXYucmVtb3ZlKCBkb2MsIGZpeCApOwoKCQkJCX0gZWxzZSB7CgkJCQkJZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXgsIGF0dGFjaGVzICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgb3JpZ0ZuLCB0eXBlOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCXRyaWdnZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzICk7CgkJfSk7Cgl9LAoJdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXZhciBlbGVtID0gdGhpc1swXTsKCQlpZiAoIGVsZW0gKSB7CgkJCXJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgZWxlbSwgdHJ1ZSApOwoJCX0KCX0KfSk7CgoKdmFyCglyeGh0bWxUYWcgPSAvPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLAoJcnRhZ05hbWUgPSAvPChbXHc6XSspLywKCXJodG1sID0gLzx8JiM/XHcrOy8sCglybm9Jbm5lcmh0bWwgPSAvPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLAoJLy8gY2hlY2tlZD0iY2hlY2tlZCIgb3IgY2hlY2tlZAoJcmNoZWNrZWQgPSAvY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSwKCXJzY3JpcHRUeXBlID0gL14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLAoJcnNjcmlwdFR5cGVNYXNrZWQgPSAvXnRydWVcLyguKikvLAoJcmNsZWFuU2NyaXB0ID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLAoKCS8vIFdlIGhhdmUgdG8gY2xvc2UgdGhlc2UgdGFncyB0byBzdXBwb3J0IFhIVE1MICgjMTMyMDApCgl3cmFwTWFwID0gewoKCQkvLyBTdXBwb3J0OiBJRTkKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdHI6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCV9kZWZhdWx0OiBbIDAsICIiLCAiIiBdCgl9OwoKLy8gU3VwcG9ydDogSUU5CndyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKCndyYXBNYXAudGJvZHkgPSB3cmFwTWFwLnRmb290ID0gd3JhcE1hcC5jb2xncm91cCA9IHdyYXBNYXAuY2FwdGlvbiA9IHdyYXBNYXAudGhlYWQ7CndyYXBNYXAudGggPSB3cmFwTWFwLnRkOwoKLy8gU3VwcG9ydDogMS54IGNvbXBhdGliaWxpdHkKLy8gTWFuaXB1bGF0aW5nIHRhYmxlcyByZXF1aXJlcyBhIHRib2R5CmZ1bmN0aW9uIG1hbmlwdWxhdGlvblRhcmdldCggZWxlbSwgY29udGVudCApIHsKCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJ0YWJsZSIgKSAmJgoJCWpRdWVyeS5ub2RlTmFtZSggY29udGVudC5ub2RlVHlwZSAhPT0gMTEgPyBjb250ZW50IDogY29udGVudC5maXJzdENoaWxkLCAidHIiICkgPwoKCQllbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdIHx8CgkJCWVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpICkgOgoJCWVsZW07Cn0KCi8vIFJlcGxhY2UvcmVzdG9yZSB0aGUgdHlwZSBhdHRyaWJ1dGUgb2Ygc2NyaXB0IGVsZW1lbnRzIGZvciBzYWZlIERPTSBtYW5pcHVsYXRpb24KZnVuY3Rpb24gZGlzYWJsZVNjcmlwdCggZWxlbSApIHsKCWVsZW0udHlwZSA9IChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpICE9PSBudWxsKSArICIvIiArIGVsZW0udHlwZTsKCXJldHVybiBlbGVtOwp9CmZ1bmN0aW9uIHJlc3RvcmVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgbWF0Y2ggPSByc2NyaXB0VHlwZU1hc2tlZC5leGVjKCBlbGVtLnR5cGUgKTsKCglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWyAxIF07Cgl9IGVsc2UgewoJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIik7Cgl9CgoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgaSA9IDAsCgkJbCA9IGVsZW1zLmxlbmd0aDsKCglmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJZGF0YV9wcml2LnNldCgKCQkJZWxlbXNbIGkgXSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgZGF0YV9wcml2LmdldCggcmVmRWxlbWVudHNbIGkgXSwgImdsb2JhbEV2YWwiICkKCQkpOwoJfQp9CgpmdW5jdGlvbiBjbG9uZUNvcHlFdmVudCggc3JjLCBkZXN0ICkgewoJdmFyIGksIGwsIHR5cGUsIHBkYXRhT2xkLCBwZGF0YUN1ciwgdWRhdGFPbGQsIHVkYXRhQ3VyLCBldmVudHM7CgoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCgkvLyAxLiBDb3B5IHByaXZhdGUgZGF0YTogZXZlbnRzLCBoYW5kbGVycywgZXRjLgoJaWYgKCBkYXRhX3ByaXYuaGFzRGF0YSggc3JjICkgKSB7CgkJcGRhdGFPbGQgPSBkYXRhX3ByaXYuYWNjZXNzKCBzcmMgKTsKCQlwZGF0YUN1ciA9IGRhdGFfcHJpdi5zZXQoIGRlc3QsIHBkYXRhT2xkICk7CgkJZXZlbnRzID0gcGRhdGFPbGQuZXZlbnRzOwoKCQlpZiAoIGV2ZW50cyApIHsKCQkJZGVsZXRlIHBkYXRhQ3VyLmhhbmRsZTsKCQkJcGRhdGFDdXIuZXZlbnRzID0ge307CgoJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCWZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGRlc3QsIHR5cGUsIGV2ZW50c1sgdHlwZSBdWyBpIF0gKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyAyLiBDb3B5IHVzZXIgZGF0YQoJaWYgKCBkYXRhX3VzZXIuaGFzRGF0YSggc3JjICkgKSB7CgkJdWRhdGFPbGQgPSBkYXRhX3VzZXIuYWNjZXNzKCBzcmMgKTsKCQl1ZGF0YUN1ciA9IGpRdWVyeS5leHRlbmQoIHt9LCB1ZGF0YU9sZCApOwoKCQlkYXRhX3VzZXIuc2V0KCBkZXN0LCB1ZGF0YUN1ciApOwoJfQp9CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciByZXQgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnIHx8ICIqIiApIDoKCQkJY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQlbXTsKCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIHJldCApIDoKCQlyZXQ7Cn0KCi8vIEZpeCBJRSBidWdzLCBzZWUgc3VwcG9ydCB0ZXN0cwpmdW5jdGlvbiBmaXhJbnB1dCggc3JjLCBkZXN0ICkgewoJdmFyIG5vZGVOYW1lID0gZGVzdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoKCS8vIEZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3ggb3IgcmFkaW8gYnV0dG9uLgoJaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiAmJiByY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCWRlc3QuY2hlY2tlZCA9IHNyYy5jaGVja2VkOwoKCS8vIEZhaWxzIHRvIHJldHVybiB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRvIHRoZSBkZWZhdWx0IHNlbGVjdGVkIHN0YXRlIHdoZW4gY2xvbmluZyBvcHRpb25zCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgaSwgbCwgc3JjRWxlbWVudHMsIGRlc3RFbGVtZW50cywKCQkJY2xvbmUgPSBlbGVtLmNsb25lTm9kZSggdHJ1ZSApLAoJCQlpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoKCQkvLyBGaXggSUUgY2xvbmluZyBpc3N1ZXMKCQlpZiAoICFzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkICYmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSApICYmCgkJCQkhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgoJCQkvLyBXZSBlc2NoZXcgU2l6emxlIGhlcmUgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnM6IGh0dHA6Ly9qc3BlcmYuY29tL2dldGFsbC12cy1zaXp6bGUvMgoJCQlkZXN0RWxlbWVudHMgPSBnZXRBbGwoIGNsb25lICk7CgkJCXNyY0VsZW1lbnRzID0gZ2V0QWxsKCBlbGVtICk7CgoJCQlmb3IgKCBpID0gMCwgbCA9IHNyY0VsZW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCWZpeElucHV0KCBzcmNFbGVtZW50c1sgaSBdLCBkZXN0RWxlbWVudHNbIGkgXSApOwoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDAsIGwgPSBzcmNFbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQkJY2xvbmVDb3B5RXZlbnQoIHNyY0VsZW1lbnRzWyBpIF0sIGRlc3RFbGVtZW50c1sgaSBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgZWxlbSwgdG1wLCB0YWcsIHdyYXAsIGNvbnRhaW5zLCBqLAoJCQlmcmFnbWVudCA9IGNvbnRleHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQlub2RlcyA9IFtdLAoJCQlpID0gMCwKCQkJbCA9IGVsZW1zLmxlbmd0aDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQllbGVtID0gZWxlbXNbIGkgXTsKCgkJCWlmICggZWxlbSB8fCBlbGVtID09PSAwICkgewoKCQkJCS8vIEFkZCBub2RlcyBkaXJlY3RseQoJCQkJaWYgKCBqUXVlcnkudHlwZSggZWxlbSApID09PSAib2JqZWN0IiApIHsKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIGVsZW0ubm9kZVR5cGUgPyBbIGVsZW0gXSA6IGVsZW0gKTsKCgkJCQkvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUKCQkJCX0gZWxzZSBpZiAoICFyaHRtbC50ZXN0KCBlbGVtICkgKSB7CgkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggZWxlbSApICk7CgoJCQkJLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCgkJCQl9IGVsc2UgewoJCQkJCXRtcCA9IHRtcCB8fCBmcmFnbWVudC5hcHBlbmRDaGlsZCggY29udGV4dC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKCQkJCQkvLyBEZXNlcmlhbGl6ZSBhIHN0YW5kYXJkIHJlcHJlc2VudGF0aW9uCgkJCQkJdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyAiIiwgIiIgXSApWyAxIF0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCQkJCQl0bXAuaW5uZXJIVE1MID0gd3JhcFsgMSBdICsgZWxlbS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICkgKyB3cmFwWyAyIF07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWyAwIF07CgkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCXRtcCA9IHRtcC5sYXN0Q2hpbGQ7CgkJCQkJfQoKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIHRtcC5jaGlsZE5vZGVzICk7CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyCgkJCQkJdG1wID0gZnJhZ21lbnQuZmlyc3RDaGlsZDsKCgkJCQkJLy8gRW5zdXJlIHRoZSBjcmVhdGVkIG5vZGVzIGFyZSBvcnBoYW5lZCAoIzEyMzkyKQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgd3JhcHBlciBmcm9tIGZyYWdtZW50CgkJZnJhZ21lbnQudGV4dENvbnRlbnQgPSAiIjsKCgkJaSA9IDA7CgkJd2hpbGUgKCAoZWxlbSA9IG5vZGVzWyBpKysgXSkgKSB7CgoJCQkvLyAjNDA4NyAtIElmIG9yaWdpbiBhbmQgZGVzdGluYXRpb24gZWxlbWVudHMgYXJlIHRoZSBzYW1lLCBhbmQgdGhpcyBpcwoJCQkvLyB0aGF0IGVsZW1lbnQsIGRvIG5vdCBkbyBhbnl0aGluZwoJCQlpZiAoIHNlbGVjdGlvbiAmJiBqUXVlcnkuaW5BcnJheSggZWxlbSwgc2VsZWN0aW9uICkgIT09IC0xICkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCWNvbnRhaW5zID0galF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCgkJCS8vIEFwcGVuZCB0byBmcmFnbWVudAoJCQl0bXAgPSBnZXRBbGwoIGZyYWdtZW50LmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBmcmFnbWVudDsKCX0sCgoJY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMgKSB7CgkJdmFyIGRhdGEsIGVsZW0sIHR5cGUsIGtleSwKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zWyBpIF0pICE9PSB1bmRlZmluZWQ7IGkrKyApIHsKCQkJaWYgKCBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCQkJa2V5ID0gZWxlbVsgZGF0YV9wcml2LmV4cGFuZG8gXTsKCgkJCQlpZiAoIGtleSAmJiAoZGF0YSA9IGRhdGFfcHJpdi5jYWNoZVsga2V5IF0pICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCBkYXRhX3ByaXYuY2FjaGVbIGtleSBdICkgewoJCQkJCQkvLyBEaXNjYXJkIGFueSByZW1haW5pbmcgYHByaXZhdGVgIGRhdGEKCQkJCQkJZGVsZXRlIGRhdGFfcHJpdi5jYWNoZVsga2V5IF07CgkJCQkJfQoJCQkJfQoJCQl9CgkJCS8vIERpc2NhcmQgYW55IHJlbWFpbmluZyBgdXNlcmAgZGF0YQoJCQlkZWxldGUgZGF0YV91c2VyLmNhY2hlWyBlbGVtWyBkYXRhX3VzZXIuZXhwYW5kbyBdIF07CgkJfQoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnRleHQoIHRoaXMgKSA6CgkJCQl0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQlpZiAoIHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSApIHsKCQkJCQkJdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwoJCQkJCX0KCQkJCX0pOwoJCX0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoICk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0LmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0Lmluc2VydEJlZm9yZSggZWxlbSwgdGFyZ2V0LmZpcnN0Q2hpbGQgKTsKCQkJfQoJCX0pOwoJfSwKCgliZWZvcmU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsKCQkJCXRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMgKTsKCQkJfQoJCX0pOwoJfSwKCglhZnRlcjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCXJlbW92ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCBrZWVwRGF0YSAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCQl2YXIgZWxlbSwKCQkJZWxlbXMgPSBzZWxlY3RvciA/IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkgOiB0aGlzLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCWlmICggIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQl9CgoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQlzZXRHbG9iYWxFdmFsKCBnZXRBbGwoIGVsZW0sICJzY3JpcHQiICkgKTsKCQkJCX0KCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoKCQkJCS8vIFByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCgkJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQkJZWxlbS50ZXh0Q29udGVudCA9ICIiOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4galF1ZXJ5LmNsb25lKCB0aGlzLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApOwoJCX0pOwoJfSwKCglodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbIDAgXSB8fCB7fSwKCQkJCWkgPSAwLAoJCQkJbCA9IHRoaXMubGVuZ3RoOwoKCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlyZXR1cm4gZWxlbS5pbm5lckhUTUw7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbICIiLCAiIiBdIClbIDEgXS50b0xvd2VyQ2FzZSgpIF0gKSB7CgoJCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICk7CgoJCQkJdHJ5IHsKCQkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJCWVsZW0gPSB0aGlzWyBpIF0gfHwge307CgoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCBlbGVtLCBmYWxzZSApICk7CgkJCQkJCQllbGVtLmlubmVySFRNTCA9IHZhbHVlOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQllbGVtID0gMDsKCgkJCQkvLyBJZiB1c2luZyBpbm5lckhUTUwgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgdXNlIHRoZSBmYWxsYmFjayBtZXRob2QKCQkJCX0gY2F0Y2goIGUgKSB7fQoJCQl9CgoJCQlpZiAoIGVsZW0gKSB7CgkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCQl9CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJcmVwbGFjZVdpdGg6IGZ1bmN0aW9uKCkgewoJCXZhciBhcmcgPSBhcmd1bWVudHNbIDAgXTsKCgkJLy8gTWFrZSB0aGUgY2hhbmdlcywgcmVwbGFjaW5nIGVhY2ggY29udGV4dCBlbGVtZW50IHdpdGggdGhlIG5ldyBjb250ZW50CgkJdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJYXJnID0gdGhpcy5wYXJlbnROb2RlOwoKCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCB0aGlzICkgKTsKCgkJCWlmICggYXJnICkgewoJCQkJYXJnLnJlcGxhY2VDaGlsZCggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7CgoJCS8vIEZvcmNlIHJlbW92YWwgaWYgdGhlcmUgd2FzIG5vIG5ldyBjb250ZW50IChlLmcuLCBmcm9tIGVtcHR5IGFyZ3VtZW50cykKCQlyZXR1cm4gYXJnICYmIChhcmcubGVuZ3RoIHx8IGFyZy5ub2RlVHlwZSkgPyB0aGlzIDogdGhpcy5yZW1vdmUoKTsKCX0sCgoJZGV0YWNoOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucmVtb3ZlKCBzZWxlY3RvciwgdHJ1ZSApOwoJfSwKCglkb21NYW5pcDogZnVuY3Rpb24oIGFyZ3MsIGNhbGxiYWNrICkgewoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJYXJncyA9IGNvbmNhdC5hcHBseSggW10sIGFyZ3MgKTsKCgkJdmFyIGZyYWdtZW50LCBmaXJzdCwgc2NyaXB0cywgaGFzU2NyaXB0cywgbm9kZSwgZG9jLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQlzZXQgPSB0aGlzLAoJCQlpTm9DbG9uZSA9IGwgLSAxLAoJCQl2YWx1ZSA9IGFyZ3NbIDAgXSwKCQkJaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApOwoKCQkvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQKCQlpZiAoIGlzRnVuY3Rpb24gfHwKCQkJCSggbCA+IDEgJiYgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJgoJCQkJCSFzdXBwb3J0LmNoZWNrQ2xvbmUgJiYgcmNoZWNrZWQudGVzdCggdmFsdWUgKSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpbmRleCApIHsKCQkJCXZhciBzZWxmID0gc2V0LmVxKCBpbmRleCApOwoJCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJCWFyZ3NbIDAgXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCBzZWxmLmh0bWwoKSApOwoJCQkJfQoJCQkJc2VsZi5kb21NYW5pcCggYXJncywgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXNjcmlwdHMgPSBqUXVlcnkubWFwKCBnZXRBbGwoIGZyYWdtZW50LCAic2NyaXB0IiApLCBkaXNhYmxlU2NyaXB0ICk7CgkJCQloYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7CgoJCQkJLy8gVXNlIHRoZSBvcmlnaW5hbCBmcmFnbWVudCBmb3IgdGhlIGxhc3QgaXRlbSBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAKCQkJCS8vIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkgaW4gY2VydGFpbiBzaXR1YXRpb25zICgjODA3MCkuCgkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJbm9kZSA9IGZyYWdtZW50OwoKCQkJCQlpZiAoIGkgIT09IGlOb0Nsb25lICkgewoJCQkJCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7CgoJCQkJCQkvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uCgkJCQkJCWlmICggaGFzU2NyaXB0cyApIHsKCQkJCQkJCS8vIFN1cHBvcnQ6IFF0V2ViS2l0CgkJCQkJCQkvLyBqUXVlcnkubWVyZ2UgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCQkJCQlqUXVlcnkubWVyZ2UoIHNjcmlwdHMsIGdldEFsbCggbm9kZSwgInNjcmlwdCIgKSApOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQljYWxsYmFjay5jYWxsKCB0aGlzWyBpIF0sIG5vZGUsIGkgKTsKCQkJCX0KCgkJCQlpZiAoIGhhc1NjcmlwdHMgKSB7CgkJCQkJZG9jID0gc2NyaXB0c1sgc2NyaXB0cy5sZW5ndGggLSAxIF0ub3duZXJEb2N1bWVudDsKCgkJCQkJLy8gUmVlbmFibGUgc2NyaXB0cwoJCQkJCWpRdWVyeS5tYXAoIHNjcmlwdHMsIHJlc3RvcmVTY3JpcHQgKTsKCgkJCQkJLy8gRXZhbHVhdGUgZXhlY3V0YWJsZSBzY3JpcHRzIG9uIGZpcnN0IGRvY3VtZW50IGluc2VydGlvbgoJCQkJCWZvciAoIGkgPSAwOyBpIDwgaGFzU2NyaXB0czsgaSsrICkgewoJCQkJCQlub2RlID0gc2NyaXB0c1sgaSBdOwoJCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIG5vZGUudHlwZSB8fCAiIiApICYmCgkJCQkJCQkhZGF0YV9wcml2LmFjY2Vzcyggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIE9wdGlvbmFsIEFKQVggZGVwZW5kZW5jeSwgYnV0IHdvbid0IHJ1biBzY3JpcHRzIGlmIG5vdCBwcmVzZW50CgkJCQkJCQkJaWYgKCBqUXVlcnkuX2V2YWxVcmwgKSB7CgkJCQkJCQkJCWpRdWVyeS5fZXZhbFVybCggbm9kZS5zcmMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWpRdWVyeS5nbG9iYWxFdmFsKCBub2RlLnRleHRDb250ZW50LnJlcGxhY2UoIHJjbGVhblNjcmlwdCwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0KfSk7CgpqUXVlcnkuZWFjaCh7CglhcHBlbmRUbzogImFwcGVuZCIsCglwcmVwZW5kVG86ICJwcmVwZW5kIiwKCWluc2VydEJlZm9yZTogImJlZm9yZSIsCglpbnNlcnRBZnRlcjogImFmdGVyIiwKCXJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIKfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJdmFyIGVsZW1zLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDEsCgkJCWkgPSAwOwoKCQlmb3IgKCA7IGkgPD0gbGFzdDsgaSsrICkgewoJCQllbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSggdHJ1ZSApOwoJCQlqUXVlcnkoIGluc2VydFsgaSBdIClbIG9yaWdpbmFsIF0oIGVsZW1zICk7CgoJCQkvLyBTdXBwb3J0OiBRdFdlYktpdAoJCQkvLyAuZ2V0KCkgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCXB1c2guYXBwbHkoIHJldCwgZWxlbXMuZ2V0KCkgKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCgp2YXIgaWZyYW1lLAoJZWxlbWRpc3BsYXkgPSB7fTsKCi8qKgogKiBSZXRyaWV2ZSB0aGUgYWN0dWFsIGRpc3BsYXkgb2YgYSBlbGVtZW50CiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIG5vZGVOYW1lIG9mIHRoZSBlbGVtZW50CiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MgRG9jdW1lbnQgb2JqZWN0CiAqLwovLyBDYWxsZWQgb25seSBmcm9tIHdpdGhpbiBkZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgc3R5bGUsCgkJZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoKCQkvLyBnZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSBtaWdodCBiZSByZWxpYWJseSB1c2VkIG9ubHkgb24gYXR0YWNoZWQgZWxlbWVudAoJCWRpc3BsYXkgPSB3aW5kb3cuZ2V0RGVmYXVsdENvbXB1dGVkU3R5bGUgJiYgKCBzdHlsZSA9IHdpbmRvdy5nZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSggZWxlbVsgMCBdICkgKSA/CgoJCQkvLyBVc2Ugb2YgdGhpcyBtZXRob2QgaXMgYSB0ZW1wb3JhcnkgZml4IChtb3JlIGxpa2Ugb3B0aW1pemF0aW9uKSB1bnRpbCBzb21ldGhpbmcgYmV0dGVyIGNvbWVzIGFsb25nLAoJCQkvLyBzaW5jZSBpdCB3YXMgcmVtb3ZlZCBmcm9tIHNwZWNpZmljYXRpb24gYW5kIHN1cHBvcnRlZCBvbmx5IGluIEZGCgkJCXN0eWxlLmRpc3BsYXkgOiBqUXVlcnkuY3NzKCBlbGVtWyAwIF0sICJkaXNwbGF5IiApOwoKCS8vIFdlIGRvbid0IGhhdmUgYW55IGRhdGEgc3RvcmVkIG9uIHRoZSBlbGVtZW50LAoJLy8gc28gdXNlICJkZXRhY2giIG1ldGhvZCBhcyBmYXN0IHdheSB0byBnZXQgcmlkIG9mIHRoZSBlbGVtZW50CgllbGVtLmRldGFjaCgpOwoKCXJldHVybiBkaXNwbGF5Owp9CgovKioKICogVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKICogQHBhcmFtIHtTdHJpbmd9IG5vZGVOYW1lCiAqLwpmdW5jdGlvbiBkZWZhdWx0RGlzcGxheSggbm9kZU5hbWUgKSB7Cgl2YXIgZG9jID0gZG9jdW1lbnQsCgkJZGlzcGxheSA9IGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdOwoKCWlmICggIWRpc3BsYXkgKSB7CgkJZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsKCgkJLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lCgkJaWYgKCBkaXNwbGF5ID09PSAibm9uZSIgfHwgIWRpc3BsYXkgKSB7CgoJCQkvLyBVc2UgdGhlIGFscmVhZHktY3JlYXRlZCBpZnJhbWUgaWYgcG9zc2libGUKCQkJaWZyYW1lID0gKGlmcmFtZSB8fCBqUXVlcnkoICI8aWZyYW1lIGZyYW1lYm9yZGVyPScwJyB3aWR0aD0nMCcgaGVpZ2h0PScwJy8+IiApKS5hcHBlbmRUbyggZG9jLmRvY3VtZW50RWxlbWVudCApOwoKCQkJLy8gQWx3YXlzIHdyaXRlIGEgbmV3IEhUTUwgc2tlbGV0b24gc28gV2Via2l0IGFuZCBGaXJlZm94IGRvbid0IGNob2tlIG9uIHJldXNlCgkJCWRvYyA9IGlmcmFtZVsgMCBdLmNvbnRlbnREb2N1bWVudDsKCgkJCS8vIFN1cHBvcnQ6IElFCgkJCWRvYy53cml0ZSgpOwoJCQlkb2MuY2xvc2UoKTsKCgkJCWRpc3BsYXkgPSBhY3R1YWxEaXNwbGF5KCBub2RlTmFtZSwgZG9jICk7CgkJCWlmcmFtZS5kZXRhY2goKTsKCQl9CgoJCS8vIFN0b3JlIHRoZSBjb3JyZWN0IGRlZmF1bHQgZGlzcGxheQoJCWVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTsKCX0KCglyZXR1cm4gZGlzcGxheTsKfQp2YXIgcm1hcmdpbiA9ICgvXm1hcmdpbi8pOwoKdmFyIHJudW1ub25weCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApOwoKdmFyIGdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgewoJCS8vIFN1cHBvcnQ6IElFPD0xMSssIEZpcmVmb3g8PTMwKyAoIzE1MDk4LCAjMTQxNTApCgkJLy8gSUUgdGhyb3dzIG9uIGVsZW1lbnRzIGNyZWF0ZWQgaW4gcG9wdXBzCgkJLy8gRkYgbWVhbndoaWxlIHRocm93cyBvbiBmcmFtZSBlbGVtZW50cyB0aHJvdWdoICJkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlIgoJCWlmICggZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lciApIHsKCQkJcmV0dXJuIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7CgkJfQoKCQlyZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKTsKCX07CgoKCmZ1bmN0aW9uIGN1ckNTUyggZWxlbSwgbmFtZSwgY29tcHV0ZWQgKSB7Cgl2YXIgd2lkdGgsIG1pbldpZHRoLCBtYXhXaWR0aCwgcmV0LAoJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgljb21wdXRlZCA9IGNvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApOwoKCS8vIFN1cHBvcnQ6IElFOQoJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgKCMxMjUzNykKCWlmICggY29tcHV0ZWQgKSB7CgkJcmV0ID0gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF07Cgl9CgoJaWYgKCBjb21wdXRlZCApIHsKCgkJaWYgKCByZXQgPT09ICIiICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApICkgewoJCQlyZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IGlPUyA8IDYKCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCS8vIGlPUyA8IDYgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkvLyB0aGlzIGlzIGFnYWluc3QgdGhlIENTU09NIGRyYWZ0IHNwZWM6IGh0dHA6Ly9kZXYudzMub3JnL2Nzc3dnL2Nzc29tLyNyZXNvbHZlZC12YWx1ZXMKCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiBybWFyZ2luLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJd2lkdGggPSBzdHlsZS53aWR0aDsKCQkJbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsKCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCS8vIFB1dCBpbiB0aGUgbmV3IHZhbHVlcyB0byBnZXQgYSBjb21wdXRlZCB2YWx1ZSBvdXQKCQkJc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0OwoJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJc3R5bGUubWF4V2lkdGggPSBtYXhXaWR0aDsKCQl9Cgl9CgoJcmV0dXJuIHJldCAhPT0gdW5kZWZpbmVkID8KCQkvLyBTdXBwb3J0OiBJRQoJCS8vIElFIHJldHVybnMgekluZGV4IHZhbHVlIGFzIGFuIGludGVnZXIuCgkJcmV0ICsgIiIgOgoJCXJldDsKfQoKCmZ1bmN0aW9uIGFkZEdldEhvb2tJZiggY29uZGl0aW9uRm4sIGhvb2tGbiApIHsKCS8vIERlZmluZSB0aGUgaG9vaywgd2UnbGwgY2hlY2sgb24gdGhlIGZpcnN0IHJ1biBpZiBpdCdzIHJlYWxseSBuZWVkZWQuCglyZXR1cm4gewoJCWdldDogZnVuY3Rpb24oKSB7CgkJCWlmICggY29uZGl0aW9uRm4oKSApIHsKCQkJCS8vIEhvb2sgbm90IG5lZWRlZCAob3IgaXQncyBub3QgcG9zc2libGUgdG8gdXNlIGl0IGR1ZQoJCQkJLy8gdG8gbWlzc2luZyBkZXBlbmRlbmN5KSwgcmVtb3ZlIGl0LgoJCQkJZGVsZXRlIHRoaXMuZ2V0OwoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBIb29rIG5lZWRlZDsgcmVkZWZpbmUgaXQgc28gdGhhdCB0aGUgc3VwcG9ydCB0ZXN0IGlzIG5vdCBleGVjdXRlZCBhZ2Fpbi4KCQkJcmV0dXJuICh0aGlzLmdldCA9IGhvb2tGbikuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCX0KCX07Cn0KCgooZnVuY3Rpb24oKSB7Cgl2YXIgcGl4ZWxQb3NpdGlvblZhbCwgYm94U2l6aW5nUmVsaWFibGVWYWwsCgkJZG9jRWxlbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgoJaWYgKCAhZGl2LnN0eWxlICkgewoJCXJldHVybjsKCX0KCgkvLyBTdXBwb3J0OiBJRTktMTErCgkvLyBTdHlsZSBvZiBjbG9uZWQgZWxlbWVudCBhZmZlY3RzIHNvdXJjZSBlbGVtZW50IGNsb25lZCAoIzg5MDgpCglkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiY29udGVudC1ib3giOwoJZGl2LmNsb25lTm9kZSggdHJ1ZSApLnN0eWxlLmJhY2tncm91bmRDbGlwID0gIiI7CglzdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSA9IGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9PT0gImNvbnRlbnQtYm94IjsKCgljb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweDttYXJnaW4tdG9wOjFweDsiICsKCQkicG9zaXRpb246YWJzb2x1dGUiOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKCBkaXYgKTsKCgkvLyBFeGVjdXRpbmcgYm90aCBwaXhlbFBvc2l0aW9uICYgYm94U2l6aW5nUmVsaWFibGUgdGVzdHMgcmVxdWlyZSBvbmx5IG9uZSBsYXlvdXQKCS8vIHNvIHRoZXkncmUgZXhlY3V0ZWQgYXQgdGhlIHNhbWUgdGltZSB0byBzYXZlIHRoZSBzZWNvbmQgY29tcHV0YXRpb24uCglmdW5jdGlvbiBjb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCkgewoJCWRpdi5zdHlsZS5jc3NUZXh0ID0KCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyOSwgQW5kcm9pZCAyLjMKCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCSItd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDsiICsKCQkJImJveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6MSU7dG9wOjElOyIgKwoJCQkiYm9yZGVyOjFweDtwYWRkaW5nOjFweDt3aWR0aDo0cHg7cG9zaXRpb246YWJzb2x1dGUiOwoJCWRpdi5pbm5lckhUTUwgPSAiIjsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJdmFyIGRpdlN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGRpdiwgbnVsbCApOwoJCXBpeGVsUG9zaXRpb25WYWwgPSBkaXZTdHlsZS50b3AgIT09ICIxJSI7CgkJYm94U2l6aW5nUmVsaWFibGVWYWwgPSBkaXZTdHlsZS53aWR0aCA9PT0gIjRweCI7CgoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoJfQoKCS8vIFN1cHBvcnQ6IG5vZGUuanMganNkb20KCS8vIERvbid0IGFzc3VtZSB0aGF0IGdldENvbXB1dGVkU3R5bGUgaXMgYSBwcm9wZXJ0eSBvZiB0aGUgZ2xvYmFsIG9iamVjdAoJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQlqUXVlcnkuZXh0ZW5kKCBzdXBwb3J0LCB7CgkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkgewoKCQkJCS8vIFRoaXMgdGVzdCBpcyBleGVjdXRlZCBvbmx5IG9uY2UgYnV0IHdlIHN0aWxsIGRvIG1lbW9pemluZwoJCQkJLy8gc2luY2Ugd2UgY2FuIHVzZSB0aGUgYm94U2l6aW5nUmVsaWFibGUgcHJlLWNvbXB1dGluZy4KCQkJCS8vIE5vIG5lZWQgdG8gY2hlY2sgaWYgdGhlIHRlc3Qgd2FzIGFscmVhZHkgcGVyZm9ybWVkLCB0aG91Z2guCgkJCQljb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCk7CgkJCQlyZXR1cm4gcGl4ZWxQb3NpdGlvblZhbDsKCQkJfSwKCQkJYm94U2l6aW5nUmVsaWFibGU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBib3hTaXppbmdSZWxpYWJsZVZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVQaXhlbFBvc2l0aW9uQW5kQm94U2l6aW5nUmVsaWFibGUoKTsKCQkJCX0KCQkJCXJldHVybiBib3hTaXppbmdSZWxpYWJsZVZhbDsKCQkJfSwKCQkJcmVsaWFibGVNYXJnaW5SaWdodDogZnVuY3Rpb24oKSB7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCS8vIENoZWNrIGlmIGRpdiB3aXRoIGV4cGxpY2l0IHdpZHRoIGFuZCBubyBtYXJnaW4tcmlnaHQgaW5jb3JyZWN0bHkKCQkJCS8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lci4gKCMzMzMzKQoJCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCQkvLyBUaGlzIHN1cHBvcnQgZnVuY3Rpb24gaXMgb25seSBleGVjdXRlZCBvbmNlIHNvIG5vIG1lbW9pemluZyBpcyBuZWVkZWQuCgkJCQl2YXIgcmV0LAoJCQkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApOwoKCQkJCS8vIFJlc2V0IENTUzogYm94LXNpemluZzsgZGlzcGxheTsgbWFyZ2luOyBib3JkZXI7IHBhZGRpbmcKCQkJCW1hcmdpbkRpdi5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPQoJCQkJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjksIEFuZHJvaWQgMi4zCgkJCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCQkJIi13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7IiArCgkJCQkJImJveC1zaXppbmc6Y29udGVudC1ib3g7ZGlzcGxheTpibG9jazttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjAiOwoJCQkJbWFyZ2luRGl2LnN0eWxlLm1hcmdpblJpZ2h0ID0gbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gIjAiOwoJCQkJZGl2LnN0eWxlLndpZHRoID0gIjFweCI7CgkJCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJCQlyZXQgPSAhcGFyc2VGbG9hdCggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIG1hcmdpbkRpdiwgbnVsbCApLm1hcmdpblJpZ2h0ICk7CgoJCQkJZG9jRWxlbS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7CgkJCQlkaXYucmVtb3ZlQ2hpbGQoIG1hcmdpbkRpdiApOwoKCQkJCXJldHVybiByZXQ7CgkJCX0KCQl9KTsKCX0KfSkoKTsKCgovLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zLgpqUXVlcnkuc3dhcCA9IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBjYWxsYmFjaywgYXJncyApIHsKCXZhciByZXQsIG5hbWUsCgkJb2xkID0ge307CgoJLy8gUmVtZW1iZXIgdGhlIG9sZCB2YWx1ZXMsIGFuZCBpbnNlcnQgdGhlIG5ldyBvbmVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdOwoJfQoKCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07Cgl9CgoJcmV0dXJuIHJldDsKfTsKCgp2YXIKCS8vIFN3YXBwYWJsZSBpZiBkaXNwbGF5IGlzIG5vbmUgb3Igc3RhcnRzIHdpdGggdGFibGUgZXhjZXB0ICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCgkvLyBTZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKCXJkaXNwbGF5c3dhcCA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoLiopJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgcG51bSArICIpIiwgImkiICksCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogIjAiLAoJCWZvbnRXZWlnaHQ6ICI0MDAiCgl9LAoKCWNzc1ByZWZpeGVzID0gWyAiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIiBdOwoKLy8gUmV0dXJuIGEgY3NzIHByb3BlcnR5IG1hcHBlZCB0byBhIHBvdGVudGlhbGx5IHZlbmRvciBwcmVmaXhlZCBwcm9wZXJ0eQpmdW5jdGlvbiB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG5hbWUgKSB7CgoJLy8gU2hvcnRjdXQgZm9yIG5hbWVzIHRoYXQgYXJlIG5vdCB2ZW5kb3IgcHJlZml4ZWQKCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQlyZXR1cm4gbmFtZTsKCX0KCgkvLyBDaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzCgl2YXIgY2FwTmFtZSA9IG5hbWVbMF0udG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBzdWJ0cmFjdCApIHsKCXZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7CglyZXR1cm4gbWF0Y2hlcyA/CgkJLy8gR3VhcmQgYWdhaW5zdCB1bmRlZmluZWQgInN1YnRyYWN0IiwgZS5nLiwgd2hlbiB1c2VkIGFzIGluIGNzc0hvb2tzCgkJTWF0aC5tYXgoIDAsIG1hdGNoZXNbIDEgXSAtICggc3VidHJhY3QgfHwgMCApICkgKyAoIG1hdGNoZXNbIDIgXSB8fCAicHgiICkgOgoJCXZhbHVlOwp9CgpmdW5jdGlvbiBhdWdtZW50V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEsIGlzQm9yZGVyQm94LCBzdHlsZXMgKSB7Cgl2YXIgaSA9IGV4dHJhID09PSAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSA/CgkJLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSByaWdodCBtZWFzdXJlbWVudCwgYXZvaWQgYXVnbWVudGF0aW9uCgkJNCA6CgkJLy8gT3RoZXJ3aXNlIGluaXRpYWxpemUgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgcHJvcGVydGllcwoJCW5hbWUgPT09ICJ3aWR0aCIgPyAxIDogMCwKCgkJdmFsID0gMDsKCglmb3IgKCA7IGkgPCA0OyBpICs9IDIgKSB7CgkJLy8gQm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luLCBzbyBhZGQgaXQgaWYgd2Ugd2FudCBpdAoJCWlmICggZXh0cmEgPT09ICJtYXJnaW4iICkgewoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgZXh0cmEgKyBjc3NFeHBhbmRbIGkgXSwgdHJ1ZSwgc3R5bGVzICk7CgkJfQoKCQlpZiAoIGlzQm9yZGVyQm94ICkgewoJCQkvLyBib3JkZXItYm94IGluY2x1ZGVzIHBhZGRpbmcsIHNvIHJlbW92ZSBpdCBpZiB3ZSB3YW50IGNvbnRlbnQKCQkJaWYgKCBleHRyYSA9PT0gImNvbnRlbnQiICkgewoJCQkJdmFsIC09IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgYm9yZGVyIG5vciBtYXJnaW4sIHNvIHJlbW92ZSBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gIm1hcmdpbiIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCwgc28gYWRkIHBhZGRpbmcKCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCgkJCS8vIEF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gInBhZGRpbmciICkgewoJCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJib3JkZXIiICsgY3NzRXhwYW5kWyBpIF0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdmFsOwp9CgpmdW5jdGlvbiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApIHsKCgkvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQoJdmFyIHZhbHVlSXNCb3JkZXJCb3ggPSB0cnVlLAoJCXZhbCA9IG5hbWUgPT09ICJ3aWR0aCIgPyBlbGVtLm9mZnNldFdpZHRoIDogZWxlbS5vZmZzZXRIZWlnaHQsCgkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksCgkJaXNCb3JkZXJCb3ggPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gU29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyBDaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYKCQkJKCBzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgdmFsID09PSBlbGVtLnN0eWxlWyBuYW1lIF0gKTsKCgkJLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmEKCQl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoJfQoKCS8vIFVzZSB0aGUgYWN0aXZlIGJveC1zaXppbmcgbW9kZWwgdG8gYWRkL3N1YnRyYWN0IGlycmVsZXZhbnQgc3R5bGVzCglyZXR1cm4gKCB2YWwgKwoJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQllbGVtLAoJCQluYW1lLAoJCQlleHRyYSB8fCAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSwKCQkJdmFsdWVJc0JvcmRlckJveCwKCQkJc3R5bGVzCgkJKQoJKSArICJweCI7Cn0KCmZ1bmN0aW9uIHNob3dIaWRlKCBlbGVtZW50cywgc2hvdyApIHsKCXZhciBkaXNwbGF5LCBlbGVtLCBoaWRkZW4sCgkJdmFsdWVzID0gW10sCgkJaW5kZXggPSAwLAoJCWxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsKCglmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCWVsZW0gPSBlbGVtZW50c1sgaW5kZXggXTsKCQlpZiAoICFlbGVtLnN0eWxlICkgewoJCQljb250aW51ZTsKCQl9CgoJCXZhbHVlc1sgaW5kZXggXSA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApOwoJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgkJaWYgKCBzaG93ICkgewoJCQkvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCgkJCS8vIGJlaW5nIGhpZGRlbiBieSBjYXNjYWRlZCBydWxlcyBvciBub3QKCQkJaWYgKCAhdmFsdWVzWyBpbmRleCBdICYmIGRpc3BsYXkgPT09ICJub25lIiApIHsKCQkJCWVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCQl9CgoJCQkvLyBTZXQgZWxlbWVudHMgd2hpY2ggaGF2ZSBiZWVuIG92ZXJyaWRkZW4gd2l0aCBkaXNwbGF5OiBub25lCgkJCS8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCgkJCS8vIGZvciBzdWNoIGFuIGVsZW1lbnQKCQkJaWYgKCBlbGVtLnN0eWxlLmRpc3BsYXkgPT09ICIiICYmIGlzSGlkZGVuKCBlbGVtICkgKSB7CgkJCQl2YWx1ZXNbIGluZGV4IF0gPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAib2xkZGlzcGxheSIsIGRlZmF1bHREaXNwbGF5KGVsZW0ubm9kZU5hbWUpICk7CgkJCX0KCQl9IGVsc2UgewoJCQloaWRkZW4gPSBpc0hpZGRlbiggZWxlbSApOwoKCQkJaWYgKCBkaXNwbGF5ICE9PSAibm9uZSIgfHwgIWhpZGRlbiApIHsKCQkJCWRhdGFfcHJpdi5zZXQoIGVsZW0sICJvbGRkaXNwbGF5IiwgaGlkZGVuID8gZGlzcGxheSA6IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICk7CgkJCX0KCQl9Cgl9CgoJLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3AKCS8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3cKCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoICFzaG93IHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiIHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgKSB7CgkJCWVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50czsKfQoKalF1ZXJ5LmV4dGVuZCh7CgoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJCS8vIFdlIHNob3VsZCBhbHdheXMgZ2V0IGEgbnVtYmVyIGJhY2sgZnJvbSBvcGFjaXR5CgkJCQkJdmFyIHJldCA9IGN1ckNTUyggZWxlbSwgIm9wYWNpdHkiICk7CgkJCQkJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCS8vIERvbid0IGF1dG9tYXRpY2FsbHkgYWRkICJweCIgdG8gdGhlc2UgcG9zc2libHktdW5pdGxlc3MgcHJvcGVydGllcwoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmbGV4R3JvdyI6IHRydWUsCgkJImZsZXhTaHJpbmsiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcmRlciI6IHRydWUsCgkJIm9ycGhhbnMiOiB0cnVlLAoJCSJ3aWRvd3MiOiB0cnVlLAoJCSJ6SW5kZXgiOiB0cnVlLAoJCSJ6b29tIjogdHJ1ZQoJfSwKCgkvLyBBZGQgaW4gcHJvcGVydGllcyB3aG9zZSBuYW1lcyB5b3Ugd2lzaCB0byBmaXggYmVmb3JlCgkvLyBzZXR0aW5nIG9yIGdldHRpbmcgdGhlIHZhbHVlCgljc3NQcm9wczogewoJCSJmbG9hdCI6ICJjc3NGbG9hdCIKCX0sCgoJLy8gR2V0IGFuZCBzZXQgdGhlIHN0eWxlIHByb3BlcnR5IG9uIGEgRE9NIE5vZGUKCXN0eWxlOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIGV4dHJhICkgewoKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gR2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbiwgdGhlbiB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gQ29udmVydCAiKz0iIG9yICItPSIgdG8gcmVsYXRpdmUgbnVtYmVycyAoIzczNDUpCgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgbnVsbCBhbmQgTmFOIHZhbHVlcyBhcmVuJ3Qgc2V0ICgjNzExNikKCQkJaWYgKCB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlICE9PSB2YWx1ZSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIsIGFkZCAncHgnIHRvIHRoZSAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQoJCQlpZiAoIHR5cGUgPT09ICJudW1iZXIiICYmICFqUXVlcnkuY3NzTnVtYmVyWyBvcmlnTmFtZSBdICkgewoJCQkJdmFsdWUgKz0gInB4IjsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU5LTExKwoJCQkvLyBiYWNrZ3JvdW5kLSogcHJvcHMgYWZmZWN0IG9yaWdpbmFsIGNsb25lJ3MgdmFsdWVzCgkJCWlmICggIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoICJiYWNrZ3JvdW5kIiApID09PSAwICkgewoJCQkJc3R5bGVbIG5hbWUgXSA9ICJpbmhlcml0IjsKCQkJfQoKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8ICh2YWx1ZSA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gdmFsdWU7CgkJCX0KCgkJfSBlbHNlIHsKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgZmFsc2UsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgoJCQkvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdAoJCQlyZXR1cm4gc3R5bGVbIG5hbWUgXTsKCQl9Cgl9LAoKCWNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMgKSB7CgkJdmFyIHZhbCwgbnVtLCBob29rcywKCQkJb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICk7CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggZWxlbS5zdHlsZSwgb3JpZ05hbWUgKSApOwoKCQkvLyBUcnkgcHJlZml4ZWQgbmFtZSBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCBuYW1lCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy8gQ29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQoJCWlmICggdmFsID09PSAibm9ybWFsIiAmJiBuYW1lIGluIGNzc05vcm1hbFRyYW5zZm9ybSApIHsKCQkJdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtWyBuYW1lIF07CgkJfQoKCQkvLyBNYWtlIG51bWVyaWMgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfQp9KTsKCmpRdWVyeS5lYWNoKFsgImhlaWdodCIsICJ3aWR0aCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CglqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCwgZXh0cmEgKSB7CgkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJLy8gQ2VydGFpbiBlbGVtZW50cyBjYW4gaGF2ZSBkaW1lbnNpb24gaW5mbyBpZiB3ZSBpbnZpc2libHkgc2hvdyB0aGVtCgkJCQkvLyBidXQgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdAoJCQkJcmV0dXJuIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApICYmIGVsZW0ub2Zmc2V0V2lkdGggPT09IDAgPwoJCQkJCWpRdWVyeS5zd2FwKCBlbGVtLCBjc3NTaG93LCBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCQkJfSkgOgoJCQkJCWdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCX0KCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSB7CgkJCXZhciBzdHlsZXMgPSBleHRyYSAmJiBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJcmV0dXJuIHNldFBvc2l0aXZlTnVtYmVyKCBlbGVtLCB2YWx1ZSwgZXh0cmEgPwoJCQkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCQkJZWxlbSwKCQkJCQluYW1lLAoJCQkJCWV4dHJhLAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IiwKCQkJCQlzdHlsZXMKCQkJCSkgOiAwCgkJCSk7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwpqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSBhZGRHZXRIb29rSWYoIHN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCwKCWZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQlpZiAoIGNvbXB1dGVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJY3VyQ1NTLCBbIGVsZW0sICJtYXJnaW5SaWdodCIgXSApOwoJCX0KCX0KKTsKCi8vIFRoZXNlIGhvb2tzIGFyZSB1c2VkIGJ5IGFuaW1hdGUgdG8gZXhwYW5kIHByb3BlcnRpZXMKalF1ZXJ5LmVhY2goewoJbWFyZ2luOiAiIiwKCXBhZGRpbmc6ICIiLAoJYm9yZGVyOiAiV2lkdGgiCn0sIGZ1bmN0aW9uKCBwcmVmaXgsIHN1ZmZpeCApIHsKCWpRdWVyeS5jc3NIb29rc1sgcHJlZml4ICsgc3VmZml4IF0gPSB7CgkJZXhwYW5kOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBpID0gMCwKCQkJCWV4cGFuZGVkID0ge30sCgoJCQkJLy8gQXNzdW1lcyBhIHNpbmdsZSBudW1iZXIgaWYgbm90IGEgc3RyaW5nCgkJCQlwYXJ0cyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZS5zcGxpdCgiICIpIDogWyB2YWx1ZSBdOwoKCQkJZm9yICggOyBpIDwgNDsgaSsrICkgewoJCQkJZXhwYW5kZWRbIHByZWZpeCArIGNzc0V4cGFuZFsgaSBdICsgc3VmZml4IF0gPQoJCQkJCXBhcnRzWyBpIF0gfHwgcGFydHNbIGkgLSAyIF0gfHwgcGFydHNbIDAgXTsKCQkJfQoKCQkJcmV0dXJuIGV4cGFuZGVkOwoJCX0KCX07CgoJaWYgKCAhcm1hcmdpbi50ZXN0KCBwcmVmaXggKSApIHsKCQlqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdLnNldCA9IHNldFBvc2l0aXZlTnVtYmVyOwoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJY3NzOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgc3R5bGVzLCBsZW4sCgkJCQltYXAgPSB7fSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggbmFtZSApICkgewoJCQkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICk7CgkJCQlsZW4gPSBuYW1lLmxlbmd0aDsKCgkJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCQltYXBbIG5hbWVbIGkgXSBdID0galF1ZXJ5LmNzcyggZWxlbSwgbmFtZVsgaSBdLCBmYWxzZSwgc3R5bGVzICk7CgkJCQl9CgoJCQkJcmV0dXJuIG1hcDsKCQkJfQoKCQkJcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lLCB2YWx1ZSApIDoKCQkJCWpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsKCQl9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCglzaG93OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsKCX0sCgloaWRlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsKCX0sCgl0b2dnbGU6IGZ1bmN0aW9uKCBzdGF0ZSApIHsKCQlpZiAoIHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iICkgewoJCQlyZXR1cm4gc3RhdGUgPyB0aGlzLnNob3coKSA6IHRoaXMuaGlkZSgpOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJaWYgKCBpc0hpZGRlbiggdGhpcyApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuc2hvdygpOwoJCQl9IGVsc2UgewoJCQkJalF1ZXJ5KCB0aGlzICkuaGlkZSgpOwoJCQl9CgkJfSk7Cgl9Cn0pOwoKCmZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsKCXJldHVybiBuZXcgVHdlZW4ucHJvdG90eXBlLmluaXQoIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICk7Cn0KalF1ZXJ5LlR3ZWVuID0gVHdlZW47CgpUd2Vlbi5wcm90b3R5cGUgPSB7Cgljb25zdHJ1Y3RvcjogVHdlZW4sCglpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7CgkJdGhpcy5lbGVtID0gZWxlbTsKCQl0aGlzLnByb3AgPSBwcm9wOwoJCXRoaXMuZWFzaW5nID0gZWFzaW5nIHx8ICJzd2luZyI7CgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCQl0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpOwoJCXRoaXMuZW5kID0gZW5kOwoJCXRoaXMudW5pdCA9IHVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCX0sCgljdXI6IGZ1bmN0aW9uKCkgewoJCXZhciBob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCXJldHVybiBob29rcyAmJiBob29rcy5nZXQgPwoJCQlob29rcy5nZXQoIHRoaXMgKSA6CgkJCVR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQoIHRoaXMgKTsKCX0sCglydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgewoJCXZhciBlYXNlZCwKCQkJaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsKCQkJdGhpcy5wb3MgPSBlYXNlZCA9IGpRdWVyeS5lYXNpbmdbIHRoaXMuZWFzaW5nIF0oCgkJCQlwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24KCQkJKTsKCQl9IGVsc2UgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0gcGVyY2VudDsKCQl9CgkJdGhpcy5ub3cgPSAoIHRoaXMuZW5kIC0gdGhpcy5zdGFydCApICogZWFzZWQgKyB0aGlzLnN0YXJ0OwoKCQlpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkgewoJCQl0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7CgkJfQoKCQlpZiAoIGhvb2tzICYmIGhvb2tzLnNldCApIHsKCQkJaG9va3Muc2V0KCB0aGlzICk7CgkJfSBlbHNlIHsKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LnNldCggdGhpcyApOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KfTsKClR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsKClR3ZWVuLnByb3BIb29rcyA9IHsKCV9kZWZhdWx0OiB7CgkJZ2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCXZhciByZXN1bHQ7CgoJCQlpZiAoIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmCgkJCQkoIXR3ZWVuLmVsZW0uc3R5bGUgfHwgdHdlZW4uZWxlbS5zdHlsZVsgdHdlZW4ucHJvcCBdID09IG51bGwpICkgewoJCQkJcmV0dXJuIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXTsKCQkJfQoKCQkJLy8gUGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CgkJCS8vIGF0dGVtcHQgYSBwYXJzZUZsb2F0IGFuZCBmYWxsYmFjayB0byBhIHN0cmluZyBpZiB0aGUgcGFyc2UgZmFpbHMuCgkJCS8vIFNpbXBsZSB2YWx1ZXMgc3VjaCBhcyAiMTBweCIgYXJlIHBhcnNlZCB0byBGbG9hdDsKCQkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMtaXMuCgkJCXJlc3VsdCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiICk7CgkJCS8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4KCQkJcmV0dXJuICFyZXN1bHQgfHwgcmVzdWx0ID09PSAiYXV0byIgPyAwIDogcmVzdWx0OwoJCX0sCgkJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCS8vIFVzZSBzdGVwIGhvb2sgZm9yIGJhY2sgY29tcGF0LgoJCQkvLyBVc2UgY3NzSG9vayBpZiBpdHMgdGhlcmUuCgkJCS8vIFVzZSAuc3R5bGUgaWYgYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUuCgkJCWlmICggalF1ZXJ5LmZ4LnN0ZXBbIHR3ZWVuLnByb3AgXSApIHsKCQkJCWpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0oIHR3ZWVuICk7CgkJCX0gZWxzZSBpZiAoIHR3ZWVuLmVsZW0uc3R5bGUgJiYgKCB0d2Vlbi5lbGVtLnN0eWxlWyBqUXVlcnkuY3NzUHJvcHNbIHR3ZWVuLnByb3AgXSBdICE9IG51bGwgfHwgalF1ZXJ5LmNzc0hvb2tzWyB0d2Vlbi5wcm9wIF0gKSApIHsKCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgdHdlZW4ubm93ICsgdHdlZW4udW5pdCApOwoJCQl9IGVsc2UgewoJCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCQl9CgkJfQoJfQp9OwoKLy8gU3VwcG9ydDogSUU5Ci8vIFBhbmljIGJhc2VkIGFwcHJvYWNoIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwpUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsVG9wID0gVHdlZW4ucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7CglzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQlpZiAoIHR3ZWVuLmVsZW0ubm9kZVR5cGUgJiYgdHdlZW4uZWxlbS5wYXJlbnROb2RlICkgewoJCQl0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF0gPSB0d2Vlbi5ub3c7CgkJfQoJfQp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCAqIE1hdGguUEkgKSAvIDI7Cgl9Cn07CgpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKCi8vIEJhY2sgQ29tcGF0IDwxLjggZXh0ZW5zaW9uIHBvaW50CmpRdWVyeS5meC5zdGVwID0ge307CgoKCgp2YXIKCWZ4Tm93LCB0aW1lcklkLAoJcmZ4dHlwZXMgPSAvXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sCglyZnhudW0gPSBuZXcgUmVnRXhwKCAiXig/OihbKy1dKT18KSgiICsgcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFsgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCQl2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdW5pdCA9IHBhcnRzICYmIHBhcnRzWyAzIF0gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKSwKCgkJCQkvLyBTdGFydGluZyB2YWx1ZSBjb21wdXRhdGlvbiBpcyByZXF1aXJlZCBmb3IgcG90ZW50aWFsIHVuaXQgbWlzbWF0Y2hlcwoJCQkJc3RhcnQgPSAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSB8fCB1bml0ICE9PSAicHgiICYmICt0YXJnZXQgKSAmJgoJCQkJCXJmeG51bS5leGVjKCBqUXVlcnkuY3NzKCB0d2Vlbi5lbGVtLCBwcm9wICkgKSwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggc3RhcnQgJiYgc3RhcnRbIDMgXSAhPT0gdW5pdCApIHsKCQkJCS8vIFRydXN0IHVuaXRzIHJlcG9ydGVkIGJ5IGpRdWVyeS5jc3MKCQkJCXVuaXQgPSB1bml0IHx8IHN0YXJ0WyAzIF07CgoJCQkJLy8gTWFrZSBzdXJlIHdlIHVwZGF0ZSB0aGUgdHdlZW4gcHJvcGVydGllcyBsYXRlciBvbgoJCQkJcGFydHMgPSBwYXJ0cyB8fCBbXTsKCgkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJc3RhcnQgPSArdGFyZ2V0IHx8IDE7CgoJCQkJZG8gewoJCQkJCS8vIElmIHByZXZpb3VzIGl0ZXJhdGlvbiB6ZXJvZWQgb3V0LCBkb3VibGUgdW50aWwgd2UgZ2V0ICpzb21ldGhpbmcqLgoJCQkJCS8vIFVzZSBzdHJpbmcgZm9yIGRvdWJsaW5nIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSBzZWUgc2NhbGUgYXMgdW5jaGFuZ2VkIGJlbG93CgkJCQkJc2NhbGUgPSBzY2FsZSB8fCAiLjUiOwoKCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJc3RhcnQgPSBzdGFydCAvIHNjYWxlOwoJCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgcHJvcCwgc3RhcnQgKyB1bml0ICk7CgoJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCksCgkJCQkvLyBicmVhayB0aGUgbG9vcCBpZiBzY2FsZSBpcyB1bmNoYW5nZWQgb3IgcGVyZmVjdCwgb3IgaWYgd2UndmUganVzdCBoYWQgZW5vdWdoCgkJCQl9IHdoaWxlICggc2NhbGUgIT09IChzY2FsZSA9IHR3ZWVuLmN1cigpIC8gdGFyZ2V0KSAmJiBzY2FsZSAhPT0gMSAmJiAtLW1heEl0ZXJhdGlvbnMgKTsKCQkJfQoKCQkJLy8gVXBkYXRlIHR3ZWVuIHByb3BlcnRpZXMKCQkJaWYgKCBwYXJ0cyApIHsKCQkJCXN0YXJ0ID0gdHdlZW4uc3RhcnQgPSArc3RhcnQgfHwgK3RhcmdldCB8fCAwOwoJCQkJdHdlZW4udW5pdCA9IHVuaXQ7CgkJCQkvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24KCQkJCXR3ZWVuLmVuZCA9IHBhcnRzWyAxIF0gPwoJCQkJCXN0YXJ0ICsgKCBwYXJ0c1sgMSBdICsgMSApICogcGFydHNbIDIgXSA6CgkJCQkJK3BhcnRzWyAyIF07CgkJCX0KCgkJCXJldHVybiB0d2VlbjsKCQl9IF0KCX07CgovLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5CmZ1bmN0aW9uIGNyZWF0ZUZ4Tm93KCkgewoJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQlmeE5vdyA9IHVuZGVmaW5lZDsKCX0pOwoJcmV0dXJuICggZnhOb3cgPSBqUXVlcnkubm93KCkgKTsKfQoKLy8gR2VuZXJhdGUgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBzdGFuZGFyZCBhbmltYXRpb24KZnVuY3Rpb24gZ2VuRngoIHR5cGUsIGluY2x1ZGVXaWR0aCApIHsKCXZhciB3aGljaCwKCQlpID0gMCwKCQlhdHRycyA9IHsgaGVpZ2h0OiB0eXBlIH07CgoJLy8gSWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAoJLy8gb3RoZXJ3aXNlIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aCA/IDEgOiAwOwoJZm9yICggOyBpIDwgNCA7IGkgKz0gMiAtIGluY2x1ZGVXaWR0aCApIHsKCQl3aGljaCA9IGNzc0V4cGFuZFsgaSBdOwoJCWF0dHJzWyAibWFyZ2luIiArIHdoaWNoIF0gPSBhdHRyc1sgInBhZGRpbmciICsgd2hpY2ggXSA9IHR5cGU7Cgl9CgoJaWYgKCBpbmNsdWRlV2lkdGggKSB7CgkJYXR0cnMub3BhY2l0eSA9IGF0dHJzLndpZHRoID0gdHlwZTsKCX0KCglyZXR1cm4gYXR0cnM7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVuKCB2YWx1ZSwgcHJvcCwgYW5pbWF0aW9uICkgewoJdmFyIHR3ZWVuLAoJCWNvbGxlY3Rpb24gPSAoIHR3ZWVuZXJzWyBwcm9wIF0gfHwgW10gKS5jb25jYXQoIHR3ZWVuZXJzWyAiKiIgXSApLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJaWYgKCAodHdlZW4gPSBjb2xsZWN0aW9uWyBpbmRleCBdLmNhbGwoIGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUgKSkgKSB7CgoJCQkvLyBXZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQoJCQlyZXR1cm4gdHdlZW47CgkJfQoJfQp9CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KCXZhciBwcm9wLCB2YWx1ZSwgdG9nZ2xlLCB0d2VlbiwgaG9va3MsIG9sZGZpcmUsIGRpc3BsYXksIGNoZWNrRGlzcGxheSwKCQlhbmltID0gdGhpcywKCQlvcmlnID0ge30sCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCWhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKSwKCQlkYXRhU2hvdyA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJmeHNob3ciICk7CgoJLy8gSGFuZGxlIHF1ZXVlOiBmYWxzZSBwcm9taXNlcwoJaWYgKCAhb3B0cy5xdWV1ZSApIHsKCQlob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyggZWxlbSwgImZ4IiApOwoJCWlmICggaG9va3MudW5xdWV1ZWQgPT0gbnVsbCApIHsKCQkJaG9va3MudW5xdWV1ZWQgPSAwOwoJCQlvbGRmaXJlID0gaG9va3MuZW1wdHkuZmlyZTsKCQkJaG9va3MuZW1wdHkuZmlyZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhaG9va3MudW5xdWV1ZWQgKSB7CgkJCQkJb2xkZmlyZSgpOwoJCQkJfQoJCQl9OwoJCX0KCQlob29rcy51bnF1ZXVlZCsrOwoKCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJLy8gRW5zdXJlIHRoZSBjb21wbGV0ZSBoYW5kbGVyIGlzIGNhbGxlZCBiZWZvcmUgdGhpcyBjb21wbGV0ZXMKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlob29rcy51bnF1ZXVlZC0tOwoJCQkJaWYgKCAhalF1ZXJ5LnF1ZXVlKCBlbGVtLCAiZngiICkubGVuZ3RoICkgewoJCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJCX0KCQkJfSk7CgkJfSk7Cgl9CgoJLy8gSGVpZ2h0L3dpZHRoIG92ZXJmbG93IHBhc3MKCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoICJoZWlnaHQiIGluIHByb3BzIHx8ICJ3aWR0aCIgaW4gcHJvcHMgKSApIHsKCQkvLyBNYWtlIHN1cmUgdGhhdCBub3RoaW5nIHNuZWFrcyBvdXQKCQkvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFOS0xMCBkbyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICk7CgoJCS8vIFRlc3QgZGVmYXVsdCBkaXNwbGF5IGlmIGRpc3BsYXkgaXMgY3VycmVudGx5ICJub25lIgoJCWNoZWNrRGlzcGxheSA9IGRpc3BsYXkgPT09ICJub25lIiA/CgkJCWRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApIHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5OwoKCQlpZiAoIGNoZWNrRGlzcGxheSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgkJCXN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCXN0eWxlLm92ZXJmbG93ID0gb3B0cy5vdmVyZmxvd1sgMCBdOwoJCQlzdHlsZS5vdmVyZmxvd1ggPSBvcHRzLm92ZXJmbG93WyAxIF07CgkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQl9KTsKCX0KCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggcHJvcCBpbiBwcm9wcyApIHsKCQl2YWx1ZSA9IHByb3BzWyBwcm9wIF07CgkJaWYgKCByZnh0eXBlcy5leGVjKCB2YWx1ZSApICkgewoJCQlkZWxldGUgcHJvcHNbIHByb3AgXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCgkJCQkvLyBJZiB0aGVyZSBpcyBkYXRhU2hvdyBsZWZ0IG92ZXIgZnJvbSBhIHN0b3BwZWQgaGlkZSBvciBzaG93IGFuZCB3ZSBhcmUgZ29pbmcgdG8gcHJvY2VlZCB3aXRoIHNob3csIHdlIHNob3VsZCBwcmV0ZW5kIHRvIGJlIGhpZGRlbgoJCQkJaWYgKCB2YWx1ZSA9PT0gInNob3ciICYmIGRhdGFTaG93ICYmIGRhdGFTaG93WyBwcm9wIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQloaWRkZW4gPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJfQoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvdyAmJiBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkvLyBBbnkgbm9uLWZ4IHZhbHVlIHN0b3BzIHVzIGZyb20gcmVzdG9yaW5nIHRoZSBvcmlnaW5hbCBkaXNwbGF5IHZhbHVlCgkJfSBlbHNlIHsKCQkJZGlzcGxheSA9IHVuZGVmaW5lZDsKCQl9Cgl9CgoJaWYgKCAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9yaWcgKSApIHsKCQlpZiAoIGRhdGFTaG93ICkgewoJCQlpZiAoICJoaWRkZW4iIGluIGRhdGFTaG93ICkgewoJCQkJaGlkZGVuID0gZGF0YVNob3cuaGlkZGVuOwoJCQl9CgkJfSBlbHNlIHsKCQkJZGF0YVNob3cgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAiZnhzaG93Iiwge30gKTsKCQl9CgoJCS8vIFN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCgkJCWRhdGFfcHJpdi5yZW1vdmUoIGVsZW0sICJmeHNob3ciICk7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCwgb3JpZ1sgcHJvcCBdICk7CgkJCX0KCQl9KTsKCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCXR3ZWVuID0gY3JlYXRlVHdlZW4oIGhpZGRlbiA/IGRhdGFTaG93WyBwcm9wIF0gOiAwLCBwcm9wLCBhbmltICk7CgoJCQlpZiAoICEoIHByb3AgaW4gZGF0YVNob3cgKSApIHsKCQkJCWRhdGFTaG93WyBwcm9wIF0gPSB0d2Vlbi5zdGFydDsKCQkJCWlmICggaGlkZGVuICkgewoJCQkJCXR3ZWVuLmVuZCA9IHR3ZWVuLnN0YXJ0OwoJCQkJCXR3ZWVuLnN0YXJ0ID0gcHJvcCA9PT0gIndpZHRoIiB8fCBwcm9wID09PSAiaGVpZ2h0IiA/IDEgOiAwOwoJCQkJfQoJCQl9CgkJfQoKCS8vIElmIHRoaXMgaXMgYSBub29wIGxpa2UgLmhpZGUoKS5oaWRlKCksIHJlc3RvcmUgYW4gb3ZlcndyaXR0ZW4gZGlzcGxheSB2YWx1ZQoJfSBlbHNlIGlmICggKGRpc3BsYXkgPT09ICJub25lIiA/IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5KSA9PT0gImlubGluZSIgKSB7CgkJc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cgl9Cn0KCmZ1bmN0aW9uIHByb3BGaWx0ZXIoIHByb3BzLCBzcGVjaWFsRWFzaW5nICkgewoJdmFyIGluZGV4LCBuYW1lLCBlYXNpbmcsIHZhbHVlLCBob29rczsKCgkvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MKCWZvciAoIGluZGV4IGluIHByb3BzICkgewoJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBpbmRleCApOwoJCWVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsKCQl2YWx1ZSA9IHByb3BzWyBpbmRleCBdOwoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCWVhc2luZyA9IHZhbHVlWyAxIF07CgkJCXZhbHVlID0gcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgMCBdOwoJCX0KCgkJaWYgKCBpbmRleCAhPT0gbmFtZSApIHsKCQkJcHJvcHNbIG5hbWUgXSA9IHZhbHVlOwoJCQlkZWxldGUgcHJvcHNbIGluZGV4IF07CgkJfQoKCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdOwoJCWlmICggaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MgKSB7CgkJCXZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOwoJCQlkZWxldGUgcHJvcHNbIG5hbWUgXTsKCgkJCS8vIE5vdCBxdWl0ZSAkLmV4dGVuZCwgdGhpcyB3b24ndCBvdmVyd3JpdGUgZXhpc3Rpbmcga2V5cy4KCQkJLy8gUmV1c2luZyAnaW5kZXgnIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCQkJZm9yICggaW5kZXggaW4gdmFsdWUgKSB7CgkJCQlpZiAoICEoIGluZGV4IGluIHByb3BzICkgKSB7CgkJCQkJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsKCQkJCQlzcGVjaWFsRWFzaW5nWyBpbmRleCBdID0gZWFzaW5nOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJc3BlY2lhbEVhc2luZ1sgbmFtZSBdID0gZWFzaW5nOwoJCX0KCX0KfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIERvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwoJCQkJLy8gQXJjaGFpYyBjcmFzaCBidWcgd29uJ3QgYWxsb3cgdXMgdG8gdXNlIGAxIC0gKCAwLjUgfHwgMCApYCAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIElmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gUmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZTsgb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCglqUXVlcnkubWFwKCBwcm9wcywgY3JlYXRlVHdlZW4sIGFuaW1hdGlvbiApOwoKCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGFuaW1hdGlvbi5vcHRzLnN0YXJ0ICkgKSB7CgkJYW5pbWF0aW9uLm9wdHMuc3RhcnQuY2FsbCggZWxlbSwgYW5pbWF0aW9uICk7Cgl9CgoJalF1ZXJ5LmZ4LnRpbWVyKAoJCWpRdWVyeS5leHRlbmQoIHRpY2ssIHsKCQkJZWxlbTogZWxlbSwKCQkJYW5pbTogYW5pbWF0aW9uLAoJCQlxdWV1ZTogYW5pbWF0aW9uLm9wdHMucXVldWUKCQl9KQoJKTsKCgkvLyBhdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwoJcmV0dXJuIGFuaW1hdGlvbi5wcm9ncmVzcyggYW5pbWF0aW9uLm9wdHMucHJvZ3Jlc3MgKQoJCS5kb25lKCBhbmltYXRpb24ub3B0cy5kb25lLCBhbmltYXRpb24ub3B0cy5jb21wbGV0ZSApCgkJLmZhaWwoIGFuaW1hdGlvbi5vcHRzLmZhaWwgKQoJCS5hbHdheXMoIGFuaW1hdGlvbi5vcHRzLmFsd2F5cyApOwp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpqUXVlcnkuc3BlZWQgPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgZm4gKSB7Cgl2YXIgb3B0ID0gc3BlZWQgJiYgdHlwZW9mIHNwZWVkID09PSAib2JqZWN0IiA/IGpRdWVyeS5leHRlbmQoIHt9LCBzcGVlZCApIDogewoJCWNvbXBsZXRlOiBmbiB8fCAhZm4gJiYgZWFzaW5nIHx8CgkJCWpRdWVyeS5pc0Z1bmN0aW9uKCBzcGVlZCApICYmIHNwZWVkLAoJCWR1cmF0aW9uOiBzcGVlZCwKCQllYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKCBlYXNpbmcgKSAmJiBlYXNpbmcKCX07CgoJb3B0LmR1cmF0aW9uID0galF1ZXJ5LmZ4Lm9mZiA/IDAgOiB0eXBlb2Ygb3B0LmR1cmF0aW9uID09PSAibnVtYmVyIiA/IG9wdC5kdXJhdGlvbiA6CgkJb3B0LmR1cmF0aW9uIGluIGpRdWVyeS5meC5zcGVlZHMgPyBqUXVlcnkuZnguc3BlZWRzWyBvcHQuZHVyYXRpb24gXSA6IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7CgoJLy8gTm9ybWFsaXplIG9wdC5xdWV1ZSAtIHRydWUvdW5kZWZpbmVkL251bGwgLT4gImZ4IgoJaWYgKCBvcHQucXVldWUgPT0gbnVsbCB8fCBvcHQucXVldWUgPT09IHRydWUgKSB7CgkJb3B0LnF1ZXVlID0gImZ4IjsKCX0KCgkvLyBRdWV1ZWluZwoJb3B0Lm9sZCA9IG9wdC5jb21wbGV0ZTsKCglvcHQuY29tcGxldGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHQub2xkICkgKSB7CgkJCW9wdC5vbGQuY2FsbCggdGhpcyApOwoJCX0KCgkJaWYgKCBvcHQucXVldWUgKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCBvcHQucXVldWUgKTsKCQl9Cgl9OwoKCXJldHVybiBvcHQ7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZhZGVUbzogZnVuY3Rpb24oIHNwZWVkLCB0bywgZWFzaW5nLCBjYWxsYmFjayApIHsKCgkJLy8gU2hvdyBhbnkgaGlkZGVuIGVsZW1lbnRzIGFmdGVyIHNldHRpbmcgb3BhY2l0eSB0byAwCgkJcmV0dXJuIHRoaXMuZmlsdGVyKCBpc0hpZGRlbiApLmNzcyggIm9wYWNpdHkiLCAwICkuc2hvdygpCgoJCQkvLyBBbmltYXRlIHRvIHRoZSB2YWx1ZSBzcGVjaWZpZWQKCQkJLmVuZCgpLmFuaW1hdGUoeyBvcGFjaXR5OiB0byB9LCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfSwKCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQl2YXIgZW1wdHkgPSBqUXVlcnkuaXNFbXB0eU9iamVjdCggcHJvcCApLAoJCQlvcHRhbGwgPSBqUXVlcnkuc3BlZWQoIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICksCgkJCWRvQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7CgkJCQkvLyBPcGVyYXRlIG9uIGEgY29weSBvZiBwcm9wIHNvIHBlci1wcm9wZXJ0eSBlYXNpbmcgd29uJ3QgYmUgbG9zdAoJCQkJdmFyIGFuaW0gPSBBbmltYXRpb24oIHRoaXMsIGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wICksIG9wdGFsbCApOwoKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBkYXRhX3ByaXYuZ2V0KCB0aGlzLCAiZmluaXNoIiApICkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfQoJCQl9OwoJCQlkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsKCgkJcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPwoJCQl0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOgoJCQl0aGlzLnF1ZXVlKCBvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uICk7Cgl9LAoJc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7CgkJdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uKCBob29rcyApIHsKCQkJdmFyIHN0b3AgPSBob29rcy5zdG9wOwoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJc3RvcCggZ290b0VuZCApOwoJCX07CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlnb3RvRW5kID0gY2xlYXJRdWV1ZTsKCQkJY2xlYXJRdWV1ZSA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsKCQkJdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGRlcXVldWUgPSB0cnVlLAoJCQkJaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKCQkJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApOwoKCQkJaWYgKCBpbmRleCApIHsKCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgKSB7CgkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpbmRleCBpbiBkYXRhICkgewoJCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgJiYgcnJ1bi50ZXN0KCBpbmRleCApICkgewoJCQkJCQlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmICh0eXBlID09IG51bGwgfHwgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlKSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCBnb3RvRW5kICk7CgkJCQkJZGVxdWV1ZSA9IGZhbHNlOwoJCQkJCXRpbWVycy5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQl9CgkJCX0KCgkJCS8vIFN0YXJ0IHRoZSBuZXh0IGluIHRoZSBxdWV1ZSBpZiB0aGUgbGFzdCBzdGVwIHdhc24ndCBmb3JjZWQuCgkJCS8vIFRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2gKCQkJLy8gd2lsbCBkZXF1ZXVlIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kLgoJCQlpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQl9CgkJfSk7Cgl9LAoJZmluaXNoOiBmdW5jdGlvbiggdHlwZSApIHsKCQlpZiAoIHR5cGUgIT09IGZhbHNlICkgewoJCQl0eXBlID0gdHlwZSB8fCAiZngiOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaW5kZXgsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApLAoJCQkJcXVldWUgPSBkYXRhWyB0eXBlICsgInF1ZXVlIiBdLAoJCQkJaG9va3MgPSBkYXRhWyB0eXBlICsgInF1ZXVlSG9va3MiIF0sCgkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJbGVuZ3RoID0gcXVldWUgPyBxdWV1ZS5sZW5ndGggOiAwOwoKCQkJLy8gRW5hYmxlIGZpbmlzaGluZyBmbGFnIG9uIHByaXZhdGUgZGF0YQoJCQlkYXRhLmZpbmlzaCA9IHRydWU7CgoJCQkvLyBFbXB0eSB0aGUgcXVldWUgZmlyc3QKCQkJalF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBbXSApOwoKCQkJaWYgKCBob29rcyAmJiBob29rcy5zdG9wICkgewoJCQkJaG9va3Muc3RvcC5jYWxsKCB0aGlzLCB0cnVlICk7CgkJCX0KCgkJCS8vIExvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCB0cnVlICk7CgkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCX0KCQkJfQoKCQkJLy8gTG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQkJCWlmICggcXVldWVbIGluZGV4IF0gJiYgcXVldWVbIGluZGV4IF0uZmluaXNoICkgewoJCQkJCXF1ZXVlWyBpbmRleCBdLmZpbmlzaC5jYWxsKCB0aGlzICk7CgkJCQl9CgkJCX0KCgkJCS8vIFR1cm4gb2ZmIGZpbmlzaGluZyBmbGFnCgkJCWRlbGV0ZSBkYXRhLmZpbmlzaDsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZWFjaChbICJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCXZhciBjc3NGbiA9IGpRdWVyeS5mblsgbmFtZSBdOwoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHNwZWVkID09IG51bGwgfHwgdHlwZW9mIHNwZWVkID09PSAiYm9vbGVhbiIgPwoJCQljc3NGbi5hcHBseSggdGhpcywgYXJndW1lbnRzICkgOgoJCQl0aGlzLmFuaW1hdGUoIGdlbkZ4KCBuYW1lLCB0cnVlICksIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7Cgl9Owp9KTsKCi8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnMKalF1ZXJ5LmVhY2goewoJc2xpZGVEb3duOiBnZW5GeCgic2hvdyIpLAoJc2xpZGVVcDogZ2VuRngoImhpZGUiKSwKCXNsaWRlVG9nZ2xlOiBnZW5GeCgidG9nZ2xlIiksCglmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCglmYWRlT3V0OiB7IG9wYWNpdHk6ICJoaWRlIiB9LAoJZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiAidG9nZ2xlIiB9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiB0aGlzLmFuaW1hdGUoIHByb3BzLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSk7CgpqUXVlcnkudGltZXJzID0gW107CmpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24oKSB7Cgl2YXIgdGltZXIsCgkJaSA9IDAsCgkJdGltZXJzID0galF1ZXJ5LnRpbWVyczsKCglmeE5vdyA9IGpRdWVyeS5ub3coKTsKCglmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7CgkJdGltZXIgPSB0aW1lcnNbIGkgXTsKCQkvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWQKCQlpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHsKCQkJdGltZXJzLnNwbGljZSggaS0tLCAxICk7CgkJfQoJfQoKCWlmICggIXRpbWVycy5sZW5ndGggKSB7CgkJalF1ZXJ5LmZ4LnN0b3AoKTsKCX0KCWZ4Tm93ID0gdW5kZWZpbmVkOwp9OwoKalF1ZXJ5LmZ4LnRpbWVyID0gZnVuY3Rpb24oIHRpbWVyICkgewoJalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApOwoJaWYgKCB0aW1lcigpICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfSBlbHNlIHsKCQlqUXVlcnkudGltZXJzLnBvcCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKCi8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KLy8gaHR0cDovL2JsaW5kc2lnbmFscy5jb20vaW5kZXgucGhwLzIwMDkvMDcvanF1ZXJ5LWRlbGF5LwpqUXVlcnkuZm4uZGVsYXkgPSBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCXRpbWUgPSBqUXVlcnkuZnggPyBqUXVlcnkuZnguc3BlZWRzWyB0aW1lIF0gfHwgdGltZSA6IHRpbWU7Cgl0eXBlID0gdHlwZSB8fCAiZngiOwoKCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCBuZXh0LCB0aW1lICk7CgkJaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgewoJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQl9OwoJfSk7Cn07CgoKKGZ1bmN0aW9uKCkgewoJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApLAoJCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJzZWxlY3QiICksCgkJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAib3B0aW9uIiApICk7CgoJaW5wdXQudHlwZSA9ICJjaGVja2JveCI7CgoJLy8gU3VwcG9ydDogaU9TPD01LjEsIEFuZHJvaWQ8PTQuMisKCS8vIERlZmF1bHQgdmFsdWUgZm9yIGEgY2hlY2tib3ggc2hvdWxkIGJlICJvbiIKCXN1cHBvcnQuY2hlY2tPbiA9IGlucHV0LnZhbHVlICE9PSAiIjsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNdXN0IGFjY2VzcyBzZWxlY3RlZEluZGV4IHRvIG1ha2UgZGVmYXVsdCBvcHRpb25zIHNlbGVjdAoJc3VwcG9ydC5vcHRTZWxlY3RlZCA9IG9wdC5zZWxlY3RlZDsKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPD0yLjMKCS8vIE9wdGlvbnMgaW5zaWRlIGRpc2FibGVkIHNlbGVjdHMgYXJlIGluY29ycmVjdGx5IG1hcmtlZCBhcyBkaXNhYmxlZAoJc2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKCXN1cHBvcnQub3B0RGlzYWJsZWQgPSAhb3B0LmRpc2FibGVkOwoKCS8vIFN1cHBvcnQ6IElFPD0xMSsKCS8vIEFuIGlucHV0IGxvc2VzIGl0cyB2YWx1ZSBhZnRlciBiZWNvbWluZyBhIHJhZGlvCglpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQudHlwZSA9ICJyYWRpbyI7CglzdXBwb3J0LnJhZGlvVmFsdWUgPSBpbnB1dC52YWx1ZSA9PT0gInQiOwp9KSgpOwoKCnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglhdHRySGFuZGxlID0galF1ZXJ5LmV4cHIuYXR0ckhhbmRsZTsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5hdHRyLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlQXR0cjogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIHRoaXMsIG5hbWUgKTsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCWF0dHI6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gc3RydW5kZWZpbmVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUsIHZhbHVlICk7CgkJfQoKCQkvLyBBbGwgYXR0cmlidXRlcyBhcmUgbG93ZXJjYXNlCgkJLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZAoJCWlmICggblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApICkgewoJCQluYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlob29rcyA9IGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSB8fAoJCQkJKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnRlc3QoIG5hbWUgKSA/IGJvb2xIb29rIDogbm9kZUhvb2sgKTsKCQl9CgoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggdmFsdWUgPT09IG51bGwgKSB7CgkJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoKCQkJfSBlbHNlIGlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIHZhbHVlICsgIiIgKTsKCQkJCXJldHVybiB2YWx1ZTsKCQkJfQoKCQl9IGVsc2UgaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoJCQlyZXQgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkvLyBOb24tZXhpc3RlbnQgYXR0cmlidXRlcyByZXR1cm4gbnVsbCwgd2Ugbm9ybWFsaXplIHRvIHVuZGVmaW5lZAoJCQlyZXR1cm4gcmV0ID09IG51bGwgPwoJCQkJdW5kZWZpbmVkIDoKCQkJCXJldDsKCQl9Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQl2YXIgbmFtZSwgcHJvcE5hbWUsCgkJCWkgPSAwLAoJCQlhdHRyTmFtZXMgPSB2YWx1ZSAmJiB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApICkgewoJCQkJCS8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlCgkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJfQoKCQkJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCBuYW1lICk7CgkJCX0KCQl9Cgl9LAoKCWF0dHJIb29rczogewoJCXR5cGU6IHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoICFzdXBwb3J0LnJhZGlvVmFsdWUgJiYgdmFsdWUgPT09ICJyYWRpbyIgJiYKCQkJCQlqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0pOwoKLy8gSG9va3MgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkvLyBSZW1vdmUgYm9vbGVhbiBhdHRyaWJ1dGVzIHdoZW4gc2V0IHRvIGZhbHNlCgkJCWpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7CgkJfSBlbHNlIHsKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUgKTsKCQl9CgkJcmV0dXJuIG5hbWU7Cgl9Cn07CmpRdWVyeS5lYWNoKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCggL1x3Ky9nICksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGdldHRlciA9IGF0dHJIYW5kbGVbIG5hbWUgXSB8fCBqUXVlcnkuZmluZC5hdHRyOwoKCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQl2YXIgcmV0LCBoYW5kbGU7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCS8vIEF2b2lkIGFuIGluZmluaXRlIGxvb3AgYnkgdGVtcG9yYXJpbHkgcmVtb3ZpbmcgdGhpcyBmdW5jdGlvbiBmcm9tIHRoZSBnZXR0ZXIKCQkJaGFuZGxlID0gYXR0ckhhbmRsZVsgbmFtZSBdOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSByZXQ7CgkJCXJldCA9IGdldHRlciggZWxlbSwgbmFtZSwgaXNYTUwgKSAhPSBudWxsID8KCQkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCQludWxsOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSBoYW5kbGU7CgkJfQoJCXJldHVybiByZXQ7Cgl9Owp9KTsKCgoKCnZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaTsKCmpRdWVyeS5mbi5leHRlbmQoewoJcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5wcm9wLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJZGVsZXRlIHRoaXNbIGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZSBdOwoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJcHJvcEZpeDogewoJCSJmb3IiOiAiaHRtbEZvciIsCgkJImNsYXNzIjogImNsYXNzTmFtZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gRG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiBob29rcyAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkID8KCQkJCXJldCA6CgkJCQkoIGVsZW1bIG5hbWUgXSA9IHZhbHVlICk7CgoJCX0gZWxzZSB7CgkJCXJldHVybiBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsID8KCQkJCXJldCA6CgkJCQllbGVtWyBuYW1lIF07CgkJfQoJfSwKCglwcm9wSG9va3M6IHsKCQl0YWJJbmRleDogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uaGFzQXR0cmlidXRlKCAidGFiaW5kZXgiICkgfHwgcmZvY3VzYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgfHwgZWxlbS5ocmVmID8KCQkJCQllbGVtLnRhYkluZGV4IDoKCQkJCQktMTsKCQkJfQoJCX0KCX0KfSk7CgppZiAoICFzdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoJCQlpZiAoIHBhcmVudCAmJiBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCXBhcmVudC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJfTsKfQoKalF1ZXJ5LmVhY2goWwoJInRhYkluZGV4IiwKCSJyZWFkT25seSIsCgkibWF4TGVuZ3RoIiwKCSJjZWxsU3BhY2luZyIsCgkiY2VsbFBhZGRpbmciLAoJInJvd1NwYW4iLAoJImNvbFNwYW4iLAoJInVzZU1hcCIsCgkiZnJhbWVCb3JkZXIiLAoJImNvbnRlbnRFZGl0YWJsZSIKXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkucHJvcEZpeFsgdGhpcy50b0xvd2VyQ2FzZSgpIF0gPSB0aGlzOwp9KTsKCgoKCnZhciByY2xhc3MgPSAvW1x0XHJcblxmXS9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglhZGRDbGFzczogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGNsYXp6LCBqLCBmaW5hbFZhbHVlLAoJCQlwcm9jZWVkID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuYWRkQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHByb2NlZWQgKSB7CgkJCS8vIFRoZSBkaXNqdW5jdGlvbiBoZXJlIGlzIGZvciBiZXR0ZXIgY29tcHJlc3NpYmlsaXR5IChzZWUgcmVtb3ZlQ2xhc3MpCgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQllbGVtID0gdGhpc1sgaSBdOwoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiAiCgkJCQkpOwoKCQkJCWlmICggY3VyICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSApIHsKCQkJCQkJaWYgKCBjdXIuaW5kZXhPZiggIiAiICsgY2xhenogKyAiICIgKSA8IDAgKSB7CgkJCQkJCQljdXIgKz0gY2xhenogKyAiICI7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIG9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IGpRdWVyeS50cmltKCBjdXIgKTsKCQkJCQlpZiAoIGVsZW0uY2xhc3NOYW1lICE9PSBmaW5hbFZhbHVlICkgewoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IGZpbmFsVmFsdWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgY2xhc3NlcywgZWxlbSwgY3VyLCBjbGF6eiwgaiwgZmluYWxWYWx1ZSwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVtb3ZlQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoJCWlmICggcHJvY2VlZCApIHsKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IHZhbHVlID8galF1ZXJ5LnRyaW0oIGN1ciApIDogIiI7CgkJCQkJaWYgKCBlbGVtLmNsYXNzTmFtZSAhPT0gZmluYWxWYWx1ZSApIHsKCQkJCQkJZWxlbS5jbGFzc05hbWUgPSBmaW5hbFZhbHVlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkgewoJCXZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQlpZiAoIHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gc3RhdGVWYWwgPyB0aGlzLmFkZENsYXNzKCB2YWx1ZSApIDogdGhpcy5yZW1vdmVDbGFzcyggdmFsdWUgKTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBpLCB0aGlzLmNsYXNzTmFtZSwgc3RhdGVWYWwpLCBzdGF0ZVZhbCApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCQkvLyBUb2dnbGUgaW5kaXZpZHVhbCBjbGFzcyBuYW1lcwoJCQkJdmFyIGNsYXNzTmFtZSwKCQkJCQlpID0gMCwKCQkJCQlzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCQl3aGlsZSAoIChjbGFzc05hbWUgPSBjbGFzc05hbWVzWyBpKysgXSkgKSB7CgkJCQkJLy8gQ2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGFyYXRlZCBsaXN0CgkJCQkJaWYgKCBzZWxmLmhhc0NsYXNzKCBjbGFzc05hbWUgKSApIHsKCQkJCQkJc2VsZi5yZW1vdmVDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJc2VsZi5hZGRDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfQoJCQkJfQoKCQkJLy8gVG9nZ2xlIHdob2xlIGNsYXNzIG5hbWUKCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gc3RydW5kZWZpbmVkIHx8IHR5cGUgPT09ICJib29sZWFuIiApIHsKCQkJCWlmICggdGhpcy5jbGFzc05hbWUgKSB7CgkJCQkJLy8gc3RvcmUgY2xhc3NOYW1lIGlmIHNldAoJCQkJCWRhdGFfcHJpdi5zZXQoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCBgZmFsc2VgLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogZGF0YV9wcml2LmdldCggdGhpcywgIl9fY2xhc3NOYW1lX18iICkgfHwgIiI7CgkJCX0KCQl9KTsKCX0sCgoJaGFzQ2xhc3M6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgY2xhc3NOYW1lID0gIiAiICsgc2VsZWN0b3IgKyAiICIsCgkJCWkgPSAwLAoJCQlsID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlpZiAoIHRoaXNbaV0ubm9kZVR5cGUgPT09IDEgJiYgKCIgIiArIHRoaXNbaV0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKS5pbmRleE9mKCBjbGFzc05hbWUgKSA+PSAwICkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KfSk7CgoKCgp2YXIgcnJldHVybiA9IC9cci9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7Cgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIEhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIEhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbDsKCgkJCWlmICggdGhpcy5ub2RlVHlwZSAhPT0gMSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJdmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgalF1ZXJ5KCB0aGlzICkudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsKCQkJCXZhbCArPSAiIjsKCgkJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWwgKSApIHsKCQkJCXZhbCA9IGpRdWVyeS5tYXAoIHZhbCwgZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCXJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSArICIiOwoJCQkJfSk7CgkJCX0KCgkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyB0aGlzLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgaG9va3Muc2V0KCB0aGlzLCB2YWwsICJ2YWx1ZSIgKSA9PT0gdW5kZWZpbmVkICkgewoJCQkJdGhpcy52YWx1ZSA9IHZhbDsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJdmFsSG9va3M6IHsKCQlvcHRpb246IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciB2YWwgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCAidmFsdWUiICk7CgkJCQlyZXR1cm4gdmFsICE9IG51bGwgPwoJCQkJCXZhbCA6CgkJCQkJLy8gU3VwcG9ydDogSUUxMC0xMSsKCQkJCQkvLyBvcHRpb24udGV4dCB0aHJvd3MgZXhjZXB0aW9ucyAoIzE0Njg2LCAjMTQ4NTgpCgkJCQkJalF1ZXJ5LnRyaW0oIGpRdWVyeS50ZXh0KCBlbGVtICkgKTsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIElFNi05IGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBzdXBwb3J0Lm9wdERpc2FibGVkID8gIW9wdGlvbi5kaXNhYmxlZCA6IG9wdGlvbi5nZXRBdHRyaWJ1dGUoICJkaXNhYmxlZCIgKSA9PT0gbnVsbCApICYmCgkJCQkJCQkoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fCAhalF1ZXJ5Lm5vZGVOYW1lKCBvcHRpb24ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIiApICkgKSB7CgoJCQkJCQkvLyBHZXQgdGhlIHNwZWNpZmljIHZhbHVlIGZvciB0aGUgb3B0aW9uCgkJCQkJCXZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTsKCgkJCQkJCS8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzCgkJCQkJCWlmICggb25lICkgewoJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQl9CgoJCQkJCQkvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheQoJCQkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJdmFyIG9wdGlvblNldCwgb3B0aW9uLAoJCQkJCW9wdGlvbnMgPSBlbGVtLm9wdGlvbnMsCgkJCQkJdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKSwKCQkJCQlpID0gb3B0aW9ucy5sZW5ndGg7CgoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoJCQkJCWlmICggKG9wdGlvbi5zZWxlY3RlZCA9IGpRdWVyeS5pbkFycmF5KCBvcHRpb24udmFsdWUsIHZhbHVlcyApID49IDApICkgewoJCQkJCQlvcHRpb25TZXQgPSB0cnVlOwoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGb3JjZSBicm93c2VycyB0byBiZWhhdmUgY29uc2lzdGVudGx5IHdoZW4gbm9uLW1hdGNoaW5nIHZhbHVlIGlzIHNldAoJCQkJaWYgKCAhb3B0aW9uU2V0ICkgewoJCQkJCWVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xOwoJCQkJfQoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfQoJCX0KCX0KfSk7CgovLyBSYWRpb3MgYW5kIGNoZWNrYm94ZXMgZ2V0dGVyL3NldHRlcgpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJCXJldHVybiAoIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkoZWxlbSkudmFsKCksIHZhbHVlICkgPj0gMCApOwoJCQl9CgkJfQoJfTsKCWlmICggIXN1cHBvcnQuY2hlY2tPbiApIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXS5nZXQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CgkJfTsKCX0KfSk7CgoKCgovLyBSZXR1cm4galF1ZXJ5IGZvciBhdHRyaWJ1dGVzLW9ubHkgaW5jbHVzaW9uCgoKalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJaG92ZXI6IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJCXJldHVybiB0aGlzLm1vdXNlZW50ZXIoIGZuT3ZlciApLm1vdXNlbGVhdmUoIGZuT3V0IHx8IGZuT3ZlciApOwoJfSwKCgliaW5kOiBmdW5jdGlvbiggdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTsKCX0sCgl1bmJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZm4gKSB7CgkJcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTsKCX0sCgoJZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7Cgl9LAoJdW5kZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZm4gKSB7CgkJLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKQoJCXJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOiB0aGlzLm9mZiggdHlwZXMsIHNlbGVjdG9yIHx8ICIqKiIsIGZuICk7Cgl9Cn0pOwoKCnZhciBub25jZSA9IGpRdWVyeS5ub3coKTsKCnZhciBycXVlcnkgPSAoL1w/Lyk7CgoKCi8vIFN1cHBvcnQ6IEFuZHJvaWQgMi4zCi8vIFdvcmthcm91bmQgZmFpbHVyZSB0byBzdHJpbmctY2FzdCBudWxsIGlucHV0CmpRdWVyeS5wYXJzZUpTT04gPSBmdW5jdGlvbiggZGF0YSApIHsKCXJldHVybiBKU09OLnBhcnNlKCBkYXRhICsgIiIgKTsKfTsKCgovLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCmpRdWVyeS5wYXJzZVhNTCA9IGZ1bmN0aW9uKCBkYXRhICkgewoJdmFyIHhtbCwgdG1wOwoJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJcmV0dXJuIG51bGw7Cgl9CgoJLy8gU3VwcG9ydDogSUU5Cgl0cnkgewoJCXRtcCA9IG5ldyBET01QYXJzZXIoKTsKCQl4bWwgPSB0bXAucGFyc2VGcm9tU3RyaW5nKCBkYXRhLCAidGV4dC94bWwiICk7Cgl9IGNhdGNoICggZSApIHsKCQl4bWwgPSB1bmRlZmluZWQ7Cgl9CgoJaWYgKCAheG1sIHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsKCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCX0KCXJldHVybiB4bWw7Cn07CgoKdmFyCglyaGFzaCA9IC8jLiokLywKCXJ0cyA9IC8oWz8mXSlfPVteJl0qLywKCXJoZWFkZXJzID0gL14oLio/KTpbIFx0XSooW15cclxuXSopJC9tZywKCS8vICM3NjUzLCAjODEyNSwgIzgxNTI6IGxvY2FsIHByb3RvY29sIGRldGVjdGlvbgoJcmxvY2FsUHJvdG9jb2wgPSAvXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLywKCXJub0NvbnRlbnQgPSAvXig/OkdFVHxIRUFEKSQvLAoJcnByb3RvY29sID0gL15cL1wvLywKCXJ1cmwgPSAvXihbXHcuKy1dKzopKD86XC9cLyg/OlteXC8/I10qQHwpKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKCgkvKiBQcmVmaWx0ZXJzCgkgKiAxKSBUaGV5IGFyZSB1c2VmdWwgdG8gaW50cm9kdWNlIGN1c3RvbSBkYXRhVHlwZXMgKHNlZSBhamF4L2pzb25wLmpzIGZvciBhbiBleGFtcGxlKQoJICogMikgVGhlc2UgYXJlIGNhbGxlZDoKCSAqICAgIC0gQkVGT1JFIGFza2luZyBmb3IgYSB0cmFuc3BvcnQKCSAqICAgIC0gQUZURVIgcGFyYW0gc2VyaWFsaXphdGlvbiAocy5kYXRhIGlzIGEgc3RyaW5nIGlmIHMucHJvY2Vzc0RhdGEgaXMgdHJ1ZSkKCSAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDQpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiA1KSBleGVjdXRpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBjb250aW51ZSBkb3duIHRvICIqIiBpZiBuZWVkZWQKCSAqLwoJcHJlZmlsdGVycyA9IHt9LAoKCS8qIFRyYW5zcG9ydHMgYmluZGluZ3MKCSAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDIpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiAzKSBzZWxlY3Rpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBnbyB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXRyYW5zcG9ydHMgPSB7fSwKCgkvLyBBdm9pZCBjb21tZW50LXByb2xvZyBjaGFyIHNlcXVlbmNlICgjMTAwOTgpOyBtdXN0IGFwcGVhc2UgbGludCBhbmQgZXZhZGUgY29tcHJlc3Npb24KCWFsbFR5cGVzID0gIiovIi5jb25jYXQoICIqIiApLAoKCS8vIERvY3VtZW50IGxvY2F0aW9uCglhamF4TG9jYXRpb24gPSB3aW5kb3cubG9jYXRpb24uaHJlZiwKCgkvLyBTZWdtZW50IGxvY2F0aW9uIGludG8gcGFydHMKCWFqYXhMb2NQYXJ0cyA9IHJ1cmwuZXhlYyggYWpheExvY2F0aW9uLnRvTG93ZXJDYXNlKCkgKSB8fCBbXTsKCi8vIEJhc2UgImNvbnN0cnVjdG9yIiBmb3IgalF1ZXJ5LmFqYXhQcmVmaWx0ZXIgYW5kIGpRdWVyeS5hamF4VHJhbnNwb3J0CmZ1bmN0aW9uIGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggc3RydWN0dXJlICkgewoKCS8vIGRhdGFUeXBlRXhwcmVzc2lvbiBpcyBvcHRpb25hbCBhbmQgZGVmYXVsdHMgdG8gIioiCglyZXR1cm4gZnVuY3Rpb24oIGRhdGFUeXBlRXhwcmVzc2lvbiwgZnVuYyApIHsKCgkJaWYgKCB0eXBlb2YgZGF0YVR5cGVFeHByZXNzaW9uICE9PSAic3RyaW5nIiApIHsKCQkJZnVuYyA9IGRhdGFUeXBlRXhwcmVzc2lvbjsKCQkJZGF0YVR5cGVFeHByZXNzaW9uID0gIioiOwoJCX0KCgkJdmFyIGRhdGFUeXBlLAoJCQlpID0gMCwKCQkJZGF0YVR5cGVzID0gZGF0YVR5cGVFeHByZXNzaW9uLnRvTG93ZXJDYXNlKCkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBmdW5jICkgKSB7CgkJCS8vIEZvciBlYWNoIGRhdGFUeXBlIGluIHRoZSBkYXRhVHlwZUV4cHJlc3Npb24KCQkJd2hpbGUgKCAoZGF0YVR5cGUgPSBkYXRhVHlwZXNbaSsrXSkgKSB7CgkJCQkvLyBQcmVwZW5kIGlmIHJlcXVlc3RlZAoJCQkJaWYgKCBkYXRhVHlwZVswXSA9PT0gIisiICkgewoJCQkJCWRhdGFUeXBlID0gZGF0YVR5cGUuc2xpY2UoIDEgKSB8fCAiKiI7CgkJCQkJKHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSkudW5zaGlmdCggZnVuYyApOwoKCQkJCS8vIE90aGVyd2lzZSBhcHBlbmQKCQkJCX0gZWxzZSB7CgkJCQkJKHN0cnVjdHVyZVsgZGF0YVR5cGUgXSA9IHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSkucHVzaCggZnVuYyApOwoJCQkJfQoJCQl9CgkJfQoJfTsKfQoKLy8gQmFzZSBpbnNwZWN0aW9uIGZ1bmN0aW9uIGZvciBwcmVmaWx0ZXJzIGFuZCB0cmFuc3BvcnRzCmZ1bmN0aW9uIGluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUsIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIgKSB7CgoJdmFyIGluc3BlY3RlZCA9IHt9LAoJCXNlZWtpbmdUcmFuc3BvcnQgPSAoIHN0cnVjdHVyZSA9PT0gdHJhbnNwb3J0cyApOwoKCWZ1bmN0aW9uIGluc3BlY3QoIGRhdGFUeXBlICkgewoJCXZhciBzZWxlY3RlZDsKCQlpbnNwZWN0ZWRbIGRhdGFUeXBlIF0gPSB0cnVlOwoJCWpRdWVyeS5lYWNoKCBzdHJ1Y3R1cmVbIGRhdGFUeXBlIF0gfHwgW10sIGZ1bmN0aW9uKCBfLCBwcmVmaWx0ZXJPckZhY3RvcnkgKSB7CgkJCXZhciBkYXRhVHlwZU9yVHJhbnNwb3J0ID0gcHJlZmlsdGVyT3JGYWN0b3J5KCBvcHRpb25zLCBvcmlnaW5hbE9wdGlvbnMsIGpxWEhSICk7CgkJCWlmICggdHlwZW9mIGRhdGFUeXBlT3JUcmFuc3BvcnQgPT09ICJzdHJpbmciICYmICFzZWVraW5nVHJhbnNwb3J0ICYmICFpbnNwZWN0ZWRbIGRhdGFUeXBlT3JUcmFuc3BvcnQgXSApIHsKCQkJCW9wdGlvbnMuZGF0YVR5cGVzLnVuc2hpZnQoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCWluc3BlY3QoIGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJCXJldHVybiBmYWxzZTsKCQkJfSBlbHNlIGlmICggc2Vla2luZ1RyYW5zcG9ydCApIHsKCQkJCXJldHVybiAhKCBzZWxlY3RlZCA9IGRhdGFUeXBlT3JUcmFuc3BvcnQgKTsKCQkJfQoJCX0pOwoJCXJldHVybiBzZWxlY3RlZDsKCX0KCglyZXR1cm4gaW5zcGVjdCggb3B0aW9ucy5kYXRhVHlwZXNbIDAgXSApIHx8ICFpbnNwZWN0ZWRbICIqIiBdICYmIGluc3BlY3QoICIqIiApOwp9CgovLyBBIHNwZWNpYWwgZXh0ZW5kIGZvciBhamF4IG9wdGlvbnMKLy8gdGhhdCB0YWtlcyAiZmxhdCIgb3B0aW9ucyAobm90IHRvIGJlIGRlZXAgZXh0ZW5kZWQpCi8vIEZpeGVzICM5ODg3CmZ1bmN0aW9uIGFqYXhFeHRlbmQoIHRhcmdldCwgc3JjICkgewoJdmFyIGtleSwgZGVlcCwKCQlmbGF0T3B0aW9ucyA9IGpRdWVyeS5hamF4U2V0dGluZ3MuZmxhdE9wdGlvbnMgfHwge307CgoJZm9yICgga2V5IGluIHNyYyApIHsKCQlpZiAoIHNyY1sga2V5IF0gIT09IHVuZGVmaW5lZCApIHsKCQkJKCBmbGF0T3B0aW9uc1sga2V5IF0gPyB0YXJnZXQgOiAoIGRlZXAgfHwgKGRlZXAgPSB7fSkgKSApWyBrZXkgXSA9IHNyY1sga2V5IF07CgkJfQoJfQoJaWYgKCBkZWVwICkgewoJCWpRdWVyeS5leHRlbmQoIHRydWUsIHRhcmdldCwgZGVlcCApOwoJfQoKCXJldHVybiB0YXJnZXQ7Cn0KCi8qIEhhbmRsZXMgcmVzcG9uc2VzIHRvIGFuIGFqYXggcmVxdWVzdDoKICogLSBmaW5kcyB0aGUgcmlnaHQgZGF0YVR5cGUgKG1lZGlhdGVzIGJldHdlZW4gY29udGVudC10eXBlIGFuZCBleHBlY3RlZCBkYXRhVHlwZSkKICogLSByZXR1cm5zIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCiAqLwpmdW5jdGlvbiBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICkgewoKCXZhciBjdCwgdHlwZSwgZmluYWxEYXRhVHlwZSwgZmlyc3REYXRhVHlwZSwKCQljb250ZW50cyA9IHMuY29udGVudHMsCgkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXM7CgoJLy8gUmVtb3ZlIGF1dG8gZGF0YVR5cGUgYW5kIGdldCBjb250ZW50LXR5cGUgaW4gdGhlIHByb2Nlc3MKCXdoaWxlICggZGF0YVR5cGVzWyAwIF0gPT09ICIqIiApIHsKCQlkYXRhVHlwZXMuc2hpZnQoKTsKCQlpZiAoIGN0ID09PSB1bmRlZmluZWQgKSB7CgkJCWN0ID0gcy5taW1lVHlwZSB8fCBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiQ29udGVudC1UeXBlIik7CgkJfQoJfQoKCS8vIENoZWNrIGlmIHdlJ3JlIGRlYWxpbmcgd2l0aCBhIGtub3duIGNvbnRlbnQtdHlwZQoJaWYgKCBjdCApIHsKCQlmb3IgKCB0eXBlIGluIGNvbnRlbnRzICkgewoJCQlpZiAoIGNvbnRlbnRzWyB0eXBlIF0gJiYgY29udGVudHNbIHR5cGUgXS50ZXN0KCBjdCApICkgewoJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHR5cGUgKTsKCQkJCWJyZWFrOwoJCQl9CgkJfQoJfQoKCS8vIENoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcmVzcG9uc2UgZm9yIHRoZSBleHBlY3RlZCBkYXRhVHlwZQoJaWYgKCBkYXRhVHlwZXNbIDAgXSBpbiByZXNwb25zZXMgKSB7CgkJZmluYWxEYXRhVHlwZSA9IGRhdGFUeXBlc1sgMCBdOwoJfSBlbHNlIHsKCQkvLyBUcnkgY29udmVydGlibGUgZGF0YVR5cGVzCgkJZm9yICggdHlwZSBpbiByZXNwb25zZXMgKSB7CgkJCWlmICggIWRhdGFUeXBlc1sgMCBdIHx8IHMuY29udmVydGVyc1sgdHlwZSArICIgIiArIGRhdGFUeXBlc1swXSBdICkgewoJCQkJZmluYWxEYXRhVHlwZSA9IHR5cGU7CgkJCQlicmVhazsKCQkJfQoJCQlpZiAoICFmaXJzdERhdGFUeXBlICkgewoJCQkJZmlyc3REYXRhVHlwZSA9IHR5cGU7CgkJCX0KCQl9CgkJLy8gT3IganVzdCB1c2UgZmlyc3Qgb25lCgkJZmluYWxEYXRhVHlwZSA9IGZpbmFsRGF0YVR5cGUgfHwgZmlyc3REYXRhVHlwZTsKCX0KCgkvLyBJZiB3ZSBmb3VuZCBhIGRhdGFUeXBlCgkvLyBXZSBhZGQgdGhlIGRhdGFUeXBlIHRvIHRoZSBsaXN0IGlmIG5lZWRlZAoJLy8gYW5kIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyByZXNwb25zZQoJaWYgKCBmaW5hbERhdGFUeXBlICkgewoJCWlmICggZmluYWxEYXRhVHlwZSAhPT0gZGF0YVR5cGVzWyAwIF0gKSB7CgkJCWRhdGFUeXBlcy51bnNoaWZ0KCBmaW5hbERhdGFUeXBlICk7CgkJfQoJCXJldHVybiByZXNwb25zZXNbIGZpbmFsRGF0YVR5cGUgXTsKCX0KfQoKLyogQ2hhaW4gY29udmVyc2lvbnMgZ2l2ZW4gdGhlIHJlcXVlc3QgYW5kIHRoZSBvcmlnaW5hbCByZXNwb25zZQogKiBBbHNvIHNldHMgdGhlIHJlc3BvbnNlWFhYIGZpZWxkcyBvbiB0aGUganFYSFIgaW5zdGFuY2UKICovCmZ1bmN0aW9uIGFqYXhDb252ZXJ0KCBzLCByZXNwb25zZSwganFYSFIsIGlzU3VjY2VzcyApIHsKCXZhciBjb252MiwgY3VycmVudCwgY29udiwgdG1wLCBwcmV2LAoJCWNvbnZlcnRlcnMgPSB7fSwKCQkvLyBXb3JrIHdpdGggYSBjb3B5IG9mIGRhdGFUeXBlcyBpbiBjYXNlIHdlIG5lZWQgdG8gbW9kaWZ5IGl0IGZvciBjb252ZXJzaW9uCgkJZGF0YVR5cGVzID0gcy5kYXRhVHlwZXMuc2xpY2UoKTsKCgkvLyBDcmVhdGUgY29udmVydGVycyBtYXAgd2l0aCBsb3dlcmNhc2VkIGtleXMKCWlmICggZGF0YVR5cGVzWyAxIF0gKSB7CgkJZm9yICggY29udiBpbiBzLmNvbnZlcnRlcnMgKSB7CgkJCWNvbnZlcnRlcnNbIGNvbnYudG9Mb3dlckNhc2UoKSBdID0gcy5jb252ZXJ0ZXJzWyBjb252IF07CgkJfQoJfQoKCWN1cnJlbnQgPSBkYXRhVHlwZXMuc2hpZnQoKTsKCgkvLyBDb252ZXJ0IHRvIGVhY2ggc2VxdWVudGlhbCBkYXRhVHlwZQoJd2hpbGUgKCBjdXJyZW50ICkgewoKCQlpZiAoIHMucmVzcG9uc2VGaWVsZHNbIGN1cnJlbnQgXSApIHsKCQkJanFYSFJbIHMucmVzcG9uc2VGaWVsZHNbIGN1cnJlbnQgXSBdID0gcmVzcG9uc2U7CgkJfQoKCQkvLyBBcHBseSB0aGUgZGF0YUZpbHRlciBpZiBwcm92aWRlZAoJCWlmICggIXByZXYgJiYgaXNTdWNjZXNzICYmIHMuZGF0YUZpbHRlciApIHsKCQkJcmVzcG9uc2UgPSBzLmRhdGFGaWx0ZXIoIHJlc3BvbnNlLCBzLmRhdGFUeXBlICk7CgkJfQoKCQlwcmV2ID0gY3VycmVudDsKCQljdXJyZW50ID0gZGF0YVR5cGVzLnNoaWZ0KCk7CgoJCWlmICggY3VycmVudCApIHsKCgkJLy8gVGhlcmUncyBvbmx5IHdvcmsgdG8gZG8gaWYgY3VycmVudCBkYXRhVHlwZSBpcyBub24tYXV0bwoJCQlpZiAoIGN1cnJlbnQgPT09ICIqIiApIHsKCgkJCQljdXJyZW50ID0gcHJldjsKCgkJCS8vIENvbnZlcnQgcmVzcG9uc2UgaWYgcHJldiBkYXRhVHlwZSBpcyBub24tYXV0byBhbmQgZGlmZmVycyBmcm9tIGN1cnJlbnQKCQkJfSBlbHNlIGlmICggcHJldiAhPT0gIioiICYmIHByZXYgIT09IGN1cnJlbnQgKSB7CgoJCQkJLy8gU2VlayBhIGRpcmVjdCBjb252ZXJ0ZXIKCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgY3VycmVudCBdIHx8IGNvbnZlcnRlcnNbICIqICIgKyBjdXJyZW50IF07CgoJCQkJLy8gSWYgbm9uZSBmb3VuZCwgc2VlayBhIHBhaXIKCQkJCWlmICggIWNvbnYgKSB7CgkJCQkJZm9yICggY29udjIgaW4gY29udmVydGVycyApIHsKCgkJCQkJCS8vIElmIGNvbnYyIG91dHB1dHMgY3VycmVudAoJCQkJCQl0bXAgPSBjb252Mi5zcGxpdCggIiAiICk7CgkJCQkJCWlmICggdG1wWyAxIF0gPT09IGN1cnJlbnQgKSB7CgoJCQkJCQkJLy8gSWYgcHJldiBjYW4gYmUgY29udmVydGVkIHRvIGFjY2VwdGVkIGlucHV0CgkJCQkJCQljb252ID0gY29udmVydGVyc1sgcHJldiArICIgIiArIHRtcFsgMCBdIF0gfHwKCQkJCQkJCQljb252ZXJ0ZXJzWyAiKiAiICsgdG1wWyAwIF0gXTsKCQkJCQkJCWlmICggY29udiApIHsKCQkJCQkJCQkvLyBDb25kZW5zZSBlcXVpdmFsZW5jZSBjb252ZXJ0ZXJzCgkJCQkJCQkJaWYgKCBjb252ID09PSB0cnVlICkgewoJCQkJCQkJCQljb252ID0gY29udmVydGVyc1sgY29udjIgXTsKCgkJCQkJCQkJLy8gT3RoZXJ3aXNlLCBpbnNlcnQgdGhlIGludGVybWVkaWF0ZSBkYXRhVHlwZQoJCQkJCQkJCX0gZWxzZSBpZiAoIGNvbnZlcnRlcnNbIGNvbnYyIF0gIT09IHRydWUgKSB7CgkJCQkJCQkJCWN1cnJlbnQgPSB0bXBbIDAgXTsKCQkJCQkJCQkJZGF0YVR5cGVzLnVuc2hpZnQoIHRtcFsgMSBdICk7CgkJCQkJCQkJfQoJCQkJCQkJCWJyZWFrOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCS8vIEFwcGx5IGNvbnZlcnRlciAoaWYgbm90IGFuIGVxdWl2YWxlbmNlKQoJCQkJaWYgKCBjb252ICE9PSB0cnVlICkgewoKCQkJCQkvLyBVbmxlc3MgZXJyb3JzIGFyZSBhbGxvd2VkIHRvIGJ1YmJsZSwgY2F0Y2ggYW5kIHJldHVybiB0aGVtCgkJCQkJaWYgKCBjb252ICYmIHNbICJ0aHJvd3MiIF0gKSB7CgkJCQkJCXJlc3BvbnNlID0gY29udiggcmVzcG9uc2UgKTsKCQkJCQl9IGVsc2UgewoJCQkJCQl0cnkgewoJCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCQl9IGNhdGNoICggZSApIHsKCQkJCQkJCXJldHVybiB7IHN0YXRlOiAicGFyc2VyZXJyb3IiLCBlcnJvcjogY29udiA/IGUgOiAiTm8gY29udmVyc2lvbiBmcm9tICIgKyBwcmV2ICsgIiB0byAiICsgY3VycmVudCB9OwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoJfQoKCXJldHVybiB7IHN0YXRlOiAic3VjY2VzcyIsIGRhdGE6IHJlc3BvbnNlIH07Cn0KCmpRdWVyeS5leHRlbmQoewoKCS8vIENvdW50ZXIgZm9yIGhvbGRpbmcgdGhlIG51bWJlciBvZiBhY3RpdmUgcXVlcmllcwoJYWN0aXZlOiAwLAoKCS8vIExhc3QtTW9kaWZpZWQgaGVhZGVyIGNhY2hlIGZvciBuZXh0IHJlcXVlc3QKCWxhc3RNb2RpZmllZDoge30sCglldGFnOiB7fSwKCglhamF4U2V0dGluZ3M6IHsKCQl1cmw6IGFqYXhMb2NhdGlvbiwKCQl0eXBlOiAiR0VUIiwKCQlpc0xvY2FsOiBybG9jYWxQcm90b2NvbC50ZXN0KCBhamF4TG9jUGFydHNbIDEgXSApLAoJCWdsb2JhbDogdHJ1ZSwKCQlwcm9jZXNzRGF0YTogdHJ1ZSwKCQlhc3luYzogdHJ1ZSwKCQljb250ZW50VHlwZTogImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCIsCgkJLyoKCQl0aW1lb3V0OiAwLAoJCWRhdGE6IG51bGwsCgkJZGF0YVR5cGU6IG51bGwsCgkJdXNlcm5hbWU6IG51bGwsCgkJcGFzc3dvcmQ6IG51bGwsCgkJY2FjaGU6IG51bGwsCgkJdGhyb3dzOiBmYWxzZSwKCQl0cmFkaXRpb25hbDogZmFsc2UsCgkJaGVhZGVyczoge30sCgkJKi8KCgkJYWNjZXB0czogewoJCQkiKiI6IGFsbFR5cGVzLAoJCQl0ZXh0OiAidGV4dC9wbGFpbiIsCgkJCWh0bWw6ICJ0ZXh0L2h0bWwiLAoJCQl4bWw6ICJhcHBsaWNhdGlvbi94bWwsIHRleHQveG1sIiwKCQkJanNvbjogImFwcGxpY2F0aW9uL2pzb24sIHRleHQvamF2YXNjcmlwdCIKCQl9LAoKCQljb250ZW50czogewoJCQl4bWw6IC94bWwvLAoJCQlodG1sOiAvaHRtbC8sCgkJCWpzb246IC9qc29uLwoJCX0sCgoJCXJlc3BvbnNlRmllbGRzOiB7CgkJCXhtbDogInJlc3BvbnNlWE1MIiwKCQkJdGV4dDogInJlc3BvbnNlVGV4dCIsCgkJCWpzb246ICJyZXNwb25zZUpTT04iCgkJfSwKCgkJLy8gRGF0YSBjb252ZXJ0ZXJzCgkJLy8gS2V5cyBzZXBhcmF0ZSBzb3VyY2UgKG9yIGNhdGNoYWxsICIqIikgYW5kIGRlc3RpbmF0aW9uIHR5cGVzIHdpdGggYSBzaW5nbGUgc3BhY2UKCQljb252ZXJ0ZXJzOiB7CgoJCQkvLyBDb252ZXJ0IGFueXRoaW5nIHRvIHRleHQKCQkJIiogdGV4dCI6IFN0cmluZywKCgkJCS8vIFRleHQgdG8gaHRtbCAodHJ1ZSA9IG5vIHRyYW5zZm9ybWF0aW9uKQoJCQkidGV4dCBodG1sIjogdHJ1ZSwKCgkJCS8vIEV2YWx1YXRlIHRleHQgYXMgYSBqc29uIGV4cHJlc3Npb24KCQkJInRleHQganNvbiI6IGpRdWVyeS5wYXJzZUpTT04sCgoJCQkvLyBQYXJzZSB0ZXh0IGFzIHhtbAoJCQkidGV4dCB4bWwiOiBqUXVlcnkucGFyc2VYTUwKCQl9LAoKCQkvLyBGb3Igb3B0aW9ucyB0aGF0IHNob3VsZG4ndCBiZSBkZWVwIGV4dGVuZGVkOgoJCS8vIHlvdSBjYW4gYWRkIHlvdXIgb3duIGN1c3RvbSBvcHRpb25zIGhlcmUgaWYKCQkvLyBhbmQgd2hlbiB5b3UgY3JlYXRlIG9uZSB0aGF0IHNob3VsZG4ndCBiZQoJCS8vIGRlZXAgZXh0ZW5kZWQgKHNlZSBhamF4RXh0ZW5kKQoJCWZsYXRPcHRpb25zOiB7CgkJCXVybDogdHJ1ZSwKCQkJY29udGV4dDogdHJ1ZQoJCX0KCX0sCgoJLy8gQ3JlYXRlcyBhIGZ1bGwgZmxlZGdlZCBzZXR0aW5ncyBvYmplY3QgaW50byB0YXJnZXQKCS8vIHdpdGggYm90aCBhamF4U2V0dGluZ3MgYW5kIHNldHRpbmdzIGZpZWxkcy4KCS8vIElmIHRhcmdldCBpcyBvbWl0dGVkLCB3cml0ZXMgaW50byBhamF4U2V0dGluZ3MuCglhamF4U2V0dXA6IGZ1bmN0aW9uKCB0YXJnZXQsIHNldHRpbmdzICkgewoJCXJldHVybiBzZXR0aW5ncyA/CgoJCQkvLyBCdWlsZGluZyBhIHNldHRpbmdzIG9iamVjdAoJCQlhamF4RXh0ZW5kKCBhamF4RXh0ZW5kKCB0YXJnZXQsIGpRdWVyeS5hamF4U2V0dGluZ3MgKSwgc2V0dGluZ3MgKSA6CgoJCQkvLyBFeHRlbmRpbmcgYWpheFNldHRpbmdzCgkJCWFqYXhFeHRlbmQoIGpRdWVyeS5hamF4U2V0dGluZ3MsIHRhcmdldCApOwoJfSwKCglhamF4UHJlZmlsdGVyOiBhZGRUb1ByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHByZWZpbHRlcnMgKSwKCWFqYXhUcmFuc3BvcnQ6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cyApLAoKCS8vIE1haW4gbWV0aG9kCglhamF4OiBmdW5jdGlvbiggdXJsLCBvcHRpb25zICkgewoKCQkvLyBJZiB1cmwgaXMgYW4gb2JqZWN0LCBzaW11bGF0ZSBwcmUtMS41IHNpZ25hdHVyZQoJCWlmICggdHlwZW9mIHVybCA9PT0gIm9iamVjdCIgKSB7CgkJCW9wdGlvbnMgPSB1cmw7CgkJCXVybCA9IHVuZGVmaW5lZDsKCQl9CgoJCS8vIEZvcmNlIG9wdGlvbnMgdG8gYmUgYW4gb2JqZWN0CgkJb3B0aW9ucyA9IG9wdGlvbnMgfHwge307CgoJCXZhciB0cmFuc3BvcnQsCgkJCS8vIFVSTCB3aXRob3V0IGFudGktY2FjaGUgcGFyYW0KCQkJY2FjaGVVUkwsCgkJCS8vIFJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nLAoJCQlyZXNwb25zZUhlYWRlcnMsCgkJCS8vIHRpbWVvdXQgaGFuZGxlCgkJCXRpbWVvdXRUaW1lciwKCQkJLy8gQ3Jvc3MtZG9tYWluIGRldGVjdGlvbiB2YXJzCgkJCXBhcnRzLAoJCQkvLyBUbyBrbm93IGlmIGdsb2JhbCBldmVudHMgYXJlIHRvIGJlIGRpc3BhdGNoZWQKCQkJZmlyZUdsb2JhbHMsCgkJCS8vIExvb3AgdmFyaWFibGUKCQkJaSwKCQkJLy8gQ3JlYXRlIHRoZSBmaW5hbCBvcHRpb25zIG9iamVjdAoJCQlzID0galF1ZXJ5LmFqYXhTZXR1cCgge30sIG9wdGlvbnMgKSwKCQkJLy8gQ2FsbGJhY2tzIGNvbnRleHQKCQkJY2FsbGJhY2tDb250ZXh0ID0gcy5jb250ZXh0IHx8IHMsCgkJCS8vIENvbnRleHQgZm9yIGdsb2JhbCBldmVudHMgaXMgY2FsbGJhY2tDb250ZXh0IGlmIGl0IGlzIGEgRE9NIG5vZGUgb3IgalF1ZXJ5IGNvbGxlY3Rpb24KCQkJZ2xvYmFsRXZlbnRDb250ZXh0ID0gcy5jb250ZXh0ICYmICggY2FsbGJhY2tDb250ZXh0Lm5vZGVUeXBlIHx8IGNhbGxiYWNrQ29udGV4dC5qcXVlcnkgKSA/CgkJCQlqUXVlcnkoIGNhbGxiYWNrQ29udGV4dCApIDoKCQkJCWpRdWVyeS5ldmVudCwKCQkJLy8gRGVmZXJyZWRzCgkJCWRlZmVycmVkID0galF1ZXJ5LkRlZmVycmVkKCksCgkJCWNvbXBsZXRlRGVmZXJyZWQgPSBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLAoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlzdGF0dXNDb2RlID0gcy5zdGF0dXNDb2RlIHx8IHt9LAoJCQkvLyBIZWFkZXJzICh0aGV5IGFyZSBzZW50IGFsbCBhdCBvbmNlKQoJCQlyZXF1ZXN0SGVhZGVycyA9IHt9LAoJCQlyZXF1ZXN0SGVhZGVyc05hbWVzID0ge30sCgkJCS8vIFRoZSBqcVhIUiBzdGF0ZQoJCQlzdGF0ZSA9IDAsCgkJCS8vIERlZmF1bHQgYWJvcnQgbWVzc2FnZQoJCQlzdHJBYm9ydCA9ICJjYW5jZWxlZCIsCgkJCS8vIEZha2UgeGhyCgkJCWpxWEhSID0gewoJCQkJcmVhZHlTdGF0ZTogMCwKCgkJCQkvLyBCdWlsZHMgaGVhZGVycyBoYXNodGFibGUgaWYgbmVlZGVkCgkJCQlnZXRSZXNwb25zZUhlYWRlcjogZnVuY3Rpb24oIGtleSApIHsKCQkJCQl2YXIgbWF0Y2g7CgkJCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCQkJaWYgKCAhcmVzcG9uc2VIZWFkZXJzICkgewoJCQkJCQkJcmVzcG9uc2VIZWFkZXJzID0ge307CgkJCQkJCQl3aGlsZSAoIChtYXRjaCA9IHJoZWFkZXJzLmV4ZWMoIHJlc3BvbnNlSGVhZGVyc1N0cmluZyApKSApIHsKCQkJCQkJCQlyZXNwb25zZUhlYWRlcnNbIG1hdGNoWzFdLnRvTG93ZXJDYXNlKCkgXSA9IG1hdGNoWyAyIF07CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQkJbWF0Y2ggPSByZXNwb25zZUhlYWRlcnNbIGtleS50b0xvd2VyQ2FzZSgpIF07CgkJCQkJfQoJCQkJCXJldHVybiBtYXRjaCA9PSBudWxsID8gbnVsbCA6IG1hdGNoOwoJCQkJfSwKCgkJCQkvLyBSYXcgc3RyaW5nCgkJCQlnZXRBbGxSZXNwb25zZUhlYWRlcnM6IGZ1bmN0aW9uKCkgewoJCQkJCXJldHVybiBzdGF0ZSA9PT0gMiA/IHJlc3BvbnNlSGVhZGVyc1N0cmluZyA6IG51bGw7CgkJCQl9LAoKCQkJCS8vIENhY2hlcyB0aGUgaGVhZGVyCgkJCQlzZXRSZXF1ZXN0SGVhZGVyOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJCQkJdmFyIGxuYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQkJCWlmICggIXN0YXRlICkgewoJCQkJCQluYW1lID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSA9IHJlcXVlc3RIZWFkZXJzTmFtZXNbIGxuYW1lIF0gfHwgbmFtZTsKCQkJCQkJcmVxdWVzdEhlYWRlcnNbIG5hbWUgXSA9IHZhbHVlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gT3ZlcnJpZGVzIHJlc3BvbnNlIGNvbnRlbnQtdHlwZSBoZWFkZXIKCQkJCW92ZXJyaWRlTWltZVR5cGU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCQkJCWlmICggIXN0YXRlICkgewoJCQkJCQlzLm1pbWVUeXBlID0gdHlwZTsKCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCQlzdGF0dXNDb2RlOiBmdW5jdGlvbiggbWFwICkgewoJCQkJCXZhciBjb2RlOwoJCQkJCWlmICggbWFwICkgewoJCQkJCQlpZiAoIHN0YXRlIDwgMiApIHsKCQkJCQkJCWZvciAoIGNvZGUgaW4gbWFwICkgewoJCQkJCQkJCS8vIExhenktYWRkIHRoZSBuZXcgY2FsbGJhY2sgaW4gYSB3YXkgdGhhdCBwcmVzZXJ2ZXMgb2xkIG9uZXMKCQkJCQkJCQlzdGF0dXNDb2RlWyBjb2RlIF0gPSBbIHN0YXR1c0NvZGVbIGNvZGUgXSwgbWFwWyBjb2RlIF0gXTsKCQkJCQkJCX0KCQkJCQkJfSBlbHNlIHsKCQkJCQkJCS8vIEV4ZWN1dGUgdGhlIGFwcHJvcHJpYXRlIGNhbGxiYWNrcwoJCQkJCQkJanFYSFIuYWx3YXlzKCBtYXBbIGpxWEhSLnN0YXR1cyBdICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoKCQkJCS8vIENhbmNlbCB0aGUgcmVxdWVzdAoJCQkJYWJvcnQ6IGZ1bmN0aW9uKCBzdGF0dXNUZXh0ICkgewoJCQkJCXZhciBmaW5hbFRleHQgPSBzdGF0dXNUZXh0IHx8IHN0ckFib3J0OwoJCQkJCWlmICggdHJhbnNwb3J0ICkgewoJCQkJCQl0cmFuc3BvcnQuYWJvcnQoIGZpbmFsVGV4dCApOwoJCQkJCX0KCQkJCQlkb25lKCAwLCBmaW5hbFRleHQgKTsKCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0KCQkJfTsKCgkJLy8gQXR0YWNoIGRlZmVycmVkcwoJCWRlZmVycmVkLnByb21pc2UoIGpxWEhSICkuY29tcGxldGUgPSBjb21wbGV0ZURlZmVycmVkLmFkZDsKCQlqcVhIUi5zdWNjZXNzID0ganFYSFIuZG9uZTsKCQlqcVhIUi5lcnJvciA9IGpxWEhSLmZhaWw7CgoJCS8vIFJlbW92ZSBoYXNoIGNoYXJhY3RlciAoIzc1MzE6IGFuZCBzdHJpbmcgcHJvbW90aW9uKQoJCS8vIEFkZCBwcm90b2NvbCBpZiBub3QgcHJvdmlkZWQgKHByZWZpbHRlcnMgbWlnaHQgZXhwZWN0IGl0KQoJCS8vIEhhbmRsZSBmYWxzeSB1cmwgaW4gdGhlIHNldHRpbmdzIG9iamVjdCAoIzEwMDkzOiBjb25zaXN0ZW5jeSB3aXRoIG9sZCBzaWduYXR1cmUpCgkJLy8gV2UgYWxzbyB1c2UgdGhlIHVybCBwYXJhbWV0ZXIgaWYgYXZhaWxhYmxlCgkJcy51cmwgPSAoICggdXJsIHx8IHMudXJsIHx8IGFqYXhMb2NhdGlvbiApICsgIiIgKS5yZXBsYWNlKCByaGFzaCwgIiIgKQoJCQkucmVwbGFjZSggcnByb3RvY29sLCBhamF4TG9jUGFydHNbIDEgXSArICIvLyIgKTsKCgkJLy8gQWxpYXMgbWV0aG9kIG9wdGlvbiB0byB0eXBlIGFzIHBlciB0aWNrZXQgIzEyMDA0CgkJcy50eXBlID0gb3B0aW9ucy5tZXRob2QgfHwgb3B0aW9ucy50eXBlIHx8IHMubWV0aG9kIHx8IHMudHlwZTsKCgkJLy8gRXh0cmFjdCBkYXRhVHlwZXMgbGlzdAoJCXMuZGF0YVR5cGVzID0galF1ZXJ5LnRyaW0oIHMuZGF0YVR5cGUgfHwgIioiICkudG9Mb3dlckNhc2UoKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgWyAiIiBdOwoKCQkvLyBBIGNyb3NzLWRvbWFpbiByZXF1ZXN0IGlzIGluIG9yZGVyIHdoZW4gd2UgaGF2ZSBhIHByb3RvY29sOmhvc3Q6cG9ydCBtaXNtYXRjaAoJCWlmICggcy5jcm9zc0RvbWFpbiA9PSBudWxsICkgewoJCQlwYXJ0cyA9IHJ1cmwuZXhlYyggcy51cmwudG9Mb3dlckNhc2UoKSApOwoJCQlzLmNyb3NzRG9tYWluID0gISEoIHBhcnRzICYmCgkJCQkoIHBhcnRzWyAxIF0gIT09IGFqYXhMb2NQYXJ0c1sgMSBdIHx8IHBhcnRzWyAyIF0gIT09IGFqYXhMb2NQYXJ0c1sgMiBdIHx8CgkJCQkJKCBwYXJ0c1sgMyBdIHx8ICggcGFydHNbIDEgXSA9PT0gImh0dHA6IiA/ICI4MCIgOiAiNDQzIiApICkgIT09CgkJCQkJCSggYWpheExvY1BhcnRzWyAzIF0gfHwgKCBhamF4TG9jUGFydHNbIDEgXSA9PT0gImh0dHA6IiA/ICI4MCIgOiAiNDQzIiApICkgKQoJCQkpOwoJCX0KCgkJLy8gQ29udmVydCBkYXRhIGlmIG5vdCBhbHJlYWR5IGEgc3RyaW5nCgkJaWYgKCBzLmRhdGEgJiYgcy5wcm9jZXNzRGF0YSAmJiB0eXBlb2Ygcy5kYXRhICE9PSAic3RyaW5nIiApIHsKCQkJcy5kYXRhID0galF1ZXJ5LnBhcmFtKCBzLmRhdGEsIHMudHJhZGl0aW9uYWwgKTsKCQl9CgoJCS8vIEFwcGx5IHByZWZpbHRlcnMKCQlpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgcmVxdWVzdCB3YXMgYWJvcnRlZCBpbnNpZGUgYSBwcmVmaWx0ZXIsIHN0b3AgdGhlcmUKCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQlyZXR1cm4ganFYSFI7CgkJfQoKCQkvLyBXZSBjYW4gZmlyZSBnbG9iYWwgZXZlbnRzIGFzIG9mIG5vdyBpZiBhc2tlZCB0bwoJCS8vIERvbid0IGZpcmUgZXZlbnRzIGlmIGpRdWVyeS5ldmVudCBpcyB1bmRlZmluZWQgaW4gYW4gQU1ELXVzYWdlIHNjZW5hcmlvICgjMTUxMTgpCgkJZmlyZUdsb2JhbHMgPSBqUXVlcnkuZXZlbnQgJiYgcy5nbG9iYWw7CgoJCS8vIFdhdGNoIGZvciBhIG5ldyBzZXQgb2YgcmVxdWVzdHMKCQlpZiAoIGZpcmVHbG9iYWxzICYmIGpRdWVyeS5hY3RpdmUrKyA9PT0gMCApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdGFydCIpOwoJCX0KCgkJLy8gVXBwZXJjYXNlIHRoZSB0eXBlCgkJcy50eXBlID0gcy50eXBlLnRvVXBwZXJDYXNlKCk7CgoJCS8vIERldGVybWluZSBpZiByZXF1ZXN0IGhhcyBjb250ZW50CgkJcy5oYXNDb250ZW50ID0gIXJub0NvbnRlbnQudGVzdCggcy50eXBlICk7CgoJCS8vIFNhdmUgdGhlIFVSTCBpbiBjYXNlIHdlJ3JlIHRveWluZyB3aXRoIHRoZSBJZi1Nb2RpZmllZC1TaW5jZQoJCS8vIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciBsYXRlciBvbgoJCWNhY2hlVVJMID0gcy51cmw7CgoJCS8vIE1vcmUgb3B0aW9ucyBoYW5kbGluZyBmb3IgcmVxdWVzdHMgd2l0aCBubyBjb250ZW50CgkJaWYgKCAhcy5oYXNDb250ZW50ICkgewoKCQkJLy8gSWYgZGF0YSBpcyBhdmFpbGFibGUsIGFwcGVuZCBkYXRhIHRvIHVybAoJCQlpZiAoIHMuZGF0YSApIHsKCQkJCWNhY2hlVVJMID0gKCBzLnVybCArPSAoIHJxdWVyeS50ZXN0KCBjYWNoZVVSTCApID8gIiYiIDogIj8iICkgKyBzLmRhdGEgKTsKCQkJCS8vICM5NjgyOiByZW1vdmUgZGF0YSBzbyB0aGF0IGl0J3Mgbm90IHVzZWQgaW4gYW4gZXZlbnR1YWwgcmV0cnkKCQkJCWRlbGV0ZSBzLmRhdGE7CgkJCX0KCgkJCS8vIEFkZCBhbnRpLWNhY2hlIGluIHVybCBpZiBuZWVkZWQKCQkJaWYgKCBzLmNhY2hlID09PSBmYWxzZSApIHsKCQkJCXMudXJsID0gcnRzLnRlc3QoIGNhY2hlVVJMICkgPwoKCQkJCQkvLyBJZiB0aGVyZSBpcyBhbHJlYWR5IGEgJ18nIHBhcmFtZXRlciwgc2V0IGl0cyB2YWx1ZQoJCQkJCWNhY2hlVVJMLnJlcGxhY2UoIHJ0cywgIiQxXz0iICsgbm9uY2UrKyApIDoKCgkJCQkJLy8gT3RoZXJ3aXNlIGFkZCBvbmUgdG8gdGhlIGVuZAoJCQkJCWNhY2hlVVJMICsgKCBycXVlcnkudGVzdCggY2FjaGVVUkwgKSA/ICImIiA6ICI/IiApICsgIl89IiArIG5vbmNlKys7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJaWYgKCBzLmlmTW9kaWZpZWQgKSB7CgkJCWlmICggalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApIHsKCQkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoICJJZi1Nb2RpZmllZC1TaW5jZSIsIGpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gKTsKCQkJfQoJCQlpZiAoIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU5vbmUtTWF0Y2giLCBqUXVlcnkuZXRhZ1sgY2FjaGVVUkwgXSApOwoJCQl9CgkJfQoKCQkvLyBTZXQgdGhlIGNvcnJlY3QgaGVhZGVyLCBpZiBkYXRhIGlzIGJlaW5nIHNlbnQKCQlpZiAoIHMuZGF0YSAmJiBzLmhhc0NvbnRlbnQgJiYgcy5jb250ZW50VHlwZSAhPT0gZmFsc2UgfHwgb3B0aW9ucy5jb250ZW50VHlwZSApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIkNvbnRlbnQtVHlwZSIsIHMuY29udGVudFR5cGUgKTsKCQl9CgoJCS8vIFNldCB0aGUgQWNjZXB0cyBoZWFkZXIgZm9yIHRoZSBzZXJ2ZXIsIGRlcGVuZGluZyBvbiB0aGUgZGF0YVR5cGUKCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKAoJCQkiQWNjZXB0IiwKCQkJcy5kYXRhVHlwZXNbIDAgXSAmJiBzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gPwoJCQkJcy5hY2NlcHRzWyBzLmRhdGFUeXBlc1swXSBdICsgKCBzLmRhdGFUeXBlc1sgMCBdICE9PSAiKiIgPyAiLCAiICsgYWxsVHlwZXMgKyAiOyBxPTAuMDEiIDogIiIgKSA6CgkJCQlzLmFjY2VwdHNbICIqIiBdCgkJKTsKCgkJLy8gQ2hlY2sgZm9yIGhlYWRlcnMgb3B0aW9uCgkJZm9yICggaSBpbiBzLmhlYWRlcnMgKSB7CgkJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoIGksIHMuaGVhZGVyc1sgaSBdICk7CgkJfQoKCQkvLyBBbGxvdyBjdXN0b20gaGVhZGVycy9taW1ldHlwZXMgYW5kIGVhcmx5IGFib3J0CgkJaWYgKCBzLmJlZm9yZVNlbmQgJiYgKCBzLmJlZm9yZVNlbmQuY2FsbCggY2FsbGJhY2tDb250ZXh0LCBqcVhIUiwgcyApID09PSBmYWxzZSB8fCBzdGF0ZSA9PT0gMiApICkgewoJCQkvLyBBYm9ydCBpZiBub3QgZG9uZSBhbHJlYWR5IGFuZCByZXR1cm4KCQkJcmV0dXJuIGpxWEhSLmFib3J0KCk7CgkJfQoKCQkvLyBBYm9ydGluZyBpcyBubyBsb25nZXIgYSBjYW5jZWxsYXRpb24KCQlzdHJBYm9ydCA9ICJhYm9ydCI7CgoJCS8vIEluc3RhbGwgY2FsbGJhY2tzIG9uIGRlZmVycmVkcwoJCWZvciAoIGkgaW4geyBzdWNjZXNzOiAxLCBlcnJvcjogMSwgY29tcGxldGU6IDEgfSApIHsKCQkJanFYSFJbIGkgXSggc1sgaSBdICk7CgkJfQoKCQkvLyBHZXQgdHJhbnNwb3J0CgkJdHJhbnNwb3J0ID0gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHRyYW5zcG9ydHMsIHMsIG9wdGlvbnMsIGpxWEhSICk7CgoJCS8vIElmIG5vIHRyYW5zcG9ydCwgd2UgYXV0by1hYm9ydAoJCWlmICggIXRyYW5zcG9ydCApIHsKCQkJZG9uZSggLTEsICJObyBUcmFuc3BvcnQiICk7CgkJfSBlbHNlIHsKCQkJanFYSFIucmVhZHlTdGF0ZSA9IDE7CgoJCQkvLyBTZW5kIGdsb2JhbCBldmVudAoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4U2VuZCIsIFsganFYSFIsIHMgXSApOwoJCQl9CgkJCS8vIFRpbWVvdXQKCQkJaWYgKCBzLmFzeW5jICYmIHMudGltZW91dCA+IDAgKSB7CgkJCQl0aW1lb3V0VGltZXIgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJCWpxWEhSLmFib3J0KCJ0aW1lb3V0Iik7CgkJCQl9LCBzLnRpbWVvdXQgKTsKCQkJfQoKCQkJdHJ5IHsKCQkJCXN0YXRlID0gMTsKCQkJCXRyYW5zcG9ydC5zZW5kKCByZXF1ZXN0SGVhZGVycywgZG9uZSApOwoJCQl9IGNhdGNoICggZSApIHsKCQkJCS8vIFByb3BhZ2F0ZSBleGNlcHRpb24gYXMgZXJyb3IgaWYgbm90IGRvbmUKCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCWRvbmUoIC0xLCBlICk7CgkJCQkvLyBTaW1wbHkgcmV0aHJvdyBvdGhlcndpc2UKCQkJCX0gZWxzZSB7CgkJCQkJdGhyb3cgZTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gQ2FsbGJhY2sgZm9yIHdoZW4gZXZlcnl0aGluZyBpcyBkb25lCgkJZnVuY3Rpb24gZG9uZSggc3RhdHVzLCBuYXRpdmVTdGF0dXNUZXh0LCByZXNwb25zZXMsIGhlYWRlcnMgKSB7CgkJCXZhciBpc1N1Y2Nlc3MsIHN1Y2Nlc3MsIGVycm9yLCByZXNwb25zZSwgbW9kaWZpZWQsCgkJCQlzdGF0dXNUZXh0ID0gbmF0aXZlU3RhdHVzVGV4dDsKCgkJCS8vIENhbGxlZCBvbmNlCgkJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8vIFN0YXRlIGlzICJkb25lIiBub3cKCQkJc3RhdGUgPSAyOwoKCQkJLy8gQ2xlYXIgdGltZW91dCBpZiBpdCBleGlzdHMKCQkJaWYgKCB0aW1lb3V0VGltZXIgKSB7CgkJCQljbGVhclRpbWVvdXQoIHRpbWVvdXRUaW1lciApOwoJCQl9CgoJCQkvLyBEZXJlZmVyZW5jZSB0cmFuc3BvcnQgZm9yIGVhcmx5IGdhcmJhZ2UgY29sbGVjdGlvbgoJCQkvLyAobm8gbWF0dGVyIGhvdyBsb25nIHRoZSBqcVhIUiBvYmplY3Qgd2lsbCBiZSB1c2VkKQoJCQl0cmFuc3BvcnQgPSB1bmRlZmluZWQ7CgoJCQkvLyBDYWNoZSByZXNwb25zZSBoZWFkZXJzCgkJCXJlc3BvbnNlSGVhZGVyc1N0cmluZyA9IGhlYWRlcnMgfHwgIiI7CgoJCQkvLyBTZXQgcmVhZHlTdGF0ZQoJCQlqcVhIUi5yZWFkeVN0YXRlID0gc3RhdHVzID4gMCA/IDQgOiAwOwoKCQkJLy8gRGV0ZXJtaW5lIGlmIHN1Y2Nlc3NmdWwKCQkJaXNTdWNjZXNzID0gc3RhdHVzID49IDIwMCAmJiBzdGF0dXMgPCAzMDAgfHwgc3RhdHVzID09PSAzMDQ7CgoJCQkvLyBHZXQgcmVzcG9uc2UgZGF0YQoJCQlpZiAoIHJlc3BvbnNlcyApIHsKCQkJCXJlc3BvbnNlID0gYWpheEhhbmRsZVJlc3BvbnNlcyggcywganFYSFIsIHJlc3BvbnNlcyApOwoJCQl9CgoJCQkvLyBDb252ZXJ0IG5vIG1hdHRlciB3aGF0ICh0aGF0IHdheSByZXNwb25zZVhYWCBmaWVsZHMgYXJlIGFsd2F5cyBzZXQpCgkJCXJlc3BvbnNlID0gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlLCBqcVhIUiwgaXNTdWNjZXNzICk7CgoJCQkvLyBJZiBzdWNjZXNzZnVsLCBoYW5kbGUgdHlwZSBjaGFpbmluZwoJCQlpZiAoIGlzU3VjY2VzcyApIHsKCgkJCQkvLyBTZXQgdGhlIElmLU1vZGlmaWVkLVNpbmNlIGFuZC9vciBJZi1Ob25lLU1hdGNoIGhlYWRlciwgaWYgaW4gaWZNb2RpZmllZCBtb2RlLgoJCQkJaWYgKCBzLmlmTW9kaWZpZWQgKSB7CgkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiTGFzdC1Nb2RpZmllZCIpOwoJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCWpRdWVyeS5sYXN0TW9kaWZpZWRbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQkJbW9kaWZpZWQgPSBqcVhIUi5nZXRSZXNwb25zZUhlYWRlcigiZXRhZyIpOwoJCQkJCWlmICggbW9kaWZpZWQgKSB7CgkJCQkJCWpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdID0gbW9kaWZpZWQ7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIGlmIG5vIGNvbnRlbnQKCQkJCWlmICggc3RhdHVzID09PSAyMDQgfHwgcy50eXBlID09PSAiSEVBRCIgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJub2NvbnRlbnQiOwoKCQkJCS8vIGlmIG5vdCBtb2RpZmllZAoJCQkJfSBlbHNlIGlmICggc3RhdHVzID09PSAzMDQgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJub3Rtb2RpZmllZCI7CgoJCQkJLy8gSWYgd2UgaGF2ZSBkYXRhLCBsZXQncyBjb252ZXJ0IGl0CgkJCQl9IGVsc2UgewoJCQkJCXN0YXR1c1RleHQgPSByZXNwb25zZS5zdGF0ZTsKCQkJCQlzdWNjZXNzID0gcmVzcG9uc2UuZGF0YTsKCQkJCQllcnJvciA9IHJlc3BvbnNlLmVycm9yOwoJCQkJCWlzU3VjY2VzcyA9ICFlcnJvcjsKCQkJCX0KCQkJfSBlbHNlIHsKCQkJCS8vIEV4dHJhY3QgZXJyb3IgZnJvbSBzdGF0dXNUZXh0IGFuZCBub3JtYWxpemUgZm9yIG5vbi1hYm9ydHMKCQkJCWVycm9yID0gc3RhdHVzVGV4dDsKCQkJCWlmICggc3RhdHVzIHx8ICFzdGF0dXNUZXh0ICkgewoJCQkJCXN0YXR1c1RleHQgPSAiZXJyb3IiOwoJCQkJCWlmICggc3RhdHVzIDwgMCApIHsKCQkJCQkJc3RhdHVzID0gMDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFNldCBkYXRhIGZvciB0aGUgZmFrZSB4aHIgb2JqZWN0CgkJCWpxWEhSLnN0YXR1cyA9IHN0YXR1czsKCQkJanFYSFIuc3RhdHVzVGV4dCA9ICggbmF0aXZlU3RhdHVzVGV4dCB8fCBzdGF0dXNUZXh0ICkgKyAiIjsKCgkJCS8vIFN1Y2Nlc3MvRXJyb3IKCQkJaWYgKCBpc1N1Y2Nlc3MgKSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIHN1Y2Nlc3MsIHN0YXR1c1RleHQsIGpxWEhSIF0gKTsKCQkJfSBlbHNlIHsKCQkJCWRlZmVycmVkLnJlamVjdFdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCwgZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBTdGF0dXMtZGVwZW5kZW50IGNhbGxiYWNrcwoJCQlqcVhIUi5zdGF0dXNDb2RlKCBzdGF0dXNDb2RlICk7CgkJCXN0YXR1c0NvZGUgPSB1bmRlZmluZWQ7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoIGlzU3VjY2VzcyA/ICJhamF4U3VjY2VzcyIgOiAiYWpheEVycm9yIiwKCQkJCQlbIGpxWEhSLCBzLCBpc1N1Y2Nlc3MgPyBzdWNjZXNzIDogZXJyb3IgXSApOwoJCQl9CgoJCQkvLyBDb21wbGV0ZQoJCQljb21wbGV0ZURlZmVycmVkLmZpcmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsganFYSFIsIHN0YXR1c1RleHQgXSApOwoKCQkJaWYgKCBmaXJlR2xvYmFscyApIHsKCQkJCWdsb2JhbEV2ZW50Q29udGV4dC50cmlnZ2VyKCAiYWpheENvbXBsZXRlIiwgWyBqcVhIUiwgcyBdICk7CgkJCQkvLyBIYW5kbGUgdGhlIGdsb2JhbCBBSkFYIGNvdW50ZXIKCQkJCWlmICggISggLS1qUXVlcnkuYWN0aXZlICkgKSB7CgkJCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoImFqYXhTdG9wIik7CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBqcVhIUjsKCX0sCgoJZ2V0SlNPTjogZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgZGF0YSwgY2FsbGJhY2ssICJqc29uIiApOwoJfSwKCglnZXRTY3JpcHQ6IGZ1bmN0aW9uKCB1cmwsIGNhbGxiYWNrICkgewoJCXJldHVybiBqUXVlcnkuZ2V0KCB1cmwsIHVuZGVmaW5lZCwgY2FsbGJhY2ssICJzY3JpcHQiICk7Cgl9Cn0pOwoKalF1ZXJ5LmVhY2goIFsgImdldCIsICJwb3N0IiBdLCBmdW5jdGlvbiggaSwgbWV0aG9kICkgewoJalF1ZXJ5WyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB1cmwsIGRhdGEsIGNhbGxiYWNrLCB0eXBlICkgewoJCS8vIFNoaWZ0IGFyZ3VtZW50cyBpZiBkYXRhIGFyZ3VtZW50IHdhcyBvbWl0dGVkCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggZGF0YSApICkgewoJCQl0eXBlID0gdHlwZSB8fCBjYWxsYmFjazsKCQkJY2FsbGJhY2sgPSBkYXRhOwoJCQlkYXRhID0gdW5kZWZpbmVkOwoJCX0KCgkJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQkJdXJsOiB1cmwsCgkJCXR5cGU6IG1ldGhvZCwKCQkJZGF0YVR5cGU6IHR5cGUsCgkJCWRhdGE6IGRhdGEsCgkJCXN1Y2Nlc3M6IGNhbGxiYWNrCgkJfSk7Cgl9Owp9KTsKCgpqUXVlcnkuX2V2YWxVcmwgPSBmdW5jdGlvbiggdXJsICkgewoJcmV0dXJuIGpRdWVyeS5hamF4KHsKCQl1cmw6IHVybCwKCQl0eXBlOiAiR0VUIiwKCQlkYXRhVHlwZTogInNjcmlwdCIsCgkJYXN5bmM6IGZhbHNlLAoJCWdsb2JhbDogZmFsc2UsCgkJInRocm93cyI6IHRydWUKCX0pOwp9OwoKCmpRdWVyeS5mbi5leHRlbmQoewoJd3JhcEFsbDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIHdyYXA7CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKSApIHsKCQkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJCWpRdWVyeSggdGhpcyApLndyYXBBbGwoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCWlmICggdGhpc1sgMCBdICkgewoKCQkJLy8gVGhlIGVsZW1lbnRzIHRvIHdyYXAgdGhlIHRhcmdldCBhcm91bmQKCQkJd3JhcCA9IGpRdWVyeSggaHRtbCwgdGhpc1sgMCBdLm93bmVyRG9jdW1lbnQgKS5lcSggMCApLmNsb25lKCB0cnVlICk7CgoJCQlpZiAoIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgewoJCQkJd3JhcC5pbnNlcnRCZWZvcmUoIHRoaXNbIDAgXSApOwoJCQl9CgoJCQl3cmFwLm1hcChmdW5jdGlvbigpIHsKCQkJCXZhciBlbGVtID0gdGhpczsKCgkJCQl3aGlsZSAoIGVsZW0uZmlyc3RFbGVtZW50Q2hpbGQgKSB7CgkJCQkJZWxlbSA9IGVsZW0uZmlyc3RFbGVtZW50Q2hpbGQ7CgkJCQl9CgoJCQkJcmV0dXJuIGVsZW07CgkJCX0pLmFwcGVuZCggdGhpcyApOwoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXdyYXBJbm5lcjogZnVuY3Rpb24oIGh0bWwgKSB7CgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkud3JhcElubmVyKCBodG1sLmNhbGwodGhpcywgaSkgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgc2VsZiA9IGpRdWVyeSggdGhpcyApLAoJCQkJY29udGVudHMgPSBzZWxmLmNvbnRlbnRzKCk7CgoJCQlpZiAoIGNvbnRlbnRzLmxlbmd0aCApIHsKCQkJCWNvbnRlbnRzLndyYXBBbGwoIGh0bWwgKTsKCgkJCX0gZWxzZSB7CgkJCQlzZWxmLmFwcGVuZCggaHRtbCApOwoJCQl9CgkJfSk7Cgl9LAoKCXdyYXA6IGZ1bmN0aW9uKCBodG1sICkgewoJCXZhciBpc0Z1bmN0aW9uID0galF1ZXJ5LmlzRnVuY3Rpb24oIGh0bWwgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaXNGdW5jdGlvbiA/IGh0bWwuY2FsbCh0aGlzLCBpKSA6IGh0bWwgKTsKCQl9KTsKCX0sCgoJdW53cmFwOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5wYXJlbnQoKS5lYWNoKGZ1bmN0aW9uKCkgewoJCQlpZiAoICFqUXVlcnkubm9kZU5hbWUoIHRoaXMsICJib2R5IiApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVwbGFjZVdpdGgoIHRoaXMuY2hpbGROb2RlcyApOwoJCQl9CgkJfSkuZW5kKCk7Cgl9Cn0pOwoKCmpRdWVyeS5leHByLmZpbHRlcnMuaGlkZGVuID0gZnVuY3Rpb24oIGVsZW0gKSB7CgkvLyBTdXBwb3J0OiBPcGVyYSA8PSAxMi4xMgoJLy8gT3BlcmEgcmVwb3J0cyBvZmZzZXRXaWR0aHMgYW5kIG9mZnNldEhlaWdodHMgbGVzcyB0aGFuIHplcm8gb24gc29tZSBlbGVtZW50cwoJcmV0dXJuIGVsZW0ub2Zmc2V0V2lkdGggPD0gMCAmJiBlbGVtLm9mZnNldEhlaWdodCA8PSAwOwp9OwpqUXVlcnkuZXhwci5maWx0ZXJzLnZpc2libGUgPSBmdW5jdGlvbiggZWxlbSApIHsKCXJldHVybiAhalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4oIGVsZW0gKTsKfTsKCgoKCnZhciByMjAgPSAvJTIwL2csCglyYnJhY2tldCA9IC9cW1xdJC8sCglyQ1JMRiA9IC9ccj9cbi9nLAoJcnN1Ym1pdHRlclR5cGVzID0gL14oPzpzdWJtaXR8YnV0dG9ufGltYWdlfHJlc2V0fGZpbGUpJC9pLAoJcnN1Ym1pdHRhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8a2V5Z2VuKS9pOwoKZnVuY3Rpb24gYnVpbGRQYXJhbXMoIHByZWZpeCwgb2JqLCB0cmFkaXRpb25hbCwgYWRkICkgewoJdmFyIG5hbWU7CgoJaWYgKCBqUXVlcnkuaXNBcnJheSggb2JqICkgKSB7CgkJLy8gU2VyaWFsaXplIGFycmF5IGl0ZW0uCgkJalF1ZXJ5LmVhY2goIG9iaiwgZnVuY3Rpb24oIGksIHYgKSB7CgkJCWlmICggdHJhZGl0aW9uYWwgfHwgcmJyYWNrZXQudGVzdCggcHJlZml4ICkgKSB7CgkJCQkvLyBUcmVhdCBlYWNoIGFycmF5IGl0ZW0gYXMgYSBzY2FsYXIuCgkJCQlhZGQoIHByZWZpeCwgdiApOwoKCQkJfSBlbHNlIHsKCQkJCS8vIEl0ZW0gaXMgbm9uLXNjYWxhciAoYXJyYXkgb3Igb2JqZWN0KSwgZW5jb2RlIGl0cyBudW1lcmljIGluZGV4LgoJCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArICggdHlwZW9mIHYgPT09ICJvYmplY3QiID8gaSA6ICIiICkgKyAiXSIsIHYsIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQkJfQoJCX0pOwoKCX0gZWxzZSBpZiAoICF0cmFkaXRpb25hbCAmJiBqUXVlcnkudHlwZSggb2JqICkgPT09ICJvYmplY3QiICkgewoJCS8vIFNlcmlhbGl6ZSBvYmplY3QgaXRlbS4KCQlmb3IgKCBuYW1lIGluIG9iaiApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCArICJbIiArIG5hbWUgKyAiXSIsIG9ialsgbmFtZSBdLCB0cmFkaXRpb25hbCwgYWRkICk7CgkJfQoKCX0gZWxzZSB7CgkJLy8gU2VyaWFsaXplIHNjYWxhciBpdGVtLgoJCWFkZCggcHJlZml4LCBvYmogKTsKCX0KfQoKLy8gU2VyaWFsaXplIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMgb3IgYSBzZXQgb2YKLy8ga2V5L3ZhbHVlcyBpbnRvIGEgcXVlcnkgc3RyaW5nCmpRdWVyeS5wYXJhbSA9IGZ1bmN0aW9uKCBhLCB0cmFkaXRpb25hbCApIHsKCXZhciBwcmVmaXgsCgkJcyA9IFtdLAoJCWFkZCA9IGZ1bmN0aW9uKCBrZXksIHZhbHVlICkgewoJCQkvLyBJZiB2YWx1ZSBpcyBhIGZ1bmN0aW9uLCBpbnZva2UgaXQgYW5kIHJldHVybiBpdHMgdmFsdWUKCQkJdmFsdWUgPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKSA/IHZhbHVlKCkgOiAoIHZhbHVlID09IG51bGwgPyAiIiA6IHZhbHVlICk7CgkJCXNbIHMubGVuZ3RoIF0gPSBlbmNvZGVVUklDb21wb25lbnQoIGtleSApICsgIj0iICsgZW5jb2RlVVJJQ29tcG9uZW50KCB2YWx1ZSApOwoJCX07CgoJLy8gU2V0IHRyYWRpdGlvbmFsIHRvIHRydWUgZm9yIGpRdWVyeSA8PSAxLjMuMiBiZWhhdmlvci4KCWlmICggdHJhZGl0aW9uYWwgPT09IHVuZGVmaW5lZCApIHsKCQl0cmFkaXRpb25hbCA9IGpRdWVyeS5hamF4U2V0dGluZ3MgJiYgalF1ZXJ5LmFqYXhTZXR0aW5ncy50cmFkaXRpb25hbDsKCX0KCgkvLyBJZiBhbiBhcnJheSB3YXMgcGFzc2VkIGluLCBhc3N1bWUgdGhhdCBpdCBpcyBhbiBhcnJheSBvZiBmb3JtIGVsZW1lbnRzLgoJaWYgKCBqUXVlcnkuaXNBcnJheSggYSApIHx8ICggYS5qcXVlcnkgJiYgIWpRdWVyeS5pc1BsYWluT2JqZWN0KCBhICkgKSApIHsKCQkvLyBTZXJpYWxpemUgdGhlIGZvcm0gZWxlbWVudHMKCQlqUXVlcnkuZWFjaCggYSwgZnVuY3Rpb24oKSB7CgkJCWFkZCggdGhpcy5uYW1lLCB0aGlzLnZhbHVlICk7CgkJfSk7CgoJfSBlbHNlIHsKCQkvLyBJZiB0cmFkaXRpb25hbCwgZW5jb2RlIHRoZSAib2xkIiB3YXkgKHRoZSB3YXkgMS4zLjIgb3Igb2xkZXIKCQkvLyBkaWQgaXQpLCBvdGhlcndpc2UgZW5jb2RlIHBhcmFtcyByZWN1cnNpdmVseS4KCQlmb3IgKCBwcmVmaXggaW4gYSApIHsKCQkJYnVpbGRQYXJhbXMoIHByZWZpeCwgYVsgcHJlZml4IF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSByZXN1bHRpbmcgc2VyaWFsaXphdGlvbgoJcmV0dXJuIHMuam9pbiggIiYiICkucmVwbGFjZSggcjIwLCAiKyIgKTsKfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJc2VyaWFsaXplOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4galF1ZXJ5LnBhcmFtKCB0aGlzLnNlcmlhbGl6ZUFycmF5KCkgKTsKCX0sCglzZXJpYWxpemVBcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQkvLyBDYW4gYWRkIHByb3BIb29rIGZvciAiZWxlbWVudHMiIHRvIGZpbHRlciBvciBhZGQgZm9ybSBlbGVtZW50cwoJCQl2YXIgZWxlbWVudHMgPSBqUXVlcnkucHJvcCggdGhpcywgImVsZW1lbnRzIiApOwoJCQlyZXR1cm4gZWxlbWVudHMgPyBqUXVlcnkubWFrZUFycmF5KCBlbGVtZW50cyApIDogdGhpczsKCQl9KQoJCS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCXZhciB0eXBlID0gdGhpcy50eXBlOwoKCQkJLy8gVXNlIC5pcyggIjpkaXNhYmxlZCIgKSBzbyB0aGF0IGZpZWxkc2V0W2Rpc2FibGVkXSB3b3JrcwoJCQlyZXR1cm4gdGhpcy5uYW1lICYmICFqUXVlcnkoIHRoaXMgKS5pcyggIjpkaXNhYmxlZCIgKSAmJgoJCQkJcnN1Ym1pdHRhYmxlLnRlc3QoIHRoaXMubm9kZU5hbWUgKSAmJiAhcnN1Ym1pdHRlclR5cGVzLnRlc3QoIHR5cGUgKSAmJgoJCQkJKCB0aGlzLmNoZWNrZWQgfHwgIXJjaGVja2FibGVUeXBlLnRlc3QoIHR5cGUgKSApOwoJCX0pCgkJLm1hcChmdW5jdGlvbiggaSwgZWxlbSApIHsKCQkJdmFyIHZhbCA9IGpRdWVyeSggdGhpcyApLnZhbCgpOwoKCQkJcmV0dXJuIHZhbCA9PSBudWxsID8KCQkJCW51bGwgOgoJCQkJalF1ZXJ5LmlzQXJyYXkoIHZhbCApID8KCQkJCQlqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWwgKSB7CgkJCQkJCXJldHVybiB7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQkJCQl9KSA6CgkJCQkJeyBuYW1lOiBlbGVtLm5hbWUsIHZhbHVlOiB2YWwucmVwbGFjZSggckNSTEYsICJcclxuIiApIH07CgkJfSkuZ2V0KCk7Cgl9Cn0pOwoKCmpRdWVyeS5hamF4U2V0dGluZ3MueGhyID0gZnVuY3Rpb24oKSB7Cgl0cnkgewoJCXJldHVybiBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCX0gY2F0Y2goIGUgKSB7fQp9OwoKdmFyIHhocklkID0gMCwKCXhockNhbGxiYWNrcyA9IHt9LAoJeGhyU3VjY2Vzc1N0YXR1cyA9IHsKCQkvLyBmaWxlIHByb3RvY29sIGFsd2F5cyB5aWVsZHMgc3RhdHVzIGNvZGUgMCwgYXNzdW1lIDIwMAoJCTA6IDIwMCwKCQkvLyBTdXBwb3J0OiBJRTkKCQkvLyAjMTQ1MDogc29tZXRpbWVzIElFIHJldHVybnMgMTIyMyB3aGVuIGl0IHNob3VsZCBiZSAyMDQKCQkxMjIzOiAyMDQKCX0sCgl4aHJTdXBwb3J0ZWQgPSBqUXVlcnkuYWpheFNldHRpbmdzLnhocigpOwoKLy8gU3VwcG9ydDogSUU5Ci8vIE9wZW4gcmVxdWVzdHMgbXVzdCBiZSBtYW51YWxseSBhYm9ydGVkIG9uIHVubG9hZCAoIzUyODApCi8vIFNlZSBodHRwczovL3N1cHBvcnQubWljcm9zb2Z0LmNvbS9rYi8yODU2NzQ2IGZvciBtb3JlIGluZm8KaWYgKCB3aW5kb3cuYXR0YWNoRXZlbnQgKSB7Cgl3aW5kb3cuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIGZ1bmN0aW9uKCkgewoJCWZvciAoIHZhciBrZXkgaW4geGhyQ2FsbGJhY2tzICkgewoJCQl4aHJDYWxsYmFja3NbIGtleSBdKCk7CgkJfQoJfSk7Cn0KCnN1cHBvcnQuY29ycyA9ICEheGhyU3VwcG9ydGVkICYmICggIndpdGhDcmVkZW50aWFscyIgaW4geGhyU3VwcG9ydGVkICk7CnN1cHBvcnQuYWpheCA9IHhoclN1cHBvcnRlZCA9ICEheGhyU3VwcG9ydGVkOwoKalF1ZXJ5LmFqYXhUcmFuc3BvcnQoZnVuY3Rpb24oIG9wdGlvbnMgKSB7Cgl2YXIgY2FsbGJhY2s7CgoJLy8gQ3Jvc3MgZG9tYWluIG9ubHkgYWxsb3dlZCBpZiBzdXBwb3J0ZWQgdGhyb3VnaCBYTUxIdHRwUmVxdWVzdAoJaWYgKCBzdXBwb3J0LmNvcnMgfHwgeGhyU3VwcG9ydGVkICYmICFvcHRpb25zLmNyb3NzRG9tYWluICkgewoJCXJldHVybiB7CgkJCXNlbmQ6IGZ1bmN0aW9uKCBoZWFkZXJzLCBjb21wbGV0ZSApIHsKCQkJCXZhciBpLAoJCQkJCXhociA9IG9wdGlvbnMueGhyKCksCgkJCQkJaWQgPSArK3hocklkOwoKCQkJCXhoci5vcGVuKCBvcHRpb25zLnR5cGUsIG9wdGlvbnMudXJsLCBvcHRpb25zLmFzeW5jLCBvcHRpb25zLnVzZXJuYW1lLCBvcHRpb25zLnBhc3N3b3JkICk7CgoJCQkJLy8gQXBwbHkgY3VzdG9tIGZpZWxkcyBpZiBwcm92aWRlZAoJCQkJaWYgKCBvcHRpb25zLnhockZpZWxkcyApIHsKCQkJCQlmb3IgKCBpIGluIG9wdGlvbnMueGhyRmllbGRzICkgewoJCQkJCQl4aHJbIGkgXSA9IG9wdGlvbnMueGhyRmllbGRzWyBpIF07CgkJCQkJfQoJCQkJfQoKCQkJCS8vIE92ZXJyaWRlIG1pbWUgdHlwZSBpZiBuZWVkZWQKCQkJCWlmICggb3B0aW9ucy5taW1lVHlwZSAmJiB4aHIub3ZlcnJpZGVNaW1lVHlwZSApIHsKCQkJCQl4aHIub3ZlcnJpZGVNaW1lVHlwZSggb3B0aW9ucy5taW1lVHlwZSApOwoJCQkJfQoKCQkJCS8vIFgtUmVxdWVzdGVkLVdpdGggaGVhZGVyCgkJCQkvLyBGb3IgY3Jvc3MtZG9tYWluIHJlcXVlc3RzLCBzZWVpbmcgYXMgY29uZGl0aW9ucyBmb3IgYSBwcmVmbGlnaHQgYXJlCgkJCQkvLyBha2luIHRvIGEgamlnc2F3IHB1enpsZSwgd2Ugc2ltcGx5IG5ldmVyIHNldCBpdCB0byBiZSBzdXJlLgoJCQkJLy8gKGl0IGNhbiBhbHdheXMgYmUgc2V0IG9uIGEgcGVyLXJlcXVlc3QgYmFzaXMgb3IgZXZlbiB1c2luZyBhamF4U2V0dXApCgkJCQkvLyBGb3Igc2FtZS1kb21haW4gcmVxdWVzdHMsIHdvbid0IGNoYW5nZSBoZWFkZXIgaWYgYWxyZWFkeSBwcm92aWRlZC4KCQkJCWlmICggIW9wdGlvbnMuY3Jvc3NEb21haW4gJiYgIWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSApIHsKCQkJCQloZWFkZXJzWyJYLVJlcXVlc3RlZC1XaXRoIl0gPSAiWE1MSHR0cFJlcXVlc3QiOwoJCQkJfQoKCQkJCS8vIFNldCBoZWFkZXJzCgkJCQlmb3IgKCBpIGluIGhlYWRlcnMgKSB7CgkJCQkJeGhyLnNldFJlcXVlc3RIZWFkZXIoIGksIGhlYWRlcnNbIGkgXSApOwoJCQkJfQoKCQkJCS8vIENhbGxiYWNrCgkJCQljYWxsYmFjayA9IGZ1bmN0aW9uKCB0eXBlICkgewoJCQkJCXJldHVybiBmdW5jdGlvbigpIHsKCQkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJCWRlbGV0ZSB4aHJDYWxsYmFja3NbIGlkIF07CgkJCQkJCQljYWxsYmFjayA9IHhoci5vbmxvYWQgPSB4aHIub25lcnJvciA9IG51bGw7CgoJCQkJCQkJaWYgKCB0eXBlID09PSAiYWJvcnQiICkgewoJCQkJCQkJCXhoci5hYm9ydCgpOwoJCQkJCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gImVycm9yIiApIHsKCQkJCQkJCQljb21wbGV0ZSgKCQkJCQkJCQkJLy8gZmlsZTogcHJvdG9jb2wgYWx3YXlzIHlpZWxkcyBzdGF0dXMgMDsgc2VlICM4NjA1LCAjMTQyMDcKCQkJCQkJCQkJeGhyLnN0YXR1cywKCQkJCQkJCQkJeGhyLnN0YXR1c1RleHQKCQkJCQkJCQkpOwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQljb21wbGV0ZSgKCQkJCQkJCQkJeGhyU3VjY2Vzc1N0YXR1c1sgeGhyLnN0YXR1cyBdIHx8IHhoci5zdGF0dXMsCgkJCQkJCQkJCXhoci5zdGF0dXNUZXh0LAoJCQkJCQkJCQkvLyBTdXBwb3J0OiBJRTkKCQkJCQkJCQkJLy8gQWNjZXNzaW5nIGJpbmFyeS1kYXRhIHJlc3BvbnNlVGV4dCB0aHJvd3MgYW4gZXhjZXB0aW9uCgkJCQkJCQkJCS8vICgjMTE0MjYpCgkJCQkJCQkJCXR5cGVvZiB4aHIucmVzcG9uc2VUZXh0ID09PSAic3RyaW5nIiA/IHsKCQkJCQkJCQkJCXRleHQ6IHhoci5yZXNwb25zZVRleHQKCQkJCQkJCQkJfSA6IHVuZGVmaW5lZCwKCQkJCQkJCQkJeGhyLmdldEFsbFJlc3BvbnNlSGVhZGVycygpCgkJCQkJCQkJKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX07CgkJCQl9OwoKCQkJCS8vIExpc3RlbiB0byBldmVudHMKCQkJCXhoci5vbmxvYWQgPSBjYWxsYmFjaygpOwoJCQkJeGhyLm9uZXJyb3IgPSBjYWxsYmFjaygiZXJyb3IiKTsKCgkJCQkvLyBDcmVhdGUgdGhlIGFib3J0IGNhbGxiYWNrCgkJCQljYWxsYmFjayA9IHhockNhbGxiYWNrc1sgaWQgXSA9IGNhbGxiYWNrKCJhYm9ydCIpOwoKCQkJCXRyeSB7CgkJCQkJLy8gRG8gc2VuZCB0aGUgcmVxdWVzdCAodGhpcyBtYXkgcmFpc2UgYW4gZXhjZXB0aW9uKQoJCQkJCXhoci5zZW5kKCBvcHRpb25zLmhhc0NvbnRlbnQgJiYgb3B0aW9ucy5kYXRhIHx8IG51bGwgKTsKCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCS8vICMxNDY4MzogT25seSByZXRocm93IGlmIHRoaXMgaGFzbid0IGJlZW4gbm90aWZpZWQgYXMgYW4gZXJyb3IgeWV0CgkJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQkJdGhyb3cgZTsKCQkJCQl9CgkJCQl9CgkJCX0sCgoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCWNhbGxiYWNrKCk7CgkJCQl9CgkJCX0KCQl9OwoJfQp9KTsKCgoKCi8vIEluc3RhbGwgc2NyaXB0IGRhdGFUeXBlCmpRdWVyeS5hamF4U2V0dXAoewoJYWNjZXB0czogewoJCXNjcmlwdDogInRleHQvamF2YXNjcmlwdCwgYXBwbGljYXRpb24vamF2YXNjcmlwdCwgYXBwbGljYXRpb24vZWNtYXNjcmlwdCwgYXBwbGljYXRpb24veC1lY21hc2NyaXB0IgoJfSwKCWNvbnRlbnRzOiB7CgkJc2NyaXB0OiAvKD86amF2YXxlY21hKXNjcmlwdC8KCX0sCgljb252ZXJ0ZXJzOiB7CgkJInRleHQgc2NyaXB0IjogZnVuY3Rpb24oIHRleHQgKSB7CgkJCWpRdWVyeS5nbG9iYWxFdmFsKCB0ZXh0ICk7CgkJCXJldHVybiB0ZXh0OwoJCX0KCX0KfSk7CgovLyBIYW5kbGUgY2FjaGUncyBzcGVjaWFsIGNhc2UgYW5kIGNyb3NzRG9tYWluCmpRdWVyeS5hamF4UHJlZmlsdGVyKCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7CglpZiAoIHMuY2FjaGUgPT09IHVuZGVmaW5lZCApIHsKCQlzLmNhY2hlID0gZmFsc2U7Cgl9CglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgkJcy50eXBlID0gIkdFVCI7Cgl9Cn0pOwoKLy8gQmluZCBzY3JpcHQgdGFnIGhhY2sgdHJhbnNwb3J0CmpRdWVyeS5hamF4VHJhbnNwb3J0KCAic2NyaXB0IiwgZnVuY3Rpb24oIHMgKSB7CgkvLyBUaGlzIHRyYW5zcG9ydCBvbmx5IGRlYWxzIHdpdGggY3Jvc3MgZG9tYWluIHJlcXVlc3RzCglpZiAoIHMuY3Jvc3NEb21haW4gKSB7CgkJdmFyIHNjcmlwdCwgY2FsbGJhY2s7CgkJcmV0dXJuIHsKCQkJc2VuZDogZnVuY3Rpb24oIF8sIGNvbXBsZXRlICkgewoJCQkJc2NyaXB0ID0galF1ZXJ5KCI8c2NyaXB0PiIpLnByb3AoewoJCQkJCWFzeW5jOiB0cnVlLAoJCQkJCWNoYXJzZXQ6IHMuc2NyaXB0Q2hhcnNldCwKCQkJCQlzcmM6IHMudXJsCgkJCQl9KS5vbigKCQkJCQkibG9hZCBlcnJvciIsCgkJCQkJY2FsbGJhY2sgPSBmdW5jdGlvbiggZXZ0ICkgewoJCQkJCQlzY3JpcHQucmVtb3ZlKCk7CgkJCQkJCWNhbGxiYWNrID0gbnVsbDsKCQkJCQkJaWYgKCBldnQgKSB7CgkJCQkJCQljb21wbGV0ZSggZXZ0LnR5cGUgPT09ICJlcnJvciIgPyA0MDQgOiAyMDAsIGV2dC50eXBlICk7CgkJCQkJCX0KCQkJCQl9CgkJCQkpOwoJCQkJZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggc2NyaXB0WyAwIF0gKTsKCQkJfSwKCQkJYWJvcnQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBjYWxsYmFjayApIHsKCQkJCQljYWxsYmFjaygpOwoJCQkJfQoJCQl9CgkJfTsKCX0KfSk7CgoKCgp2YXIgb2xkQ2FsbGJhY2tzID0gW10sCglyanNvbnAgPSAvKD0pXD8oPz0mfCQpfFw/XD8vOwoKLy8gRGVmYXVsdCBqc29ucCBzZXR0aW5ncwpqUXVlcnkuYWpheFNldHVwKHsKCWpzb25wOiAiY2FsbGJhY2siLAoJanNvbnBDYWxsYmFjazogZnVuY3Rpb24oKSB7CgkJdmFyIGNhbGxiYWNrID0gb2xkQ2FsbGJhY2tzLnBvcCgpIHx8ICggalF1ZXJ5LmV4cGFuZG8gKyAiXyIgKyAoIG5vbmNlKysgKSApOwoJCXRoaXNbIGNhbGxiYWNrIF0gPSB0cnVlOwoJCXJldHVybiBjYWxsYmFjazsKCX0KfSk7CgovLyBEZXRlY3QsIG5vcm1hbGl6ZSBvcHRpb25zIGFuZCBpbnN0YWxsIGNhbGxiYWNrcyBmb3IganNvbnAgcmVxdWVzdHMKalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJqc29uIGpzb25wIiwgZnVuY3Rpb24oIHMsIG9yaWdpbmFsU2V0dGluZ3MsIGpxWEhSICkgewoKCXZhciBjYWxsYmFja05hbWUsIG92ZXJ3cml0dGVuLCByZXNwb25zZUNvbnRhaW5lciwKCQlqc29uUHJvcCA9IHMuanNvbnAgIT09IGZhbHNlICYmICggcmpzb25wLnRlc3QoIHMudXJsICkgPwoJCQkidXJsIiA6CgkJCXR5cGVvZiBzLmRhdGEgPT09ICJzdHJpbmciICYmICEoIHMuY29udGVudFR5cGUgfHwgIiIgKS5pbmRleE9mKCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiKSAmJiByanNvbnAudGVzdCggcy5kYXRhICkgJiYgImRhdGEiCgkJKTsKCgkvLyBIYW5kbGUgaWZmIHRoZSBleHBlY3RlZCBkYXRhIHR5cGUgaXMgImpzb25wIiBvciB3ZSBoYXZlIGEgcGFyYW1ldGVyIHRvIHNldAoJaWYgKCBqc29uUHJvcCB8fCBzLmRhdGFUeXBlc1sgMCBdID09PSAianNvbnAiICkgewoKCQkvLyBHZXQgY2FsbGJhY2sgbmFtZSwgcmVtZW1iZXJpbmcgcHJlZXhpc3RpbmcgdmFsdWUgYXNzb2NpYXRlZCB3aXRoIGl0CgkJY2FsbGJhY2tOYW1lID0gcy5qc29ucENhbGxiYWNrID0galF1ZXJ5LmlzRnVuY3Rpb24oIHMuanNvbnBDYWxsYmFjayApID8KCQkJcy5qc29ucENhbGxiYWNrKCkgOgoJCQlzLmpzb25wQ2FsbGJhY2s7CgoJCS8vIEluc2VydCBjYWxsYmFjayBpbnRvIHVybCBvciBmb3JtIGRhdGEKCQlpZiAoIGpzb25Qcm9wICkgewoJCQlzWyBqc29uUHJvcCBdID0gc1sganNvblByb3AgXS5yZXBsYWNlKCByanNvbnAsICIkMSIgKyBjYWxsYmFja05hbWUgKTsKCQl9IGVsc2UgaWYgKCBzLmpzb25wICE9PSBmYWxzZSApIHsKCQkJcy51cmwgKz0gKCBycXVlcnkudGVzdCggcy51cmwgKSA/ICImIiA6ICI/IiApICsgcy5qc29ucCArICI9IiArIGNhbGxiYWNrTmFtZTsKCQl9CgoJCS8vIFVzZSBkYXRhIGNvbnZlcnRlciB0byByZXRyaWV2ZSBqc29uIGFmdGVyIHNjcmlwdCBleGVjdXRpb24KCQlzLmNvbnZlcnRlcnNbInNjcmlwdCBqc29uIl0gPSBmdW5jdGlvbigpIHsKCQkJaWYgKCAhcmVzcG9uc2VDb250YWluZXIgKSB7CgkJCQlqUXVlcnkuZXJyb3IoIGNhbGxiYWNrTmFtZSArICIgd2FzIG5vdCBjYWxsZWQiICk7CgkJCX0KCQkJcmV0dXJuIHJlc3BvbnNlQ29udGFpbmVyWyAwIF07CgkJfTsKCgkJLy8gZm9yY2UganNvbiBkYXRhVHlwZQoJCXMuZGF0YVR5cGVzWyAwIF0gPSAianNvbiI7CgoJCS8vIEluc3RhbGwgY2FsbGJhY2sKCQlvdmVyd3JpdHRlbiA9IHdpbmRvd1sgY2FsbGJhY2tOYW1lIF07CgkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IGZ1bmN0aW9uKCkgewoJCQlyZXNwb25zZUNvbnRhaW5lciA9IGFyZ3VtZW50czsKCQl9OwoKCQkvLyBDbGVhbi11cCBmdW5jdGlvbiAoZmlyZXMgYWZ0ZXIgY29udmVydGVycykKCQlqcVhIUi5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCS8vIFJlc3RvcmUgcHJlZXhpc3RpbmcgdmFsdWUKCQkJd2luZG93WyBjYWxsYmFja05hbWUgXSA9IG92ZXJ3cml0dGVuOwoKCQkJLy8gU2F2ZSBiYWNrIGFzIGZyZWUKCQkJaWYgKCBzWyBjYWxsYmFja05hbWUgXSApIHsKCQkJCS8vIG1ha2Ugc3VyZSB0aGF0IHJlLXVzaW5nIHRoZSBvcHRpb25zIGRvZXNuJ3Qgc2NyZXcgdGhpbmdzIGFyb3VuZAoJCQkJcy5qc29ucENhbGxiYWNrID0gb3JpZ2luYWxTZXR0aW5ncy5qc29ucENhbGxiYWNrOwoKCQkJCS8vIHNhdmUgdGhlIGNhbGxiYWNrIG5hbWUgZm9yIGZ1dHVyZSB1c2UKCQkJCW9sZENhbGxiYWNrcy5wdXNoKCBjYWxsYmFja05hbWUgKTsKCQkJfQoKCQkJLy8gQ2FsbCBpZiBpdCB3YXMgYSBmdW5jdGlvbiBhbmQgd2UgaGF2ZSBhIHJlc3BvbnNlCgkJCWlmICggcmVzcG9uc2VDb250YWluZXIgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIG92ZXJ3cml0dGVuICkgKSB7CgkJCQlvdmVyd3JpdHRlbiggcmVzcG9uc2VDb250YWluZXJbIDAgXSApOwoJCQl9CgoJCQlyZXNwb25zZUNvbnRhaW5lciA9IG92ZXJ3cml0dGVuID0gdW5kZWZpbmVkOwoJCX0pOwoKCQkvLyBEZWxlZ2F0ZSB0byBzY3JpcHQKCQlyZXR1cm4gInNjcmlwdCI7Cgl9Cn0pOwoKCgoKLy8gZGF0YTogc3RyaW5nIG9mIGh0bWwKLy8gY29udGV4dCAob3B0aW9uYWwpOiBJZiBzcGVjaWZpZWQsIHRoZSBmcmFnbWVudCB3aWxsIGJlIGNyZWF0ZWQgaW4gdGhpcyBjb250ZXh0LCBkZWZhdWx0cyB0byBkb2N1bWVudAovLyBrZWVwU2NyaXB0cyAob3B0aW9uYWwpOiBJZiB0cnVlLCB3aWxsIGluY2x1ZGUgc2NyaXB0cyBwYXNzZWQgaW4gdGhlIGh0bWwgc3RyaW5nCmpRdWVyeS5wYXJzZUhUTUwgPSBmdW5jdGlvbiggZGF0YSwgY29udGV4dCwga2VlcFNjcmlwdHMgKSB7CglpZiAoICFkYXRhIHx8IHR5cGVvZiBkYXRhICE9PSAic3RyaW5nIiApIHsKCQlyZXR1cm4gbnVsbDsKCX0KCWlmICggdHlwZW9mIGNvbnRleHQgPT09ICJib29sZWFuIiApIHsKCQlrZWVwU2NyaXB0cyA9IGNvbnRleHQ7CgkJY29udGV4dCA9IGZhbHNlOwoJfQoJY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7CgoJdmFyIHBhcnNlZCA9IHJzaW5nbGVUYWcuZXhlYyggZGF0YSApLAoJCXNjcmlwdHMgPSAha2VlcFNjcmlwdHMgJiYgW107CgoJLy8gU2luZ2xlIHRhZwoJaWYgKCBwYXJzZWQgKSB7CgkJcmV0dXJuIFsgY29udGV4dC5jcmVhdGVFbGVtZW50KCBwYXJzZWRbMV0gKSBdOwoJfQoKCXBhcnNlZCA9IGpRdWVyeS5idWlsZEZyYWdtZW50KCBbIGRhdGEgXSwgY29udGV4dCwgc2NyaXB0cyApOwoKCWlmICggc2NyaXB0cyAmJiBzY3JpcHRzLmxlbmd0aCApIHsKCQlqUXVlcnkoIHNjcmlwdHMgKS5yZW1vdmUoKTsKCX0KCglyZXR1cm4galF1ZXJ5Lm1lcmdlKCBbXSwgcGFyc2VkLmNoaWxkTm9kZXMgKTsKfTsKCgovLyBLZWVwIGEgY29weSBvZiB0aGUgb2xkIGxvYWQgbWV0aG9kCnZhciBfbG9hZCA9IGpRdWVyeS5mbi5sb2FkOwoKLyoqCiAqIExvYWQgYSB1cmwgaW50byBhIHBhZ2UKICovCmpRdWVyeS5mbi5sb2FkID0gZnVuY3Rpb24oIHVybCwgcGFyYW1zLCBjYWxsYmFjayApIHsKCWlmICggdHlwZW9mIHVybCAhPT0gInN0cmluZyIgJiYgX2xvYWQgKSB7CgkJcmV0dXJuIF9sb2FkLmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsKCX0KCgl2YXIgc2VsZWN0b3IsIHR5cGUsIHJlc3BvbnNlLAoJCXNlbGYgPSB0aGlzLAoJCW9mZiA9IHVybC5pbmRleE9mKCIgIik7CgoJaWYgKCBvZmYgPj0gMCApIHsKCQlzZWxlY3RvciA9IGpRdWVyeS50cmltKCB1cmwuc2xpY2UoIG9mZiApICk7CgkJdXJsID0gdXJsLnNsaWNlKCAwLCBvZmYgKTsKCX0KCgkvLyBJZiBpdCdzIGEgZnVuY3Rpb24KCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHBhcmFtcyApICkgewoKCQkvLyBXZSBhc3N1bWUgdGhhdCBpdCdzIHRoZSBjYWxsYmFjawoJCWNhbGxiYWNrID0gcGFyYW1zOwoJCXBhcmFtcyA9IHVuZGVmaW5lZDsKCgkvLyBPdGhlcndpc2UsIGJ1aWxkIGEgcGFyYW0gc3RyaW5nCgl9IGVsc2UgaWYgKCBwYXJhbXMgJiYgdHlwZW9mIHBhcmFtcyA9PT0gIm9iamVjdCIgKSB7CgkJdHlwZSA9ICJQT1NUIjsKCX0KCgkvLyBJZiB3ZSBoYXZlIGVsZW1lbnRzIHRvIG1vZGlmeSwgbWFrZSB0aGUgcmVxdWVzdAoJaWYgKCBzZWxmLmxlbmd0aCA+IDAgKSB7CgkJalF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCgkJCS8vIGlmICJ0eXBlIiB2YXJpYWJsZSBpcyB1bmRlZmluZWQsIHRoZW4gIkdFVCIgbWV0aG9kIHdpbGwgYmUgdXNlZAoJCQl0eXBlOiB0eXBlLAoJCQlkYXRhVHlwZTogImh0bWwiLAoJCQlkYXRhOiBwYXJhbXMKCQl9KS5kb25lKGZ1bmN0aW9uKCByZXNwb25zZVRleHQgKSB7CgoJCQkvLyBTYXZlIHJlc3BvbnNlIGZvciB1c2UgaW4gY29tcGxldGUgY2FsbGJhY2sKCQkJcmVzcG9uc2UgPSBhcmd1bWVudHM7CgoJCQlzZWxmLmh0bWwoIHNlbGVjdG9yID8KCgkJCQkvLyBJZiBhIHNlbGVjdG9yIHdhcyBzcGVjaWZpZWQsIGxvY2F0ZSB0aGUgcmlnaHQgZWxlbWVudHMgaW4gYSBkdW1teSBkaXYKCQkJCS8vIEV4Y2x1ZGUgc2NyaXB0cyB0byBhdm9pZCBJRSAnUGVybWlzc2lvbiBEZW5pZWQnIGVycm9ycwoJCQkJalF1ZXJ5KCI8ZGl2PiIpLmFwcGVuZCggalF1ZXJ5LnBhcnNlSFRNTCggcmVzcG9uc2VUZXh0ICkgKS5maW5kKCBzZWxlY3RvciApIDoKCgkJCQkvLyBPdGhlcndpc2UgdXNlIHRoZSBmdWxsIHJlc3VsdAoJCQkJcmVzcG9uc2VUZXh0ICk7CgoJCX0pLmNvbXBsZXRlKCBjYWxsYmFjayAmJiBmdW5jdGlvbigganFYSFIsIHN0YXR1cyApIHsKCQkJc2VsZi5lYWNoKCBjYWxsYmFjaywgcmVzcG9uc2UgfHwgWyBqcVhIUi5yZXNwb25zZVRleHQsIHN0YXR1cywganFYSFIgXSApOwoJCX0pOwoJfQoKCXJldHVybiB0aGlzOwp9OwoKCgoKLy8gQXR0YWNoIGEgYnVuY2ggb2YgZnVuY3Rpb25zIGZvciBoYW5kbGluZyBjb21tb24gQUpBWCBldmVudHMKalF1ZXJ5LmVhY2goIFsgImFqYXhTdGFydCIsICJhamF4U3RvcCIsICJhamF4Q29tcGxldGUiLCAiYWpheEVycm9yIiwgImFqYXhTdWNjZXNzIiwgImFqYXhTZW5kIiBdLCBmdW5jdGlvbiggaSwgdHlwZSApIHsKCWpRdWVyeS5mblsgdHlwZSBdID0gZnVuY3Rpb24oIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlLCBmbiApOwoJfTsKfSk7CgoKCgpqUXVlcnkuZXhwci5maWx0ZXJzLmFuaW1hdGVkID0gZnVuY3Rpb24oIGVsZW0gKSB7CglyZXR1cm4galF1ZXJ5LmdyZXAoalF1ZXJ5LnRpbWVycywgZnVuY3Rpb24oIGZuICkgewoJCXJldHVybiBlbGVtID09PSBmbi5lbGVtOwoJfSkubGVuZ3RoOwp9OwoKCgoKdmFyIGRvY0VsZW0gPSB3aW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50OwoKLyoqCiAqIEdldHMgYSB3aW5kb3cgZnJvbSBhbiBlbGVtZW50CiAqLwpmdW5jdGlvbiBnZXRXaW5kb3coIGVsZW0gKSB7CglyZXR1cm4galF1ZXJ5LmlzV2luZG93KCBlbGVtICkgPyBlbGVtIDogZWxlbS5ub2RlVHlwZSA9PT0gOSAmJiBlbGVtLmRlZmF1bHRWaWV3Owp9CgpqUXVlcnkub2Zmc2V0ID0gewoJc2V0T2Zmc2V0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgaSApIHsKCQl2YXIgY3VyUG9zaXRpb24sIGN1ckxlZnQsIGN1ckNTU1RvcCwgY3VyVG9wLCBjdXJPZmZzZXQsIGN1ckNTU0xlZnQsIGNhbGN1bGF0ZVBvc2l0aW9uLAoJCQlwb3NpdGlvbiA9IGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKSwKCQkJY3VyRWxlbSA9IGpRdWVyeSggZWxlbSApLAoJCQlwcm9wcyA9IHt9OwoKCQkvLyBTZXQgcG9zaXRpb24gZmlyc3QsIGluLWNhc2UgdG9wL2xlZnQgYXJlIHNldCBldmVuIG9uIHN0YXRpYyBlbGVtCgkJaWYgKCBwb3NpdGlvbiA9PT0gInN0YXRpYyIgKSB7CgkJCWVsZW0uc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOwoJCX0KCgkJY3VyT2Zmc2V0ID0gY3VyRWxlbS5vZmZzZXQoKTsKCQljdXJDU1NUb3AgPSBqUXVlcnkuY3NzKCBlbGVtLCAidG9wIiApOwoJCWN1ckNTU0xlZnQgPSBqUXVlcnkuY3NzKCBlbGVtLCAibGVmdCIgKTsKCQljYWxjdWxhdGVQb3NpdGlvbiA9ICggcG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgfHwgcG9zaXRpb24gPT09ICJmaXhlZCIgKSAmJgoJCQkoIGN1ckNTU1RvcCArIGN1ckNTU0xlZnQgKS5pbmRleE9mKCJhdXRvIikgPiAtMTsKCgkJLy8gTmVlZCB0byBiZSBhYmxlIHRvIGNhbGN1bGF0ZSBwb3NpdGlvbiBpZiBlaXRoZXIKCQkvLyB0b3Agb3IgbGVmdCBpcyBhdXRvIGFuZCBwb3NpdGlvbiBpcyBlaXRoZXIgYWJzb2x1dGUgb3IgZml4ZWQKCQlpZiAoIGNhbGN1bGF0ZVBvc2l0aW9uICkgewoJCQljdXJQb3NpdGlvbiA9IGN1ckVsZW0ucG9zaXRpb24oKTsKCQkJY3VyVG9wID0gY3VyUG9zaXRpb24udG9wOwoJCQljdXJMZWZ0ID0gY3VyUG9zaXRpb24ubGVmdDsKCgkJfSBlbHNlIHsKCQkJY3VyVG9wID0gcGFyc2VGbG9hdCggY3VyQ1NTVG9wICkgfHwgMDsKCQkJY3VyTGVmdCA9IHBhcnNlRmxvYXQoIGN1ckNTU0xlZnQgKSB8fCAwOwoJCX0KCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggb3B0aW9ucyApICkgewoJCQlvcHRpb25zID0gb3B0aW9ucy5jYWxsKCBlbGVtLCBpLCBjdXJPZmZzZXQgKTsKCQl9CgoJCWlmICggb3B0aW9ucy50b3AgIT0gbnVsbCApIHsKCQkJcHJvcHMudG9wID0gKCBvcHRpb25zLnRvcCAtIGN1ck9mZnNldC50b3AgKSArIGN1clRvcDsKCQl9CgkJaWYgKCBvcHRpb25zLmxlZnQgIT0gbnVsbCApIHsKCQkJcHJvcHMubGVmdCA9ICggb3B0aW9ucy5sZWZ0IC0gY3VyT2Zmc2V0LmxlZnQgKSArIGN1ckxlZnQ7CgkJfQoKCQlpZiAoICJ1c2luZyIgaW4gb3B0aW9ucyApIHsKCQkJb3B0aW9ucy51c2luZy5jYWxsKCBlbGVtLCBwcm9wcyApOwoKCQl9IGVsc2UgewoJCQljdXJFbGVtLmNzcyggcHJvcHMgKTsKCQl9Cgl9Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCW9mZnNldDogZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgkJaWYgKCBhcmd1bWVudHMubGVuZ3RoICkgewoJCQlyZXR1cm4gb3B0aW9ucyA9PT0gdW5kZWZpbmVkID8KCQkJCXRoaXMgOgoJCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJCWpRdWVyeS5vZmZzZXQuc2V0T2Zmc2V0KCB0aGlzLCBvcHRpb25zLCBpICk7CgkJCQl9KTsKCQl9CgoJCXZhciBkb2NFbGVtLCB3aW4sCgkJCWVsZW0gPSB0aGlzWyAwIF0sCgkJCWJveCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH0sCgkJCWRvYyA9IGVsZW0gJiYgZWxlbS5vd25lckRvY3VtZW50OwoKCQlpZiAoICFkb2MgKSB7CgkJCXJldHVybjsKCQl9CgoJCWRvY0VsZW0gPSBkb2MuZG9jdW1lbnRFbGVtZW50OwoKCQkvLyBNYWtlIHN1cmUgaXQncyBub3QgYSBkaXNjb25uZWN0ZWQgRE9NIG5vZGUKCQlpZiAoICFqUXVlcnkuY29udGFpbnMoIGRvY0VsZW0sIGVsZW0gKSApIHsKCQkJcmV0dXJuIGJveDsKCQl9CgoJCS8vIFN1cHBvcnQ6IEJsYWNrQmVycnkgNSwgaU9TIDMgKG9yaWdpbmFsIGlQaG9uZSkKCQkvLyBJZiB3ZSBkb24ndCBoYXZlIGdCQ1IsIGp1c3QgdXNlIDAsMCByYXRoZXIgdGhhbiBlcnJvcgoJCWlmICggdHlwZW9mIGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0ICE9PSBzdHJ1bmRlZmluZWQgKSB7CgkJCWJveCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJfQoJCXdpbiA9IGdldFdpbmRvdyggZG9jICk7CgkJcmV0dXJuIHsKCQkJdG9wOiBib3gudG9wICsgd2luLnBhZ2VZT2Zmc2V0IC0gZG9jRWxlbS5jbGllbnRUb3AsCgkJCWxlZnQ6IGJveC5sZWZ0ICsgd2luLnBhZ2VYT2Zmc2V0IC0gZG9jRWxlbS5jbGllbnRMZWZ0CgkJfTsKCX0sCgoJcG9zaXRpb246IGZ1bmN0aW9uKCkgewoJCWlmICggIXRoaXNbIDAgXSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIG9mZnNldFBhcmVudCwgb2Zmc2V0LAoJCQllbGVtID0gdGhpc1sgMCBdLAoJCQlwYXJlbnRPZmZzZXQgPSB7IHRvcDogMCwgbGVmdDogMCB9OwoKCQkvLyBGaXhlZCBlbGVtZW50cyBhcmUgb2Zmc2V0IGZyb20gd2luZG93IChwYXJlbnRPZmZzZXQgPSB7dG9wOjAsIGxlZnQ6IDB9LCBiZWNhdXNlIGl0IGlzIGl0cyBvbmx5IG9mZnNldCBwYXJlbnQKCQlpZiAoIGpRdWVyeS5jc3MoIGVsZW0sICJwb3NpdGlvbiIgKSA9PT0gImZpeGVkIiApIHsKCQkJLy8gQXNzdW1lIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpcyB0aGVyZSB3aGVuIGNvbXB1dGVkIHBvc2l0aW9uIGlzIGZpeGVkCgkJCW9mZnNldCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgoJCX0gZWxzZSB7CgkJCS8vIEdldCAqcmVhbCogb2Zmc2V0UGFyZW50CgkJCW9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50KCk7CgoJCQkvLyBHZXQgY29ycmVjdCBvZmZzZXRzCgkJCW9mZnNldCA9IHRoaXMub2Zmc2V0KCk7CgkJCWlmICggIWpRdWVyeS5ub2RlTmFtZSggb2Zmc2V0UGFyZW50WyAwIF0sICJodG1sIiApICkgewoJCQkJcGFyZW50T2Zmc2V0ID0gb2Zmc2V0UGFyZW50Lm9mZnNldCgpOwoJCQl9CgoJCQkvLyBBZGQgb2Zmc2V0UGFyZW50IGJvcmRlcnMKCQkJcGFyZW50T2Zmc2V0LnRvcCArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlclRvcFdpZHRoIiwgdHJ1ZSApOwoJCQlwYXJlbnRPZmZzZXQubGVmdCArPSBqUXVlcnkuY3NzKCBvZmZzZXRQYXJlbnRbIDAgXSwgImJvcmRlckxlZnRXaWR0aCIsIHRydWUgKTsKCQl9CgoJCS8vIFN1YnRyYWN0IHBhcmVudCBvZmZzZXRzIGFuZCBlbGVtZW50IG1hcmdpbnMKCQlyZXR1cm4gewoJCQl0b3A6IG9mZnNldC50b3AgLSBwYXJlbnRPZmZzZXQudG9wIC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpblRvcCIsIHRydWUgKSwKCQkJbGVmdDogb2Zmc2V0LmxlZnQgLSBwYXJlbnRPZmZzZXQubGVmdCAtIGpRdWVyeS5jc3MoIGVsZW0sICJtYXJnaW5MZWZ0IiwgdHJ1ZSApCgkJfTsKCX0sCgoJb2Zmc2V0UGFyZW50OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7CgkJCXZhciBvZmZzZXRQYXJlbnQgPSB0aGlzLm9mZnNldFBhcmVudCB8fCBkb2NFbGVtOwoKCQkJd2hpbGUgKCBvZmZzZXRQYXJlbnQgJiYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnQsICJodG1sIiApICYmIGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudCwgInBvc2l0aW9uIiApID09PSAic3RhdGljIiApICkgewoJCQkJb2Zmc2V0UGFyZW50ID0gb2Zmc2V0UGFyZW50Lm9mZnNldFBhcmVudDsKCQkJfQoKCQkJcmV0dXJuIG9mZnNldFBhcmVudCB8fCBkb2NFbGVtOwoJCX0pOwoJfQp9KTsKCi8vIENyZWF0ZSBzY3JvbGxMZWZ0IGFuZCBzY3JvbGxUb3AgbWV0aG9kcwpqUXVlcnkuZWFjaCggeyBzY3JvbGxMZWZ0OiAicGFnZVhPZmZzZXQiLCBzY3JvbGxUb3A6ICJwYWdlWU9mZnNldCIgfSwgZnVuY3Rpb24oIG1ldGhvZCwgcHJvcCApIHsKCXZhciB0b3AgPSAicGFnZVlPZmZzZXQiID09PSBwcm9wOwoKCWpRdWVyeS5mblsgbWV0aG9kIF0gPSBmdW5jdGlvbiggdmFsICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBtZXRob2QsIHZhbCApIHsKCQkJdmFyIHdpbiA9IGdldFdpbmRvdyggZWxlbSApOwoKCQkJaWYgKCB2YWwgPT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiB3aW4gPyB3aW5bIHByb3AgXSA6IGVsZW1bIG1ldGhvZCBdOwoJCQl9CgoJCQlpZiAoIHdpbiApIHsKCQkJCXdpbi5zY3JvbGxUbygKCQkJCQkhdG9wID8gdmFsIDogd2luZG93LnBhZ2VYT2Zmc2V0LAoJCQkJCXRvcCA/IHZhbCA6IHdpbmRvdy5wYWdlWU9mZnNldAoJCQkJKTsKCgkJCX0gZWxzZSB7CgkJCQllbGVtWyBtZXRob2QgXSA9IHZhbDsKCQkJfQoJCX0sIG1ldGhvZCwgdmFsLCBhcmd1bWVudHMubGVuZ3RoLCBudWxsICk7Cgl9Owp9KTsKCi8vIFN1cHBvcnQ6IFNhZmFyaTw3KywgQ2hyb21lPDM3KwovLyBBZGQgdGhlIHRvcC9sZWZ0IGNzc0hvb2tzIHVzaW5nIGpRdWVyeS5mbi5wb3NpdGlvbgovLyBXZWJraXQgYnVnOiBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjkwODQKLy8gQmxpbmsgYnVnOiBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9MjI5MjgwCi8vIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyBwZXJjZW50IHdoZW4gc3BlY2lmaWVkIGZvciB0b3AvbGVmdC9ib3R0b20vcmlnaHQ7Ci8vIHJhdGhlciB0aGFuIG1ha2UgdGhlIGNzcyBtb2R1bGUgZGVwZW5kIG9uIHRoZSBvZmZzZXQgbW9kdWxlLCBqdXN0IGNoZWNrIGZvciBpdCBoZXJlCmpRdWVyeS5lYWNoKCBbICJ0b3AiLCAibGVmdCIgXSwgZnVuY3Rpb24oIGksIHByb3AgKSB7CglqUXVlcnkuY3NzSG9va3NbIHByb3AgXSA9IGFkZEdldEhvb2tJZiggc3VwcG9ydC5waXhlbFBvc2l0aW9uLAoJCWZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJaWYgKCBjb21wdXRlZCApIHsKCQkJCWNvbXB1dGVkID0gY3VyQ1NTKCBlbGVtLCBwcm9wICk7CgkJCQkvLyBJZiBjdXJDU1MgcmV0dXJucyBwZXJjZW50YWdlLCBmYWxsYmFjayB0byBvZmZzZXQKCQkJCXJldHVybiBybnVtbm9ucHgudGVzdCggY29tcHV0ZWQgKSA/CgkJCQkJalF1ZXJ5KCBlbGVtICkucG9zaXRpb24oKVsgcHJvcCBdICsgInB4IiA6CgkJCQkJY29tcHV0ZWQ7CgkJCX0KCQl9CgkpOwp9KTsKCgovLyBDcmVhdGUgaW5uZXJIZWlnaHQsIGlubmVyV2lkdGgsIGhlaWdodCwgd2lkdGgsIG91dGVySGVpZ2h0IGFuZCBvdXRlcldpZHRoIG1ldGhvZHMKalF1ZXJ5LmVhY2goIHsgSGVpZ2h0OiAiaGVpZ2h0IiwgV2lkdGg6ICJ3aWR0aCIgfSwgZnVuY3Rpb24oIG5hbWUsIHR5cGUgKSB7CglqUXVlcnkuZWFjaCggeyBwYWRkaW5nOiAiaW5uZXIiICsgbmFtZSwgY29udGVudDogdHlwZSwgIiI6ICJvdXRlciIgKyBuYW1lIH0sIGZ1bmN0aW9uKCBkZWZhdWx0RXh0cmEsIGZ1bmNOYW1lICkgewoJCS8vIE1hcmdpbiBpcyBvbmx5IGZvciBvdXRlckhlaWdodCwgb3V0ZXJXaWR0aAoJCWpRdWVyeS5mblsgZnVuY05hbWUgXSA9IGZ1bmN0aW9uKCBtYXJnaW4sIHZhbHVlICkgewoJCQl2YXIgY2hhaW5hYmxlID0gYXJndW1lbnRzLmxlbmd0aCAmJiAoIGRlZmF1bHRFeHRyYSB8fCB0eXBlb2YgbWFyZ2luICE9PSAiYm9vbGVhbiIgKSwKCQkJCWV4dHJhID0gZGVmYXVsdEV4dHJhIHx8ICggbWFyZ2luID09PSB0cnVlIHx8IHZhbHVlID09PSB0cnVlID8gIm1hcmdpbiIgOiAiYm9yZGVyIiApOwoKCQkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIHR5cGUsIHZhbHVlICkgewoJCQkJdmFyIGRvYzsKCgkJCQlpZiAoIGpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoJCQkJCS8vIEFzIG9mIDUvOC8yMDEyIHRoaXMgd2lsbCB5aWVsZCBpbmNvcnJlY3QgcmVzdWx0cyBmb3IgTW9iaWxlIFNhZmFyaSwgYnV0IHRoZXJlCgkJCQkJLy8gaXNuJ3QgYSB3aG9sZSBsb3Qgd2UgY2FuIGRvLiBTZWUgcHVsbCByZXF1ZXN0IGF0IHRoaXMgVVJMIGZvciBkaXNjdXNzaW9uOgoJCQkJCS8vIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNzY0CgkJCQkJcmV0dXJuIGVsZW0uZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50WyAiY2xpZW50IiArIG5hbWUgXTsKCQkJCX0KCgkJCQkvLyBHZXQgZG9jdW1lbnQgd2lkdGggb3IgaGVpZ2h0CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJZG9jID0gZWxlbS5kb2N1bWVudEVsZW1lbnQ7CgoJCQkJCS8vIEVpdGhlciBzY3JvbGxbV2lkdGgvSGVpZ2h0XSBvciBvZmZzZXRbV2lkdGgvSGVpZ2h0XSBvciBjbGllbnRbV2lkdGgvSGVpZ2h0XSwKCQkJCQkvLyB3aGljaGV2ZXIgaXMgZ3JlYXRlc3QKCQkJCQlyZXR1cm4gTWF0aC5tYXgoCgkJCQkJCWVsZW0uYm9keVsgInNjcm9sbCIgKyBuYW1lIF0sIGRvY1sgInNjcm9sbCIgKyBuYW1lIF0sCgkJCQkJCWVsZW0uYm9keVsgIm9mZnNldCIgKyBuYW1lIF0sIGRvY1sgIm9mZnNldCIgKyBuYW1lIF0sCgkJCQkJCWRvY1sgImNsaWVudCIgKyBuYW1lIF0KCQkJCQkpOwoJCQkJfQoKCQkJCXJldHVybiB2YWx1ZSA9PT0gdW5kZWZpbmVkID8KCQkJCQkvLyBHZXQgd2lkdGggb3IgaGVpZ2h0IG9uIHRoZSBlbGVtZW50LCByZXF1ZXN0aW5nIGJ1dCBub3QgZm9yY2luZyBwYXJzZUZsb2F0CgkJCQkJalF1ZXJ5LmNzcyggZWxlbSwgdHlwZSwgZXh0cmEgKSA6CgoJCQkJCS8vIFNldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQKCQkJCQlqUXVlcnkuc3R5bGUoIGVsZW0sIHR5cGUsIHZhbHVlLCBleHRyYSApOwoJCQl9LCB0eXBlLCBjaGFpbmFibGUgPyBtYXJnaW4gOiB1bmRlZmluZWQsIGNoYWluYWJsZSwgbnVsbCApOwoJCX07Cgl9KTsKfSk7CgoKLy8gVGhlIG51bWJlciBvZiBlbGVtZW50cyBjb250YWluZWQgaW4gdGhlIG1hdGNoZWQgZWxlbWVudCBzZXQKalF1ZXJ5LmZuLnNpemUgPSBmdW5jdGlvbigpIHsKCXJldHVybiB0aGlzLmxlbmd0aDsKfTsKCmpRdWVyeS5mbi5hbmRTZWxmID0galF1ZXJ5LmZuLmFkZEJhY2s7CgoKCgovLyBSZWdpc3RlciBhcyBhIG5hbWVkIEFNRCBtb2R1bGUsIHNpbmNlIGpRdWVyeSBjYW4gYmUgY29uY2F0ZW5hdGVkIHdpdGggb3RoZXIKLy8gZmlsZXMgdGhhdCBtYXkgdXNlIGRlZmluZSwgYnV0IG5vdCB2aWEgYSBwcm9wZXIgY29uY2F0ZW5hdGlvbiBzY3JpcHQgdGhhdAovLyB1bmRlcnN0YW5kcyBhbm9ueW1vdXMgQU1EIG1vZHVsZXMuIEEgbmFtZWQgQU1EIGlzIHNhZmVzdCBhbmQgbW9zdCByb2J1c3QKLy8gd2F5IHRvIHJlZ2lzdGVyLiBMb3dlcmNhc2UganF1ZXJ5IGlzIHVzZWQgYmVjYXVzZSBBTUQgbW9kdWxlIG5hbWVzIGFyZQovLyBkZXJpdmVkIGZyb20gZmlsZSBuYW1lcywgYW5kIGpRdWVyeSBpcyBub3JtYWxseSBkZWxpdmVyZWQgaW4gYSBsb3dlcmNhc2UKLy8gZmlsZSBuYW1lLiBEbyB0aGlzIGFmdGVyIGNyZWF0aW5nIHRoZSBnbG9iYWwgc28gdGhhdCBpZiBhbiBBTUQgbW9kdWxlIHdhbnRzCi8vIHRvIGNhbGwgbm9Db25mbGljdCB0byBoaWRlIHRoaXMgdmVyc2lvbiBvZiBqUXVlcnksIGl0IHdpbGwgd29yay4KCi8vIE5vdGUgdGhhdCBmb3IgbWF4aW11bSBwb3J0YWJpbGl0eSwgbGlicmFyaWVzIHRoYXQgYXJlIG5vdCBqUXVlcnkgc2hvdWxkCi8vIGRlY2xhcmUgdGhlbXNlbHZlcyBhcyBhbm9ueW1vdXMgbW9kdWxlcywgYW5kIGF2b2lkIHNldHRpbmcgYSBnbG9iYWwgaWYgYW4KLy8gQU1EIGxvYWRlciBpcyBwcmVzZW50LiBqUXVlcnkgaXMgYSBzcGVjaWFsIGNhc2UuIEZvciBtb3JlIGluZm9ybWF0aW9uLCBzZWUKLy8gaHR0cHM6Ly9naXRodWIuY29tL2pyYnVya2UvcmVxdWlyZWpzL3dpa2kvVXBkYXRpbmctZXhpc3RpbmctbGlicmFyaWVzI3dpa2ktYW5vbgoKaWYgKCB0eXBlb2YgZGVmaW5lID09PSAiZnVuY3Rpb24iICYmIGRlZmluZS5hbWQgKSB7CglkZWZpbmUoICJqcXVlcnkiLCBbXSwgZnVuY3Rpb24oKSB7CgkJcmV0dXJuIGpRdWVyeTsKCX0pOwp9CgoKCgp2YXIKCS8vIE1hcCBvdmVyIGpRdWVyeSBpbiBjYXNlIG9mIG92ZXJ3cml0ZQoJX2pRdWVyeSA9IHdpbmRvdy5qUXVlcnksCgoJLy8gTWFwIG92ZXIgdGhlICQgaW4gY2FzZSBvZiBvdmVyd3JpdGUKCV8kID0gd2luZG93LiQ7CgpqUXVlcnkubm9Db25mbGljdCA9IGZ1bmN0aW9uKCBkZWVwICkgewoJaWYgKCB3aW5kb3cuJCA9PT0galF1ZXJ5ICkgewoJCXdpbmRvdy4kID0gXyQ7Cgl9CgoJaWYgKCBkZWVwICYmIHdpbmRvdy5qUXVlcnkgPT09IGpRdWVyeSApIHsKCQl3aW5kb3cualF1ZXJ5ID0gX2pRdWVyeTsKCX0KCglyZXR1cm4galF1ZXJ5Owp9OwoKLy8gRXhwb3NlIGpRdWVyeSBhbmQgJCBpZGVudGlmaWVycywgZXZlbiBpbiBBTUQKLy8gKCM3MTAyI2NvbW1lbnQ6MTAsIGh0dHBzOi8vZ2l0aHViLmNvbS9qcXVlcnkvanF1ZXJ5L3B1bGwvNTU3KQovLyBhbmQgQ29tbW9uSlMgZm9yIGJyb3dzZXIgZW11bGF0b3JzICgjMTM1NjYpCmlmICggdHlwZW9mIG5vR2xvYmFsID09PSBzdHJ1bmRlZmluZWQgKSB7Cgl3aW5kb3cualF1ZXJ5ID0gd2luZG93LiQgPSBqUXVlcnk7Cn0KCgoKCnJldHVybiBqUXVlcnk7Cgp9KSk7Cg=="></script>
<script src="data:application/x-javascript;base64,Ly8gVGhpcyBwcm9kdWN0IGluY2x1ZGVzIGNvbG9yIHNwZWNpZmljYXRpb25zIGFuZCBkZXNpZ25zIGRldmVsb3BlZCBieSBDeW50aGlhIEJyZXdlciAoaHR0cDovL2NvbG9yYnJld2VyLm9yZy8pLgp2YXIgY29sb3JicmV3ZXIgPSB7WWxHbjogewozOiBbIiNmN2ZjYjkiLCIjYWRkZDhlIiwiIzMxYTM1NCJdLAo0OiBbIiNmZmZmY2MiLCIjYzJlNjk5IiwiIzc4YzY3OSIsIiMyMzg0NDMiXSwKNTogWyIjZmZmZmNjIiwiI2MyZTY5OSIsIiM3OGM2NzkiLCIjMzFhMzU0IiwiIzAwNjgzNyJdLAo2OiBbIiNmZmZmY2MiLCIjZDlmMGEzIiwiI2FkZGQ4ZSIsIiM3OGM2NzkiLCIjMzFhMzU0IiwiIzAwNjgzNyJdLAo3OiBbIiNmZmZmY2MiLCIjZDlmMGEzIiwiI2FkZGQ4ZSIsIiM3OGM2NzkiLCIjNDFhYjVkIiwiIzIzODQ0MyIsIiMwMDVhMzIiXSwKODogWyIjZmZmZmU1IiwiI2Y3ZmNiOSIsIiNkOWYwYTMiLCIjYWRkZDhlIiwiIzc4YzY3OSIsIiM0MWFiNWQiLCIjMjM4NDQzIiwiIzAwNWEzMiJdLAo5OiBbIiNmZmZmZTUiLCIjZjdmY2I5IiwiI2Q5ZjBhMyIsIiNhZGRkOGUiLCIjNzhjNjc5IiwiIzQxYWI1ZCIsIiMyMzg0NDMiLCIjMDA2ODM3IiwiIzAwNDUyOSJdCn0sWWxHbkJ1OiB7CjM6IFsiI2VkZjhiMSIsIiM3ZmNkYmIiLCIjMmM3ZmI4Il0sCjQ6IFsiI2ZmZmZjYyIsIiNhMWRhYjQiLCIjNDFiNmM0IiwiIzIyNWVhOCJdLAo1OiBbIiNmZmZmY2MiLCIjYTFkYWI0IiwiIzQxYjZjNCIsIiMyYzdmYjgiLCIjMjUzNDk0Il0sCjY6IFsiI2ZmZmZjYyIsIiNjN2U5YjQiLCIjN2ZjZGJiIiwiIzQxYjZjNCIsIiMyYzdmYjgiLCIjMjUzNDk0Il0sCjc6IFsiI2ZmZmZjYyIsIiNjN2U5YjQiLCIjN2ZjZGJiIiwiIzQxYjZjNCIsIiMxZDkxYzAiLCIjMjI1ZWE4IiwiIzBjMmM4NCJdLAo4OiBbIiNmZmZmZDkiLCIjZWRmOGIxIiwiI2M3ZTliNCIsIiM3ZmNkYmIiLCIjNDFiNmM0IiwiIzFkOTFjMCIsIiMyMjVlYTgiLCIjMGMyYzg0Il0sCjk6IFsiI2ZmZmZkOSIsIiNlZGY4YjEiLCIjYzdlOWI0IiwiIzdmY2RiYiIsIiM0MWI2YzQiLCIjMWQ5MWMwIiwiIzIyNWVhOCIsIiMyNTM0OTQiLCIjMDgxZDU4Il0KfSxHbkJ1OiB7CjM6IFsiI2UwZjNkYiIsIiNhOGRkYjUiLCIjNDNhMmNhIl0sCjQ6IFsiI2YwZjllOCIsIiNiYWU0YmMiLCIjN2JjY2M0IiwiIzJiOGNiZSJdLAo1OiBbIiNmMGY5ZTgiLCIjYmFlNGJjIiwiIzdiY2NjNCIsIiM0M2EyY2EiLCIjMDg2OGFjIl0sCjY6IFsiI2YwZjllOCIsIiNjY2ViYzUiLCIjYThkZGI1IiwiIzdiY2NjNCIsIiM0M2EyY2EiLCIjMDg2OGFjIl0sCjc6IFsiI2YwZjllOCIsIiNjY2ViYzUiLCIjYThkZGI1IiwiIzdiY2NjNCIsIiM0ZWIzZDMiLCIjMmI4Y2JlIiwiIzA4NTg5ZSJdLAo4OiBbIiNmN2ZjZjAiLCIjZTBmM2RiIiwiI2NjZWJjNSIsIiNhOGRkYjUiLCIjN2JjY2M0IiwiIzRlYjNkMyIsIiMyYjhjYmUiLCIjMDg1ODllIl0sCjk6IFsiI2Y3ZmNmMCIsIiNlMGYzZGIiLCIjY2NlYmM1IiwiI2E4ZGRiNSIsIiM3YmNjYzQiLCIjNGViM2QzIiwiIzJiOGNiZSIsIiMwODY4YWMiLCIjMDg0MDgxIl0KfSxCdUduOiB7CjM6IFsiI2U1ZjVmOSIsIiM5OWQ4YzkiLCIjMmNhMjVmIl0sCjQ6IFsiI2VkZjhmYiIsIiNiMmUyZTIiLCIjNjZjMmE0IiwiIzIzOGI0NSJdLAo1OiBbIiNlZGY4ZmIiLCIjYjJlMmUyIiwiIzY2YzJhNCIsIiMyY2EyNWYiLCIjMDA2ZDJjIl0sCjY6IFsiI2VkZjhmYiIsIiNjY2VjZTYiLCIjOTlkOGM5IiwiIzY2YzJhNCIsIiMyY2EyNWYiLCIjMDA2ZDJjIl0sCjc6IFsiI2VkZjhmYiIsIiNjY2VjZTYiLCIjOTlkOGM5IiwiIzY2YzJhNCIsIiM0MWFlNzYiLCIjMjM4YjQ1IiwiIzAwNTgyNCJdLAo4OiBbIiNmN2ZjZmQiLCIjZTVmNWY5IiwiI2NjZWNlNiIsIiM5OWQ4YzkiLCIjNjZjMmE0IiwiIzQxYWU3NiIsIiMyMzhiNDUiLCIjMDA1ODI0Il0sCjk6IFsiI2Y3ZmNmZCIsIiNlNWY1ZjkiLCIjY2NlY2U2IiwiIzk5ZDhjOSIsIiM2NmMyYTQiLCIjNDFhZTc2IiwiIzIzOGI0NSIsIiMwMDZkMmMiLCIjMDA0NDFiIl0KfSxQdUJ1R246IHsKMzogWyIjZWNlMmYwIiwiI2E2YmRkYiIsIiMxYzkwOTkiXSwKNDogWyIjZjZlZmY3IiwiI2JkYzllMSIsIiM2N2E5Y2YiLCIjMDI4MThhIl0sCjU6IFsiI2Y2ZWZmNyIsIiNiZGM5ZTEiLCIjNjdhOWNmIiwiIzFjOTA5OSIsIiMwMTZjNTkiXSwKNjogWyIjZjZlZmY3IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNjdhOWNmIiwiIzFjOTA5OSIsIiMwMTZjNTkiXSwKNzogWyIjZjZlZmY3IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNjdhOWNmIiwiIzM2OTBjMCIsIiMwMjgxOGEiLCIjMDE2NDUwIl0sCjg6IFsiI2ZmZjdmYiIsIiNlY2UyZjAiLCIjZDBkMWU2IiwiI2E2YmRkYiIsIiM2N2E5Y2YiLCIjMzY5MGMwIiwiIzAyODE4YSIsIiMwMTY0NTAiXSwKOTogWyIjZmZmN2ZiIiwiI2VjZTJmMCIsIiNkMGQxZTYiLCIjYTZiZGRiIiwiIzY3YTljZiIsIiMzNjkwYzAiLCIjMDI4MThhIiwiIzAxNmM1OSIsIiMwMTQ2MzYiXQp9LFB1QnU6IHsKMzogWyIjZWNlN2YyIiwiI2E2YmRkYiIsIiMyYjhjYmUiXSwKNDogWyIjZjFlZWY2IiwiI2JkYzllMSIsIiM3NGE5Y2YiLCIjMDU3MGIwIl0sCjU6IFsiI2YxZWVmNiIsIiNiZGM5ZTEiLCIjNzRhOWNmIiwiIzJiOGNiZSIsIiMwNDVhOGQiXSwKNjogWyIjZjFlZWY2IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNzRhOWNmIiwiIzJiOGNiZSIsIiMwNDVhOGQiXSwKNzogWyIjZjFlZWY2IiwiI2QwZDFlNiIsIiNhNmJkZGIiLCIjNzRhOWNmIiwiIzM2OTBjMCIsIiMwNTcwYjAiLCIjMDM0ZTdiIl0sCjg6IFsiI2ZmZjdmYiIsIiNlY2U3ZjIiLCIjZDBkMWU2IiwiI2E2YmRkYiIsIiM3NGE5Y2YiLCIjMzY5MGMwIiwiIzA1NzBiMCIsIiMwMzRlN2IiXSwKOTogWyIjZmZmN2ZiIiwiI2VjZTdmMiIsIiNkMGQxZTYiLCIjYTZiZGRiIiwiIzc0YTljZiIsIiMzNjkwYzAiLCIjMDU3MGIwIiwiIzA0NWE4ZCIsIiMwMjM4NTgiXQp9LEJ1UHU6IHsKMzogWyIjZTBlY2Y0IiwiIzllYmNkYSIsIiM4ODU2YTciXSwKNDogWyIjZWRmOGZiIiwiI2IzY2RlMyIsIiM4Yzk2YzYiLCIjODg0MTlkIl0sCjU6IFsiI2VkZjhmYiIsIiNiM2NkZTMiLCIjOGM5NmM2IiwiIzg4NTZhNyIsIiM4MTBmN2MiXSwKNjogWyIjZWRmOGZiIiwiI2JmZDNlNiIsIiM5ZWJjZGEiLCIjOGM5NmM2IiwiIzg4NTZhNyIsIiM4MTBmN2MiXSwKNzogWyIjZWRmOGZiIiwiI2JmZDNlNiIsIiM5ZWJjZGEiLCIjOGM5NmM2IiwiIzhjNmJiMSIsIiM4ODQxOWQiLCIjNmUwMTZiIl0sCjg6IFsiI2Y3ZmNmZCIsIiNlMGVjZjQiLCIjYmZkM2U2IiwiIzllYmNkYSIsIiM4Yzk2YzYiLCIjOGM2YmIxIiwiIzg4NDE5ZCIsIiM2ZTAxNmIiXSwKOTogWyIjZjdmY2ZkIiwiI2UwZWNmNCIsIiNiZmQzZTYiLCIjOWViY2RhIiwiIzhjOTZjNiIsIiM4YzZiYjEiLCIjODg0MTlkIiwiIzgxMGY3YyIsIiM0ZDAwNGIiXQp9LFJkUHU6IHsKMzogWyIjZmRlMGRkIiwiI2ZhOWZiNSIsIiNjNTFiOGEiXSwKNDogWyIjZmVlYmUyIiwiI2ZiYjRiOSIsIiNmNzY4YTEiLCIjYWUwMTdlIl0sCjU6IFsiI2ZlZWJlMiIsIiNmYmI0YjkiLCIjZjc2OGExIiwiI2M1MWI4YSIsIiM3YTAxNzciXSwKNjogWyIjZmVlYmUyIiwiI2ZjYzVjMCIsIiNmYTlmYjUiLCIjZjc2OGExIiwiI2M1MWI4YSIsIiM3YTAxNzciXSwKNzogWyIjZmVlYmUyIiwiI2ZjYzVjMCIsIiNmYTlmYjUiLCIjZjc2OGExIiwiI2RkMzQ5NyIsIiNhZTAxN2UiLCIjN2EwMTc3Il0sCjg6IFsiI2ZmZjdmMyIsIiNmZGUwZGQiLCIjZmNjNWMwIiwiI2ZhOWZiNSIsIiNmNzY4YTEiLCIjZGQzNDk3IiwiI2FlMDE3ZSIsIiM3YTAxNzciXSwKOTogWyIjZmZmN2YzIiwiI2ZkZTBkZCIsIiNmY2M1YzAiLCIjZmE5ZmI1IiwiI2Y3NjhhMSIsIiNkZDM0OTciLCIjYWUwMTdlIiwiIzdhMDE3NyIsIiM0OTAwNmEiXQp9LFB1UmQ6IHsKMzogWyIjZTdlMWVmIiwiI2M5OTRjNyIsIiNkZDFjNzciXSwKNDogWyIjZjFlZWY2IiwiI2Q3YjVkOCIsIiNkZjY1YjAiLCIjY2UxMjU2Il0sCjU6IFsiI2YxZWVmNiIsIiNkN2I1ZDgiLCIjZGY2NWIwIiwiI2RkMWM3NyIsIiM5ODAwNDMiXSwKNjogWyIjZjFlZWY2IiwiI2Q0YjlkYSIsIiNjOTk0YzciLCIjZGY2NWIwIiwiI2RkMWM3NyIsIiM5ODAwNDMiXSwKNzogWyIjZjFlZWY2IiwiI2Q0YjlkYSIsIiNjOTk0YzciLCIjZGY2NWIwIiwiI2U3Mjk4YSIsIiNjZTEyNTYiLCIjOTEwMDNmIl0sCjg6IFsiI2Y3ZjRmOSIsIiNlN2UxZWYiLCIjZDRiOWRhIiwiI2M5OTRjNyIsIiNkZjY1YjAiLCIjZTcyOThhIiwiI2NlMTI1NiIsIiM5MTAwM2YiXSwKOTogWyIjZjdmNGY5IiwiI2U3ZTFlZiIsIiNkNGI5ZGEiLCIjYzk5NGM3IiwiI2RmNjViMCIsIiNlNzI5OGEiLCIjY2UxMjU2IiwiIzk4MDA0MyIsIiM2NzAwMWYiXQp9LE9yUmQ6IHsKMzogWyIjZmVlOGM4IiwiI2ZkYmI4NCIsIiNlMzRhMzMiXSwKNDogWyIjZmVmMGQ5IiwiI2ZkY2M4YSIsIiNmYzhkNTkiLCIjZDczMDFmIl0sCjU6IFsiI2ZlZjBkOSIsIiNmZGNjOGEiLCIjZmM4ZDU5IiwiI2UzNGEzMyIsIiNiMzAwMDAiXSwKNjogWyIjZmVmMGQ5IiwiI2ZkZDQ5ZSIsIiNmZGJiODQiLCIjZmM4ZDU5IiwiI2UzNGEzMyIsIiNiMzAwMDAiXSwKNzogWyIjZmVmMGQ5IiwiI2ZkZDQ5ZSIsIiNmZGJiODQiLCIjZmM4ZDU5IiwiI2VmNjU0OCIsIiNkNzMwMWYiLCIjOTkwMDAwIl0sCjg6IFsiI2ZmZjdlYyIsIiNmZWU4YzgiLCIjZmRkNDllIiwiI2ZkYmI4NCIsIiNmYzhkNTkiLCIjZWY2NTQ4IiwiI2Q3MzAxZiIsIiM5OTAwMDAiXSwKOTogWyIjZmZmN2VjIiwiI2ZlZThjOCIsIiNmZGQ0OWUiLCIjZmRiYjg0IiwiI2ZjOGQ1OSIsIiNlZjY1NDgiLCIjZDczMDFmIiwiI2IzMDAwMCIsIiM3ZjAwMDAiXQp9LFlsT3JSZDogewozOiBbIiNmZmVkYTAiLCIjZmViMjRjIiwiI2YwM2IyMCJdLAo0OiBbIiNmZmZmYjIiLCIjZmVjYzVjIiwiI2ZkOGQzYyIsIiNlMzFhMWMiXSwKNTogWyIjZmZmZmIyIiwiI2ZlY2M1YyIsIiNmZDhkM2MiLCIjZjAzYjIwIiwiI2JkMDAyNiJdLAo2OiBbIiNmZmZmYjIiLCIjZmVkOTc2IiwiI2ZlYjI0YyIsIiNmZDhkM2MiLCIjZjAzYjIwIiwiI2JkMDAyNiJdLAo3OiBbIiNmZmZmYjIiLCIjZmVkOTc2IiwiI2ZlYjI0YyIsIiNmZDhkM2MiLCIjZmM0ZTJhIiwiI2UzMWExYyIsIiNiMTAwMjYiXSwKODogWyIjZmZmZmNjIiwiI2ZmZWRhMCIsIiNmZWQ5NzYiLCIjZmViMjRjIiwiI2ZkOGQzYyIsIiNmYzRlMmEiLCIjZTMxYTFjIiwiI2IxMDAyNiJdLAo5OiBbIiNmZmZmY2MiLCIjZmZlZGEwIiwiI2ZlZDk3NiIsIiNmZWIyNGMiLCIjZmQ4ZDNjIiwiI2ZjNGUyYSIsIiNlMzFhMWMiLCIjYmQwMDI2IiwiIzgwMDAyNiJdCn0sWWxPckJyOiB7CjM6IFsiI2ZmZjdiYyIsIiNmZWM0NGYiLCIjZDk1ZjBlIl0sCjQ6IFsiI2ZmZmZkNCIsIiNmZWQ5OGUiLCIjZmU5OTI5IiwiI2NjNGMwMiJdLAo1OiBbIiNmZmZmZDQiLCIjZmVkOThlIiwiI2ZlOTkyOSIsIiNkOTVmMGUiLCIjOTkzNDA0Il0sCjY6IFsiI2ZmZmZkNCIsIiNmZWUzOTEiLCIjZmVjNDRmIiwiI2ZlOTkyOSIsIiNkOTVmMGUiLCIjOTkzNDA0Il0sCjc6IFsiI2ZmZmZkNCIsIiNmZWUzOTEiLCIjZmVjNDRmIiwiI2ZlOTkyOSIsIiNlYzcwMTQiLCIjY2M0YzAyIiwiIzhjMmQwNCJdLAo4OiBbIiNmZmZmZTUiLCIjZmZmN2JjIiwiI2ZlZTM5MSIsIiNmZWM0NGYiLCIjZmU5OTI5IiwiI2VjNzAxNCIsIiNjYzRjMDIiLCIjOGMyZDA0Il0sCjk6IFsiI2ZmZmZlNSIsIiNmZmY3YmMiLCIjZmVlMzkxIiwiI2ZlYzQ0ZiIsIiNmZTk5MjkiLCIjZWM3MDE0IiwiI2NjNGMwMiIsIiM5OTM0MDQiLCIjNjYyNTA2Il0KfSxQdXJwbGVzOiB7CjM6IFsiI2VmZWRmNSIsIiNiY2JkZGMiLCIjNzU2YmIxIl0sCjQ6IFsiI2YyZjBmNyIsIiNjYmM5ZTIiLCIjOWU5YWM4IiwiIzZhNTFhMyJdLAo1OiBbIiNmMmYwZjciLCIjY2JjOWUyIiwiIzllOWFjOCIsIiM3NTZiYjEiLCIjNTQyNzhmIl0sCjY6IFsiI2YyZjBmNyIsIiNkYWRhZWIiLCIjYmNiZGRjIiwiIzllOWFjOCIsIiM3NTZiYjEiLCIjNTQyNzhmIl0sCjc6IFsiI2YyZjBmNyIsIiNkYWRhZWIiLCIjYmNiZGRjIiwiIzllOWFjOCIsIiM4MDdkYmEiLCIjNmE1MWEzIiwiIzRhMTQ4NiJdLAo4OiBbIiNmY2ZiZmQiLCIjZWZlZGY1IiwiI2RhZGFlYiIsIiNiY2JkZGMiLCIjOWU5YWM4IiwiIzgwN2RiYSIsIiM2YTUxYTMiLCIjNGExNDg2Il0sCjk6IFsiI2ZjZmJmZCIsIiNlZmVkZjUiLCIjZGFkYWViIiwiI2JjYmRkYyIsIiM5ZTlhYzgiLCIjODA3ZGJhIiwiIzZhNTFhMyIsIiM1NDI3OGYiLCIjM2YwMDdkIl0KfSxCbHVlczogewozOiBbIiNkZWViZjciLCIjOWVjYWUxIiwiIzMxODJiZCJdLAo0OiBbIiNlZmYzZmYiLCIjYmRkN2U3IiwiIzZiYWVkNiIsIiMyMTcxYjUiXSwKNTogWyIjZWZmM2ZmIiwiI2JkZDdlNyIsIiM2YmFlZDYiLCIjMzE4MmJkIiwiIzA4NTE5YyJdLAo2OiBbIiNlZmYzZmYiLCIjYzZkYmVmIiwiIzllY2FlMSIsIiM2YmFlZDYiLCIjMzE4MmJkIiwiIzA4NTE5YyJdLAo3OiBbIiNlZmYzZmYiLCIjYzZkYmVmIiwiIzllY2FlMSIsIiM2YmFlZDYiLCIjNDI5MmM2IiwiIzIxNzFiNSIsIiMwODQ1OTQiXSwKODogWyIjZjdmYmZmIiwiI2RlZWJmNyIsIiNjNmRiZWYiLCIjOWVjYWUxIiwiIzZiYWVkNiIsIiM0MjkyYzYiLCIjMjE3MWI1IiwiIzA4NDU5NCJdLAo5OiBbIiNmN2ZiZmYiLCIjZGVlYmY3IiwiI2M2ZGJlZiIsIiM5ZWNhZTEiLCIjNmJhZWQ2IiwiIzQyOTJjNiIsIiMyMTcxYjUiLCIjMDg1MTljIiwiIzA4MzA2YiJdCn0sR3JlZW5zOiB7CjM6IFsiI2U1ZjVlMCIsIiNhMWQ5OWIiLCIjMzFhMzU0Il0sCjQ6IFsiI2VkZjhlOSIsIiNiYWU0YjMiLCIjNzRjNDc2IiwiIzIzOGI0NSJdLAo1OiBbIiNlZGY4ZTkiLCIjYmFlNGIzIiwiIzc0YzQ3NiIsIiMzMWEzNTQiLCIjMDA2ZDJjIl0sCjY6IFsiI2VkZjhlOSIsIiNjN2U5YzAiLCIjYTFkOTliIiwiIzc0YzQ3NiIsIiMzMWEzNTQiLCIjMDA2ZDJjIl0sCjc6IFsiI2VkZjhlOSIsIiNjN2U5YzAiLCIjYTFkOTliIiwiIzc0YzQ3NiIsIiM0MWFiNWQiLCIjMjM4YjQ1IiwiIzAwNWEzMiJdLAo4OiBbIiNmN2ZjZjUiLCIjZTVmNWUwIiwiI2M3ZTljMCIsIiNhMWQ5OWIiLCIjNzRjNDc2IiwiIzQxYWI1ZCIsIiMyMzhiNDUiLCIjMDA1YTMyIl0sCjk6IFsiI2Y3ZmNmNSIsIiNlNWY1ZTAiLCIjYzdlOWMwIiwiI2ExZDk5YiIsIiM3NGM0NzYiLCIjNDFhYjVkIiwiIzIzOGI0NSIsIiMwMDZkMmMiLCIjMDA0NDFiIl0KfSxPcmFuZ2VzOiB7CjM6IFsiI2ZlZTZjZSIsIiNmZGFlNmIiLCIjZTY1NTBkIl0sCjQ6IFsiI2ZlZWRkZSIsIiNmZGJlODUiLCIjZmQ4ZDNjIiwiI2Q5NDcwMSJdLAo1OiBbIiNmZWVkZGUiLCIjZmRiZTg1IiwiI2ZkOGQzYyIsIiNlNjU1MGQiLCIjYTYzNjAzIl0sCjY6IFsiI2ZlZWRkZSIsIiNmZGQwYTIiLCIjZmRhZTZiIiwiI2ZkOGQzYyIsIiNlNjU1MGQiLCIjYTYzNjAzIl0sCjc6IFsiI2ZlZWRkZSIsIiNmZGQwYTIiLCIjZmRhZTZiIiwiI2ZkOGQzYyIsIiNmMTY5MTMiLCIjZDk0ODAxIiwiIzhjMmQwNCJdLAo4OiBbIiNmZmY1ZWIiLCIjZmVlNmNlIiwiI2ZkZDBhMiIsIiNmZGFlNmIiLCIjZmQ4ZDNjIiwiI2YxNjkxMyIsIiNkOTQ4MDEiLCIjOGMyZDA0Il0sCjk6IFsiI2ZmZjVlYiIsIiNmZWU2Y2UiLCIjZmRkMGEyIiwiI2ZkYWU2YiIsIiNmZDhkM2MiLCIjZjE2OTEzIiwiI2Q5NDgwMSIsIiNhNjM2MDMiLCIjN2YyNzA0Il0KfSxSZWRzOiB7CjM6IFsiI2ZlZTBkMiIsIiNmYzkyNzIiLCIjZGUyZDI2Il0sCjQ6IFsiI2ZlZTVkOSIsIiNmY2FlOTEiLCIjZmI2YTRhIiwiI2NiMTgxZCJdLAo1OiBbIiNmZWU1ZDkiLCIjZmNhZTkxIiwiI2ZiNmE0YSIsIiNkZTJkMjYiLCIjYTUwZjE1Il0sCjY6IFsiI2ZlZTVkOSIsIiNmY2JiYTEiLCIjZmM5MjcyIiwiI2ZiNmE0YSIsIiNkZTJkMjYiLCIjYTUwZjE1Il0sCjc6IFsiI2ZlZTVkOSIsIiNmY2JiYTEiLCIjZmM5MjcyIiwiI2ZiNmE0YSIsIiNlZjNiMmMiLCIjY2IxODFkIiwiIzk5MDAwZCJdLAo4OiBbIiNmZmY1ZjAiLCIjZmVlMGQyIiwiI2ZjYmJhMSIsIiNmYzkyNzIiLCIjZmI2YTRhIiwiI2VmM2IyYyIsIiNjYjE4MWQiLCIjOTkwMDBkIl0sCjk6IFsiI2ZmZjVmMCIsIiNmZWUwZDIiLCIjZmNiYmExIiwiI2ZjOTI3MiIsIiNmYjZhNGEiLCIjZWYzYjJjIiwiI2NiMTgxZCIsIiNhNTBmMTUiLCIjNjcwMDBkIl0KfSxHcmV5czogewozOiBbIiNmMGYwZjAiLCIjYmRiZGJkIiwiIzYzNjM2MyJdLAo0OiBbIiNmN2Y3ZjciLCIjY2NjY2NjIiwiIzk2OTY5NiIsIiM1MjUyNTIiXSwKNTogWyIjZjdmN2Y3IiwiI2NjY2NjYyIsIiM5Njk2OTYiLCIjNjM2MzYzIiwiIzI1MjUyNSJdLAo2OiBbIiNmN2Y3ZjciLCIjZDlkOWQ5IiwiI2JkYmRiZCIsIiM5Njk2OTYiLCIjNjM2MzYzIiwiIzI1MjUyNSJdLAo3OiBbIiNmN2Y3ZjciLCIjZDlkOWQ5IiwiI2JkYmRiZCIsIiM5Njk2OTYiLCIjNzM3MzczIiwiIzUyNTI1MiIsIiMyNTI1MjUiXSwKODogWyIjZmZmZmZmIiwiI2YwZjBmMCIsIiNkOWQ5ZDkiLCIjYmRiZGJkIiwiIzk2OTY5NiIsIiM3MzczNzMiLCIjNTI1MjUyIiwiIzI1MjUyNSJdLAo5OiBbIiNmZmZmZmYiLCIjZjBmMGYwIiwiI2Q5ZDlkOSIsIiNiZGJkYmQiLCIjOTY5Njk2IiwiIzczNzM3MyIsIiM1MjUyNTIiLCIjMjUyNTI1IiwiIzAwMDAwMCJdCn0sUHVPcjogewozOiBbIiNmMWEzNDAiLCIjZjdmN2Y3IiwiIzk5OGVjMyJdLAo0OiBbIiNlNjYxMDEiLCIjZmRiODYzIiwiI2IyYWJkMiIsIiM1ZTNjOTkiXSwKNTogWyIjZTY2MTAxIiwiI2ZkYjg2MyIsIiNmN2Y3ZjciLCIjYjJhYmQyIiwiIzVlM2M5OSJdLAo2OiBbIiNiMzU4MDYiLCIjZjFhMzQwIiwiI2ZlZTBiNiIsIiNkOGRhZWIiLCIjOTk4ZWMzIiwiIzU0Mjc4OCJdLAo3OiBbIiNiMzU4MDYiLCIjZjFhMzQwIiwiI2ZlZTBiNiIsIiNmN2Y3ZjciLCIjZDhkYWViIiwiIzk5OGVjMyIsIiM1NDI3ODgiXSwKODogWyIjYjM1ODA2IiwiI2UwODIxNCIsIiNmZGI4NjMiLCIjZmVlMGI2IiwiI2Q4ZGFlYiIsIiNiMmFiZDIiLCIjODA3M2FjIiwiIzU0Mjc4OCJdLAo5OiBbIiNiMzU4MDYiLCIjZTA4MjE0IiwiI2ZkYjg2MyIsIiNmZWUwYjYiLCIjZjdmN2Y3IiwiI2Q4ZGFlYiIsIiNiMmFiZDIiLCIjODA3M2FjIiwiIzU0Mjc4OCJdLAoxMDogWyIjN2YzYjA4IiwiI2IzNTgwNiIsIiNlMDgyMTQiLCIjZmRiODYzIiwiI2ZlZTBiNiIsIiNkOGRhZWIiLCIjYjJhYmQyIiwiIzgwNzNhYyIsIiM1NDI3ODgiLCIjMmQwMDRiIl0sCjExOiBbIiM3ZjNiMDgiLCIjYjM1ODA2IiwiI2UwODIxNCIsIiNmZGI4NjMiLCIjZmVlMGI2IiwiI2Y3ZjdmNyIsIiNkOGRhZWIiLCIjYjJhYmQyIiwiIzgwNzNhYyIsIiM1NDI3ODgiLCIjMmQwMDRiIl0KfSxCckJHOiB7CjM6IFsiI2Q4YjM2NSIsIiNmNWY1ZjUiLCIjNWFiNGFjIl0sCjQ6IFsiI2E2NjExYSIsIiNkZmMyN2QiLCIjODBjZGMxIiwiIzAxODU3MSJdLAo1OiBbIiNhNjYxMWEiLCIjZGZjMjdkIiwiI2Y1ZjVmNSIsIiM4MGNkYzEiLCIjMDE4NTcxIl0sCjY6IFsiIzhjNTEwYSIsIiNkOGIzNjUiLCIjZjZlOGMzIiwiI2M3ZWFlNSIsIiM1YWI0YWMiLCIjMDE2NjVlIl0sCjc6IFsiIzhjNTEwYSIsIiNkOGIzNjUiLCIjZjZlOGMzIiwiI2Y1ZjVmNSIsIiNjN2VhZTUiLCIjNWFiNGFjIiwiIzAxNjY1ZSJdLAo4OiBbIiM4YzUxMGEiLCIjYmY4MTJkIiwiI2RmYzI3ZCIsIiNmNmU4YzMiLCIjYzdlYWU1IiwiIzgwY2RjMSIsIiMzNTk3OGYiLCIjMDE2NjVlIl0sCjk6IFsiIzhjNTEwYSIsIiNiZjgxMmQiLCIjZGZjMjdkIiwiI2Y2ZThjMyIsIiNmNWY1ZjUiLCIjYzdlYWU1IiwiIzgwY2RjMSIsIiMzNTk3OGYiLCIjMDE2NjVlIl0sCjEwOiBbIiM1NDMwMDUiLCIjOGM1MTBhIiwiI2JmODEyZCIsIiNkZmMyN2QiLCIjZjZlOGMzIiwiI2M3ZWFlNSIsIiM4MGNkYzEiLCIjMzU5NzhmIiwiIzAxNjY1ZSIsIiMwMDNjMzAiXSwKMTE6IFsiIzU0MzAwNSIsIiM4YzUxMGEiLCIjYmY4MTJkIiwiI2RmYzI3ZCIsIiNmNmU4YzMiLCIjZjVmNWY1IiwiI2M3ZWFlNSIsIiM4MGNkYzEiLCIjMzU5NzhmIiwiIzAxNjY1ZSIsIiMwMDNjMzAiXQp9LFBSR246IHsKMzogWyIjYWY4ZGMzIiwiI2Y3ZjdmNyIsIiM3ZmJmN2IiXSwKNDogWyIjN2IzMjk0IiwiI2MyYTVjZiIsIiNhNmRiYTAiLCIjMDA4ODM3Il0sCjU6IFsiIzdiMzI5NCIsIiNjMmE1Y2YiLCIjZjdmN2Y3IiwiI2E2ZGJhMCIsIiMwMDg4MzciXSwKNjogWyIjNzYyYTgzIiwiI2FmOGRjMyIsIiNlN2Q0ZTgiLCIjZDlmMGQzIiwiIzdmYmY3YiIsIiMxYjc4MzciXSwKNzogWyIjNzYyYTgzIiwiI2FmOGRjMyIsIiNlN2Q0ZTgiLCIjZjdmN2Y3IiwiI2Q5ZjBkMyIsIiM3ZmJmN2IiLCIjMWI3ODM3Il0sCjg6IFsiIzc2MmE4MyIsIiM5OTcwYWIiLCIjYzJhNWNmIiwiI2U3ZDRlOCIsIiNkOWYwZDMiLCIjYTZkYmEwIiwiIzVhYWU2MSIsIiMxYjc4MzciXSwKOTogWyIjNzYyYTgzIiwiIzk5NzBhYiIsIiNjMmE1Y2YiLCIjZTdkNGU4IiwiI2Y3ZjdmNyIsIiNkOWYwZDMiLCIjYTZkYmEwIiwiIzVhYWU2MSIsIiMxYjc4MzciXSwKMTA6IFsiIzQwMDA0YiIsIiM3NjJhODMiLCIjOTk3MGFiIiwiI2MyYTVjZiIsIiNlN2Q0ZTgiLCIjZDlmMGQzIiwiI2E2ZGJhMCIsIiM1YWFlNjEiLCIjMWI3ODM3IiwiIzAwNDQxYiJdLAoxMTogWyIjNDAwMDRiIiwiIzc2MmE4MyIsIiM5OTcwYWIiLCIjYzJhNWNmIiwiI2U3ZDRlOCIsIiNmN2Y3ZjciLCIjZDlmMGQzIiwiI2E2ZGJhMCIsIiM1YWFlNjEiLCIjMWI3ODM3IiwiIzAwNDQxYiJdCn0sUGlZRzogewozOiBbIiNlOWEzYzkiLCIjZjdmN2Y3IiwiI2ExZDc2YSJdLAo0OiBbIiNkMDFjOGIiLCIjZjFiNmRhIiwiI2I4ZTE4NiIsIiM0ZGFjMjYiXSwKNTogWyIjZDAxYzhiIiwiI2YxYjZkYSIsIiNmN2Y3ZjciLCIjYjhlMTg2IiwiIzRkYWMyNiJdLAo2OiBbIiNjNTFiN2QiLCIjZTlhM2M5IiwiI2ZkZTBlZiIsIiNlNmY1ZDAiLCIjYTFkNzZhIiwiIzRkOTIyMSJdLAo3OiBbIiNjNTFiN2QiLCIjZTlhM2M5IiwiI2ZkZTBlZiIsIiNmN2Y3ZjciLCIjZTZmNWQwIiwiI2ExZDc2YSIsIiM0ZDkyMjEiXSwKODogWyIjYzUxYjdkIiwiI2RlNzdhZSIsIiNmMWI2ZGEiLCIjZmRlMGVmIiwiI2U2ZjVkMCIsIiNiOGUxODYiLCIjN2ZiYzQxIiwiIzRkOTIyMSJdLAo5OiBbIiNjNTFiN2QiLCIjZGU3N2FlIiwiI2YxYjZkYSIsIiNmZGUwZWYiLCIjZjdmN2Y3IiwiI2U2ZjVkMCIsIiNiOGUxODYiLCIjN2ZiYzQxIiwiIzRkOTIyMSJdLAoxMDogWyIjOGUwMTUyIiwiI2M1MWI3ZCIsIiNkZTc3YWUiLCIjZjFiNmRhIiwiI2ZkZTBlZiIsIiNlNmY1ZDAiLCIjYjhlMTg2IiwiIzdmYmM0MSIsIiM0ZDkyMjEiLCIjMjc2NDE5Il0sCjExOiBbIiM4ZTAxNTIiLCIjYzUxYjdkIiwiI2RlNzdhZSIsIiNmMWI2ZGEiLCIjZmRlMGVmIiwiI2Y3ZjdmNyIsIiNlNmY1ZDAiLCIjYjhlMTg2IiwiIzdmYmM0MSIsIiM0ZDkyMjEiLCIjMjc2NDE5Il0KfSxSZEJ1OiB7CjM6IFsiI2VmOGE2MiIsIiNmN2Y3ZjciLCIjNjdhOWNmIl0sCjQ6IFsiI2NhMDAyMCIsIiNmNGE1ODIiLCIjOTJjNWRlIiwiIzA1NzFiMCJdLAo1OiBbIiNjYTAwMjAiLCIjZjRhNTgyIiwiI2Y3ZjdmNyIsIiM5MmM1ZGUiLCIjMDU3MWIwIl0sCjY6IFsiI2IyMTgyYiIsIiNlZjhhNjIiLCIjZmRkYmM3IiwiI2QxZTVmMCIsIiM2N2E5Y2YiLCIjMjE2NmFjIl0sCjc6IFsiI2IyMTgyYiIsIiNlZjhhNjIiLCIjZmRkYmM3IiwiI2Y3ZjdmNyIsIiNkMWU1ZjAiLCIjNjdhOWNmIiwiIzIxNjZhYyJdLAo4OiBbIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZDFlNWYwIiwiIzkyYzVkZSIsIiM0MzkzYzMiLCIjMjE2NmFjIl0sCjk6IFsiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNmN2Y3ZjciLCIjZDFlNWYwIiwiIzkyYzVkZSIsIiM0MzkzYzMiLCIjMjE2NmFjIl0sCjEwOiBbIiM2NzAwMWYiLCIjYjIxODJiIiwiI2Q2NjA0ZCIsIiNmNGE1ODIiLCIjZmRkYmM3IiwiI2QxZTVmMCIsIiM5MmM1ZGUiLCIjNDM5M2MzIiwiIzIxNjZhYyIsIiMwNTMwNjEiXSwKMTE6IFsiIzY3MDAxZiIsIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZjdmN2Y3IiwiI2QxZTVmMCIsIiM5MmM1ZGUiLCIjNDM5M2MzIiwiIzIxNjZhYyIsIiMwNTMwNjEiXQp9LFJkR3k6IHsKMzogWyIjZWY4YTYyIiwiI2ZmZmZmZiIsIiM5OTk5OTkiXSwKNDogWyIjY2EwMDIwIiwiI2Y0YTU4MiIsIiNiYWJhYmEiLCIjNDA0MDQwIl0sCjU6IFsiI2NhMDAyMCIsIiNmNGE1ODIiLCIjZmZmZmZmIiwiI2JhYmFiYSIsIiM0MDQwNDAiXSwKNjogWyIjYjIxODJiIiwiI2VmOGE2MiIsIiNmZGRiYzciLCIjZTBlMGUwIiwiIzk5OTk5OSIsIiM0ZDRkNGQiXSwKNzogWyIjYjIxODJiIiwiI2VmOGE2MiIsIiNmZGRiYzciLCIjZmZmZmZmIiwiI2UwZTBlMCIsIiM5OTk5OTkiLCIjNGQ0ZDRkIl0sCjg6IFsiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNlMGUwZTAiLCIjYmFiYWJhIiwiIzg3ODc4NyIsIiM0ZDRkNGQiXSwKOTogWyIjYjIxODJiIiwiI2Q2NjA0ZCIsIiNmNGE1ODIiLCIjZmRkYmM3IiwiI2ZmZmZmZiIsIiNlMGUwZTAiLCIjYmFiYWJhIiwiIzg3ODc4NyIsIiM0ZDRkNGQiXSwKMTA6IFsiIzY3MDAxZiIsIiNiMjE4MmIiLCIjZDY2MDRkIiwiI2Y0YTU4MiIsIiNmZGRiYzciLCIjZTBlMGUwIiwiI2JhYmFiYSIsIiM4Nzg3ODciLCIjNGQ0ZDRkIiwiIzFhMWExYSJdLAoxMTogWyIjNjcwMDFmIiwiI2IyMTgyYiIsIiNkNjYwNGQiLCIjZjRhNTgyIiwiI2ZkZGJjNyIsIiNmZmZmZmYiLCIjZTBlMGUwIiwiI2JhYmFiYSIsIiM4Nzg3ODciLCIjNGQ0ZDRkIiwiIzFhMWExYSJdCn0sUmRZbEJ1OiB7CjM6IFsiI2ZjOGQ1OSIsIiNmZmZmYmYiLCIjOTFiZmRiIl0sCjQ6IFsiI2Q3MTkxYyIsIiNmZGFlNjEiLCIjYWJkOWU5IiwiIzJjN2JiNiJdLAo1OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2ZmZmZiZiIsIiNhYmQ5ZTkiLCIjMmM3YmI2Il0sCjY6IFsiI2Q3MzAyNyIsIiNmYzhkNTkiLCIjZmVlMDkwIiwiI2UwZjNmOCIsIiM5MWJmZGIiLCIjNDU3NWI0Il0sCjc6IFsiI2Q3MzAyNyIsIiNmYzhkNTkiLCIjZmVlMDkwIiwiI2ZmZmZiZiIsIiNlMGYzZjgiLCIjOTFiZmRiIiwiIzQ1NzViNCJdLAo4OiBbIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOTAiLCIjZTBmM2Y4IiwiI2FiZDllOSIsIiM3NGFkZDEiLCIjNDU3NWI0Il0sCjk6IFsiI2Q3MzAyNyIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA5MCIsIiNmZmZmYmYiLCIjZTBmM2Y4IiwiI2FiZDllOSIsIiM3NGFkZDEiLCIjNDU3NWI0Il0sCjEwOiBbIiNhNTAwMjYiLCIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDkwIiwiI2UwZjNmOCIsIiNhYmQ5ZTkiLCIjNzRhZGQxIiwiIzQ1NzViNCIsIiMzMTM2OTUiXSwKMTE6IFsiI2E1MDAyNiIsIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOTAiLCIjZmZmZmJmIiwiI2UwZjNmOCIsIiNhYmQ5ZTkiLCIjNzRhZGQxIiwiIzQ1NzViNCIsIiMzMTM2OTUiXQp9LFNwZWN0cmFsOiB7CjM6IFsiI2ZjOGQ1OSIsIiNmZmZmYmYiLCIjOTlkNTk0Il0sCjQ6IFsiI2Q3MTkxYyIsIiNmZGFlNjEiLCIjYWJkZGE0IiwiIzJiODNiYSJdLAo1OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2ZmZmZiZiIsIiNhYmRkYTQiLCIjMmI4M2JhIl0sCjY6IFsiI2Q1M2U0ZiIsIiNmYzhkNTkiLCIjZmVlMDhiIiwiI2U2ZjU5OCIsIiM5OWQ1OTQiLCIjMzI4OGJkIl0sCjc6IFsiI2Q1M2U0ZiIsIiNmYzhkNTkiLCIjZmVlMDhiIiwiI2ZmZmZiZiIsIiNlNmY1OTgiLCIjOTlkNTk0IiwiIzMyODhiZCJdLAo4OiBbIiNkNTNlNGYiLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZTZmNTk4IiwiI2FiZGRhNCIsIiM2NmMyYTUiLCIjMzI4OGJkIl0sCjk6IFsiI2Q1M2U0ZiIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA4YiIsIiNmZmZmYmYiLCIjZTZmNTk4IiwiI2FiZGRhNCIsIiM2NmMyYTUiLCIjMzI4OGJkIl0sCjEwOiBbIiM5ZTAxNDIiLCIjZDUzZTRmIiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2U2ZjU5OCIsIiNhYmRkYTQiLCIjNjZjMmE1IiwiIzMyODhiZCIsIiM1ZTRmYTIiXSwKMTE6IFsiIzllMDE0MiIsIiNkNTNlNGYiLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZmZmZmJmIiwiI2U2ZjU5OCIsIiNhYmRkYTQiLCIjNjZjMmE1IiwiIzMyODhiZCIsIiM1ZTRmYTIiXQp9LFJkWWxHbjogewozOiBbIiNmYzhkNTkiLCIjZmZmZmJmIiwiIzkxY2Y2MCJdLAo0OiBbIiNkNzE5MWMiLCIjZmRhZTYxIiwiI2E2ZDk2YSIsIiMxYTk2NDEiXSwKNTogWyIjZDcxOTFjIiwiI2ZkYWU2MSIsIiNmZmZmYmYiLCIjYTZkOTZhIiwiIzFhOTY0MSJdLAo2OiBbIiNkNzMwMjciLCIjZmM4ZDU5IiwiI2ZlZTA4YiIsIiNkOWVmOGIiLCIjOTFjZjYwIiwiIzFhOTg1MCJdLAo3OiBbIiNkNzMwMjciLCIjZmM4ZDU5IiwiI2ZlZTA4YiIsIiNmZmZmYmYiLCIjZDllZjhiIiwiIzkxY2Y2MCIsIiMxYTk4NTAiXSwKODogWyIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2Q5ZWY4YiIsIiNhNmQ5NmEiLCIjNjZiZDYzIiwiIzFhOTg1MCJdLAo5OiBbIiNkNzMwMjciLCIjZjQ2ZDQzIiwiI2ZkYWU2MSIsIiNmZWUwOGIiLCIjZmZmZmJmIiwiI2Q5ZWY4YiIsIiNhNmQ5NmEiLCIjNjZiZDYzIiwiIzFhOTg1MCJdLAoxMDogWyIjYTUwMDI2IiwiI2Q3MzAyNyIsIiNmNDZkNDMiLCIjZmRhZTYxIiwiI2ZlZTA4YiIsIiNkOWVmOGIiLCIjYTZkOTZhIiwiIzY2YmQ2MyIsIiMxYTk4NTAiLCIjMDA2ODM3Il0sCjExOiBbIiNhNTAwMjYiLCIjZDczMDI3IiwiI2Y0NmQ0MyIsIiNmZGFlNjEiLCIjZmVlMDhiIiwiI2ZmZmZiZiIsIiNkOWVmOGIiLCIjYTZkOTZhIiwiIzY2YmQ2MyIsIiMxYTk4NTAiLCIjMDA2ODM3Il0KfSxBY2NlbnQ6IHsKMzogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiXSwKNDogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5Il0sCjU6IFsiIzdmYzk3ZiIsIiNiZWFlZDQiLCIjZmRjMDg2IiwiI2ZmZmY5OSIsIiMzODZjYjAiXSwKNjogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5IiwiIzM4NmNiMCIsIiNmMDAyN2YiXSwKNzogWyIjN2ZjOTdmIiwiI2JlYWVkNCIsIiNmZGMwODYiLCIjZmZmZjk5IiwiIzM4NmNiMCIsIiNmMDAyN2YiLCIjYmY1YjE3Il0sCjg6IFsiIzdmYzk3ZiIsIiNiZWFlZDQiLCIjZmRjMDg2IiwiI2ZmZmY5OSIsIiMzODZjYjAiLCIjZjAwMjdmIiwiI2JmNWIxNyIsIiM2NjY2NjYiXQp9LERhcmsyOiB7CjM6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIl0sCjQ6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSJdLAo1OiBbIiMxYjllNzciLCIjZDk1ZjAyIiwiIzc1NzBiMyIsIiNlNzI5OGEiLCIjNjZhNjFlIl0sCjY6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSIsIiM2NmE2MWUiLCIjZTZhYjAyIl0sCjc6IFsiIzFiOWU3NyIsIiNkOTVmMDIiLCIjNzU3MGIzIiwiI2U3Mjk4YSIsIiM2NmE2MWUiLCIjZTZhYjAyIiwiI2E2NzYxZCJdLAo4OiBbIiMxYjllNzciLCIjZDk1ZjAyIiwiIzc1NzBiMyIsIiNlNzI5OGEiLCIjNjZhNjFlIiwiI2U2YWIwMiIsIiNhNjc2MWQiLCIjNjY2NjY2Il0KfSxQYWlyZWQ6IHsKMzogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiXSwKNDogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIl0sCjU6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiXSwKNjogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiXSwKNzogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIl0sCjg6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiLCIjZTMxYTFjIiwiI2ZkYmY2ZiIsIiNmZjdmMDAiXSwKOTogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiXSwKMTA6IFsiI2E2Y2VlMyIsIiMxZjc4YjQiLCIjYjJkZjhhIiwiIzMzYTAyYyIsIiNmYjlhOTkiLCIjZTMxYTFjIiwiI2ZkYmY2ZiIsIiNmZjdmMDAiLCIjY2FiMmQ2IiwiIzZhM2Q5YSJdLAoxMTogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiLCIjNmEzZDlhIiwiI2ZmZmY5OSJdLAoxMjogWyIjYTZjZWUzIiwiIzFmNzhiNCIsIiNiMmRmOGEiLCIjMzNhMDJjIiwiI2ZiOWE5OSIsIiNlMzFhMWMiLCIjZmRiZjZmIiwiI2ZmN2YwMCIsIiNjYWIyZDYiLCIjNmEzZDlhIiwiI2ZmZmY5OSIsIiNiMTU5MjgiXQp9LFBhc3RlbDE6IHsKMzogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiXSwKNDogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0Il0sCjU6IFsiI2ZiYjRhZSIsIiNiM2NkZTMiLCIjY2NlYmM1IiwiI2RlY2JlNCIsIiNmZWQ5YTYiXSwKNjogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiXSwKNzogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiLCIjZTVkOGJkIl0sCjg6IFsiI2ZiYjRhZSIsIiNiM2NkZTMiLCIjY2NlYmM1IiwiI2RlY2JlNCIsIiNmZWQ5YTYiLCIjZmZmZmNjIiwiI2U1ZDhiZCIsIiNmZGRhZWMiXSwKOTogWyIjZmJiNGFlIiwiI2IzY2RlMyIsIiNjY2ViYzUiLCIjZGVjYmU0IiwiI2ZlZDlhNiIsIiNmZmZmY2MiLCIjZTVkOGJkIiwiI2ZkZGFlYyIsIiNmMmYyZjIiXQp9LFBhc3RlbDI6IHsKMzogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiXSwKNDogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0Il0sCjU6IFsiI2IzZTJjZCIsIiNmZGNkYWMiLCIjY2JkNWU4IiwiI2Y0Y2FlNCIsIiNlNmY1YzkiXSwKNjogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0IiwiI2U2ZjVjOSIsIiNmZmYyYWUiXSwKNzogWyIjYjNlMmNkIiwiI2ZkY2RhYyIsIiNjYmQ1ZTgiLCIjZjRjYWU0IiwiI2U2ZjVjOSIsIiNmZmYyYWUiLCIjZjFlMmNjIl0sCjg6IFsiI2IzZTJjZCIsIiNmZGNkYWMiLCIjY2JkNWU4IiwiI2Y0Y2FlNCIsIiNlNmY1YzkiLCIjZmZmMmFlIiwiI2YxZTJjYyIsIiNjY2NjY2MiXQp9LFNldDE6IHsKMzogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiXSwKNDogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIl0sCjU6IFsiI2U0MWExYyIsIiMzNzdlYjgiLCIjNGRhZjRhIiwiIzk4NGVhMyIsIiNmZjdmMDAiXSwKNjogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiXSwKNzogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiLCIjYTY1NjI4Il0sCjg6IFsiI2U0MWExYyIsIiMzNzdlYjgiLCIjNGRhZjRhIiwiIzk4NGVhMyIsIiNmZjdmMDAiLCIjZmZmZjMzIiwiI2E2NTYyOCIsIiNmNzgxYmYiXSwKOTogWyIjZTQxYTFjIiwiIzM3N2ViOCIsIiM0ZGFmNGEiLCIjOTg0ZWEzIiwiI2ZmN2YwMCIsIiNmZmZmMzMiLCIjYTY1NjI4IiwiI2Y3ODFiZiIsIiM5OTk5OTkiXQp9LFNldDI6IHsKMzogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiXSwKNDogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIl0sCjU6IFsiIzY2YzJhNSIsIiNmYzhkNjIiLCIjOGRhMGNiIiwiI2U3OGFjMyIsIiNhNmQ4NTQiXSwKNjogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIiwiI2E2ZDg1NCIsIiNmZmQ5MmYiXSwKNzogWyIjNjZjMmE1IiwiI2ZjOGQ2MiIsIiM4ZGEwY2IiLCIjZTc4YWMzIiwiI2E2ZDg1NCIsIiNmZmQ5MmYiLCIjZTVjNDk0Il0sCjg6IFsiIzY2YzJhNSIsIiNmYzhkNjIiLCIjOGRhMGNiIiwiI2U3OGFjMyIsIiNhNmQ4NTQiLCIjZmZkOTJmIiwiI2U1YzQ5NCIsIiNiM2IzYjMiXQp9LFNldDM6IHsKMzogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiXSwKNDogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIl0sCjU6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiXSwKNjogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiXSwKNzogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5Il0sCjg6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiLCIjZmRiNDYyIiwiI2IzZGU2OSIsIiNmY2NkZTUiXSwKOTogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiXSwKMTA6IFsiIzhkZDNjNyIsIiNmZmZmYjMiLCIjYmViYWRhIiwiI2ZiODA3MiIsIiM4MGIxZDMiLCIjZmRiNDYyIiwiI2IzZGU2OSIsIiNmY2NkZTUiLCIjZDlkOWQ5IiwiI2JjODBiZCJdLAoxMTogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiLCIjYmM4MGJkIiwiI2NjZWJjNSJdLAoxMjogWyIjOGRkM2M3IiwiI2ZmZmZiMyIsIiNiZWJhZGEiLCIjZmI4MDcyIiwiIzgwYjFkMyIsIiNmZGI0NjIiLCIjYjNkZTY5IiwiI2ZjY2RlNSIsIiNkOWQ5ZDkiLCIjYmM4MGJkIiwiI2NjZWJjNSIsIiNmZmVkNmYiXQp9fTs="></script>
<script src="data:application/x-javascript;base64,Ly8gICAgIFVuZGVyc2NvcmUuanMgMS44LjMKLy8gICAgIGh0dHA6Ly91bmRlcnNjb3JlanMub3JnCi8vICAgICAoYykgMjAwOS0yMDE1IEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQgSW52ZXN0aWdhdGl2ZSBSZXBvcnRlcnMgJiBFZGl0b3JzCi8vICAgICBVbmRlcnNjb3JlIG1heSBiZSBmcmVlbHkgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLgoKKGZ1bmN0aW9uKCkgewoKICAvLyBCYXNlbGluZSBzZXR1cAogIC8vIC0tLS0tLS0tLS0tLS0tCgogIC8vIEVzdGFibGlzaCB0aGUgcm9vdCBvYmplY3QsIGB3aW5kb3dgIGluIHRoZSBicm93c2VyLCBvciBgZXhwb3J0c2Agb24gdGhlIHNlcnZlci4KICB2YXIgcm9vdCA9IHRoaXM7CgogIC8vIFNhdmUgdGhlIHByZXZpb3VzIHZhbHVlIG9mIHRoZSBgX2AgdmFyaWFibGUuCiAgdmFyIHByZXZpb3VzVW5kZXJzY29yZSA9IHJvb3QuXzsKCiAgLy8gU2F2ZSBieXRlcyBpbiB0aGUgbWluaWZpZWQgKGJ1dCBub3QgZ3ppcHBlZCkgdmVyc2lvbjoKICB2YXIgQXJyYXlQcm90byA9IEFycmF5LnByb3RvdHlwZSwgT2JqUHJvdG8gPSBPYmplY3QucHJvdG90eXBlLCBGdW5jUHJvdG8gPSBGdW5jdGlvbi5wcm90b3R5cGU7CgogIC8vIENyZWF0ZSBxdWljayByZWZlcmVuY2UgdmFyaWFibGVzIGZvciBzcGVlZCBhY2Nlc3MgdG8gY29yZSBwcm90b3R5cGVzLgogIHZhcgogICAgcHVzaCAgICAgICAgICAgICA9IEFycmF5UHJvdG8ucHVzaCwKICAgIHNsaWNlICAgICAgICAgICAgPSBBcnJheVByb3RvLnNsaWNlLAogICAgdG9TdHJpbmcgICAgICAgICA9IE9ialByb3RvLnRvU3RyaW5nLAogICAgaGFzT3duUHJvcGVydHkgICA9IE9ialByb3RvLmhhc093blByb3BlcnR5OwoKICAvLyBBbGwgKipFQ01BU2NyaXB0IDUqKiBuYXRpdmUgZnVuY3Rpb24gaW1wbGVtZW50YXRpb25zIHRoYXQgd2UgaG9wZSB0byB1c2UKICAvLyBhcmUgZGVjbGFyZWQgaGVyZS4KICB2YXIKICAgIG5hdGl2ZUlzQXJyYXkgICAgICA9IEFycmF5LmlzQXJyYXksCiAgICBuYXRpdmVLZXlzICAgICAgICAgPSBPYmplY3Qua2V5cywKICAgIG5hdGl2ZUJpbmQgICAgICAgICA9IEZ1bmNQcm90by5iaW5kLAogICAgbmF0aXZlQ3JlYXRlICAgICAgID0gT2JqZWN0LmNyZWF0ZTsKCiAgLy8gTmFrZWQgZnVuY3Rpb24gcmVmZXJlbmNlIGZvciBzdXJyb2dhdGUtcHJvdG90eXBlLXN3YXBwaW5nLgogIHZhciBDdG9yID0gZnVuY3Rpb24oKXt9OwoKICAvLyBDcmVhdGUgYSBzYWZlIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QgZm9yIHVzZSBiZWxvdy4KICB2YXIgXyA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF8pIHJldHVybiBvYmo7CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgXykpIHJldHVybiBuZXcgXyhvYmopOwogICAgdGhpcy5fd3JhcHBlZCA9IG9iajsKICB9OwoKICAvLyBFeHBvcnQgdGhlIFVuZGVyc2NvcmUgb2JqZWN0IGZvciAqKk5vZGUuanMqKiwgd2l0aAogIC8vIGJhY2t3YXJkcy1jb21wYXRpYmlsaXR5IGZvciB0aGUgb2xkIGByZXF1aXJlKClgIEFQSS4gSWYgd2UncmUgaW4KICAvLyB0aGUgYnJvd3NlciwgYWRkIGBfYCBhcyBhIGdsb2JhbCBvYmplY3QuCiAgaWYgKHR5cGVvZiBleHBvcnRzICE9PSAndW5kZWZpbmVkJykgewogICAgaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7CiAgICAgIGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IF87CiAgICB9CiAgICBleHBvcnRzLl8gPSBfOwogIH0gZWxzZSB7CiAgICByb290Ll8gPSBfOwogIH0KCiAgLy8gQ3VycmVudCB2ZXJzaW9uLgogIF8uVkVSU0lPTiA9ICcxLjguMyc7CgogIC8vIEludGVybmFsIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyBhbiBlZmZpY2llbnQgKGZvciBjdXJyZW50IGVuZ2luZXMpIHZlcnNpb24KICAvLyBvZiB0aGUgcGFzc2VkLWluIGNhbGxiYWNrLCB0byBiZSByZXBlYXRlZGx5IGFwcGxpZWQgaW4gb3RoZXIgVW5kZXJzY29yZQogIC8vIGZ1bmN0aW9ucy4KICB2YXIgb3B0aW1pemVDYiA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQsIGFyZ0NvdW50KSB7CiAgICBpZiAoY29udGV4dCA9PT0gdm9pZCAwKSByZXR1cm4gZnVuYzsKICAgIHN3aXRjaCAoYXJnQ291bnQgPT0gbnVsbCA/IDMgOiBhcmdDb3VudCkgewogICAgICBjYXNlIDE6IHJldHVybiBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUpOwogICAgICB9OwogICAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbih2YWx1ZSwgb3RoZXIpIHsKICAgICAgICByZXR1cm4gZnVuYy5jYWxsKGNvbnRleHQsIHZhbHVlLCBvdGhlcik7CiAgICAgIH07CiAgICAgIGNhc2UgMzogcmV0dXJuIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgdmFsdWUsIGluZGV4LCBjb2xsZWN0aW9uKTsKICAgICAgfTsKICAgICAgY2FzZSA0OiByZXR1cm4gZnVuY3Rpb24oYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbikgewogICAgICAgIHJldHVybiBmdW5jLmNhbGwoY29udGV4dCwgYWNjdW11bGF0b3IsIHZhbHVlLCBpbmRleCwgY29sbGVjdGlvbik7CiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7CiAgICB9OwogIH07CgogIC8vIEEgbW9zdGx5LWludGVybmFsIGZ1bmN0aW9uIHRvIGdlbmVyYXRlIGNhbGxiYWNrcyB0aGF0IGNhbiBiZSBhcHBsaWVkCiAgLy8gdG8gZWFjaCBlbGVtZW50IGluIGEgY29sbGVjdGlvbiwgcmV0dXJuaW5nIHRoZSBkZXNpcmVkIHJlc3VsdCDigJQgZWl0aGVyCiAgLy8gaWRlbnRpdHksIGFuIGFyYml0cmFyeSBjYWxsYmFjaywgYSBwcm9wZXJ0eSBtYXRjaGVyLCBvciBhIHByb3BlcnR5IGFjY2Vzc29yLgogIHZhciBjYiA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCkgewogICAgaWYgKHZhbHVlID09IG51bGwpIHJldHVybiBfLmlkZW50aXR5OwogICAgaWYgKF8uaXNGdW5jdGlvbih2YWx1ZSkpIHJldHVybiBvcHRpbWl6ZUNiKHZhbHVlLCBjb250ZXh0LCBhcmdDb3VudCk7CiAgICBpZiAoXy5pc09iamVjdCh2YWx1ZSkpIHJldHVybiBfLm1hdGNoZXIodmFsdWUpOwogICAgcmV0dXJuIF8ucHJvcGVydHkodmFsdWUpOwogIH07CiAgXy5pdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBjb250ZXh0KSB7CiAgICByZXR1cm4gY2IodmFsdWUsIGNvbnRleHQsIEluZmluaXR5KTsKICB9OwoKICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYXNzaWduZXIgZnVuY3Rpb25zLgogIHZhciBjcmVhdGVBc3NpZ25lciA9IGZ1bmN0aW9uKGtleXNGdW5jLCB1bmRlZmluZWRPbmx5KSB7CiAgICByZXR1cm4gZnVuY3Rpb24ob2JqKSB7CiAgICAgIHZhciBsZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgICBpZiAobGVuZ3RoIDwgMiB8fCBvYmogPT0gbnVsbCkgcmV0dXJuIG9iajsKICAgICAgZm9yICh2YXIgaW5kZXggPSAxOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaW5kZXhdLAogICAgICAgICAgICBrZXlzID0ga2V5c0Z1bmMoc291cmNlKSwKICAgICAgICAgICAgbCA9IGtleXMubGVuZ3RoOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgICAgIGlmICghdW5kZWZpbmVkT25seSB8fCBvYmpba2V5XSA9PT0gdm9pZCAwKSBvYmpba2V5XSA9IHNvdXJjZVtrZXldOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb2JqOwogICAgfTsKICB9OwoKICAvLyBBbiBpbnRlcm5hbCBmdW5jdGlvbiBmb3IgY3JlYXRpbmcgYSBuZXcgb2JqZWN0IHRoYXQgaW5oZXJpdHMgZnJvbSBhbm90aGVyLgogIHZhciBiYXNlQ3JlYXRlID0gZnVuY3Rpb24ocHJvdG90eXBlKSB7CiAgICBpZiAoIV8uaXNPYmplY3QocHJvdG90eXBlKSkgcmV0dXJuIHt9OwogICAgaWYgKG5hdGl2ZUNyZWF0ZSkgcmV0dXJuIG5hdGl2ZUNyZWF0ZShwcm90b3R5cGUpOwogICAgQ3Rvci5wcm90b3R5cGUgPSBwcm90b3R5cGU7CiAgICB2YXIgcmVzdWx0ID0gbmV3IEN0b3I7CiAgICBDdG9yLnByb3RvdHlwZSA9IG51bGw7CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIHZhciBwcm9wZXJ0eSA9IGZ1bmN0aW9uKGtleSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gb2JqID09IG51bGwgPyB2b2lkIDAgOiBvYmpba2V5XTsKICAgIH07CiAgfTsKCiAgLy8gSGVscGVyIGZvciBjb2xsZWN0aW9uIG1ldGhvZHMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBjb2xsZWN0aW9uCiAgLy8gc2hvdWxkIGJlIGl0ZXJhdGVkIGFzIGFuIGFycmF5IG9yIGFzIGFuIG9iamVjdAogIC8vIFJlbGF0ZWQ6IGh0dHA6Ly9wZW9wbGUubW96aWxsYS5vcmcvfmpvcmVuZG9yZmYvZXM2LWRyYWZ0Lmh0bWwjc2VjLXRvbGVuZ3RoCiAgLy8gQXZvaWRzIGEgdmVyeSBuYXN0eSBpT1MgOCBKSVQgYnVnIG9uIEFSTS02NC4gIzIwOTQKICB2YXIgTUFYX0FSUkFZX0lOREVYID0gTWF0aC5wb3coMiwgNTMpIC0gMTsKICB2YXIgZ2V0TGVuZ3RoID0gcHJvcGVydHkoJ2xlbmd0aCcpOwogIHZhciBpc0FycmF5TGlrZSA9IGZ1bmN0aW9uKGNvbGxlY3Rpb24pIHsKICAgIHZhciBsZW5ndGggPSBnZXRMZW5ndGgoY29sbGVjdGlvbik7CiAgICByZXR1cm4gdHlwZW9mIGxlbmd0aCA9PSAnbnVtYmVyJyAmJiBsZW5ndGggPj0gMCAmJiBsZW5ndGggPD0gTUFYX0FSUkFZX0lOREVYOwogIH07CgogIC8vIENvbGxlY3Rpb24gRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0KCiAgLy8gVGhlIGNvcm5lcnN0b25lLCBhbiBgZWFjaGAgaW1wbGVtZW50YXRpb24sIGFrYSBgZm9yRWFjaGAuCiAgLy8gSGFuZGxlcyByYXcgb2JqZWN0cyBpbiBhZGRpdGlvbiB0byBhcnJheS1saWtlcy4gVHJlYXRzIGFsbAogIC8vIHNwYXJzZSBhcnJheS1saWtlcyBhcyBpZiB0aGV5IHdlcmUgZGVuc2UuCiAgXy5lYWNoID0gXy5mb3JFYWNoID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBvcHRpbWl6ZUNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHZhciBpLCBsZW5ndGg7CiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgewogICAgICBmb3IgKGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVyYXRlZShvYmpbaV0sIGksIG9iaik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICAgIGZvciAoaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpdGVyYXRlZShvYmpba2V5c1tpXV0sIGtleXNbaV0sIG9iaik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSByZXN1bHRzIG9mIGFwcGx5aW5nIHRoZSBpdGVyYXRlZSB0byBlYWNoIGVsZW1lbnQuCiAgXy5tYXAgPSBfLmNvbGxlY3QgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksCiAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGgsCiAgICAgICAgcmVzdWx0cyA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgIHJlc3VsdHNbaW5kZXhdID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgcmVkdWNpbmcgZnVuY3Rpb24gaXRlcmF0aW5nIGxlZnQgb3IgcmlnaHQuCiAgZnVuY3Rpb24gY3JlYXRlUmVkdWNlKGRpcikgewogICAgLy8gT3B0aW1pemVkIGl0ZXJhdG9yIGZ1bmN0aW9uIGFzIHVzaW5nIGFyZ3VtZW50cy5sZW5ndGgKICAgIC8vIGluIHRoZSBtYWluIGZ1bmN0aW9uIHdpbGwgZGVvcHRpbWl6ZSB0aGUsIHNlZSAjMTk5MS4KICAgIGZ1bmN0aW9uIGl0ZXJhdG9yKG9iaiwgaXRlcmF0ZWUsIG1lbW8sIGtleXMsIGluZGV4LCBsZW5ndGgpIHsKICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikgewogICAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgICAgbWVtbyA9IGl0ZXJhdGVlKG1lbW8sIG9ialtjdXJyZW50S2V5XSwgY3VycmVudEtleSwgb2JqKTsKICAgICAgfQogICAgICByZXR1cm4gbWVtbzsKICAgIH0KCiAgICByZXR1cm4gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgbWVtbywgY29udGV4dCkgewogICAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDQpOwogICAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLAogICAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGgsCiAgICAgICAgICBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTsKICAgICAgLy8gRGV0ZXJtaW5lIHRoZSBpbml0aWFsIHZhbHVlIGlmIG5vbmUgaXMgcHJvdmlkZWQuCiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMykgewogICAgICAgIG1lbW8gPSBvYmpba2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXhdOwogICAgICAgIGluZGV4ICs9IGRpcjsKICAgICAgfQogICAgICByZXR1cm4gaXRlcmF0b3Iob2JqLCBpdGVyYXRlZSwgbWVtbywga2V5cywgaW5kZXgsIGxlbmd0aCk7CiAgICB9OwogIH0KCiAgLy8gKipSZWR1Y2UqKiBidWlsZHMgdXAgYSBzaW5nbGUgcmVzdWx0IGZyb20gYSBsaXN0IG9mIHZhbHVlcywgYWthIGBpbmplY3RgLAogIC8vIG9yIGBmb2xkbGAuCiAgXy5yZWR1Y2UgPSBfLmZvbGRsID0gXy5pbmplY3QgPSBjcmVhdGVSZWR1Y2UoMSk7CgogIC8vIFRoZSByaWdodC1hc3NvY2lhdGl2ZSB2ZXJzaW9uIG9mIHJlZHVjZSwgYWxzbyBrbm93biBhcyBgZm9sZHJgLgogIF8ucmVkdWNlUmlnaHQgPSBfLmZvbGRyID0gY3JlYXRlUmVkdWNlKC0xKTsKCiAgLy8gUmV0dXJuIHRoZSBmaXJzdCB2YWx1ZSB3aGljaCBwYXNzZXMgYSB0cnV0aCB0ZXN0LiBBbGlhc2VkIGFzIGBkZXRlY3RgLgogIF8uZmluZCA9IF8uZGV0ZWN0ID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHZhciBrZXk7CiAgICBpZiAoaXNBcnJheUxpa2Uob2JqKSkgewogICAgICBrZXkgPSBfLmZpbmRJbmRleChvYmosIHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB9IGVsc2UgewogICAgICBrZXkgPSBfLmZpbmRLZXkob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpOwogICAgfQogICAgaWYgKGtleSAhPT0gdm9pZCAwICYmIGtleSAhPT0gLTEpIHJldHVybiBvYmpba2V5XTsKICB9OwoKICAvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyB0aGF0IHBhc3MgYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYHNlbGVjdGAuCiAgXy5maWx0ZXIgPSBfLnNlbGVjdCA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICB2YXIgcmVzdWx0cyA9IFtdOwogICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICBpZiAocHJlZGljYXRlKHZhbHVlLCBpbmRleCwgbGlzdCkpIHJlc3VsdHMucHVzaCh2YWx1ZSk7CiAgICB9KTsKICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIFJldHVybiBhbGwgdGhlIGVsZW1lbnRzIGZvciB3aGljaCBhIHRydXRoIHRlc3QgZmFpbHMuCiAgXy5yZWplY3QgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcmV0dXJuIF8uZmlsdGVyKG9iaiwgXy5uZWdhdGUoY2IocHJlZGljYXRlKSksIGNvbnRleHQpOwogIH07CgogIC8vIERldGVybWluZSB3aGV0aGVyIGFsbCBvZiB0aGUgZWxlbWVudHMgbWF0Y2ggYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYGFsbGAuCiAgXy5ldmVyeSA9IF8uYWxsID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB2YXIga2V5cyA9ICFpc0FycmF5TGlrZShvYmopICYmIF8ua2V5cyhvYmopLAogICAgICAgIGxlbmd0aCA9IChrZXlzIHx8IG9iaikubGVuZ3RoOwogICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICB2YXIgY3VycmVudEtleSA9IGtleXMgPyBrZXlzW2luZGV4XSA6IGluZGV4OwogICAgICBpZiAoIXByZWRpY2F0ZShvYmpbY3VycmVudEtleV0sIGN1cnJlbnRLZXksIG9iaikpIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH07CgogIC8vIERldGVybWluZSBpZiBhdCBsZWFzdCBvbmUgZWxlbWVudCBpbiB0aGUgb2JqZWN0IG1hdGNoZXMgYSB0cnV0aCB0ZXN0LgogIC8vIEFsaWFzZWQgYXMgYGFueWAuCiAgXy5zb21lID0gXy5hbnkgPSBmdW5jdGlvbihvYmosIHByZWRpY2F0ZSwgY29udGV4dCkgewogICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgIHZhciBrZXlzID0gIWlzQXJyYXlMaWtlKG9iaikgJiYgXy5rZXlzKG9iaiksCiAgICAgICAgbGVuZ3RoID0gKGtleXMgfHwgb2JqKS5sZW5ndGg7CiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHZhciBjdXJyZW50S2V5ID0ga2V5cyA/IGtleXNbaW5kZXhdIDogaW5kZXg7CiAgICAgIGlmIChwcmVkaWNhdGUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopKSByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9OwoKICAvLyBEZXRlcm1pbmUgaWYgdGhlIGFycmF5IG9yIG9iamVjdCBjb250YWlucyBhIGdpdmVuIGl0ZW0gKHVzaW5nIGA9PT1gKS4KICAvLyBBbGlhc2VkIGFzIGBpbmNsdWRlc2AgYW5kIGBpbmNsdWRlYC4KICBfLmNvbnRhaW5zID0gXy5pbmNsdWRlcyA9IF8uaW5jbHVkZSA9IGZ1bmN0aW9uKG9iaiwgaXRlbSwgZnJvbUluZGV4LCBndWFyZCkgewogICAgaWYgKCFpc0FycmF5TGlrZShvYmopKSBvYmogPSBfLnZhbHVlcyhvYmopOwogICAgaWYgKHR5cGVvZiBmcm9tSW5kZXggIT0gJ251bWJlcicgfHwgZ3VhcmQpIGZyb21JbmRleCA9IDA7CiAgICByZXR1cm4gXy5pbmRleE9mKG9iaiwgaXRlbSwgZnJvbUluZGV4KSA+PSAwOwogIH07CgogIC8vIEludm9rZSBhIG1ldGhvZCAod2l0aCBhcmd1bWVudHMpIG9uIGV2ZXJ5IGl0ZW0gaW4gYSBjb2xsZWN0aW9uLgogIF8uaW52b2tlID0gZnVuY3Rpb24ob2JqLCBtZXRob2QpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgdmFyIGlzRnVuYyA9IF8uaXNGdW5jdGlvbihtZXRob2QpOwogICAgcmV0dXJuIF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUpIHsKICAgICAgdmFyIGZ1bmMgPSBpc0Z1bmMgPyBtZXRob2QgOiB2YWx1ZVttZXRob2RdOwogICAgICByZXR1cm4gZnVuYyA9PSBudWxsID8gZnVuYyA6IGZ1bmMuYXBwbHkodmFsdWUsIGFyZ3MpOwogICAgfSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgbWFwYDogZmV0Y2hpbmcgYSBwcm9wZXJ0eS4KICBfLnBsdWNrID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBfLm1hcChvYmosIF8ucHJvcGVydHkoa2V5KSk7CiAgfTsKCiAgLy8gQ29udmVuaWVuY2UgdmVyc2lvbiBvZiBhIGNvbW1vbiB1c2UgY2FzZSBvZiBgZmlsdGVyYDogc2VsZWN0aW5nIG9ubHkgb2JqZWN0cwogIC8vIGNvbnRhaW5pbmcgc3BlY2lmaWMgYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy53aGVyZSA9IGZ1bmN0aW9uKG9iaiwgYXR0cnMpIHsKICAgIHJldHVybiBfLmZpbHRlcihvYmosIF8ubWF0Y2hlcihhdHRycykpOwogIH07CgogIC8vIENvbnZlbmllbmNlIHZlcnNpb24gb2YgYSBjb21tb24gdXNlIGNhc2Ugb2YgYGZpbmRgOiBnZXR0aW5nIHRoZSBmaXJzdCBvYmplY3QKICAvLyBjb250YWluaW5nIHNwZWNpZmljIGBrZXk6dmFsdWVgIHBhaXJzLgogIF8uZmluZFdoZXJlID0gZnVuY3Rpb24ob2JqLCBhdHRycykgewogICAgcmV0dXJuIF8uZmluZChvYmosIF8ubWF0Y2hlcihhdHRycykpOwogIH07CgogIC8vIFJldHVybiB0aGUgbWF4aW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1heCA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSAtSW5maW5pdHksIGxhc3RDb21wdXRlZCA9IC1JbmZpbml0eSwKICAgICAgICB2YWx1ZSwgY29tcHV0ZWQ7CiAgICBpZiAoaXRlcmF0ZWUgPT0gbnVsbCAmJiBvYmogIT0gbnVsbCkgewogICAgICBvYmogPSBpc0FycmF5TGlrZShvYmopID8gb2JqIDogXy52YWx1ZXMob2JqKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IG9iai5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIHZhbHVlID0gb2JqW2ldOwogICAgICAgIGlmICh2YWx1ZSA+IHJlc3VsdCkgewogICAgICAgICAgcmVzdWx0ID0gdmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgICAgY29tcHV0ZWQgPSBpdGVyYXRlZSh2YWx1ZSwgaW5kZXgsIGxpc3QpOwogICAgICAgIGlmIChjb21wdXRlZCA+IGxhc3RDb21wdXRlZCB8fCBjb21wdXRlZCA9PT0gLUluZmluaXR5ICYmIHJlc3VsdCA9PT0gLUluZmluaXR5KSB7CiAgICAgICAgICByZXN1bHQgPSB2YWx1ZTsKICAgICAgICAgIGxhc3RDb21wdXRlZCA9IGNvbXB1dGVkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIFJldHVybiB0aGUgbWluaW11bSBlbGVtZW50IChvciBlbGVtZW50LWJhc2VkIGNvbXB1dGF0aW9uKS4KICBfLm1pbiA9IGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSBJbmZpbml0eSwgbGFzdENvbXB1dGVkID0gSW5maW5pdHksCiAgICAgICAgdmFsdWUsIGNvbXB1dGVkOwogICAgaWYgKGl0ZXJhdGVlID09IG51bGwgJiYgb2JqICE9IG51bGwpIHsKICAgICAgb2JqID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7CiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBvYmoubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICB2YWx1ZSA9IG9ialtpXTsKICAgICAgICBpZiAodmFsdWUgPCByZXN1bHQpIHsKICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7CiAgICAgIF8uZWFjaChvYmosIGZ1bmN0aW9uKHZhbHVlLCBpbmRleCwgbGlzdCkgewogICAgICAgIGNvbXB1dGVkID0gaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KTsKICAgICAgICBpZiAoY29tcHV0ZWQgPCBsYXN0Q29tcHV0ZWQgfHwgY29tcHV0ZWQgPT09IEluZmluaXR5ICYmIHJlc3VsdCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgIHJlc3VsdCA9IHZhbHVlOwogICAgICAgICAgbGFzdENvbXB1dGVkID0gY29tcHV0ZWQ7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gU2h1ZmZsZSBhIGNvbGxlY3Rpb24sIHVzaW5nIHRoZSBtb2Rlcm4gdmVyc2lvbiBvZiB0aGUKICAvLyBbRmlzaGVyLVlhdGVzIHNodWZmbGVdKGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRmlzaGVy4oCTWWF0ZXNfc2h1ZmZsZSkuCiAgXy5zaHVmZmxlID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgc2V0ID0gaXNBcnJheUxpa2Uob2JqKSA/IG9iaiA6IF8udmFsdWVzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0gc2V0Lmxlbmd0aDsKICAgIHZhciBzaHVmZmxlZCA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpbmRleCA9IDAsIHJhbmQ7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHJhbmQgPSBfLnJhbmRvbSgwLCBpbmRleCk7CiAgICAgIGlmIChyYW5kICE9PSBpbmRleCkgc2h1ZmZsZWRbaW5kZXhdID0gc2h1ZmZsZWRbcmFuZF07CiAgICAgIHNodWZmbGVkW3JhbmRdID0gc2V0W2luZGV4XTsKICAgIH0KICAgIHJldHVybiBzaHVmZmxlZDsKICB9OwoKICAvLyBTYW1wbGUgKipuKiogcmFuZG9tIHZhbHVlcyBmcm9tIGEgY29sbGVjdGlvbi4KICAvLyBJZiAqKm4qKiBpcyBub3Qgc3BlY2lmaWVkLCByZXR1cm5zIGEgc2luZ2xlIHJhbmRvbSBlbGVtZW50LgogIC8vIFRoZSBpbnRlcm5hbCBgZ3VhcmRgIGFyZ3VtZW50IGFsbG93cyBpdCB0byB3b3JrIHdpdGggYG1hcGAuCiAgXy5zYW1wbGUgPSBmdW5jdGlvbihvYmosIG4sIGd1YXJkKSB7CiAgICBpZiAobiA9PSBudWxsIHx8IGd1YXJkKSB7CiAgICAgIGlmICghaXNBcnJheUxpa2Uob2JqKSkgb2JqID0gXy52YWx1ZXMob2JqKTsKICAgICAgcmV0dXJuIG9ialtfLnJhbmRvbShvYmoubGVuZ3RoIC0gMSldOwogICAgfQogICAgcmV0dXJuIF8uc2h1ZmZsZShvYmopLnNsaWNlKDAsIE1hdGgubWF4KDAsIG4pKTsKICB9OwoKICAvLyBTb3J0IHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24gcHJvZHVjZWQgYnkgYW4gaXRlcmF0ZWUuCiAgXy5zb3J0QnkgPSBmdW5jdGlvbihvYmosIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgIHJldHVybiBfLnBsdWNrKF8ubWFwKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4LCBsaXN0KSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHZhbHVlLAogICAgICAgIGluZGV4OiBpbmRleCwKICAgICAgICBjcml0ZXJpYTogaXRlcmF0ZWUodmFsdWUsIGluZGV4LCBsaXN0KQogICAgICB9OwogICAgfSkuc29ydChmdW5jdGlvbihsZWZ0LCByaWdodCkgewogICAgICB2YXIgYSA9IGxlZnQuY3JpdGVyaWE7CiAgICAgIHZhciBiID0gcmlnaHQuY3JpdGVyaWE7CiAgICAgIGlmIChhICE9PSBiKSB7CiAgICAgICAgaWYgKGEgPiBiIHx8IGEgPT09IHZvaWQgMCkgcmV0dXJuIDE7CiAgICAgICAgaWYgKGEgPCBiIHx8IGIgPT09IHZvaWQgMCkgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIHJldHVybiBsZWZ0LmluZGV4IC0gcmlnaHQuaW5kZXg7CiAgICB9KSwgJ3ZhbHVlJyk7CiAgfTsKCiAgLy8gQW4gaW50ZXJuYWwgZnVuY3Rpb24gdXNlZCBmb3IgYWdncmVnYXRlICJncm91cCBieSIgb3BlcmF0aW9ucy4KICB2YXIgZ3JvdXAgPSBmdW5jdGlvbihiZWhhdmlvcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaiwgaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgICAgdmFyIHJlc3VsdCA9IHt9OwogICAgICBpdGVyYXRlZSA9IGNiKGl0ZXJhdGVlLCBjb250ZXh0KTsKICAgICAgXy5lYWNoKG9iaiwgZnVuY3Rpb24odmFsdWUsIGluZGV4KSB7CiAgICAgICAgdmFyIGtleSA9IGl0ZXJhdGVlKHZhbHVlLCBpbmRleCwgb2JqKTsKICAgICAgICBiZWhhdmlvcihyZXN1bHQsIHZhbHVlLCBrZXkpOwogICAgICB9KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CiAgfTsKCiAgLy8gR3JvdXBzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24uIFBhc3MgZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZQogIC8vIHRvIGdyb3VwIGJ5LCBvciBhIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgY3JpdGVyaW9uLgogIF8uZ3JvdXBCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgaWYgKF8uaGFzKHJlc3VsdCwga2V5KSkgcmVzdWx0W2tleV0ucHVzaCh2YWx1ZSk7IGVsc2UgcmVzdWx0W2tleV0gPSBbdmFsdWVdOwogIH0pOwoKICAvLyBJbmRleGVzIHRoZSBvYmplY3QncyB2YWx1ZXMgYnkgYSBjcml0ZXJpb24sIHNpbWlsYXIgdG8gYGdyb3VwQnlgLCBidXQgZm9yCiAgLy8gd2hlbiB5b3Uga25vdyB0aGF0IHlvdXIgaW5kZXggdmFsdWVzIHdpbGwgYmUgdW5pcXVlLgogIF8uaW5kZXhCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgcmVzdWx0W2tleV0gPSB2YWx1ZTsKICB9KTsKCiAgLy8gQ291bnRzIGluc3RhbmNlcyBvZiBhbiBvYmplY3QgdGhhdCBncm91cCBieSBhIGNlcnRhaW4gY3JpdGVyaW9uLiBQYXNzCiAgLy8gZWl0aGVyIGEgc3RyaW5nIGF0dHJpYnV0ZSB0byBjb3VudCBieSwgb3IgYSBmdW5jdGlvbiB0aGF0IHJldHVybnMgdGhlCiAgLy8gY3JpdGVyaW9uLgogIF8uY291bnRCeSA9IGdyb3VwKGZ1bmN0aW9uKHJlc3VsdCwgdmFsdWUsIGtleSkgewogICAgaWYgKF8uaGFzKHJlc3VsdCwga2V5KSkgcmVzdWx0W2tleV0rKzsgZWxzZSByZXN1bHRba2V5XSA9IDE7CiAgfSk7CgogIC8vIFNhZmVseSBjcmVhdGUgYSByZWFsLCBsaXZlIGFycmF5IGZyb20gYW55dGhpbmcgaXRlcmFibGUuCiAgXy50b0FycmF5ID0gZnVuY3Rpb24ob2JqKSB7CiAgICBpZiAoIW9iaikgcmV0dXJuIFtdOwogICAgaWYgKF8uaXNBcnJheShvYmopKSByZXR1cm4gc2xpY2UuY2FsbChvYmopOwogICAgaWYgKGlzQXJyYXlMaWtlKG9iaikpIHJldHVybiBfLm1hcChvYmosIF8uaWRlbnRpdHkpOwogICAgcmV0dXJuIF8udmFsdWVzKG9iaik7CiAgfTsKCiAgLy8gUmV0dXJuIHRoZSBudW1iZXIgb2YgZWxlbWVudHMgaW4gYW4gb2JqZWN0LgogIF8uc2l6ZSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gMDsKICAgIHJldHVybiBpc0FycmF5TGlrZShvYmopID8gb2JqLmxlbmd0aCA6IF8ua2V5cyhvYmopLmxlbmd0aDsKICB9OwoKICAvLyBTcGxpdCBhIGNvbGxlY3Rpb24gaW50byB0d28gYXJyYXlzOiBvbmUgd2hvc2UgZWxlbWVudHMgYWxsIHNhdGlzZnkgdGhlIGdpdmVuCiAgLy8gcHJlZGljYXRlLCBhbmQgb25lIHdob3NlIGVsZW1lbnRzIGFsbCBkbyBub3Qgc2F0aXNmeSB0aGUgcHJlZGljYXRlLgogIF8ucGFydGl0aW9uID0gZnVuY3Rpb24ob2JqLCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgIHByZWRpY2F0ZSA9IGNiKHByZWRpY2F0ZSwgY29udGV4dCk7CiAgICB2YXIgcGFzcyA9IFtdLCBmYWlsID0gW107CiAgICBfLmVhY2gob2JqLCBmdW5jdGlvbih2YWx1ZSwga2V5LCBvYmopIHsKICAgICAgKHByZWRpY2F0ZSh2YWx1ZSwga2V5LCBvYmopID8gcGFzcyA6IGZhaWwpLnB1c2godmFsdWUpOwogICAgfSk7CiAgICByZXR1cm4gW3Bhc3MsIGZhaWxdOwogIH07CgogIC8vIEFycmF5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLQoKICAvLyBHZXQgdGhlIGZpcnN0IGVsZW1lbnQgb2YgYW4gYXJyYXkuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gdGhlIGZpcnN0IE4KICAvLyB2YWx1ZXMgaW4gdGhlIGFycmF5LiBBbGlhc2VkIGFzIGBoZWFkYCBhbmQgYHRha2VgLiBUaGUgKipndWFyZCoqIGNoZWNrCiAgLy8gYWxsb3dzIGl0IHRvIHdvcmsgd2l0aCBgXy5tYXBgLgogIF8uZmlyc3QgPSBfLmhlYWQgPSBfLnRha2UgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5WzBdOwogICAgcmV0dXJuIF8uaW5pdGlhbChhcnJheSwgYXJyYXkubGVuZ3RoIC0gbik7CiAgfTsKCiAgLy8gUmV0dXJucyBldmVyeXRoaW5nIGJ1dCB0aGUgbGFzdCBlbnRyeSBvZiB0aGUgYXJyYXkuIEVzcGVjaWFsbHkgdXNlZnVsIG9uCiAgLy8gdGhlIGFyZ3VtZW50cyBvYmplY3QuIFBhc3NpbmcgKipuKiogd2lsbCByZXR1cm4gYWxsIHRoZSB2YWx1ZXMgaW4KICAvLyB0aGUgYXJyYXksIGV4Y2x1ZGluZyB0aGUgbGFzdCBOLgogIF8uaW5pdGlhbCA9IGZ1bmN0aW9uKGFycmF5LCBuLCBndWFyZCkgewogICAgcmV0dXJuIHNsaWNlLmNhbGwoYXJyYXksIDAsIE1hdGgubWF4KDAsIGFycmF5Lmxlbmd0aCAtIChuID09IG51bGwgfHwgZ3VhcmQgPyAxIDogbikpKTsKICB9OwoKICAvLyBHZXQgdGhlIGxhc3QgZWxlbWVudCBvZiBhbiBhcnJheS4gUGFzc2luZyAqKm4qKiB3aWxsIHJldHVybiB0aGUgbGFzdCBOCiAgLy8gdmFsdWVzIGluIHRoZSBhcnJheS4KICBfLmxhc3QgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIGlmIChhcnJheSA9PSBudWxsKSByZXR1cm4gdm9pZCAwOwogICAgaWYgKG4gPT0gbnVsbCB8fCBndWFyZCkgcmV0dXJuIGFycmF5W2FycmF5Lmxlbmd0aCAtIDFdOwogICAgcmV0dXJuIF8ucmVzdChhcnJheSwgTWF0aC5tYXgoMCwgYXJyYXkubGVuZ3RoIC0gbikpOwogIH07CgogIC8vIFJldHVybnMgZXZlcnl0aGluZyBidXQgdGhlIGZpcnN0IGVudHJ5IG9mIHRoZSBhcnJheS4gQWxpYXNlZCBhcyBgdGFpbGAgYW5kIGBkcm9wYC4KICAvLyBFc3BlY2lhbGx5IHVzZWZ1bCBvbiB0aGUgYXJndW1lbnRzIG9iamVjdC4gUGFzc2luZyBhbiAqKm4qKiB3aWxsIHJldHVybgogIC8vIHRoZSByZXN0IE4gdmFsdWVzIGluIHRoZSBhcnJheS4KICBfLnJlc3QgPSBfLnRhaWwgPSBfLmRyb3AgPSBmdW5jdGlvbihhcnJheSwgbiwgZ3VhcmQpIHsKICAgIHJldHVybiBzbGljZS5jYWxsKGFycmF5LCBuID09IG51bGwgfHwgZ3VhcmQgPyAxIDogbik7CiAgfTsKCiAgLy8gVHJpbSBvdXQgYWxsIGZhbHN5IHZhbHVlcyBmcm9tIGFuIGFycmF5LgogIF8uY29tcGFjdCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIF8uaWRlbnRpdHkpOwogIH07CgogIC8vIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIGEgcmVjdXJzaXZlIGBmbGF0dGVuYCBmdW5jdGlvbi4KICB2YXIgZmxhdHRlbiA9IGZ1bmN0aW9uKGlucHV0LCBzaGFsbG93LCBzdHJpY3QsIHN0YXJ0SW5kZXgpIHsKICAgIHZhciBvdXRwdXQgPSBbXSwgaWR4ID0gMDsKICAgIGZvciAodmFyIGkgPSBzdGFydEluZGV4IHx8IDAsIGxlbmd0aCA9IGdldExlbmd0aChpbnB1dCk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgdmFsdWUgPSBpbnB1dFtpXTsKICAgICAgaWYgKGlzQXJyYXlMaWtlKHZhbHVlKSAmJiAoXy5pc0FycmF5KHZhbHVlKSB8fCBfLmlzQXJndW1lbnRzKHZhbHVlKSkpIHsKICAgICAgICAvL2ZsYXR0ZW4gY3VycmVudCBsZXZlbCBvZiBhcnJheSBvciBhcmd1bWVudHMgb2JqZWN0CiAgICAgICAgaWYgKCFzaGFsbG93KSB2YWx1ZSA9IGZsYXR0ZW4odmFsdWUsIHNoYWxsb3csIHN0cmljdCk7CiAgICAgICAgdmFyIGogPSAwLCBsZW4gPSB2YWx1ZS5sZW5ndGg7CiAgICAgICAgb3V0cHV0Lmxlbmd0aCArPSBsZW47CiAgICAgICAgd2hpbGUgKGogPCBsZW4pIHsKICAgICAgICAgIG91dHB1dFtpZHgrK10gPSB2YWx1ZVtqKytdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghc3RyaWN0KSB7CiAgICAgICAgb3V0cHV0W2lkeCsrXSA9IHZhbHVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gb3V0cHV0OwogIH07CgogIC8vIEZsYXR0ZW4gb3V0IGFuIGFycmF5LCBlaXRoZXIgcmVjdXJzaXZlbHkgKGJ5IGRlZmF1bHQpLCBvciBqdXN0IG9uZSBsZXZlbC4KICBfLmZsYXR0ZW4gPSBmdW5jdGlvbihhcnJheSwgc2hhbGxvdykgewogICAgcmV0dXJuIGZsYXR0ZW4oYXJyYXksIHNoYWxsb3csIGZhbHNlKTsKICB9OwoKICAvLyBSZXR1cm4gYSB2ZXJzaW9uIG9mIHRoZSBhcnJheSB0aGF0IGRvZXMgbm90IGNvbnRhaW4gdGhlIHNwZWNpZmllZCB2YWx1ZShzKS4KICBfLndpdGhvdXQgPSBmdW5jdGlvbihhcnJheSkgewogICAgcmV0dXJuIF8uZGlmZmVyZW5jZShhcnJheSwgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICB9OwoKICAvLyBQcm9kdWNlIGEgZHVwbGljYXRlLWZyZWUgdmVyc2lvbiBvZiB0aGUgYXJyYXkuIElmIHRoZSBhcnJheSBoYXMgYWxyZWFkeQogIC8vIGJlZW4gc29ydGVkLCB5b3UgaGF2ZSB0aGUgb3B0aW9uIG9mIHVzaW5nIGEgZmFzdGVyIGFsZ29yaXRobS4KICAvLyBBbGlhc2VkIGFzIGB1bmlxdWVgLgogIF8udW5pcSA9IF8udW5pcXVlID0gZnVuY3Rpb24oYXJyYXksIGlzU29ydGVkLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaWYgKCFfLmlzQm9vbGVhbihpc1NvcnRlZCkpIHsKICAgICAgY29udGV4dCA9IGl0ZXJhdGVlOwogICAgICBpdGVyYXRlZSA9IGlzU29ydGVkOwogICAgICBpc1NvcnRlZCA9IGZhbHNlOwogICAgfQogICAgaWYgKGl0ZXJhdGVlICE9IG51bGwpIGl0ZXJhdGVlID0gY2IoaXRlcmF0ZWUsIGNvbnRleHQpOwogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIHNlZW4gPSBbXTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgoYXJyYXkpOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgdmFyIHZhbHVlID0gYXJyYXlbaV0sCiAgICAgICAgICBjb21wdXRlZCA9IGl0ZXJhdGVlID8gaXRlcmF0ZWUodmFsdWUsIGksIGFycmF5KSA6IHZhbHVlOwogICAgICBpZiAoaXNTb3J0ZWQpIHsKICAgICAgICBpZiAoIWkgfHwgc2VlbiAhPT0gY29tcHV0ZWQpIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgICBzZWVuID0gY29tcHV0ZWQ7CiAgICAgIH0gZWxzZSBpZiAoaXRlcmF0ZWUpIHsKICAgICAgICBpZiAoIV8uY29udGFpbnMoc2VlbiwgY29tcHV0ZWQpKSB7CiAgICAgICAgICBzZWVuLnB1c2goY29tcHV0ZWQpOwogICAgICAgICAgcmVzdWx0LnB1c2godmFsdWUpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICghXy5jb250YWlucyhyZXN1bHQsIHZhbHVlKSkgewogICAgICAgIHJlc3VsdC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBQcm9kdWNlIGFuIGFycmF5IHRoYXQgY29udGFpbnMgdGhlIHVuaW9uOiBlYWNoIGRpc3RpbmN0IGVsZW1lbnQgZnJvbSBhbGwgb2YKICAvLyB0aGUgcGFzc2VkLWluIGFycmF5cy4KICBfLnVuaW9uID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gXy51bmlxKGZsYXR0ZW4oYXJndW1lbnRzLCB0cnVlLCB0cnVlKSk7CiAgfTsKCiAgLy8gUHJvZHVjZSBhbiBhcnJheSB0aGF0IGNvbnRhaW5zIGV2ZXJ5IGl0ZW0gc2hhcmVkIGJldHdlZW4gYWxsIHRoZQogIC8vIHBhc3NlZC1pbiBhcnJheXMuCiAgXy5pbnRlcnNlY3Rpb24gPSBmdW5jdGlvbihhcnJheSkgewogICAgdmFyIHJlc3VsdCA9IFtdOwogICAgdmFyIGFyZ3NMZW5ndGggPSBhcmd1bWVudHMubGVuZ3RoOwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIgaXRlbSA9IGFycmF5W2ldOwogICAgICBpZiAoXy5jb250YWlucyhyZXN1bHQsIGl0ZW0pKSBjb250aW51ZTsKICAgICAgZm9yICh2YXIgaiA9IDE7IGogPCBhcmdzTGVuZ3RoOyBqKyspIHsKICAgICAgICBpZiAoIV8uY29udGFpbnMoYXJndW1lbnRzW2pdLCBpdGVtKSkgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGogPT09IGFyZ3NMZW5ndGgpIHJlc3VsdC5wdXNoKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAvLyBUYWtlIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gb25lIGFycmF5IGFuZCBhIG51bWJlciBvZiBvdGhlciBhcnJheXMuCiAgLy8gT25seSB0aGUgZWxlbWVudHMgcHJlc2VudCBpbiBqdXN0IHRoZSBmaXJzdCBhcnJheSB3aWxsIHJlbWFpbi4KICBfLmRpZmZlcmVuY2UgPSBmdW5jdGlvbihhcnJheSkgewogICAgdmFyIHJlc3QgPSBmbGF0dGVuKGFyZ3VtZW50cywgdHJ1ZSwgdHJ1ZSwgMSk7CiAgICByZXR1cm4gXy5maWx0ZXIoYXJyYXksIGZ1bmN0aW9uKHZhbHVlKXsKICAgICAgcmV0dXJuICFfLmNvbnRhaW5zKHJlc3QsIHZhbHVlKTsKICAgIH0pOwogIH07CgogIC8vIFppcCB0b2dldGhlciBtdWx0aXBsZSBsaXN0cyBpbnRvIGEgc2luZ2xlIGFycmF5IC0tIGVsZW1lbnRzIHRoYXQgc2hhcmUKICAvLyBhbiBpbmRleCBnbyB0b2dldGhlci4KICBfLnppcCA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIF8udW56aXAoYXJndW1lbnRzKTsKICB9OwoKICAvLyBDb21wbGVtZW50IG9mIF8uemlwLiBVbnppcCBhY2NlcHRzIGFuIGFycmF5IG9mIGFycmF5cyBhbmQgZ3JvdXBzCiAgLy8gZWFjaCBhcnJheSdzIGVsZW1lbnRzIG9uIHNoYXJlZCBpbmRpY2VzCiAgXy51bnppcCA9IGZ1bmN0aW9uKGFycmF5KSB7CiAgICB2YXIgbGVuZ3RoID0gYXJyYXkgJiYgXy5tYXgoYXJyYXksIGdldExlbmd0aCkubGVuZ3RoIHx8IDA7CiAgICB2YXIgcmVzdWx0ID0gQXJyYXkobGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrKSB7CiAgICAgIHJlc3VsdFtpbmRleF0gPSBfLnBsdWNrKGFycmF5LCBpbmRleCk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH07CgogIC8vIENvbnZlcnRzIGxpc3RzIGludG8gb2JqZWN0cy4gUGFzcyBlaXRoZXIgYSBzaW5nbGUgYXJyYXkgb2YgYFtrZXksIHZhbHVlXWAKICAvLyBwYWlycywgb3IgdHdvIHBhcmFsbGVsIGFycmF5cyBvZiB0aGUgc2FtZSBsZW5ndGggLS0gb25lIG9mIGtleXMsIGFuZCBvbmUgb2YKICAvLyB0aGUgY29ycmVzcG9uZGluZyB2YWx1ZXMuCiAgXy5vYmplY3QgPSBmdW5jdGlvbihsaXN0LCB2YWx1ZXMpIHsKICAgIHZhciByZXN1bHQgPSB7fTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBnZXRMZW5ndGgobGlzdCk7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBpZiAodmFsdWVzKSB7CiAgICAgICAgcmVzdWx0W2xpc3RbaV1dID0gdmFsdWVzW2ldOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdFtsaXN0W2ldWzBdXSA9IGxpc3RbaV1bMV07CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gR2VuZXJhdG9yIGZ1bmN0aW9uIHRvIGNyZWF0ZSB0aGUgZmluZEluZGV4IGFuZCBmaW5kTGFzdEluZGV4IGZ1bmN0aW9ucwogIGZ1bmN0aW9uIGNyZWF0ZVByZWRpY2F0ZUluZGV4RmluZGVyKGRpcikgewogICAgcmV0dXJuIGZ1bmN0aW9uKGFycmF5LCBwcmVkaWNhdGUsIGNvbnRleHQpIHsKICAgICAgcHJlZGljYXRlID0gY2IocHJlZGljYXRlLCBjb250ZXh0KTsKICAgICAgdmFyIGxlbmd0aCA9IGdldExlbmd0aChhcnJheSk7CiAgICAgIHZhciBpbmRleCA9IGRpciA+IDAgPyAwIDogbGVuZ3RoIC0gMTsKICAgICAgZm9yICg7IGluZGV4ID49IDAgJiYgaW5kZXggPCBsZW5ndGg7IGluZGV4ICs9IGRpcikgewogICAgICAgIGlmIChwcmVkaWNhdGUoYXJyYXlbaW5kZXhdLCBpbmRleCwgYXJyYXkpKSByZXR1cm4gaW5kZXg7CiAgICAgIH0KICAgICAgcmV0dXJuIC0xOwogICAgfTsKICB9CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGluZGV4IG9uIGFuIGFycmF5LWxpa2UgdGhhdCBwYXNzZXMgYSBwcmVkaWNhdGUgdGVzdAogIF8uZmluZEluZGV4ID0gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoMSk7CiAgXy5maW5kTGFzdEluZGV4ID0gY3JlYXRlUHJlZGljYXRlSW5kZXhGaW5kZXIoLTEpOwoKICAvLyBVc2UgYSBjb21wYXJhdG9yIGZ1bmN0aW9uIHRvIGZpZ3VyZSBvdXQgdGhlIHNtYWxsZXN0IGluZGV4IGF0IHdoaWNoCiAgLy8gYW4gb2JqZWN0IHNob3VsZCBiZSBpbnNlcnRlZCBzbyBhcyB0byBtYWludGFpbiBvcmRlci4gVXNlcyBiaW5hcnkgc2VhcmNoLgogIF8uc29ydGVkSW5kZXggPSBmdW5jdGlvbihhcnJheSwgb2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCwgMSk7CiAgICB2YXIgdmFsdWUgPSBpdGVyYXRlZShvYmopOwogICAgdmFyIGxvdyA9IDAsIGhpZ2ggPSBnZXRMZW5ndGgoYXJyYXkpOwogICAgd2hpbGUgKGxvdyA8IGhpZ2gpIHsKICAgICAgdmFyIG1pZCA9IE1hdGguZmxvb3IoKGxvdyArIGhpZ2gpIC8gMik7CiAgICAgIGlmIChpdGVyYXRlZShhcnJheVttaWRdKSA8IHZhbHVlKSBsb3cgPSBtaWQgKyAxOyBlbHNlIGhpZ2ggPSBtaWQ7CiAgICB9CiAgICByZXR1cm4gbG93OwogIH07CgogIC8vIEdlbmVyYXRvciBmdW5jdGlvbiB0byBjcmVhdGUgdGhlIGluZGV4T2YgYW5kIGxhc3RJbmRleE9mIGZ1bmN0aW9ucwogIGZ1bmN0aW9uIGNyZWF0ZUluZGV4RmluZGVyKGRpciwgcHJlZGljYXRlRmluZCwgc29ydGVkSW5kZXgpIHsKICAgIHJldHVybiBmdW5jdGlvbihhcnJheSwgaXRlbSwgaWR4KSB7CiAgICAgIHZhciBpID0gMCwgbGVuZ3RoID0gZ2V0TGVuZ3RoKGFycmF5KTsKICAgICAgaWYgKHR5cGVvZiBpZHggPT0gJ251bWJlcicpIHsKICAgICAgICBpZiAoZGlyID4gMCkgewogICAgICAgICAgICBpID0gaWR4ID49IDAgPyBpZHggOiBNYXRoLm1heChpZHggKyBsZW5ndGgsIGkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGxlbmd0aCA9IGlkeCA+PSAwID8gTWF0aC5taW4oaWR4ICsgMSwgbGVuZ3RoKSA6IGlkeCArIGxlbmd0aCArIDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHNvcnRlZEluZGV4ICYmIGlkeCAmJiBsZW5ndGgpIHsKICAgICAgICBpZHggPSBzb3J0ZWRJbmRleChhcnJheSwgaXRlbSk7CiAgICAgICAgcmV0dXJuIGFycmF5W2lkeF0gPT09IGl0ZW0gPyBpZHggOiAtMTsKICAgICAgfQogICAgICBpZiAoaXRlbSAhPT0gaXRlbSkgewogICAgICAgIGlkeCA9IHByZWRpY2F0ZUZpbmQoc2xpY2UuY2FsbChhcnJheSwgaSwgbGVuZ3RoKSwgXy5pc05hTik7CiAgICAgICAgcmV0dXJuIGlkeCA+PSAwID8gaWR4ICsgaSA6IC0xOwogICAgICB9CiAgICAgIGZvciAoaWR4ID0gZGlyID4gMCA/IGkgOiBsZW5ndGggLSAxOyBpZHggPj0gMCAmJiBpZHggPCBsZW5ndGg7IGlkeCArPSBkaXIpIHsKICAgICAgICBpZiAoYXJyYXlbaWR4XSA9PT0gaXRlbSkgcmV0dXJuIGlkeDsKICAgICAgfQogICAgICByZXR1cm4gLTE7CiAgICB9OwogIH0KCiAgLy8gUmV0dXJuIHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgb2NjdXJyZW5jZSBvZiBhbiBpdGVtIGluIGFuIGFycmF5LAogIC8vIG9yIC0xIGlmIHRoZSBpdGVtIGlzIG5vdCBpbmNsdWRlZCBpbiB0aGUgYXJyYXkuCiAgLy8gSWYgdGhlIGFycmF5IGlzIGxhcmdlIGFuZCBhbHJlYWR5IGluIHNvcnQgb3JkZXIsIHBhc3MgYHRydWVgCiAgLy8gZm9yICoqaXNTb3J0ZWQqKiB0byB1c2UgYmluYXJ5IHNlYXJjaC4KICBfLmluZGV4T2YgPSBjcmVhdGVJbmRleEZpbmRlcigxLCBfLmZpbmRJbmRleCwgXy5zb3J0ZWRJbmRleCk7CiAgXy5sYXN0SW5kZXhPZiA9IGNyZWF0ZUluZGV4RmluZGVyKC0xLCBfLmZpbmRMYXN0SW5kZXgpOwoKICAvLyBHZW5lcmF0ZSBhbiBpbnRlZ2VyIEFycmF5IGNvbnRhaW5pbmcgYW4gYXJpdGhtZXRpYyBwcm9ncmVzc2lvbi4gQSBwb3J0IG9mCiAgLy8gdGhlIG5hdGl2ZSBQeXRob24gYHJhbmdlKClgIGZ1bmN0aW9uLiBTZWUKICAvLyBbdGhlIFB5dGhvbiBkb2N1bWVudGF0aW9uXShodHRwOi8vZG9jcy5weXRob24ub3JnL2xpYnJhcnkvZnVuY3Rpb25zLmh0bWwjcmFuZ2UpLgogIF8ucmFuZ2UgPSBmdW5jdGlvbihzdGFydCwgc3RvcCwgc3RlcCkgewogICAgaWYgKHN0b3AgPT0gbnVsbCkgewogICAgICBzdG9wID0gc3RhcnQgfHwgMDsKICAgICAgc3RhcnQgPSAwOwogICAgfQogICAgc3RlcCA9IHN0ZXAgfHwgMTsKCiAgICB2YXIgbGVuZ3RoID0gTWF0aC5tYXgoTWF0aC5jZWlsKChzdG9wIC0gc3RhcnQpIC8gc3RlcCksIDApOwogICAgdmFyIHJhbmdlID0gQXJyYXkobGVuZ3RoKTsKCiAgICBmb3IgKHZhciBpZHggPSAwOyBpZHggPCBsZW5ndGg7IGlkeCsrLCBzdGFydCArPSBzdGVwKSB7CiAgICAgIHJhbmdlW2lkeF0gPSBzdGFydDsKICAgIH0KCiAgICByZXR1cm4gcmFuZ2U7CiAgfTsKCiAgLy8gRnVuY3Rpb24gKGFoZW0pIEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBEZXRlcm1pbmVzIHdoZXRoZXIgdG8gZXhlY3V0ZSBhIGZ1bmN0aW9uIGFzIGEgY29uc3RydWN0b3IKICAvLyBvciBhIG5vcm1hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm92aWRlZCBhcmd1bWVudHMKICB2YXIgZXhlY3V0ZUJvdW5kID0gZnVuY3Rpb24oc291cmNlRnVuYywgYm91bmRGdW5jLCBjb250ZXh0LCBjYWxsaW5nQ29udGV4dCwgYXJncykgewogICAgaWYgKCEoY2FsbGluZ0NvbnRleHQgaW5zdGFuY2VvZiBib3VuZEZ1bmMpKSByZXR1cm4gc291cmNlRnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgIHZhciBzZWxmID0gYmFzZUNyZWF0ZShzb3VyY2VGdW5jLnByb3RvdHlwZSk7CiAgICB2YXIgcmVzdWx0ID0gc291cmNlRnVuYy5hcHBseShzZWxmLCBhcmdzKTsKICAgIGlmIChfLmlzT2JqZWN0KHJlc3VsdCkpIHJldHVybiByZXN1bHQ7CiAgICByZXR1cm4gc2VsZjsKICB9OwoKICAvLyBDcmVhdGUgYSBmdW5jdGlvbiBib3VuZCB0byBhIGdpdmVuIG9iamVjdCAoYXNzaWduaW5nIGB0aGlzYCwgYW5kIGFyZ3VtZW50cywKICAvLyBvcHRpb25hbGx5KS4gRGVsZWdhdGVzIHRvICoqRUNNQVNjcmlwdCA1KioncyBuYXRpdmUgYEZ1bmN0aW9uLmJpbmRgIGlmCiAgLy8gYXZhaWxhYmxlLgogIF8uYmluZCA9IGZ1bmN0aW9uKGZ1bmMsIGNvbnRleHQpIHsKICAgIGlmIChuYXRpdmVCaW5kICYmIGZ1bmMuYmluZCA9PT0gbmF0aXZlQmluZCkgcmV0dXJuIG5hdGl2ZUJpbmQuYXBwbHkoZnVuYywgc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTsKICAgIGlmICghXy5pc0Z1bmN0aW9uKGZ1bmMpKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdCaW5kIG11c3QgYmUgY2FsbGVkIG9uIGEgZnVuY3Rpb24nKTsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBleGVjdXRlQm91bmQoZnVuYywgYm91bmQsIGNvbnRleHQsIHRoaXMsIGFyZ3MuY29uY2F0KHNsaWNlLmNhbGwoYXJndW1lbnRzKSkpOwogICAgfTsKICAgIHJldHVybiBib3VuZDsKICB9OwoKICAvLyBQYXJ0aWFsbHkgYXBwbHkgYSBmdW5jdGlvbiBieSBjcmVhdGluZyBhIHZlcnNpb24gdGhhdCBoYXMgaGFkIHNvbWUgb2YgaXRzCiAgLy8gYXJndW1lbnRzIHByZS1maWxsZWQsIHdpdGhvdXQgY2hhbmdpbmcgaXRzIGR5bmFtaWMgYHRoaXNgIGNvbnRleHQuIF8gYWN0cwogIC8vIGFzIGEgcGxhY2Vob2xkZXIsIGFsbG93aW5nIGFueSBjb21iaW5hdGlvbiBvZiBhcmd1bWVudHMgdG8gYmUgcHJlLWZpbGxlZC4KICBfLnBhcnRpYWwgPSBmdW5jdGlvbihmdW5jKSB7CiAgICB2YXIgYm91bmRBcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOwogICAgdmFyIGJvdW5kID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBwb3NpdGlvbiA9IDAsIGxlbmd0aCA9IGJvdW5kQXJncy5sZW5ndGg7CiAgICAgIHZhciBhcmdzID0gQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICAgIGFyZ3NbaV0gPSBib3VuZEFyZ3NbaV0gPT09IF8gPyBhcmd1bWVudHNbcG9zaXRpb24rK10gOiBib3VuZEFyZ3NbaV07CiAgICAgIH0KICAgICAgd2hpbGUgKHBvc2l0aW9uIDwgYXJndW1lbnRzLmxlbmd0aCkgYXJncy5wdXNoKGFyZ3VtZW50c1twb3NpdGlvbisrXSk7CiAgICAgIHJldHVybiBleGVjdXRlQm91bmQoZnVuYywgYm91bmQsIHRoaXMsIHRoaXMsIGFyZ3MpOwogICAgfTsKICAgIHJldHVybiBib3VuZDsKICB9OwoKICAvLyBCaW5kIGEgbnVtYmVyIG9mIGFuIG9iamVjdCdzIG1ldGhvZHMgdG8gdGhhdCBvYmplY3QuIFJlbWFpbmluZyBhcmd1bWVudHMKICAvLyBhcmUgdGhlIG1ldGhvZCBuYW1lcyB0byBiZSBib3VuZC4gVXNlZnVsIGZvciBlbnN1cmluZyB0aGF0IGFsbCBjYWxsYmFja3MKICAvLyBkZWZpbmVkIG9uIGFuIG9iamVjdCBiZWxvbmcgdG8gaXQuCiAgXy5iaW5kQWxsID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgaSwgbGVuZ3RoID0gYXJndW1lbnRzLmxlbmd0aCwga2V5OwogICAgaWYgKGxlbmd0aCA8PSAxKSB0aHJvdyBuZXcgRXJyb3IoJ2JpbmRBbGwgbXVzdCBiZSBwYXNzZWQgZnVuY3Rpb24gbmFtZXMnKTsKICAgIGZvciAoaSA9IDE7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBrZXkgPSBhcmd1bWVudHNbaV07CiAgICAgIG9ialtrZXldID0gXy5iaW5kKG9ialtrZXldLCBvYmopOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9OwoKICAvLyBNZW1vaXplIGFuIGV4cGVuc2l2ZSBmdW5jdGlvbiBieSBzdG9yaW5nIGl0cyByZXN1bHRzLgogIF8ubWVtb2l6ZSA9IGZ1bmN0aW9uKGZ1bmMsIGhhc2hlcikgewogICAgdmFyIG1lbW9pemUgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgdmFyIGNhY2hlID0gbWVtb2l6ZS5jYWNoZTsKICAgICAgdmFyIGFkZHJlc3MgPSAnJyArIChoYXNoZXIgPyBoYXNoZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSA6IGtleSk7CiAgICAgIGlmICghXy5oYXMoY2FjaGUsIGFkZHJlc3MpKSBjYWNoZVthZGRyZXNzXSA9IGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgcmV0dXJuIGNhY2hlW2FkZHJlc3NdOwogICAgfTsKICAgIG1lbW9pemUuY2FjaGUgPSB7fTsKICAgIHJldHVybiBtZW1vaXplOwogIH07CgogIC8vIERlbGF5cyBhIGZ1bmN0aW9uIGZvciB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcywgYW5kIHRoZW4gY2FsbHMKICAvLyBpdCB3aXRoIHRoZSBhcmd1bWVudHMgc3VwcGxpZWQuCiAgXy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgIHZhciBhcmdzID0gc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpOwogICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsKICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7CiAgICB9LCB3YWl0KTsKICB9OwoKICAvLyBEZWZlcnMgYSBmdW5jdGlvbiwgc2NoZWR1bGluZyBpdCB0byBydW4gYWZ0ZXIgdGhlIGN1cnJlbnQgY2FsbCBzdGFjayBoYXMKICAvLyBjbGVhcmVkLgogIF8uZGVmZXIgPSBfLnBhcnRpYWwoXy5kZWxheSwgXywgMSk7CgogIC8vIFJldHVybnMgYSBmdW5jdGlvbiwgdGhhdCwgd2hlbiBpbnZva2VkLCB3aWxsIG9ubHkgYmUgdHJpZ2dlcmVkIGF0IG1vc3Qgb25jZQogIC8vIGR1cmluZyBhIGdpdmVuIHdpbmRvdyBvZiB0aW1lLiBOb3JtYWxseSwgdGhlIHRocm90dGxlZCBmdW5jdGlvbiB3aWxsIHJ1bgogIC8vIGFzIG11Y2ggYXMgaXQgY2FuLCB3aXRob3V0IGV2ZXIgZ29pbmcgbW9yZSB0aGFuIG9uY2UgcGVyIGB3YWl0YCBkdXJhdGlvbjsKICAvLyBidXQgaWYgeW91J2QgbGlrZSB0byBkaXNhYmxlIHRoZSBleGVjdXRpb24gb24gdGhlIGxlYWRpbmcgZWRnZSwgcGFzcwogIC8vIGB7bGVhZGluZzogZmFsc2V9YC4gVG8gZGlzYWJsZSBleGVjdXRpb24gb24gdGhlIHRyYWlsaW5nIGVkZ2UsIGRpdHRvLgogIF8udGhyb3R0bGUgPSBmdW5jdGlvbihmdW5jLCB3YWl0LCBvcHRpb25zKSB7CiAgICB2YXIgY29udGV4dCwgYXJncywgcmVzdWx0OwogICAgdmFyIHRpbWVvdXQgPSBudWxsOwogICAgdmFyIHByZXZpb3VzID0gMDsKICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9OwogICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgIHByZXZpb3VzID0gb3B0aW9ucy5sZWFkaW5nID09PSBmYWxzZSA/IDAgOiBfLm5vdygpOwogICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICB9OwogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICB2YXIgbm93ID0gXy5ub3coKTsKICAgICAgaWYgKCFwcmV2aW91cyAmJiBvcHRpb25zLmxlYWRpbmcgPT09IGZhbHNlKSBwcmV2aW91cyA9IG5vdzsKICAgICAgdmFyIHJlbWFpbmluZyA9IHdhaXQgLSAobm93IC0gcHJldmlvdXMpOwogICAgICBjb250ZXh0ID0gdGhpczsKICAgICAgYXJncyA9IGFyZ3VtZW50czsKICAgICAgaWYgKHJlbWFpbmluZyA8PSAwIHx8IHJlbWFpbmluZyA+IHdhaXQpIHsKICAgICAgICBpZiAodGltZW91dCkgewogICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXQpOwogICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgfQogICAgICAgIHByZXZpb3VzID0gbm93OwogICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgaWYgKCF0aW1lb3V0KSBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0gZWxzZSBpZiAoIXRpbWVvdXQgJiYgb3B0aW9ucy50cmFpbGluZyAhPT0gZmFsc2UpIHsKICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgcmVtYWluaW5nKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24sIHRoYXQsIGFzIGxvbmcgYXMgaXQgY29udGludWVzIHRvIGJlIGludm9rZWQsIHdpbGwgbm90CiAgLy8gYmUgdHJpZ2dlcmVkLiBUaGUgZnVuY3Rpb24gd2lsbCBiZSBjYWxsZWQgYWZ0ZXIgaXQgc3RvcHMgYmVpbmcgY2FsbGVkIGZvcgogIC8vIE4gbWlsbGlzZWNvbmRzLiBJZiBgaW1tZWRpYXRlYCBpcyBwYXNzZWQsIHRyaWdnZXIgdGhlIGZ1bmN0aW9uIG9uIHRoZQogIC8vIGxlYWRpbmcgZWRnZSwgaW5zdGVhZCBvZiB0aGUgdHJhaWxpbmcuCiAgXy5kZWJvdW5jZSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQsIGltbWVkaWF0ZSkgewogICAgdmFyIHRpbWVvdXQsIGFyZ3MsIGNvbnRleHQsIHRpbWVzdGFtcCwgcmVzdWx0OwoKICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgbGFzdCA9IF8ubm93KCkgLSB0aW1lc3RhbXA7CgogICAgICBpZiAobGFzdCA8IHdhaXQgJiYgbGFzdCA+PSAwKSB7CiAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aW1lb3V0ID0gbnVsbDsKICAgICAgICBpZiAoIWltbWVkaWF0ZSkgewogICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgfTsKCiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGNvbnRleHQgPSB0aGlzOwogICAgICBhcmdzID0gYXJndW1lbnRzOwogICAgICB0aW1lc3RhbXAgPSBfLm5vdygpOwogICAgICB2YXIgY2FsbE5vdyA9IGltbWVkaWF0ZSAmJiAhdGltZW91dDsKICAgICAgaWYgKCF0aW1lb3V0KSB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgIGlmIChjYWxsTm93KSB7CiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwogIH07CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGZ1bmN0aW9uIHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byB0aGUgc2Vjb25kLAogIC8vIGFsbG93aW5nIHlvdSB0byBhZGp1c3QgYXJndW1lbnRzLCBydW4gY29kZSBiZWZvcmUgYW5kIGFmdGVyLCBhbmQKICAvLyBjb25kaXRpb25hbGx5IGV4ZWN1dGUgdGhlIG9yaWdpbmFsIGZ1bmN0aW9uLgogIF8ud3JhcCA9IGZ1bmN0aW9uKGZ1bmMsIHdyYXBwZXIpIHsKICAgIHJldHVybiBfLnBhcnRpYWwod3JhcHBlciwgZnVuYyk7CiAgfTsKCiAgLy8gUmV0dXJucyBhIG5lZ2F0ZWQgdmVyc2lvbiBvZiB0aGUgcGFzc2VkLWluIHByZWRpY2F0ZS4KICBfLm5lZ2F0ZSA9IGZ1bmN0aW9uKHByZWRpY2F0ZSkgewogICAgcmV0dXJuIGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gIXByZWRpY2F0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpOwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCBpcyB0aGUgY29tcG9zaXRpb24gb2YgYSBsaXN0IG9mIGZ1bmN0aW9ucywgZWFjaAogIC8vIGNvbnN1bWluZyB0aGUgcmV0dXJuIHZhbHVlIG9mIHRoZSBmdW5jdGlvbiB0aGF0IGZvbGxvd3MuCiAgXy5jb21wb3NlID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYXJncyA9IGFyZ3VtZW50czsKICAgIHZhciBzdGFydCA9IGFyZ3MubGVuZ3RoIC0gMTsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgdmFyIGkgPSBzdGFydDsKICAgICAgdmFyIHJlc3VsdCA9IGFyZ3Nbc3RhcnRdLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIHdoaWxlIChpLS0pIHJlc3VsdCA9IGFyZ3NbaV0uY2FsbCh0aGlzLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgb24gYW5kIGFmdGVyIHRoZSBOdGggY2FsbC4KICBfLmFmdGVyID0gZnVuY3Rpb24odGltZXMsIGZ1bmMpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgaWYgKC0tdGltZXMgPCAxKSB7CiAgICAgICAgcmV0dXJuIGZ1bmMuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKICAgICAgfQogICAgfTsKICB9OwoKICAvLyBSZXR1cm5zIGEgZnVuY3Rpb24gdGhhdCB3aWxsIG9ubHkgYmUgZXhlY3V0ZWQgdXAgdG8gKGJ1dCBub3QgaW5jbHVkaW5nKSB0aGUgTnRoIGNhbGwuCiAgXy5iZWZvcmUgPSBmdW5jdGlvbih0aW1lcywgZnVuYykgewogICAgdmFyIG1lbW87CiAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgIGlmICgtLXRpbWVzID4gMCkgewogICAgICAgIG1lbW8gPSBmdW5jLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgIH0KICAgICAgaWYgKHRpbWVzIDw9IDEpIGZ1bmMgPSBudWxsOwogICAgICByZXR1cm4gbWVtbzsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBleGVjdXRlZCBhdCBtb3N0IG9uZSB0aW1lLCBubyBtYXR0ZXIgaG93CiAgLy8gb2Z0ZW4geW91IGNhbGwgaXQuIFVzZWZ1bCBmb3IgbGF6eSBpbml0aWFsaXphdGlvbi4KICBfLm9uY2UgPSBfLnBhcnRpYWwoXy5iZWZvcmUsIDIpOwoKICAvLyBPYmplY3QgRnVuY3Rpb25zCiAgLy8gLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBLZXlzIGluIElFIDwgOSB0aGF0IHdvbid0IGJlIGl0ZXJhdGVkIGJ5IGBmb3Iga2V5IGluIC4uLmAgYW5kIHRodXMgbWlzc2VkLgogIHZhciBoYXNFbnVtQnVnID0gIXt0b1N0cmluZzogbnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoJ3RvU3RyaW5nJyk7CiAgdmFyIG5vbkVudW1lcmFibGVQcm9wcyA9IFsndmFsdWVPZicsICdpc1Byb3RvdHlwZU9mJywgJ3RvU3RyaW5nJywKICAgICAgICAgICAgICAgICAgICAgICdwcm9wZXJ0eUlzRW51bWVyYWJsZScsICdoYXNPd25Qcm9wZXJ0eScsICd0b0xvY2FsZVN0cmluZyddOwoKICBmdW5jdGlvbiBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cykgewogICAgdmFyIG5vbkVudW1JZHggPSBub25FbnVtZXJhYmxlUHJvcHMubGVuZ3RoOwogICAgdmFyIGNvbnN0cnVjdG9yID0gb2JqLmNvbnN0cnVjdG9yOwogICAgdmFyIHByb3RvID0gKF8uaXNGdW5jdGlvbihjb25zdHJ1Y3RvcikgJiYgY29uc3RydWN0b3IucHJvdG90eXBlKSB8fCBPYmpQcm90bzsKCiAgICAvLyBDb25zdHJ1Y3RvciBpcyBhIHNwZWNpYWwgY2FzZS4KICAgIHZhciBwcm9wID0gJ2NvbnN0cnVjdG9yJzsKICAgIGlmIChfLmhhcyhvYmosIHByb3ApICYmICFfLmNvbnRhaW5zKGtleXMsIHByb3ApKSBrZXlzLnB1c2gocHJvcCk7CgogICAgd2hpbGUgKG5vbkVudW1JZHgtLSkgewogICAgICBwcm9wID0gbm9uRW51bWVyYWJsZVByb3BzW25vbkVudW1JZHhdOwogICAgICBpZiAocHJvcCBpbiBvYmogJiYgb2JqW3Byb3BdICE9PSBwcm90b1twcm9wXSAmJiAhXy5jb250YWlucyhrZXlzLCBwcm9wKSkgewogICAgICAgIGtleXMucHVzaChwcm9wKTsKICAgICAgfQogICAgfQogIH0KCiAgLy8gUmV0cmlldmUgdGhlIG5hbWVzIG9mIGFuIG9iamVjdCdzIG93biBwcm9wZXJ0aWVzLgogIC8vIERlbGVnYXRlcyB0byAqKkVDTUFTY3JpcHQgNSoqJ3MgbmF0aXZlIGBPYmplY3Qua2V5c2AKICBfLmtleXMgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107CiAgICBpZiAobmF0aXZlS2V5cykgcmV0dXJuIG5hdGl2ZUtleXMob2JqKTsKICAgIHZhciBrZXlzID0gW107CiAgICBmb3IgKHZhciBrZXkgaW4gb2JqKSBpZiAoXy5oYXMob2JqLCBrZXkpKSBrZXlzLnB1c2goa2V5KTsKICAgIC8vIEFoZW0sIElFIDwgOS4KICAgIGlmIChoYXNFbnVtQnVnKSBjb2xsZWN0Tm9uRW51bVByb3BzKG9iaiwga2V5cyk7CiAgICByZXR1cm4ga2V5czsKICB9OwoKICAvLyBSZXRyaWV2ZSBhbGwgdGhlIHByb3BlcnR5IG5hbWVzIG9mIGFuIG9iamVjdC4KICBfLmFsbEtleXMgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gW107CiAgICB2YXIga2V5cyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikga2V5cy5wdXNoKGtleSk7CiAgICAvLyBBaGVtLCBJRSA8IDkuCiAgICBpZiAoaGFzRW51bUJ1ZykgY29sbGVjdE5vbkVudW1Qcm9wcyhvYmosIGtleXMpOwogICAgcmV0dXJuIGtleXM7CiAgfTsKCiAgLy8gUmV0cmlldmUgdGhlIHZhbHVlcyBvZiBhbiBvYmplY3QncyBwcm9wZXJ0aWVzLgogIF8udmFsdWVzID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIga2V5cyA9IF8ua2V5cyhvYmopOwogICAgdmFyIGxlbmd0aCA9IGtleXMubGVuZ3RoOwogICAgdmFyIHZhbHVlcyA9IEFycmF5KGxlbmd0aCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhbHVlc1tpXSA9IG9ialtrZXlzW2ldXTsKICAgIH0KICAgIHJldHVybiB2YWx1ZXM7CiAgfTsKCiAgLy8gUmV0dXJucyB0aGUgcmVzdWx0cyBvZiBhcHBseWluZyB0aGUgaXRlcmF0ZWUgdG8gZWFjaCBlbGVtZW50IG9mIHRoZSBvYmplY3QKICAvLyBJbiBjb250cmFzdCB0byBfLm1hcCBpdCByZXR1cm5zIGFuIG9iamVjdAogIF8ubWFwT2JqZWN0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaXRlcmF0ZWUgPSBjYihpdGVyYXRlZSwgY29udGV4dCk7CiAgICB2YXIga2V5cyA9ICBfLmtleXMob2JqKSwKICAgICAgICAgIGxlbmd0aCA9IGtleXMubGVuZ3RoLAogICAgICAgICAgcmVzdWx0cyA9IHt9LAogICAgICAgICAgY3VycmVudEtleTsKICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKykgewogICAgICAgIGN1cnJlbnRLZXkgPSBrZXlzW2luZGV4XTsKICAgICAgICByZXN1bHRzW2N1cnJlbnRLZXldID0gaXRlcmF0ZWUob2JqW2N1cnJlbnRLZXldLCBjdXJyZW50S2V5LCBvYmopOwogICAgICB9CiAgICAgIHJldHVybiByZXN1bHRzOwogIH07CgogIC8vIENvbnZlcnQgYW4gb2JqZWN0IGludG8gYSBsaXN0IG9mIGBba2V5LCB2YWx1ZV1gIHBhaXJzLgogIF8ucGFpcnMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBrZXlzID0gXy5rZXlzKG9iaik7CiAgICB2YXIgbGVuZ3RoID0ga2V5cy5sZW5ndGg7CiAgICB2YXIgcGFpcnMgPSBBcnJheShsZW5ndGgpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBwYWlyc1tpXSA9IFtrZXlzW2ldLCBvYmpba2V5c1tpXV1dOwogICAgfQogICAgcmV0dXJuIHBhaXJzOwogIH07CgogIC8vIEludmVydCB0aGUga2V5cyBhbmQgdmFsdWVzIG9mIGFuIG9iamVjdC4gVGhlIHZhbHVlcyBtdXN0IGJlIHNlcmlhbGl6YWJsZS4KICBfLmludmVydCA9IGZ1bmN0aW9uKG9iaikgewogICAgdmFyIHJlc3VsdCA9IHt9OwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKTsKICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHJlc3VsdFtvYmpba2V5c1tpXV1dID0ga2V5c1tpXTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gUmV0dXJuIGEgc29ydGVkIGxpc3Qgb2YgdGhlIGZ1bmN0aW9uIG5hbWVzIGF2YWlsYWJsZSBvbiB0aGUgb2JqZWN0LgogIC8vIEFsaWFzZWQgYXMgYG1ldGhvZHNgCiAgXy5mdW5jdGlvbnMgPSBfLm1ldGhvZHMgPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgZm9yICh2YXIga2V5IGluIG9iaikgewogICAgICBpZiAoXy5pc0Z1bmN0aW9uKG9ialtrZXldKSkgbmFtZXMucHVzaChrZXkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzLnNvcnQoKTsKICB9OwoKICAvLyBFeHRlbmQgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIHByb3BlcnRpZXMgaW4gcGFzc2VkLWluIG9iamVjdChzKS4KICBfLmV4dGVuZCA9IGNyZWF0ZUFzc2lnbmVyKF8uYWxsS2V5cyk7CgogIC8vIEFzc2lnbnMgYSBnaXZlbiBvYmplY3Qgd2l0aCBhbGwgdGhlIG93biBwcm9wZXJ0aWVzIGluIHRoZSBwYXNzZWQtaW4gb2JqZWN0KHMpCiAgLy8gKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL09iamVjdC9hc3NpZ24pCiAgXy5leHRlbmRPd24gPSBfLmFzc2lnbiA9IGNyZWF0ZUFzc2lnbmVyKF8ua2V5cyk7CgogIC8vIFJldHVybnMgdGhlIGZpcnN0IGtleSBvbiBhbiBvYmplY3QgdGhhdCBwYXNzZXMgYSBwcmVkaWNhdGUgdGVzdAogIF8uZmluZEtleSA9IGZ1bmN0aW9uKG9iaiwgcHJlZGljYXRlLCBjb250ZXh0KSB7CiAgICBwcmVkaWNhdGUgPSBjYihwcmVkaWNhdGUsIGNvbnRleHQpOwogICAgdmFyIGtleXMgPSBfLmtleXMob2JqKSwga2V5OwogICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGtleXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAga2V5ID0ga2V5c1tpXTsKICAgICAgaWYgKHByZWRpY2F0ZShvYmpba2V5XSwga2V5LCBvYmopKSByZXR1cm4ga2V5OwogICAgfQogIH07CgogIC8vIFJldHVybiBhIGNvcHkgb2YgdGhlIG9iamVjdCBvbmx5IGNvbnRhaW5pbmcgdGhlIHdoaXRlbGlzdGVkIHByb3BlcnRpZXMuCiAgXy5waWNrID0gZnVuY3Rpb24ob2JqZWN0LCBvaXRlcmF0ZWUsIGNvbnRleHQpIHsKICAgIHZhciByZXN1bHQgPSB7fSwgb2JqID0gb2JqZWN0LCBpdGVyYXRlZSwga2V5czsKICAgIGlmIChvYmogPT0gbnVsbCkgcmV0dXJuIHJlc3VsdDsKICAgIGlmIChfLmlzRnVuY3Rpb24ob2l0ZXJhdGVlKSkgewogICAgICBrZXlzID0gXy5hbGxLZXlzKG9iaik7CiAgICAgIGl0ZXJhdGVlID0gb3B0aW1pemVDYihvaXRlcmF0ZWUsIGNvbnRleHQpOwogICAgfSBlbHNlIHsKICAgICAga2V5cyA9IGZsYXR0ZW4oYXJndW1lbnRzLCBmYWxzZSwgZmFsc2UsIDEpOwogICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXksIG9iaikgeyByZXR1cm4ga2V5IGluIG9iajsgfTsKICAgICAgb2JqID0gT2JqZWN0KG9iaik7CiAgICB9CiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0ga2V5cy5sZW5ndGg7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICB2YXIga2V5ID0ga2V5c1tpXTsKICAgICAgdmFyIHZhbHVlID0gb2JqW2tleV07CiAgICAgIGlmIChpdGVyYXRlZSh2YWx1ZSwga2V5LCBvYmopKSByZXN1bHRba2V5XSA9IHZhbHVlOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9OwoKICAgLy8gUmV0dXJuIGEgY29weSBvZiB0aGUgb2JqZWN0IHdpdGhvdXQgdGhlIGJsYWNrbGlzdGVkIHByb3BlcnRpZXMuCiAgXy5vbWl0ID0gZnVuY3Rpb24ob2JqLCBpdGVyYXRlZSwgY29udGV4dCkgewogICAgaWYgKF8uaXNGdW5jdGlvbihpdGVyYXRlZSkpIHsKICAgICAgaXRlcmF0ZWUgPSBfLm5lZ2F0ZShpdGVyYXRlZSk7CiAgICB9IGVsc2UgewogICAgICB2YXIga2V5cyA9IF8ubWFwKGZsYXR0ZW4oYXJndW1lbnRzLCBmYWxzZSwgZmFsc2UsIDEpLCBTdHJpbmcpOwogICAgICBpdGVyYXRlZSA9IGZ1bmN0aW9uKHZhbHVlLCBrZXkpIHsKICAgICAgICByZXR1cm4gIV8uY29udGFpbnMoa2V5cywga2V5KTsKICAgICAgfTsKICAgIH0KICAgIHJldHVybiBfLnBpY2sob2JqLCBpdGVyYXRlZSwgY29udGV4dCk7CiAgfTsKCiAgLy8gRmlsbCBpbiBhIGdpdmVuIG9iamVjdCB3aXRoIGRlZmF1bHQgcHJvcGVydGllcy4KICBfLmRlZmF1bHRzID0gY3JlYXRlQXNzaWduZXIoXy5hbGxLZXlzLCB0cnVlKTsKCiAgLy8gQ3JlYXRlcyBhbiBvYmplY3QgdGhhdCBpbmhlcml0cyBmcm9tIHRoZSBnaXZlbiBwcm90b3R5cGUgb2JqZWN0LgogIC8vIElmIGFkZGl0aW9uYWwgcHJvcGVydGllcyBhcmUgcHJvdmlkZWQgdGhlbiB0aGV5IHdpbGwgYmUgYWRkZWQgdG8gdGhlCiAgLy8gY3JlYXRlZCBvYmplY3QuCiAgXy5jcmVhdGUgPSBmdW5jdGlvbihwcm90b3R5cGUsIHByb3BzKSB7CiAgICB2YXIgcmVzdWx0ID0gYmFzZUNyZWF0ZShwcm90b3R5cGUpOwogICAgaWYgKHByb3BzKSBfLmV4dGVuZE93bihyZXN1bHQsIHByb3BzKTsKICAgIHJldHVybiByZXN1bHQ7CiAgfTsKCiAgLy8gQ3JlYXRlIGEgKHNoYWxsb3ctY2xvbmVkKSBkdXBsaWNhdGUgb2YgYW4gb2JqZWN0LgogIF8uY2xvbmUgPSBmdW5jdGlvbihvYmopIHsKICAgIGlmICghXy5pc09iamVjdChvYmopKSByZXR1cm4gb2JqOwogICAgcmV0dXJuIF8uaXNBcnJheShvYmopID8gb2JqLnNsaWNlKCkgOiBfLmV4dGVuZCh7fSwgb2JqKTsKICB9OwoKICAvLyBJbnZva2VzIGludGVyY2VwdG9yIHdpdGggdGhlIG9iaiwgYW5kIHRoZW4gcmV0dXJucyBvYmouCiAgLy8gVGhlIHByaW1hcnkgcHVycG9zZSBvZiB0aGlzIG1ldGhvZCBpcyB0byAidGFwIGludG8iIGEgbWV0aG9kIGNoYWluLCBpbgogIC8vIG9yZGVyIHRvIHBlcmZvcm0gb3BlcmF0aW9ucyBvbiBpbnRlcm1lZGlhdGUgcmVzdWx0cyB3aXRoaW4gdGhlIGNoYWluLgogIF8udGFwID0gZnVuY3Rpb24ob2JqLCBpbnRlcmNlcHRvcikgewogICAgaW50ZXJjZXB0b3Iob2JqKTsKICAgIHJldHVybiBvYmo7CiAgfTsKCiAgLy8gUmV0dXJucyB3aGV0aGVyIGFuIG9iamVjdCBoYXMgYSBnaXZlbiBzZXQgb2YgYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy5pc01hdGNoID0gZnVuY3Rpb24ob2JqZWN0LCBhdHRycykgewogICAgdmFyIGtleXMgPSBfLmtleXMoYXR0cnMpLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgIGlmIChvYmplY3QgPT0gbnVsbCkgcmV0dXJuICFsZW5ndGg7CiAgICB2YXIgb2JqID0gT2JqZWN0KG9iamVjdCk7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBrZXkgPSBrZXlzW2ldOwogICAgICBpZiAoYXR0cnNba2V5XSAhPT0gb2JqW2tleV0gfHwgIShrZXkgaW4gb2JqKSkgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfTsKCgogIC8vIEludGVybmFsIHJlY3Vyc2l2ZSBjb21wYXJpc29uIGZ1bmN0aW9uIGZvciBgaXNFcXVhbGAuCiAgdmFyIGVxID0gZnVuY3Rpb24oYSwgYiwgYVN0YWNrLCBiU3RhY2spIHsKICAgIC8vIElkZW50aWNhbCBvYmplY3RzIGFyZSBlcXVhbC4gYDAgPT09IC0wYCwgYnV0IHRoZXkgYXJlbid0IGlkZW50aWNhbC4KICAgIC8vIFNlZSB0aGUgW0hhcm1vbnkgYGVnYWxgIHByb3Bvc2FsXShodHRwOi8vd2lraS5lY21hc2NyaXB0Lm9yZy9kb2t1LnBocD9pZD1oYXJtb255OmVnYWwpLgogICAgaWYgKGEgPT09IGIpIHJldHVybiBhICE9PSAwIHx8IDEgLyBhID09PSAxIC8gYjsKICAgIC8vIEEgc3RyaWN0IGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5IGJlY2F1c2UgYG51bGwgPT0gdW5kZWZpbmVkYC4KICAgIGlmIChhID09IG51bGwgfHwgYiA9PSBudWxsKSByZXR1cm4gYSA9PT0gYjsKICAgIC8vIFVud3JhcCBhbnkgd3JhcHBlZCBvYmplY3RzLgogICAgaWYgKGEgaW5zdGFuY2VvZiBfKSBhID0gYS5fd3JhcHBlZDsKICAgIGlmIChiIGluc3RhbmNlb2YgXykgYiA9IGIuX3dyYXBwZWQ7CiAgICAvLyBDb21wYXJlIGBbW0NsYXNzXV1gIG5hbWVzLgogICAgdmFyIGNsYXNzTmFtZSA9IHRvU3RyaW5nLmNhbGwoYSk7CiAgICBpZiAoY2xhc3NOYW1lICE9PSB0b1N0cmluZy5jYWxsKGIpKSByZXR1cm4gZmFsc2U7CiAgICBzd2l0Y2ggKGNsYXNzTmFtZSkgewogICAgICAvLyBTdHJpbmdzLCBudW1iZXJzLCByZWd1bGFyIGV4cHJlc3Npb25zLCBkYXRlcywgYW5kIGJvb2xlYW5zIGFyZSBjb21wYXJlZCBieSB2YWx1ZS4KICAgICAgY2FzZSAnW29iamVjdCBSZWdFeHBdJzoKICAgICAgLy8gUmVnRXhwcyBhcmUgY29lcmNlZCB0byBzdHJpbmdzIGZvciBjb21wYXJpc29uIChOb3RlOiAnJyArIC9hL2kgPT09ICcvYS9pJykKICAgICAgY2FzZSAnW29iamVjdCBTdHJpbmddJzoKICAgICAgICAvLyBQcmltaXRpdmVzIGFuZCB0aGVpciBjb3JyZXNwb25kaW5nIG9iamVjdCB3cmFwcGVycyBhcmUgZXF1aXZhbGVudDsgdGh1cywgYCI1ImAgaXMKICAgICAgICAvLyBlcXVpdmFsZW50IHRvIGBuZXcgU3RyaW5nKCI1IilgLgogICAgICAgIHJldHVybiAnJyArIGEgPT09ICcnICsgYjsKICAgICAgY2FzZSAnW29iamVjdCBOdW1iZXJdJzoKICAgICAgICAvLyBgTmFOYHMgYXJlIGVxdWl2YWxlbnQsIGJ1dCBub24tcmVmbGV4aXZlLgogICAgICAgIC8vIE9iamVjdChOYU4pIGlzIGVxdWl2YWxlbnQgdG8gTmFOCiAgICAgICAgaWYgKCthICE9PSArYSkgcmV0dXJuICtiICE9PSArYjsKICAgICAgICAvLyBBbiBgZWdhbGAgY29tcGFyaXNvbiBpcyBwZXJmb3JtZWQgZm9yIG90aGVyIG51bWVyaWMgdmFsdWVzLgogICAgICAgIHJldHVybiArYSA9PT0gMCA/IDEgLyArYSA9PT0gMSAvIGIgOiArYSA9PT0gK2I7CiAgICAgIGNhc2UgJ1tvYmplY3QgRGF0ZV0nOgogICAgICBjYXNlICdbb2JqZWN0IEJvb2xlYW5dJzoKICAgICAgICAvLyBDb2VyY2UgZGF0ZXMgYW5kIGJvb2xlYW5zIHRvIG51bWVyaWMgcHJpbWl0aXZlIHZhbHVlcy4gRGF0ZXMgYXJlIGNvbXBhcmVkIGJ5IHRoZWlyCiAgICAgICAgLy8gbWlsbGlzZWNvbmQgcmVwcmVzZW50YXRpb25zLiBOb3RlIHRoYXQgaW52YWxpZCBkYXRlcyB3aXRoIG1pbGxpc2Vjb25kIHJlcHJlc2VudGF0aW9ucwogICAgICAgIC8vIG9mIGBOYU5gIGFyZSBub3QgZXF1aXZhbGVudC4KICAgICAgICByZXR1cm4gK2EgPT09ICtiOwogICAgfQoKICAgIHZhciBhcmVBcnJheXMgPSBjbGFzc05hbWUgPT09ICdbb2JqZWN0IEFycmF5XSc7CiAgICBpZiAoIWFyZUFycmF5cykgewogICAgICBpZiAodHlwZW9mIGEgIT0gJ29iamVjdCcgfHwgdHlwZW9mIGIgIT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTsKCiAgICAgIC8vIE9iamVjdHMgd2l0aCBkaWZmZXJlbnQgY29uc3RydWN0b3JzIGFyZSBub3QgZXF1aXZhbGVudCwgYnV0IGBPYmplY3RgcyBvciBgQXJyYXlgcwogICAgICAvLyBmcm9tIGRpZmZlcmVudCBmcmFtZXMgYXJlLgogICAgICB2YXIgYUN0b3IgPSBhLmNvbnN0cnVjdG9yLCBiQ3RvciA9IGIuY29uc3RydWN0b3I7CiAgICAgIGlmIChhQ3RvciAhPT0gYkN0b3IgJiYgIShfLmlzRnVuY3Rpb24oYUN0b3IpICYmIGFDdG9yIGluc3RhbmNlb2YgYUN0b3IgJiYKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF8uaXNGdW5jdGlvbihiQ3RvcikgJiYgYkN0b3IgaW5zdGFuY2VvZiBiQ3RvcikKICAgICAgICAgICAgICAgICAgICAgICAgICAmJiAoJ2NvbnN0cnVjdG9yJyBpbiBhICYmICdjb25zdHJ1Y3RvcicgaW4gYikpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIEFzc3VtZSBlcXVhbGl0eSBmb3IgY3ljbGljIHN0cnVjdHVyZXMuIFRoZSBhbGdvcml0aG0gZm9yIGRldGVjdGluZyBjeWNsaWMKICAgIC8vIHN0cnVjdHVyZXMgaXMgYWRhcHRlZCBmcm9tIEVTIDUuMSBzZWN0aW9uIDE1LjEyLjMsIGFic3RyYWN0IG9wZXJhdGlvbiBgSk9gLgoKICAgIC8vIEluaXRpYWxpemluZyBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIC8vIEl0J3MgZG9uZSBoZXJlIHNpbmNlIHdlIG9ubHkgbmVlZCB0aGVtIGZvciBvYmplY3RzIGFuZCBhcnJheXMgY29tcGFyaXNvbi4KICAgIGFTdGFjayA9IGFTdGFjayB8fCBbXTsKICAgIGJTdGFjayA9IGJTdGFjayB8fCBbXTsKICAgIHZhciBsZW5ndGggPSBhU3RhY2subGVuZ3RoOwogICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgIC8vIExpbmVhciBzZWFyY2guIFBlcmZvcm1hbmNlIGlzIGludmVyc2VseSBwcm9wb3J0aW9uYWwgdG8gdGhlIG51bWJlciBvZgogICAgICAvLyB1bmlxdWUgbmVzdGVkIHN0cnVjdHVyZXMuCiAgICAgIGlmIChhU3RhY2tbbGVuZ3RoXSA9PT0gYSkgcmV0dXJuIGJTdGFja1tsZW5ndGhdID09PSBiOwogICAgfQoKICAgIC8vIEFkZCB0aGUgZmlyc3Qgb2JqZWN0IHRvIHRoZSBzdGFjayBvZiB0cmF2ZXJzZWQgb2JqZWN0cy4KICAgIGFTdGFjay5wdXNoKGEpOwogICAgYlN0YWNrLnB1c2goYik7CgogICAgLy8gUmVjdXJzaXZlbHkgY29tcGFyZSBvYmplY3RzIGFuZCBhcnJheXMuCiAgICBpZiAoYXJlQXJyYXlzKSB7CiAgICAgIC8vIENvbXBhcmUgYXJyYXkgbGVuZ3RocyB0byBkZXRlcm1pbmUgaWYgYSBkZWVwIGNvbXBhcmlzb24gaXMgbmVjZXNzYXJ5LgogICAgICBsZW5ndGggPSBhLmxlbmd0aDsKICAgICAgaWYgKGxlbmd0aCAhPT0gYi5sZW5ndGgpIHJldHVybiBmYWxzZTsKICAgICAgLy8gRGVlcCBjb21wYXJlIHRoZSBjb250ZW50cywgaWdub3Jpbmcgbm9uLW51bWVyaWMgcHJvcGVydGllcy4KICAgICAgd2hpbGUgKGxlbmd0aC0tKSB7CiAgICAgICAgaWYgKCFlcShhW2xlbmd0aF0sIGJbbGVuZ3RoXSwgYVN0YWNrLCBiU3RhY2spKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIERlZXAgY29tcGFyZSBvYmplY3RzLgogICAgICB2YXIga2V5cyA9IF8ua2V5cyhhKSwga2V5OwogICAgICBsZW5ndGggPSBrZXlzLmxlbmd0aDsKICAgICAgLy8gRW5zdXJlIHRoYXQgYm90aCBvYmplY3RzIGNvbnRhaW4gdGhlIHNhbWUgbnVtYmVyIG9mIHByb3BlcnRpZXMgYmVmb3JlIGNvbXBhcmluZyBkZWVwIGVxdWFsaXR5LgogICAgICBpZiAoXy5rZXlzKGIpLmxlbmd0aCAhPT0gbGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgICAgIHdoaWxlIChsZW5ndGgtLSkgewogICAgICAgIC8vIERlZXAgY29tcGFyZSBlYWNoIG1lbWJlcgogICAgICAgIGtleSA9IGtleXNbbGVuZ3RoXTsKICAgICAgICBpZiAoIShfLmhhcyhiLCBrZXkpICYmIGVxKGFba2V5XSwgYltrZXldLCBhU3RhY2ssIGJTdGFjaykpKSByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIC8vIFJlbW92ZSB0aGUgZmlyc3Qgb2JqZWN0IGZyb20gdGhlIHN0YWNrIG9mIHRyYXZlcnNlZCBvYmplY3RzLgogICAgYVN0YWNrLnBvcCgpOwogICAgYlN0YWNrLnBvcCgpOwogICAgcmV0dXJuIHRydWU7CiAgfTsKCiAgLy8gUGVyZm9ybSBhIGRlZXAgY29tcGFyaXNvbiB0byBjaGVjayBpZiB0d28gb2JqZWN0cyBhcmUgZXF1YWwuCiAgXy5pc0VxdWFsID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGVxKGEsIGIpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gYXJyYXksIHN0cmluZywgb3Igb2JqZWN0IGVtcHR5PwogIC8vIEFuICJlbXB0eSIgb2JqZWN0IGhhcyBubyBlbnVtZXJhYmxlIG93bi1wcm9wZXJ0aWVzLgogIF8uaXNFbXB0eSA9IGZ1bmN0aW9uKG9iaikgewogICAgaWYgKG9iaiA9PSBudWxsKSByZXR1cm4gdHJ1ZTsKICAgIGlmIChpc0FycmF5TGlrZShvYmopICYmIChfLmlzQXJyYXkob2JqKSB8fCBfLmlzU3RyaW5nKG9iaikgfHwgXy5pc0FyZ3VtZW50cyhvYmopKSkgcmV0dXJuIG9iai5sZW5ndGggPT09IDA7CiAgICByZXR1cm4gXy5rZXlzKG9iaikubGVuZ3RoID09PSAwOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYSBET00gZWxlbWVudD8KICBfLmlzRWxlbWVudCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuICEhKG9iaiAmJiBvYmoubm9kZVR5cGUgPT09IDEpOwogIH07CgogIC8vIElzIGEgZ2l2ZW4gdmFsdWUgYW4gYXJyYXk/CiAgLy8gRGVsZWdhdGVzIHRvIEVDTUE1J3MgbmF0aXZlIEFycmF5LmlzQXJyYXkKICBfLmlzQXJyYXkgPSBuYXRpdmVJc0FycmF5IHx8IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIHRvU3RyaW5nLmNhbGwob2JqKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhcmlhYmxlIGFuIG9iamVjdD8KICBfLmlzT2JqZWN0ID0gZnVuY3Rpb24ob2JqKSB7CiAgICB2YXIgdHlwZSA9IHR5cGVvZiBvYmo7CiAgICByZXR1cm4gdHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCB0eXBlID09PSAnb2JqZWN0JyAmJiAhIW9iajsKICB9OwoKICAvLyBBZGQgc29tZSBpc1R5cGUgbWV0aG9kczogaXNBcmd1bWVudHMsIGlzRnVuY3Rpb24sIGlzU3RyaW5nLCBpc051bWJlciwgaXNEYXRlLCBpc1JlZ0V4cCwgaXNFcnJvci4KICBfLmVhY2goWydBcmd1bWVudHMnLCAnRnVuY3Rpb24nLCAnU3RyaW5nJywgJ051bWJlcicsICdEYXRlJywgJ1JlZ0V4cCcsICdFcnJvciddLCBmdW5jdGlvbihuYW1lKSB7CiAgICBfWydpcycgKyBuYW1lXSA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gdG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCAnICsgbmFtZSArICddJzsKICAgIH07CiAgfSk7CgogIC8vIERlZmluZSBhIGZhbGxiYWNrIHZlcnNpb24gb2YgdGhlIG1ldGhvZCBpbiBicm93c2VycyAoYWhlbSwgSUUgPCA5KSwgd2hlcmUKICAvLyB0aGVyZSBpc24ndCBhbnkgaW5zcGVjdGFibGUgIkFyZ3VtZW50cyIgdHlwZS4KICBpZiAoIV8uaXNBcmd1bWVudHMoYXJndW1lbnRzKSkgewogICAgXy5pc0FyZ3VtZW50cyA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gXy5oYXMob2JqLCAnY2FsbGVlJyk7CiAgICB9OwogIH0KCiAgLy8gT3B0aW1pemUgYGlzRnVuY3Rpb25gIGlmIGFwcHJvcHJpYXRlLiBXb3JrIGFyb3VuZCBzb21lIHR5cGVvZiBidWdzIGluIG9sZCB2OCwKICAvLyBJRSAxMSAoIzE2MjEpLCBhbmQgaW4gU2FmYXJpIDggKCMxOTI5KS4KICBpZiAodHlwZW9mIC8uLyAhPSAnZnVuY3Rpb24nICYmIHR5cGVvZiBJbnQ4QXJyYXkgIT0gJ29iamVjdCcpIHsKICAgIF8uaXNGdW5jdGlvbiA9IGZ1bmN0aW9uKG9iaikgewogICAgICByZXR1cm4gdHlwZW9mIG9iaiA9PSAnZnVuY3Rpb24nIHx8IGZhbHNlOwogICAgfTsKICB9CgogIC8vIElzIGEgZ2l2ZW4gb2JqZWN0IGEgZmluaXRlIG51bWJlcj8KICBfLmlzRmluaXRlID0gZnVuY3Rpb24ob2JqKSB7CiAgICByZXR1cm4gaXNGaW5pdGUob2JqKSAmJiAhaXNOYU4ocGFyc2VGbG9hdChvYmopKTsKICB9OwoKICAvLyBJcyB0aGUgZ2l2ZW4gdmFsdWUgYE5hTmA/IChOYU4gaXMgdGhlIG9ubHkgbnVtYmVyIHdoaWNoIGRvZXMgbm90IGVxdWFsIGl0c2VsZikuCiAgXy5pc05hTiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIF8uaXNOdW1iZXIob2JqKSAmJiBvYmogIT09ICtvYmo7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YWx1ZSBhIGJvb2xlYW4/CiAgXy5pc0Jvb2xlYW4gPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IHRydWUgfHwgb2JqID09PSBmYWxzZSB8fCB0b1N0cmluZy5jYWxsKG9iaikgPT09ICdbb2JqZWN0IEJvb2xlYW5dJzsKICB9OwoKICAvLyBJcyBhIGdpdmVuIHZhbHVlIGVxdWFsIHRvIG51bGw/CiAgXy5pc051bGwgPSBmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBvYmogPT09IG51bGw7CiAgfTsKCiAgLy8gSXMgYSBnaXZlbiB2YXJpYWJsZSB1bmRlZmluZWQ/CiAgXy5pc1VuZGVmaW5lZCA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PT0gdm9pZCAwOwogIH07CgogIC8vIFNob3J0Y3V0IGZ1bmN0aW9uIGZvciBjaGVja2luZyBpZiBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gcHJvcGVydHkgZGlyZWN0bHkKICAvLyBvbiBpdHNlbGYgKGluIG90aGVyIHdvcmRzLCBub3Qgb24gYSBwcm90b3R5cGUpLgogIF8uaGFzID0gZnVuY3Rpb24ob2JqLCBrZXkpIHsKICAgIHJldHVybiBvYmogIT0gbnVsbCAmJiBoYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKICB9OwoKICAvLyBVdGlsaXR5IEZ1bmN0aW9ucwogIC8vIC0tLS0tLS0tLS0tLS0tLS0tCgogIC8vIFJ1biBVbmRlcnNjb3JlLmpzIGluICpub0NvbmZsaWN0KiBtb2RlLCByZXR1cm5pbmcgdGhlIGBfYCB2YXJpYWJsZSB0byBpdHMKICAvLyBwcmV2aW91cyBvd25lci4gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgVW5kZXJzY29yZSBvYmplY3QuCiAgXy5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7CiAgICByb290Ll8gPSBwcmV2aW91c1VuZGVyc2NvcmU7CiAgICByZXR1cm4gdGhpczsKICB9OwoKICAvLyBLZWVwIHRoZSBpZGVudGl0eSBmdW5jdGlvbiBhcm91bmQgZm9yIGRlZmF1bHQgaXRlcmF0ZWVzLgogIF8uaWRlbnRpdHkgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgcmV0dXJuIHZhbHVlOwogIH07CgogIC8vIFByZWRpY2F0ZS1nZW5lcmF0aW5nIGZ1bmN0aW9ucy4gT2Z0ZW4gdXNlZnVsIG91dHNpZGUgb2YgVW5kZXJzY29yZS4KICBfLmNvbnN0YW50ID0gZnVuY3Rpb24odmFsdWUpIHsKICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfTsKICB9OwoKICBfLm5vb3AgPSBmdW5jdGlvbigpe307CgogIF8ucHJvcGVydHkgPSBwcm9wZXJ0eTsKCiAgLy8gR2VuZXJhdGVzIGEgZnVuY3Rpb24gZm9yIGEgZ2l2ZW4gb2JqZWN0IHRoYXQgcmV0dXJucyBhIGdpdmVuIHByb3BlcnR5LgogIF8ucHJvcGVydHlPZiA9IGZ1bmN0aW9uKG9iaikgewogICAgcmV0dXJuIG9iaiA9PSBudWxsID8gZnVuY3Rpb24oKXt9IDogZnVuY3Rpb24oa2V5KSB7CiAgICAgIHJldHVybiBvYmpba2V5XTsKICAgIH07CiAgfTsKCiAgLy8gUmV0dXJucyBhIHByZWRpY2F0ZSBmb3IgY2hlY2tpbmcgd2hldGhlciBhbiBvYmplY3QgaGFzIGEgZ2l2ZW4gc2V0IG9mCiAgLy8gYGtleTp2YWx1ZWAgcGFpcnMuCiAgXy5tYXRjaGVyID0gXy5tYXRjaGVzID0gZnVuY3Rpb24oYXR0cnMpIHsKICAgIGF0dHJzID0gXy5leHRlbmRPd24oe30sIGF0dHJzKTsKICAgIHJldHVybiBmdW5jdGlvbihvYmopIHsKICAgICAgcmV0dXJuIF8uaXNNYXRjaChvYmosIGF0dHJzKTsKICAgIH07CiAgfTsKCiAgLy8gUnVuIGEgZnVuY3Rpb24gKipuKiogdGltZXMuCiAgXy50aW1lcyA9IGZ1bmN0aW9uKG4sIGl0ZXJhdGVlLCBjb250ZXh0KSB7CiAgICB2YXIgYWNjdW0gPSBBcnJheShNYXRoLm1heCgwLCBuKSk7CiAgICBpdGVyYXRlZSA9IG9wdGltaXplQ2IoaXRlcmF0ZWUsIGNvbnRleHQsIDEpOwogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuOyBpKyspIGFjY3VtW2ldID0gaXRlcmF0ZWUoaSk7CiAgICByZXR1cm4gYWNjdW07CiAgfTsKCiAgLy8gUmV0dXJuIGEgcmFuZG9tIGludGVnZXIgYmV0d2VlbiBtaW4gYW5kIG1heCAoaW5jbHVzaXZlKS4KICBfLnJhbmRvbSA9IGZ1bmN0aW9uKG1pbiwgbWF4KSB7CiAgICBpZiAobWF4ID09IG51bGwpIHsKICAgICAgbWF4ID0gbWluOwogICAgICBtaW4gPSAwOwogICAgfQogICAgcmV0dXJuIG1pbiArIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChtYXggLSBtaW4gKyAxKSk7CiAgfTsKCiAgLy8gQSAocG9zc2libHkgZmFzdGVyKSB3YXkgdG8gZ2V0IHRoZSBjdXJyZW50IHRpbWVzdGFtcCBhcyBhbiBpbnRlZ2VyLgogIF8ubm93ID0gRGF0ZS5ub3cgfHwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgfTsKCiAgIC8vIExpc3Qgb2YgSFRNTCBlbnRpdGllcyBmb3IgZXNjYXBpbmcuCiAgdmFyIGVzY2FwZU1hcCA9IHsKICAgICcmJzogJyZhbXA7JywKICAgICc8JzogJyZsdDsnLAogICAgJz4nOiAnJmd0OycsCiAgICAnIic6ICcmcXVvdDsnLAogICAgIiciOiAnJiN4Mjc7JywKICAgICdgJzogJyYjeDYwOycKICB9OwogIHZhciB1bmVzY2FwZU1hcCA9IF8uaW52ZXJ0KGVzY2FwZU1hcCk7CgogIC8vIEZ1bmN0aW9ucyBmb3IgZXNjYXBpbmcgYW5kIHVuZXNjYXBpbmcgc3RyaW5ncyB0by9mcm9tIEhUTUwgaW50ZXJwb2xhdGlvbi4KICB2YXIgY3JlYXRlRXNjYXBlciA9IGZ1bmN0aW9uKG1hcCkgewogICAgdmFyIGVzY2FwZXIgPSBmdW5jdGlvbihtYXRjaCkgewogICAgICByZXR1cm4gbWFwW21hdGNoXTsKICAgIH07CiAgICAvLyBSZWdleGVzIGZvciBpZGVudGlmeWluZyBhIGtleSB0aGF0IG5lZWRzIHRvIGJlIGVzY2FwZWQKICAgIHZhciBzb3VyY2UgPSAnKD86JyArIF8ua2V5cyhtYXApLmpvaW4oJ3wnKSArICcpJzsKICAgIHZhciB0ZXN0UmVnZXhwID0gUmVnRXhwKHNvdXJjZSk7CiAgICB2YXIgcmVwbGFjZVJlZ2V4cCA9IFJlZ0V4cChzb3VyY2UsICdnJyk7CiAgICByZXR1cm4gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICAgIHN0cmluZyA9IHN0cmluZyA9PSBudWxsID8gJycgOiAnJyArIHN0cmluZzsKICAgICAgcmV0dXJuIHRlc3RSZWdleHAudGVzdChzdHJpbmcpID8gc3RyaW5nLnJlcGxhY2UocmVwbGFjZVJlZ2V4cCwgZXNjYXBlcikgOiBzdHJpbmc7CiAgICB9OwogIH07CiAgXy5lc2NhcGUgPSBjcmVhdGVFc2NhcGVyKGVzY2FwZU1hcCk7CiAgXy51bmVzY2FwZSA9IGNyZWF0ZUVzY2FwZXIodW5lc2NhcGVNYXApOwoKICAvLyBJZiB0aGUgdmFsdWUgb2YgdGhlIG5hbWVkIGBwcm9wZXJ0eWAgaXMgYSBmdW5jdGlvbiB0aGVuIGludm9rZSBpdCB3aXRoIHRoZQogIC8vIGBvYmplY3RgIGFzIGNvbnRleHQ7IG90aGVyd2lzZSwgcmV0dXJuIGl0LgogIF8ucmVzdWx0ID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSwgZmFsbGJhY2spIHsKICAgIHZhciB2YWx1ZSA9IG9iamVjdCA9PSBudWxsID8gdm9pZCAwIDogb2JqZWN0W3Byb3BlcnR5XTsKICAgIGlmICh2YWx1ZSA9PT0gdm9pZCAwKSB7CiAgICAgIHZhbHVlID0gZmFsbGJhY2s7CiAgICB9CiAgICByZXR1cm4gXy5pc0Z1bmN0aW9uKHZhbHVlKSA/IHZhbHVlLmNhbGwob2JqZWN0KSA6IHZhbHVlOwogIH07CgogIC8vIEdlbmVyYXRlIGEgdW5pcXVlIGludGVnZXIgaWQgKHVuaXF1ZSB3aXRoaW4gdGhlIGVudGlyZSBjbGllbnQgc2Vzc2lvbikuCiAgLy8gVXNlZnVsIGZvciB0ZW1wb3JhcnkgRE9NIGlkcy4KICB2YXIgaWRDb3VudGVyID0gMDsKICBfLnVuaXF1ZUlkID0gZnVuY3Rpb24ocHJlZml4KSB7CiAgICB2YXIgaWQgPSArK2lkQ291bnRlciArICcnOwogICAgcmV0dXJuIHByZWZpeCA/IHByZWZpeCArIGlkIDogaWQ7CiAgfTsKCiAgLy8gQnkgZGVmYXVsdCwgVW5kZXJzY29yZSB1c2VzIEVSQi1zdHlsZSB0ZW1wbGF0ZSBkZWxpbWl0ZXJzLCBjaGFuZ2UgdGhlCiAgLy8gZm9sbG93aW5nIHRlbXBsYXRlIHNldHRpbmdzIHRvIHVzZSBhbHRlcm5hdGl2ZSBkZWxpbWl0ZXJzLgogIF8udGVtcGxhdGVTZXR0aW5ncyA9IHsKICAgIGV2YWx1YXRlICAgIDogLzwlKFtcc1xTXSs/KSU+L2csCiAgICBpbnRlcnBvbGF0ZSA6IC88JT0oW1xzXFNdKz8pJT4vZywKICAgIGVzY2FwZSAgICAgIDogLzwlLShbXHNcU10rPyklPi9nCiAgfTsKCiAgLy8gV2hlbiBjdXN0b21pemluZyBgdGVtcGxhdGVTZXR0aW5nc2AsIGlmIHlvdSBkb24ndCB3YW50IHRvIGRlZmluZSBhbgogIC8vIGludGVycG9sYXRpb24sIGV2YWx1YXRpb24gb3IgZXNjYXBpbmcgcmVnZXgsIHdlIG5lZWQgb25lIHRoYXQgaXMKICAvLyBndWFyYW50ZWVkIG5vdCB0byBtYXRjaC4KICB2YXIgbm9NYXRjaCA9IC8oLileLzsKCiAgLy8gQ2VydGFpbiBjaGFyYWN0ZXJzIG5lZWQgdG8gYmUgZXNjYXBlZCBzbyB0aGF0IHRoZXkgY2FuIGJlIHB1dCBpbnRvIGEKICAvLyBzdHJpbmcgbGl0ZXJhbC4KICB2YXIgZXNjYXBlcyA9IHsKICAgICInIjogICAgICAiJyIsCiAgICAnXFwnOiAgICAgJ1xcJywKICAgICdccic6ICAgICAncicsCiAgICAnXG4nOiAgICAgJ24nLAogICAgJ1x1MjAyOCc6ICd1MjAyOCcsCiAgICAnXHUyMDI5JzogJ3UyMDI5JwogIH07CgogIHZhciBlc2NhcGVyID0gL1xcfCd8XHJ8XG58XHUyMDI4fFx1MjAyOS9nOwoKICB2YXIgZXNjYXBlQ2hhciA9IGZ1bmN0aW9uKG1hdGNoKSB7CiAgICByZXR1cm4gJ1xcJyArIGVzY2FwZXNbbWF0Y2hdOwogIH07CgogIC8vIEphdmFTY3JpcHQgbWljcm8tdGVtcGxhdGluZywgc2ltaWxhciB0byBKb2huIFJlc2lnJ3MgaW1wbGVtZW50YXRpb24uCiAgLy8gVW5kZXJzY29yZSB0ZW1wbGF0aW5nIGhhbmRsZXMgYXJiaXRyYXJ5IGRlbGltaXRlcnMsIHByZXNlcnZlcyB3aGl0ZXNwYWNlLAogIC8vIGFuZCBjb3JyZWN0bHkgZXNjYXBlcyBxdW90ZXMgd2l0aGluIGludGVycG9sYXRlZCBjb2RlLgogIC8vIE5COiBgb2xkU2V0dGluZ3NgIG9ubHkgZXhpc3RzIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS4KICBfLnRlbXBsYXRlID0gZnVuY3Rpb24odGV4dCwgc2V0dGluZ3MsIG9sZFNldHRpbmdzKSB7CiAgICBpZiAoIXNldHRpbmdzICYmIG9sZFNldHRpbmdzKSBzZXR0aW5ncyA9IG9sZFNldHRpbmdzOwogICAgc2V0dGluZ3MgPSBfLmRlZmF1bHRzKHt9LCBzZXR0aW5ncywgXy50ZW1wbGF0ZVNldHRpbmdzKTsKCiAgICAvLyBDb21iaW5lIGRlbGltaXRlcnMgaW50byBvbmUgcmVndWxhciBleHByZXNzaW9uIHZpYSBhbHRlcm5hdGlvbi4KICAgIHZhciBtYXRjaGVyID0gUmVnRXhwKFsKICAgICAgKHNldHRpbmdzLmVzY2FwZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5pbnRlcnBvbGF0ZSB8fCBub01hdGNoKS5zb3VyY2UsCiAgICAgIChzZXR0aW5ncy5ldmFsdWF0ZSB8fCBub01hdGNoKS5zb3VyY2UKICAgIF0uam9pbignfCcpICsgJ3wkJywgJ2cnKTsKCiAgICAvLyBDb21waWxlIHRoZSB0ZW1wbGF0ZSBzb3VyY2UsIGVzY2FwaW5nIHN0cmluZyBsaXRlcmFscyBhcHByb3ByaWF0ZWx5LgogICAgdmFyIGluZGV4ID0gMDsKICAgIHZhciBzb3VyY2UgPSAiX19wKz0nIjsKICAgIHRleHQucmVwbGFjZShtYXRjaGVyLCBmdW5jdGlvbihtYXRjaCwgZXNjYXBlLCBpbnRlcnBvbGF0ZSwgZXZhbHVhdGUsIG9mZnNldCkgewogICAgICBzb3VyY2UgKz0gdGV4dC5zbGljZShpbmRleCwgb2Zmc2V0KS5yZXBsYWNlKGVzY2FwZXIsIGVzY2FwZUNoYXIpOwogICAgICBpbmRleCA9IG9mZnNldCArIG1hdGNoLmxlbmd0aDsKCiAgICAgIGlmIChlc2NhcGUpIHsKICAgICAgICBzb3VyY2UgKz0gIicrXG4oKF9fdD0oIiArIGVzY2FwZSArICIpKT09bnVsbD8nJzpfLmVzY2FwZShfX3QpKStcbiciOwogICAgICB9IGVsc2UgaWYgKGludGVycG9sYXRlKSB7CiAgICAgICAgc291cmNlICs9ICInK1xuKChfX3Q9KCIgKyBpbnRlcnBvbGF0ZSArICIpKT09bnVsbD8nJzpfX3QpK1xuJyI7CiAgICAgIH0gZWxzZSBpZiAoZXZhbHVhdGUpIHsKICAgICAgICBzb3VyY2UgKz0gIic7XG4iICsgZXZhbHVhdGUgKyAiXG5fX3ArPSciOwogICAgICB9CgogICAgICAvLyBBZG9iZSBWTXMgbmVlZCB0aGUgbWF0Y2ggcmV0dXJuZWQgdG8gcHJvZHVjZSB0aGUgY29ycmVjdCBvZmZlc3QuCiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0pOwogICAgc291cmNlICs9ICInO1xuIjsKCiAgICAvLyBJZiBhIHZhcmlhYmxlIGlzIG5vdCBzcGVjaWZpZWQsIHBsYWNlIGRhdGEgdmFsdWVzIGluIGxvY2FsIHNjb3BlLgogICAgaWYgKCFzZXR0aW5ncy52YXJpYWJsZSkgc291cmNlID0gJ3dpdGgob2JqfHx7fSl7XG4nICsgc291cmNlICsgJ31cbic7CgogICAgc291cmNlID0gInZhciBfX3QsX19wPScnLF9faj1BcnJheS5wcm90b3R5cGUuam9pbiwiICsKICAgICAgInByaW50PWZ1bmN0aW9uKCl7X19wKz1fX2ouY2FsbChhcmd1bWVudHMsJycpO307XG4iICsKICAgICAgc291cmNlICsgJ3JldHVybiBfX3A7XG4nOwoKICAgIHRyeSB7CiAgICAgIHZhciByZW5kZXIgPSBuZXcgRnVuY3Rpb24oc2V0dGluZ3MudmFyaWFibGUgfHwgJ29iaicsICdfJywgc291cmNlKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgZS5zb3VyY2UgPSBzb3VyY2U7CiAgICAgIHRocm93IGU7CiAgICB9CgogICAgdmFyIHRlbXBsYXRlID0gZnVuY3Rpb24oZGF0YSkgewogICAgICByZXR1cm4gcmVuZGVyLmNhbGwodGhpcywgZGF0YSwgXyk7CiAgICB9OwoKICAgIC8vIFByb3ZpZGUgdGhlIGNvbXBpbGVkIHNvdXJjZSBhcyBhIGNvbnZlbmllbmNlIGZvciBwcmVjb21waWxhdGlvbi4KICAgIHZhciBhcmd1bWVudCA9IHNldHRpbmdzLnZhcmlhYmxlIHx8ICdvYmonOwogICAgdGVtcGxhdGUuc291cmNlID0gJ2Z1bmN0aW9uKCcgKyBhcmd1bWVudCArICcpe1xuJyArIHNvdXJjZSArICd9JzsKCiAgICByZXR1cm4gdGVtcGxhdGU7CiAgfTsKCiAgLy8gQWRkIGEgImNoYWluIiBmdW5jdGlvbi4gU3RhcnQgY2hhaW5pbmcgYSB3cmFwcGVkIFVuZGVyc2NvcmUgb2JqZWN0LgogIF8uY2hhaW4gPSBmdW5jdGlvbihvYmopIHsKICAgIHZhciBpbnN0YW5jZSA9IF8ob2JqKTsKICAgIGluc3RhbmNlLl9jaGFpbiA9IHRydWU7CiAgICByZXR1cm4gaW5zdGFuY2U7CiAgfTsKCiAgLy8gT09QCiAgLy8gLS0tLS0tLS0tLS0tLS0tCiAgLy8gSWYgVW5kZXJzY29yZSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQKICAvLyBjYW4gYmUgdXNlZCBPTy1zdHlsZS4gVGhpcyB3cmFwcGVyIGhvbGRzIGFsdGVyZWQgdmVyc2lvbnMgb2YgYWxsIHRoZQogIC8vIHVuZGVyc2NvcmUgZnVuY3Rpb25zLiBXcmFwcGVkIG9iamVjdHMgbWF5IGJlIGNoYWluZWQuCgogIC8vIEhlbHBlciBmdW5jdGlvbiB0byBjb250aW51ZSBjaGFpbmluZyBpbnRlcm1lZGlhdGUgcmVzdWx0cy4KICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24oaW5zdGFuY2UsIG9iaikgewogICAgcmV0dXJuIGluc3RhbmNlLl9jaGFpbiA/IF8ob2JqKS5jaGFpbigpIDogb2JqOwogIH07CgogIC8vIEFkZCB5b3VyIG93biBjdXN0b20gZnVuY3Rpb25zIHRvIHRoZSBVbmRlcnNjb3JlIG9iamVjdC4KICBfLm1peGluID0gZnVuY3Rpb24ob2JqKSB7CiAgICBfLmVhY2goXy5mdW5jdGlvbnMob2JqKSwgZnVuY3Rpb24obmFtZSkgewogICAgICB2YXIgZnVuYyA9IF9bbmFtZV0gPSBvYmpbbmFtZV07CiAgICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGFyZ3MgPSBbdGhpcy5fd3JhcHBlZF07CiAgICAgICAgcHVzaC5hcHBseShhcmdzLCBhcmd1bWVudHMpOwogICAgICAgIHJldHVybiByZXN1bHQodGhpcywgZnVuYy5hcHBseShfLCBhcmdzKSk7CiAgICAgIH07CiAgICB9KTsKICB9OwoKICAvLyBBZGQgYWxsIG9mIHRoZSBVbmRlcnNjb3JlIGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlciBvYmplY3QuCiAgXy5taXhpbihfKTsKCiAgLy8gQWRkIGFsbCBtdXRhdG9yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBfLmVhY2goWydwb3AnLCAncHVzaCcsICdyZXZlcnNlJywgJ3NoaWZ0JywgJ3NvcnQnLCAnc3BsaWNlJywgJ3Vuc2hpZnQnXSwgZnVuY3Rpb24obmFtZSkgewogICAgdmFyIG1ldGhvZCA9IEFycmF5UHJvdG9bbmFtZV07CiAgICBfLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgb2JqID0gdGhpcy5fd3JhcHBlZDsKICAgICAgbWV0aG9kLmFwcGx5KG9iaiwgYXJndW1lbnRzKTsKICAgICAgaWYgKChuYW1lID09PSAnc2hpZnQnIHx8IG5hbWUgPT09ICdzcGxpY2UnKSAmJiBvYmoubGVuZ3RoID09PSAwKSBkZWxldGUgb2JqWzBdOwogICAgICByZXR1cm4gcmVzdWx0KHRoaXMsIG9iaik7CiAgICB9OwogIH0pOwoKICAvLyBBZGQgYWxsIGFjY2Vzc29yIEFycmF5IGZ1bmN0aW9ucyB0byB0aGUgd3JhcHBlci4KICBfLmVhY2goWydjb25jYXQnLCAnam9pbicsICdzbGljZSddLCBmdW5jdGlvbihuYW1lKSB7CiAgICB2YXIgbWV0aG9kID0gQXJyYXlQcm90b1tuYW1lXTsKICAgIF8ucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZXN1bHQodGhpcywgbWV0aG9kLmFwcGx5KHRoaXMuX3dyYXBwZWQsIGFyZ3VtZW50cykpOwogICAgfTsKICB9KTsKCiAgLy8gRXh0cmFjdHMgdGhlIHJlc3VsdCBmcm9tIGEgd3JhcHBlZCBhbmQgY2hhaW5lZCBvYmplY3QuCiAgXy5wcm90b3R5cGUudmFsdWUgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLl93cmFwcGVkOwogIH07CgogIC8vIFByb3ZpZGUgdW53cmFwcGluZyBwcm94eSBmb3Igc29tZSBtZXRob2RzIHVzZWQgaW4gZW5naW5lIG9wZXJhdGlvbnMKICAvLyBzdWNoIGFzIGFyaXRobWV0aWMgYW5kIEpTT04gc3RyaW5naWZpY2F0aW9uLgogIF8ucHJvdG90eXBlLnZhbHVlT2YgPSBfLnByb3RvdHlwZS50b0pTT04gPSBfLnByb3RvdHlwZS52YWx1ZTsKCiAgXy5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAnJyArIHRoaXMuX3dyYXBwZWQ7CiAgfTsKCiAgLy8gQU1EIHJlZ2lzdHJhdGlvbiBoYXBwZW5zIGF0IHRoZSBlbmQgZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBBTUQgbG9hZGVycwogIC8vIHRoYXQgbWF5IG5vdCBlbmZvcmNlIG5leHQtdHVybiBzZW1hbnRpY3Mgb24gbW9kdWxlcy4gRXZlbiB0aG91Z2ggZ2VuZXJhbAogIC8vIHByYWN0aWNlIGZvciBBTUQgcmVnaXN0cmF0aW9uIGlzIHRvIGJlIGFub255bW91cywgdW5kZXJzY29yZSByZWdpc3RlcnMKICAvLyBhcyBhIG5hbWVkIG1vZHVsZSBiZWNhdXNlLCBsaWtlIGpRdWVyeSwgaXQgaXMgYSBiYXNlIGxpYnJhcnkgdGhhdCBpcwogIC8vIHBvcHVsYXIgZW5vdWdoIHRvIGJlIGJ1bmRsZWQgaW4gYSB0aGlyZCBwYXJ0eSBsaWIsIGJ1dCBub3QgYmUgcGFydCBvZgogIC8vIGFuIEFNRCBsb2FkIHJlcXVlc3QuIFRob3NlIGNhc2VzIGNvdWxkIGdlbmVyYXRlIGFuIGVycm9yIHdoZW4gYW4KICAvLyBhbm9ueW1vdXMgZGVmaW5lKCkgaXMgY2FsbGVkIG91dHNpZGUgb2YgYSBsb2FkZXIgcmVxdWVzdC4KICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoJ3VuZGVyc2NvcmUnLCBbXSwgZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBfOwogICAgfSk7CiAgfQp9LmNhbGwodGhpcykpOwo="></script>
<link href="data:text/css;charset=utf-8,ul%20%7B%0Alist%2Dstyle%3A%20none%3B%0A%2Dwebkit%2Dpadding%2Dstart%3A%200px%3B%20%0A%7D%0A%2EcnvSVG%20%7B%0Aoverflow%3A%20scroll%3B%0A%7D%0A%2Ed3%2Dtip%20%7B%0Aline%2Dheight%3A%201%3B%0Apadding%3A%2012px%3B%0Abackground%3A%20rgba%280%2C%200%2C%200%2C%200%2E8%29%3B%0Acolor%3A%20%23fff%3B%0Aborder%2Dradius%3A%202px%3B%0A%7D%0A%0A%2Ed3%2Dtip%3Aafter%20%7B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0Adisplay%3A%20inline%3B%0Afont%2Dsize%3A%2010px%3B%0Awidth%3A%20100%25%3B%0Aline%2Dheight%3A%201%3B%0Acolor%3A%20rgba%280%2C%200%2C%200%2C%200%2E8%29%3B%0Acontent%3A%20%22%5C25BC%22%3B%0Aposition%3A%20absolute%3B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%0A%2Ed3%2Dtip%2En%3Aafter%20%7B%0Amargin%3A%20%2D1px%200%200%200%3B%0Atop%3A%20100%25%3B%0Aleft%3A%200%3B%0A%7D%0A%0A%2Ebrush%20%2Eextent%20%7B%0Astroke%3A%20%23fff%3B%0Afill%2Dopacity%3A%20%2E4%3B%0Ashape%2Drendering%3A%20crispEdges%3B%0A%7D%0A%2EgtypeAnnot%2Einactive%20%7B%0Afill%3A%20%23ffffff%3B%0A%7D%0A%2EtpAnnot%2Einactive%20%7B%0Afill%3A%20%23ffffff%3B%0A%7D%0A%2Egraph%2Enode%2Einactive%20%7B%0Afill%3A%20%23ffffff%3B%0Astroke%3A%20%23CECECE%3B%0A%7D%0A%2Etree%2Enode%2Einactive%20%7B%0Afill%3A%20%23ffffff%3B%0Astroke%3A%20%23CECECE%3B%0A%7D%0A%2Egraph%2Enode%2Eactive%20%7B%0Afill%3A%20%23000000%3B%0A%7D%0A%2Etree%2Enode%2Eactive%20%7B%0Afill%3A%20%23000000%3B%0A%7D%0A%2ElegendGroupRect%2Eactive%20%7B%0Astroke%3A%20%23000000%3B%0A%7D%0A%2ElegendTpRect%2Eactive%20%7B%0Astroke%3A%20%23000000%3B%0A%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,Ly8gRDMgRUZGRUNUUyBGVU5DVElPTlMKCmQzLnNlbGVjdGlvbi5wcm90b3R5cGUubW92ZVRvRnJvbnQgPSBmdW5jdGlvbigpIHsKICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7CiAgICB0aGlzLnBhcmVudE5vZGUuYXBwZW5kQ2hpbGQodGhpcyk7CiAgfSk7Cn07CgovKiBicnVzaCBzZWxlY3Rpb24gZW5kaW5nIGZ1bmN0aW9uCiogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoqLwpmdW5jdGlvbiBfYnJ1c2hFbmQoY3VyVml6T2JqLCBicnVzaCkgewogICAgdmFyIGN1cl9zZWxlY3RlZFNDcyA9IFtdOwogICAgdmFyIGV4dGVudCA9IGQzLmV2ZW50LnRhcmdldC5leHRlbnQoKTsKCiAgICAvLyBpZiB0aGVyZSB3ZXJlIG5vIHByZXZpb3VzbHkgc2VsZWN0ZWQgc2luZ2xlIGNlbGxzLCBpbmFjdGl2YXRlIGFsbCBzaW5nbGUgY2VsbHMKICAgIGlmIChjdXJWaXpPYmoudmlldy5zZWxlY3RlZFNDcy5sZW5ndGggPT09IDApIHsKICAgICAgICAvLyB0dXJuIG9mZiBhbGwgc2luZ2xlIGNlbGxzCiAgICAgICAgX2luYWN0aXZhdGVTaW5nbGVDZWxscyhjdXJWaXpPYmoudmlld19pZCk7CiAgICB9CgogICAgLy8gaWYgdGhlIGJydXNoIGlzIG5vdCBlbXB0eQogICAgaWYgKCFicnVzaC5lbXB0eSgpKSB7CiAgICAgICAgCiAgICAgICAgLy8gaGlnaGxpZ2h0IHNlbGVjdGVkIGdyaWQgY2VsbCByb3dzCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5pbmRpYyIpLmNsYXNzZWQoImFjdGl2ZSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgdmFyIHlfY29vcmQgPSBwYXJzZUZsb2F0KGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJ5IikpOwogICAgICAgICAgICAvLyBpZiBhbnkgdHJhbnNmb3JtYXRpb24gaGFzIG9jY3VycmVkCiAgICAgICAgICAgIHZhciB0ID0gZDMudHJhbnNmb3JtKGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJ0cmFuc2Zvcm0iKSksIAogICAgICAgICAgICAgICAgdF95ID0gdC50cmFuc2xhdGVbMV07CiAgICAgICAgICAgIHZhciBicnVzaGVkID0gZXh0ZW50WzBdIDw9ICh5X2Nvb3JkK2N1clZpek9iai52aWV3LmhtLnJvd0hlaWdodCt0X3kpICYmICh5X2Nvb3JkK3RfeSkgPD0gZXh0ZW50WzFdOwogICAgICAgICAgICBpZiAoYnJ1c2hlZCkgewogICAgICAgICAgICAgICAgY3VyX3NlbGVjdGVkU0NzLnB1c2goZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGJydXNoZWQ7CiAgICAgICAgfSk7CgogICAgICAgIC8vIGhpZ2hsaWdodCBzZWxlY3RlZCBzYydzIGluZGljYXRvcnMgJiBub2RlcwogICAgICAgIGN1cl9zZWxlY3RlZFNDcy5mb3JFYWNoKGZ1bmN0aW9uKHNjX2lkKSB7CiAgICAgICAgICAgIF9oaWdobGlnaHRJbmRpY2F0b3Ioc2NfaWQsIGN1clZpek9iai52aWV3X2lkKTsgICAKICAgICAgICAgICAgX2hpZ2hsaWdodFNpbmdsZUNlbGwoc2NfaWQsIGN1clZpek9iai52aWV3X2lkKTsgICAgCiAgICAgICAgfSk7CgogICAgICAgIC8vIGFkZCB0aGUgY3VycmVudGx5IHNlbGVjdGVkIHNpbmdsZSBjZWxscyB0byB0aGUgY3VyVml6T2JqIGxpc3QKICAgICAgICBjdXJWaXpPYmoudmlldy5zZWxlY3RlZFNDcyA9IGN1clZpek9iai52aWV3LnNlbGVjdGVkU0NzLmNvbmNhdChjdXJfc2VsZWN0ZWRTQ3MpOwogICAgfSAKICAgIC8vIGlmIHRoZSBicnVzaCBpcyBlbXB0eQogICAgZWxzZSB7CiAgICAgICAgX2NsZWFyQnJ1c2goY3VyVml6T2JqLnZpZXdfaWQpOwogICAgfQoKICAgIC8vIGNsZWFyIGJydXNoCiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLmJydXNoIikuY2FsbChicnVzaC5jbGVhcigpKTsKfQoKLyogZnVuY3Rpb24gdG8gY2hlY2sgZm9yIHNlbGVjdGlvbnMKKi8KZnVuY3Rpb24gX2NoZWNrRm9yU2VsZWN0aW9ucyh2aWV3X2lkKSB7CiAgICByZXR1cm4gKChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuYnJ1c2hCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PT0gMCkgJiYgLy8gYnJ1c2ggYnV0dG9uIG5vdCBzZWxlY3RlZAogICAgICAgICAgICAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnNjaXNzb3JzQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT09IDApKTsgLy8gc2Npc3NvcnMgYnV0dG9uIG5vdCBzZWxlY3RlZAp9CgovKiBmdW5jdGlvbiB0byBjbGVhciBhbnkgYnJ1c2ggc2VsZWN0aW9uCiovCmZ1bmN0aW9uIF9jbGVhckJydXNoKHZpZXdfaWQpIHsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5jbnZTVkciKS5jbGFzc2VkKCJicnVzaGVkIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyaWRDZWxsIikuY2xhc3NlZCgiYWN0aXZlIiwgZmFsc2UpOwoKICAgIC8vIHJlc2V0IG5vZGVzIGFuZCBpbmRpY2F0b3JzCiAgICBfcmVzZXRTaW5nbGVDZWxscyh2aWV3X2lkKTsKICAgIF9yZXNldEluZGljYXRvcnModmlld19pZCk7CgogICAgLy8gcmVzZXQgc2VsZWN0ZWRTQ3MgbGlzdAogICAgY3VyVml6T2JqLnZpZXcuc2VsZWN0ZWRTQ3MgPSBbXTsKfQoKLyogZnVuY3Rpb24gZm9yIG5vZGUgbW91c2VvdmVyCiogQHBhcmFtIHtTdHJpbmd9IHNjX2lkIC0tIHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiogQHBhcmFtIHtPYmplY3R9IG5vZGVUaXAgLS0gdG9vbHRpcCBmb3Igbm9kZQoqIEBwYXJhbSB7Qm9vbGVhbn0gc3dpdGNoVmlldyAtLSB3aGljaCB2aWV3IGlzIG9uLCB0cmVlIChUKSBvciBncmFwaCAoRikKKiBAcGFyYW0ge0FycmF5fSBzY19hbm5vdCAtLSBhbm5vdGF0aW9ucyBmb3Igc2luZ2xlIGNlbGxzIChwcm92aWRlZCBieSB1c2VyKQoqLwpmdW5jdGlvbiBfbW91c2VvdmVyTm9kZShzY19pZCwgdmlld19pZCwgbm9kZVRpcCwgc3dpdGNoVmlldywgc2NfYW5ub3QpIHsKICAgIC8vIHNob3cgc2luZ2xlIGNlbGwgdG9vbHRpcAogICAgaWYgKHN3aXRjaFZpZXcpIHsKICAgICAgICBub2RlVGlwLnNob3coc2NfaWQsIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50cmVlLm5vZGUubm9kZV8iICsgc2NfaWQpLm5vZGUoKSk7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICBub2RlVGlwLnNob3coc2NfaWQsIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5ncmFwaC5ub2RlLm5vZGVfIiArIHNjX2lkKS5ub2RlKCkpOwogICAgfQoKICAgIC8vIGhpZ2hsaWdodCBpbmRpY2F0b3IgCiAgICBfaGlnaGxpZ2h0SW5kaWNhdG9yKHNjX2lkLCB2aWV3X2lkKTsKCiAgICAvLyBoaWdobGlnaHQgbm9kZSdzIGdlbm90eXBlIGFuZCB0aW1lcG9pbnQKICAgIHZhciBndHlwZSA9IF9nZXRHZW5vdHlwZShzY19hbm5vdCwgc2NfaWQpOwogICAgdmFyIHRwID0gX2dldFRQKHNjX2Fubm90LCBzY19pZCk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0IikuY2xhc3NlZCgiYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZEdyb3VwUmVjdC5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImFjdGl2ZSIsIHRydWUpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZFRwUmVjdCIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcFJlY3QudHBfIiArIHRwKS5jbGFzc2VkKCJhY3RpdmUiLCB0cnVlKTsKCiAgICAvLyBoaWdobGlnaHQgbm9kZSBpdHNlbGYgJiBicmluZyBpdCB0byBmcm9udAogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUubm9kZV8iICsgc2NfaWQpLmNsYXNzZWQoImFjdGl2ZSIsIHRydWUpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZS5ub2RlXyIgKyBzY19pZCkuY2xhc3NlZCgiYWN0aXZlIiwgdHJ1ZSk7CiAgICBkMy5zZWxlY3QoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUubm9kZV8iICsgc2NfaWQpLm5vZGUoKS5wYXJlbnROb2RlKS5tb3ZlVG9Gcm9udCgpOwogICAgZDMuc2VsZWN0KGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUubm9kZV8iICsgc2NfaWQpLm5vZGUoKS5wYXJlbnROb2RlKS5tb3ZlVG9Gcm9udCgpOwp9CgovKiBmdW5jdGlvbiBmb3Igbm9kZSBtb3VzZW91dAoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoqIEBwYXJhbSB7T2JqZWN0fSBub2RlVGlwIC0tIHRvb2x0aXAgZm9yIG5vZGUKKi8KZnVuY3Rpb24gX21vdXNlb3V0Tm9kZShzY19pZCwgdmlld19pZCwgbm9kZVRpcCkgewogICAgLy8gaGlkZSB0b29sdGlwCiAgICBub2RlVGlwLmhpZGUoc2NfaWQpOwoKICAgIC8vdW5oaWdobGlnaHQgaW5kaWNhdG9yIFRPRE8KICAgIF9yZXNldEluZGljYXRvcih2aWV3X2lkLCBzY19pZCk7CgogICAgLy8gcmVzZXQgZ2Vub3R5cGVzCiAgICBfbW91c2VvdXRHZW5vdHlwZSh2aWV3X2lkKTsKCiAgICAvLyByZXNldCB0aW1lcG9pbnRzCiAgICBfbW91c2VvdXRUcCh2aWV3X2lkKTsKfQoKLyogZnVuY3Rpb24gZm9yIGdlbm90eXBlIG1vdXNlb3ZlcgoqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSBnZW5vdHlwZSB0byBoaWdobGlnaHQKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBvZiBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX21vdXNlb3Zlckdlbm90eXBlKGd0eXBlLCB2aWV3X2lkKSB7CgogICAgX2luYWN0aXZhdGVHZW5vdHlwZXModmlld19pZCk7CiAgICBfaGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpOwp9CgovKiBmdW5jdGlvbiBmb3IgdGltZXBvaW50IG1vdXNlb3ZlcgoqIEBwYXJhbSB7U3RyaW5nfSB0cCAtLSB0aW1lcG9pbnQgdG8gaGlnaGxpZ2h0CiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9tb3VzZW92ZXJUcCh0cCwgdmlld19pZCkgewogICAgX2luYWN0aXZhdGVUcHModmlld19pZCk7CiAgICBfaGlnaGxpZ2h0VHAodHAsIHZpZXdfaWQpOwp9CgovKiBmdW5jdGlvbiBmb3IgZ2Vub3R5cGUgbW91c2VvdXQKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBvZiBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX21vdXNlb3V0R2Vub3R5cGUodmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5ncmFwaC5ub2RlIikuY2xhc3NlZCgiYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRHcm91cFJlY3QiKS5jbGFzc2VkKCJhY3RpdmUiLCBmYWxzZSk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHNQbG90IikuY2xhc3NlZCgiaW5hY3RpdmUiLCBmYWxzZSk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kVHJlZU5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5pbmRpYyIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApOwp9CgovKiBmdW5jdGlvbiBmb3IgdGltZXBvaW50IG1vdXNlb3ZlcgoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfbW91c2VvdXRUcCh2aWV3X2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZFRwUmVjdCIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5pbmRpYyIpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApOwogICAgX2hpZGVUcEd1aWRlcyh2aWV3X2lkKTsKfQoKLyogZnVuY3Rpb24gdG8gaW5hY3RpdmF0ZSBhbGwgZ2Vub3R5cGVzCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9pbmFjdGl2YXRlR2Vub3R5cGVzKHZpZXdfaWQpIHsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5ncmFwaC5ub2RlIikuY2xhc3NlZCgiaW5hY3RpdmUiLCB0cnVlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIHRydWUpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZEdyb3VwUmVjdCIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50c1Bsb3QiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIHRydWUpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZFRyZWVOb2RlIikuY2xhc3NlZCgiaW5hY3RpdmUiLCB0cnVlKTsKfQoKLyogZnVuY3Rpb24gdG8gaW5hY3RpdmF0ZSBhbGwgdGltZXBvaW50cwoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfaW5hY3RpdmF0ZVRwcyh2aWV3X2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHJlZS5ub2RlIikuY2xhc3NlZCgiaW5hY3RpdmUiLCB0cnVlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcFJlY3QiKS5jbGFzc2VkKCJhY3RpdmUiLCBmYWxzZSk7CiAgICBfaGlkZVRwR3VpZGVzKHZpZXdfaWQpOwp9CgovKiBmdW5jdGlvbiB0byBoaWdobGlnaHQgYSBwYXJ0aWN1bGFyIGdlbm90eXBlCiogQHBhcmFtIHtTdHJpbmd9IGd0eXBlIC0tIGdlbm90eXBlIHRvIGhpZ2hsaWdodAoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfaGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpIHsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5pbmRpYy5ndHlwZV8iICsgZ3R5cGUpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDEpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRHcm91cFJlY3QuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJhY3RpdmUiLCB0cnVlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50c1Bsb3QuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTm9kZS5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwp9CgovKiBmdW5jdGlvbiB0byBoaWdobGlnaHQgYSBwYXJ0aWN1bGFyIHRpbWVwb2ludAoqIEBwYXJhbSB7U3RyaW5nfSB0cCAtLSB0aW1lcG9pbnQgdG8gaGlnaGxpZ2h0CiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9oaWdobGlnaHRUcCh0cCwgdmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmluZGljLnRwXyIgKyB0cCkuYXR0cigiZmlsbC1vcGFjaXR5IiwgMSk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZS50cF8iICsgdHApLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZS50cF8iICsgdHApLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZFRwUmVjdC50cF8iICsgdHApLmNsYXNzZWQoImFjdGl2ZSIsIHRydWUpOwogICAgX2hsVHBHdWlkZSh2aWV3X2lkLCB0cCk7Cn0KCi8qIGZ1bmN0aW9uIHRvIGhpZ2hsaWdodCBhIHNpbmdsZSBjZWxsCiogQHBhcmFtIHtTdHJpbmd9IHNjX2lkIC0tIHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9oaWdobGlnaHRTaW5nbGVDZWxsKHNjX2lkLCB2aWV3X2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZS5ub2RlXyIgKyBzY19pZCkuY2xhc3NlZCgiaW5hY3RpdmUiLCBmYWxzZSk7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHJlZS5ub2RlLm5vZGVfIiArIHNjX2lkKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKfQoKLyogZnVuY3Rpb24gdG8gaW5hY3RpdmF0ZSBhbGwgc2luZ2xlIGNlbGxzCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9pbmFjdGl2YXRlU2luZ2xlQ2VsbHModmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIHRydWUpOwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7Cn0KCi8qIGZ1bmN0aW9uIHRvIHJlc2V0IGFsbCBzaW5nbGUgY2VsbHMKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBvZiBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX3Jlc2V0U2luZ2xlQ2VsbHModmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKfQoKLyogZnVuY3Rpb24gdG8gaGlnaGxpZ2h0IGEgbm9kZSBpbiB0aGUgdHJlZQoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKi8KZnVuY3Rpb24gX2hpZ2hsaWdodE5vZGUoc2NfaWQsIGN1clZpek9iaikgewogICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5ub2RlXyIgKyBzY19pZCkKICAgICAgICAuYXR0cigiZmlsbCIsIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLmhpZ2hsaWdodENvbG91cik7Cn0KCi8qIGZ1bmN0aW9uIHRvIGhpZ2hsaWdodCBhIGdlbm90eXBlIGFubm90YXRpb24gcmVjdGFuZ2xlIGluIHRoZSBsZWdlbmQKKiBAcGFyYW0ge1N0cmluZ30gZ3R5cGVfaWQgLS0gZ2Vub3R5cGUgaWQKKiBAcGFyYW0ge1N0cmluZ30gaGlnaGxpZ2h0Q29sb3VyIC0tIGNvbG91ciB0byBoaWdobGlnaHQgaW5kaWNhdG9ycy9ub2RlcwoqLwpmdW5jdGlvbiBfaGlnaGxpZ2h0R3JvdXBBbm5vdExlZ2VuZFJlY3QoZ3R5cGVfaWQsIGhpZ2hsaWdodENvbG91ciwgdmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmxlZ2VuZEdyb3VwUmVjdC5ndHlwZV8iICsgZ3R5cGVfaWQpCiAgICAgICAgLmF0dHIoInN0cm9rZSIsIGhpZ2hsaWdodENvbG91cik7Cn0KCi8qIGZ1bmN0aW9uIHRvIHVuaGlnaGxpZ2h0IGdlbm90eXBlIGFubm90YXRpb24gcmVjdGFuZ2xlcyBpbiB0aGUgbGVnZW5kCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9yZXNldEdyb3VwQW5ub3RMZWdlbmRSZWN0cyh2aWV3X2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0IikKICAgICAgICAuYXR0cigic3Ryb2tlIiwgIm5vbmUiKTsKfQoKLyogZnVuY3Rpb24gdG8gaGlnaGxpZ2h0IGluZGljYXRvciBmb3IgYSBzaW5nbGUgY2VsbAoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX2hpZ2hsaWdodEluZGljYXRvcihzY19pZCwgdmlld19pZCkgewogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmluZGljLnNjXyIgKyBzY19pZCkuYXR0cigiZmlsbC1vcGFjaXR5IiwgMSk7Cn0KCi8qIGZ1bmN0aW9uIHRvIHJlc2V0IGEgbm9kZSBpbiB0aGUgdHJlZQoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKi8KZnVuY3Rpb24gX3Jlc2V0Tm9kZShzY19pZCwgY3VyVml6T2JqKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLm5vZGVfIiArIHNjX2lkKQogICAgICAgIC5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICByZXR1cm4gX2dldE5vZGVGaWxsKGN1clZpek9iaiwgZC5zY19pZCk7CiAgICAgICAgfSk7Cn0KCi8qIGZ1bmN0aW9uIHRvIHJlc2V0IGluZGljYXRvciBmb3IgYSBzaW5nbGUgY2VsbAoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX3Jlc2V0SW5kaWNhdG9yKHZpZXdfaWQsIHNjX2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIuaW5kaWMuc2NfIiArIHNjX2lkKQogICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwKTsKfQoKLyogZnVuY3Rpb24gdG8gcmVzZXQgYWxsIG5vZGVzIGluIHRoZSB0cmVlCiogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgZm9yIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfcmVzZXROb2Rlcyh2aWV3X2lkKSB7CiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubm9kZSIpCiAgICAgICAgLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmZpbGw7IH0pOwp9CgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIGZpbGwgY29sb3VyIG9mIGEgbm9kZQoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKiBAcGFyYW0ge1N0cmluZ30gc2NfaWQgLS0gc2luZ2xlIGNlbGwgaWQKKi8KZnVuY3Rpb24gX2dldE5vZGVGaWxsKGN1clZpek9iaiwgc2NfaWQpIHsKICAgIHZhciBtaXNzaW5nQ29sb3VyID0gIndoaXRlIjsKCiAgICAvLyBnZW5vdHlwZSBhbm5vdGF0aW9ucyBzcGVjaWZpZWQgLS0gY29sb3VyIGJ5IGdlbm90eXBlCiAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkKSB7CiAgICAgICAgdmFyIGZvdW5kX3NjX3dpdGhfZ3R5cGUgPSBfLmZpbmRXaGVyZShjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCwge3NpbmdsZV9jZWxsX2lkOiBzY19pZH0pOwogICAgICAgIHJldHVybiAoZm91bmRfc2Nfd2l0aF9ndHlwZSkgPyAvLyBpZiB0aGlzIHNjIGhhcyBhIGdlbm90eXBlCiAgICAgICAgICAgIGN1clZpek9iai52aWV3LmFscGhhX2NvbG91cl9hc3NpZ25tZW50W2ZvdW5kX3NjX3dpdGhfZ3R5cGUuZ2Vub3R5cGVdIDogCiAgICAgICAgICAgIG1pc3NpbmdDb2xvdXI7CiAgICB9CiAgICAvLyBubyBnZW5vdHlwZSBhbm5vdGF0aW9ucyAtLSBkZWZhdWx0IGNvbG91ciwgdW5sZXNzIGhlYXRtYXAgZGF0YSBpcyBtaXNzaW5nIGZvciB0aGlzIGNlbGwKICAgIGVsc2UgewogICAgICAgIHJldHVybiAoY3VyVml6T2JqLnVzZXJDb25maWcuc2NzX21pc3NpbmdfZnJvbV9obS5pbmRleE9mKHNjX2lkKSAhPSAtMSkgPyAKICAgICAgICAgICAgbWlzc2luZ0NvbG91ciA6IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLmRlZmF1bHROb2RlQ29sb3VyOwogICAgfQp9CgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIHN0cm9rZSBjb2xvdXIgb2YgYSBub2RlCiogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqLwpmdW5jdGlvbiBfZ2V0Tm9kZVN0cm9rZShjdXJWaXpPYmosIHNjX2lkKSB7CiAgICAvLyBnZW5vdHlwZSBhbm5vdGF0aW9ucyBzcGVjaWZpZWQgLS0gY29sb3VyIGJ5IGdlbm90eXBlCiAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkKSB7CiAgICAgICAgdmFyIGZvdW5kX3NjX3dpdGhfZ3R5cGUgPSBfLmZpbmRXaGVyZShjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCwge3NpbmdsZV9jZWxsX2lkOiBzY19pZH0pOwogICAgICAgIHJldHVybiAoZm91bmRfc2Nfd2l0aF9ndHlwZSkgPyAvLyBpZiB0aGlzIHNjIGhhcyBhIGdlbm90eXBlCiAgICAgICAgICAgIGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50W2ZvdW5kX3NjX3dpdGhfZ3R5cGUuZ2Vub3R5cGVdIDogCiAgICAgICAgICAgIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLmRlZmF1bHROb2RlQ29sb3VyOwogICAgfQogICAgLy8gbm8gZ2Vub3R5cGUgYW5ub3RhdGlvbnMgLS0gZGVmYXVsdCBjb2xvdXIKICAgIHJldHVybiBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kZWZhdWx0Tm9kZUNvbG91cjsKfQoKLyogZnVuY3Rpb24gdG8gcmVzZXQgYWxsIGluZGljYXRvcnMgZm9yIGEgc2luZ2xlIGNlbGwKKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBmb3IgdGhlIGN1cnJlbnQgdmlldwoqLwpmdW5jdGlvbiBfcmVzZXRJbmRpY2F0b3JzKHZpZXdfaWQpIHsKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5pbmRpYyIpCiAgICAgICAgLmF0dHIoImZpbGwtb3BhY2l0eSIsIDApOwp9CgovKiBmdW5jdGlvbiB0byByZXNldCBhbGwgbGlua3MgaW4gdGhlIHRyZWUKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9yZXNldExpbmtzKGN1clZpek9iaikgewogICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5saW5rIikKICAgICAgICAuYXR0cigic3Ryb2tlIiwgY3VyVml6T2JqLmdlbmVyYWxDb25maWcuZGVmYXVsdExpbmtDb2xvdXIpOwp9CgovKiBicnVzaCBzZWxlY3Rpb24gYnV0dG9uIHB1c2ggZnVuY3Rpb24KKiBAcGFyYW0ge09iamVjdH0gYnJ1c2ggLS0gYnJ1c2ggb2JqZWN0CiogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoqLwpmdW5jdGlvbiBfcHVzaEJydXNoU2VsZWN0aW9uQnV0dG9uKGJydXNoLCBjdXJWaXpPYmopIHsKCiAgICAvLyBkZXNlbGVjdCBicnVzaCB0b29sCiAgICBpZiAoZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5zZWxlY3Rpb25CdXR0b24iKS5jbGFzc2VkKCJicnVzaEJ1dHRvblNlbGVjdGVkIikpIHsKICAgICAgICAvLyBkZXNlbGVjdCBhbnkgbm9kZXMgYW5kIGluZGljYXRvcnMKICAgICAgICBfY2xlYXJCcnVzaChjdXJWaXpPYmoudmlld19pZCk7CgogICAgICAgIC8vIHJlbW92ZSBicnVzaCB0b29sCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5icnVzaCIpLnJlbW92ZSgpOwoKICAgICAgICAvLyByZW1vdmUgImJydXNoQnV0dG9uU2VsZWN0ZWQiIGNsYXNzIGZyb20gYnV0dG9uCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5zZWxlY3Rpb25CdXR0b24iKS5jbGFzc2VkKCJicnVzaEJ1dHRvblNlbGVjdGVkIiwgZmFsc2UpOyAKCiAgICAgICAgLy8gcmVzZXQgY29sb3VyIG9mIHRoZSBicnVzaCBzZWxlY3Rpb24gYnV0dG9uCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5zZWxlY3Rpb25CdXR0b24iKS5hdHRyKCJmaWxsIiwgY3VyVml6T2JqLmdlbmVyYWxDb25maWcudG9wQmFyQ29sb3VyKTsKICAgIH0KICAgIC8vIHNlbGVjdCBicnVzaCB0b29sCiAgICBlbHNlIHsKICAgICAgICAvLyBtYXJrIHRoaXMgYnV0dG9uIGFzIGJydXNoQnV0dG9uU2VsZWN0ZWQKICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnNlbGVjdGlvbkJ1dHRvbiIpLmNsYXNzZWQoImJydXNoQnV0dG9uU2VsZWN0ZWQiLCB0cnVlKTsgCgogICAgICAgIC8vIGNyZWF0ZSBicnVzaCB0b29sCiAgICAgICAgY3VyVml6T2JqLnZpZXcuY252U1ZHLmFwcGVuZCgiZyIpIAogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiYnJ1c2giKQogICAgICAgICAgICAuY2FsbChicnVzaCkKICAgICAgICAgICAgLnNlbGVjdEFsbCgncmVjdCcpCiAgICAgICAgICAgIC5hdHRyKCd3aWR0aCcsIGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBXaWR0aCk7CiAgICB9Cn0KCi8qIHNjaXNzb3JzIGJ1dHRvbiBwdXNoIGZ1bmN0aW9uCiogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoqLwpmdW5jdGlvbiBfcHVzaFNjaXNzb3JzQnV0dG9uKGN1clZpek9iaikgewoKICAgIC8vIGRlc2VsZWN0IHNjaXNzb3JzIHRvb2wKICAgIGlmIChkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnNjaXNzb3JzQnV0dG9uIikuY2xhc3NlZCgic2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpKSB7CiAgICAgICAgLy8gcmVtb3ZlICJzY2lzc29yc0J1dHRvblNlbGVjdGVkIiBjbGFzcyBmcm9tIGJ1dHRvbgogICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIuc2Npc3NvcnNCdXR0b24iKS5jbGFzc2VkKCJzY2lzc29yc0J1dHRvblNlbGVjdGVkIiwgZmFsc2UpOyAKCiAgICAgICAgLy8gcmVzZXQgY29sb3VyIG9mIHRoZSBicnVzaCBzY2lzc29ycyBidXR0b24KICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnNjaXNzb3JzQnV0dG9uIikuYXR0cigiZmlsbCIsIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRvcEJhckNvbG91cik7CiAgICB9CiAgICAvLyBzZWxlY3Qgc2Npc3NvcnMgdG9vbAogICAgZWxzZSB7CiAgICAgICAgLy8gbWFyayB0aGlzIGJ1dHRvbiBhcyBzY2lzc29yc0J1dHRvblNlbGVjdGVkCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5zY2lzc29yc0J1dHRvbiIpLmNsYXNzZWQoInNjaXNzb3JzQnV0dG9uU2VsZWN0ZWQiLCB0cnVlKTsgCiAgICB9Cn0KCi8vIFRSRUUgRlVOQ1RJT05TCgovKiBmdW5jdGlvbiB0byBmaW5kIGEga2V5IGJ5IGl0cyBuYW1lIC0gaWYgdGhlIGtleSBkb2Vzbid0IGV4aXN0LCBpdCB3aWxsIGJlIGNyZWF0ZWQgYW5kIGFkZGVkIHRvIHRoZSBsaXN0IG9mIG5vZGVzCiogQHBhcmFtIHtBcnJheX0gbGlzdCAtIGxpc3Qgb2Ygbm9kZXMKKiBAcGFyYW0ge1N0cmluZ30gbmFtZSAtIG5hbWUgb2Yga2V5IHRvIGZpbmQKKi8KZnVuY3Rpb24gX2d0X2ZpbmRUcmVlQnlSb290KGxpc3QsIG5hbWUpIHsKICAgIHZhciBmb3VuZE5vZGUgPSBfLmZpbmRXaGVyZShsaXN0LCB7aWQ6IG5hbWV9KSwKICAgICAgICBjdXJOb2RlOwoKICAgIGlmICghZm91bmROb2RlKSB7CiAgICAgICAgY3VyTm9kZSA9IHsnaWQnOiBuYW1lLCAnY2hpbGRyZW4nOiBbXX07CiAgICAgICAgbGlzdC5wdXNoKGN1ck5vZGUpOwogICAgICAgIHJldHVybiBjdXJOb2RlOwogICAgfQoKICAgIHJldHVybiBmb3VuZE5vZGU7Cn0KCi8qCiogZnVuY3Rpb24gdG8sIHVzaW5nIHRoZSB0cmVlIGhpZXJhcmNoeSwgZ2V0IHRoZSBsaW5lYXIgc2VnbWVudHMnIHN0YXJ0aW5nIGtleSBhbmQgbGVuZ3RoIChpbmNsdWRpbmcgc3RhcnRpbmcga2V5KQoqIEBwYXJhbSB7T2JqZWN0fSBjdXJOb2RlIC0tIGN1cnJlbnQga2V5IGluIHRoZSB0cmVlCiogQHBhcmFtIHtPYmplY3R9IGNoYWlucyAtLSBvcmlnaW5hbGx5IGVtcHR5IG9iamVjdCBvZiB0aGUgc2VnbWVudHMgCiogICAgICAgICAgICAgICAgICAgICAgICAgICAoa2V5IGlzIHNlZ21lbnQgc3RhcnQga2V5LCB2YWx1ZSBpcyBhcnJheSBvZiBkZXNjZW5kYW50cyBpbiB0aGlzIGNoYWluKQoqIEBwYXJhbSB7T2JqZWN0fSBiYXNlIC0tIHRoZSBiYXNlIGtleSBvZiB0aGlzIGNoYWluIChvcmlnaW5hbGx5ICIiKQoqLwpmdW5jdGlvbiBfZ3RfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZSwgY2hhaW5zLCBiYXNlKSB7CgogICAgLy8gaWYgaXQncyBhIG5ldyBiYXNlLCBjcmVhdGUgdGhlIGJhc2UsIHdpdGggbm8gZGVzY2VuZGFudHMgaW4gaXRzIGFycmF5IHlldAogICAgaWYgKGJhc2UgPT09ICIiKSB7CiAgICAgICAgYmFzZSA9IGN1ck5vZGUuaWQ7CiAgICAgICAgY2hhaW5zW2Jhc2VdID0gW107CiAgICAgICAgY3VyVml6T2JqLmRhdGEuZ3R5cGVUcmVlQ2hhaW5Sb290cy5wdXNoKGN1ck5vZGUuaWQpOwogICAgfQogICAgLy8gaWYgaXQncyBhIGxpbmVhciBkZXNjZW5kYW50LCBhcHBlbmQgdGhlIGN1cnJlbnQga2V5IHRvIHRoZSBjaGFpbgogICAgZWxzZSB7CiAgICAgICAgY2hhaW5zW2Jhc2VdLnB1c2goY3VyTm9kZS5pZCk7CiAgICB9CgogICAgLy8gaWYgdGhlIGN1cnJlbnQga2V5IGhhcyAxIGNoaWxkIHRvIHNlYXJjaCB0aHJvdWdoCiAgICBpZiAoY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPT0gMSkgeyAKICAgICAgICBfZ3RfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZS5jaGlsZHJlblswXSwgY2hhaW5zLCBiYXNlKTsKICAgIH0KCiAgICAvLyBvdGhlcndpc2UgZm9yIGVhY2ggY2hpbGQsIGNyZWF0ZSBhIGJsYW5rIGJhc2UgKHdpbGwgYmVjb21lIHRoYXQgY2hpbGQpCiAgICBlbHNlIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgX2d0X2dldExpbmVhclRyZWVTZWdtZW50cyhjdXJWaXpPYmosIGN1ck5vZGUuY2hpbGRyZW5baV0sIGNoYWlucywgIiIpOwogICAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gY2hhaW5zOwp9CgovKiBmdW5jdGlvbiB0byBoYW5kbGUgc2luZ2xlIGNlbGxzIHRoYXQgYXJlIG1pc3NpbmcgaGVhdG1hcCBkYXRhCiogLS0+IHN0b3JlIHRoZSBzaW5nbGUgY2VsbHMgbWlzc2luZyBoZWF0bWFwIGRhdGEgdGhhdCB3ZSBzaG91bGQgc3RpbGwgcGxvdCBpbiB0aGUgcGh5bG9nZW55IAoqICAgICAoT05MWSB0aG9zZSB3aG9zZSBkZXNjZW5kYW50cyBkbyBoYXZlIGhlYXRtYXAgZGF0YSkKKiAtLT4gcmVtb3ZlIGFueSBjZWxscyB0aGF0IGRvIG5vdCBoYXZlIGRhdGEtYXNzb2NpYXRlZCBkZXNjZW5kYW50cwoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKi8KZnVuY3Rpb24gX2hhbmRsZU1pc3NpbmdTY3MoY3VyVml6T2JqKSB7CiAgICAvLyBwbG90IHNpbmdsZSBjZWxscyB0aGF0IGRvbid0IGhhdmUgaGVhdG1hcCBkYXRhIE9OTFkgSUYgdGhlaXIgZGVzY2VuZGFudHMgZG8gaGF2ZSBoZWF0bWFwIGRhdGEKICAgIGN1clZpek9iai5kYXRhLm1pc3Npbmdfc2NzX3RvX3Bsb3QgPSBbXTsKICAgIGN1clZpek9iai5kYXRhLm1pc3Npbmdfc2NzX3RvX3JlbW92ZSA9IFtdOwogICAgY3VyVml6T2JqLnVzZXJDb25maWcuc2NzX21pc3NpbmdfZnJvbV9obS5mb3JFYWNoKGZ1bmN0aW9uKHNjX2lkKSB7CgogICAgICAgIC8vIGRlc2NlbmRhbnRzCiAgICAgICAgdmFyIGN1cl9kZXNjcyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltzY19pZF07CgogICAgICAgIC8vIGlmIGF0IGxlYXN0IG9uZSBvZiB0aGUgZGVzY2VuZGFudHMgaGF2ZSBoZWF0bWFwIGRhdGEsIGFkZCBpdCB0byB0aGUgbGlzdCBvZiBtaXNzaW5nIHNjcyB0byBwbG90CiAgICAgICAgdmFyIGN1cl9kZXNjc19taXNzaW5nX2RhdGEgPSBfZ2V0SW50ZXJzZWN0aW9uKGN1cl9kZXNjcywgY3VyVml6T2JqLnVzZXJDb25maWcuc2NzX21pc3NpbmdfZnJvbV9obSk7CiAgICAgICAgaWYgKGN1cl9kZXNjc19taXNzaW5nX2RhdGEubGVuZ3RoICE9IGN1cl9kZXNjcy5sZW5ndGgpIHsKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubWlzc2luZ19zY3NfdG9fcGxvdC5wdXNoKHNjX2lkKTsKICAgICAgICB9CgogICAgICAgIC8vIG90aGVyd2lzZSwgbWFyayB0aGUgbm9kZSBhcyByZW1vdmFibGUKICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS53YXJuKCJTaW5nbGUgY2VsbCAiICsgc2NfaWQgKyAiIHByZXNlbnQgaW4gdGhlIHBoeWxvZ2VueSwgYnV0IHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSAiICsgCiAgICAgICAgICAgICAgICAidmlldyBhcyBpdCBkb2VzIG5vdCBoYXZlIGhlYXRtYXAgZGF0YSwgbm9yIGRvIGFueSBvZiBpdHMgZGVzY2VuZGFudHMgaGF2ZSBoZWF0bWFwIGRhdGEuIikKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubWlzc2luZ19zY3NfdG9fcmVtb3ZlLnB1c2goc2NfaWQpOwogICAgICAgIH0KCiAgICB9KTsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSB5LWNvb3JkaW5hdGUgZm9yIGVhY2ggc2luZ2xlIGNlbGwKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9nZXRZQ29vcmRpbmF0ZXMoY3VyVml6T2JqKSB7CiAgICB2YXIgY29uZmlnID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWc7CiAgICAKICAgIGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlcyA9IHt9OyAvLyB5LWNvb3JkaW5hdGVzIGZvciBlYWNoIHNpbmdsZSBjZWxsIChlYWNoIHNpbmdsZSBjZWxsIGlkIGlzIGEgcHJvcGVydHkpCiAgICAKICAgIC8vIGtlZXAgdHJhY2sgb2Ygc2luZ2xlIGNlbGxzIHRoYXQgaGF2ZSBiZWVuIGFzc2lnbmVkCiAgICB2YXIgYXNzaWduZWRfc2NzID0gJC5leHRlbmQoW10sIGN1clZpek9iai5kYXRhLmhtX3NjX2lkcyk7CgogICAgLy8gaGVpZ2h0IG9mIGhlYXRtYXAgCiAgICB2YXIgaG1IZWlnaHQgPSAoY3VyVml6T2JqLnVzZXJDb25maWcuaGVhdG1hcF90eXBlID09ICJjbnYiKSA/IAogICAgICAgIChjb25maWcuaG1IZWlnaHQtY29uZmlnLmNocm9tTGVnZW5kSGVpZ2h0KSA6IGNvbmZpZy5obUhlaWdodDsKCiAgICAvLyBmb3IgZWFjaCBzaW5nbGUgY2VsbCBpbiB0aGUgaGVhdG1hcAogICAgY3VyVml6T2JqLmRhdGEuaG1fc2NfaWRzLmZvckVhY2goZnVuY3Rpb24oc2NfaWQsIHNjX2lkX2kpIHsKCiAgICAgICAgLy8gc3RhcnRpbmcgeS1jb29yZGluYXRlIGZvciB0aGlzIGlkCiAgICAgICAgY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzW3NjX2lkXSA9IAogICAgICAgICAgICBjb25maWcucGFkZGluZ0dlbmVyYWwgKyBjb25maWcuc3BhY2luZ0ZvclRpdGxlICsgKHNjX2lkX2kvY3VyVml6T2JqLnZpZXcuaG0ubnJvd3MpKmhtSGVpZ2h0OyAKICAgIH0pOwoKICAgIF9nZXRZQ29vcmRpbmF0ZXNMYXRlbnROb2RlcyhjdXJWaXpPYmosIGFzc2lnbmVkX3NjcywgY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzKTsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHkgY29vcmRpbmF0ZXMgZm9yIHRoZSBsYXRlbnQgbm9kZXMKKiBAcGFyYW0geUNvb3JkcyAtLSB5IGNvb3JkaW5hdGVzIGFzc2lnbmVkCiovCmZ1bmN0aW9uIF9nZXRZQ29vcmRpbmF0ZXNMYXRlbnROb2RlcyhjdXJWaXpPYiwgYXNzaWduZWRfc2NzLCB5Q29vcmRzKSB7CgogICAgLy8gc29ydCBzaW5nbGUgY2VsbHMgdy9vIGRhdGEgYnkgZGVzY2VuZGluZyBudW1iZXIgb2YgYW5jZXN0b3JzCiAgICB2YXIgbWlzc2luZ19zY3Nfc29ydGVkID0gW107CiAgICBjdXJWaXpPYmouZGF0YS5taXNzaW5nX3Njc190b19wbG90LmZvckVhY2goZnVuY3Rpb24oc2NfaWQpIHsKICAgICAgICBtaXNzaW5nX3Njc19zb3J0ZWQucHVzaCh7CiAgICAgICAgICAgIHNjX2lkOiBzY19pZCwKICAgICAgICAgICAgbl9hbmNlc3RvcnM6IGN1clZpek9iai5kYXRhLnRyZWVBbmNlc3RvcnNBcnJbc2NfaWRdLmxlbmd0aAogICAgICAgIH0pOwogICAgfSk7CgogICAgX3NvcnRCeUtleShtaXNzaW5nX3Njc19zb3J0ZWQsICJuX2FuY2VzdG9ycyIpOyAKICAgIG1pc3Npbmdfc2NzX3NvcnRlZC5yZXZlcnNlKCk7CgogICAgLy8gZm9yIGVhY2ggc2luZ2xlIGNlbGwgdGhhdCBkb2Vzbid0IGhhdmUgaGVhdG1hcCBkYXRhCiAgICBtaXNzaW5nX3Njc19zb3J0ZWQuZm9yRWFjaChmdW5jdGlvbihzYywgc2NfaWRfaSkgewogICAgICAgIHZhciB5X2Nvb3JkaW5hdGVzX29mX2RpcmVjdF9kZXNjZW5kYW50cyA9IFtdOwogICAgICAgIHZhciBjdXJfZGlyZWN0X2Rlc2NlbmRhbnRzID0gLy8gZGlyZWN0IGRlc2NlbmRhbnRzIGFscmVhZHkgYXNzaWduZWQgYSB5LWNvb3JkaW5hdGUKICAgICAgICAgICAgX2dldEludGVyc2VjdGlvbihjdXJWaXpPYmouZGF0YS5kaXJlY3RfZGVzY2VuZGFudHNbc2Muc2NfaWRdLCBhc3NpZ25lZF9zY3MpOwogICAgICAgIHZhciBjdXJfZGlyZWN0X2FuY2VzdG9yID0gLy8gZGlyZWN0IGFuY2VzdG9ycyBhbHJlYWR5IGFzc2lnbmVkIGEgeS1jb29yZGluYXRlCiAgICAgICAgICAgIF9nZXRJbnRlcnNlY3Rpb24oW2N1clZpek9iai5kYXRhLmRpcmVjdF9hbmNlc3RvcnNbc2Muc2NfaWRdXSwgYXNzaWduZWRfc2NzKTsKICAgICAgICAKICAgICAgICAvLyBpZiB0aGUgY2VsbCBoYXMgZGVzY2VuZGFudHMgd2l0aCB5LWNvb3JkaW5hdGVzIGFscmVhZHkgYXNzaWduZWQKICAgICAgICBpZiAoY3VyX2RpcmVjdF9kZXNjZW5kYW50cy5sZW5ndGggPiAwKSB7CgogICAgICAgICAgICAvLyBmb3IgZWFjaCBvZiBpdHMgZGlyZWN0IGRlc2NlbmRhbnRzLCBnZXQgdGhlIHktY29vcmRpbmF0ZQogICAgICAgICAgICBjdXJfZGlyZWN0X2Rlc2NlbmRhbnRzLmZvckVhY2goZnVuY3Rpb24oZGVzYykgewogICAgICAgICAgICAgICAgaWYgKHlDb29yZHNbZGVzY10pIHsKICAgICAgICAgICAgICAgICAgICB5X2Nvb3JkaW5hdGVzX29mX2RpcmVjdF9kZXNjZW5kYW50cy5wdXNoKHlDb29yZHNbZGVzY10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIHNldCB0aGUgeS1jb29yZGluYXRlIGZvciB0aGlzIGxhdGVudCBzaW5nbGUgY2VsbCB0byBiZSAKICAgICAgICAgICAgLy8gdGhlIG1pZHBvaW50IGJldHdlZW4gdGhlIG1pbiBhbmQgbWF4IHktY29vcmRpbmF0ZXMgb2YgdGhlc2UgZGlyZWN0IGRlc2NlbmRhbnRzCiAgICAgICAgICAgIHZhciBtaW5feSA9IE1hdGgubWluLmFwcGx5KE1hdGgsIHlfY29vcmRpbmF0ZXNfb2ZfZGlyZWN0X2Rlc2NlbmRhbnRzKTsKICAgICAgICAgICAgdmFyIG1heF95ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgeV9jb29yZGluYXRlc19vZl9kaXJlY3RfZGVzY2VuZGFudHMpOwogICAgICAgICAgICB2YXIgbWlkX3kgPSAobWluX3kgKyBtYXhfeSkvMjsKICAgICAgICAgICAgeUNvb3Jkc1tzYy5zY19pZF0gPSBtaWRfeTsgIAogICAgICAgIH0KCiAgICAgICAgLy8gaWYgdGhlIGNlbGwgaGFzIGFuIGFuY2VzdG9yIHdpdGggeS1jb29yZGluYXRlcyBhbHJlYWR5IGFzc2lnbmVkCiAgICAgICAgZWxzZSBpZiAoY3VyX2RpcmVjdF9hbmNlc3Rvci5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIC8vIHNldCB0aGUgeS1jb29yZGluYXRlIG9mIHRoaXMgbGF0ZW50IHNpbmdsZSBjZWxsIHRvIGJlCiAgICAgICAgICAgIC8vIHRoZSB5IGNvb3JkaW5hdGUgb2YgaXRzIGFuY2VzdG9yCiAgICAgICAgICAgIHlDb29yZHNbc2Muc2NfaWRdID0geUNvb3Jkc1tjdXJfZGlyZWN0X2FuY2VzdG9yXTsgCiAgICAgICAgfQoKICAgICAgICAvLyB0aGUgY2VsbCBtdXN0IGJlIGEgbGF0ZW50IHJvb3Qgbm9kZQogICAgICAgIGVsc2UgewogICAgICAgICAgICB5Q29vcmRzW3NjLnNjX2lkXSA9IGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIChobUhlaWdodC8yKTsKICAgICAgICB9CgogICAgICAgIC8vIG1hcmsgdGhpcyBjZWxsIGFzIGFzc2lnbmVkIHRvIGEgeS1jb29yZGluYXRlCiAgICAgICAgYXNzaWduZWRfc2NzLnB1c2goc2Muc2NfaWQpOwoKICAgIH0pOwp9CgoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSB4LWNvb3JkaW5hdGUgZm9yIGVhY2ggc2luZ2xlIGNlbGwgaW4gdGhlIHRyZWUKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9nZXRYQ29vcmRpbmF0ZXMoY3VyVml6T2JqKSB7CiAgICB2YXIgY29uZmlnID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWc7CgogICAgLy8gcmFkaXVzIG9mIG5vZGVzCiAgICB2YXIgciA9IChjdXJWaXpPYmoudXNlckNvbmZpZy5kaXNwbGF5X25vZGVfaWRzKSA/IGNvbmZpZy50cmVlX3dfbGFiZWxzX3IgOiBjb25maWcudHJlZV9yOwogICAgCiAgICAvLyB4LWNvb3JkaW5hdGVzIGZvciBlYWNoIHNpbmdsZSBjZWxsIChlYWNoIHNpbmdsZSBjZWxsIGlkIGlzIGEgcHJvcGVydHkpCiAgICBjdXJWaXpPYmouZGF0YS54Q29vcmRpbmF0ZXMgPSB7fTsgCiAgICBjdXJWaXpPYmouZGF0YS54Q29vcmRpbmF0ZXNEaXN0ID0ge307IC8vIHggY29vcmRpbmF0ZXMgd2l0aCBkaXN0YW5jZXMgdGFrZW4gaW50byBhY2NvdW50CgogICAgLy8gZm9yIGVhY2ggc2luZ2xlIGNlbGwgaW4gdGhlIHRyZWUKICAgIGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfbm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBzY19pZF9pKSB7CgogICAgICAgIC8vIHdpZHRoIG9mIHRyZWUgCiAgICAgICAgdmFyIHRyZWVXaWR0aCA9IGNvbmZpZy50cmVlV2lkdGggLSA0KnI7IC8vIHNwYWNpbmcgb2Ygb25lIHJhZGl1cyBiZWZvcmUgYW5kIGFmdGVyCiAgICAgICAgdmFyIHNwYWNlQmVmb3JlU3RhcnQgPSAyKnI7IC8vIHNwYWNlIGJlZm9yZSB0aGUgZmlyc3QgeC1jb29yZGluYXRlCgogICAgICAgIC8vIG51bWJlciBvZiBhbmNlc3RvcnMgZm9yIHRoaXMgc2luZ2xlIGNlbGwKICAgICAgICB2YXIgbl9hbmNlc3RvcnMgPSBjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyW25vZGUuc2NfaWRdLmxlbmd0aDsKCiAgICAgICAgLy8gc3RhcnRpbmcgeC1jb29yZGluYXRlIGZvciB0aGlzIHNpbmdsZSBjZWxsCiAgICAgICAgY3VyVml6T2JqLmRhdGEueENvb3JkaW5hdGVzW25vZGUuc2NfaWRdID0gCiAgICAgICAgICAgIHNwYWNlQmVmb3JlU3RhcnQgKyAodHJlZVdpZHRoLyhjdXJWaXpPYmouZGF0YS50cmVlX2hlaWdodC0xKSkgKiBuX2FuY2VzdG9yczsgCgogICAgICAgIC8vIGlmIHRoZXJlIGlzIGRpc3RhbmNlIGluZm8gZm9yIGVhY2ggZWRnZQogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5kaXN0YW5jZXNfcHJvdmlkZWQpIHsKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEueENvb3JkaW5hdGVzRGlzdFtub2RlLnNjX2lkXSA9IAogICAgICAgICAgICAgICAgc3BhY2VCZWZvcmVTdGFydCArIChjdXJWaXpPYmouZGF0YS5wYXRoRGlzdHNbbm9kZS5zY19pZF0gLyBjdXJWaXpPYmouZGF0YS5tYXhfdHJlZV9wYXRoX2Rpc3QpKnRyZWVXaWR0aDsKICAgICAgICB9CiAgICB9KTsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBsaW5rIGlkIGZvciBhIGxpbmsgZGF0YSBvYmplY3QKKiBAcGFyYW0ge09iamVjdH0gZCAtIGxpbmsgZGF0YSBvYmplY3QKKi8KZnVuY3Rpb24gX2dldExpbmtJZChkKSB7CiAgIHJldHVybiAibGlua18iICsgZC5zb3VyY2Uuc2NfaWQgKyAiXyIgKyBkLnRhcmdldC5zY19pZDsKfQoKLyogZnVuY3Rpb24gZm9yIG1vdXNlb3V0IG9mIGxpbmsKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiogQHBhcmFtIHtCb29sZWFufSByZXNldFNlbGVjdGVkU0NMaXN0IC0tIHdoZXRoZXIgb3Igbm90IHRvIHJlc2V0IHRoZSBzZWxldGVkIHNjIGxpc3QKKi8KZnVuY3Rpb24gX2xpbmtNb3VzZW91dChjdXJWaXpPYmosIHJlc2V0U2VsZWN0ZWRTQ0xpc3QpIHsKICAgIC8vIGlmIHRoZXJlJ3Mgbm8gbm9kZSBvciBsaW5rIHNlbGVjdGlvbiB0YWtpbmcgcGxhY2UsIG9yIHNjaXNzb3JzIHRvb2wgb24sIHJlc2V0IHRoZSBsaW5rcwogICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpIHx8IGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIuc2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgLy8gcmVzZXQgbm9kZXMgJiBpbmRpY2F0b3JzCiAgICAgICAgX3Jlc2V0U2luZ2xlQ2VsbHMoY3VyVml6T2JqLnZpZXdfaWQpOwogICAgICAgIF9yZXNldEluZGljYXRvcnMoY3VyVml6T2JqLnZpZXdfaWQpOwoKICAgICAgICAvLyByZXNldCBsaW5rcwogICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIubGluayIpCiAgICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kZWZhdWx0TGlua0NvbG91cik7CgogICAgICAgIC8vIHJlc2V0IGxpc3Qgb2Ygc2VsZWN0ZWQgY2VsbHMgJiBsaW5rcwogICAgICAgIGlmIChyZXNldFNlbGVjdGVkU0NMaXN0KSB7CiAgICAgICAgICAgIGN1clZpek9iai52aWV3LnNlbGVjdGVkU0NzID0gW107CiAgICAgICAgICAgIGN1clZpek9iai52aWV3LnNlbGVjdGVkTGlua3MgPSBbXTsKICAgICAgICB9CiAgICB9Cn0KCi8qIGZ1bmN0aW9uIGZvciBtb3VzZW92ZXIgb2YgbGluawoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKiBAcGFyYW0ge1N0cmluZ30gbGlua19pZCAtLSBpZCBmb3IgbW91c2Vkb3ZlciBsaW5rCiovCmZ1bmN0aW9uIF9saW5rTW91c2VvdmVyKGN1clZpek9iaiwgbGlua19pZCkgewogICAgLy8gaWYgdGhlcmUncyBubyBub2RlIG9yIGxpbmsgc2VsZWN0aW9uIHRha2luZyBwbGFjZQogICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpKSB7CiAgICAgICAgLy8gdHVybiBvZmYgYWxsIHNpbmdsZSBjZWxscwogICAgICAgIF9pbmFjdGl2YXRlU2luZ2xlQ2VsbHMoY3VyVml6T2JqLnZpZXdfaWQpOwogICAgICAgIC8vIGhpZ2hsaWdodCBkb3duc3RyZWFtIGxpbmtzCiAgICAgICAgX2Rvd25zdHJlYW1FZmZlY3RzKGN1clZpek9iaiwgbGlua19pZCk7ICAgICAgICAgICAgICAgICAgICAgCiAgICB9CiAgICAvLyBpZiBzY2lzc29ycyBidXR0b24gaXMgc2VsZWN0ZWQKICAgIGVsc2UgaWYgKGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIuc2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CgogICAgICAgIC8vIHJlc2V0IGxpc3RzIG9mIHNlbGVjdGVkIGxpbmtzIGFuZCBzY3MKICAgICAgICBjdXJWaXpPYmoudmlldy5zZWxlY3RlZFNDcyA9IFtdOwogICAgICAgIGN1clZpek9iai52aWV3LnNlbGVjdGVkTGlua3MgPSBbXTsKCiAgICAgICAgLy8gdHVybiBvZmYgYWxsIHNpbmdsZSBjZWxscwogICAgICAgIF9pbmFjdGl2YXRlU2luZ2xlQ2VsbHMoY3VyVml6T2JqLnZpZXdfaWQpOwogICAgICAgIC8vIGhpZ2hsaWdodCBkb3duc3RyZWFtIGxpbmtzCiAgICAgICAgX2Rvd25zdHJlYW1FZmZlY3RzKGN1clZpek9iaiwgbGlua19pZCk7IAoKICAgICAgICAvLyBoaWdobGlnaHQgdGhlIHBvdGVudGlhbGx5LWN1dCBsaW5rIHJlZAogICAgICAgIGlmIChjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5zd2l0Y2hWaWV3KSB7IC8vIHRyZWUgdmlldyBpcyBvbgogICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnRyZWUuIitsaW5rX2lkKQogICAgICAgICAgICAgICAgLmF0dHIoInN0cm9rZSIsICJyZWQiKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7IC8vIGdyYXBoIHZpZXcgaXMgb24KICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5ncmFwaC4iK2xpbmtfaWQpCiAgICAgICAgICAgICAgICAuYXR0cigic3Ryb2tlIiwgInJlZCIpOwogICAgICAgIH0KICAgIH0KfQoKLyogZnVuY3Rpb24gZm9yIGNsaWNrZWQgbGluayAodHJlZSB0cmltbWluZykKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiogQHBhcmFtIHtTdHJpbmd9IGxpbmtfaWQgLS0gaWQgZm9yIGNsaWNrZWQgbGluawoqLwpmdW5jdGlvbiBfbGlua0NsaWNrKGN1clZpek9iaiwgbGlua19pZCkgewogICAgdmFyIHVzZXJDb25maWcgPSBjdXJWaXpPYmoudXNlckNvbmZpZywKICAgICAgICBpbmRleF9saW5rLAogICAgICAgIGluZGV4X2htLAogICAgICAgIGluZGV4X25vdF9obTsKCiAgICAvLyBpZiBzY2lzc29ycyBidXR0b24gaXMgc2VsZWN0ZWQKICAgIGlmIChkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLnNjaXNzb3JzQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT0gMSkgewoKICAgICAgICAvLyBrZWVwIHRyYWNrIG9mIHRoZSB5LWNvb3JkaW5hdGUgYm91bmRhcmllcyBmb3IgdGhlIHJlbW92ZWQgc2luZ2xlIGNlbGxzCiAgICAgICAgdmFyIG1heF95ID0gLUluZmluaXR5OwogICAgICAgIHZhciBtaW5feSA9IEluZmluaXR5OwoKICAgICAgICAvLyBmb3IgZWFjaCBsaW5rCiAgICAgICAgY3VyVml6T2JqLnZpZXcuc2VsZWN0ZWRMaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGxpbmtfaWQpIHsKICAgICAgICAgICAgLy8gcmVtb3ZlIGxpbmsKICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi4iICsgbGlua19pZCkucmVtb3ZlKCk7CgogICAgICAgICAgICAvLyByZW1vdmUgbGluayBmcm9tIGxpc3Qgb2YgbGlua3MKICAgICAgICAgICAgaW5kZXhfbGluayA9IHVzZXJDb25maWcubGlua19pZHMuaW5kZXhPZihsaW5rX2lkKTsKICAgICAgICAgICAgdXNlckNvbmZpZy5saW5rX2lkcy5zcGxpY2UoaW5kZXhfbGluaywgMSk7CiAgICAgICAgfSk7CiAgICAgICAgLy8gZm9yIGVhY2ggc2luZ2xlIGNlbGwKICAgICAgICBjdXJWaXpPYmoudmlldy5zZWxlY3RlZFNDcy5mb3JFYWNoKGZ1bmN0aW9uKHNjX2lkKSB7CgogICAgICAgICAgICAvLyBnZXQgdGhlIHktY29vcmRpbmF0ZSBmb3IgdGhpcyBzaW5nbGUgY2VsbAogICAgICAgICAgICB2YXIgb3JpZ2luYWxfeSA9IHBhcnNlRmxvYXQoZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGVfIiArIHNjX2lkKS5hdHRyKCJjeSIpKTsKICAgICAgICAgICAgdmFyIHRfeSA9IF9nZXRUcmVlTm9kZVlUcmFuc2xhdGlvbihjdXJWaXpPYmoudmlld19pZCwgc2NfaWQpOyAKICAgICAgICAgICAgdmFyIGN1cl95ID0gb3JpZ2luYWxfeSArIHRfeTsKICAgICAgICAgICAgaWYgKGN1cl95ID4gbWF4X3kpIHsgCiAgICAgICAgICAgICAgICBtYXhfeSA9IGN1cl95OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjdXJfeSA8IG1pbl95KSB7CiAgICAgICAgICAgICAgICBtaW5feSA9IGN1cl95OwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZW1vdmUgdGhlIHNpbmdsZSBjZWxsIGluIHRoZSB2aWV3CiAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIubm9kZV8iICsgc2NfaWQpLnJlbW92ZSgpOyAvLyByZW1vdmUgbm9kZSBpbiB0cmVlIGFuZCBncmFwaAogICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLm5vZGVMYWJlbF8iICsgc2NfaWQpLnJlbW92ZSgpOyAvLyByZW1vdmUgbm9kZSBsYWJlbHMKICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5ncmlkQ2VsbEcuc2NfIiArIHNjX2lkKS5yZW1vdmUoKTsgLy8gcmVtb3ZlIGNvcHkgbnVtYmVyIHByb2ZpbGUKICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5ndHlwZUFubm90LnNjXyIgKyBzY19pZCkucmVtb3ZlKCk7IC8vIHJlbW92ZSBnZW5vdHlwZSBhbm5vdGF0aW9uCiAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIudHBBbm5vdC5zY18iICsgc2NfaWQpLnJlbW92ZSgpOyAvLyByZW1vdmUgdGltZXBvaW50IGFubm90YXRpb24KICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5pbmRpYy5zY18iICsgc2NfaWQpLnJlbW92ZSgpOyAvLyByZW1vdmUgaW5kaWNhdG9yCgoKICAgICAgICAgICAgLy8gcmVtb3ZlIHNpbmdsZSBjZWxsIGZyb20gbGlzdCBvZiBzaW5nbGUgY2VsbHMgaW4gaGVhdG1hcAogICAgICAgICAgICBpbmRleF9obSA9IGN1clZpek9iai5kYXRhLmhtX3NjX2lkcy5pbmRleE9mKHNjX2lkKTsKICAgICAgICAgICAgaWYgKGluZGV4X2htICE9IC0xKSB7CiAgICAgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS5obV9zY19pZHMuc3BsaWNlKGluZGV4X2htLCAxKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyByZW1vdmUgc2luZ2xlIGNlbGwgZnJvbSBsaXN0IG9mIHNpbmdsZSBjZWxscyBOT1QgaW4gaGVhdG1hcAogICAgICAgICAgICBpbmRleF9ub3RfaG0gPSBjdXJWaXpPYmouZGF0YS5taXNzaW5nX3Njc190b19wbG90LmluZGV4T2Yoc2NfaWQpOwogICAgICAgICAgICBpZiAoaW5kZXhfbm90X2htICE9IC0xKSB7CiAgICAgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS5taXNzaW5nX3Njc190b19wbG90LnNwbGljZShpbmRleF9ub3RfaG0sIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyByZW1vdmUgc2luZ2xlIGNlbGwgZnJvbSB0cmVlIGFuY2VzdG9ycyAvIGRlc2NlbmRhbnRzIGFycmF5cwogICAgICAgICAgICBkZWxldGUgY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FycltzY19pZF07CiAgICAgICAgICAgIGRlbGV0ZSBjdXJWaXpPYmouZGF0YS5kaXJlY3RfYW5jZXN0b3JzW3NjX2lkXTsKICAgICAgICAgICAgZGVsZXRlIGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltzY19pZF07CiAgICAgICAgICAgIGRlbGV0ZSBjdXJWaXpPYmouZGF0YS5kaXJlY3RfZGVzY2VuZGFudHNbc2NfaWRdOwogICAgICAgICAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgICB2YXIgY3VyX2Rlc2NzID0gY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyW2tleV07CiAgICAgICAgICAgICAgICB2YXIgY3VyX2kgPSBjdXJfZGVzY3MuaW5kZXhPZihzY19pZCk7CiAgICAgICAgICAgICAgICBpZiAoY3VyX2kgPiAtMSkgewogICAgICAgICAgICAgICAgICAgIGN1cl9kZXNjcy5zcGxpY2UoY3VyX2ksIDEpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgT2JqZWN0LmtleXMoY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgdmFyIGN1cl9kZXNjcyA9IGN1clZpek9iai5kYXRhLmRpcmVjdF9kZXNjZW5kYW50c1trZXldOwogICAgICAgICAgICAgICAgdmFyIGN1cl9pID0gY3VyX2Rlc2NzLmluZGV4T2Yoc2NfaWQpOwogICAgICAgICAgICAgICAgaWYgKGN1cl9pID4gLTEpIHsKICAgICAgICAgICAgICAgICAgICBjdXJfZGVzY3Muc3BsaWNlKGN1cl9pLCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyByZW1vdmUgc2luZ2xlIGNlbGwgZnJvbSB5LSBhbmQgeC1jb29yZGluYXRlcyBsaXN0cwogICAgICAgICAgICBkZWxldGUgY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzW3NjX2lkXTsKICAgICAgICAgICAgZGVsZXRlIGN1clZpek9iai5kYXRhLnhDb29yZGluYXRlc1tzY19pZF07CiAgICAgICAgICAgIGRlbGV0ZSBjdXJWaXpPYmouZGF0YS54Q29vcmRpbmF0ZXNEaXN0W3NjX2lkXTsKICAgICAgICB9KTsKCiAgICAgICAgLy8gaGVpZ2h0IG9mIHJlbW92ZWQgY2VsbHMgKCsgMSByb3cgZm9yIHRoZSB0d28gcm93IGhhbHZlcyBvbiBlaXRoZXIgc2lkZSkKICAgICAgICB2YXIgcmVtb3ZhbF9oZWlnaHQgPSAobWF4X3ktbWluX3kpICsgY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0OwoKICAgICAgICAvLyByZXNldCBzaW5nbGUgY2VsbHMKICAgICAgICBfcmVzZXRTaW5nbGVDZWxscyhjdXJWaXpPYmoudmlld19pZCk7CgogICAgICAgIC8vIGFkanVzdCBjb3B5IG51bWJlciBtYXRyaXggdG8gZmlsbCB0aGUgZW50aXJlIHNwYWNlCiAgICAgICAgZDMudGltZXIoX3VwZGF0ZVRyaW1tZWRNYXRyaXgoY3VyVml6T2JqLCByZW1vdmFsX2hlaWdodCwgbWF4X3ksICQuZXh0ZW5kKFtdLGN1clZpek9iai52aWV3LnNlbGVjdGVkU0NzKSksIDMwMCk7CgogICAgICAgIC8vIHJlc2V0IGxpc3RzIG9mIHNlbGVjdGVkIGxpbmtzIGFuZCBzZWxlY3RlZCBzaW5nbGUgY2VsbHMKICAgICAgICBjdXJWaXpPYmoudmlldy5zZWxlY3RlZExpbmtzID0gW107CiAgICAgICAgY3VyVml6T2JqLnZpZXcuc2VsZWN0ZWRTQ3MgPSBbXTsKICAgIH0KfQoKLyogcmVjdXJzaXZlIGZ1bmN0aW9uIHRvIHBlcmZvcm0gZG93bnN0cmVhbSBlZmZlY3RzIHVwb24gdHJlZSBsaW5rIGhpZ2hsaWdodGluZwoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKiBAcGFyYW0gbGlua19pZCAtLSBpZCBmb3IgdGhlIGxpbmsgdGhhdCdzIGN1cnJlbnRseSBoaWdobGlnaHRlZAoqLwpmdW5jdGlvbiBfZG93bnN0cmVhbUVmZmVjdHMoY3VyVml6T2JqLCBsaW5rX2lkKSB7CgogICAgLy8gZ2V0IHRhcmdldCBpZCAmIHNpbmdsZSBjZWxsIGlkCiAgICB2YXIgdGFyZ2V0UlggPSBuZXcgUmVnRXhwKCJsaW5rX3NvdXJjZV8uK190YXJnZXRfKC4rKSIpOyAgCiAgICB2YXIgdGFyZ2V0X2lkID0gdGFyZ2V0UlguZXhlYyhsaW5rX2lkKVsxXTsKCiAgICAvLyBhZGQgdGhpcyB0YXJnZXQgc2MgYW5kIGxpbmsgaWQgdG8gdGhlIGxpc3RzIG9mIHNlbGVjdGVkIHNjcyBhbmQgbGlua3MKICAgIGN1clZpek9iai52aWV3LnNlbGVjdGVkU0NzLnB1c2godGFyZ2V0X2lkKTsKICAgIGN1clZpek9iai52aWV3LnNlbGVjdGVkTGlua3MucHVzaChsaW5rX2lkKTsKCiAgICAvLyBoaWdobGlnaHQgbm9kZSAmIGl0cyBpbmRpY2F0b3IKICAgIF9oaWdobGlnaHRTaW5nbGVDZWxsKHRhcmdldF9pZCwgY3VyVml6T2JqLnZpZXdfaWQpOwogICAgX2hpZ2hsaWdodEluZGljYXRvcih0YXJnZXRfaWQsIGN1clZpek9iai52aWV3X2lkKTsKCiAgICAvLyBnZXQgdGhlIHRhcmdldHMgb2YgdGhpcyB0YXJnZXQKICAgIHZhciBzb3VyY2VSWCA9IG5ldyBSZWdFeHAoImxpbmtfc291cmNlXyIgKyB0YXJnZXRfaWQgKyAiX3RhcmdldF8oLispIik7CiAgICB2YXIgdGFyZ2V0TGlua3Nfb2ZfdGFyZ2V0Tm9kZSA9IFtdOwogICAgY3VyVml6T2JqLnVzZXJDb25maWcubGlua19pZHMubWFwKGZ1bmN0aW9uKGlkKSB7CiAgICAgICAgaWYgKGlkLm1hdGNoKHNvdXJjZVJYKSkgewogICAgICAgICAgICB0YXJnZXRMaW5rc19vZl90YXJnZXROb2RlLnB1c2goaWQpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIGZvciBlYWNoIG9mIHRoZSB0YXJnZXQncyB0YXJnZXRzLCBoaWdobGlnaHQgdGhlaXIgZG93bnN0cmVhbSBsaW5rcwogICAgdGFyZ2V0TGlua3Nfb2ZfdGFyZ2V0Tm9kZS5tYXAoZnVuY3Rpb24odGFyZ2V0X2xpbmtfaWQpIHsKICAgICAgICBfZG93bnN0cmVhbUVmZmVjdHMoY3VyVml6T2JqLCB0YXJnZXRfbGlua19pZCk7CiAgICB9KTsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IG9yZGVyIG9mIHRyZWUgbm9kZXMKKiBAcGFyYW0ge09iamVjdH0gZGVzY2VuZGFudHMgLS0gZGVzY2VuZGFudHMgZm9yIGVhY2ggbm9kZQoqIHBhcmFtIGxpbmtfaWRzIC0tIGlkcyBmb3IgYWxsIGxpbmtzIGluIHRyZWUKKiBwYXJhbSBub2RlX25hbWUgLS0gdGhlIG5hbWUgb2YgdGhlIGN1cnJlbnQgbm9kZSAtIHN0YXJ0IHdpdGggcm9vdAoqIHBhcmFtIG5vZGVPcmRlciAtLSBhcnJheSBvZiBub2RlIG9yZGVyIC0gc3RhcnRzIGVtcHR5LCBhcHBlbmRlZCB0byBhcyBmdW5jdGlvbiBleGVjdXRlcwoqLwpmdW5jdGlvbiBfZ2V0Tm9kZU9yZGVyKGRlc2NlbmRhbnRzLCBsaW5rX2lkcywgbm9kZV9uYW1lLCBub2RlT3JkZXIpIHsKCiAgICAvLyBnZXQgdGhlIHRhcmdldHMgb2YgdGhpcyBub2RlCiAgICB2YXIgdGFyZ2V0UlggPSBuZXcgUmVnRXhwKCJsaW5rX3NvdXJjZV8iICsgbm9kZV9uYW1lICsgIl90YXJnZXRfKC4rKSIpOwogICAgdmFyIHRhcmdldHMgPSBbXTsKICAgIGxpbmtfaWRzLm1hcChmdW5jdGlvbihpZCkgewogICAgICAgIGlmIChpZC5tYXRjaCh0YXJnZXRSWCkpIHsKICAgICAgICAgICAgdmFyIGN1cl90YXJnZXQgPSB0YXJnZXRSWC5leGVjKGlkKVsxXTsKICAgICAgICAgICAgdGFyZ2V0cy5wdXNoKHsgInNjX2lkIjogY3VyX3RhcmdldCwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICJuX2Rlc2MiOiBkZXNjZW5kYW50c1tjdXJfdGFyZ2V0XS5sZW5ndGggfSk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gaWYgdGhlcmUgYXJlIG5vIHRhcmdldHMsIGFwcGVuZCB0aGUgY3VycmVudCBub2RlIHRvIHRoZSBub2RlIG9yZGVyIGFycmF5CiAgICBpZiAodGFyZ2V0cy5sZW5ndGggPT09IDApIHsKICAgICAgICBub2RlT3JkZXIucHVzaChub2RlX25hbWUpOwogICAgfQogICAgLy8gdGhlcmUgYXJlIHRhcmdldHMKICAgIGVsc2UgewogICAgICAgIC8vIG9yZGVyIHRoZSB0YXJnZXRzIGJ5IGhvdyBtYW55IGRlc2NlbmRhbnRzIHRoZXkgaGF2ZQogICAgICAgIF9zb3J0QnlLZXkodGFyZ2V0cywgIm5fZGVzYyIpOwoKICAgICAgICAvLyBmb3IgZWFjaCBvZiB0aGUgdGFyZ2V0cwogICAgICAgIHRhcmdldHMubWFwKGZ1bmN0aW9uKHRhcmdldCwgdGFyZ2V0X2kpIHsKICAgICAgICAgICAgLy8gaWYgd2UncmUgYXQgdGhlIG1pZGRsZSB0YXJnZXQsIGFwcGVuZCB0aGUgY3VycmVudCBub2RlIHRvIHRoZSBub2RlIG9yZGVyIGFycmF5CiAgICAgICAgICAgIGlmICh0YXJnZXRfaSA9PSBNYXRoLmZsb29yKHRhcmdldHMubGVuZ3RoLzIpKSB7CiAgICAgICAgICAgICAgICBub2RlT3JkZXIucHVzaChub2RlX25hbWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGdldCB0YXJnZXRzIG9mIHRoaXMgdGFyZ2V0CiAgICAgICAgICAgIF9nZXROb2RlT3JkZXIoZGVzY2VuZGFudHMsIGxpbmtfaWRzLCB0YXJnZXQuc2NfaWQsIG5vZGVPcmRlcik7CiAgICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIG5vZGVPcmRlcjsKIH0KCi8qIGZ1bmN0aW9uIHRvIGdldCBmb250IHNpemUgZm9yIGxhYmVscywgZ2l2ZW4gdGhlaXIgY29udGVudCB0aGUgc2l6ZSBvZiB0aGUgbm9kZXMgdGhhdCBjb250YWluIHRoZW0KKiBAcGFyYW0ge0FycmF5fSBsYWJlbHMgLS0gYXJyYXkgb2Ygbm9kZSBsYWJlbHMKKiBAcGFyYW0ge051bWJlcn0gd2lkdGggLS0gd2lkdGggb2Ygc3ZnIGVsZW1lbnQgdGhhdCB3aWxsIGNvbnRhaW4gdGhlIGxhYmVsCiovCmZ1bmN0aW9uIF9nZXRMYWJlbEZvbnRTaXplKGxhYmVscywgd2lkdGgpIHsKCiAgICAvLyBmaW5kIHRoZSBsb25nZXN0IG5vZGUgbGFiZWwgKGluIHRlcm1zIG9mICMgY2hhcmFjdGVycykKICAgIHZhciBtYXhfbl9jaGFycyA9IDA7CiAgICBsYWJlbHMuZm9yRWFjaChmdW5jdGlvbihsYWJlbCkgewogICAgICAgIC8vIHBhcnNlIGludGVnZXIgKGlmIHRoZSBsYWJlbCBpcyBhbiBpbnRlZ2VyKSB0byByZW1vdmUgbGVhZGluZyB6ZXJvcwogICAgICAgIHZhciBsYWJlbF9wYXJzZWRfaW50ID0gcGFyc2VJbnQobGFiZWwsIDEwKTsgCgogICAgICAgIC8vIG51bWJlciBvZiBjaGFyYWN0ZXJzIGluIHRoZSBsYWJlbAogICAgICAgIHZhciBuX2NoYXJzID0gKCFpc05hTihsYWJlbF9wYXJzZWRfaW50KSkgPyBsYWJlbF9wYXJzZWRfaW50LnRvU3RyaW5nKCkubGVuZ3RoIDogbGFiZWwubGVuZ3RoOwoKICAgICAgICAvLyB1cGRhdGUgbWF4IGxhYmVsIGxlbmd0aCAoIyBjaGFyYWN0ZXJzKQogICAgICAgIGlmIChuX2NoYXJzID4gbWF4X25fY2hhcnMpIHsKICAgICAgICAgICAgbWF4X25fY2hhcnMgPSBuX2NoYXJzOyAKICAgICAgICB9CiAgICB9KTsKCiAgICAvLyBnZXQgZm9udCBzaXplLCBnaXZlbiBsb25nZXN0IG5vZGUgbGFiZWwgKDQgcGl4ZWxzIHBlciBjaGFyYWN0ZXIpCiAgICB2YXIgYXNwZWN0X3JhdGlvID0gNy80OyAvLyBmb250IGFzcGVjdCByYXRpbyBvZiAoZm9udCBoZWlnaHQgLyBmb250IHdpZHRoKQogICAgdmFyIGZvbnRfc2l6ZSA9ICh3aWR0aCAtIDIpIC8gbWF4X25fY2hhcnMgKiBhc3BlY3RfcmF0aW87CgogICAgcmV0dXJuIGZvbnRfc2l6ZTsKfQoKLyogZnVuY3Rpb24gdG8gcmV0cmlldmUgYSBzaW5nbGUgY2VsbCdzIGRlc2NlbmRhbnQgdHJlZSBzdHJ1Y3R1cmUgb2JqZWN0IGJ5IGl0cyBpbmRleCwgCiogb3IgY3JlYXRlIHRoZSBzaW5nbGUgY2VsbCBhcyBhIG5ldyByb290IG9mIGEgdHJlZSBpZiBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3QKKiBAcGFyYW0ge1N0cmluZ30gc2NfaWQgLS0gaWQgb2YgdGhlIHNpbmdsZSBjZWxsCiogQHBhcmFtIHtBcnJheX0gbm9kZXMgLS0gbm9kZXMgZnJvbSB3aGljaCB0byBzZWFyY2ggZm9yIG5vZGUgb2YgaW50ZXJlc3QKKi8KZnVuY3Rpb24gX3JldHJpZXZlU0NUcmVlKHNjX2lkLCBub2RlcykgewogICB2YXIgZm91bmROb2RlID0gXy5maW5kV2hlcmUobm9kZXMsIHtzY19pZDogc2NfaWR9KTsKICAgaWYgKCFmb3VuZE5vZGUpIHsKICAgICAgbm9kZXMucHVzaCh7Y2hpbGRyZW46IFtdLCBuYW1lOiBzY19pZCwgc2NfaWQ6IHNjX2lkfSk7CiAgICAgIGZvdW5kTm9kZSA9IF8uZmluZFdoZXJlKG5vZGVzLCB7c2NfaWQ6IHNjX2lkfSk7CiAgIH0KICAgcmV0dXJuIGZvdW5kTm9kZTsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSB0cmVlIHN0cnVjdHVyZXMgZm9yIGVhY2ggbm9kZSwgZ2l2ZW4gYW4gYXJyYXkgb2YgZWRnZXMgCiogcGFyYW0ge0FycmF5fSBkaXJlY3RlZF9lZGdlcyAtLSBhcnJheSBvZiBkaXJlY3RlZCBlZGdlcyBvYmplY3RzIChzb3VyY2UsIHRhcmdldCkKKi8KZnVuY3Rpb24gX2dldFRyZWVTdHJ1Y3R1cmVzKGRpcmVjdGVkX2VkZ2VzKSB7CiAgIHZhciB0cmVlU3RydWN0dXJlcyA9IFtdOyAvLyBhbGwgKGRlc2NlbmRhbnQpIHRyZWUgc3RydWN0dXJlcyBmb3IgYWxsIHNpbmdsZSBjZWxscyAKCiAgIGRpcmVjdGVkX2VkZ2VzLmZvckVhY2goZnVuY3Rpb24oZWRnZSkgewogICAgICB2YXIgcGFyZW50ID0gX3JldHJpZXZlU0NUcmVlKGVkZ2Uuc291cmNlX3NjX2lkLCB0cmVlU3RydWN0dXJlcyk7CiAgICAgIHZhciBjaGlsZCA9IF9yZXRyaWV2ZVNDVHJlZShlZGdlLnRhcmdldF9zY19pZCwgdHJlZVN0cnVjdHVyZXMpOwogICAgICBpZiAocGFyZW50LmNoaWxkcmVuKSBwYXJlbnQuY2hpbGRyZW4ucHVzaChjaGlsZCk7CiAgICAgIGVsc2UgcGFyZW50LmNoaWxkcmVuID0gW2NoaWxkXTsKICAgfSk7CgogICByZXR1cm4gdHJlZVN0cnVjdHVyZXM7Cn0KCi8qIGZ1bmN0aW9uIHRvIGdldCBkZXNjZW5kYW50cyBpZCdzIGZvciB0aGUgc3BlY2lmaWVkIGtleQoqIEBwYXJhbSB7T2JqZWN0fSByb290IC0ga2V5IGZvciB3aGljaCB3ZSB3YW50IGRlc2NlbmRhbnRzCiogQHBhcmFtIHtBcnJheX0gZGVzY2VuZGFudHMgLSBpbml0aWFsbHkgZW1wdHkgYXJyYXkgZm9yIGRlc2NlbmRhbnRzIHRvIGJlIHBsYWNlZCBpbnRvCiovCmZ1bmN0aW9uIF9nZXREZXNjZW5kYW50SWRzKHJvb3QsIGRlc2NlbmRhbnRzKSB7CiAgICB2YXIgY2hpbGQ7CgogICAgaWYgKHJvb3QuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm9vdC5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBjaGlsZCA9IHJvb3QuY2hpbGRyZW5baV07CiAgICAgICAgICAgIGRlc2NlbmRhbnRzLnB1c2goY2hpbGQuc2NfaWQpOwogICAgICAgICAgICBfZ2V0RGVzY2VuZGFudElkcyhjaGlsZCwgZGVzY2VuZGFudHMpOwogICAgICAgIH0KICAgIH0KICAgIHJldHVybiBkZXNjZW5kYW50czsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBESVJFQ1QgZGVzY2VuZGFudCBpZCBmb3IgYWxsIG5vZGVzCiogQHBhcmFtIHtPYmplY3R9IGN1ck5vZGUgLS0gY3VycmVudCBub2RlIGluIHRoZSB0cmVlIChvcmlnaW5hbGx5IHRoZSByb290KQoqIEBwYXJhbSB7T2JqZWN0fSBkaXJfZGVzY2VuZGFudHMgLS0gb3JpZ2luYWxseSBlbXB0eSBhcnJheSBvZiBkaXJlY3QgZGVzY2VuZGFudHMgZm9yIGVhY2ggbm9kZQoqLwpmdW5jdGlvbiBfZ2V0RGlyZWN0RGVzY2VuZGFudHMoY3VyTm9kZSwgZGlyX2Rlc2NlbmRhbnRzKSB7CiAgICBkaXJfZGVzY2VuZGFudHNbY3VyTm9kZS5zY19pZF0gPSBbXTsKCiAgICBpZiAoY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGRpcl9kZXNjZW5kYW50c1tjdXJOb2RlLnNjX2lkXS5wdXNoKGN1ck5vZGUuY2hpbGRyZW5baV0uc2NfaWQpOwogICAgICAgICAgICBfZ2V0RGlyZWN0RGVzY2VuZGFudHMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2Rlc2NlbmRhbnRzKTsKICAgICAgICB9CiAgICB9CgogICAgcmV0dXJuIGRpcl9kZXNjZW5kYW50czsKfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBESVJFQ1QgYW5jZXN0b3IgaWQgZm9yIGFsbCBub2RlcwoqIEBwYXJhbSB7T2JqZWN0fSBjdXJOb2RlIC0tIGN1cnJlbnQgbm9kZSBpbiB0aGUgdHJlZSAob3JpZ2luYWxseSB0aGUgcm9vdCkKKiBAcGFyYW0ge09iamVjdH0gZGlyX2FuY2VzdG9ycyAtLSBvcmlnaW5hbGx5IGVtcHR5IGFycmF5IG9mIGRpcmVjdCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCiovCmZ1bmN0aW9uIF9nZXREaXJlY3RBbmNlc3RvcnMoY3VyTm9kZSwgZGlyX2FuY2VzdG9ycykgewoKICAgIGlmIChjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgZGlyX2FuY2VzdG9yc1tjdXJOb2RlLmNoaWxkcmVuW2ldLnNjX2lkXSA9IGN1ck5vZGUuc2NfaWQ7CiAgICAgICAgICAgIF9nZXREaXJlY3RBbmNlc3RvcnMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2FuY2VzdG9ycyk7CiAgICAgICAgfQogICAgfQoKICAgIHJldHVybiBkaXJfYW5jZXN0b3JzOwp9CgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIGFuY2VzdG9yIGlkcyBmb3IgYWxsIG5vZGVzCiogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoqLwpmdW5jdGlvbiBfZ2V0QW5jZXN0b3JJZHMoY3VyVml6T2JqKSB7CiAgICB2YXIgYW5jZXN0b3JzID0ge30sCiAgICAgICAgY3VyRGVzY2VuZGFudHMsCiAgICAgICAgZGVzY2VuZGFudHNfYXJyID0gY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyLAogICAgICAgIHRyZWVOb2RlcyA9IGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfbm9kZXM7CgogICAgLy8gc2V0IHVwIGVhY2ggbm9kZSBhcyBvcmlnaW5hbGx5IGNvbnRhaW5pbmcgYW4gZW1wdHkgbGlzdCBvZiBhbmNlc3RvcnMKICAgIHRyZWVOb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsIGlkeCkgewogICAgICAgIGFuY2VzdG9yc1tub2RlLnNjX2lkXSA9IFtdOwogICAgfSk7CgogICAgLy8gZ2V0IGFuY2VzdG9ycyBkYXRhIGZyb20gdGhlIGRlc2NlbmRhbnRzIGRhdGEKICAgIHRyZWVOb2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsIGlkeCkgewogICAgICAgIC8vIGZvciBlYWNoIGRlc2NlbmRhbnQgb2YgdGhpcyBub2RlCiAgICAgICAgY3VyRGVzY2VuZGFudHMgPSBkZXNjZW5kYW50c19hcnJbbm9kZS5zY19pZF07CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJEZXNjZW5kYW50cy5sZW5ndGg7IGkrKykgeyAKICAgICAgICAgICAgLy8gYWRkIHRoZSBub2RlIHRvIGRlc2NlbnRhbnQncyBhbmNlc3RvciBsaXN0CiAgICAgICAgICAgIGFuY2VzdG9yc1tjdXJEZXNjZW5kYW50c1tpXV0ucHVzaChub2RlLnNjX2lkKTsKICAgICAgICB9CiAgICB9KTsKCiAgICByZXR1cm4gYW5jZXN0b3JzOwp9CgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIGxlbmd0aCBvZiB0aGUgcGF0aCB0byBlYWNoIG5vZGUgKGFuZCB0aGUgbWF4aW11bSBwYXRoIGRpc3RhbmNlLCBhbmQgbWluIGxpbmsgZGlzdCBmb3IgZWFjaCBub2RlKQoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogCiogQHBhcmFtIHtTdHJpbmd9IGN1cl9zY19pZCAtLSBjdXJyZW50IHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIHtOdW1iZXJ9IGRpc3RfdGh1c19mYXIgLS0gY3VtdWxhdGl2ZSBkaXN0YW5jZSB0byB0aGUgY3VycmVudCBub2RlCiovCmZ1bmN0aW9uIF9nZXREaXN0VG9Ob2RlcyhjdXJWaXpPYmosIGN1cl9zY19pZCwgZGlzdF90aHVzX2ZhcikgewoKICAgIC8vIHNldCB1cCBtaW5pbXVtIHRhcmdldCBsaW5rIGRpc3RhbmNlIG9iamVjdCAob2YgYWxsIHRhcmdldHMgZm9yIGEgZ2l2ZW4gbm9kZSwgd2hhdCBpcyB0aGUgbWluaW11bSBlZGdlIGRpc3RhbmNlKQogICAgaWYgKCFjdXJWaXpPYmouZGF0YS5taW5UYXJnZXRMaW5rKSB7CiAgICAgICAgY3VyVml6T2JqLmRhdGEubWluVGFyZ2V0TGluayA9IHt9OwogICAgfQoKICAgIC8vIHNldCB1cCBwYXRoIGRpc3RhbmNlIG9iamVjdAogICAgaWYgKCFjdXJWaXpPYmouZGF0YS5wYXRoRGlzdHMpIHsKICAgICAgICBjdXJWaXpPYmouZGF0YS5wYXRoRGlzdHMgPSB7fTsKICAgIH0KCiAgICAvLyBzZXQgdXAgbWF4aW11bSAoYW5kIHJ1bm5lciB1cCkgcGF0aCBkaXN0YW5jZSB2YXJpYWJsZQogICAgaWYgKCFjdXJWaXpPYmouZGF0YS5tYXhfdHJlZV9wYXRoX2Rpc3QpIHsKICAgICAgICBjdXJWaXpPYmouZGF0YS5tYXhfdHJlZV9wYXRoX2Rpc3QgPSAwOwogICAgICAgIGN1clZpek9iai5kYXRhLnNlY29uZE1heF90cmVlX3BhdGhfZGlzdCA9IDA7CiAgICB9CgogICAgLy8gc2V0IHRoZSBkaXN0YW5jZSBmb3IgdGhlIGN1cnJlbnQgbm9kZQogICAgY3VyVml6T2JqLmRhdGEucGF0aERpc3RzW2N1cl9zY19pZF0gPSBkaXN0X3RodXNfZmFyOwoKICAgIC8vIHNldCB0aGUgbWluaW11bSB0YXJnZXQgbGluayBkaXN0YW5jZSBmb3IgdGhlIGN1cnJlbnQgbm9kZQogICAgY3VyVml6T2JqLmRhdGEubWluVGFyZ2V0TGlua1tjdXJfc2NfaWRdID0gSW5maW5pdHk7CgogICAgLy8gZm9yIGVhY2ggZGVzY2VuZGFudAogICAgY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzW2N1cl9zY19pZF0uZm9yRWFjaChmdW5jdGlvbihkZXNjKSB7CiAgICAgICAgLy8gZ2V0IGxpbmsgZGlzdGFuY2UgZm9yIHRoZSBsaW5rIGNvbm5lY3RpbmcgdGhpcyBkZXNjZW5kYW50IHRvIGl0cyBhbmNlc3RvcgogICAgICAgIHZhciBjdXJfbGluayA9IF8uZmluZFdoZXJlKGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfZWRnZXMsIAogICAgICAgICAgICB7c291cmNlX3NjX2lkOiBjdXJfc2NfaWQsIHRhcmdldF9zY19pZDogZGVzY30pOwogICAgICAgIHZhciBjdXJfZGlzdCA9IGN1cl9saW5rLmRpc3Q7CgogICAgICAgIC8vIHVwZGF0ZSBtaW5pbXVtIHRhcmdldCBsaW5rIGRpc3RhbmNlIGZvciB0aGlzIG5vZGUKICAgICAgICBpZiAoY3VyX2Rpc3QgPCBjdXJWaXpPYmouZGF0YS5taW5UYXJnZXRMaW5rW2N1cl9zY19pZF0pIHsKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubWluVGFyZ2V0TGlua1tjdXJfc2NfaWRdID0gY3VyX2Rpc3Q7CiAgICAgICAgfQoKICAgICAgICAvLyB1cGRhdGUgbWF4aW11bSAoYW5kIHJ1bm5lci11cCkgcGF0aCBkaXN0YW5jZQogICAgICAgIHZhciBjdW11bGF0aXZlX2Rpc3QgPSBkaXN0X3RodXNfZmFyK2N1cl9kaXN0OwogICAgICAgIGlmIChjdW11bGF0aXZlX2Rpc3QgPiBjdXJWaXpPYmouZGF0YS5tYXhfdHJlZV9wYXRoX2Rpc3QpIHsKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEuc2Vjb25kTWF4X3RyZWVfcGF0aF9kaXN0ID0gY3VyVml6T2JqLmRhdGEubWF4X3RyZWVfcGF0aF9kaXN0OwogICAgICAgICAgICBjdXJWaXpPYmouZGF0YS5tYXhfdHJlZV9wYXRoX2Rpc3QgPSBjdW11bGF0aXZlX2Rpc3Q7CiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgdGhlIHBhdGggbGVuZ3RocyBmb3IgaXRzIGRlc2NlbmRhbnRzCiAgICAgICAgX2dldERpc3RUb05vZGVzKGN1clZpek9iaiwgZGVzYywgY3VtdWxhdGl2ZV9kaXN0KTsKICAgIH0pOwp9CgovKiBzY2FsZWQgZWxib3cgZnVuY3Rpb24gKHRha2VzIGludG8gYWNjb3VudCB0aGUgbWluaW11bSBsaW5rIGRpc3RhbmNlIGZvciB0aGUgc2luZ2xlIGNlbGwpCiovCmZ1bmN0aW9uIF9zY2FsZWRFbGJvdyhjdXJWaXpPYmosIGQsIHNvdXJjZV9uYW1lLCBzb3VyY2UsIHRhcmdldCkgewoKICAgIC8vIG1pbmltdW0gbGluayBkaXN0YW5jZSBmb3IgdGhpcyBzaW5nbGUgY2VsbAogICAgdmFyIG1pbl9saW5rX2Rpc3QgPSAoY3VyVml6T2JqLmRhdGEubWluVGFyZ2V0TGlua1tzb3VyY2VfbmFtZV0vY3VyVml6T2JqLmRhdGEubWF4X3RyZWVfcGF0aF9kaXN0KSpjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50cmVlV2lkdGg7IC8vIFRPRE8gYWRkIHBhZGRpbmcKCiAgICByZXR1cm4gIk0iICsgc291cmNlLnggKyAiLCIgKyBzb3VyY2UueSArICJIIiArIChzb3VyY2UueCArIChtaW5fbGlua19kaXN0KS8yKSArICJWIiArIHRhcmdldC55ICsgIkgiICsgdGFyZ2V0Lng7Cn0KCi8qIGZ1bmN0aW9uIHRvIHJlbW92ZSBhbnkgZWRnZXMgaW52b2x2aW5nIHNpbmdsZSBjZWxscyB0aGF0IHdlcmUgcmVtb3ZlZCBkdWUgdG8gbm8gcHJlc2VuY2UgaGVhdG1hcCBkYXRhLCAKKiBub3IgZGVzY2VuZGFudHMgd2l0aCBoZWF0bWFwIGRhdGEgLS0gc3RvcmUgdGhlIGZpbHRlcmVkIHNldCBvZiBlZGdlcyBpbiBuZXcgYXJyYXkKKi8KZnVuY3Rpb24gX2dldEVkZ2VzVG9QbG90KGN1clZpek9iaikgewogICAgLy8gZWRnZXMgdG8gcGxvdCAocmVtb3ZlIGFueSBpbnZvbHZpbmcgc2luZ2xlIGNlbGxzIHRoYXQgd2VyZSByZW1vdmVkIGR1ZSB0byBubyBwcmVzZW5jZSBoZWF0bWFwIGRhdGEsIAogICAgLy8gbm9yIGRlc2NlbmRhbnRzIHdpdGggaGVhdG1hcCBkYXRhKQogICAgdmFyIGVkZ2VzX3RvX3Bsb3QgPSBbXTsKICAgIGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfZWRnZXMuZm9yRWFjaChmdW5jdGlvbihlZGdlKSB7CiAgICAgICAgaWYgKGN1clZpek9iai5kYXRhLm1pc3Npbmdfc2NzX3RvX3JlbW92ZS5pbmRleE9mKGVkZ2Uuc291cmNlX3NjX2lkKSA9PSAtMSAmJiAKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubWlzc2luZ19zY3NfdG9fcmVtb3ZlLmluZGV4T2YoZWRnZS50YXJnZXRfc2NfaWQpID09IC0xKSB7CiAgICAgICAgICAgICAgICBlZGdlc190b19wbG90LnB1c2goZWRnZSk7CiAgICAgICAgfQogICAgfSkKCiAgICByZXR1cm4gZWRnZXNfdG9fcGxvdDsKfQoKLyogZnVuY3Rpb24gdG8gcmVtb3ZlIGFueSBub2RlcyBpbnZvbHZpbmcgc2luZ2xlIGNlbGxzIHRoYXQgd2VyZSByZW1vdmVkIGR1ZSB0byBubyBwcmVzZW5jZSBoZWF0bWFwIGRhdGEsIAoqIG5vciBkZXNjZW5kYW50cyB3aXRoIGhlYXRtYXAgZGF0YSAtLSBzdG9yZSB0aGUgZmlsdGVyZWQgc2V0IG9mIG5vZGVzIGluIG5ldyBhcnJheQoqLwpmdW5jdGlvbiBfZ2V0Tm9kZXNUb1Bsb3QoY3VyVml6T2JqKSB7CgogICAgLy8gbm9kZXMgdG8gcGxvdCAocmVtb3ZlIGFueSBpbnZvbHZpbmcgc2luZ2xlIGNlbGxzIHRoYXQgd2VyZSByZW1vdmVkIGR1ZSB0byBubyBwcmVzZW5jZSBoZWF0bWFwIGRhdGEsIAogICAgLy8gbm9yIGRlc2NlbmRhbnRzIHdpdGggaGVhdG1hcCBkYXRhKQogICAgdmFyIG5vZGVzX3RvX3Bsb3QgPSBbXTsKICAgIGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfbm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlKSB7CiAgICAgICAgaWYgKGN1clZpek9iai5kYXRhLm1pc3Npbmdfc2NzX3RvX3JlbW92ZS5pbmRleE9mKG5vZGUuc2NfaWQpID09IC0xKSB7CiAgICAgICAgICAgIG5vZGVzX3RvX3Bsb3QucHVzaChub2RlKTsKICAgICAgICB9CiAgICB9KQoKICAgIHJldHVybiBub2Rlc190b19wbG90Owp9CgovKiBmdW5jdGlvbiB0byBwbG90IHRoZSBmb3JjZS1kaXJlY3RlZCBncmFwaAoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKKi8KZnVuY3Rpb24gX3Bsb3RGb3JjZURpcmVjdGVkR3JhcGgoY3VyVml6T2JqKSB7CiAgICB2YXIgY29uZmlnID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCiAgICAgICAgdXNlckNvbmZpZyA9IGN1clZpek9iai51c2VyQ29uZmlnOwoKICAgIC8vIGZvcmNlIGxheW91dCBmdW5jdGlvbgogICAgdmFyIGZvcmNlX2xheW91dCA9IGQzLmxheW91dC5mb3JjZSgpIC8vIFRPRE8gdXBkYXRlIGJlbG93CiAgICAgICAgLnNpemUoW2NvbmZpZy50cmVlV2lkdGgsIGNvbmZpZy50cmVlSGVpZ2h0XSkKICAgICAgICAuY2hhcmdlKGZ1bmN0aW9uKGQpewogICAgICAgICAgICB2YXIgY2hhcmdlID0gLTEwOwogICAgICAgICAgICBpZiAoY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyW2Quc2NfaWRdLmxlbmd0aCA+IDApIGNoYXJnZSA9IDEwICogY2hhcmdlOwogICAgICAgICAgICByZXR1cm4gY2hhcmdlOwogICAgICAgIH0pCiAgICAgICAgLmdyYXZpdHkoMC4yOCkKICAgICAgICAubm9kZXMoX2dldE5vZGVzVG9QbG90KGN1clZpek9iaikpCiAgICAgICAgLmxpbmtzKF9nZXRFZGdlc1RvUGxvdChjdXJWaXpPYmopKTsgICAgICAgIAoKICAgIC8vIHBsb3QgbGlua3MKICAgIHZhciBsaW5rc0cgPSBjdXJWaXpPYmoudmlldy50cmVlU1ZHCiAgICAgICAgLmFwcGVuZCgiZyIpCiAgICAgICAgLmNsYXNzZWQoImdyYXBoTGlua3MiLCB0cnVlKQogICAgICAgIC5zZWxlY3RBbGwoIi5saW5rc0ciKQogICAgICAgIC5kYXRhKF9nZXRFZGdlc1RvUGxvdChjdXJWaXpPYmopKQogICAgICAgIC5lbnRlcigpLmFwcGVuZCgiZyIpCiAgICAgICAgLmNsYXNzZWQoImxpbmtzRyIsIHRydWUpOwoKICAgIHZhciBsaW5rID0gbGlua3NHLmFwcGVuZCgibGluZSIpCiAgICAgICAgLmNsYXNzZWQoImxpbmsiLCB0cnVlKQogICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgcmV0dXJuICJsaW5rIGdyYXBoICIgKyBkLmxpbmtfaWQ7CiAgICAgICAgfSkgCiAgICAgICAgLmF0dHIoInN0cm9rZSIsY3VyVml6T2JqLmdlbmVyYWxDb25maWcuZGVmYXVsdExpbmtDb2xvdXIpCiAgICAgICAgLmF0dHIoInN0cm9rZS13aWR0aCIsICIycHgiKQogICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCBjb25maWcuZ3JhcGhPcGFjaXR5KQogICAgICAgIC5hdHRyKCJzdHJva2Utb3BhY2l0eSIsIGNvbmZpZy5ncmFwaE9wYWNpdHkpCiAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAoY29uZmlnLmdyYXBoT3BhY2l0eSA9PSAxKSA/ICJhdXRvIiA6ICJub25lIjsKICAgICAgICB9KQogICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICBfbGlua01vdXNlb3ZlcihjdXJWaXpPYmosIGQubGlua19pZCk7CiAgICAgICAgfSkKICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgX2xpbmtNb3VzZW91dChjdXJWaXpPYmosIHRydWUpOyAKICAgICAgICB9KQogICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIF9saW5rQ2xpY2soY3VyVml6T2JqLCBkLmxpbmtfaWQpOwogICAgICAgIH0pOwoKICAgIGxpbmtzRy5hcHBlbmQoInN2Zzp0aXRsZSIpCiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgewogICAgICAgICAgICByZXR1cm4gKGQuZGlzdCkgPyAiRGlzdGFuY2U6ICIrZC5kaXN0IDogbnVsbDsKICAgICAgICB9KTsKCiAgICAvLyBwbG90IG5vZGVzCiAgICB2YXIgbm9kZUcgPSBjdXJWaXpPYmoudmlldy50cmVlU1ZHLmFwcGVuZCgiZyIpCiAgICAgICAgLmNsYXNzZWQoImdyYXBoTm9kZXMiLCB0cnVlKQogICAgICAgIC5zZWxlY3RBbGwoIi5ncmFwaE5vZGVzRyIpCiAgICAgICAgLmRhdGEoX2dldE5vZGVzVG9QbG90KGN1clZpek9iaikpCiAgICAgICAgLmVudGVyKCkKICAgICAgICAuYXBwZW5kKCJnIikKICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICByZXR1cm4gImdyYXBoTm9kZXNHIG5vZGVfIiArIGQuc2NfaWQ7CiAgICAgICAgfSk7CgogICAgLy8gbm9kZSBjaXJjbGVzCiAgICB2YXIgbm9kZUNpcmNsZSA9IG5vZGVHLmFwcGVuZCgiY2lyY2xlIikKICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIC8vIGdldCBnZW5vdHlwZQogICAgICAgICAgICB2YXIgZ3R5cGUgPSBfZ2V0R2Vub3R5cGUoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsIGQuc2NfaWQpOwogICAgICAgICAgICB2YXIgdHAgPSBfZ2V0VFAoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsIGQuc2NfaWQpOwogICAgICAgICAgICByZXR1cm4gImdyYXBoIG5vZGUgbm9kZV8iICsgZC5zY19pZCArICIgZ3R5cGVfIiArIGd0eXBlICsgIiB0cF8iICsgdHA7CiAgICAgICAgfSkKICAgICAgICAuYXR0cigiciIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAvLyBpZiB1c2VyIHdhbnRzIHRvIGRpc3BsYXkgbm9kZSBpZHMgCiAgICAgICAgICAgIGlmICh1c2VyQ29uZmlnLmRpc3BsYXlfbm9kZV9pZHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcudHJlZV93X2xhYmVsc19yOwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIGRvbid0IGRpc3BsYXkgbGFiZWxzCiAgICAgICAgICAgIHJldHVybiBjb25maWcudHJlZV9yOwogICAgICAgIH0pCiAgICAgICAgLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIGQuZmlsbCA9IF9nZXROb2RlRmlsbChjdXJWaXpPYmosIGQuc2NfaWQpOwogICAgICAgICAgICByZXR1cm4gZC5maWxsOwogICAgICAgIH0pCiAgICAgICAgLmF0dHIoInN0cm9rZSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgcmV0dXJuIF9nZXROb2RlU3Ryb2tlKGN1clZpek9iaiwgZC5zY19pZCk7CiAgICAgICAgfSkKICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgY29uZmlnLmdyYXBoT3BhY2l0eSkKICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCBjb25maWcuZ3JhcGhPcGFjaXR5KQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gKGNvbmZpZy5ncmFwaE9wYWNpdHkgPT0gMSkgPyAiYXV0byIgOiAibm9uZSI7CiAgICAgICAgfSkKICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICBfbW91c2VvdmVyTm9kZShkLnNjX2lkLCBjdXJWaXpPYmoudmlld19pZCwgY3VyVml6T2JqLm5vZGVUaXAsIGNvbmZpZy5zd2l0Y2hWaWV3LCBjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKGN1clZpek9iai52aWV3X2lkKSkgewogICAgICAgICAgICAgICAgX21vdXNlb3V0Tm9kZShkLnNjX2lkLCBjdXJWaXpPYmoudmlld19pZCwgY3VyVml6T2JqLm5vZGVUaXApOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgLy8gbm9kZSBzaW5nbGUgY2VsbCBsYWJlbHMgKGlmIHVzZXIgd2FudHMgdG8gZGlzcGxheSB0aGVtKQogICAgaWYgKHVzZXJDb25maWcuZGlzcGxheV9ub2RlX2lkcykgewogICAgICAgIHZhciBub2RlTGFiZWwgPSBfcGxvdE5vZGVMYWJlbHMoY3VyVml6T2JqLCAiZ3JhcGgiKTsKICAgIH0KCiAgICAvLyB1c2UgdGltZW91dCBmdW5jdGlvbiB0byBhbGxvdyByZXN0IG9mIHRoZSBwYWdlIHRvIGxvYWQgZmlyc3QKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgLy8gcnVuIHRoZSBsYXlvdXQgYSBmaXhlZCBudW1iZXIgb2YgdGltZXMKICAgICAgICBmb3JjZV9sYXlvdXQuc3RhcnQoKTsKICAgICAgICB2YXIgbiA9IDEwMDsKICAgICAgICBmb3IgKHZhciBpID0gbipuOyBpID4gMDsgLS1pKSBmb3JjZV9sYXlvdXQudGljaygpOwogICAgICAgIGZvcmNlX2xheW91dC5zdG9wKCk7CgogICAgICAgIC8vIHJhZGl1cyBvZiBub2RlcwogICAgICAgIHZhciByID0gKHVzZXJDb25maWcuZGlzcGxheV9ub2RlX2lkcykgPyBjb25maWcudHJlZV93X2xhYmVsc19yIDogY29uZmlnLnRyZWVfcjsKCiAgICAgICAgbm9kZUNpcmNsZS5hdHRyKCJjeCIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgICAgICBkLnggPSBNYXRoLm1heChyLCBNYXRoLm1pbihjb25maWcudHJlZVdpZHRoIC0gciwgZC54KSk7CiAgICAgICAgICAgICAgICByZXR1cm4gZC54OwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cigiY3kiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgZC55ID0gTWF0aC5tYXgociwgTWF0aC5taW4oY29uZmlnLnRyZWVIZWlnaHQgLSByLCBkLnkpKTsKICAgICAgICAgICAgICAgIHJldHVybiBkLnk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICBpZiAodXNlckNvbmZpZy5kaXNwbGF5X25vZGVfaWRzKSB7CiAgICAgICAgICAgIG5vZGVMYWJlbC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC54ID0gTWF0aC5tYXgociwgTWF0aC5taW4oY29uZmlnLnRyZWVXaWR0aCAtIHIsIGQueCkpOyAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQueSA9IE1hdGgubWF4KHIsIE1hdGgubWluKGNvbmZpZy50cmVlSGVpZ2h0IC0gciwgZC55KSk7IAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICBsaW5rLmF0dHIoIngxIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zb3VyY2UueDsgfSkKICAgICAgICAgICAgLmF0dHIoInkxIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5zb3VyY2UueTsgfSkKICAgICAgICAgICAgLmF0dHIoIngyIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50YXJnZXQueDsgfSkKICAgICAgICAgICAgLmF0dHIoInkyIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC50YXJnZXQueTsgfSk7CiAgICB9KTsKfQoKZnVuY3Rpb24gX3JlUGxvdEZvcmNlTGF5b3V0KGN1clZpek9iaikgewogICAgdmFyIGNvbmZpZyA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLAogICAgICAgIHVzZXJDb25maWcgPSBjdXJWaXpPYmoudXNlckNvbmZpZywKICAgICAgICBmb3JjZV9sYXlvdXQ7CgogICAgLy8gU0NBTEUKICAgIGlmIChjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kaXN0T24pIHsKICAgICAgICAvLyBsYXlvdXQgZnVuY3Rpb24KICAgICAgICBmb3JjZV9sYXlvdXQgPSBkMy5sYXlvdXQuZm9yY2UoKQogICAgICAgICAgICAuc2l6ZShbY29uZmlnLnRyZWVXaWR0aCwgY29uZmlnLnRyZWVIZWlnaHRdKQogICAgICAgICAgICAubGlua0Rpc3RhbmNlKGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgIC8vIGRpdmlkZSBieSAyIHNvIHRoYXQgdHdvIG1heCBwYXRocyBjYW4gZml0IG9uIHRoZSBzbWFsbGVzdCBkaW1lbnNpb24KICAgICAgICAgICAgICAgIHJldHVybiAoZC5kaXN0L2N1clZpek9iai5kYXRhLm1heF90cmVlX3BhdGhfZGlzdCkqKGNvbmZpZy5zbWFsbGVzdF90cmVlX2RpbS8yKTsgCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5ub2Rlcyh1c2VyQ29uZmlnLnNjX3RyZWVfbm9kZXMpCiAgICAgICAgICAgIC5saW5rcyh1c2VyQ29uZmlnLnNjX3RyZWVfZWRnZXMpOyAgICAgCiAgICB9CiAgICAvLyBVTlNDQUxFCiAgICBlbHNlIHsKICAgICAgICAvLyBsYXlvdXQgZnVuY3Rpb24KICAgICAgICBmb3JjZV9sYXlvdXQgPSBkMy5sYXlvdXQuZm9yY2UoKQogICAgICAgICAgICAuc2l6ZShbY29uZmlnLnRyZWVXaWR0aCwgY29uZmlnLnRyZWVIZWlnaHRdKQogICAgICAgICAgICAuY2hhcmdlKGZ1bmN0aW9uKGQpewogICAgICAgICAgICAgICAgdmFyIGNoYXJnZSA9IC0xMDsKICAgICAgICAgICAgICAgIGlmIChjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnJbZC5zY19pZF0gJiYgY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyW2Quc2NfaWRdLmxlbmd0aCA+IDApIGNoYXJnZSA9IDEwICogY2hhcmdlOwogICAgICAgICAgICAgICAgcmV0dXJuIGNoYXJnZTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmdyYXZpdHkoMC4yOCkKICAgICAgICAgICAgLm5vZGVzKHVzZXJDb25maWcuc2NfdHJlZV9ub2RlcykKICAgICAgICAgICAgLmxpbmtzKHVzZXJDb25maWcuc2NfdHJlZV9lZGdlcyk7ICAgICAgICAKICAgIH0KCiAgICAvLyB1c2UgdGltZW91dCBmdW5jdGlvbiB0byBhbGxvdyByZXN0IG9mIHRoZSBwYWdlIHRvIGxvYWQgZmlyc3QKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CiAgICAgICAgCiAgICAgICAgLy8gcnVuIHRoZSBsYXlvdXQgYSBmaXhlZCBudW1iZXIgb2YgdGltZXMKICAgICAgICBmb3JjZV9sYXlvdXQuc3RhcnQoKTsKICAgICAgICB2YXIgbiA9IDEwMDsKICAgICAgICBmb3IgKHZhciBpID0gbipuOyBpID4gMDsgLS1pKSBmb3JjZV9sYXlvdXQudGljaygpOwogICAgICAgIGZvcmNlX2xheW91dC5zdG9wKCk7CgogICAgICAgIC8vIG5vZGUgY2lyY2xlcwogICAgICAgIHZhciBub2RlQ2lyY2xlID0gY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi5ncmFwaC5ub2RlIik7CgogICAgICAgIC8vIHJhZGl1cyBvZiBub2RlcwogICAgICAgIHZhciByID0gKHVzZXJDb25maWcuZGlzcGxheV9ub2RlX2lkcykgPyBjb25maWcudHJlZV93X2xhYmVsc19yIDogY29uZmlnLnRyZWVfcjsKCiAgICAgICAgbm9kZUNpcmNsZS5hdHRyKCJjeCIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgICAgICByZXR1cm4gZC54ID0gTWF0aC5tYXgociwgTWF0aC5taW4oY29uZmlnLnRyZWVXaWR0aCAtIHIsIGQueCkpOyAKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmF0dHIoImN5IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIHJldHVybiBkLnkgPSBNYXRoLm1heChyLCBNYXRoLm1pbihjb25maWcudHJlZUhlaWdodCAtIHIsIGQueSkpOyAKICAgICAgICAgICAgfSk7CgogICAgICAgIGlmICh1c2VyQ29uZmlnLmRpc3BsYXlfbm9kZV9pZHMpIHsKICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi5ncmFwaC5ub2RlTGFiZWwiKQogICAgICAgICAgICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnggPSBNYXRoLm1heChyLCBNYXRoLm1pbihjb25maWcudHJlZVdpZHRoIC0gciwgZC54KSk7IAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC55ID0gTWF0aC5tYXgociwgTWF0aC5taW4oY29uZmlnLnRyZWVIZWlnaHQgLSByLCBkLnkpKTsgCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGN1clZpek9iai52aWV3LnRyZWVTVkcuc2VsZWN0QWxsKCIubGluay5ncmFwaCIpCiAgICAgICAgICAgIC5hdHRyKCJ4MSIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc291cmNlLng7IH0pCiAgICAgICAgICAgIC5hdHRyKCJ5MSIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc291cmNlLnk7IH0pCiAgICAgICAgICAgIC5hdHRyKCJ4MiIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lng7IH0pCiAgICAgICAgICAgIC5hdHRyKCJ5MiIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQudGFyZ2V0Lnk7IH0pOwogICAgfSk7Cgp9CgovKiBmdW5jdGlvbiB0byBwbG90IG5vZGUgbGFiZWxzCiogQHBhcmFtIHtTdHJpbmd9IHRyZWVfdHlwZSAtLSAidHJlZSIgb3IgImdyYXBoIgoqLwpmdW5jdGlvbiBfcGxvdE5vZGVMYWJlbHMoY3VyVml6T2JqLCB0cmVlX3R5cGUpIHsKICAgIHZhciBjb25maWcgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZzsKCiAgICB2YXIgbm9kZXNHID0gKHRyZWVfdHlwZSA9PSAidHJlZSIpID8gCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi50cmVlTm9kZXNHIikgOiBjdXJWaXpPYmoudmlldy50cmVlU1ZHLnNlbGVjdEFsbCgiLmdyYXBoTm9kZXNHIik7CgogICAgdmFyIG5vZGVMYWJlbCA9IG5vZGVzRwogICAgICAgIC5hcHBlbmQoInRleHQiKQogICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgcmV0dXJuICJub2RlTGFiZWwgIiArIHRyZWVfdHlwZSArICIgbm9kZUxhYmVsXyIgKyBkLnNjX2lkOwogICAgICAgIH0pCiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgdmFyIGlzTnVtYmVyID0gIWlzTmFOKGQuc2NfaWQpOwogICAgICAgICAgICByZXR1cm4gKGlzTnVtYmVyKSA/IHBhcnNlSW50KGQuc2NfaWQsIDEwKSA6IGQuc2NfaWQ7IAogICAgICAgIH0pCiAgICAgICAgLmF0dHIoIngiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLng7IH0pCiAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLnk7IH0pCiAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIAogICAgICAgICAgICBfZ2V0TGFiZWxGb250U2l6ZShfLnBsdWNrKGN1clZpek9iai51c2VyQ29uZmlnLnNjX3RyZWVfbm9kZXMsICJzY19pZCIpLCAKICAgICAgICAgICAgICAgIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRyZWVfd19sYWJlbHNfciAqIDIpKQogICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJub25lIikKICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAodHJlZV90eXBlID09ICJ0cmVlIikgPyBjb25maWcudHJlZU9wYWNpdHkgOiBjb25maWcuZ3JhcGhPcGFjaXR5OwogICAgICAgIH0pCiAgICAgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKTsKICAgIHJldHVybiBub2RlTGFiZWw7Cn0KCi8qIGZ1bmN0aW9uIHRvIGdldCBkaWFnb25hbCBmb3IgYWxpZ25lZCBwaHlsb2dlbnkKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiogQHBhcmFtIHtPYmplY3R9IGQgLS0gY3VycmVudCBkYXRhIG9iamVjdAoqIEBwYXJhbSB7TnVtYmVyfSBoYWxmX3Jvd0hlaWdodCAtLSBoYWxmIHRoZSBoZWlnaHQgb2Ygb25lIHJvdyBpbiB0aGUgaGVhdG1hcAoqLwpmdW5jdGlvbiBfZ2V0RWxib3coY3VyVml6T2JqLCBkLCBoYWxmX3Jvd0hlaWdodCkgewoKICAgIHZhciBzb3VyY2UgPSB7fTsKICAgIHZhciB0YXJnZXQgPSB7fTsKICAgIC8vIHdlJ3JlIHNjYWxpbmcgYnkgZWRnZSBkaXN0YW5jZSAtLSBnZXQgZWxib3cKICAgIGlmIChjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kaXN0T24pIHsKICAgICAgICBzb3VyY2UueSA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnNvdXJjZV9zY19pZF0gKyBoYWxmX3Jvd0hlaWdodDsKICAgICAgICB0YXJnZXQueSA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnRhcmdldF9zY19pZF0gKyBoYWxmX3Jvd0hlaWdodDsKICAgICAgICBzb3VyY2UueCA9IGN1clZpek9iai5kYXRhLnhDb29yZGluYXRlc0Rpc3RbZC5zb3VyY2Vfc2NfaWRdOwogICAgICAgIHRhcmdldC54ID0gY3VyVml6T2JqLmRhdGEueENvb3JkaW5hdGVzRGlzdFtkLnRhcmdldF9zY19pZF07CgogICAgICAgIHJldHVybiBfc2NhbGVkRWxib3coY3VyVml6T2JqLCBkLCBkLnNvdXJjZV9zY19pZCwgc291cmNlLCB0YXJnZXQpOwogICAgfQogICAgLy8gbm90IHNjYWxpbmcgYnkgZWRnZSBkaXN0YW5jZXMgLS0gZ2V0IGJlemllciBkaWFnb25hbAogICAgZWxzZSB7CgogICAgICAgIHZhciBkaWFnb25hbCA9IGQzLnN2Zy5kaWFnb25hbCgpCiAgICAgICAgICAgIC5wcm9qZWN0aW9uKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIFtkLnksIGQueF07IH0pOwoKICAgICAgICBzb3VyY2UueCA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnNvdXJjZV9zY19pZF0gKyBoYWxmX3Jvd0hlaWdodDsKICAgICAgICB0YXJnZXQueCA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnRhcmdldF9zY19pZF0gKyBoYWxmX3Jvd0hlaWdodDsKICAgICAgICBzb3VyY2UueSA9IGN1clZpek9iai5kYXRhLnhDb29yZGluYXRlc1tkLnNvdXJjZV9zY19pZF07CiAgICAgICAgdGFyZ2V0LnkgPSBjdXJWaXpPYmouZGF0YS54Q29vcmRpbmF0ZXNbZC50YXJnZXRfc2NfaWRdOwogICAgICAgIAogICAgICAgIHJldHVybiBkaWFnb25hbCh7c291cmNlOiBzb3VyY2UsIHRhcmdldDogdGFyZ2V0fSk7CiAgICB9Cn0KCi8qIGZ1bmN0aW9uIHRvIHBsb3QgcGh5bG9nZW5ldGljIHRyZWUgYWxpZ25lZCB3aXRoIGhlYXRtYXAKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9wbG90QWxpZ25lZFBoeWxvZ2VueShjdXJWaXpPYmopIHsKICAgIHZhciBjb25maWcgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZzsKICAgIHZhciByID0gKGN1clZpek9iai51c2VyQ29uZmlnLmRpc3BsYXlfbm9kZV9pZHMpID8gY29uZmlnLnRyZWVfd19sYWJlbHNfciA6IGNvbmZpZy50cmVlX3I7CiAgICB2YXIgaGFsZl9yb3dIZWlnaHQgPSAoY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0LzIpOyAvLyBoYWxmIHRoZSBoZWlnaHQgb2Ygb25lIGhlYXRtYXAgcm93CgogICAgLy8gY3JlYXRlIGxpbmtzCiAgICBjdXJWaXpPYmoudmlldy50cmVlU1ZHLmFwcGVuZCgiZyIpCiAgICAgICAgLmNsYXNzZWQoInRyZWVMaW5rcyIsIHRydWUpCiAgICAgICAgLnNlbGVjdEFsbCgiLnRyZWUubGluayIpICAgICAgICAgICAgICAgICAgCiAgICAgICAgLmRhdGEoX2dldEVkZ2VzVG9QbG90KGN1clZpek9iaikpICAgICAgICAgICAgICAgICAgIAogICAgICAgIC5lbnRlcigpLmFwcGVuZCgicGF0aCIpICAKICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIGQubGlua19pZCA9ICJsaW5rX3NvdXJjZV8iICsgZC5zb3VyY2Vfc2NfaWQgKyAiX3RhcmdldF8iICsgZC50YXJnZXRfc2NfaWQ7CiAgICAgICAgICAgIHJldHVybiAibGluayB0cmVlICIgKyBkLmxpbmtfaWQ7CiAgICAgICAgfSkgICAgICAgICAgICAgICAgCiAgICAgICAgLmF0dHIoImQiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIHJldHVybiBfZ2V0RWxib3coY3VyVml6T2JqLCBkLCBoYWxmX3Jvd0hlaWdodCk7CiAgICAgICAgfSkKICAgICAgICAuYXR0cigic3Ryb2tlIixjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kZWZhdWx0TGlua0NvbG91cikKICAgICAgICAuYXR0cigic3Ryb2tlLXdpZHRoIiwgIjJweCIpCiAgICAgICAgLmF0dHIoImZpbGwiLCAibm9uZSIpCiAgICAgICAgLmF0dHIoImZpbGwtb3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSkKICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCBjb25maWcudHJlZU9wYWNpdHkpCiAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAoY29uZmlnLnRyZWVPcGFjaXR5ID09IDEpID8gImF1dG8iIDogIm5vbmUiOwogICAgICAgIH0pCiAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIF9saW5rTW91c2VvdmVyKGN1clZpek9iaiwgZC5saW5rX2lkKTsKICAgICAgICB9KQogICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICBfbGlua01vdXNlb3V0KGN1clZpek9iaiwgdHJ1ZSk7IAogICAgICAgIH0pCiAgICAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgX2xpbmtDbGljayhjdXJWaXpPYmosIGQubGlua19pZCk7CiAgICAgICAgfSkKICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgewogICAgICAgICAgICBpZiAoZC5kaXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZC5kaXN0OyAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgIC8vIGNyZWF0ZSBub2RlcwogICAgdmFyIG5vZGVHID0gY3VyVml6T2JqLnZpZXcudHJlZVNWRwogICAgICAgIC5zZWxlY3RBbGwoIi50cmVlTm9kZXNHIikKICAgICAgICAuZGF0YShfZ2V0Tm9kZXNUb1Bsb3QoY3VyVml6T2JqKSkKICAgICAgICAuZW50ZXIoKQogICAgICAgIC5hcHBlbmQoImciKQogICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgIHJldHVybiAidHJlZU5vZGVzRyBub2RlXyIgKyBkLnNjX2lkOwogICAgICAgIH0pOwoKICAgIG5vZGVHLmFwcGVuZCgiY2lyY2xlIikgICAKICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIC8vIGdldCBnZW5vdHlwZSAmIHRpbWVwb2ludAogICAgICAgICAgICB2YXIgZ3R5cGUgPSBfZ2V0R2Vub3R5cGUoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsIGQuc2NfaWQpOwogICAgICAgICAgICB2YXIgdHAgPSBfZ2V0VFAoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsIGQuc2NfaWQpOwogICAgICAgICAgICByZXR1cm4gInRyZWUgbm9kZSBub2RlXyIgKyBkLnNjX2lkICsgIiBndHlwZV8iICsgZ3R5cGUgKyAiIHRwXyIgKyB0cDsKICAgICAgICB9KSAgCiAgICAgICAgLmF0dHIoImN4IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgZC54ID0gY3VyVml6T2JqLmRhdGEueENvb3JkaW5hdGVzW2Quc2NfaWRdOwogICAgICAgICAgICByZXR1cm4gZC54OwogICAgICAgIH0pCiAgICAgICAgLmF0dHIoImN5IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgZC55ID0gY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzW2Quc2NfaWRdICsgaGFsZl9yb3dIZWlnaHQ7CiAgICAgICAgICAgIHJldHVybiBkLnk7CiAgICAgICAgfSkgICAKICAgICAgICAuYXR0cigic3Ryb2tlIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICByZXR1cm4gX2dldE5vZGVTdHJva2UoY3VyVml6T2JqLCBkLnNjX2lkKTsKICAgICAgICB9KSAgICAgICAgICAgCiAgICAgICAgLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIHJldHVybiBkLmZpbGwgPSBfZ2V0Tm9kZUZpbGwoY3VyVml6T2JqLCBkLnNjX2lkKTsKICAgICAgICB9KQogICAgICAgIC5hdHRyKCJyIiwgcikKICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgY29uZmlnLnRyZWVPcGFjaXR5KQogICAgICAgIC5hdHRyKCJzdHJva2Utb3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSkKICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIChjb25maWcudHJlZU9wYWNpdHkgPT0gMSkgPyAiYXV0byIgOiAibm9uZSI7CiAgICAgICAgfSkKICAgICAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICBfbW91c2VvdmVyTm9kZShkLnNjX2lkLCBjdXJWaXpPYmoudmlld19pZCwgY3VyVml6T2JqLm5vZGVUaXAsIGNvbmZpZy5zd2l0Y2hWaWV3LCBjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKGN1clZpek9iai52aWV3X2lkKSkgewogICAgICAgICAgICAgICAgX21vdXNlb3V0Tm9kZShkLnNjX2lkLCBjdXJWaXpPYmoudmlld19pZCwgY3VyVml6T2JqLm5vZGVUaXApOwogICAgICAgICAgICB9CiAgICAgICAgfSkKICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oZCkgewogICAgICAgICAgICBpZiAoX2NoZWNrRm9yU2VsZWN0aW9ucyhjdXJWaXpPYmoudmlld19pZCkpIHsKICAgICAgICAgICAgICAgIC8vIHJldmVyc2UgeS1jb29yZGluYXRlcyBmb3IgdGhlIGRlc2NlbmRhbnRzIG9mIHRoaXMgbm9kZQoKICAgICAgICAgICAgICAgIC8vIGdldCBjdXJyZW50IHktY29vcmRpbmF0ZXMgZm9yIGFsbCBkZXNjZW5kYW50cyBvZiB0aGlzIG5vZGUKICAgICAgICAgICAgICAgIHZhciBjdXJfZGVzY3MgPSBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnJbZC5zY19pZF0uY29uY2F0KGQuc2NfaWQpOwogICAgICAgICAgICAgICAgdmFyIGN1cl9kZXNjc195X2Nvb3JkcyA9IFtdOwogICAgICAgICAgICAgICAgY3VyX2Rlc2NzLmZvckVhY2goZnVuY3Rpb24oY3VyX2Rlc2MpIHsKICAgICAgICAgICAgICAgICAgICBjdXJfZGVzY3NfeV9jb29yZHMucHVzaChjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXNbY3VyX2Rlc2NdKTsKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgLy8gZ2V0IHRoZSBtaWQgeS1jb29yZGluYXRlIGZvciB0aGVzZSBkZXNjZW5kYW50cwogICAgICAgICAgICAgICAgdmFyIG1pZF95ID0gKE1hdGgubWF4KC4uLmN1cl9kZXNjc195X2Nvb3JkcykrTWF0aC5taW4oLi4uY3VyX2Rlc2NzX3lfY29vcmRzKSkvMjsKCiAgICAgICAgICAgICAgICAvLyBmb3IgZWFjaCBkZXNjZW5kYW50LCBmbGlwIGl0cyBjb29yZGluYXRlIG92ZXIgdGhlIG1pZCB5LWNvb3JkaW5hdGUgb2YgdGhlIGRlc2NlbmRhbnRzCiAgICAgICAgICAgICAgICBjdXJfZGVzY3MuZm9yRWFjaChmdW5jdGlvbihjdXJfZGVzYykgewoKICAgICAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIG5ldyB5IGNvb3JkaW5hdGUgYW5kIHRoZSBkaWZmZXJlbmNlIGJldHdlZW4gb2xkIGFuZCBuZXcgeS1jb29yZGluYXRlcwogICAgICAgICAgICAgICAgICAgIHZhciBjdXJfeV9jb29yZCA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tjdXJfZGVzY107CiAgICAgICAgICAgICAgICAgICAgdmFyIGRpZmZfeSA9IC0yKihjdXJfeV9jb29yZCAtIG1pZF95KTsKICAgICAgICAgICAgICAgICAgICB2YXIgbmV3X3lfY29vcmQgPSBjdXJfeV9jb29yZCArIGRpZmZfeTsKICAgICAgICAgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXNbY3VyX2Rlc2NdID0gbmV3X3lfY29vcmQ7CgogICAgICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgeS1jb29yZGluYXRlIHRyYW5zbGF0aW9uIG9mIHRoZSBzYwogICAgICAgICAgICAgICAgICAgIHZhciB0X3kgPSBfZ2V0VHJlZU5vZGVZVHJhbnNsYXRpb24oY3VyVml6T2JqLnZpZXdfaWQsIGN1cl9kZXNjKTsgCgogICAgICAgICAgICAgICAgICAgIC8vIHRyYW5zbGF0ZSB0aGUgc2luZ2xlIGNlbGwgcHJvZmlsZSBpbiB0aGUgaGVhdG1hcAogICAgICAgICAgICAgICAgICAgIF90cmFuc2xhdGVTQ0hlYXRtYXBQcm9maWxlKGN1clZpek9iai52aWV3X2lkLCBjdXJfZGVzYywgZGlmZl95ICsgdF95KTsKCiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNsYXRlIHRoZSBzaW5nbGUgY2VsbCBub2RlCiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi50cmVlLm5vZGUubm9kZV8iICsgY3VyX2Rlc2MpCiAgICAgICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDEwMDApCiAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAidHJhbnNsYXRlKDAsIiArIChkaWZmX3kgKyB0X3kpICsgIikiOwogICAgICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIGZvciBlYWNoIGxhdGVudCBjZWxsLCBnZXQgaXRzIG5ldyB5LWNvb3JkaW5hdGUgYW5kIHBsb3QgaXQKICAgICAgICAgICAgICAgIF9nZXRZQ29vcmRpbmF0ZXNMYXRlbnROb2RlcyhjdXJWaXpPYmosICQuZXh0ZW5kKFtdLCBjdXJWaXpPYmouZGF0YS5obV9zY19pZHMpLCBjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXMpOwogICAgICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubWlzc2luZ19zY3NfdG9fcGxvdC5mb3JFYWNoKGZ1bmN0aW9uKHNjX2lkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9sZF95ID0gX2dldFRyZWVOb2RlWUNvb3JkKGN1clZpek9iai52aWV3X2lkLCBzY19pZCkgLSBoYWxmX3Jvd0hlaWdodDsKICAgICAgICAgICAgICAgICAgICB2YXIgb2xkX3RyYW5zbGF0aW9uID0gX2dldFRyZWVOb2RlWVRyYW5zbGF0aW9uKGN1clZpek9iai52aWV3X2lkLCBzY19pZCk7CiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld195ID0gY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzW3NjX2lkXTsKICAgICAgICAgICAgICAgICAgICBfdHJhbnNsYXRlU0NOb2RlKGN1clZpek9iai52aWV3X2lkLCBzY19pZCwgKG5ld195LW9sZF95K29sZF90cmFuc2xhdGlvbikpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgLy8gdHJhbnNsYXRlIGFsaWduZWQgdHJlZSBsaW5rIGZvciB0aGUgZWRnZSBqdXN0IGJlbG93IHRoZSBkZWxldGlvbgogICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLmxpbmsiKSAKICAgICAgICAgICAgICAgICAgICAudHJhbnNpdGlvbigpCiAgICAgICAgICAgICAgICAgICAgLmR1cmF0aW9uKDEwMDApICAgICAgIAogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJkIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX2dldEVsYm93KGN1clZpek9iaiwgZCwgaGFsZl9yb3dIZWlnaHQpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgIC8vIG5vZGUgc2luZ2xlIGNlbGwgbGFiZWxzIChpZiB1c2VyIHdhbnRzIHRvIGRpc3BsYXkgdGhlbSkKICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5kaXNwbGF5X25vZGVfaWRzKSB7CiAgICAgICAgX3Bsb3ROb2RlTGFiZWxzKGN1clZpek9iaiwgInRyZWUiKTsKICAgIH0KfQoKLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSB0cmVlIG5vZGUncyB5LWNvb3JkaW5hdGUgdHJhbnNsYXRpb24KKi8KZnVuY3Rpb24gX2dldFRyZWVOb2RlWVRyYW5zbGF0aW9uKHZpZXdfaWQsIHNjX2lkKSB7CiAgICByZXR1cm4gZDMudHJhbnNmb3JtKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50cmVlLm5vZGUubm9kZV8iICsgc2NfaWQpLmF0dHIoInRyYW5zZm9ybSIpKS50cmFuc2xhdGVbMV07Cn0KCi8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgdHJlZSBub2RlJ3MgYWJzb2x1dGUgeS1jb29yZGluYXRlIChpbmNsdWRpbmcgdHJhbnNsYXRpb24pCiovCmZ1bmN0aW9uIF9nZXRUcmVlTm9kZVlDb29yZCh2aWV3X2lkLCBzY19pZCkgewogICAgcmV0dXJuIHBhcnNlRmxvYXQoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRyZWUubm9kZS5ub2RlXyIgKyBzY19pZCkuYXR0cigiY3kiKSkgKyBfZ2V0VHJlZU5vZGVZVHJhbnNsYXRpb24odmlld19pZCwgc2NfaWQpOwp9CgovKiBmdW5jdGlvbiB0byBzd2l0Y2ggYmV0d2VlbiB0cmVlIGFuZCBncmFwaCB2aWV3cwoqLwpmdW5jdGlvbiBfc3dpdGNoVmlldyhjdXJWaXpPYmopIHsKICAgIHZhciBjb25maWcgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZzsKCiAgICAvLyBmbGlwIG9wYWNpdGllcyBvZiB0cmVlICYgZ3JhcGgKICAgIGNvbmZpZy50cmVlT3BhY2l0eSA9ICsgIWNvbmZpZy50cmVlT3BhY2l0eTsKICAgIGNvbmZpZy5ncmFwaE9wYWNpdHkgPSArICFjb25maWcuZ3JhcGhPcGFjaXR5OwoKICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIudHJlZS5ub2RlIikKICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgY29uZmlnLnRyZWVPcGFjaXR5KQogICAgICAgIC5hdHRyKCJzdHJva2Utb3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSkKICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIChjb25maWcudHJlZU9wYWNpdHkgPT0gMSkgPyAiYXV0byIgOiAibm9uZSI7CiAgICAgICAgfSk7CiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubGluayIpCiAgICAgICAgLmF0dHIoImZpbGwtb3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSkKICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCBjb25maWcudHJlZU9wYWNpdHkpCiAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAoY29uZmlnLnRyZWVPcGFjaXR5ID09IDEpID8gImF1dG8iIDogIm5vbmUiOwogICAgICAgIH0pOwogICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGVMYWJlbCIpCiAgICAgICAgLmF0dHIoImZpbGwtb3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSk7CiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKQogICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCBjb25maWcuZ3JhcGhPcGFjaXR5KQogICAgICAgIC5hdHRyKCJzdHJva2Utb3BhY2l0eSIsIGNvbmZpZy5ncmFwaE9wYWNpdHkpCiAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAoY29uZmlnLmdyYXBoT3BhY2l0eSA9PSAxKSA/ICJhdXRvIiA6ICJub25lIjsKICAgICAgICB9KTsKICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubGluayIpCiAgICAgICAgLmF0dHIoImZpbGwtb3BhY2l0eSIsIGNvbmZpZy5ncmFwaE9wYWNpdHkpCiAgICAgICAgLmF0dHIoInN0cm9rZS1vcGFjaXR5IiwgY29uZmlnLmdyYXBoT3BhY2l0eSkKICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIChjb25maWcuZ3JhcGhPcGFjaXR5ID09IDEpID8gImF1dG8iIDogIm5vbmUiOwogICAgICAgIH0pOwogICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5ncmFwaC5ub2RlTGFiZWwiKQogICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCBjb25maWcuZ3JhcGhPcGFjaXR5KTsKCiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLmZvcmNlRGlyZWN0ZWRJY29uIikuYXR0cigib3BhY2l0eSIsIGNvbmZpZy50cmVlT3BhY2l0eSk7CiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnBoeWxvZ2VueUljb24iKS5hdHRyKCJvcGFjaXR5IiwgY29uZmlnLmdyYXBoT3BhY2l0eSk7CgogICAgY29uZmlnLnN3aXRjaFZpZXcgPSAhY29uZmlnLnN3aXRjaFZpZXc7Cn0KCi8qIGZ1bmN0aW9uIHRvIHBsb3QgdHJlZS9ncmFwaCBzY2FsZWQgYnkgZWRnZSBkaXN0YW5jZXMKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9zY2FsZVRyZWUoY3VyVml6T2JqKSB7CiAgICB2YXIgaGFsZl9yb3dIZWlnaHQgPSAoY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0LzIpOyAvLyBoYWxmIHRoZSBoZWlnaHQgb2Ygb25lIGhlYXRtYXAgcm93CiAgICBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5kaXN0T24gPSAhY3VyVml6T2JqLmdlbmVyYWxDb25maWcuZGlzdE9uOwoKICAgIC8vIFNDQUxFIG5vZGVzICYgbGFiZWxzCiAgICBpZiAoY3VyVml6T2JqLmdlbmVyYWxDb25maWcuZGlzdE9uKSB7CiAgICAgICAgLy8gbWFyayB0aGlzIGJ1dHRvbiBhcyBydWxlckJ1dHRvblNlbGVjdGVkCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5ydWxlckJ1dHRvbiIpLmNsYXNzZWQoInJ1bGVyQnV0dG9uU2VsZWN0ZWQiLCB0cnVlKTsgCgogICAgICAgIC8vIG1vdmUgbm9kZXMgdG8gdGhlaXIgc2NhbGVkIGxvY2FkdGlvbgogICAgICAgIGN1clZpek9iai52aWV3LnRyZWVTVkcuc2VsZWN0QWxsKCIudHJlZU5vZGVzRyIpCiAgICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICB2YXIgZHggPSBjdXJWaXpPYmouZGF0YS54Q29vcmRpbmF0ZXNEaXN0W2Quc2NfaWRdIC0gY3VyVml6T2JqLmRhdGEueENvb3JkaW5hdGVzW2Quc2NfaWRdOwogICAgICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoIiArIGR4ICsgIiwwKSI7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAvLyBzY2FsZSBvciB1bnNjYWxlIGxpbmtzCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi50cmVlLmxpbmsiKSAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAuYXR0cigiZCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfZ2V0RWxib3coY3VyVml6T2JqLCBkLCBoYWxmX3Jvd0hlaWdodCk7CiAgICAgICAgICAgIH0pOwogICAgfQoKICAgIC8vIFVOU0NBTEUgbm9kZXMgJiBsYWJlbHMKICAgIGVsc2UgewogICAgICAgIC8vIHJlbW92ZSAicnVsZXJCdXR0b25TZWxlY3RlZCIgY2xhc3MgZnJvbSBidXR0b24KICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdCgiLnJ1bGVyQnV0dG9uIikuY2xhc3NlZCgicnVsZXJCdXR0b25TZWxlY3RlZCIsIGZhbHNlKTsgCgogICAgICAgIC8vIHJlc2V0IGNvbG91ciBvZiB0aGUgYnJ1c2ggc2Npc3NvcnMgYnV0dG9uCiAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi5ydWxlckJ1dHRvbiIpLmF0dHIoImZpbGwiLCBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50b3BCYXJDb2xvdXIpOwoKICAgICAgICAvLyBtb3ZlIG5vZGVzIHRvIHRoZWlyIHVuc2NhbGVkIHBvc2l0aW9uCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi50cmVlTm9kZXNHIikKICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoMCwwKSIpOwoKICAgICAgICAvLyBzY2FsZSBvciB1bnNjYWxlIGxpbmtzCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHJlZVNWRy5zZWxlY3RBbGwoIi50cmVlLmxpbmsiKSAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAuYXR0cigiZCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfZ2V0RWxib3coY3VyVml6T2JqLCBkLCBoYWxmX3Jvd0hlaWdodCk7CiAgICAgICAgICAgIH0pOwogICAgfQoKICAgIAogICAgLy8gc2NhbGUgb3IgdW5zY2FsZSBncmFwaAogICAgX3JlUGxvdEZvcmNlTGF5b3V0KGN1clZpek9iaik7Cn0KCi8vIEdST1VQIEFOTk9UQVRJT04gRlVOQ1RJT05TCgovKiBmdW5jdGlvbiB0byBnZXQgYSBnZW5vdHlwZSBhbm5vdGF0aW9uIGZvciBhIGdpdmVuIHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIHtBcnJheX0gc2NfYW5ub3QgLS0gc2luZ2xlIGNlbGwgYW5ub3RhdGlvbnMgcHJvdmlkZWQgYnkgdXNlcgoqIEBwYXJhbSB7U3RyaW5nfSBzY19pZCAtLSBzaW5nbGUgY2VsbCBpZAoqLwpmdW5jdGlvbiBfZ2V0R2Vub3R5cGUoc2NfYW5ub3QsIHNjX2lkKSB7CiAgICAvLyB0aGVyZSBhcmUgc2luZ2xlIGNlbGwgYW5ub3RhdGlvbnMgcHJvdmlkZWQgYnkgdXNlcgogICAgaWYgKHNjX2Fubm90KSB7CiAgICAgICAgdmFyIHNjX3dfZ3R5cGUgPSBfLmZpbmRXaGVyZShzY19hbm5vdCwgeyJzaW5nbGVfY2VsbF9pZCI6IHNjX2lkfSk7CiAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBhbm5vdGF0aW9uIGZvciB0aGlzIHNpbmdsZSBjZWxsLCByZXR1cm4gaXQsIG90aGVyd2lzZSByZXR1cm4gIm5vbmUiCiAgICAgICAgcmV0dXJuIChzY193X2d0eXBlKSA/IHNjX3dfZ3R5cGUuZ2Vub3R5cGUgOiAibm9uZSI7CiAgICB9CiAgICBlbHNlIHsKICAgICAgICByZXR1cm4gIm5vbmUiOwogICAgfQp9CgovKiBmdW5jdGlvbiB0byBnZXQgYSB0aW1lcG9pbnQgYW5ub3RhdGlvbiBmb3IgYSBnaXZlbiBzaW5nbGUgY2VsbCBpZAoqIEBwYXJhbSB7QXJyYXl9IHNjX2Fubm90IC0tIHNpbmdsZSBjZWxsIGFubm90YXRpb25zIHByb3ZpZGVkIGJ5IHVzZXIKKiBAcGFyYW0ge1N0cmluZ30gc2NfaWQgLS0gc2luZ2xlIGNlbGwgaWQKKi8KZnVuY3Rpb24gX2dldFRQKHNjX2Fubm90LCBzY19pZCkgewogICAgLy8gdGhlcmUgYXJlIHNpbmdsZSBjZWxsIGFubm90YXRpb25zIHByb3ZpZGVkIGJ5IHVzZXIKICAgIGlmIChzY19hbm5vdCkgewogICAgICAgIHZhciBzY193X2d0eXBlID0gXy5maW5kV2hlcmUoc2NfYW5ub3QsIHsic2luZ2xlX2NlbGxfaWQiOiBzY19pZH0pOwogICAgICAgIC8vIGlmIHRoZXJlJ3MgYW4gYW5ub3RhdGlvbiBmb3IgdGhpcyBzaW5nbGUgY2VsbCwgcmV0dXJuIGl0LCBvdGhlcndpc2UgcmV0dXJuICJub25lIgogICAgICAgIHJldHVybiAoc2Nfd19ndHlwZSAmJiBzY193X2d0eXBlLnRpbWVwb2ludCkgPyBzY193X2d0eXBlLnRpbWVwb2ludCA6ICJub25lIjsKICAgIH0KICAgIGVsc2UgewogICAgICAgIHJldHVybiAibm9uZSI7CiAgICB9Cn0KCi8qIGZ1bmN0aW9uIHRvIGdldCBnZW5vdHlwZSBhbm5vdGF0aW9ucyBhcyBvYmplY3Qgdy9wcm9wZXJ0aWVzIGdlbm90eXBlIDogW2FycmF5IG9mIHNpbmdsZSBjZWxsc10KKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9yZWZvcm1hdEdyb3VwQW5ub3RzKGN1clZpek9iaikgewogICAgdmFyIGd0eXBlcyA9IHt9OwoKICAgIGN1clZpek9iai51c2VyQ29uZmlnLnNjX2Fubm90LmZvckVhY2goZnVuY3Rpb24oc2MpIHsKICAgICAgICBpZiAoIWd0eXBlc1tzYy5nZW5vdHlwZV0pIHsKICAgICAgICAgICAgZ3R5cGVzW3NjLmdlbm90eXBlXSA9IFtdOwogICAgICAgIH0KICAgICAgICBndHlwZXNbc2MuZ2Vub3R5cGVdLnB1c2goc2Muc2luZ2xlX2NlbGxfaWQpOwogICAgfSk7CgogICAgY3VyVml6T2JqLmRhdGEuZ3R5cGVzID0gZ3R5cGVzOwp9CgovKiBmdW5jdGlvbiB0byB0cmFuc2xhdGUgdGhlIHNpbmdsZSBjZWxsIGhlYXRtYXAgcHJvZmlsZSB0byBhIG5ldyBsb2NhdGlvbgoqIEBwYXJhbSB2aWV3X2lkIC0tIGN1cnJlbnQgdmlldyBpZAoqIEBwYXJhbSBzY19pZCAtLSBjdXJyZW50IHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIGRpZmZfeSAtLSB0aGUgeS1jb29yZGluYXRlIGRpZmZlcmVuY2UgZm9yIHRoaXMgY2VsbAoqLwpmdW5jdGlvbiBfdHJhbnNsYXRlU0NIZWF0bWFwUHJvZmlsZSh2aWV3X2lkLCBzY19pZCwgZGlmZl95KSB7CiAgICAvLyB0cmFuc2xhdGUgY29weSBudW1iZXIgcHJvZmlsZSAmIGluZGljYXRvcgogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmdyaWRDZWxsRy5zY18iICsgc2NfaWQpCiAgICAgICAgLnRyYW5zaXRpb24oKQogICAgICAgIC5kdXJhdGlvbigxMDAwKQogICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMCwiICsgZGlmZl95ICsgIikiOwogICAgICAgIH0pOwogICAgCiAgICAvLyB0cmFuc2xhdGUgZ2Vub3R5cGUgYW5ub3RhdGlvbgogICAgaWYgKGN1clZpek9iai52aWV3Lmd0eXBlc1NwZWNpZmllZCkgewogICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5ndHlwZUFubm90LnNjXyIgKyBzY19pZCkKICAgICAgICAgICAgLnRyYW5zaXRpb24oKQogICAgICAgICAgICAuZHVyYXRpb24oMTAwMCkKICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMCwiICsgZGlmZl95ICsgIikiOwogICAgICAgICAgICB9KTsKICAgIH0KICAgIAogICAgLy8gdHJhbnNsYXRlIHRpbWVwb2ludCBhbm5vdGF0aW9uCiAgICBpZiAoY3VyVml6T2JqLnZpZXcudHBzU3BlY2lmaWVkKSB7CiAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRwQW5ub3Quc2NfIiArIHNjX2lkKQogICAgICAgICAgICAudHJhbnNpdGlvbigpCiAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKQogICAgICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gInRyYW5zbGF0ZSgwLCIgKyBkaWZmX3kgKyAiKSI7CiAgICAgICAgICAgIH0pOwogICAgfQoKICAgIC8vIHRyYW5zbGF0ZSBpbmRpY2F0b3IKICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5pbmRpYy5zY18iICsgc2NfaWQpCiAgICAgICAgLnRyYW5zaXRpb24oKQogICAgICAgIC5kdXJhdGlvbigxMDAwKQogICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICJ0cmFuc2xhdGUoMCwiICsgZGlmZl95ICsgIikiOwogICAgICAgIH0pOwp9CgovKiBmdW5jdGlvbiB0byB0cmFuc2xhdGUgc2luZ2xlIGNlbGwgbm9kZQoqIEBwYXJhbSB2aWV3X2lkIC0tIGN1cnJlbnQgdmlldyBpZAoqIEBwYXJhbSBzY19pZCAtLSBjdXJyZW50IHNpbmdsZSBjZWxsIGlkCiogQHBhcmFtIGRpZmZfeSAtLSB0aGUgRlVMTCB5LWNvb3JkaW5hdGUgdHJhbnNsYXRpb24gZm9yIHRoaXMgY2VsbAoqLwpmdW5jdGlvbiBfdHJhbnNsYXRlU0NOb2RlKHZpZXdfaWQsIHNjX2lkLCBkaWZmX3kpIHsKCiAgICAvLyB0cmFuc2xhdGUgYWxpZ25lZCB0cmVlIG5vZGVzCiAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudHJlZS5ub2RlLm5vZGVfIiArIHNjX2lkKQogICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAuZHVyYXRpb24oMTAwMCkKICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHJldHVybiAgInRyYW5zbGF0ZSgwLCIgKyBkaWZmX3kgKyAiKSI7CiAgICAgICAgfSk7CgogICAgLy8gdHJhbnNsYXRlIGFsaWduZWQgdHJlZSBub2RlIGxhYmVscwogICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRyZWUubm9kZUxhYmVsLm5vZGVMYWJlbF8iICsgc2NfaWQpCiAgICAgICAgLnRyYW5zaXRpb24oKQogICAgICAgIC5kdXJhdGlvbigxMDAwKQogICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuICAidHJhbnNsYXRlKDAsIiArIGRpZmZfeSArICIpIjsKICAgICAgICB9KTsKfQoKLy8gQ05WIEZVTkNUSU9OUwoKLyogZnVuY3Rpb24gdG8gdXBkYXRlIGNvcHkgbnVtYmVyIG1hdHJpeCB1cG9uIHRyaW1taW5nCiogQHBhcmFtIHJlbW92YWxfaGVpZ2h0IC0tIGhlaWdodCBvZiBzaW5nbGUgY2VsbCBwaHlsb2dlbnkgdGhhdCB3YXMgcmVtb3ZlZAoqIEBwYXJhbSByZW1vdmVkX2NlbGxfbWF4X3kgLS0gdGhlIG1heGltdW0geS12YWx1ZSBvZiB0aGUgcmVtb3ZlZCBjZWxsCiogQHBhcmFtIHJlbW92ZWRfc2NzIC0tIHRoZSBjZWxscyB0aGF0IHdlcmUganVzdCByZW1vdmVkCiovCmZ1bmN0aW9uIF91cGRhdGVUcmltbWVkTWF0cml4KGN1clZpek9iaiwgcmVtb3ZhbF9oZWlnaHQsIHJlbW92ZWRfY2VsbF9tYXhfeSwgcmVtb3ZlZF9zY3MpIHsKICAgIHZhciBjb25maWcgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKICAgICAgICBoYWxmX3Jvd0hlaWdodCA9IChjdXJWaXpPYmoudmlldy5obS5yb3dIZWlnaHQvMik7CgogICAgLy8gZm9yIGVhY2ggc2luZ2xlIGNlbGwgdGhhdCdzIHN0aWxsIGluIHRoZSBtYXRyaXgKICAgIGN1clZpek9iai5kYXRhLmhtX3NjX2lkcy5mb3JFYWNoKGZ1bmN0aW9uKHNjX2lkKSB7CgogICAgICAgIHZhciB0X3kgPSBfZ2V0VHJlZU5vZGVZVHJhbnNsYXRpb24oY3VyVml6T2JqLnZpZXdfaWQsIHNjX2lkKTsKICAgICAgICB2YXIgY3VyX3kgPSBwYXJzZUZsb2F0KGQzLnNlbGVjdCgiLnRyZWUubm9kZS5ub2RlXyIgKyBzY19pZCkuYXR0cigiY3kiKSkgKyB0X3k7CiAgICAgICAgCiAgICAgICAgLy8gaWYgdGhpcyBjZWxsIGlzIGJlbG93IHRoZSBsYXN0IGN1dCBjZWxsLCB0cmFuc2xhdGUgdGhlIHNpbmdsZSBjZWxsIHByb2ZpbGUgaW4gdGhlIGhlYXRtYXAgYW5kIHRoZSBub2RlIGluIHRoZSB0cmVlCiAgICAgICAgaWYgKGN1cl95ID4gcmVtb3ZlZF9jZWxsX21heF95KSB7CiAgICAgICAgICAgIGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tzY19pZF0gPSBjdXJfeSAtIHJlbW92YWxfaGVpZ2h0IC0gaGFsZl9yb3dIZWlnaHQ7CiAgICAgICAgICAgIGlmIChjdXJWaXpPYmouZGF0YS5obV9zY19pZHMuaW5kZXhPZihzY19pZCkgIT0gLTEpIHsKICAgICAgICAgICAgICAgIF90cmFuc2xhdGVTQ0hlYXRtYXBQcm9maWxlKGN1clZpek9iai52aWV3X2lkLCBzY19pZCwgLXJlbW92YWxfaGVpZ2h0ICsgdF95KTsgLy8gaWYgdGhpcyBzYyBpcyBpbiB0aGUgaGVhdG1hcAogICAgICAgICAgICB9CiAgICAgICAgICAgIF90cmFuc2xhdGVTQ05vZGUoY3VyVml6T2JqLnZpZXdfaWQsIHNjX2lkLCAtcmVtb3ZhbF9oZWlnaHQgKyB0X3kpOwogICAgICAgIH0KICAgICAgICBlbHNlIHsKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEueUNvb3JkaW5hdGVzW3NjX2lkXSA9IGN1cl95IC0gaGFsZl9yb3dIZWlnaHQ7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gZm9yIGVhY2ggbGF0ZW50IGNlbGwsIGdldCBpdHMgbmV3IHktY29vcmRpbmF0ZSBhbmQgcGxvdCBpdAogICAgX2dldFlDb29yZGluYXRlc0xhdGVudE5vZGVzKGN1clZpek9iaiwgJC5leHRlbmQoW10sIGN1clZpek9iai5kYXRhLmhtX3NjX2lkcyksIGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlcyk7CiAgICBjdXJWaXpPYmouZGF0YS5taXNzaW5nX3Njc190b19wbG90LmZvckVhY2goZnVuY3Rpb24oc2NfaWQpIHsKICAgICAgICB2YXIgb2xkX3kgPSBfZ2V0VHJlZU5vZGVZQ29vcmQoY3VyVml6T2JqLnZpZXdfaWQsIHNjX2lkKSAtIGhhbGZfcm93SGVpZ2h0OwogICAgICAgIHZhciBvbGRfdHJhbnNsYXRpb24gPSBfZ2V0VHJlZU5vZGVZVHJhbnNsYXRpb24oY3VyVml6T2JqLnZpZXdfaWQsIHNjX2lkKTsKICAgICAgICB2YXIgbmV3X3kgPSBjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXNbc2NfaWRdOwogICAgICAgIF90cmFuc2xhdGVTQ05vZGUoY3VyVml6T2JqLnZpZXdfaWQsIHNjX2lkLCAobmV3X3ktb2xkX3krb2xkX3RyYW5zbGF0aW9uKSk7CiAgICB9KTsKCiAgICAvLyB0cmFuc2xhdGUgYWxpZ25lZCB0cmVlIGxpbmsgZm9yIHRoZSBlZGdlIGp1c3QgYmVsb3cgdGhlIGRlbGV0aW9uCiAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubGluayIpIAogICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAuZHVyYXRpb24oMTAwMCkgICAgICAgCiAgICAgICAgLmF0dHIoImQiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgIHJldHVybiBfZ2V0RWxib3coY3VyVml6T2JqLCBkLCBoYWxmX3Jvd0hlaWdodCk7CiAgICAgICAgfSk7CgogICAgLy8gbW92ZSBjaHJvbW9zb21lIGxlZ2VuZCB1cAogICAgY3VyVml6T2JqLmdlbmVyYWxDb25maWcuY2hyb21MZWdlbmRTdGFydFlDb29yZCAtPSByZW1vdmFsX2hlaWdodDsKICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0QWxsKCIuY2hyb21Cb3giKQogICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAuZHVyYXRpb24oMTAwMCkKICAgICAgICAuYXR0cigieSIsIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLmNocm9tTGVnZW5kU3RhcnRZQ29vcmQpOwogICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5jaHJvbUJveFRleHQiKQogICAgICAgIC50cmFuc2l0aW9uKCkKICAgICAgICAuZHVyYXRpb24oMTAwMCkKICAgICAgICAuYXR0cigieSIsIGN1clZpek9iai5nZW5lcmFsQ29uZmlnLmNocm9tTGVnZW5kU3RhcnRZQ29vcmQgKyAoY29uZmlnLmNocm9tTGVnZW5kSGVpZ2h0IC8gMikpOwp9CgovKiBmdW5jdGlvbiB0byBnZXQgY2hyb21vc29tZSBtaW4gYW5kIG1heCB2YWx1ZXMKKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCiovCmZ1bmN0aW9uIF9nZXRDaHJvbUJvdW5kcyhjdXJWaXpPYmopIHsKICAgIHZhciBjaHJvbXMgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5jaHJvbXM7CiAgICB2YXIgY2hyb21fYm91bmRzID0ge307CgogICAgLy8gZm9yIGVhY2ggY2hyb21vc29tZQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHJvbXMubGVuZ3RoOyBpKyspIHsKCiAgICAgICAgLy8gZ2V0IGFsbCB0aGUgc3RhcnRzIGFuZCBlbmRzIG9mIHNlZ21lbnRzIGZvciB0aGlzIGNocm9tb3NvbWUKICAgICAgICB2YXIgY3VyX2Nocm9tX2RhdGEgPSBfLmZpbHRlcihjdXJWaXpPYmoudXNlckNvbmZpZy5jbnZfZGF0YSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oY252KXsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY252LmNociA9PSBjaHJvbXNbaV07IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgIHZhciBjdXJfc3RhcnRzID0gXy5wbHVjayhjdXJfY2hyb21fZGF0YSwgInN0YXJ0Iik7CiAgICAgICAgdmFyIGN1cl9lbmRzID0gXy5wbHVjayhjdXJfY2hyb21fZGF0YSwgImVuZCIpOwoKICAgICAgICAvLyBmaW5kIHRoZSBtaW4gYW5kIG1heCBib3VuZHMgb2YgdGhpcyBjaHJvbW9zb21lCiAgICAgICAgY2hyb21fYm91bmRzW2Nocm9tc1tpXV0gPSB7CiAgICAgICAgICAgICJzdGFydCI6IE1hdGgubWluKC4uLmN1cl9zdGFydHMpLAogICAgICAgICAgICAiZW5kIjogTWF0aC5tYXgoLi4uY3VyX2VuZHMpCiAgICAgICAgfTsKICAgIH0KCiAgICByZXR1cm4gY2hyb21fYm91bmRzOwp9CgovLyBDT0xPVVIgRlVOQ1RJT05TCgoKLyogZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGdlbm90eXBlIGNvbG91cnMgYmFzZWQgb24gcGh5bG9nZW55IAoqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogLS0gdml6T2JqIGZvciB0aGUgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9nZXRQaHlsb0NvbG91cnMoY3VyVml6T2JqKSB7CgogICAgdmFyIGNvbG91cl9hc3NpZ25tZW50ID0ge30sIC8vIHN0YW5kYXJkIGNvbG91ciBhc3NpZ25tZW50CiAgICAgICAgYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSB7fSwgLy8gYWxwaGEgY29sb3VyIGFzc2lnbm1lbnQKICAgICAgICBjbG9uZV9jb2xzID0gY3VyVml6T2JqLnVzZXJDb25maWcuY2xvbmVfY29sczsKCiAgICAvLyBjbG9uZSBjb2xvdXJzIHNwZWNpZmllZAogICAgaWYgKGNsb25lX2NvbHMgIT0gIk5BIikgewogICAgICAgIC8vIGdldCBjb2xvdXIgYXNzaWdubWVudCAtIHVzZSBzcGVjaWZpZWQgY29sb3VycwogICAgICAgIC8vIGhhbmRsaW5nIGRpZmZlcmVudCBpbnB1dHMgLS0gVE9ETyBzaG91bGQgcHJvYmFibHkgYmUgZG9uZSBpbiBSCiAgICAgICAgY2xvbmVfY29scy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCwgY29sX2lkeCkgewogICAgICAgICAgICB2YXIgY29sX3ZhbHVlID0gY29sLmNvbG91cjsKICAgICAgICAgICAgaWYgKGNvbF92YWx1ZVswXSAhPSAiIyIpIHsgLy8gYXBwZW5kIGEgaGFzaHRhZyBpZiBuZWNlc3NhcnkKICAgICAgICAgICAgICAgIGNvbF92YWx1ZSA9ICIjIi5jb25jYXQoY29sX3ZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29sX3ZhbHVlLmxlbmd0aCA+IDcpIHsgLy8gcmVtb3ZlIGFueSBhbHBoYSB0aGF0IG1heSBiZSBwcmVzZW50IGluIHRoZSBoZXggdmFsdWUKICAgICAgICAgICAgICAgIGNvbF92YWx1ZSA9IGNvbF92YWx1ZS5zdWJzdHJpbmcoMCw3KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtjb2wuY2xvbmVfaWRdID0gY29sX3ZhbHVlOwogICAgICAgIH0pOwogICAgfQoKICAgIC8vIGNsb25lIGNvbG91cnMgbm90IHNwZWNpZmllZAogICAgZWxzZSB7CgogICAgICAgIHZhciBzID0gMC44OCwgLy8gc2F0dXJhdGlvbgogICAgICAgICAgICBsID0gMC43NzsgLy8gbGlnaHRuZXNzCgogICAgICAgIC8vIG51bWJlciBvZiBub2RlcwogICAgICAgIHZhciBuX25vZGVzID0gY3VyVml6T2JqLmRhdGEuZ3R5cGVUcmVlQ2hhaW5Sb290cy5sZW5ndGg7CgogICAgICAgIC8vIGNvbG91ciBlYWNoIHRyZWUgY2hhaW4gcm9vdCBhIHNlcXVlbnRpYWwgY29sb3VyIGZyb20gdGhlIHNwZWN0cnVtCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuX25vZGVzOyBpKyspIHsKICAgICAgICAgICAgdmFyIGN1cl9ub2RlID0gY3VyVml6T2JqLmRhdGEuZ3R5cGVUcmVlQ2hhaW5Sb290c1tpXTsKICAgICAgICAgICAgdmFyIGggPSAoaS9uX25vZGVzICsgMC45NikgJSAxOwogICAgICAgICAgICB2YXIgcmdiID0gX2hzbFRvUmdiKGgsIHMsIGwpOyAvLyBoc2wgdG8gcmdiCiAgICAgICAgICAgIHZhciBjb2wgPSBfcmdiMmhleCgicmdiKCIgKyByZ2JbMF0gKyAiLCIgKyByZ2JbMV0gKyAiLCIgKyByZ2JbMl0gKyAiKSIpOyAvLyByZ2IgdG8gaGV4CgogICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtjdXJfbm9kZV0gPSBjb2w7CgogICAgICAgICAgICAvLyBmb3IgZWFjaCBvZiB0aGUgY2hhaW4ncyBkZXNjZW5kYW50cwogICAgICAgICAgICB2YXIgcHJldl9jb2xvdXIgPSBjb2w7CiAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmd0eXBlVHJlZUNoYWluc1tjdXJfbm9kZV0uZm9yRWFjaChmdW5jdGlvbihkZXNjLCBkZXNjX2kpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHdlJ3JlIG9uIHRoZSBwaGFudG9tIHJvb3QncyBicmFuY2ggYW5kIGl0J3MgdGhlIGZpcnN0IGRlc2NlbmRhbnQKICAgICAgICAgICAgICAgIGlmIChjdXJfbm9kZSA9PSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdCAmJiBkZXNjX2kgPT09IDApIHsKCiAgICAgICAgICAgICAgICAgICAgLy8gZG8gbm90IGRlY3JlYXNlIHRoZSBicmlnaHRuZXNzCiAgICAgICAgICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRbZGVzY10gPSBwcmV2X2NvbG91cjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHdlJ3JlIG5vdCBvbiB0aGUgcGhhbnRvbSByb290IGJyYW5jaCdzIGZpcnN0IGRlc2NlbmRhbnQKICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIGNvbG91ciB0aGUgZGVzY2VuZGFudCBhIGxpZ2h0ZXIgdmVyc2lvbiBvZiB0aGUgcHJldmlvdXMgY29sb3VyIGluIHRoZSBjaGFpbgogICAgICAgICAgICAgICAgICAgIGNvbG91cl9hc3NpZ25tZW50W2Rlc2NdID0gCiAgICAgICAgICAgICAgICAgICAgICAgIF9kZWNyZWFzZV9icmlnaHRuZXNzKHByZXZfY29sb3VyLCAyMCk7CgogICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgcHJldmlvdXMgY29sb3VyIHRvIHRoZSBsaWdodGVuZWQgY29sb3VyCiAgICAgICAgICAgICAgICAgICAgcHJldl9jb2xvdXIgPSBjb2xvdXJfYXNzaWdubWVudFtkZXNjXTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgfQogICAgfQoKCiAgICAvLyBnZXQgdGhlIGFscGhhIGNvbG91ciBhc3NpZ25tZW50CiAgICBPYmplY3Qua2V5cyhjb2xvdXJfYXNzaWdubWVudCkuZm9yRWFjaChmdW5jdGlvbihrZXksIGtleV9pZHgpIHsKICAgICAgICBhbHBoYV9jb2xvdXJfYXNzaWdubWVudFtrZXldID0gCiAgICAgICAgICAgIF9pbmNyZWFzZV9icmlnaHRuZXNzKGNvbG91cl9hc3NpZ25tZW50W2tleV0sIGN1clZpek9iai51c2VyQ29uZmlnLmFscGhhKTsKICAgIH0pOwoKICAgIHJldHVybiB7ImNvbG91cl9hc3NpZ25tZW50IjogY29sb3VyX2Fzc2lnbm1lbnQsICJhbHBoYV9jb2xvdXJfYXNzaWdubWVudCI6IGFscGhhX2NvbG91cl9hc3NpZ25tZW50fTsKfQoKLyogZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGNvbG91cnMgZm9yIGdlbm90eXBlcyAobm90IGJhc2VkIG9uIHBoeWxvZ2VueSkKKiBAcGFyYW0ge0FycmF5fSBndHlwZXMgLS0gZ3R5cGVzIGluIGRhdGFzZXQsIGZvciB3aGljaCB3ZSBuZWVkIGNvbG91cnMKKiBAcGFyYW0ge09iamVjdH0gY2xvbmVfY29scyAtLSBjb2xvdXJzIGZvciBlYWNoIGNsb25lIChzcGVjaWZpZWQgYnkgdXNlcikKKi8KZnVuY3Rpb24gX2dldEd0eXBlQ29sb3VycyhndHlwZXMsIGNsb25lX2NvbHMpIHsKCiAgICB2YXIgY29sb3VyX2Fzc2lnbm1lbnQgPSB7fSwKICAgICAgICBhbHBoYV9jb2xvdXJfYXNzaWdubWVudCA9IHt9OwoKICAgIC8vIGNsb25lIGNvbG91cnMgc3BlY2lmaWVkCiAgICBpZiAoY2xvbmVfY29scyAhPSAiTkEiKSB7CiAgICAgICAgLy8gZ2V0IGNvbG91ciBhc3NpZ25tZW50IC0gdXNlIHNwZWNpZmllZCBjb2xvdXJzCiAgICAgICAgLy8gaGFuZGxpbmcgZGlmZmVyZW50IGlucHV0cyAtLSBUT0RPIHNob3VsZCBwcm9iYWJseSBiZSBkb25lIGluIFIKICAgICAgICBjbG9uZV9jb2xzLmZvckVhY2goZnVuY3Rpb24oY29sLCBjb2xfaWR4KSB7CiAgICAgICAgICAgIHZhciBjb2xfdmFsdWUgPSBjb2wuY29sb3VyOwogICAgICAgICAgICBpZiAoY29sX3ZhbHVlWzBdICE9ICIjIikgeyAvLyBhcHBlbmQgYSBoYXNodGFnIGlmIG5lY2Vzc2FyeQogICAgICAgICAgICAgICAgY29sX3ZhbHVlID0gIiMiLmNvbmNhdChjb2xfdmFsdWUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb2xfdmFsdWUubGVuZ3RoID4gNykgeyAvLyByZW1vdmUgYW55IGFscGhhIHRoYXQgbWF5IGJlIHByZXNlbnQgaW4gdGhlIGhleCB2YWx1ZQogICAgICAgICAgICAgICAgY29sX3ZhbHVlID0gY29sX3ZhbHVlLnN1YnN0cmluZygwLDcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbG91cl9hc3NpZ25tZW50W2NvbC5jbG9uZV9pZF0gPSBjb2xfdmFsdWU7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gY2xvbmUgY29sb3VycyBub3Qgc3BlY2lmaWVkCiAgICBlbHNlIHsKCiAgICAgICAgdmFyIHMgPSAwLjk1LCAvLyBzYXR1cmF0aW9uCiAgICAgICAgICAgIGwgPSAwLjc2OyAvLyBsaWdodG5lc3MKCiAgICAgICAgLy8gbnVtYmVyIG9mIG5vZGVzCiAgICAgICAgdmFyIG5fbm9kZXMgPSBndHlwZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5fbm9kZXM7IGkrKykgewogICAgICAgICAgICB2YXIgaCA9IGkvbl9ub2RlczsKICAgICAgICAgICAgdmFyIHJnYiA9IF9oc2xUb1JnYihoLCBzLCBsKTsgLy8gaHNsIHRvIHJnYgogICAgICAgICAgICB2YXIgY29sID0gX3JnYjJoZXgoInJnYigiICsgcmdiWzBdICsgIiwiICsgcmdiWzFdICsgIiwiICsgcmdiWzJdICsgIikiKTsgLy8gcmdiIHRvIGhleAoKICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRbZ3R5cGVzW2ldXSA9IGNvbDsKICAgICAgICB9CiAgICB9CgogICAgLy8gZ2V0IHRoZSBhbHBoYSBjb2xvdXIgYXNzaWdubWVudAogICAgT2JqZWN0LmtleXMoY29sb3VyX2Fzc2lnbm1lbnQpLmZvckVhY2goZnVuY3Rpb24oa2V5LCBrZXlfaWR4KSB7CiAgICAgICAgYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnRba2V5XSA9IAogICAgICAgICAgICBfaW5jcmVhc2VfYnJpZ2h0bmVzcyhjb2xvdXJfYXNzaWdubWVudFtrZXldLCAzMCk7CiAgICB9KTsKCiAgICByZXR1cm4geyJjb2xvdXJfYXNzaWdubWVudCI6IGNvbG91cl9hc3NpZ25tZW50LCAiYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQiOiBhbHBoYV9jb2xvdXJfYXNzaWdubWVudH07IAp9CgovKioKICogQ29udmVydHMgYW4gSFNMIGNvbG9yIHZhbHVlIHRvIFJHQi4gQ29udmVyc2lvbiBmb3JtdWxhCiAqIGFkYXB0ZWQgZnJvbSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0hTTF9jb2xvcl9zcGFjZS4KICogQXNzdW1lcyBoLCBzLCBhbmQgbCBhcmUgY29udGFpbmVkIGluIHRoZSBzZXQgWzAsIDFdIGFuZAogKiByZXR1cm5zIHIsIGcsIGFuZCBiIGluIHRoZSBzZXQgWzAsIDI1NV0uCiAqCiAqIEBwYXJhbSAgIE51bWJlciAgaCAgICAgICBUaGUgaHVlCiAqIEBwYXJhbSAgIE51bWJlciAgcyAgICAgICBUaGUgc2F0dXJhdGlvbgogKiBAcGFyYW0gICBOdW1iZXIgIGwgICAgICAgVGhlIGxpZ2h0bmVzcwogKiBAcmV0dXJuICBBcnJheSAgICAgICAgICAgVGhlIFJHQiByZXByZXNlbnRhdGlvbgogKi8KZnVuY3Rpb24gX2hzbFRvUmdiKGgsIHMsIGwpewogICAgdmFyIHIsIGcsIGI7CgogICAgaWYocyA9PT0gMCl7CiAgICAgICAgciA9IGcgPSBiID0gbDsgLy8gYWNocm9tYXRpYwogICAgfWVsc2V7CiAgICAgICAgdmFyIGh1ZTJyZ2IgPSBmdW5jdGlvbiBodWUycmdiKHAsIHEsIHQpewogICAgICAgICAgICBpZih0IDwgMCkgdCArPSAxOwogICAgICAgICAgICBpZih0ID4gMSkgdCAtPSAxOwogICAgICAgICAgICBpZih0IDwgMS82KSByZXR1cm4gcCArIChxIC0gcCkgKiA2ICogdDsKICAgICAgICAgICAgaWYodCA8IDEvMikgcmV0dXJuIHE7CiAgICAgICAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7CiAgICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0KCiAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwogICAgICAgIHZhciBwID0gMiAqIGwgLSBxOwogICAgICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxLzMpOwogICAgICAgIGcgPSBodWUycmdiKHAsIHEsIGgpOwogICAgICAgIGIgPSBodWUycmdiKHAsIHEsIGggLSAxLzMpOwogICAgfQoKICAgIHJldHVybiBbTWF0aC5yb3VuZChyICogMjU1KSwgTWF0aC5yb3VuZChnICogMjU1KSwgTWF0aC5yb3VuZChiICogMjU1KV07Cn0KCgovLyBjb252ZXJ0IFJHQiB0byBoZXgKLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzQwNzAwL2dldC1oZXgtdmFsdWUtcmF0aGVyLXRoYW4tcmdiLXZhbHVlLXVzaW5nLWpxdWVyeQpmdW5jdGlvbiBfcmdiMmhleChyZ2IpIHsKICAgICBpZiAoICByZ2Iuc2VhcmNoKCJyZ2IiKSA9PSAtMSApIHsKICAgICAgICAgIHJldHVybiByZ2I7CiAgICAgfSBlbHNlIHsKICAgICAgICAgIHJnYiA9IHJnYi5tYXRjaCgvXnJnYmE/XCgoXGQrKSxccyooXGQrKSxccyooXGQrKSg/OixccyooXGQrKSk/XCkkLyk7CiAgICAgICAgICBmdW5jdGlvbiBoZXgoeCkgewogICAgICAgICAgICAgICByZXR1cm4gKCIwIiArIHBhcnNlSW50KHgpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICIjIiArIGhleChyZ2JbMV0pICsgaGV4KHJnYlsyXSkgKyBoZXgocmdiWzNdKTsgCiAgICAgfQp9CgovLyBHRU5FUkFMIEZVTkNUSU9OUwoKLyogYWxwaGFudW1lcmljIHNvcnRpbmcgZnVuY3Rpb24KKiBmcm9tOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQzNDAyMjcvc29ydC1taXhlZC1hbHBoYS1udW1lcmljLWFycmF5CiovCmZ1bmN0aW9uIF9zb3J0QWxwaGFOdW0oYSxiKSB7CiAgICB2YXIgcmVBID0gL1teYS16QS1aXS9nOwogICAgdmFyIHJlTiA9IC9bXjAtOV0vZzsKICAgIHZhciBhQSA9IGEucmVwbGFjZShyZUEsICIiKTsKICAgIHZhciBiQSA9IGIucmVwbGFjZShyZUEsICIiKTsKICAgIGlmKGFBID09PSBiQSkgewogICAgICAgIHZhciBhTiA9IHBhcnNlSW50KGEucmVwbGFjZShyZU4sICIiKSwgMTApOwogICAgICAgIHZhciBiTiA9IHBhcnNlSW50KGIucmVwbGFjZShyZU4sICIiKSwgMTApOwogICAgICAgIHJldHVybiBhTiA9PT0gYk4gPyAwIDogYU4gPiBiTiA/IDEgOiAtMTsKICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGFBID4gYkEgPyAxIDogLTE7CiAgICB9Cn0KCgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIG1vZGUgb2YgYW4gYXJyYXkKKiBmcm9tOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEwNTM4NDMvZ2V0LXRoZS1lbGVtZW50LXdpdGgtdGhlLWhpZ2hlc3Qtb2NjdXJyZW5jZS1pbi1hbi1hcnJheQoqIEBwYXJhbSBhcnIgLS0gYXJyYXkgb2YgdmFsdWVzCiovCmZ1bmN0aW9uIF9hcnJheU1vZGUoYXJyKSAKewogICAgaWYoYXJyLmxlbmd0aCA9PT0gMCkKICAgICAgICByZXR1cm4gbnVsbDsKICAgIHZhciBtb2RlTWFwID0ge307CiAgICB2YXIgbWF4RWwgPSBhcnJbMF0sIG1heEludGVuc2l0eSA9IDE7CiAgICBmb3IodmFyIGkgPSAwOyBpIDwgYXJyLmxlbmd0aDsgaSsrKQogICAgewogICAgICAgIHZhciBlbCA9IGFycltpXTsKICAgICAgICBpZihtb2RlTWFwW2VsXSA9PT0gbnVsbCkKICAgICAgICAgICAgbW9kZU1hcFtlbF0gPSAxOwogICAgICAgIGVsc2UKICAgICAgICAgICAgbW9kZU1hcFtlbF0rKzsgIAogICAgICAgIGlmKG1vZGVNYXBbZWxdID4gbWF4SW50ZW5zaXR5KQogICAgICAgIHsKICAgICAgICAgICAgbWF4RWwgPSBlbDsKICAgICAgICAgICAgbWF4SW50ZW5zaXR5ID0gbW9kZU1hcFtlbF07CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIG1heEVsOwp9CgovLyBET1dOTE9BRCBGVU5DVElPTlMKCgovKiBmdW5jdGlvbiB0byBkb3dubG9hZCBQTkcKKiBAcGFyYW0gY2xhc3NOYW1lIC0tIG5hbWUgb2YgdGhlIGNsYXNzIG9mIHRoZSBzdmcgdG8gZG93bmxvYWQgKGUuZy4gIm15U1ZHIikKKiBAcGFyYW0gZmlsZU91dHB1dE5hbWUgLS0gZmlsZW5hbWUgZm9yIG91dHB1dAoqLwpmdW5jdGlvbiBfZG93bmxvYWRQTkcoY2xhc3NOYW1lLCBmaWxlT3V0cHV0TmFtZSkgewogICAgLy8gZ2V0IGN1cnJlbnQgbWFyZ2luIG9mIHN2ZyBlbGVtZW50CiAgICB2YXIgY3VyX21hcmdpbiA9IGQzLnNlbGVjdCgiLiIgKyBjbGFzc05hbWUpLnN0eWxlKCJtYXJnaW4iKTsKCiAgICAvLyB0ZW1wb3JhcmlseSByZW1vdmUgdGhlIG1hcmdpbiBzbyB0aGUgdmlldyBpc24ndCBjdXQgb2ZmCiAgICBkMy5zZWxlY3QoIi4iICsgY2xhc3NOYW1lKQogICAgICAgIC5zdHlsZSgibWFyZ2luIiwgIjBweCIpOwoKICAgIHZhciBodG1sID0gZDMuc2VsZWN0KCIuIiArIGNsYXNzTmFtZSkKICAgICAgICAuYXR0cigidmVyc2lvbiIsIDEuMSkKICAgICAgICAuYXR0cigieG1sbnMiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciKQogICAgICAgIC5ub2RlKCkucGFyZW50Tm9kZS5pbm5lckhUTUw7CgogICAgdmFyIGltZ3NyYyA9ICdkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCcrIGJ0b2EoaHRtbCk7CgogICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImNhbnZhcyIpLAogICAgICAgIGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKCiAgICB2YXIgaW1hZ2UgPSBuZXcgSW1hZ2U7CiAgICBpbWFnZS5zcmMgPSBpbWdzcmM7CiAgICBpbWFnZS5vbmxvYWQgPSBmdW5jdGlvbigpIHsKICAgICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CgogICAgICAgIHZhciBjYW52YXNkYXRhID0gY2FudmFzLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIik7CgogICAgICAgIHZhciBwbmdpbWcgPSAnPGltZyBzcmM9IicrY2FudmFzZGF0YSsnIj4nOyAKCiAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVPdXRwdXROYW1lOwogICAgICAgIGEuaHJlZiA9IGNhbnZhc2RhdGE7CiAgICAgICAgYS5jbGljaygpOwogICAgfTsKCiAgICAvLyByZXNldCB0aGUgbWFyZ2luIG9mIHRoZSBzdmcgZWxlbWVudAogICAgZDMuc2VsZWN0KCIuIiArIGNsYXNzTmFtZSkKICAgICAgICAuc3R5bGUoIm1hcmdpbiIsIGN1cl9tYXJnaW4pOwp9CgovKiBmdW5jdGlvbiB0byBzb3J0IGFycmF5IG9mIG9iamVjdHMgYnkga2V5IAoqIG1vZGlmaWVkIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODgzNzQ1NC9zb3J0LWFycmF5LW9mLW9iamVjdHMtYnktc2luZ2xlLWtleS13aXRoLWRhdGUtdmFsdWUKKi8KZnVuY3Rpb24gX3NvcnRCeUtleShhcnJheSwgZmlyc3RLZXksIHNlY29uZEtleSkgewogICAgc2Vjb25kS2V5ID0gc2Vjb25kS2V5IHx8ICJOQSI7CiAgICByZXR1cm4gYXJyYXkuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgdmFyIHggPSBhW2ZpcnN0S2V5XTsgdmFyIHkgPSBiW2ZpcnN0S2V5XTsKICAgICAgICB2YXIgcmVzID0gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKICAgICAgICBpZiAoc2Vjb25kS2V5ID09ICJOQSIpIHsKICAgICAgICAgICAgcmV0dXJuIHJlczsgICAgICAgICAgICAKICAgICAgICB9CiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YoYVtzZWNvbmRLZXldID09ICJzdHJpbmciKSkgewogICAgICAgICAgICAgICAgcmV0dXJuIChyZXMgPT09IDApID8gKGFbc2Vjb25kS2V5XSA+IGJbc2Vjb25kS2V5XSkgOiByZXM7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mKGFbc2Vjb25kS2V5XSA9PSAibnVtYmVyIikpIHsKICAgICAgICAgICAgICAgIHJldHVybiAocmVzID09PSAwKSA/IChhW3NlY29uZEtleV0gLSBiW3NlY29uZEtleV0pIDogcmVzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwp9CgovKiBmdW5jdGlvbiB0byBnZXQgdGhlIGludGVyc2VjdGlvbiBvZiB0d28gYXJyYXlzCiogQHBhcmFtIHtBcnJheX0gYXJyYXkxIC0tIGZpcnN0IGFycmF5CiogQHBhcmFtIHtBcnJheX0gYXJyYXkyIC0tIHNlY29uZCBhcnJheQoqLwpmdW5jdGlvbiBfZ2V0SW50ZXJzZWN0aW9uKGFycmF5MSwgYXJyYXkyKSB7CgogICAgaWYgKGFycmF5MSA9PT0gdW5kZWZpbmVkIHx8IGFycmF5MiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgfQoKICAgIHJldHVybiBhcnJheTEuZmlsdGVyKGZ1bmN0aW9uKG4pIHsKICAgICAgICByZXR1cm4gYXJyYXkyLmluZGV4T2YobikgIT0gLTEKICAgIH0pOwp9CgoKLyoqCiAqIENvbnZlcnRzIGFuIEhTTCBjb2xvciB2YWx1ZSB0byBSR0IuIENvbnZlcnNpb24gZm9ybXVsYQogKiBhZGFwdGVkIGZyb20gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IU0xfY29sb3Jfc3BhY2UuCiAqIEFzc3VtZXMgaCwgcywgYW5kIGwgYXJlIGNvbnRhaW5lZCBpbiB0aGUgc2V0IFswLCAxXSBhbmQKICogcmV0dXJucyByLCBnLCBhbmQgYiBpbiB0aGUgc2V0IFswLCAyNTVdLgogKgogKiBAcGFyYW0gICBOdW1iZXIgIGggICAgICAgVGhlIGh1ZQogKiBAcGFyYW0gICBOdW1iZXIgIHMgICAgICAgVGhlIHNhdHVyYXRpb24KICogQHBhcmFtICAgTnVtYmVyICBsICAgICAgIFRoZSBsaWdodG5lc3MKICogQHJldHVybiAgQXJyYXkgICAgICAgICAgIFRoZSBSR0IgcmVwcmVzZW50YXRpb24KICovCmZ1bmN0aW9uIF9oc2xUb1JnYihoLCBzLCBsKXsKICAgIHZhciByLCBnLCBiOwoKICAgIGlmKHMgPT09IDApewogICAgICAgIHIgPSBnID0gYiA9IGw7IC8vIGFjaHJvbWF0aWMKICAgIH1lbHNlewogICAgICAgIHZhciBodWUycmdiID0gZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KXsKICAgICAgICAgICAgaWYodCA8IDApIHQgKz0gMTsKICAgICAgICAgICAgaWYodCA+IDEpIHQgLT0gMTsKICAgICAgICAgICAgaWYodCA8IDEvNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7CiAgICAgICAgICAgIGlmKHQgPCAxLzIpIHJldHVybiBxOwogICAgICAgICAgICBpZih0IDwgMi8zKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMi8zIC0gdCkgKiA2OwogICAgICAgICAgICByZXR1cm4gcDsKICAgICAgICB9CgogICAgICAgIHZhciBxID0gbCA8IDAuNSA/IGwgKiAoMSArIHMpIDogbCArIHMgLSBsICogczsKICAgICAgICB2YXIgcCA9IDIgKiBsIC0gcTsKICAgICAgICByID0gaHVlMnJnYihwLCBxLCBoICsgMS8zKTsKICAgICAgICBnID0gaHVlMnJnYihwLCBxLCBoKTsKICAgICAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMS8zKTsKICAgIH0KCiAgICByZXR1cm4gW01hdGgucm91bmQociAqIDI1NSksIE1hdGgucm91bmQoZyAqIDI1NSksIE1hdGgucm91bmQoYiAqIDI1NSldOwp9CgovLyBjb252ZXJ0IFJHQiB0byBoZXgKLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xNzQwNzAwL2dldC1oZXgtdmFsdWUtcmF0aGVyLXRoYW4tcmdiLXZhbHVlLXVzaW5nLWpxdWVyeQpmdW5jdGlvbiBfcmdiMmhleChyZ2IpIHsKICAgICBpZiAoICByZ2Iuc2VhcmNoKCJyZ2IiKSA9PSAtMSApIHsKICAgICAgICAgIHJldHVybiByZ2I7CiAgICAgfSBlbHNlIHsKICAgICAgICAgIHJnYiA9IHJnYi5tYXRjaCgvXnJnYmE/XCgoXGQrKSxccyooXGQrKSxccyooXGQrKSg/OixccyooXGQrKSk/XCkkLyk7CiAgICAgICAgICBmdW5jdGlvbiBoZXgoeCkgewogICAgICAgICAgICAgICByZXR1cm4gKCIwIiArIHBhcnNlSW50KHgpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuICIjIiArIGhleChyZ2JbMV0pICsgaGV4KHJnYlsyXSkgKyBoZXgocmdiWzNdKTsgCiAgICAgfQp9CgovLyBmdW5jdGlvbiB0byBpbmNyZWFzZSBicmlnaHRuZXNzIG9mIGhleCBjb2xvdXIKLy8gZnJvbTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy82NDQzOTkwL2phdmFzY3JpcHQtY2FsY3VsYXRlLWJyaWdodGVyLWNvbG91cgpmdW5jdGlvbiBfaW5jcmVhc2VfYnJpZ2h0bmVzcyhoZXgsIHBlcmNlbnQpewogICAgLy8gc3RyaXAgdGhlIGxlYWRpbmcgIyBpZiBpdCdzIHRoZXJlCiAgICBoZXggPSBoZXgucmVwbGFjZSgvXlxzKiN8XHMqJC9nLCAnJyk7CgogICAgLy8gY29udmVydCAzIGNoYXIgY29kZXMgLS0+IDYsIGUuZy4gYEUwRmAgLS0+IGBFRTAwRkZgCiAgICBpZihoZXgubGVuZ3RoID09IDMpewogICAgICAgIGhleCA9IGhleC5yZXBsYWNlKC8oLikvZywgJyQxJDEnKTsKICAgIH0KCiAgICB2YXIgciA9IHBhcnNlSW50KGhleC5zdWJzdHIoMCwgMiksIDE2KSwKICAgICAgICBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cigyLCAyKSwgMTYpLAogICAgICAgIGIgPSBwYXJzZUludChoZXguc3Vic3RyKDQsIDIpLCAxNik7CgogICAgcmV0dXJuICcjJyArCiAgICAgICAoKDB8KDE8PDgpICsgciArICgyNTYgLSByKSAqIHBlcmNlbnQgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpICsKICAgICAgICgoMHwoMTw8OCkgKyBnICsgKDI1NiAtIGcpICogcGVyY2VudCAvIDEwMCkudG9TdHJpbmcoMTYpKS5zdWJzdHIoMSkgKwogICAgICAgKCgwfCgxPDw4KSArIGIgKyAoMjU2IC0gYikgKiBwZXJjZW50IC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKTsKfQoKLy8gZnVuY3Rpb24gdG8gZGVjcmVhc2UgYnJpZ2h0bmVzcyBvZiBoZXggY29sb3VyCi8vIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTI2NjA5MTkvamF2YXNjcmlwdC1icmlnaHRuZXNzLWZ1bmN0aW9uLWRlY3JlYXNlCmZ1bmN0aW9uIF9kZWNyZWFzZV9icmlnaHRuZXNzKGhleCwgcGVyY2VudCl7CiAgICB2YXIgciA9IHBhcnNlSW50KGhleC5zdWJzdHIoMSwgMiksIDE2KSwKICAgICAgICBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cigzLCAyKSwgMTYpLAogICAgICAgIGIgPSBwYXJzZUludChoZXguc3Vic3RyKDUsIDIpLCAxNik7CgogICByZXR1cm4gJyMnICsKICAgICAgICgoMHwoMTw8OCkgKyByICogKDEwMCAtIHBlcmNlbnQpIC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKSArCiAgICAgICAoKDB8KDE8PDgpICsgZyAqICgxMDAgLSBwZXJjZW50KSAvIDEwMCkudG9TdHJpbmcoMTYpKS5zdWJzdHIoMSkgKwogICAgICAgKCgwfCgxPDw4KSArIGIgKiAoMTAwIC0gcGVyY2VudCkgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpOwp9Cg=="></script>
<link href="data:text/css;charset=utf-8,%2Egridster%20%7B%0Aposition%3Arelative%3B%0A%7D%0A%2Egridster%20%3E%20%2A%20%7B%0Amargin%3A%200%20auto%3B%0A%2Dwebkit%2Dtransition%3A%20height%20%2E4s%2C%20width%20%2E4s%3B%0A%2Dmoz%2Dtransition%3A%20height%20%2E4s%2C%20width%20%2E4s%3B%0A%2Do%2Dtransition%3A%20height%20%2E4s%2C%20width%20%2E4s%3B%0A%2Dms%2Dtransition%3A%20height%20%2E4s%2C%20width%20%2E4s%3B%0Atransition%3A%20height%20%2E4s%2C%20width%20%2E4s%3B%0A%7D%0A%2Egridster%20%2Egs%2Dw%20%7B%0Abackground%3A%20%23FFF%3B%0Az%2Dindex%3A%202%3B%0Aposition%3A%20absolute%3B%0A%7D%0A%2Eready%20%2Egs%2Dw%3Anot%28%2Epreview%2Dholder%29%20%7B%0A%2Dwebkit%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%3B%0A%2Dmoz%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%3B%0A%2Do%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%3B%0Atransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%3B%0A%7D%0A%2Eready%20%2Egs%2Dw%3Anot%28%2Epreview%2Dholder%29%2C%0A%2Eready%20%2Eresize%2Dpreview%2Dholder%20%7B%0A%2Dwebkit%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%2C%20width%20%2E3s%2C%20height%20%2E3s%3B%0A%2Dmoz%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%2C%20width%20%2E3s%2C%20height%20%2E3s%3B%0A%2Do%2Dtransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%2C%20width%20%2E3s%2C%20height%20%2E3s%3B%0Atransition%3A%20opacity%20%2E3s%2C%20left%20%2E3s%2C%20top%20%2E3s%2C%20width%20%2E3s%2C%20height%20%2E3s%3B%0A%7D%0A%2Egridster%20%2Epreview%2Dholder%20%7B%0Az%2Dindex%3A%201%3B%0Aposition%3A%20absolute%3B%0Abackground%2Dcolor%3A%20%23fff%3B%0Aborder%2Dcolor%3A%20%23fff%3B%0Aopacity%3A%200%2E3%3B%0A%7D%0A%2Egridster%20%2Eplayer%2Drevert%20%7B%0Az%2Dindex%3A%2010%21important%3B%0A%2Dwebkit%2Dtransition%3A%20left%20%2E3s%2C%20top%20%2E3s%21important%3B%0A%2Dmoz%2Dtransition%3A%20left%20%2E3s%2C%20top%20%2E3s%21important%3B%0A%2Do%2Dtransition%3A%20left%20%2E3s%2C%20top%20%2E3s%21important%3B%0Atransition%3A%20left%20%2E3s%2C%20top%20%2E3s%21important%3B%0A%7D%0A%2Egridster%20%2Edragging%2C%0A%2Egridster%20%2Eresizing%20%7B%0Az%2Dindex%3A%2010%21important%3B%0A%2Dwebkit%2Dtransition%3A%20all%200s%20%21important%3B%0A%2Dmoz%2Dtransition%3A%20all%200s%20%21important%3B%0A%2Do%2Dtransition%3A%20all%200s%20%21important%3B%0Atransition%3A%20all%200s%20%21important%3B%0A%7D%0A%2Egs%2Dresize%2Dhandle%20%7B%0Aposition%3A%20absolute%3B%0Az%2Dindex%3A%201%3B%0A%7D%0A%2Egs%2Dresize%2Dhandle%2Dboth%20%7B%0Awidth%3A%2020px%3B%0Aheight%3A%2020px%3B%0Abottom%3A%20%2D8px%3B%0Aright%3A%20%2D8px%3B%0Abackground%2Dimage%3A%20url%28%27data%3Aimage%2Fsvg%2Bxml%3Bbase64%2CPD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI%2FPg08IS0tIEdlbmVyYXRvcjogQWRvYmUgRmlyZXdvcmtzIENTNiwgRXhwb3J0IFNWRyBFeHRlbnNpb24gYnkgQWFyb24gQmVhbGwgKGh0dHA6Ly9maXJld29ya3MuYWJlYWxsLmNvbSkgLiBWZXJzaW9uOiAwLjYuMSAgLS0%2BDTwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI%2BDTxzdmcgaWQ9IlVudGl0bGVkLVBhZ2UlMjAxIiB2aWV3Qm94PSIwIDAgNiA2IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmZmZmMDAiIHZlcnNpb249IjEuMSINCXhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHhtbDpzcGFjZT0icHJlc2VydmUiDQl4PSIwcHgiIHk9IjBweCIgd2lkdGg9IjZweCIgaGVpZ2h0PSI2cHgiDT4NCTxnIG9wYWNpdHk9IjAuMzAyIj4NCQk8cGF0aCBkPSJNIDYgNiBMIDAgNiBMIDAgNC4yIEwgNCA0LjIgTCA0LjIgNC4yIEwgNC4yIDAgTCA2IDAgTCA2IDYgTCA2IDYgWiIgZmlsbD0iIzAwMDAwMCIvPg0JPC9nPg08L3N2Zz4%3D%27%29%3B%0Abackground%2Dposition%3A%20top%20left%3B%0Abackground%2Drepeat%3A%20no%2Drepeat%3B%0Acursor%3A%20se%2Dresize%3B%0Az%2Dindex%3A%2020%3B%0A%7D%0A%2Egs%2Dresize%2Dhandle%2Dx%20%7B%0Atop%3A%200%3B%0Abottom%3A%2013px%3B%0Aright%3A%20%2D5px%3B%0Awidth%3A%2010px%3B%0Acursor%3A%20e%2Dresize%3B%0A%7D%0A%2Egs%2Dresize%2Dhandle%2Dy%20%7B%0Aleft%3A%200%3B%0Aright%3A%2013px%3B%0Abottom%3A%20%2D5px%3B%0Aheight%3A%2010px%3B%0Acursor%3A%20s%2Dresize%3B%0A%7D%0A%2Egs%2Dw%3Ahover%20%2Egs%2Dresize%2Dhandle%2C%0A%2Eresizing%20%2Egs%2Dresize%2Dhandle%20%7B%0Aopacity%3A%201%3B%0A%7D%0A%2Egs%2Dresize%2Dhandle%2C%0A%2Egs%2Dw%2Edragging%20%2Egs%2Dresize%2Dhandle%20%7B%0Aopacity%3A%200%3B%0A%7D%0A%2Egs%2Dresize%2Ddisabled%20%2Egs%2Dresize%2Dhandle%20%7B%0Adisplay%3A%20none%21important%3B%0A%7D%0A%5Bdata%2Dmax%2Dsizex%3D%221%22%5D%20%2Egs%2Dresize%2Dhandle%2Dx%2C%0A%5Bdata%2Dmax%2Dsizey%3D%221%22%5D%20%2Egs%2Dresize%2Dhandle%2Dy%2C%0A%5Bdata%2Dmax%2Dsizey%3D%221%22%5D%5Bdata%2Dmax%2Dsizex%3D%221%22%5D%20%2Egs%2Dresize%2Dhandle%20%7B%0Adisplay%3A%20none%20%21important%3B%0A%7D%0A%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyohIGdyaWRzdGVyLmpzIC0gdjAuNS42IC0gMjAxNC0wOS0yNQoqIGh0dHA6Ly9ncmlkc3Rlci5uZXQvCiogQ29weXJpZ2h0IChjKSAyMDE0IGR1Y2tzYm9hcmQ7IExpY2Vuc2VkIE1JVCAqLwoKOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CgogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgnZ3JpZHN0ZXItY29vcmRzJywgWydqcXVlcnknXSwgZmFjdG9yeSk7CiAgICB9IGVsc2UgewogICAgICAgcm9vdC5Hcmlkc3RlckNvb3JkcyA9IGZhY3Rvcnkocm9vdC4kIHx8IHJvb3QualF1ZXJ5KTsKICAgIH0KCn0odGhpcywgZnVuY3Rpb24oJCkgewogICAgLyoqCiAgICAqIENyZWF0ZXMgb2JqZWN0cyB3aXRoIGNvb3JkaW5hdGVzICh4MSwgeTEsIHgyLCB5MiwgY3gsIGN5LCB3aWR0aCwgaGVpZ2h0KQogICAgKiB0byBzaW11bGF0ZSBET00gZWxlbWVudHMgb24gdGhlIHNjcmVlbi4KICAgICogQ29vcmRzIGlzIHVzZWQgYnkgR3JpZHN0ZXIgdG8gY3JlYXRlIGEgZmF1eCBncmlkIHdpdGggYW55IERPTSBlbGVtZW50IGNhbgogICAgKiBjb2xsaWRlLgogICAgKgogICAgKiBAY2xhc3MgQ29vcmRzCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8T2JqZWN0fSBvYmogVGhlIGpRdWVyeSBIVE1MRWxlbWVudCBvciBhIG9iamVjdCB3aXRoOiBsZWZ0LAogICAgKiB0b3AsIHdpZHRoIGFuZCBoZWlnaHQgcHJvcGVydGllcy4KICAgICogQHJldHVybiB7T2JqZWN0fSBDb29yZHMgaW5zdGFuY2UuCiAgICAqIEBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIENvb3JkcyhvYmopIHsKICAgICAgICBpZiAob2JqWzBdICYmICQuaXNQbGFpbk9iamVjdChvYmpbMF0pKSB7CiAgICAgICAgICAgIHRoaXMuZGF0YSA9IG9ialswXTsKICAgICAgICB9ZWxzZSB7CiAgICAgICAgICAgIHRoaXMuZWwgPSBvYmo7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmlzQ29vcmRzID0gdHJ1ZTsKICAgICAgICB0aGlzLmNvb3JkcyA9IHt9OwogICAgICAgIHRoaXMuaW5pdCgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfQoKCiAgICB2YXIgZm4gPSBDb29yZHMucHJvdG90eXBlOwoKCiAgICBmbi5pbml0ID0gZnVuY3Rpb24oKXsKICAgICAgICB0aGlzLnNldCgpOwogICAgICAgIHRoaXMub3JpZ2luYWxfY29vcmRzID0gdGhpcy5nZXQoKTsKICAgIH07CgoKICAgIGZuLnNldCA9IGZ1bmN0aW9uKHVwZGF0ZSwgbm90X3VwZGF0ZV9vZmZzZXRzKSB7CiAgICAgICAgdmFyIGVsID0gdGhpcy5lbDsKCiAgICAgICAgaWYgKGVsICYmICF1cGRhdGUpIHsKICAgICAgICAgICAgdGhpcy5kYXRhID0gZWwub2Zmc2V0KCk7CiAgICAgICAgICAgIHRoaXMuZGF0YS53aWR0aCA9IGVsLndpZHRoKCk7CiAgICAgICAgICAgIHRoaXMuZGF0YS5oZWlnaHQgPSBlbC5oZWlnaHQoKTsKICAgICAgICB9CgogICAgICAgIGlmIChlbCAmJiB1cGRhdGUgJiYgIW5vdF91cGRhdGVfb2Zmc2V0cykgewogICAgICAgICAgICB2YXIgb2Zmc2V0ID0gZWwub2Zmc2V0KCk7CiAgICAgICAgICAgIHRoaXMuZGF0YS50b3AgPSBvZmZzZXQudG9wOwogICAgICAgICAgICB0aGlzLmRhdGEubGVmdCA9IG9mZnNldC5sZWZ0OwogICAgICAgIH0KCiAgICAgICAgdmFyIGQgPSB0aGlzLmRhdGE7CgogICAgICAgIHR5cGVvZiBkLmxlZnQgPT09ICd1bmRlZmluZWQnICYmIChkLmxlZnQgPSBkLngxKTsKICAgICAgICB0eXBlb2YgZC50b3AgPT09ICd1bmRlZmluZWQnICYmIChkLnRvcCA9IGQueTEpOwoKICAgICAgICB0aGlzLmNvb3Jkcy54MSA9IGQubGVmdDsKICAgICAgICB0aGlzLmNvb3Jkcy55MSA9IGQudG9wOwogICAgICAgIHRoaXMuY29vcmRzLngyID0gZC5sZWZ0ICsgZC53aWR0aDsKICAgICAgICB0aGlzLmNvb3Jkcy55MiA9IGQudG9wICsgZC5oZWlnaHQ7CiAgICAgICAgdGhpcy5jb29yZHMuY3ggPSBkLmxlZnQgKyAoZC53aWR0aCAvIDIpOwogICAgICAgIHRoaXMuY29vcmRzLmN5ID0gZC50b3AgKyAoZC5oZWlnaHQgLyAyKTsKICAgICAgICB0aGlzLmNvb3Jkcy53aWR0aCAgPSBkLndpZHRoOwogICAgICAgIHRoaXMuY29vcmRzLmhlaWdodCA9IGQuaGVpZ2h0OwogICAgICAgIHRoaXMuY29vcmRzLmVsICA9IGVsIHx8IGZhbHNlIDsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICBmbi51cGRhdGUgPSBmdW5jdGlvbihkYXRhKXsKICAgICAgICBpZiAoIWRhdGEgJiYgIXRoaXMuZWwpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoZGF0YSkgewogICAgICAgICAgICB2YXIgbmV3X2RhdGEgPSAkLmV4dGVuZCh7fSwgdGhpcy5kYXRhLCBkYXRhKTsKICAgICAgICAgICAgdGhpcy5kYXRhID0gbmV3X2RhdGE7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNldCh0cnVlLCB0cnVlKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2V0KHRydWUpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgZm4uZ2V0ID0gZnVuY3Rpb24oKXsKICAgICAgICByZXR1cm4gdGhpcy5jb29yZHM7CiAgICB9OwoKICAgIGZuLmRlc3Ryb3kgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmVsLnJlbW92ZURhdGEoJ2Nvb3JkcycpOwogICAgICAgIGRlbGV0ZSB0aGlzLmVsOwogICAgfTsKCiAgICAvL2pRdWVyeSBhZGFwdGVyCiAgICAkLmZuLmNvb3JkcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGlmICh0aGlzLmRhdGEoJ2Nvb3JkcycpICkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5kYXRhKCdjb29yZHMnKTsKICAgICAgICB9CgogICAgICAgIHZhciBpbnMgPSBuZXcgQ29vcmRzKHRoaXMsIGFyZ3VtZW50c1swXSk7CiAgICAgICAgdGhpcy5kYXRhKCdjb29yZHMnLCBpbnMpOwogICAgICAgIHJldHVybiBpbnM7CiAgICB9OwoKICAgIHJldHVybiBDb29yZHM7Cgp9KSk7Cgo7KGZ1bmN0aW9uKHJvb3QsIGZhY3RvcnkpIHsKCiAgICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKCdncmlkc3Rlci1jb2xsaXNpb24nLCBbJ2pxdWVyeScsICdncmlkc3Rlci1jb29yZHMnXSwgZmFjdG9yeSk7CiAgICB9IGVsc2UgewogICAgICAgIHJvb3QuR3JpZHN0ZXJDb2xsaXNpb24gPSBmYWN0b3J5KHJvb3QuJCB8fCByb290LmpRdWVyeSwKICAgICAgICAgICAgcm9vdC5Hcmlkc3RlckNvb3Jkcyk7CiAgICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKCQsIENvb3JkcykgewoKICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICBjb2xsaWRlcnNfY29udGV4dDogZG9jdW1lbnQuYm9keSwKICAgICAgICBvdmVybGFwcGluZ19yZWdpb246ICdDJwogICAgICAgIC8vICxvbl9vdmVybGFwOiBmdW5jdGlvbihjb2xsaWRlcl9kYXRhKXt9LAogICAgICAgIC8vIG9uX292ZXJsYXBfc3RhcnQgOiBmdW5jdGlvbihjb2xsaWRlcl9kYXRhKXt9LAogICAgICAgIC8vIG9uX292ZXJsYXBfc3RvcCA6IGZ1bmN0aW9uKGNvbGxpZGVyX2RhdGEpe30KICAgIH07CgoKICAgIC8qKgogICAgKiBEZXRlY3RzIGNvbGxpc2lvbnMgYmV0d2VlbiBhIERPTSBlbGVtZW50IGFnYWluc3Qgb3RoZXIgRE9NIGVsZW1lbnRzIG9yCiAgICAqIENvb3JkcyBvYmplY3RzLgogICAgKgogICAgKiBAY2xhc3MgQ29sbGlzaW9uCiAgICAqIEB1c2VzIENvb3JkcwogICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbCBUaGUgalF1ZXJ5IHdyYXBwZWQgSFRNTEVsZW1lbnQuCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8QXJyYXl9IGNvbGxpZGVycyBDYW4gYmUgYSBqUXVlcnkgY29sbGVjdGlvbgogICAgKiAgb2YgSFRNTEVsZW1lbnRzIG9yIGFuIEFycmF5IG9mIENvb3JkcyBpbnN0YW5jZXMuCiAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gQW4gT2JqZWN0IHdpdGggYWxsIG9wdGlvbnMgeW91IHdhbnQgdG8KICAgICogICAgICAgIG92ZXJ3cml0ZToKICAgICogICBAcGFyYW0ge1N0cmluZ30gW29wdGlvbnMub3ZlcmxhcHBpbmdfcmVnaW9uXSBEZXRlcm1pbmVzIHdoZW4gY29sbGlzaW9uCiAgICAqICAgIGlzIHZhbGlkLCBkZXBlbmRpbmcgb24gdGhlIG92ZXJsYXBwZWQgYXJlYS4gVmFsdWVzIGNhbiBiZTogJ04nLCAnUycsCiAgICAqICAgICdXJywgJ0UnLCAnQycgb3IgJ2FsbCcuIERlZmF1bHQgaXMgJ0MnLgogICAgKiAgIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLm9uX292ZXJsYXBfc3RhcnRdIEV4ZWN1dGVzIGEgZnVuY3Rpb24gdGhlIGZpcnN0CiAgICAqICAgIHRpbWUgZWFjaCBgY29sbGlkZXIgYCBpcyBvdmVybGFwcGVkLgogICAgKiAgIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLm9uX292ZXJsYXBfc3RvcF0gRXhlY3V0ZXMgYSBmdW5jdGlvbiB3aGVuIGEKICAgICogICAgYGNvbGxpZGVyYCBpcyBubyBsb25nZXIgY29sbGlkZWQuCiAgICAqICAgQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMub25fb3ZlcmxhcF0gRXhlY3V0ZXMgYSBmdW5jdGlvbiB3aGVuIHRoZQogICAgKiBtb3VzZSBpcyBtb3ZlZCBkdXJpbmcgdGhlIGNvbGxpc2lvbi4KICAgICogQHJldHVybiB7T2JqZWN0fSBDb2xsaXNpb24gaW5zdGFuY2UuCiAgICAqIEBjb25zdHJ1Y3RvcgogICAgKi8KICAgIGZ1bmN0aW9uIENvbGxpc2lvbihlbCwgY29sbGlkZXJzLCBvcHRpb25zKSB7CiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoZGVmYXVsdHMsIG9wdGlvbnMpOwogICAgICAgIHRoaXMuJGVsZW1lbnQgPSBlbDsKICAgICAgICB0aGlzLmxhc3RfY29sbGlkZXJzID0gW107CiAgICAgICAgdGhpcy5sYXN0X2NvbGxpZGVyc19jb29yZHMgPSBbXTsKICAgICAgICB0aGlzLnNldF9jb2xsaWRlcnMoY29sbGlkZXJzKTsKCiAgICAgICAgdGhpcy5pbml0KCk7CiAgICB9CgogICAgQ29sbGlzaW9uLmRlZmF1bHRzID0gZGVmYXVsdHM7CgogICAgdmFyIGZuID0gQ29sbGlzaW9uLnByb3RvdHlwZTsKCgogICAgZm4uaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuZmluZF9jb2xsaXNpb25zKCk7CiAgICB9OwoKCiAgICBmbi5vdmVybGFwcyA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICB2YXIgeCA9IGZhbHNlOwogICAgICAgIHZhciB5ID0gZmFsc2U7CgogICAgICAgIGlmICgoYi54MSA+PSBhLngxICYmIGIueDEgPD0gYS54MikgfHwKICAgICAgICAgICAgKGIueDIgPj0gYS54MSAmJiBiLngyIDw9IGEueDIpIHx8CiAgICAgICAgICAgIChhLngxID49IGIueDEgJiYgYS54MiA8PSBiLngyKQogICAgICAgICkgeyB4ID0gdHJ1ZTsgfQoKICAgICAgICBpZiAoKGIueTEgPj0gYS55MSAmJiBiLnkxIDw9IGEueTIpIHx8CiAgICAgICAgICAgIChiLnkyID49IGEueTEgJiYgYi55MiA8PSBhLnkyKSB8fAogICAgICAgICAgICAoYS55MSA+PSBiLnkxICYmIGEueTIgPD0gYi55MikKICAgICAgICApIHsgeSA9IHRydWU7IH0KCiAgICAgICAgcmV0dXJuICh4ICYmIHkpOwogICAgfTsKCgogICAgZm4uZGV0ZWN0X292ZXJsYXBwaW5nX3JlZ2lvbiA9IGZ1bmN0aW9uKGEsIGIpewogICAgICAgIHZhciByZWdpb25YID0gJyc7CiAgICAgICAgdmFyIHJlZ2lvblkgPSAnJzsKCiAgICAgICAgaWYgKGEueTEgPiBiLmN5ICYmIGEueTEgPCBiLnkyKSB7IHJlZ2lvblggPSAnTic7IH0KICAgICAgICBpZiAoYS55MiA+IGIueTEgJiYgYS55MiA8IGIuY3kpIHsgcmVnaW9uWCA9ICdTJzsgfQogICAgICAgIGlmIChhLngxID4gYi5jeCAmJiBhLngxIDwgYi54MikgeyByZWdpb25ZID0gJ1cnOyB9CiAgICAgICAgaWYgKGEueDIgPiBiLngxICYmIGEueDIgPCBiLmN4KSB7IHJlZ2lvblkgPSAnRSc7IH0KCiAgICAgICAgcmV0dXJuIChyZWdpb25YICsgcmVnaW9uWSkgfHwgJ0MnOwogICAgfTsKCgogICAgZm4uY2FsY3VsYXRlX292ZXJsYXBwZWRfYXJlYV9jb29yZHMgPSBmdW5jdGlvbihhLCBiKXsKICAgICAgICB2YXIgeDEgPSBNYXRoLm1heChhLngxLCBiLngxKTsKICAgICAgICB2YXIgeTEgPSBNYXRoLm1heChhLnkxLCBiLnkxKTsKICAgICAgICB2YXIgeDIgPSBNYXRoLm1pbihhLngyLCBiLngyKTsKICAgICAgICB2YXIgeTIgPSBNYXRoLm1pbihhLnkyLCBiLnkyKTsKCiAgICAgICAgcmV0dXJuICQoewogICAgICAgICAgICBsZWZ0OiB4MSwKICAgICAgICAgICAgdG9wOiB5MSwKICAgICAgICAgICAgIHdpZHRoIDogKHgyIC0geDEpLAogICAgICAgICAgICBoZWlnaHQ6ICh5MiAtIHkxKQogICAgICAgICAgfSkuY29vcmRzKCkuZ2V0KCk7CiAgICB9OwoKCiAgICBmbi5jYWxjdWxhdGVfb3ZlcmxhcHBlZF9hcmVhID0gZnVuY3Rpb24oY29vcmRzKXsKICAgICAgICByZXR1cm4gKGNvb3Jkcy53aWR0aCAqIGNvb3Jkcy5oZWlnaHQpOwogICAgfTsKCgogICAgZm4ubWFuYWdlX2NvbGxpZGVyc19zdGFydF9zdG9wID0gZnVuY3Rpb24obmV3X2NvbGxpZGVyc19jb29yZHMsIHN0YXJ0X2NhbGxiYWNrLCBzdG9wX2NhbGxiYWNrKXsKICAgICAgICB2YXIgbGFzdCA9IHRoaXMubGFzdF9jb2xsaWRlcnNfY29vcmRzOwoKICAgICAgICBmb3IgKHZhciBpID0gMCwgaWwgPSBsYXN0Lmxlbmd0aDsgaSA8IGlsOyBpKyspIHsKICAgICAgICAgICAgaWYgKCQuaW5BcnJheShsYXN0W2ldLCBuZXdfY29sbGlkZXJzX2Nvb3JkcykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICBzdGFydF9jYWxsYmFjay5jYWxsKHRoaXMsIGxhc3RbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciBqID0gMCwgamwgPSBuZXdfY29sbGlkZXJzX2Nvb3Jkcy5sZW5ndGg7IGogPCBqbDsgaisrKSB7CiAgICAgICAgICAgIGlmICgkLmluQXJyYXkobmV3X2NvbGxpZGVyc19jb29yZHNbal0sIGxhc3QpID09PSAtMSkgewogICAgICAgICAgICAgICAgc3RvcF9jYWxsYmFjay5jYWxsKHRoaXMsIG5ld19jb2xsaWRlcnNfY29vcmRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICB9CiAgICB9OwoKCiAgICBmbi5maW5kX2NvbGxpc2lvbnMgPSBmdW5jdGlvbihwbGF5ZXJfZGF0YV9jb29yZHMpewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgb3ZlcmxhcHBpbmdfcmVnaW9uID0gdGhpcy5vcHRpb25zLm92ZXJsYXBwaW5nX3JlZ2lvbjsKICAgICAgICB2YXIgY29sbGlkZXJzX2Nvb3JkcyA9IFtdOwogICAgICAgIHZhciBjb2xsaWRlcnNfZGF0YSA9IFtdOwogICAgICAgIHZhciAkY29sbGlkZXJzID0gKHRoaXMuY29sbGlkZXJzIHx8IHRoaXMuJGNvbGxpZGVycyk7CiAgICAgICAgdmFyIGNvdW50ID0gJGNvbGxpZGVycy5sZW5ndGg7CiAgICAgICAgdmFyIHBsYXllcl9jb29yZHMgPSBzZWxmLiRlbGVtZW50LmNvb3JkcygpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZShwbGF5ZXJfZGF0YV9jb29yZHMgfHwgZmFsc2UpLmdldCgpOwoKICAgICAgICB3aGlsZShjb3VudC0tKXsKICAgICAgICAgIHZhciAkY29sbGlkZXIgPSBzZWxmLiRjb2xsaWRlcnMgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAkKCRjb2xsaWRlcnNbY291bnRdKSA6ICRjb2xsaWRlcnNbY291bnRdOwogICAgICAgICAgdmFyICRjb2xsaWRlcl9jb29yZHNfaW5zID0gKCRjb2xsaWRlci5pc0Nvb3JkcykgPwogICAgICAgICAgICAgICAgICAkY29sbGlkZXIgOiAkY29sbGlkZXIuY29vcmRzKCk7CiAgICAgICAgICB2YXIgY29sbGlkZXJfY29vcmRzID0gJGNvbGxpZGVyX2Nvb3Jkc19pbnMuZ2V0KCk7CiAgICAgICAgICB2YXIgb3ZlcmxhcHMgPSBzZWxmLm92ZXJsYXBzKHBsYXllcl9jb29yZHMsIGNvbGxpZGVyX2Nvb3Jkcyk7CgogICAgICAgICAgaWYgKCFvdmVybGFwcykgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB2YXIgcmVnaW9uID0gc2VsZi5kZXRlY3Rfb3ZlcmxhcHBpbmdfcmVnaW9uKAogICAgICAgICAgICAgIHBsYXllcl9jb29yZHMsIGNvbGxpZGVyX2Nvb3Jkcyk7CgogICAgICAgICAgICAvL3RvZG86IG1ha2UgdGhpcyBhbiBvcHRpb24KICAgICAgICAgICAgaWYgKHJlZ2lvbiA9PT0gb3ZlcmxhcHBpbmdfcmVnaW9uIHx8IG92ZXJsYXBwaW5nX3JlZ2lvbiA9PT0gJ2FsbCcpIHsKCiAgICAgICAgICAgICAgICB2YXIgYXJlYV9jb29yZHMgPSBzZWxmLmNhbGN1bGF0ZV9vdmVybGFwcGVkX2FyZWFfY29vcmRzKAogICAgICAgICAgICAgICAgICAgIHBsYXllcl9jb29yZHMsIGNvbGxpZGVyX2Nvb3Jkcyk7CiAgICAgICAgICAgICAgICB2YXIgYXJlYSA9IHNlbGYuY2FsY3VsYXRlX292ZXJsYXBwZWRfYXJlYShhcmVhX2Nvb3Jkcyk7CiAgICAgICAgICAgICAgICB2YXIgY29sbGlkZXJfZGF0YSA9IHsKICAgICAgICAgICAgICAgICAgICBhcmVhOiBhcmVhLAogICAgICAgICAgICAgICAgICAgIGFyZWFfY29vcmRzIDogYXJlYV9jb29yZHMsCiAgICAgICAgICAgICAgICAgICAgcmVnaW9uOiByZWdpb24sCiAgICAgICAgICAgICAgICAgICAgY29vcmRzOiBjb2xsaWRlcl9jb29yZHMsCiAgICAgICAgICAgICAgICAgICAgcGxheWVyX2Nvb3JkczogcGxheWVyX2Nvb3JkcywKICAgICAgICAgICAgICAgICAgICBlbDogJGNvbGxpZGVyCiAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMub25fb3ZlcmxhcCkgewogICAgICAgICAgICAgICAgICAgIHNlbGYub3B0aW9ucy5vbl9vdmVybGFwLmNhbGwodGhpcywgY29sbGlkZXJfZGF0YSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjb2xsaWRlcnNfY29vcmRzLnB1c2goJGNvbGxpZGVyX2Nvb3Jkc19pbnMpOwogICAgICAgICAgICAgICAgY29sbGlkZXJzX2RhdGEucHVzaChjb2xsaWRlcl9kYXRhKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5vbl9vdmVybGFwX3N0b3AgfHwgc2VsZi5vcHRpb25zLm9uX292ZXJsYXBfc3RhcnQpIHsKICAgICAgICAgICAgdGhpcy5tYW5hZ2VfY29sbGlkZXJzX3N0YXJ0X3N0b3AoY29sbGlkZXJzX2Nvb3JkcywKICAgICAgICAgICAgICAgIHNlbGYub3B0aW9ucy5vbl9vdmVybGFwX3N0YXJ0LCBzZWxmLm9wdGlvbnMub25fb3ZlcmxhcF9zdG9wKTsKICAgICAgICB9CgogICAgICAgIHRoaXMubGFzdF9jb2xsaWRlcnNfY29vcmRzID0gY29sbGlkZXJzX2Nvb3JkczsKCiAgICAgICAgcmV0dXJuIGNvbGxpZGVyc19kYXRhOwogICAgfTsKCgogICAgZm4uZ2V0X2Nsb3Nlc3RfY29sbGlkZXJzID0gZnVuY3Rpb24ocGxheWVyX2RhdGFfY29vcmRzKXsKICAgICAgICB2YXIgY29sbGlkZXJzID0gdGhpcy5maW5kX2NvbGxpc2lvbnMocGxheWVyX2RhdGFfY29vcmRzKTsKCiAgICAgICAgY29sbGlkZXJzLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAvKiBpZiBjb2xsaWRlcnMgYXJlIGJlaW5nIG92ZXJsYXBwZWQgYnkgdGhlICJDIiAoY2VudGVyKSByZWdpb24sCiAgICAgICAgICAgICAqIHdlIGhhdmUgdG8gc2V0IGEgbG93ZXIgaW5kZXggaW4gdGhlIGFycmF5IHRvIHdoaWNoIHRoZXkgYXJlIHBsYWNlZAogICAgICAgICAgICAgKiBhYm92ZSBpbiB0aGUgZ3JpZC4gKi8KICAgICAgICAgICAgaWYgKGEucmVnaW9uID09PSAnQycgJiYgYi5yZWdpb24gPT09ICdDJykgewogICAgICAgICAgICAgICAgaWYgKGEuY29vcmRzLnkxIDwgYi5jb29yZHMueTEgfHwgYS5jb29yZHMueDEgPCBiLmNvb3Jkcy54MSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAtIDE7CiAgICAgICAgICAgICAgICB9ZWxzZXsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGEuYXJlYSA8IGIuYXJlYSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBjb2xsaWRlcnM7CiAgICB9OwoKCiAgICBmbi5zZXRfY29sbGlkZXJzID0gZnVuY3Rpb24oY29sbGlkZXJzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjb2xsaWRlcnMgPT09ICdzdHJpbmcnIHx8IGNvbGxpZGVycyBpbnN0YW5jZW9mICQpIHsKICAgICAgICAgICAgdGhpcy4kY29sbGlkZXJzID0gJChjb2xsaWRlcnMsCiAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmNvbGxpZGVyc19jb250ZXh0KS5ub3QodGhpcy4kZWxlbWVudCk7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAgIHRoaXMuY29sbGlkZXJzID0gJChjb2xsaWRlcnMpOwogICAgICAgIH0KICAgIH07CgoKICAgIC8valF1ZXJ5IGFkYXB0ZXIKICAgICQuZm4uY29sbGlzaW9uID0gZnVuY3Rpb24oY29sbGlkZXIsIG9wdGlvbnMpIHsKICAgICAgICAgIHJldHVybiBuZXcgQ29sbGlzaW9uKCB0aGlzLCBjb2xsaWRlciwgb3B0aW9ucyApOwogICAgfTsKCiAgICByZXR1cm4gQ29sbGlzaW9uOwoKfSkpOwoKOyhmdW5jdGlvbih3aW5kb3csIHVuZGVmaW5lZCkgewoKICAgIC8qIERlbGF5LCBkZWJvdW5jZSBhbmQgdGhyb3R0bGUgZnVuY3Rpb25zIHRha2VuIGZyb20gdW5kZXJzY29yZS5qcwogICAgICoKICAgICAqIENvcHlyaWdodCAoYykgMjAwOS0yMDEzIEplcmVteSBBc2hrZW5hcywgRG9jdW1lbnRDbG91ZCBhbmQKICAgICAqIEludmVzdGlnYXRpdmUgUmVwb3J0ZXJzICYgRWRpdG9ycwogICAgICoKICAgICAqIFBlcm1pc3Npb24gaXMgaGVyZWJ5IGdyYW50ZWQsIGZyZWUgb2YgY2hhcmdlLCB0byBhbnkgcGVyc29uCiAgICAgKiBvYnRhaW5pbmcgYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbgogICAgICogZmlsZXMgKHRoZSAiU29mdHdhcmUiKSwgdG8gZGVhbCBpbiB0aGUgU29mdHdhcmUgd2l0aG91dAogICAgICogcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0IGxpbWl0YXRpb24gdGhlIHJpZ2h0cyB0byB1c2UsCiAgICAgKiBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLCBkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbAogICAgICogY29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlCiAgICAgKiBTb2Z0d2FyZSBpcyBmdXJuaXNoZWQgdG8gZG8gc28sIHN1YmplY3QgdG8gdGhlIGZvbGxvd2luZwogICAgICogY29uZGl0aW9uczoKICAgICAqCiAgICAgKiBUaGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSBhbmQgdGhpcyBwZXJtaXNzaW9uIG5vdGljZSBzaGFsbCBiZQogICAgICogaW5jbHVkZWQgaW4gYWxsIGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuCiAgICAgKgogICAgICogVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICJBUyBJUyIsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCiAgICAgKiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBCVVQgTk9UIExJTUlURUQgVE8gVEhFIFdBUlJBTlRJRVMKICAgICAqIE9GIE1FUkNIQU5UQUJJTElUWSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5ECiAgICAgKiBOT05JTkZSSU5HRU1FTlQuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVAogICAgICogSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUiBMSUFCSUxJVFksCiAgICAgKiBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgVE9SVCBPUiBPVEhFUldJU0UsIEFSSVNJTkcKICAgICAqIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFNPRlRXQVJFIE9SIFRIRSBVU0UgT1IKICAgICAqIE9USEVSIERFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KICAgICAqLwoKICAgIHdpbmRvdy5kZWxheSA9IGZ1bmN0aW9uKGZ1bmMsIHdhaXQpIHsKICAgICAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7CiAgICAgICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgcmV0dXJuIGZ1bmMuYXBwbHkobnVsbCwgYXJncyk7IH0sIHdhaXQpOwogICAgfTsKCiAgICB3aW5kb3cuZGVib3VuY2UgPSBmdW5jdGlvbihmdW5jLCB3YWl0LCBpbW1lZGlhdGUpIHsKICAgICAgICB2YXIgdGltZW91dDsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMsIGFyZ3MgPSBhcmd1bWVudHM7CiAgICAgICAgICB2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGltZW91dCA9IG51bGw7CiAgICAgICAgICAgIGlmICghaW1tZWRpYXRlKSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpOwogICAgICAgICAgfTsKICAgICAgICAgIGlmIChpbW1lZGlhdGUgJiYgIXRpbWVvdXQpIGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7CiAgICAgICAgICBjbGVhclRpbWVvdXQodGltZW91dCk7CiAgICAgICAgICB0aW1lb3V0ID0gc2V0VGltZW91dChsYXRlciwgd2FpdCk7CiAgICAgICAgfTsKICAgIH07CgogICAgd2luZG93LnRocm90dGxlID0gZnVuY3Rpb24oZnVuYywgd2FpdCkgewogICAgICAgIHZhciBjb250ZXh0LCBhcmdzLCB0aW1lb3V0LCB0aHJvdHRsaW5nLCBtb3JlLCByZXN1bHQ7CiAgICAgICAgdmFyIHdoZW5Eb25lID0gZGVib3VuY2UoCiAgICAgICAgICAgIGZ1bmN0aW9uKCl7IG1vcmUgPSB0aHJvdHRsaW5nID0gZmFsc2U7IH0sIHdhaXQpOwogICAgICAgIHJldHVybiBmdW5jdGlvbigpIHsKICAgICAgICAgIGNvbnRleHQgPSB0aGlzOyBhcmdzID0gYXJndW1lbnRzOwogICAgICAgICAgdmFyIGxhdGVyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsOwogICAgICAgICAgICBpZiAobW9yZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgICAgd2hlbkRvbmUoKTsKICAgICAgICAgIH07CiAgICAgICAgICBpZiAoIXRpbWVvdXQpIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTsKICAgICAgICAgIGlmICh0aHJvdHRsaW5nKSB7CiAgICAgICAgICAgIG1vcmUgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTsKICAgICAgICAgIH0KICAgICAgICAgIHdoZW5Eb25lKCk7CiAgICAgICAgICB0aHJvdHRsaW5nID0gdHJ1ZTsKICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfTsKICAgIH07Cgp9KSh3aW5kb3cpOwoKOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CgogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZSgnZ3JpZHN0ZXItZHJhZ2dhYmxlJywgWydqcXVlcnknXSwgZmFjdG9yeSk7CiAgICB9IGVsc2UgewogICAgICAgIHJvb3QuR3JpZHN0ZXJEcmFnZ2FibGUgPSBmYWN0b3J5KHJvb3QuJCB8fCByb290LmpRdWVyeSk7CiAgICB9Cgp9KHRoaXMsIGZ1bmN0aW9uKCQpIHsKCiAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgaXRlbXM6ICdsaScsCiAgICAgICAgZGlzdGFuY2U6IDEsCiAgICAgICAgbGltaXQ6IHRydWUsCiAgICAgICAgb2Zmc2V0X2xlZnQ6IDAsCiAgICAgICAgYXV0b3Njcm9sbDogdHJ1ZSwKICAgICAgICBpZ25vcmVfZHJhZ2dpbmc6IFsnSU5QVVQnLCAnVEVYVEFSRUEnLCAnU0VMRUNUJywgJ0JVVFRPTiddLCAvLyBvciBmdW5jdGlvbgogICAgICAgIGhhbmRsZTogbnVsbCwKICAgICAgICBjb250YWluZXJfd2lkdGg6IDAsICAvLyAwID09IGF1dG8KICAgICAgICBtb3ZlX2VsZW1lbnQ6IHRydWUsCiAgICAgICAgaGVscGVyOiBmYWxzZSwgIC8vIG9yICdjbG9uZScKICAgICAgICByZW1vdmVfaGVscGVyOiB0cnVlCiAgICAgICAgLy8gZHJhZzogZnVuY3Rpb24oZSkge30sCiAgICAgICAgLy8gc3RhcnQgOiBmdW5jdGlvbihlLCB1aSkge30sCiAgICAgICAgLy8gc3RvcCA6IGZ1bmN0aW9uKGUpIHt9CiAgICB9OwoKICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpOwogICAgdmFyIGRpcl9tYXAgPSB7IHggOiAnbGVmdCcsIHkgOiAndG9wJyB9OwogICAgdmFyIGlzVG91Y2ggPSAhISgnb250b3VjaHN0YXJ0JyBpbiB3aW5kb3cpOwoKICAgIHZhciBjYXBpdGFsaXplID0gZnVuY3Rpb24oc3RyKSB7CiAgICAgICAgcmV0dXJuIHN0ci5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHN0ci5zbGljZSgxKTsKICAgIH07CgogICAgdmFyIGlkQ291bnRlciA9IDA7CiAgICB2YXIgdW5pcUlkID0gZnVuY3Rpb24oKSB7CiAgICAgICAgcmV0dXJuICsraWRDb3VudGVyICsgJyc7CiAgICB9CgogICAgLyoqCiAgICAqIEJhc2ljIGRyYWcgaW1wbGVtZW50YXRpb24gZm9yIERPTSBlbGVtZW50cyBpbnNpZGUgYSBjb250YWluZXIuCiAgICAqIFByb3ZpZGUgc3RhcnQvc3RvcC9kcmFnIGNhbGxiYWNrcy4KICAgICoKICAgICogQGNsYXNzIERyYWdnYWJsZQogICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSBlbCBUaGUgSFRNTGVsZW1lbnQgdGhhdCBjb250YWlucyBhbGwgdGhlIHdpZGdldHMKICAgICogIHRvIGJlIGRyYWdnZWQuCiAgICAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc10gQW4gT2JqZWN0IHdpdGggYWxsIG9wdGlvbnMgeW91IHdhbnQgdG8KICAgICogICAgICAgIG92ZXJ3cml0ZToKICAgICogICAgQHBhcmFtIHtIVE1MRWxlbWVudHxTdHJpbmd9IFtvcHRpb25zLml0ZW1zXSBEZWZpbmUgd2hvIHdpbGwKICAgICogICAgIGJlIHRoZSBkcmFnZ2FibGUgaXRlbXMuIENhbiBiZSBhIENTUyBTZWxlY3RvciBTdHJpbmcgb3IgYQogICAgKiAgICAgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqICAgIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5kaXN0YW5jZV0gRGlzdGFuY2UgaW4gcGl4ZWxzIGFmdGVyIG1vdXNlZG93bgogICAgKiAgICAgdGhlIG1vdXNlIG11c3QgbW92ZSBiZWZvcmUgZHJhZ2dpbmcgc2hvdWxkIHN0YXJ0LgogICAgKiAgICBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmxpbWl0XSBDb25zdHJhaW5zIGRyYWdnaW5nIHRvIHRoZSB3aWR0aCBvZgogICAgKiAgICAgdGhlIGNvbnRhaW5lcgogICAgKiAgICBAcGFyYW0ge09iamVjdHxGdW5jdGlvbn0gW29wdGlvbnMuaWdub3JlX2RyYWdnaW5nXSBBcnJheSBvZiBub2RlIG5hbWVzCiAgICAqICAgICAgdGhhdCBzb3VsZCBub3QgdHJpZ2dlciBkcmFnZ2luZywgYnkgZGVmYXVsdCBpcyBgWydJTlBVVCcsICdURVhUQVJFQScsCiAgICAqICAgICAgJ1NFTEVDVCcsICdCVVRUT04nXWAuIElmIGEgZnVuY3Rpb24gaXMgdXNlZCByZXR1cm4gdHJ1ZSB0byBpZ25vcmUgZHJhZ2dpbmcuCiAgICAqICAgIEBwYXJhbSB7b2Zmc2V0X2xlZnR9IFtvcHRpb25zLm9mZnNldF9sZWZ0XSBPZmZzZXQgYWRkZWQgdG8gdGhlIGl0ZW0KICAgICogICAgIHRoYXQgaXMgYmVpbmcgZHJhZ2dlZC4KICAgICogICAgQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmRyYWddIEV4ZWN1dGVzIGEgY2FsbGJhY2sgd2hlbiB0aGUgbW91c2UgaXMKICAgICogICAgIG1vdmVkIGR1cmluZyB0aGUgZHJhZ2dpbmcuCiAgICAqICAgIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5zdGFydF0gRXhlY3V0ZXMgYSBjYWxsYmFjayB3aGVuIHRoZSBkcmFnCiAgICAqICAgICBzdGFydHMuCiAgICAqICAgIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5zdG9wXSBFeGVjdXRlcyBhIGNhbGxiYWNrIHdoZW4gdGhlIGRyYWcgc3RvcHMuCiAgICAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJucyBgZWxgLgogICAgKiBAY29uc3RydWN0b3IKICAgICovCiAgICBmdW5jdGlvbiBEcmFnZ2FibGUoZWwsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTsKICAgICAgdGhpcy4kZG9jdW1lbnQgPSAkKGRvY3VtZW50KTsKICAgICAgdGhpcy4kY29udGFpbmVyID0gJChlbCk7CiAgICAgIHRoaXMuJGRyYWdpdGVtcyA9ICQodGhpcy5vcHRpb25zLml0ZW1zLCB0aGlzLiRjb250YWluZXIpOwogICAgICB0aGlzLmlzX2RyYWdnaW5nID0gZmFsc2U7CiAgICAgIHRoaXMucGxheWVyX21pbl9sZWZ0ID0gMCArIHRoaXMub3B0aW9ucy5vZmZzZXRfbGVmdDsKICAgICAgdGhpcy5pZCA9IHVuaXFJZCgpOwogICAgICB0aGlzLm5zID0gJy5ncmlkc3Rlci1kcmFnZ2FibGUtJyArIHRoaXMuaWQ7CiAgICAgIHRoaXMuaW5pdCgpOwogICAgfQoKICAgIERyYWdnYWJsZS5kZWZhdWx0cyA9IGRlZmF1bHRzOwoKICAgIHZhciBmbiA9IERyYWdnYWJsZS5wcm90b3R5cGU7CgogICAgZm4uaW5pdCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBwb3MgPSB0aGlzLiRjb250YWluZXIuY3NzKCdwb3NpdGlvbicpOwogICAgICAgIHRoaXMuY2FsY3VsYXRlX2RpbWVuc2lvbnMoKTsKICAgICAgICB0aGlzLiRjb250YWluZXIuY3NzKCdwb3NpdGlvbicsIHBvcyA9PT0gJ3N0YXRpYycgPyAncmVsYXRpdmUnIDogcG9zKTsKICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgdGhpcy5ldmVudHMoKTsKCiAgICAgICAgJCh3aW5kb3cpLmJpbmQodGhpcy5uc0V2ZW50KCdyZXNpemUnKSwKICAgICAgICAgICAgdGhyb3R0bGUoJC5wcm94eSh0aGlzLmNhbGN1bGF0ZV9kaW1lbnNpb25zLCB0aGlzKSwgMjAwKSk7CiAgICB9OwoKICAgIGZuLm5zRXZlbnQgPSBmdW5jdGlvbihldikgewogICAgICAgIHJldHVybiAoZXYgfHwgJycpICsgdGhpcy5uczsKICAgIH07CgogICAgZm4uZXZlbnRzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy5wb2ludGVyX2V2ZW50cyA9IHsKICAgICAgICAgICAgc3RhcnQ6IHRoaXMubnNFdmVudCgndG91Y2hzdGFydCcpICsgJyAnICsgdGhpcy5uc0V2ZW50KCdtb3VzZWRvd24nKSwKICAgICAgICAgICAgbW92ZTogdGhpcy5uc0V2ZW50KCd0b3VjaG1vdmUnKSArICcgJyArIHRoaXMubnNFdmVudCgnbW91c2Vtb3ZlJyksCiAgICAgICAgICAgIGVuZDogdGhpcy5uc0V2ZW50KCd0b3VjaGVuZCcpICsgJyAnICsgdGhpcy5uc0V2ZW50KCdtb3VzZXVwJyksCiAgICAgICAgfTsKCiAgICAgICAgdGhpcy4kY29udGFpbmVyLm9uKHRoaXMubnNFdmVudCgnc2VsZWN0c3RhcnQnKSwKICAgICAgICAgICAgJC5wcm94eSh0aGlzLm9uX3NlbGVjdF9zdGFydCwgdGhpcykpOwoKICAgICAgICB0aGlzLiRjb250YWluZXIub24odGhpcy5wb2ludGVyX2V2ZW50cy5zdGFydCwgdGhpcy5vcHRpb25zLml0ZW1zLAogICAgICAgICAgICAkLnByb3h5KHRoaXMuZHJhZ19oYW5kbGVyLCB0aGlzKSk7CgogICAgICAgIHRoaXMuJGRvY3VtZW50Lm9uKHRoaXMucG9pbnRlcl9ldmVudHMuZW5kLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHsKICAgICAgICAgICAgdGhpcy5pc19kcmFnZ2luZyA9IGZhbHNlOwogICAgICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgeyByZXR1cm47IH0KICAgICAgICAgICAgdGhpcy4kZG9jdW1lbnQub2ZmKHRoaXMucG9pbnRlcl9ldmVudHMubW92ZSk7CiAgICAgICAgICAgIGlmICh0aGlzLmRyYWdfc3RhcnQpIHsKICAgICAgICAgICAgICAgIHRoaXMub25fZHJhZ3N0b3AoZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LCB0aGlzKSk7CiAgICB9OwoKICAgIGZuLmdldF9hY3R1YWxfcG9zID0gZnVuY3Rpb24oJGVsKSB7CiAgICAgICAgdmFyIHBvcyA9ICRlbC5wb3NpdGlvbigpOwogICAgICAgIHJldHVybiBwb3M7CiAgICB9OwoKCiAgICBmbi5nZXRfbW91c2VfcG9zID0gZnVuY3Rpb24oZSkgewogICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQgJiYgZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMpIHsKICAgICAgICAgICAgdmFyIG9lID0gZS5vcmlnaW5hbEV2ZW50OwogICAgICAgICAgICBlID0gb2UudG91Y2hlcy5sZW5ndGggPyBvZS50b3VjaGVzWzBdIDogb2UuY2hhbmdlZFRvdWNoZXNbMF07CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBsZWZ0OiBlLmNsaWVudFgsCiAgICAgICAgICAgIHRvcDogZS5jbGllbnRZCiAgICAgICAgfTsKICAgIH07CgoKICAgIGZuLmdldF9vZmZzZXQgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgIHZhciBtb3VzZV9hY3R1YWxfcG9zID0gdGhpcy5nZXRfbW91c2VfcG9zKGUpOwogICAgICAgIHZhciBkaWZmX3ggPSBNYXRoLnJvdW5kKAogICAgICAgICAgICBtb3VzZV9hY3R1YWxfcG9zLmxlZnQgLSB0aGlzLm1vdXNlX2luaXRfcG9zLmxlZnQpOwogICAgICAgIHZhciBkaWZmX3kgPSBNYXRoLnJvdW5kKG1vdXNlX2FjdHVhbF9wb3MudG9wIC0gdGhpcy5tb3VzZV9pbml0X3Bvcy50b3ApOwoKICAgICAgICB2YXIgbGVmdCA9IE1hdGgucm91bmQodGhpcy5lbF9pbml0X29mZnNldC5sZWZ0ICsKICAgICAgICAgICAgZGlmZl94IC0gdGhpcy5iYXNlWCArICQod2luZG93KS5zY3JvbGxMZWZ0KCkgLSB0aGlzLndpbl9vZmZzZXRfeCk7CiAgICAgICAgdmFyIHRvcCA9IE1hdGgucm91bmQodGhpcy5lbF9pbml0X29mZnNldC50b3AgKwogICAgICAgICAgICBkaWZmX3kgLSB0aGlzLmJhc2VZICsgJCh3aW5kb3cpLnNjcm9sbFRvcCgpIC0gdGhpcy53aW5fb2Zmc2V0X3kpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmxpbWl0KSB7CiAgICAgICAgICAgIGlmIChsZWZ0ID4gdGhpcy5wbGF5ZXJfbWF4X2xlZnQpIHsKICAgICAgICAgICAgICAgIGxlZnQgPSB0aGlzLnBsYXllcl9tYXhfbGVmdDsKICAgICAgICAgICAgfSBlbHNlIGlmKGxlZnQgPCB0aGlzLnBsYXllcl9taW5fbGVmdCkgewogICAgICAgICAgICAgICAgbGVmdCA9IHRoaXMucGxheWVyX21pbl9sZWZ0OwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBwb3NpdGlvbjogewogICAgICAgICAgICAgICAgbGVmdDogbGVmdCwKICAgICAgICAgICAgICAgIHRvcDogdG9wCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIHBvaW50ZXI6IHsKICAgICAgICAgICAgICAgIGxlZnQ6IG1vdXNlX2FjdHVhbF9wb3MubGVmdCwKICAgICAgICAgICAgICAgIHRvcDogbW91c2VfYWN0dWFsX3Bvcy50b3AsCiAgICAgICAgICAgICAgICBkaWZmX2xlZnQ6IGRpZmZfeCArICgkKHdpbmRvdykuc2Nyb2xsTGVmdCgpIC0gdGhpcy53aW5fb2Zmc2V0X3gpLAogICAgICAgICAgICAgICAgZGlmZl90b3A6IGRpZmZfeSArICgkKHdpbmRvdykuc2Nyb2xsVG9wKCkgLSB0aGlzLndpbl9vZmZzZXRfeSkKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9OwoKCiAgICBmbi5nZXRfZHJhZ19kYXRhID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLmdldF9vZmZzZXQoZSk7CiAgICAgICAgb2Zmc2V0LiRwbGF5ZXIgPSB0aGlzLiRwbGF5ZXI7CiAgICAgICAgb2Zmc2V0LiRoZWxwZXIgPSB0aGlzLmhlbHBlciA/IHRoaXMuJGhlbHBlciA6IHRoaXMuJHBsYXllcjsKCiAgICAgICAgcmV0dXJuIG9mZnNldDsKICAgIH07CgoKICAgIGZuLnNldF9saW1pdHMgPSBmdW5jdGlvbihjb250YWluZXJfd2lkdGgpIHsKICAgICAgICBjb250YWluZXJfd2lkdGggfHwgKGNvbnRhaW5lcl93aWR0aCA9IHRoaXMuJGNvbnRhaW5lci53aWR0aCgpKTsKICAgICAgICB0aGlzLnBsYXllcl9tYXhfbGVmdCA9IChjb250YWluZXJfd2lkdGggLSB0aGlzLnBsYXllcl93aWR0aCArCiAgICAgICAgICAgIC0gdGhpcy5vcHRpb25zLm9mZnNldF9sZWZ0KTsKCiAgICAgICAgdGhpcy5vcHRpb25zLmNvbnRhaW5lcl93aWR0aCA9IGNvbnRhaW5lcl93aWR0aDsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICBmbi5zY3JvbGxfaW4gPSBmdW5jdGlvbihheGlzLCBkYXRhKSB7CiAgICAgICAgdmFyIGRpcl9wcm9wID0gZGlyX21hcFtheGlzXTsKCiAgICAgICAgdmFyIGFyZWFfc2l6ZSA9IDUwOwogICAgICAgIHZhciBzY3JvbGxfaW5jID0gMzA7CgogICAgICAgIHZhciBpc194ID0gYXhpcyA9PT0gJ3gnOwogICAgICAgIHZhciB3aW5kb3dfc2l6ZSA9IGlzX3ggPyB0aGlzLndpbmRvd193aWR0aCA6IHRoaXMud2luZG93X2hlaWdodDsKICAgICAgICB2YXIgZG9jX3NpemUgPSBpc194ID8gJChkb2N1bWVudCkud2lkdGgoKSA6ICQoZG9jdW1lbnQpLmhlaWdodCgpOwogICAgICAgIHZhciBwbGF5ZXJfc2l6ZSA9IGlzX3ggPyB0aGlzLiRwbGF5ZXIud2lkdGgoKSA6IHRoaXMuJHBsYXllci5oZWlnaHQoKTsKCiAgICAgICAgdmFyIG5leHRfc2Nyb2xsOwogICAgICAgIHZhciBzY3JvbGxfb2Zmc2V0ID0gJHdpbmRvd1snc2Nyb2xsJyArIGNhcGl0YWxpemUoZGlyX3Byb3ApXSgpOwogICAgICAgIHZhciBtaW5fd2luZG93X3BvcyA9IHNjcm9sbF9vZmZzZXQ7CiAgICAgICAgdmFyIG1heF93aW5kb3dfcG9zID0gbWluX3dpbmRvd19wb3MgKyB3aW5kb3dfc2l6ZTsKCiAgICAgICAgdmFyIG1vdXNlX25leHRfem9uZSA9IG1heF93aW5kb3dfcG9zIC0gYXJlYV9zaXplOyAgLy8gZG93bi9yaWdodAogICAgICAgIHZhciBtb3VzZV9wcmV2X3pvbmUgPSBtaW5fd2luZG93X3BvcyArIGFyZWFfc2l6ZTsgIC8vIHVwL2xlZnQKCiAgICAgICAgdmFyIGFic19tb3VzZV9wb3MgPSBtaW5fd2luZG93X3BvcyArIGRhdGEucG9pbnRlcltkaXJfcHJvcF07CgogICAgICAgIHZhciBtYXhfcGxheWVyX3BvcyA9IChkb2Nfc2l6ZSAtIHdpbmRvd19zaXplICsgcGxheWVyX3NpemUpOwoKICAgICAgICBpZiAoYWJzX21vdXNlX3BvcyA+PSBtb3VzZV9uZXh0X3pvbmUpIHsKICAgICAgICAgICAgbmV4dF9zY3JvbGwgPSBzY3JvbGxfb2Zmc2V0ICsgc2Nyb2xsX2luYzsKICAgICAgICAgICAgaWYgKG5leHRfc2Nyb2xsIDwgbWF4X3BsYXllcl9wb3MpIHsKICAgICAgICAgICAgICAgICR3aW5kb3dbJ3Njcm9sbCcgKyBjYXBpdGFsaXplKGRpcl9wcm9wKV0obmV4dF9zY3JvbGwpOwogICAgICAgICAgICAgICAgdGhpc1snc2Nyb2xsX29mZnNldF8nICsgYXhpc10gKz0gc2Nyb2xsX2luYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGFic19tb3VzZV9wb3MgPD0gbW91c2VfcHJldl96b25lKSB7CiAgICAgICAgICAgIG5leHRfc2Nyb2xsID0gc2Nyb2xsX29mZnNldCAtIHNjcm9sbF9pbmM7CiAgICAgICAgICAgIGlmIChuZXh0X3Njcm9sbCA+IDApIHsKICAgICAgICAgICAgICAgICR3aW5kb3dbJ3Njcm9sbCcgKyBjYXBpdGFsaXplKGRpcl9wcm9wKV0obmV4dF9zY3JvbGwpOwogICAgICAgICAgICAgICAgdGhpc1snc2Nyb2xsX29mZnNldF8nICsgYXhpc10gLT0gc2Nyb2xsX2luYzsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICBmbi5tYW5hZ2Vfc2Nyb2xsID0gZnVuY3Rpb24oZGF0YSkgewogICAgICAgIHRoaXMuc2Nyb2xsX2luKCd4JywgZGF0YSk7CiAgICAgICAgdGhpcy5zY3JvbGxfaW4oJ3knLCBkYXRhKTsKICAgIH07CgoKICAgIGZuLmNhbGN1bGF0ZV9kaW1lbnNpb25zID0gZnVuY3Rpb24oZSkgewogICAgICAgIHRoaXMud2luZG93X2hlaWdodCA9ICR3aW5kb3cuaGVpZ2h0KCk7CiAgICAgICAgdGhpcy53aW5kb3dfd2lkdGggPSAkd2luZG93LndpZHRoKCk7CiAgICB9OwoKCiAgICBmbi5kcmFnX2hhbmRsZXIgPSBmdW5jdGlvbihlKSB7CiAgICAgICAgdmFyIG5vZGUgPSBlLnRhcmdldC5ub2RlTmFtZTsKICAgICAgICAvLyBza2lwIGlmIGRyYWcgaXMgZGlzYWJsZWQsIG9yIGNsaWNrIHdhcyBub3QgZG9uZSB3aXRoIHRoZSBtb3VzZSBwcmltYXJ5IGJ1dHRvbgogICAgICAgIGlmICh0aGlzLmRpc2FibGVkIHx8IGUud2hpY2ggIT09IDEgJiYgIWlzVG91Y2gpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuaWdub3JlX2RyYWcoZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciBmaXJzdCA9IHRydWU7CiAgICAgICAgdGhpcy4kcGxheWVyID0gJChlLmN1cnJlbnRUYXJnZXQpOwoKICAgICAgICB0aGlzLmVsX2luaXRfcG9zID0gdGhpcy5nZXRfYWN0dWFsX3Bvcyh0aGlzLiRwbGF5ZXIpOwogICAgICAgIHRoaXMubW91c2VfaW5pdF9wb3MgPSB0aGlzLmdldF9tb3VzZV9wb3MoZSk7CiAgICAgICAgdGhpcy5vZmZzZXRZID0gdGhpcy5tb3VzZV9pbml0X3Bvcy50b3AgLSB0aGlzLmVsX2luaXRfcG9zLnRvcDsKCiAgICAgICAgdGhpcy4kZG9jdW1lbnQub24odGhpcy5wb2ludGVyX2V2ZW50cy5tb3ZlLCBmdW5jdGlvbihtbWUpIHsKICAgICAgICAgICAgdmFyIG1vdXNlX2FjdHVhbF9wb3MgPSBzZWxmLmdldF9tb3VzZV9wb3MobW1lKTsKICAgICAgICAgICAgdmFyIGRpZmZfeCA9IE1hdGguYWJzKAogICAgICAgICAgICAgICAgbW91c2VfYWN0dWFsX3Bvcy5sZWZ0IC0gc2VsZi5tb3VzZV9pbml0X3Bvcy5sZWZ0KTsKICAgICAgICAgICAgdmFyIGRpZmZfeSA9IE1hdGguYWJzKAogICAgICAgICAgICAgICAgbW91c2VfYWN0dWFsX3Bvcy50b3AgLSBzZWxmLm1vdXNlX2luaXRfcG9zLnRvcCk7CiAgICAgICAgICAgIGlmICghKGRpZmZfeCA+IHNlbGYub3B0aW9ucy5kaXN0YW5jZSB8fAogICAgICAgICAgICAgICAgZGlmZl95ID4gc2VsZi5vcHRpb25zLmRpc3RhbmNlKQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChmaXJzdCkgewogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHNlbGYub25fZHJhZ3N0YXJ0LmNhbGwoc2VsZiwgbW1lKTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKHNlbGYuaXNfZHJhZ2dpbmcgPT09IHRydWUpIHsKICAgICAgICAgICAgICAgIHNlbGYub25fZHJhZ21vdmUuY2FsbChzZWxmLCBtbWUpOwogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfSk7CgogICAgICAgIGlmICghaXNUb3VjaCkgeyByZXR1cm4gZmFsc2U7IH0KICAgIH07CgoKICAgIGZuLm9uX2RyYWdzdGFydCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgICAgIGlmICh0aGlzLmlzX2RyYWdnaW5nKSB7IHJldHVybiB0aGlzOyB9CgogICAgICAgIHRoaXMuZHJhZ19zdGFydCA9IHRoaXMuaXNfZHJhZ2dpbmcgPSB0cnVlOwogICAgICAgIHZhciBvZmZzZXQgPSB0aGlzLiRjb250YWluZXIub2Zmc2V0KCk7CiAgICAgICAgdGhpcy5iYXNlWCA9IE1hdGgucm91bmQob2Zmc2V0LmxlZnQpOwogICAgICAgIHRoaXMuYmFzZVkgPSBNYXRoLnJvdW5kKG9mZnNldC50b3ApOwogICAgICAgIHRoaXMuaW5pdGlhbF9jb250YWluZXJfd2lkdGggPSB0aGlzLm9wdGlvbnMuY29udGFpbmVyX3dpZHRoIHx8IHRoaXMuJGNvbnRhaW5lci53aWR0aCgpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmhlbHBlciA9PT0gJ2Nsb25lJykgewogICAgICAgICAgICB0aGlzLiRoZWxwZXIgPSB0aGlzLiRwbGF5ZXIuY2xvbmUoKQogICAgICAgICAgICAgICAgLmFwcGVuZFRvKHRoaXMuJGNvbnRhaW5lcikuYWRkQ2xhc3MoJ2hlbHBlcicpOwogICAgICAgICAgICB0aGlzLmhlbHBlciA9IHRydWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5oZWxwZXIgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMud2luX29mZnNldF95ID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpOwogICAgICAgIHRoaXMud2luX29mZnNldF94ID0gJCh3aW5kb3cpLnNjcm9sbExlZnQoKTsKICAgICAgICB0aGlzLnNjcm9sbF9vZmZzZXRfeSA9IDA7CiAgICAgICAgdGhpcy5zY3JvbGxfb2Zmc2V0X3ggPSAwOwogICAgICAgIHRoaXMuZWxfaW5pdF9vZmZzZXQgPSB0aGlzLiRwbGF5ZXIub2Zmc2V0KCk7CiAgICAgICAgdGhpcy5wbGF5ZXJfd2lkdGggPSB0aGlzLiRwbGF5ZXIud2lkdGgoKTsKICAgICAgICB0aGlzLnBsYXllcl9oZWlnaHQgPSB0aGlzLiRwbGF5ZXIuaGVpZ2h0KCk7CgogICAgICAgIHRoaXMuc2V0X2xpbWl0cyh0aGlzLm9wdGlvbnMuY29udGFpbmVyX3dpZHRoKTsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdGFydCkgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuc3RhcnQuY2FsbCh0aGlzLiRwbGF5ZXIsIGUsIHRoaXMuZ2V0X2RyYWdfZGF0YShlKSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgoKICAgIGZuLm9uX2RyYWdtb3ZlID0gZnVuY3Rpb24oZSkgewogICAgICAgIHZhciBkYXRhID0gdGhpcy5nZXRfZHJhZ19kYXRhKGUpOwoKICAgICAgICB0aGlzLm9wdGlvbnMuYXV0b3Njcm9sbCAmJiB0aGlzLm1hbmFnZV9zY3JvbGwoZGF0YSk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMubW92ZV9lbGVtZW50KSB7CiAgICAgICAgICAgICh0aGlzLmhlbHBlciA/IHRoaXMuJGhlbHBlciA6IHRoaXMuJHBsYXllcikuY3NzKHsKICAgICAgICAgICAgICAgICdwb3NpdGlvbic6ICdhYnNvbHV0ZScsCiAgICAgICAgICAgICAgICAnbGVmdCcgOiBkYXRhLnBvc2l0aW9uLmxlZnQsCiAgICAgICAgICAgICAgICAndG9wJyA6IGRhdGEucG9zaXRpb24udG9wCiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgdmFyIGxhc3RfcG9zaXRpb24gPSB0aGlzLmxhc3RfcG9zaXRpb24gfHwgZGF0YS5wb3NpdGlvbjsKICAgICAgICBkYXRhLnByZXZfcG9zaXRpb24gPSBsYXN0X3Bvc2l0aW9uOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRyYWcpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRyYWcuY2FsbCh0aGlzLiRwbGF5ZXIsIGUsIGRhdGEpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXN0X3Bvc2l0aW9uID0gZGF0YS5wb3NpdGlvbjsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKCiAgICBmbi5vbl9kcmFnc3RvcCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICB2YXIgZGF0YSA9IHRoaXMuZ2V0X2RyYWdfZGF0YShlKTsKICAgICAgICB0aGlzLmRyYWdfc3RhcnQgPSBmYWxzZTsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5zdG9wKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5zdG9wLmNhbGwodGhpcy4kcGxheWVyLCBlLCBkYXRhKTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLmhlbHBlciAmJiB0aGlzLm9wdGlvbnMucmVtb3ZlX2hlbHBlcikgewogICAgICAgICAgICB0aGlzLiRoZWxwZXIucmVtb3ZlKCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwoKICAgIGZuLm9uX3NlbGVjdF9zdGFydCA9IGZ1bmN0aW9uKGUpIHsKICAgICAgICBpZiAodGhpcy5kaXNhYmxlZCkgeyByZXR1cm47IH0KCiAgICAgICAgaWYgKHRoaXMuaWdub3JlX2RyYWcoZSkpIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgfTsKCiAgICBmbi5lbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7CiAgICB9OwoKICAgIGZuLmRpc2FibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmRpc2FibGVkID0gdHJ1ZTsKICAgIH07CgogICAgZm4uZGVzdHJveSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuZGlzYWJsZSgpOwoKICAgICAgICB0aGlzLiRjb250YWluZXIub2ZmKHRoaXMubnMpOwogICAgICAgIHRoaXMuJGRvY3VtZW50Lm9mZih0aGlzLm5zKTsKICAgICAgICAkKHdpbmRvdykub2ZmKHRoaXMubnMpOwoKICAgICAgICAkLnJlbW92ZURhdGEodGhpcy4kY29udGFpbmVyLCAnZHJhZycpOwogICAgfTsKCiAgICBmbi5pZ25vcmVfZHJhZyA9IGZ1bmN0aW9uKGV2ZW50KSB7CiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYW5kbGUpIHsKICAgICAgICAgICAgcmV0dXJuICEkKGV2ZW50LnRhcmdldCkuaXModGhpcy5vcHRpb25zLmhhbmRsZSk7CiAgICAgICAgfQoKICAgICAgICBpZiAoJC5pc0Z1bmN0aW9uKHRoaXMub3B0aW9ucy5pZ25vcmVfZHJhZ2dpbmcpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaWdub3JlX2RyYWdnaW5nKGV2ZW50KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkKGV2ZW50LnRhcmdldCkuaXModGhpcy5vcHRpb25zLmlnbm9yZV9kcmFnZ2luZy5qb2luKCcsICcpKTsKICAgIH07CgogICAgLy9qUXVlcnkgYWRhcHRlcgogICAgJC5mbi5kcmFnID0gZnVuY3Rpb24gKCBvcHRpb25zICkgewogICAgICAgIHJldHVybiBuZXcgRHJhZ2dhYmxlKHRoaXMsIG9wdGlvbnMpOwogICAgfTsKCiAgICByZXR1cm4gRHJhZ2dhYmxlOwoKfSkpOwoKOyhmdW5jdGlvbihyb290LCBmYWN0b3J5KSB7CgogICAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgICAgIGRlZmluZShbJ2pxdWVyeScsICdncmlkc3Rlci1kcmFnZ2FibGUnLCAnZ3JpZHN0ZXItY29sbGlzaW9uJ10sIGZhY3RvcnkpOwogICAgfSBlbHNlIHsKICAgICAgICByb290LkdyaWRzdGVyID0gZmFjdG9yeShyb290LiQgfHwgcm9vdC5qUXVlcnksIHJvb3QuR3JpZHN0ZXJEcmFnZ2FibGUsCiAgICAgICAgICAgIHJvb3QuR3JpZHN0ZXJDb2xsaXNpb24pOwogICAgfQoKIH0odGhpcywgZnVuY3Rpb24oJCwgRHJhZ2dhYmxlLCBDb2xsaXNpb24pIHsKCiAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgbmFtZXNwYWNlOiAnJywKICAgICAgICB3aWRnZXRfc2VsZWN0b3I6ICdsaScsCiAgICAgICAgd2lkZ2V0X21hcmdpbnM6IFsxMCwgMTBdLAogICAgICAgIHdpZGdldF9iYXNlX2RpbWVuc2lvbnM6IFs0MDAsIDIyNV0sCiAgICAgICAgZXh0cmFfcm93czogMCwKICAgICAgICBleHRyYV9jb2xzOiAwLAogICAgICAgIG1pbl9jb2xzOiAxLAogICAgICAgIG1heF9jb2xzOiBJbmZpbml0eSwKICAgICAgICBtaW5fcm93czogMTUsCiAgICAgICAgbWF4X3NpemVfeDogZmFsc2UsCiAgICAgICAgYXV0b2dyb3dfY29sczogZmFsc2UsCiAgICAgICAgYXV0b2dlbmVyYXRlX3N0eWxlc2hlZXQ6IHRydWUsCiAgICAgICAgYXZvaWRfb3ZlcmxhcHBlZF93aWRnZXRzOiB0cnVlLAogICAgICAgIGF1dG9faW5pdDogdHJ1ZSwKICAgICAgICBzZXJpYWxpemVfcGFyYW1zOiBmdW5jdGlvbigkdywgd2dkKSB7CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBjb2w6IHdnZC5jb2wsCiAgICAgICAgICAgICAgICByb3c6IHdnZC5yb3csCiAgICAgICAgICAgICAgICBzaXplX3g6IHdnZC5zaXplX3gsCiAgICAgICAgICAgICAgICBzaXplX3k6IHdnZC5zaXplX3kKICAgICAgICAgICAgfTsKICAgICAgICB9LAogICAgICAgIGNvbGxpc2lvbjoge30sCiAgICAgICAgZHJhZ2dhYmxlOiB7CiAgICAgICAgICAgIGl0ZW1zOiAnLmdzLXcnLAogICAgICAgICAgICBkaXN0YW5jZTogNCwKICAgICAgICAgICAgaWdub3JlX2RyYWdnaW5nOiBEcmFnZ2FibGUuZGVmYXVsdHMuaWdub3JlX2RyYWdnaW5nLnNsaWNlKDApCiAgICAgICAgfSwKICAgICAgICByZXNpemU6IHsKICAgICAgICAgICAgZW5hYmxlZDogZmFsc2UsCiAgICAgICAgICAgIGF4ZXM6IFsnYm90aCddLAogICAgICAgICAgICBoYW5kbGVfYXBwZW5kX3RvOiAnJywKICAgICAgICAgICAgaGFuZGxlX2NsYXNzOiAnZ3MtcmVzaXplLWhhbmRsZScsCiAgICAgICAgICAgIG1heF9zaXplOiBbSW5maW5pdHksIEluZmluaXR5XSwKICAgICAgICAgICAgbWluX3NpemU6IFsxLCAxXQogICAgICAgIH0KICAgIH07CgogICAgLyoqCiAgICAqIEBjbGFzcyBHcmlkc3RlcgogICAgKiBAdXNlcyBEcmFnZ2FibGUKICAgICogQHVzZXMgQ29sbGlzaW9uCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsIFRoZSBIVE1MZWxlbWVudCB0aGF0IGNvbnRhaW5zIGFsbCB0aGUgd2lkZ2V0cy4KICAgICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXSBBbiBPYmplY3Qgd2l0aCBhbGwgb3B0aW9ucyB5b3Ugd2FudCB0bwogICAgKiAgICAgICAgb3ZlcndyaXRlOgogICAgKiAgICBAcGFyYW0ge0hUTUxFbGVtZW50fFN0cmluZ30gW29wdGlvbnMud2lkZ2V0X3NlbGVjdG9yXSBEZWZpbmUgd2hvIHdpbGwKICAgICogICAgIGJlIHRoZSBkcmFnZ2FibGUgd2lkZ2V0cy4gQ2FuIGJlIGEgQ1NTIFNlbGVjdG9yIFN0cmluZyBvciBhCiAgICAqICAgICBjb2xsZWN0aW9uIG9mIEhUTUxFbGVtZW50cwogICAgKiAgICBAcGFyYW0ge0FycmF5fSBbb3B0aW9ucy53aWRnZXRfbWFyZ2luc10gTWFyZ2luIGJldHdlZW4gd2lkZ2V0cy4KICAgICogICAgIFRoZSBmaXJzdCBpbmRleCBmb3IgdGhlIGhvcml6b250YWwgbWFyZ2luIChsZWZ0LCByaWdodCkgYW5kCiAgICAqICAgICB0aGUgc2Vjb25kIGZvciB0aGUgdmVydGljYWwgbWFyZ2luICh0b3AsIGJvdHRvbSkuCiAgICAqICAgIEBwYXJhbSB7QXJyYXl9IFtvcHRpb25zLndpZGdldF9iYXNlX2RpbWVuc2lvbnNdIEJhc2Ugd2lkZ2V0IGRpbWVuc2lvbnMKICAgICogICAgIGluIHBpeGVscy4gVGhlIGZpcnN0IGluZGV4IGZvciB0aGUgd2lkdGggYW5kIHRoZSBzZWNvbmQgZm9yIHRoZQogICAgKiAgICAgaGVpZ2h0LgogICAgKiAgICBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMuZXh0cmFfY29sc10gQWRkIG1vcmUgY29sdW1ucyBpbiBhZGRpdGlvbiB0bwogICAgKiAgICAgdGhvc2UgdGhhdCBoYXZlIGJlZW4gY2FsY3VsYXRlZC4KICAgICogICAgQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLmV4dHJhX3Jvd3NdIEFkZCBtb3JlIHJvd3MgaW4gYWRkaXRpb24gdG8KICAgICogICAgIHRob3NlIHRoYXQgaGF2ZSBiZWVuIGNhbGN1bGF0ZWQuCiAgICAqICAgIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5taW5fY29sc10gVGhlIG1pbmltdW0gcmVxdWlyZWQgY29sdW1ucy4KICAgICogICAgQHBhcmFtIHtOdW1iZXJ9IFtvcHRpb25zLm1heF9jb2xzXSBUaGUgbWF4aW11bSBjb2x1bW5zIHBvc3NpYmxlIChzZXQgdG8gbnVsbAogICAgKiAgICAgZm9yIG5vIG1heGltdW0pLgogICAgKiAgICBAcGFyYW0ge051bWJlcn0gW29wdGlvbnMubWluX3Jvd3NdIFRoZSBtaW5pbXVtIHJlcXVpcmVkIHJvd3MuCiAgICAqICAgIEBwYXJhbSB7TnVtYmVyfSBbb3B0aW9ucy5tYXhfc2l6ZV94XSBUaGUgbWF4aW11bSBudW1iZXIgb2YgY29sdW1ucwogICAgKiAgICAgdGhhdCBhIHdpZGdldCBjYW4gc3Bhbi4KICAgICogICAgQHBhcmFtIHtCb29sZWFufSBbb3B0aW9ucy5hdXRvZ2VuZXJhdGVfc3R5bGVzaGVldF0gSWYgdHJ1ZSwgYWxsIHRoZQogICAgKiAgICAgQ1NTIHJlcXVpcmVkIHRvIHBvc2l0aW9uIGFsbCB3aWRnZXRzIGluIHRoZWlyIHJlc3BlY3RpdmUgY29sdW1ucwogICAgKiAgICAgYW5kIHJvd3Mgd2lsbCBiZSBnZW5lcmF0ZWQgYXV0b21hdGljYWxseSBhbmQgaW5qZWN0ZWQgdG8gdGhlCiAgICAqICAgICBgPGhlYWQ+YCBvZiB0aGUgZG9jdW1lbnQuIFlvdSBjYW4gc2V0IHRoaXMgdG8gZmFsc2UsIGFuZCB3cml0ZQogICAgKiAgICAgeW91ciBvd24gQ1NTIHRhcmdldGluZyByb3dzIGFuZCBjb2xzIHZpYSBkYXRhLWF0dHJpYnV0ZXMgbGlrZSBzbzoKICAgICogICAgIGBbZGF0YS1jb2w9IjEiXSB7IGxlZnQ6IDEwcHg7IH1gCiAgICAqICAgIEBwYXJhbSB7Qm9vbGVhbn0gW29wdGlvbnMuYXZvaWRfb3ZlcmxhcHBlZF93aWRnZXRzXSBBdm9pZCB0aGF0IHdpZGdldHMgbG9hZGVkCiAgICAqICAgICBmcm9tIHRoZSBET00gY2FuIGJlIG92ZXJsYXBwZWQuIEl0IGlzIGhlbHBmdWwgaWYgdGhlIHBvc2l0aW9ucyB3ZXJlCiAgICAqICAgICBiYWQgc3RvcmVkIGluIHRoZSBkYXRhYmFzZSBvciBpZiB0aGVyZSB3YXMgYW55IGNvbmZsaWN0LgogICAgKiAgICBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLmF1dG9faW5pdF0gQXV0b21hdGljYWxseSBjYWxsIGdyaWRzdGVyIGluaXQKICAgICogICAgIG1ldGhvZCBvciBub3Qgd2hlbiB0aGUgcGx1Z2luIGlzIGluc3RhbnRpYXRlZC4KICAgICogICAgQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMuc2VyaWFsaXplX3BhcmFtc10gUmV0dXJuIHRoZSBkYXRhIHlvdSB3YW50CiAgICAqICAgICBmb3IgZWFjaCB3aWRnZXQgaW4gdGhlIHNlcmlhbGl6YXRpb24uIFR3byBhcmd1bWVudHMgYXJlIHBhc3NlZDoKICAgICogICAgIGAkd2A6IHRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudCwgYW5kIGB3Z2RgOiB0aGUgZ3JpZAogICAgKiAgICAgY29vcmRzIG9iamVjdCAoYGNvbGAsIGByb3dgLCBgc2l6ZV94YCwgYHNpemVfeWApLgogICAgKiAgICBAcGFyYW0ge09iamVjdH0gW29wdGlvbnMuY29sbGlzaW9uXSBBbiBPYmplY3Qgd2l0aCBhbGwgb3B0aW9ucyBmb3IKICAgICogICAgIENvbGxpc2lvbiBjbGFzcyB5b3Ugd2FudCB0byBvdmVyd3JpdGUuIFNlZSBDb2xsaXNpb24gZG9jcyBmb3IKICAgICogICAgIG1vcmUgaW5mby4KICAgICogICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLmRyYWdnYWJsZV0gQW4gT2JqZWN0IHdpdGggYWxsIG9wdGlvbnMgZm9yCiAgICAqICAgICBEcmFnZ2FibGUgY2xhc3MgeW91IHdhbnQgdG8gb3ZlcndyaXRlLiBTZWUgRHJhZ2dhYmxlIGRvY3MgZm9yIG1vcmUKICAgICogICAgIGluZm8uCiAgICAqICAgICAgIEBwYXJhbSB7T2JqZWN0fEZ1bmN0aW9ufSBbb3B0aW9ucy5kcmFnZ2FibGUuaWdub3JlX2RyYWdnaW5nXSBOb3RlIHRoYXQKICAgICogICAgICAgIGlmIHlvdSB1c2UgYSBGdW5jdGlvbiwgYW5kIHJlc2l6ZSBpcyBlbmFibGVkLCB5b3Ugc2hvdWxkIGlnbm9yZSB0aGUKICAgICogICAgICAgIHJlc2l6ZSBoYW5kbGVycyBtYW51YWxseSAob3B0aW9ucy5yZXNpemUuaGFuZGxlX2NsYXNzKS4KICAgICogICAgQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zLnJlc2l6ZV0gQW4gT2JqZWN0IHdpdGggcmVzaXplIGNvbmZpZyBvcHRpb25zLgogICAgKiAgICAgICBAcGFyYW0ge0Jvb2xlYW59IFtvcHRpb25zLnJlc2l6ZS5lbmFibGVkXSBTZXQgdG8gdHJ1ZSB0byBlbmFibGUKICAgICogICAgICAgIHJlc2l6aW5nLgogICAgKiAgICAgICBAcGFyYW0ge0FycmF5fSBbb3B0aW9ucy5yZXNpemUuYXhlc10gQXhlcyBpbiB3aGljaCB3aWRnZXRzIGNhbiBiZQogICAgKiAgICAgICAgcmVzaXplZC4gUG9zc2libGUgdmFsdWVzOiBbJ3gnLCAneScsICdib3RoJ10uCiAgICAqICAgICAgIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5yZXNpemUuaGFuZGxlX2FwcGVuZF90b10gU2V0IGEgdmFsaWQgQ1NTCiAgICAqICAgICAgICBzZWxlY3RvciB0byBhcHBlbmQgcmVzaXplIGhhbmRsZXMgdG8uCiAgICAqICAgICAgIEBwYXJhbSB7U3RyaW5nfSBbb3B0aW9ucy5yZXNpemUuaGFuZGxlX2NsYXNzXSBDU1MgY2xhc3MgbmFtZSB1c2VkCiAgICAqICAgICAgICBieSByZXNpemUgaGFuZGxlcy4KICAgICogICAgICAgQHBhcmFtIHtBcnJheX0gW29wdGlvbnMucmVzaXplLm1heF9zaXplXSBMaW1pdCB3aWRnZXQgZGltZW5zaW9ucwogICAgKiAgICAgICAgd2hlbiByZXNpemluZy4gQXJyYXkgdmFsdWVzIHNob3VsZCBiZSBpbnRlZ2VyczoKICAgICogICAgICAgIGBbbWF4X2NvbHNfb2NjdXBpZWQsIG1heF9yb3dzX29jY3VwaWVkXWAKICAgICogICAgICAgQHBhcmFtIHtBcnJheX0gW29wdGlvbnMucmVzaXplLm1pbl9zaXplXSBMaW1pdCB3aWRnZXQgZGltZW5zaW9ucwogICAgKiAgICAgICAgd2hlbiByZXNpemluZy4gQXJyYXkgdmFsdWVzIHNob3VsZCBiZSBpbnRlZ2VyczoKICAgICogICAgICAgIGBbbWluX2NvbHNfb2NjdXBpZWQsIG1pbl9yb3dzX29jY3VwaWVkXWAKICAgICogICAgICAgQHBhcmFtIHtGdW5jdGlvbn0gW29wdGlvbnMucmVzaXplLnN0YXJ0XSBGdW5jdGlvbiBleGVjdXRlZAogICAgKiAgICAgICAgd2hlbiByZXNpemluZyBzdGFydHMuCiAgICAqICAgICAgIEBwYXJhbSB7RnVuY3Rpb259IFtvdGlvbnMucmVzaXplLnJlc2l6ZV0gRnVuY3Rpb24gZXhlY3V0ZWQKICAgICogICAgICAgIGR1cmluZyB0aGUgcmVzaXppbmcuCiAgICAqICAgICAgIEBwYXJhbSB7RnVuY3Rpb259IFtvcHRpb25zLnJlc2l6ZS5zdG9wXSBGdW5jdGlvbiBleGVjdXRlZAogICAgKiAgICAgICAgd2hlbiByZXNpemluZyBzdG9wcy4KICAgICoKICAgICogQGNvbnN0cnVjdG9yCiAgICAqLwogICAgZnVuY3Rpb24gR3JpZHN0ZXIoZWwsIG9wdGlvbnMpIHsKICAgICAgICB0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMsIG9wdGlvbnMpOwogICAgICAgIHRoaXMuJGVsID0gJChlbCk7CiAgICAgICAgdGhpcy4kd3JhcHBlciA9IHRoaXMuJGVsLnBhcmVudCgpOwogICAgICAgIHRoaXMuJHdpZGdldHMgPSB0aGlzLiRlbC5jaGlsZHJlbigKICAgICAgICAgICAgdGhpcy5vcHRpb25zLndpZGdldF9zZWxlY3RvcikuYWRkQ2xhc3MoJ2dzLXcnKTsKICAgICAgICB0aGlzLndpZGdldHMgPSBbXTsKICAgICAgICB0aGlzLiRjaGFuZ2VkID0gJChbXSk7CiAgICAgICAgdGhpcy53cmFwcGVyX3dpZHRoID0gdGhpcy4kd3JhcHBlci53aWR0aCgpOwogICAgICAgIHRoaXMubWluX3dpZGdldF93aWR0aCA9ICh0aGlzLm9wdGlvbnMud2lkZ2V0X21hcmdpbnNbMF0gKiAyKSArCiAgICAgICAgICB0aGlzLm9wdGlvbnMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1swXTsKICAgICAgICB0aGlzLm1pbl93aWRnZXRfaGVpZ2h0ID0gKHRoaXMub3B0aW9ucy53aWRnZXRfbWFyZ2luc1sxXSAqIDIpICsKICAgICAgICAgIHRoaXMub3B0aW9ucy53aWRnZXRfYmFzZV9kaW1lbnNpb25zWzFdOwoKICAgICAgICB0aGlzLmdlbmVyYXRlZF9zdHlsZXNoZWV0cyA9IFtdOwogICAgICAgIHRoaXMuJHN0eWxlX3RhZ3MgPSAkKFtdKTsKCiAgICAgICAgdGhpcy5vcHRpb25zLmF1dG9faW5pdCAmJiB0aGlzLmluaXQoKTsKICAgIH0KCiAgICBHcmlkc3Rlci5kZWZhdWx0cyA9IGRlZmF1bHRzOwogICAgR3JpZHN0ZXIuZ2VuZXJhdGVkX3N0eWxlc2hlZXRzID0gW107CgoKICAgIC8qKgogICAgKiBTb3J0cyBhbiBBcnJheSBvZiBncmlkIGNvb3JkcyBvYmplY3RzIChyZXByZXNlbnRpbmcgdGhlIGdyaWQgY29vcmRzIG9mCiAgICAqIGVhY2ggd2lkZ2V0KSBpbiBhc2NlbmRpbmcgd2F5LgogICAgKgogICAgKiBAbWV0aG9kIHNvcnRfYnlfcm93X2FzYwogICAgKiBAcGFyYW0ge0FycmF5fSB3aWRnZXRzIEFycmF5IG9mIGdyaWQgY29vcmRzIG9iamVjdHMKICAgICogQHJldHVybiB7QXJyYXl9IFJldHVybnMgdGhlIGFycmF5IHNvcnRlZC4KICAgICovCiAgICBHcmlkc3Rlci5zb3J0X2J5X3Jvd19hc2MgPSBmdW5jdGlvbih3aWRnZXRzKSB7CiAgICAgICAgd2lkZ2V0cyA9IHdpZGdldHMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIGlmICghYS5yb3cpIHsKICAgICAgICAgICAgICAgIGEgPSAkKGEpLmNvb3JkcygpLmdyaWQ7CiAgICAgICAgICAgICAgICBiID0gJChiKS5jb29yZHMoKS5ncmlkOwogICAgICAgICAgICB9CgogICAgICAgICAgIGlmIChhLnJvdyA+IGIucm93KSB7CiAgICAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgIH0KICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfSk7CgogICAgICAgIHJldHVybiB3aWRnZXRzOwogICAgfTsKCgogICAgLyoqCiAgICAqIFNvcnRzIGFuIEFycmF5IG9mIGdyaWQgY29vcmRzIG9iamVjdHMgKHJlcHJlc2VudGluZyB0aGUgZ3JpZCBjb29yZHMgb2YKICAgICogZWFjaCB3aWRnZXQpIHBsYWNpbmcgZmlyc3QgdGhlIGVtcHR5IGNlbGxzIHVwcGVyIGxlZnQuCiAgICAqCiAgICAqIEBtZXRob2Qgc29ydF9ieV9yb3dfYW5kX2NvbF9hc2MKICAgICogQHBhcmFtIHtBcnJheX0gd2lkZ2V0cyBBcnJheSBvZiBncmlkIGNvb3JkcyBvYmplY3RzCiAgICAqIEByZXR1cm4ge0FycmF5fSBSZXR1cm5zIHRoZSBhcnJheSBzb3J0ZWQuCiAgICAqLwogICAgR3JpZHN0ZXIuc29ydF9ieV9yb3dfYW5kX2NvbF9hc2MgPSBmdW5jdGlvbih3aWRnZXRzKSB7CiAgICAgICAgd2lkZ2V0cyA9IHdpZGdldHMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgaWYgKGEucm93ID4gYi5yb3cgfHwgYS5yb3cgPT09IGIucm93ICYmIGEuY29sID4gYi5jb2wpIHsKICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgfQogICAgICAgICAgIHJldHVybiAtMTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHdpZGdldHM7CiAgICB9OwoKCiAgICAvKioKICAgICogU29ydHMgYW4gQXJyYXkgb2YgZ3JpZCBjb29yZHMgb2JqZWN0cyBieSBjb2x1bW4gKHJlcHJlc2VudGluZyB0aGUgZ3JpZAogICAgKiBjb29yZHMgb2YgZWFjaCB3aWRnZXQpIGluIGFzY2VuZGluZyB3YXkuCiAgICAqCiAgICAqIEBtZXRob2Qgc29ydF9ieV9jb2xfYXNjCiAgICAqIEBwYXJhbSB7QXJyYXl9IHdpZGdldHMgQXJyYXkgb2YgZ3JpZCBjb29yZHMgb2JqZWN0cwogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgc29ydGVkLgogICAgKi8KICAgIEdyaWRzdGVyLnNvcnRfYnlfY29sX2FzYyA9IGZ1bmN0aW9uKHdpZGdldHMpIHsKICAgICAgICB3aWRnZXRzID0gd2lkZ2V0cy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICBpZiAoYS5jb2wgPiBiLmNvbCkgewogICAgICAgICAgICAgICByZXR1cm4gMTsKICAgICAgICAgICB9CiAgICAgICAgICAgcmV0dXJuIC0xOwogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gd2lkZ2V0czsKICAgIH07CgoKICAgIC8qKgogICAgKiBTb3J0cyBhbiBBcnJheSBvZiBncmlkIGNvb3JkcyBvYmplY3RzIChyZXByZXNlbnRpbmcgdGhlIGdyaWQgY29vcmRzIG9mCiAgICAqIGVhY2ggd2lkZ2V0KSBpbiBkZXNjZW5kaW5nIHdheS4KICAgICoKICAgICogQG1ldGhvZCBzb3J0X2J5X3Jvd19kZXNjCiAgICAqIEBwYXJhbSB7QXJyYXl9IHdpZGdldHMgQXJyYXkgb2YgZ3JpZCBjb29yZHMgb2JqZWN0cwogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyB0aGUgYXJyYXkgc29ydGVkLgogICAgKi8KICAgIEdyaWRzdGVyLnNvcnRfYnlfcm93X2Rlc2MgPSBmdW5jdGlvbih3aWRnZXRzKSB7CiAgICAgICAgd2lkZ2V0cyA9IHdpZGdldHMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgIGlmIChhLnJvdyArIGEuc2l6ZV95IDwgYi5yb3cgKyBiLnNpemVfeSkgewogICAgICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgICAgIH0KICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHdpZGdldHM7CiAgICB9OwoKCgogICAgLyoqIEluc3RhbmNlIE1ldGhvZHMgKiovCgogICAgdmFyIGZuID0gR3JpZHN0ZXIucHJvdG90eXBlOwoKICAgIGZuLmluaXQgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLm9wdGlvbnMucmVzaXplLmVuYWJsZWQgJiYgdGhpcy5zZXR1cF9yZXNpemUoKTsKICAgICAgICB0aGlzLmdlbmVyYXRlX2dyaWRfYW5kX3N0eWxlc2hlZXQoKTsKICAgICAgICB0aGlzLmdldF93aWRnZXRzX2Zyb21fRE9NKCk7CiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfaGVpZ2h0KCk7CiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfd2lkdGgoKTsKICAgICAgICB0aGlzLiR3cmFwcGVyLmFkZENsYXNzKCdyZWFkeScpOwogICAgICAgIHRoaXMuZHJhZ2dhYmxlKCk7CiAgICAgICAgdGhpcy5vcHRpb25zLnJlc2l6ZS5lbmFibGVkICYmIHRoaXMucmVzaXphYmxlKCk7CgogICAgICAgICQod2luZG93KS5iaW5kKCdyZXNpemUuZ3JpZHN0ZXInLCB0aHJvdHRsZSgKICAgICAgICAgICAgJC5wcm94eSh0aGlzLnJlY2FsY3VsYXRlX2ZhdXhfZ3JpZCwgdGhpcyksIDIwMCkpOwogICAgfTsKCgogICAgLyoqCiAgICAqIERpc2FibGVzIGRyYWdnaW5nLgogICAgKgogICAgKiBAbWV0aG9kIGRpc2FibGUKICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5kaXNhYmxlID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy4kd3JhcHBlci5maW5kKCcucGxheWVyLXJldmVydCcpLnJlbW92ZUNsYXNzKCdwbGF5ZXItcmV2ZXJ0Jyk7CiAgICAgICAgdGhpcy5kcmFnX2FwaS5kaXNhYmxlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogRW5hYmxlcyBkcmFnZ2luZy4KICAgICoKICAgICogQG1ldGhvZCBlbmFibGUKICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5lbmFibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLmRyYWdfYXBpLmVuYWJsZSgpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgoKICAgIC8qKgogICAgKiBEaXNhYmxlcyBkcmFnLWFuZC1kcm9wIHdpZGdldCByZXNpemluZy4KICAgICoKICAgICogQG1ldGhvZCBkaXNhYmxlCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIGluc3RhbmNlIG9mIGdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLmRpc2FibGVfcmVzaXplID0gZnVuY3Rpb24oKSB7CiAgICAgICAgdGhpcy4kZWwuYWRkQ2xhc3MoJ2dzLXJlc2l6ZS1kaXNhYmxlZCcpOwogICAgICAgIHRoaXMucmVzaXplX2FwaS5kaXNhYmxlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogRW5hYmxlcyBkcmFnLWFuZC1kcm9wIHdpZGdldCByZXNpemluZy4KICAgICoKICAgICogQG1ldGhvZCBlbmFibGUKICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgaW5zdGFuY2Ugb2YgZ3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4uZW5hYmxlX3Jlc2l6ZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMuJGVsLnJlbW92ZUNsYXNzKCdncy1yZXNpemUtZGlzYWJsZWQnKTsKICAgICAgICB0aGlzLnJlc2l6ZV9hcGkuZW5hYmxlKCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogQWRkIGEgbmV3IHdpZGdldCB0byB0aGUgZ3JpZC4KICAgICoKICAgICogQG1ldGhvZCBhZGRfd2lkZ2V0CiAgICAqIEBwYXJhbSB7U3RyaW5nfEhUTUxFbGVtZW50fSBodG1sIFRoZSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBIVE1MIG9mIHRoZSB3aWRnZXQKICAgICogIG9yIHRoZSBIVE1MRWxlbWVudC4KICAgICogQHBhcmFtIHtOdW1iZXJ9IFtzaXplX3hdIFRoZSBuwrogb2Ygcm93cyB0aGUgd2lkZ2V0IG9jY3VwaWVzIGhvcml6b250YWxseS4KICAgICogQHBhcmFtIHtOdW1iZXJ9IFtzaXplX3ldIFRoZSBuwrogb2YgY29sdW1ucyB0aGUgd2lkZ2V0IG9jY3VwaWVzIHZlcnRpY2FsbHkuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBbY29sXSBUaGUgY29sdW1uIHRoZSB3aWRnZXQgc2hvdWxkIHN0YXJ0IGluLgogICAgKiBAcGFyYW0ge051bWJlcn0gW3Jvd10gVGhlIHJvdyB0aGUgd2lkZ2V0IHNob3VsZCBzdGFydCBpbi4KICAgICogQHBhcmFtIHtBcnJheX0gW21heF9zaXplXSBtYXhfc2l6ZSBNYXhpbXVuIHNpemUgKGluIHVuaXRzKSBmb3Igd2lkdGggYW5kIGhlaWdodC4KICAgICogQHBhcmFtIHtBcnJheX0gW21pbl9zaXplXSBtaW5fc2l6ZSBNaW5pbXVtIHNpemUgKGluIHVuaXRzKSBmb3Igd2lkdGggYW5kIGhlaWdodC4KICAgICogQHJldHVybiB7SFRNTEVsZW1lbnR9IFJldHVybnMgdGhlIGpRdWVyeSB3cmFwcGVkIEhUTUxFbGVtZW50IHJlcHJlc2VudGluZy4KICAgICogIHRoZSB3aWRnZXQgdGhhdCB3YXMganVzdCBjcmVhdGVkLgogICAgKi8KICAgIGZuLmFkZF93aWRnZXQgPSBmdW5jdGlvbihodG1sLCBzaXplX3gsIHNpemVfeSwgY29sLCByb3csIG1heF9zaXplLCBtaW5fc2l6ZSkgewogICAgICAgIHZhciBwb3M7CiAgICAgICAgc2l6ZV94IHx8IChzaXplX3ggPSAxKTsKICAgICAgICBzaXplX3kgfHwgKHNpemVfeSA9IDEpOwoKICAgICAgICBpZiAoIWNvbCAmICFyb3cpIHsKICAgICAgICAgICAgcG9zID0gdGhpcy5uZXh0X3Bvc2l0aW9uKHNpemVfeCwgc2l6ZV95KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBwb3MgPSB7CiAgICAgICAgICAgICAgICBjb2w6IGNvbCwKICAgICAgICAgICAgICAgIHJvdzogcm93LAogICAgICAgICAgICAgICAgc2l6ZV94OiBzaXplX3gsCiAgICAgICAgICAgICAgICBzaXplX3k6IHNpemVfeQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgdGhpcy5lbXB0eV9jZWxscyhjb2wsIHJvdywgc2l6ZV94LCBzaXplX3kpOwogICAgICAgIH0KCiAgICAgICAgdmFyICR3ID0gJChodG1sKS5hdHRyKHsKICAgICAgICAgICAgICAgICdkYXRhLWNvbCc6IHBvcy5jb2wsCiAgICAgICAgICAgICAgICAnZGF0YS1yb3cnOiBwb3Mucm93LAogICAgICAgICAgICAgICAgJ2RhdGEtc2l6ZXgnIDogc2l6ZV94LAogICAgICAgICAgICAgICAgJ2RhdGEtc2l6ZXknIDogc2l6ZV95CiAgICAgICAgICAgIH0pLmFkZENsYXNzKCdncy13JykuYXBwZW5kVG8odGhpcy4kZWwpLmhpZGUoKTsKCiAgICAgICAgdGhpcy4kd2lkZ2V0cyA9IHRoaXMuJHdpZGdldHMuYWRkKCR3KTsKCiAgICAgICAgdGhpcy5yZWdpc3Rlcl93aWRnZXQoJHcpOwoKICAgICAgICB0aGlzLmFkZF9mYXV4X3Jvd3MocG9zLnNpemVfeSk7CiAgICAgICAgLy90aGlzLmFkZF9mYXV4X2NvbHMocG9zLnNpemVfeCk7CgogICAgICAgIGlmIChtYXhfc2l6ZSkgewogICAgICAgICAgICB0aGlzLnNldF93aWRnZXRfbWF4X3NpemUoJHcsIG1heF9zaXplKTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW5fc2l6ZSkgewogICAgICAgICAgICB0aGlzLnNldF93aWRnZXRfbWluX3NpemUoJHcsIG1pbl9zaXplKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX3dpZHRoKCk7CiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfaGVpZ2h0KCk7CgogICAgICAgIHRoaXMuZHJhZ19hcGkuc2V0X2xpbWl0cyh0aGlzLmNvbHMgKiB0aGlzLm1pbl93aWRnZXRfd2lkdGgpOwoKICAgICAgICByZXR1cm4gJHcuZmFkZUluKCk7CiAgICB9OwoKCiAgICAvKioKICAgICogQ2hhbmdlIHdpZGdldCBzaXplIGxpbWl0cy4KICAgICoKICAgICogQG1ldGhvZCBzZXRfd2lkZ2V0X21pbl9zaXplCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8TnVtYmVyfSAkd2lkZ2V0IFRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudAogICAgKiAgcmVwcmVzZW50aW5nIHRoZSB3aWRnZXQgb3IgYW4gaW5kZXggcmVwcmVzZW50aW5nIHRoZSBkZXNpcmVkIHdpZGdldC4KICAgICogQHBhcmFtIHtBcnJheX0gbWluX3NpemUgTWluaW11bSBzaXplIChpbiB1bml0cykgZm9yIHdpZHRoIGFuZCBoZWlnaHQuCiAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBSZXR1cm5zIGluc3RhbmNlIG9mIGdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnNldF93aWRnZXRfbWluX3NpemUgPSBmdW5jdGlvbigkd2lkZ2V0LCBtaW5fc2l6ZSkgewogICAgICAgICR3aWRnZXQgPSB0eXBlb2YgJHdpZGdldCA9PT0gJ251bWJlcicgPwogICAgICAgICAgICB0aGlzLiR3aWRnZXRzLmVxKCR3aWRnZXQpIDogJHdpZGdldDsKCiAgICAgICAgaWYgKCEkd2lkZ2V0Lmxlbmd0aCkgeyByZXR1cm4gdGhpczsgfQoKICAgICAgICB2YXIgd2dkID0gJHdpZGdldC5kYXRhKCdjb29yZHMnKS5ncmlkOwogICAgICAgIHdnZC5taW5fc2l6ZV94ID0gbWluX3NpemVbMF07CiAgICAgICAgd2dkLm1pbl9zaXplX3kgPSBtaW5fc2l6ZVsxXTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogQ2hhbmdlIHdpZGdldCBzaXplIGxpbWl0cy4KICAgICoKICAgICogQG1ldGhvZCBzZXRfd2lkZ2V0X21heF9zaXplCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8TnVtYmVyfSAkd2lkZ2V0IFRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudAogICAgKiAgcmVwcmVzZW50aW5nIHRoZSB3aWRnZXQgb3IgYW4gaW5kZXggcmVwcmVzZW50aW5nIHRoZSBkZXNpcmVkIHdpZGdldC4KICAgICogQHBhcmFtIHtBcnJheX0gbWF4X3NpemUgTWF4aW11biBzaXplIChpbiB1bml0cykgZm9yIHdpZHRoIGFuZCBoZWlnaHQuCiAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBSZXR1cm5zIGluc3RhbmNlIG9mIGdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnNldF93aWRnZXRfbWF4X3NpemUgPSBmdW5jdGlvbigkd2lkZ2V0LCBtYXhfc2l6ZSkgewogICAgICAgICR3aWRnZXQgPSB0eXBlb2YgJHdpZGdldCA9PT0gJ251bWJlcicgPwogICAgICAgICAgICB0aGlzLiR3aWRnZXRzLmVxKCR3aWRnZXQpIDogJHdpZGdldDsKCiAgICAgICAgaWYgKCEkd2lkZ2V0Lmxlbmd0aCkgeyByZXR1cm4gdGhpczsgfQoKICAgICAgICB2YXIgd2dkID0gJHdpZGdldC5kYXRhKCdjb29yZHMnKS5ncmlkOwogICAgICAgIHdnZC5tYXhfc2l6ZV94ID0gbWF4X3NpemVbMF07CiAgICAgICAgd2dkLm1heF9zaXplX3kgPSBtYXhfc2l6ZVsxXTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogQXBwZW5kIHRoZSByZXNpemUgaGFuZGxlIGludG8gYSB3aWRnZXQuCiAgICAqCiAgICAqIEBtZXRob2QgYWRkX3Jlc2l6ZV9oYW5kbGUKICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gJHdpZGdldCBUaGUgalF1ZXJ5IHdyYXBwZWQgSFRNTEVsZW1lbnQKICAgICogIHJlcHJlc2VudGluZyB0aGUgd2lkZ2V0LgogICAgKiBAcmV0dXJuIHtIVE1MRWxlbWVudH0gUmV0dXJucyBpbnN0YW5jZSBvZiBncmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5hZGRfcmVzaXplX2hhbmRsZSA9IGZ1bmN0aW9uKCR3KSB7CiAgICAgICAgdmFyIGFwcGVuZF90byA9IHRoaXMub3B0aW9ucy5yZXNpemUuaGFuZGxlX2FwcGVuZF90bzsKICAgICAgICAkKHRoaXMucmVzaXplX2hhbmRsZV90cGwpLmFwcGVuZFRvKCBhcHBlbmRfdG8gPyAkKGFwcGVuZF90bywgJHcpIDogJHcpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBDaGFuZ2UgdGhlIHNpemUgb2YgYSB3aWRnZXQuIFdpZHRoIGlzIGxpbWl0ZWQgdG8gdGhlIGN1cnJlbnQgZ3JpZCB3aWR0aC4KICAgICoKICAgICogQG1ldGhvZCByZXNpemVfd2lkZ2V0CiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9ICR3aWRnZXQgVGhlIGpRdWVyeSB3cmFwcGVkIEhUTUxFbGVtZW50CiAgICAqICByZXByZXNlbnRpbmcgdGhlIHdpZGdldC4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHNpemVfeCBUaGUgbnVtYmVyIG9mIGNvbHVtbnMgdGhhdCB3aWxsIG9jY3VweSB0aGUgd2lkZ2V0LgogICAgKiAgQnkgZGVmYXVsdCA8Y29kZT5zaXplX3g8L2NvZGU+IGlzIGxpbWl0ZWQgdG8gdGhlIHNwYWNlIGF2YWlsYWJsZSBmcm9tCiAgICAqICB0aGUgY29sdW1uIHdoZXJlIHRoZSB3aWRnZXQgYmVnaW5zLCB1bnRpbCB0aGUgbGFzdCBjb2x1bW4gdG8gdGhlIHJpZ2h0LgogICAgKiBAcGFyYW0ge051bWJlcn0gc2l6ZV95IFRoZSBudW1iZXIgb2Ygcm93cyB0aGF0IHdpbGwgb2NjdXB5IHRoZSB3aWRnZXQuCiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IFtjYWxsYmFja10gRnVuY3Rpb24gZXhlY3V0ZWQgd2hlbiB0aGUgd2lkZ2V0IGlzIHJlbW92ZWQuCiAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBSZXR1cm5zICR3aWRnZXQuCiAgICAqLwogICAgZm4ucmVzaXplX3dpZGdldCA9IGZ1bmN0aW9uKCR3aWRnZXQsIHNpemVfeCwgc2l6ZV95LCBjYWxsYmFjaykgewogICAgICAgIHZhciB3Z2QgPSAkd2lkZ2V0LmNvb3JkcygpLmdyaWQ7CiAgICAgICAgdmFyIGNvbCA9IHdnZC5jb2w7CiAgICAgICAgdmFyIG1heF9jb2xzID0gdGhpcy5vcHRpb25zLm1heF9jb2xzOwogICAgICAgIHZhciBvbGRfc2l6ZV95ID0gd2dkLnNpemVfeTsKICAgICAgICB2YXIgb2xkX2NvbCA9IHdnZC5jb2w7CiAgICAgICAgdmFyIG5ld19jb2wgPSBvbGRfY29sOwoKICAgICAgICBzaXplX3ggfHwgKHNpemVfeCA9IHdnZC5zaXplX3gpOwogICAgICAgIHNpemVfeSB8fCAoc2l6ZV95ID0gd2dkLnNpemVfeSk7CgogICAgICAgIGlmIChtYXhfY29scyAhPT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgc2l6ZV94ID0gTWF0aC5taW4oc2l6ZV94LCBtYXhfY29scyAtIGNvbCArIDEpOwogICAgICAgIH0KCiAgICAgICAgaWYgKHNpemVfeSA+IG9sZF9zaXplX3kpIHsKICAgICAgICAgICAgdGhpcy5hZGRfZmF1eF9yb3dzKE1hdGgubWF4KHNpemVfeSAtIG9sZF9zaXplX3ksIDApKTsKICAgICAgICB9CgogICAgICAgIHZhciBwbGF5ZXJfcmNvbCA9IChjb2wgKyBzaXplX3ggLSAxKTsKICAgICAgICBpZiAocGxheWVyX3Jjb2wgPiB0aGlzLmNvbHMpIHsKICAgICAgICAgICAgdGhpcy5hZGRfZmF1eF9jb2xzKHBsYXllcl9yY29sIC0gdGhpcy5jb2xzKTsKICAgICAgICB9CgogICAgICAgIHZhciBuZXdfZ3JpZF9kYXRhID0gewogICAgICAgICAgICBjb2w6IG5ld19jb2wsCiAgICAgICAgICAgIHJvdzogd2dkLnJvdywKICAgICAgICAgICAgc2l6ZV94OiBzaXplX3gsCiAgICAgICAgICAgIHNpemVfeTogc2l6ZV95CiAgICAgICAgfTsKCiAgICAgICAgdGhpcy5tdXRhdGVfd2lkZ2V0X2luX2dyaWRtYXAoJHdpZGdldCwgd2dkLCBuZXdfZ3JpZF9kYXRhKTsKCiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfaGVpZ2h0KCk7CiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfd2lkdGgoKTsKCiAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgbmV3X2dyaWRfZGF0YS5zaXplX3gsIG5ld19ncmlkX2RhdGEuc2l6ZV95KTsKICAgICAgICB9CgogICAgICAgIHJldHVybiAkd2lkZ2V0OwogICAgfTsKCgogICAgLyoqCiAgICAqIE11dGF0ZSB3aWRnZXQgZGltZW5zaW9ucyBhbmQgcG9zaXRpb24gaW4gdGhlIGdyaWQgbWFwLgogICAgKgogICAgKiBAbWV0aG9kIG11dGF0ZV93aWRnZXRfaW5fZ3JpZG1hcAogICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSAkd2lkZ2V0IFRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudAogICAgKiAgcmVwcmVzZW50aW5nIHRoZSB3aWRnZXQgdG8gbXV0YXRlLgogICAgKiBAcGFyYW0ge09iamVjdH0gd2dkIEN1cnJlbnQgd2lkZ2V0IGdyaWQgZGF0YSAoY29sLCByb3csIHNpemVfeCwgc2l6ZV95KS4KICAgICogQHBhcmFtIHtPYmplY3R9IG5ld193Z2QgTmV3IHdpZGdldCBncmlkIGRhdGEuCiAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBSZXR1cm5zIGluc3RhbmNlIG9mIGdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLm11dGF0ZV93aWRnZXRfaW5fZ3JpZG1hcCA9IGZ1bmN0aW9uKCR3aWRnZXQsIHdnZCwgbmV3X3dnZCkgewogICAgICAgIHZhciBvbGRfc2l6ZV94ID0gd2dkLnNpemVfeDsKICAgICAgICB2YXIgb2xkX3NpemVfeSA9IHdnZC5zaXplX3k7CgogICAgICAgIHZhciBvbGRfY2VsbHNfb2NjdXBpZWQgPSB0aGlzLmdldF9jZWxsc19vY2N1cGllZCh3Z2QpOwogICAgICAgIHZhciBuZXdfY2VsbHNfb2NjdXBpZWQgPSB0aGlzLmdldF9jZWxsc19vY2N1cGllZChuZXdfd2dkKTsKCiAgICAgICAgdmFyIGVtcHR5X2NvbHMgPSBbXTsKICAgICAgICAkLmVhY2gob2xkX2NlbGxzX29jY3VwaWVkLmNvbHMsIGZ1bmN0aW9uKGksIGNvbCkgewogICAgICAgICAgICBpZiAoJC5pbkFycmF5KGNvbCwgbmV3X2NlbGxzX29jY3VwaWVkLmNvbHMpID09PSAtMSkgewogICAgICAgICAgICAgICAgZW1wdHlfY29scy5wdXNoKGNvbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIG9jY3VwaWVkX2NvbHMgPSBbXTsKICAgICAgICAkLmVhY2gobmV3X2NlbGxzX29jY3VwaWVkLmNvbHMsIGZ1bmN0aW9uKGksIGNvbCkgewogICAgICAgICAgICBpZiAoJC5pbkFycmF5KGNvbCwgb2xkX2NlbGxzX29jY3VwaWVkLmNvbHMpID09PSAtMSkgewogICAgICAgICAgICAgICAgb2NjdXBpZWRfY29scy5wdXNoKGNvbCk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIGVtcHR5X3Jvd3MgPSBbXTsKICAgICAgICAkLmVhY2gob2xkX2NlbGxzX29jY3VwaWVkLnJvd3MsIGZ1bmN0aW9uKGksIHJvdykgewogICAgICAgICAgICBpZiAoJC5pbkFycmF5KHJvdywgbmV3X2NlbGxzX29jY3VwaWVkLnJvd3MpID09PSAtMSkgewogICAgICAgICAgICAgICAgZW1wdHlfcm93cy5wdXNoKHJvdyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdmFyIG9jY3VwaWVkX3Jvd3MgPSBbXTsKICAgICAgICAkLmVhY2gobmV3X2NlbGxzX29jY3VwaWVkLnJvd3MsIGZ1bmN0aW9uKGksIHJvdykgewogICAgICAgICAgICBpZiAoJC5pbkFycmF5KHJvdywgb2xkX2NlbGxzX29jY3VwaWVkLnJvd3MpID09PSAtMSkgewogICAgICAgICAgICAgICAgb2NjdXBpZWRfcm93cy5wdXNoKHJvdyk7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5yZW1vdmVfZnJvbV9ncmlkbWFwKHdnZCk7CgogICAgICAgIGlmIChvY2N1cGllZF9jb2xzLmxlbmd0aCkgewogICAgICAgICAgICB2YXIgY29sc190b19lbXB0eSA9IFsKICAgICAgICAgICAgICAgIG5ld193Z2QuY29sLCBuZXdfd2dkLnJvdywgbmV3X3dnZC5zaXplX3gsIE1hdGgubWluKG9sZF9zaXplX3ksIG5ld193Z2Quc2l6ZV95KSwgJHdpZGdldAogICAgICAgICAgICBdOwogICAgICAgICAgICB0aGlzLmVtcHR5X2NlbGxzLmFwcGx5KHRoaXMsIGNvbHNfdG9fZW1wdHkpOwogICAgICAgIH0KCiAgICAgICAgaWYgKG9jY3VwaWVkX3Jvd3MubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciByb3dzX3RvX2VtcHR5ID0gW25ld193Z2QuY29sLCBuZXdfd2dkLnJvdywgbmV3X3dnZC5zaXplX3gsIG5ld193Z2Quc2l6ZV95LCAkd2lkZ2V0XTsKICAgICAgICAgICAgdGhpcy5lbXB0eV9jZWxscy5hcHBseSh0aGlzLCByb3dzX3RvX2VtcHR5KTsKICAgICAgICB9CgogICAgICAgIC8vIG5vdCB0aGUgc2FtZSB0aGF0IHdnZCA9IG5ld193Z2Q7CiAgICAgICAgd2dkLmNvbCA9IG5ld193Z2QuY29sOwogICAgICAgIHdnZC5yb3cgPSBuZXdfd2dkLnJvdzsKICAgICAgICB3Z2Quc2l6ZV94ID0gbmV3X3dnZC5zaXplX3g7CiAgICAgICAgd2dkLnNpemVfeSA9IG5ld193Z2Quc2l6ZV95OwoKICAgICAgICB0aGlzLmFkZF90b19ncmlkbWFwKG5ld193Z2QsICR3aWRnZXQpOwoKICAgICAgICAkd2lkZ2V0LnJlbW92ZUNsYXNzKCdwbGF5ZXItcmV2ZXJ0Jyk7CgogICAgICAgIC8vdXBkYXRlIGNvb3JkcyBpbnN0YW5jZSBhdHRyaWJ1dGVzCiAgICAgICAgJHdpZGdldC5kYXRhKCdjb29yZHMnKS51cGRhdGUoewogICAgICAgICAgICB3aWR0aDogKG5ld193Z2Quc2l6ZV94ICogdGhpcy5vcHRpb25zLndpZGdldF9iYXNlX2RpbWVuc2lvbnNbMF0gKwogICAgICAgICAgICAgICAgKChuZXdfd2dkLnNpemVfeCAtIDEpICogdGhpcy5vcHRpb25zLndpZGdldF9tYXJnaW5zWzBdKSAqIDIpLAogICAgICAgICAgICBoZWlnaHQ6IChuZXdfd2dkLnNpemVfeSAqIHRoaXMub3B0aW9ucy53aWRnZXRfYmFzZV9kaW1lbnNpb25zWzFdICsKICAgICAgICAgICAgICAgICgobmV3X3dnZC5zaXplX3kgLSAxKSAqIHRoaXMub3B0aW9ucy53aWRnZXRfbWFyZ2luc1sxXSkgKiAyKQogICAgICAgIH0pOwoKICAgICAgICAkd2lkZ2V0LmF0dHIoewogICAgICAgICAgICAnZGF0YS1jb2wnOiBuZXdfd2dkLmNvbCwKICAgICAgICAgICAgJ2RhdGEtcm93JzogbmV3X3dnZC5yb3csCiAgICAgICAgICAgICdkYXRhLXNpemV4JzogbmV3X3dnZC5zaXplX3gsCiAgICAgICAgICAgICdkYXRhLXNpemV5JzogbmV3X3dnZC5zaXplX3kKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGVtcHR5X2NvbHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBjb2xzX3RvX3JlbW92ZV9ob2xlcyA9IFsKICAgICAgICAgICAgICAgIGVtcHR5X2NvbHNbMF0sIG5ld193Z2Qucm93LAogICAgICAgICAgICAgICAgZW1wdHlfY29scy5sZW5ndGgsCiAgICAgICAgICAgICAgICBNYXRoLm1pbihvbGRfc2l6ZV95LCBuZXdfd2dkLnNpemVfeSksCiAgICAgICAgICAgICAgICAkd2lkZ2V0CiAgICAgICAgICAgIF07CgogICAgICAgICAgICB0aGlzLnJlbW92ZV9lbXB0eV9jZWxscy5hcHBseSh0aGlzLCBjb2xzX3RvX3JlbW92ZV9ob2xlcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAoZW1wdHlfcm93cy5sZW5ndGgpIHsKICAgICAgICAgICAgdmFyIHJvd3NfdG9fcmVtb3ZlX2hvbGVzID0gWwogICAgICAgICAgICAgICAgbmV3X3dnZC5jb2wsIG5ld193Z2Qucm93LCBuZXdfd2dkLnNpemVfeCwgbmV3X3dnZC5zaXplX3ksICR3aWRnZXQKICAgICAgICAgICAgXTsKICAgICAgICAgICAgdGhpcy5yZW1vdmVfZW1wdHlfY2VsbHMuYXBwbHkodGhpcywgcm93c190b19yZW1vdmVfaG9sZXMpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5tb3ZlX3dpZGdldF91cCgkd2lkZ2V0KTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogTW92ZSBkb3duIHdpZGdldHMgaW4gY2VsbHMgcmVwcmVzZW50ZWQgYnkgdGhlIGFyZ3VtZW50cyBjb2wsIHJvdywgc2l6ZV94LAogICAgKiBzaXplX3kKICAgICoKICAgICogQG1ldGhvZCBlbXB0eV9jZWxscwogICAgKiBAcGFyYW0ge051bWJlcn0gY29sIFRoZSBjb2x1bW4gd2hlcmUgdGhlIGdyb3VwIG9mIGNlbGxzIGJlZ2luLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgd2hlcmUgdGhlIGdyb3VwIG9mIGNlbGxzIGJlZ2luLgogICAgKiBAcGFyYW0ge051bWJlcn0gc2l6ZV94IFRoZSBudW1iZXIgb2YgY29sdW1ucyB0aGF0IHRoZSBncm91cCBvZiBjZWxscwogICAgKiBvY2N1cHkuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBzaXplX3kgVGhlIG51bWJlciBvZiByb3dzIHRoYXQgdGhlIGdyb3VwIG9mIGNlbGxzCiAgICAqIG9jY3VweS4KICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gJGV4Y2x1ZGUgRXhjbHVkZSB3aWRnZXRzIGZyb20gYmVpbmcgbW92ZWQuCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4uZW1wdHlfY2VsbHMgPSBmdW5jdGlvbihjb2wsIHJvdywgc2l6ZV94LCBzaXplX3ksICRleGNsdWRlKSB7CiAgICAgICAgdmFyICRuZXh0cyA9IHRoaXMud2lkZ2V0c19iZWxvdyh7CiAgICAgICAgICAgICAgICBjb2w6IGNvbCwKICAgICAgICAgICAgICAgIHJvdzogcm93IC0gc2l6ZV95LAogICAgICAgICAgICAgICAgc2l6ZV94OiBzaXplX3gsCiAgICAgICAgICAgICAgICBzaXplX3k6IHNpemVfeQogICAgICAgICAgICB9KTsKCiAgICAgICAgJG5leHRzLm5vdCgkZXhjbHVkZSkuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGksIHcpIHsKICAgICAgICAgICAgdmFyIHdnZCA9ICQodykuY29vcmRzKCkuZ3JpZDsKICAgICAgICAgICAgaWYgKCAhKHdnZC5yb3cgPD0gKHJvdyArIHNpemVfeSAtIDEpKSkgeyByZXR1cm47IH0KICAgICAgICAgICAgdmFyIGRpZmYgPSAgKHJvdyArIHNpemVfeSkgLSB3Z2Qucm93OwogICAgICAgICAgICB0aGlzLm1vdmVfd2lkZ2V0X2Rvd24oJCh3KSwgZGlmZik7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICB0aGlzLnNldF9kb21fZ3JpZF9oZWlnaHQoKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogTW92ZSB1cCB3aWRnZXRzIGJlbG93IGNlbGxzIHJlcHJlc2VudGVkIGJ5IHRoZSBhcmd1bWVudHMgY29sLCByb3csIHNpemVfeCwKICAgICogc2l6ZV95LgogICAgKgogICAgKiBAbWV0aG9kIHJlbW92ZV9lbXB0eV9jZWxscwogICAgKiBAcGFyYW0ge051bWJlcn0gY29sIFRoZSBjb2x1bW4gd2hlcmUgdGhlIGdyb3VwIG9mIGNlbGxzIGJlZ2luLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgd2hlcmUgdGhlIGdyb3VwIG9mIGNlbGxzIGJlZ2luLgogICAgKiBAcGFyYW0ge051bWJlcn0gc2l6ZV94IFRoZSBudW1iZXIgb2YgY29sdW1ucyB0aGF0IHRoZSBncm91cCBvZiBjZWxscwogICAgKiBvY2N1cHkuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBzaXplX3kgVGhlIG51bWJlciBvZiByb3dzIHRoYXQgdGhlIGdyb3VwIG9mIGNlbGxzCiAgICAqIG9jY3VweS4KICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gZXhjbHVkZSBFeGNsdWRlIHdpZGdldHMgZnJvbSBiZWluZyBtb3ZlZC4KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5yZW1vdmVfZW1wdHlfY2VsbHMgPSBmdW5jdGlvbihjb2wsIHJvdywgc2l6ZV94LCBzaXplX3ksIGV4Y2x1ZGUpIHsKICAgICAgICB2YXIgJG5leHRzID0gdGhpcy53aWRnZXRzX2JlbG93KHsKICAgICAgICAgICAgY29sOiBjb2wsCiAgICAgICAgICAgIHJvdzogcm93LAogICAgICAgICAgICBzaXplX3g6IHNpemVfeCwKICAgICAgICAgICAgc2l6ZV95OiBzaXplX3kKICAgICAgICB9KTsKCiAgICAgICAgJG5leHRzLm5vdChleGNsdWRlKS5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgd2lkZ2V0KSB7CiAgICAgICAgICAgIHRoaXMubW92ZV93aWRnZXRfdXAoICQod2lkZ2V0KSwgc2l6ZV95ICk7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICB0aGlzLnNldF9kb21fZ3JpZF9oZWlnaHQoKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogR2V0IHRoZSBtb3N0IGxlZnQgY29sdW1uIGJlbG93IHRvIGFkZCBhIG5ldyB3aWRnZXQuCiAgICAqCiAgICAqIEBtZXRob2QgbmV4dF9wb3NpdGlvbgogICAgKiBAcGFyYW0ge051bWJlcn0gc2l6ZV94IFRoZSBuwrogb2Ygcm93cyB0aGUgd2lkZ2V0IG9jY3VwaWVzIGhvcml6b250YWxseS4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHNpemVfeSBUaGUgbsK6IG9mIGNvbHVtbnMgdGhlIHdpZGdldCBvY2N1cGllcyB2ZXJ0aWNhbGx5LgogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgYSBncmlkIGNvb3JkcyBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBmdXR1cmUKICAgICogIHdpZGdldCBjb29yZHMuCiAgICAqLwogICAgZm4ubmV4dF9wb3NpdGlvbiA9IGZ1bmN0aW9uKHNpemVfeCwgc2l6ZV95KSB7CiAgICAgICAgc2l6ZV94IHx8IChzaXplX3ggPSAxKTsKICAgICAgICBzaXplX3kgfHwgKHNpemVfeSA9IDEpOwogICAgICAgIHZhciBnYSA9IHRoaXMuZ3JpZG1hcDsKICAgICAgICB2YXIgY29sc19sID0gZ2EubGVuZ3RoOwogICAgICAgIHZhciB2YWxpZF9wb3MgPSBbXTsKICAgICAgICB2YXIgcm93c19sOwoKICAgICAgICBmb3IgKHZhciBjID0gMTsgYyA8IGNvbHNfbDsgYysrKSB7CiAgICAgICAgICAgIHJvd3NfbCA9IGdhW2NdLmxlbmd0aDsKICAgICAgICAgICAgZm9yICh2YXIgciA9IDE7IHIgPD0gcm93c19sOyByKyspIHsKICAgICAgICAgICAgICAgIHZhciBjYW5fbW92ZV90byA9IHRoaXMuY2FuX21vdmVfdG8oewogICAgICAgICAgICAgICAgICAgIHNpemVfeDogc2l6ZV94LAogICAgICAgICAgICAgICAgICAgIHNpemVfeTogc2l6ZV95CiAgICAgICAgICAgICAgICB9LCBjLCByKTsKCiAgICAgICAgICAgICAgICBpZiAoY2FuX21vdmVfdG8pIHsKICAgICAgICAgICAgICAgICAgICB2YWxpZF9wb3MucHVzaCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogYywKICAgICAgICAgICAgICAgICAgICAgICAgcm93OiByLAogICAgICAgICAgICAgICAgICAgICAgICBzaXplX3k6IHNpemVfeSwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZV94OiBzaXplX3gKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHZhbGlkX3Bvcy5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIEdyaWRzdGVyLnNvcnRfYnlfcm93X2FuZF9jb2xfYXNjKHZhbGlkX3BvcylbMF07CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgoKICAgIC8qKgogICAgKiBSZW1vdmUgYSB3aWRnZXQgZnJvbSB0aGUgZ3JpZC4KICAgICoKICAgICogQG1ldGhvZCByZW1vdmVfd2lkZ2V0CiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IGVsIFRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudCB5b3Ugd2FudCB0byByZW1vdmUuCiAgICAqIEBwYXJhbSB7Qm9vbGVhbnxGdW5jdGlvbn0gc2lsZW50IElmIHRydWUsIHdpZGdldHMgYmVsb3cgdGhlIHJlbW92ZWQgb25lCiAgICAqIHdpbGwgbm90IG1vdmUgdXAuIElmIGEgRnVuY3Rpb24gaXMgcGFzc2VkIGl0IHdpbGwgYmUgdXNlZCBhcyBjYWxsYmFjay4KICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgRnVuY3Rpb24gZXhlY3V0ZWQgd2hlbiB0aGUgd2lkZ2V0IGlzIHJlbW92ZWQuCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4ucmVtb3ZlX3dpZGdldCA9IGZ1bmN0aW9uKGVsLCBzaWxlbnQsIGNhbGxiYWNrKSB7CiAgICAgICAgdmFyICRlbCA9IGVsIGluc3RhbmNlb2YgJCA/IGVsIDogJChlbCk7CiAgICAgICAgdmFyIHdnZCA9ICRlbC5jb29yZHMoKS5ncmlkOwoKICAgICAgICAvLyBpZiBzaWxlbnQgaXMgYSBmdW5jdGlvbiBhc3N1bWUgaXQncyBhIGNhbGxiYWNrCiAgICAgICAgaWYgKCQuaXNGdW5jdGlvbihzaWxlbnQpKSB7CiAgICAgICAgICAgIGNhbGxiYWNrID0gc2lsZW50OwogICAgICAgICAgICBzaWxlbnQgPSBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxhY2Vob2xkZXIgPSB7fTsKICAgICAgICB0aGlzLiR3aWRnZXRzID0gdGhpcy4kd2lkZ2V0cy5ub3QoJGVsKTsKCiAgICAgICAgdmFyICRuZXh0cyA9IHRoaXMud2lkZ2V0c19iZWxvdygkZWwpOwoKICAgICAgICB0aGlzLnJlbW92ZV9mcm9tX2dyaWRtYXAod2dkKTsKCiAgICAgICAgJGVsLmZhZGVPdXQoJC5wcm94eShmdW5jdGlvbigpIHsKICAgICAgICAgICAgJGVsLnJlbW92ZSgpOwoKICAgICAgICAgICAgaWYgKCFzaWxlbnQpIHsKICAgICAgICAgICAgICAgICRuZXh0cy5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgd2lkZ2V0KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlX3dpZGdldF91cCggJCh3aWRnZXQpLCB3Z2Quc2l6ZV95ICk7CiAgICAgICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX2hlaWdodCgpOwoKICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIGVsKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogUmVtb3ZlIGFsbCB3aWRnZXRzIGZyb20gdGhlIGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2QgcmVtb3ZlX2FsbF93aWRnZXRzCiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIEZ1bmN0aW9uIGV4ZWN1dGVkIGZvciBlYWNoIHdpZGdldCByZW1vdmVkLgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnJlbW92ZV9hbGxfd2lkZ2V0cyA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7CiAgICAgICAgdGhpcy4kd2lkZ2V0cy5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgZWwpewogICAgICAgICAgICAgIHRoaXMucmVtb3ZlX3dpZGdldChlbCwgdHJ1ZSwgY2FsbGJhY2spOwogICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogUmV0dXJucyBhIHNlcmlhbGl6ZWQgYXJyYXkgb2YgdGhlIHdpZGdldHMgaW4gdGhlIGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2Qgc2VyaWFsaXplCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9IFskd2lkZ2V0c10gVGhlIGNvbGxlY3Rpb24gb2YgalF1ZXJ5IHdyYXBwZWQKICAgICogIEhUTUxFbGVtZW50cyB5b3Ugd2FudCB0byBzZXJpYWxpemUuIElmIG5vIGFyZ3VtZW50IGlzIHBhc3NlZCBhbGwgd2lkZ2V0cwogICAgKiAgd2lsbCBiZSBzZXJpYWxpemVkLgogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyBhbiBBcnJheSBvZiBPYmplY3RzIHdpdGggdGhlIGRhdGEgc3BlY2lmaWVkIGluCiAgICAqICB0aGUgc2VyaWFsaXplX3BhcmFtcyBvcHRpb24uCiAgICAqLwogICAgZm4uc2VyaWFsaXplID0gZnVuY3Rpb24oJHdpZGdldHMpIHsKICAgICAgICAkd2lkZ2V0cyB8fCAoJHdpZGdldHMgPSB0aGlzLiR3aWRnZXRzKTsKCiAgICAgICAgcmV0dXJuICR3aWRnZXRzLm1hcCgkLnByb3h5KGZ1bmN0aW9uKGksIHdpZGdldCkgewogICAgICAgICAgICB2YXIgJHcgPSAkKHdpZGdldCk7CiAgICAgICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuc2VyaWFsaXplX3BhcmFtcygkdywgJHcuY29vcmRzKCkuZ3JpZCk7CiAgICAgICAgfSwgdGhpcykpLmdldCgpOwogICAgfTsKCgogICAgLyoqCiAgICAqIFJldHVybnMgYSBzZXJpYWxpemVkIGFycmF5IG9mIHRoZSB3aWRnZXRzIHRoYXQgaGF2ZSBjaGFuZ2VkIHRoZWlyCiAgICAqICBwb3NpdGlvbi4KICAgICoKICAgICogQG1ldGhvZCBzZXJpYWxpemVfY2hhbmdlZAogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyBhbiBBcnJheSBvZiBPYmplY3RzIHdpdGggdGhlIGRhdGEgc3BlY2lmaWVkIGluCiAgICAqICB0aGUgc2VyaWFsaXplX3BhcmFtcyBvcHRpb24uCiAgICAqLwogICAgZm4uc2VyaWFsaXplX2NoYW5nZWQgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdGhpcy5zZXJpYWxpemUodGhpcy4kY2hhbmdlZCk7CiAgICB9OwoKCiAgICAvKioKICAgICogQ29udmVydCB3aWRnZXRzIGZyb20gRE9NIGVsZW1lbnRzIHRvICJ3aWRnZXQgZ3JpZCBkYXRhIiBPYmplY3RzLgogICAgKgogICAgKiBAbWV0aG9kIGRvbV90b19jb29yZHMKICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gJHdpZGdldCBUaGUgd2lkZ2V0IHRvIGJlIGNvbnZlcnRlZC4KICAgICovCiAgICBmbi5kb21fdG9fY29vcmRzID0gZnVuY3Rpb24oJHdpZGdldCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICdjb2wnOiBwYXJzZUludCgkd2lkZ2V0LmF0dHIoJ2RhdGEtY29sJyksIDEwKSwKICAgICAgICAgICAgJ3Jvdyc6IHBhcnNlSW50KCR3aWRnZXQuYXR0cignZGF0YS1yb3cnKSwgMTApLAogICAgICAgICAgICAnc2l6ZV94JzogcGFyc2VJbnQoJHdpZGdldC5hdHRyKCdkYXRhLXNpemV4JyksIDEwKSB8fCAxLAogICAgICAgICAgICAnc2l6ZV95JzogcGFyc2VJbnQoJHdpZGdldC5hdHRyKCdkYXRhLXNpemV5JyksIDEwKSB8fCAxLAogICAgICAgICAgICAnbWF4X3NpemVfeCc6IHBhcnNlSW50KCR3aWRnZXQuYXR0cignZGF0YS1tYXgtc2l6ZXgnKSwgMTApIHx8IGZhbHNlLAogICAgICAgICAgICAnbWF4X3NpemVfeSc6IHBhcnNlSW50KCR3aWRnZXQuYXR0cignZGF0YS1tYXgtc2l6ZXknKSwgMTApIHx8IGZhbHNlLAogICAgICAgICAgICAnbWluX3NpemVfeCc6IHBhcnNlSW50KCR3aWRnZXQuYXR0cignZGF0YS1taW4tc2l6ZXgnKSwgMTApIHx8IGZhbHNlLAogICAgICAgICAgICAnbWluX3NpemVfeSc6IHBhcnNlSW50KCR3aWRnZXQuYXR0cignZGF0YS1taW4tc2l6ZXknKSwgMTApIHx8IGZhbHNlLAogICAgICAgICAgICAnZWwnOiAkd2lkZ2V0CiAgICAgICAgfTsKICAgIH07CgoKICAgIC8qKgogICAgKiBDcmVhdGVzIHRoZSBncmlkIGNvb3JkcyBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSB3aWRnZXQgYW4gYWRkIGl0IHRvIHRoZQogICAgKiBtYXBwZWQgYXJyYXkgb2YgcG9zaXRpb25zLgogICAgKgogICAgKiBAbWV0aG9kIHJlZ2lzdGVyX3dpZGdldAogICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fE9iamVjdH0gJGVsIGpRdWVyeSB3cmFwcGVkIEhUTUxFbGVtZW50IHJlcHJlc2VudGluZwogICAgKiAgdGhlIHdpZGdldCwgb3IgYW4gIndpZGdldCBncmlkIGRhdGEiIE9iamVjdCB3aXRoIChjb2wsIHJvdywgZWwgLi4uKS4KICAgICogQHJldHVybiB7Qm9vbGVhbn0gUmV0dXJucyB0cnVlIGlmIHRoZSB3aWRnZXQgZmluYWwgcG9zaXRpb24gaXMgZGlmZmVyZW50CiAgICAqICB0aGFuIHRoZSBvcmlnaW5hbC4KICAgICovCiAgICBmbi5yZWdpc3Rlcl93aWRnZXQgPSBmdW5jdGlvbigkZWwpIHsKICAgICAgICB2YXIgaXNET00gPSAkZWwgaW5zdGFuY2VvZiBqUXVlcnk7CiAgICAgICAgdmFyIHdnZCA9IGlzRE9NID8gdGhpcy5kb21fdG9fY29vcmRzKCRlbCkgOiAkZWw7CiAgICAgICAgdmFyIHBvc0NoYW5nZWQgPSBmYWxzZTsKICAgICAgICBpc0RPTSB8fCAoJGVsID0gd2dkLmVsKTsKCiAgICAgICAgdmFyIGVtcHR5X3VwcGVyX3JvdyA9IHRoaXMuY2FuX2dvX3dpZGdldF91cCh3Z2QpOwogICAgICAgIGlmIChlbXB0eV91cHBlcl9yb3cpIHsKICAgICAgICAgICAgd2dkLnJvdyA9IGVtcHR5X3VwcGVyX3JvdzsKICAgICAgICAgICAgJGVsLmF0dHIoJ2RhdGEtcm93JywgZW1wdHlfdXBwZXJfcm93KTsKICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcignZ3JpZHN0ZXI6cG9zaXRpb25jaGFuZ2VkJywgW3dnZF0pOwogICAgICAgICAgICBwb3NDaGFuZ2VkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXZvaWRfb3ZlcmxhcHBlZF93aWRnZXRzICYmCiAgICAgICAgICAgICF0aGlzLmNhbl9tb3ZlX3RvKAogICAgICAgICAgICAge3NpemVfeDogd2dkLnNpemVfeCwgc2l6ZV95OiB3Z2Quc2l6ZV95fSwgd2dkLmNvbCwgd2dkLnJvdykKICAgICAgICApIHsKICAgICAgICAgICAgJC5leHRlbmQod2dkLCB0aGlzLm5leHRfcG9zaXRpb24od2dkLnNpemVfeCwgd2dkLnNpemVfeSkpOwogICAgICAgICAgICAkZWwuYXR0cih7CiAgICAgICAgICAgICAgICAnZGF0YS1jb2wnOiB3Z2QuY29sLAogICAgICAgICAgICAgICAgJ2RhdGEtcm93Jzogd2dkLnJvdywKICAgICAgICAgICAgICAgICdkYXRhLXNpemV4Jzogd2dkLnNpemVfeCwKICAgICAgICAgICAgICAgICdkYXRhLXNpemV5Jzogd2dkLnNpemVfeQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcG9zQ2hhbmdlZCA9IHRydWU7CiAgICAgICAgfQoKICAgICAgICAvLyBhdHRhY2ggQ29vcmQgb2JqZWN0IHRvIHBsYXllciBkYXRhLWNvb3JkIGF0dHJpYnV0ZQogICAgICAgICRlbC5kYXRhKCdjb29yZHMnLCAkZWwuY29vcmRzKCkpOwogICAgICAgIC8vIEV4dGVuZCBDb29yZCBvYmplY3Qgd2l0aCBncmlkIHBvc2l0aW9uIGluZm8KICAgICAgICAkZWwuZGF0YSgnY29vcmRzJykuZ3JpZCA9IHdnZDsKCiAgICAgICAgdGhpcy5hZGRfdG9fZ3JpZG1hcCh3Z2QsICRlbCk7CgogICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUuZW5hYmxlZCAmJiB0aGlzLmFkZF9yZXNpemVfaGFuZGxlKCRlbCk7CgogICAgICAgIHJldHVybiBwb3NDaGFuZ2VkOwogICAgfTsKCgogICAgLyoqCiAgICAqIFVwZGF0ZSBpbiB0aGUgbWFwcGVkIGFycmF5IG9mIHBvc2l0aW9ucyB0aGUgdmFsdWUgb2YgY2VsbHMgcmVwcmVzZW50ZWQgYnkKICAgICogdGhlIGdyaWQgY29vcmRzIG9iamVjdCBwYXNzZWQgaW4gdGhlIGBncmlkX2RhdGFgIHBhcmFtLgogICAgKgogICAgKiBAcGFyYW0ge09iamVjdH0gZ3JpZF9kYXRhIFRoZSBncmlkIGNvb3JkcyBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjZWxscwogICAgKiAgdG8gdXBkYXRlIGluIHRoZSBtYXBwZWQgYXJyYXkuCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8Qm9vbGVhbn0gdmFsdWUgUGFzcyBgZmFsc2VgIG9yIHRoZSBqUXVlcnkgd3JhcHBlZAogICAgKiAgSFRNTEVsZW1lbnQsIGRlcGVuZHMgaWYgeW91IHdhbnQgdG8gZGVsZXRlIGFuIGV4aXN0aW5nIHBvc2l0aW9uIG9yIGFkZAogICAgKiAgYSBuZXcgb25lLgogICAgKiBAbWV0aG9kIHVwZGF0ZV93aWRnZXRfcG9zaXRpb24KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi51cGRhdGVfd2lkZ2V0X3Bvc2l0aW9uID0gZnVuY3Rpb24oZ3JpZF9kYXRhLCB2YWx1ZSkgewogICAgICAgIHRoaXMuZm9yX2VhY2hfY2VsbF9vY2N1cGllZChncmlkX2RhdGEsIGZ1bmN0aW9uKGNvbCwgcm93KSB7CiAgICAgICAgICAgIGlmICghdGhpcy5ncmlkbWFwW2NvbF0pIHsgcmV0dXJuIHRoaXM7IH0KICAgICAgICAgICAgdGhpcy5ncmlkbWFwW2NvbF1bcm93XSA9IHZhbHVlOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIFJlbW92ZSBhIHdpZGdldCBmcm9tIHRoZSBtYXBwZWQgYXJyYXkgb2YgcG9zaXRpb25zLgogICAgKgogICAgKiBAbWV0aG9kIHJlbW92ZV9mcm9tX2dyaWRtYXAKICAgICogQHBhcmFtIHtPYmplY3R9IGdyaWRfZGF0YSBUaGUgZ3JpZCBjb29yZHMgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY2VsbHMKICAgICogIHRvIHVwZGF0ZSBpbiB0aGUgbWFwcGVkIGFycmF5LgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnJlbW92ZV9mcm9tX2dyaWRtYXAgPSBmdW5jdGlvbihncmlkX2RhdGEpIHsKICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVfd2lkZ2V0X3Bvc2l0aW9uKGdyaWRfZGF0YSwgZmFsc2UpOwogICAgfTsKCgogICAgLyoqCiAgICAqIEFkZCBhIHdpZGdldCB0byB0aGUgbWFwcGVkIGFycmF5IG9mIHBvc2l0aW9ucy4KICAgICoKICAgICogQG1ldGhvZCBhZGRfdG9fZ3JpZG1hcAogICAgKiBAcGFyYW0ge09iamVjdH0gZ3JpZF9kYXRhIFRoZSBncmlkIGNvb3JkcyBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBjZWxscwogICAgKiAgdG8gdXBkYXRlIGluIHRoZSBtYXBwZWQgYXJyYXkuCiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR8Qm9vbGVhbn0gdmFsdWUgVGhlIHZhbHVlIHRvIHNldCBpbiB0aGUgc3BlY2lmaWVkCiAgICAqICBwb3NpdGlvbiAuCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4uYWRkX3RvX2dyaWRtYXAgPSBmdW5jdGlvbihncmlkX2RhdGEsIHZhbHVlKSB7CiAgICAgICAgdGhpcy51cGRhdGVfd2lkZ2V0X3Bvc2l0aW9uKGdyaWRfZGF0YSwgdmFsdWUgfHwgZ3JpZF9kYXRhLmVsKTsKCiAgICAgICAgaWYgKGdyaWRfZGF0YS5lbCkgewogICAgICAgICAgICB2YXIgJHdpZGdldHMgPSB0aGlzLndpZGdldHNfYmVsb3coZ3JpZF9kYXRhLmVsKTsKICAgICAgICAgICAgJHdpZGdldHMuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGksIHdpZGdldCkgewogICAgICAgICAgICAgICAgdGhpcy5tb3ZlX3dpZGdldF91cCggJCh3aWRnZXQpKTsKICAgICAgICAgICAgfSwgdGhpcykpOwogICAgICAgIH0KICAgIH07CgoKICAgIC8qKgogICAgKiBNYWtlIHdpZGdldHMgZHJhZ2dhYmxlLgogICAgKgogICAgKiBAdXNlcyBEcmFnZ2FibGUKICAgICogQG1ldGhvZCBkcmFnZ2FibGUKICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5kcmFnZ2FibGUgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgc2VsZiA9IHRoaXM7CiAgICAgICAgdmFyIGRyYWdnYWJsZV9vcHRpb25zID0gJC5leHRlbmQodHJ1ZSwge30sIHRoaXMub3B0aW9ucy5kcmFnZ2FibGUsIHsKICAgICAgICAgICAgb2Zmc2V0X2xlZnQ6IHRoaXMub3B0aW9ucy53aWRnZXRfbWFyZ2luc1swXSwKICAgICAgICAgICAgb2Zmc2V0X3RvcDogdGhpcy5vcHRpb25zLndpZGdldF9tYXJnaW5zWzFdLAogICAgICAgICAgICBjb250YWluZXJfd2lkdGg6IHRoaXMuY29scyAqIHRoaXMubWluX3dpZGdldF93aWR0aCwKICAgICAgICAgICAgbGltaXQ6IHRydWUsCiAgICAgICAgICAgIHN0YXJ0OiBmdW5jdGlvbihldmVudCwgdWkpIHsKICAgICAgICAgICAgICAgIHNlbGYuJHdpZGdldHMuZmlsdGVyKCcucGxheWVyLXJldmVydCcpCiAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdwbGF5ZXItcmV2ZXJ0Jyk7CgogICAgICAgICAgICAgICAgc2VsZi4kcGxheWVyID0gJCh0aGlzKTsKICAgICAgICAgICAgICAgIHNlbGYuJGhlbHBlciA9ICQodWkuJGhlbHBlcik7CgogICAgICAgICAgICAgICAgc2VsZi5oZWxwZXIgPSAhc2VsZi4kaGVscGVyLmlzKHNlbGYuJHBsYXllcik7CgogICAgICAgICAgICAgICAgc2VsZi5vbl9zdGFydF9kcmFnLmNhbGwoc2VsZiwgZXZlbnQsIHVpKTsKICAgICAgICAgICAgICAgIHNlbGYuJGVsLnRyaWdnZXIoJ2dyaWRzdGVyOmRyYWdzdGFydCcpOwogICAgICAgICAgICB9LAogICAgICAgICAgICBzdG9wOiBmdW5jdGlvbihldmVudCwgdWkpIHsKICAgICAgICAgICAgICAgIHNlbGYub25fc3RvcF9kcmFnLmNhbGwoc2VsZiwgZXZlbnQsIHVpKTsKICAgICAgICAgICAgICAgIHNlbGYuJGVsLnRyaWdnZXIoJ2dyaWRzdGVyOmRyYWdzdG9wJyk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGRyYWc6IHRocm90dGxlKGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAgICAgICAgICAgc2VsZi5vbl9kcmFnLmNhbGwoc2VsZiwgZXZlbnQsIHVpKTsKICAgICAgICAgICAgICAgIHNlbGYuJGVsLnRyaWdnZXIoJ2dyaWRzdGVyOmRyYWcnKTsKICAgICAgICAgICAgfSwgNjApCiAgICAgICAgICB9KTsKCiAgICAgICAgdGhpcy5kcmFnX2FwaSA9IHRoaXMuJGVsLmRyYWcoZHJhZ2dhYmxlX29wdGlvbnMpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIEJpbmQgcmVzaXplIGV2ZW50cyB0byBnZXQgcmVzaXplIHdvcmtpbmcuCiAgICAqCiAgICAqIEBtZXRob2QgcmVzaXphYmxlCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIGluc3RhbmNlIG9mIGdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnJlc2l6YWJsZSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHRoaXMucmVzaXplX2FwaSA9IHRoaXMuJGVsLmRyYWcoewogICAgICAgICAgICBpdGVtczogJy4nICsgdGhpcy5vcHRpb25zLnJlc2l6ZS5oYW5kbGVfY2xhc3MsCiAgICAgICAgICAgIG9mZnNldF9sZWZ0OiB0aGlzLm9wdGlvbnMud2lkZ2V0X21hcmdpbnNbMF0sCiAgICAgICAgICAgIGNvbnRhaW5lcl93aWR0aDogdGhpcy5jb250YWluZXJfd2lkdGgsCiAgICAgICAgICAgIG1vdmVfZWxlbWVudDogZmFsc2UsCiAgICAgICAgICAgIHJlc2l6ZTogdHJ1ZSwKICAgICAgICAgICAgbGltaXQ6IHRoaXMub3B0aW9ucy5hdXRvZ3Jvd19jb2xzID8gZmFsc2UgOiB0cnVlLAogICAgICAgICAgICBzdGFydDogJC5wcm94eSh0aGlzLm9uX3N0YXJ0X3Jlc2l6ZSwgdGhpcyksCiAgICAgICAgICAgIHN0b3A6ICQucHJveHkoZnVuY3Rpb24oZXZlbnQsIHVpKSB7CiAgICAgICAgICAgICAgICBkZWxheSgkLnByb3h5KGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMub25fc3RvcF9yZXNpemUoZXZlbnQsIHVpKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpLCAxMjApOwogICAgICAgICAgICB9LCB0aGlzKSwKICAgICAgICAgICAgZHJhZzogdGhyb3R0bGUoJC5wcm94eSh0aGlzLm9uX3Jlc2l6ZSwgdGhpcyksIDYwKQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBTZXR1cCB0aGluZ3MgcmVxdWlyZWQgZm9yIHJlc2l6aW5nLiBMaWtlIGJ1aWxkIHRlbXBsYXRlcyBmb3IgZHJhZyBoYW5kbGVzLgogICAgKgogICAgKiBAbWV0aG9kIHNldHVwX3Jlc2l6ZQogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyBpbnN0YW5jZSBvZiBncmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5zZXR1cF9yZXNpemUgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnJlc2l6ZV9oYW5kbGVfY2xhc3MgPSB0aGlzLm9wdGlvbnMucmVzaXplLmhhbmRsZV9jbGFzczsKICAgICAgICB2YXIgYXhlcyA9IHRoaXMub3B0aW9ucy5yZXNpemUuYXhlczsKICAgICAgICB2YXIgaGFuZGxlX3RwbCA9ICc8c3BhbiBjbGFzcz0iJyArIHRoaXMucmVzaXplX2hhbmRsZV9jbGFzcyArICcgJyArCiAgICAgICAgICAgIHRoaXMucmVzaXplX2hhbmRsZV9jbGFzcyArICcte3R5cGV9IiAvPic7CgogICAgICAgIHRoaXMucmVzaXplX2hhbmRsZV90cGwgPSAkLm1hcChheGVzLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICAgIHJldHVybiBoYW5kbGVfdHBsLnJlcGxhY2UoJ3t0eXBlfScsIHR5cGUpOwogICAgICAgIH0pLmpvaW4oJycpOwoKICAgICAgICBpZiAoJC5pc0FycmF5KHRoaXMub3B0aW9ucy5kcmFnZ2FibGUuaWdub3JlX2RyYWdnaW5nKSkgewogICAgICAgICAgICB0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlLmlnbm9yZV9kcmFnZ2luZy5wdXNoKAogICAgICAgICAgICAgICAgJy4nICsgdGhpcy5yZXNpemVfaGFuZGxlX2NsYXNzKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgd2hlbiB0aGUgcGxheWVyIGJlZ2lucyB0byBiZSBkcmFnZ2VkLgogICAgKgogICAgKiBAbWV0aG9kIG9uX3N0YXJ0X2RyYWcKICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIG9yaWdpbmFsIGJyb3dzZXIgZXZlbnQKICAgICogQHBhcmFtIHtPYmplY3R9IHVpIEEgcHJlcGFyZWQgdWkgb2JqZWN0IHdpdGggdXNlZnVsIGRyYWctcmVsYXRlZCBkYXRhCiAgICAqLwogICAgZm4ub25fc3RhcnRfZHJhZyA9IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAgIHRoaXMuJGhlbHBlci5hZGQodGhpcy4kcGxheWVyKS5hZGQodGhpcy4kd3JhcHBlcikuYWRkQ2xhc3MoJ2RyYWdnaW5nJyk7CgogICAgICAgIHRoaXMuaGlnaGVzdF9jb2wgPSB0aGlzLmdldF9oaWdoZXN0X29jY3VwaWVkX2NlbGwoKS5jb2w7CgogICAgICAgIHRoaXMuJHBsYXllci5hZGRDbGFzcygncGxheWVyJyk7CiAgICAgICAgdGhpcy5wbGF5ZXJfZ3JpZF9kYXRhID0gdGhpcy4kcGxheWVyLmNvb3JkcygpLmdyaWQ7CiAgICAgICAgdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEgPSAkLmV4dGVuZCh7fSwgdGhpcy5wbGF5ZXJfZ3JpZF9kYXRhKTsKCiAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfaGVpZ2h0KHRoaXMuJGVsLmhlaWdodCgpICsKICAgICAgICAgICAgKHRoaXMucGxheWVyX2dyaWRfZGF0YS5zaXplX3kgKiB0aGlzLm1pbl93aWRnZXRfaGVpZ2h0KSk7CgogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX3dpZHRoKHRoaXMuY29scyk7CgogICAgICAgIHZhciBwZ2Rfc2l6ZXggPSB0aGlzLnBsYXllcl9ncmlkX2RhdGEuc2l6ZV94OwogICAgICAgIHZhciBjb2xzX2RpZmYgPSB0aGlzLmNvbHMgLSB0aGlzLmhpZ2hlc3RfY29sOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9ncm93X2NvbHMgJiYgY29sc19kaWZmIDw9IHBnZF9zaXpleCkgewogICAgICAgICAgICB0aGlzLmFkZF9mYXV4X2NvbHMoTWF0aC5taW4ocGdkX3NpemV4IC0gY29sc19kaWZmLCAxKSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgY29sbGlkZXJzID0gdGhpcy5mYXV4X2dyaWQ7CiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMuJHBsYXllci5kYXRhKCdjb29yZHMnKS5jb29yZHM7CgogICAgICAgIHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyID0gdGhpcy5nZXRfY2VsbHNfb2NjdXBpZWQoCiAgICAgICAgICAgIHRoaXMucGxheWVyX2dyaWRfZGF0YSk7CiAgICAgICAgdGhpcy5jZWxsc19vY2N1cGllZF9ieV9wbGFjZWhvbGRlciA9IHRoaXMuZ2V0X2NlbGxzX29jY3VwaWVkKAogICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YSk7CgogICAgICAgIHRoaXMubGFzdF9jb2xzID0gW107CiAgICAgICAgdGhpcy5sYXN0X3Jvd3MgPSBbXTsKCiAgICAgICAgLy8gc2VlIGpxdWVyeS5jb2xsaXNpb24uanMKICAgICAgICB0aGlzLmNvbGxpc2lvbl9hcGkgPSB0aGlzLiRoZWxwZXIuY29sbGlzaW9uKAogICAgICAgICAgICBjb2xsaWRlcnMsIHRoaXMub3B0aW9ucy5jb2xsaXNpb24pOwoKICAgICAgICB0aGlzLiRwcmV2aWV3X2hvbGRlciA9ICQoJzwnICsgdGhpcy4kcGxheWVyLmdldCgwKS50YWdOYW1lICsgJyAvPicsIHsKICAgICAgICAgICAgICAnY2xhc3MnOiAncHJldmlldy1ob2xkZXInLAogICAgICAgICAgICAgICdkYXRhLXJvdyc6IHRoaXMuJHBsYXllci5hdHRyKCdkYXRhLXJvdycpLAogICAgICAgICAgICAgICdkYXRhLWNvbCc6IHRoaXMuJHBsYXllci5hdHRyKCdkYXRhLWNvbCcpLAogICAgICAgICAgICAgIGNzczogewogICAgICAgICAgICAgICAgICB3aWR0aDogY29vcmRzLndpZHRoLAogICAgICAgICAgICAgICAgICBoZWlnaHQ6IGNvb3Jkcy5oZWlnaHQKICAgICAgICAgICAgICB9CiAgICAgICAgfSkuYXBwZW5kVG8odGhpcy4kZWwpOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmRyYWdnYWJsZS5zdGFydCkgewogICAgICAgICAgdGhpcy5vcHRpb25zLmRyYWdnYWJsZS5zdGFydC5jYWxsKHRoaXMsIGV2ZW50LCB1aSk7CiAgICAgICAgfQogICAgfTsKCgogICAgLyoqCiAgICAqIFRoaXMgZnVuY3Rpb24gaXMgZXhlY3V0ZWQgd2hlbiB0aGUgcGxheWVyIGlzIGJlaW5nIGRyYWdnZWQuCiAgICAqCiAgICAqIEBtZXRob2Qgb25fZHJhZwogICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBUaGUgb3JpZ2luYWwgYnJvd3NlciBldmVudAogICAgKiBAcGFyYW0ge09iamVjdH0gdWkgQSBwcmVwYXJlZCB1aSBvYmplY3Qgd2l0aCB1c2VmdWwgZHJhZy1yZWxhdGVkIGRhdGEKICAgICovCiAgICBmbi5vbl9kcmFnID0gZnVuY3Rpb24oZXZlbnQsIHVpKSB7CiAgICAgICAgLy9icmVhayBpZiBkcmFnc3RvcCBoYXMgYmVlbiBmaXJlZAogICAgICAgIGlmICh0aGlzLiRwbGF5ZXIgPT09IG51bGwpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgdmFyIGFic19vZmZzZXQgPSB7CiAgICAgICAgICAgIGxlZnQ6IHVpLnBvc2l0aW9uLmxlZnQgKyB0aGlzLmJhc2VYLAogICAgICAgICAgICB0b3A6IHVpLnBvc2l0aW9uLnRvcCArIHRoaXMuYmFzZVkKICAgICAgICB9OwoKICAgICAgICAvLyBhdXRvIGdyb3cgY29scwogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b2dyb3dfY29scykgewogICAgICAgICAgICB2YXIgcHJjb2wgPSB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2wgKwogICAgICAgICAgICAgICAgdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEuc2l6ZV94IC0gMTsKCiAgICAgICAgICAgIC8vICItIDEiIGR1ZSB0byBhZGRpbmcgYXQgbGVhc3QgMSBjb2x1bW4gaW4gb25fc3RhcnRfZHJhZwogICAgICAgICAgICBpZiAocHJjb2wgPj0gdGhpcy5jb2xzIC0gMSAmJiB0aGlzLm9wdGlvbnMubWF4X2NvbHMgPj0gdGhpcy5jb2xzICsgMSkgewogICAgICAgICAgICAgICAgdGhpcy5hZGRfZmF1eF9jb2xzKDEpOwogICAgICAgICAgICAgICAgdGhpcy5zZXRfZG9tX2dyaWRfd2lkdGgodGhpcy5jb2xzICsgMSk7CiAgICAgICAgICAgICAgICB0aGlzLmRyYWdfYXBpLnNldF9saW1pdHModGhpcy5jb250YWluZXJfd2lkdGgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLmNvbGxpc2lvbl9hcGkuc2V0X2NvbGxpZGVycyh0aGlzLmZhdXhfZ3JpZCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmNvbGxpZGVyc19kYXRhID0gdGhpcy5jb2xsaXNpb25fYXBpLmdldF9jbG9zZXN0X2NvbGxpZGVycygKICAgICAgICAgICAgYWJzX29mZnNldCk7CgogICAgICAgIHRoaXMub25fb3ZlcmxhcHBlZF9jb2x1bW5fY2hhbmdlKAogICAgICAgICAgICB0aGlzLm9uX3N0YXJ0X292ZXJsYXBwaW5nX2NvbHVtbiwgdGhpcy5vbl9zdG9wX292ZXJsYXBwaW5nX2NvbHVtbik7CgogICAgICAgIHRoaXMub25fb3ZlcmxhcHBlZF9yb3dfY2hhbmdlKAogICAgICAgICAgICB0aGlzLm9uX3N0YXJ0X292ZXJsYXBwaW5nX3JvdywgdGhpcy5vbl9zdG9wX292ZXJsYXBwaW5nX3Jvdyk7CgoKICAgICAgICBpZiAodGhpcy5oZWxwZXIgJiYgdGhpcy4kcGxheWVyKSB7CiAgICAgICAgICAgIHRoaXMuJHBsYXllci5jc3MoewogICAgICAgICAgICAgICAgJ2xlZnQnOiB1aS5wb3NpdGlvbi5sZWZ0LAogICAgICAgICAgICAgICAgJ3RvcCc6IHVpLnBvc2l0aW9uLnRvcAogICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlLmRyYWcpIHsKICAgICAgICAgICAgdGhpcy5vcHRpb25zLmRyYWdnYWJsZS5kcmFnLmNhbGwodGhpcywgZXZlbnQsIHVpKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB3aGVuIHRoZSBwbGF5ZXIgc3RvcHMgYmVpbmcgZHJhZ2dlZC4KICAgICoKICAgICogQG1ldGhvZCBvbl9zdG9wX2RyYWcKICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIG9yaWdpbmFsIGJyb3dzZXIgZXZlbnQKICAgICogQHBhcmFtIHtPYmplY3R9IHVpIEEgcHJlcGFyZWQgdWkgb2JqZWN0IHdpdGggdXNlZnVsIGRyYWctcmVsYXRlZCBkYXRhCiAgICAqLwogICAgZm4ub25fc3RvcF9kcmFnID0gZnVuY3Rpb24oZXZlbnQsIHVpKSB7CiAgICAgICAgdGhpcy4kaGVscGVyLmFkZCh0aGlzLiRwbGF5ZXIpLmFkZCh0aGlzLiR3cmFwcGVyKQogICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ2RyYWdnaW5nJyk7CgogICAgICAgIHVpLnBvc2l0aW9uLmxlZnQgPSB1aS5wb3NpdGlvbi5sZWZ0ICsgdGhpcy5iYXNlWDsKICAgICAgICB1aS5wb3NpdGlvbi50b3AgPSB1aS5wb3NpdGlvbi50b3AgKyB0aGlzLmJhc2VZOwogICAgICAgIHRoaXMuY29sbGlkZXJzX2RhdGEgPSB0aGlzLmNvbGxpc2lvbl9hcGkuZ2V0X2Nsb3Nlc3RfY29sbGlkZXJzKAogICAgICAgICAgICB1aS5wb3NpdGlvbik7CgogICAgICAgIHRoaXMub25fb3ZlcmxhcHBlZF9jb2x1bW5fY2hhbmdlKAogICAgICAgICAgICB0aGlzLm9uX3N0YXJ0X292ZXJsYXBwaW5nX2NvbHVtbiwKICAgICAgICAgICAgdGhpcy5vbl9zdG9wX292ZXJsYXBwaW5nX2NvbHVtbgogICAgICAgICk7CgogICAgICAgIHRoaXMub25fb3ZlcmxhcHBlZF9yb3dfY2hhbmdlKAogICAgICAgICAgICB0aGlzLm9uX3N0YXJ0X292ZXJsYXBwaW5nX3JvdywKICAgICAgICAgICAgdGhpcy5vbl9zdG9wX292ZXJsYXBwaW5nX3JvdwogICAgICAgICk7CgogICAgICAgIHRoaXMuJHBsYXllci5hZGRDbGFzcygncGxheWVyLXJldmVydCcpLnJlbW92ZUNsYXNzKCdwbGF5ZXInKQogICAgICAgICAgICAuYXR0cih7CiAgICAgICAgICAgICAgICAnZGF0YS1jb2wnOiB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2wsCiAgICAgICAgICAgICAgICAnZGF0YS1yb3cnOiB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5yb3cKICAgICAgICAgICAgfSkuY3NzKHsKICAgICAgICAgICAgICAgICdsZWZ0JzogJycsCiAgICAgICAgICAgICAgICAndG9wJzogJycKICAgICAgICAgICAgfSk7CgogICAgICAgIHRoaXMuJGNoYW5nZWQgPSB0aGlzLiRjaGFuZ2VkLmFkZCh0aGlzLiRwbGF5ZXIpOwoKICAgICAgICB0aGlzLmNlbGxzX29jY3VwaWVkX2J5X3BsYXllciA9IHRoaXMuZ2V0X2NlbGxzX29jY3VwaWVkKAogICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YSk7CiAgICAgICAgdGhpcy5zZXRfY2VsbHNfcGxheWVyX29jY3VwaWVzKAogICAgICAgICAgICB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2wsIHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhLnJvdyk7CgogICAgICAgIHRoaXMuJHBsYXllci5jb29yZHMoKS5ncmlkLnJvdyA9IHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhLnJvdzsKICAgICAgICB0aGlzLiRwbGF5ZXIuY29vcmRzKCkuZ3JpZC5jb2wgPSB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2w7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZHJhZ2dhYmxlLnN0b3ApIHsKICAgICAgICAgIHRoaXMub3B0aW9ucy5kcmFnZ2FibGUuc3RvcC5jYWxsKHRoaXMsIGV2ZW50LCB1aSk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRwcmV2aWV3X2hvbGRlci5yZW1vdmUoKTsKCiAgICAgICAgdGhpcy4kcGxheWVyID0gbnVsbDsKICAgICAgICB0aGlzLiRoZWxwZXIgPSBudWxsOwogICAgICAgIHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhID0ge307CiAgICAgICAgdGhpcy5wbGF5ZXJfZ3JpZF9kYXRhID0ge307CiAgICAgICAgdGhpcy5jZWxsc19vY2N1cGllZF9ieV9wbGFjZWhvbGRlciA9IHt9OwogICAgICAgIHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyID0ge307CgogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX2hlaWdodCgpOwogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX3dpZHRoKCk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b2dyb3dfY29scykgewogICAgICAgICAgICB0aGlzLmRyYWdfYXBpLnNldF9saW1pdHModGhpcy5jb2xzICogdGhpcy5taW5fd2lkZ2V0X3dpZHRoKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCBldmVyeSB0aW1lIGEgd2lkZ2V0IHN0YXJ0cyB0byBiZSByZXNpemVkLgogICAgKgogICAgKiBAbWV0aG9kIG9uX3N0YXJ0X3Jlc2l6ZQogICAgKiBAcGFyYW0ge0V2ZW50fSBldmVudCBUaGUgb3JpZ2luYWwgYnJvd3NlciBldmVudAogICAgKiBAcGFyYW0ge09iamVjdH0gdWkgQSBwcmVwYXJlZCB1aSBvYmplY3Qgd2l0aCB1c2VmdWwgZHJhZy1yZWxhdGVkIGRhdGEKICAgICovCiAgICBmbi5vbl9zdGFydF9yZXNpemUgPSBmdW5jdGlvbihldmVudCwgdWkpIHsKICAgICAgICB0aGlzLiRyZXNpemVkX3dpZGdldCA9IHVpLiRwbGF5ZXIuY2xvc2VzdCgnLmdzLXcnKTsKICAgICAgICB0aGlzLnJlc2l6ZV9jb29yZHMgPSB0aGlzLiRyZXNpemVkX3dpZGdldC5jb29yZHMoKTsKICAgICAgICB0aGlzLnJlc2l6ZV93Z2QgPSB0aGlzLnJlc2l6ZV9jb29yZHMuZ3JpZDsKICAgICAgICB0aGlzLnJlc2l6ZV9pbml0aWFsX3dpZHRoID0gdGhpcy5yZXNpemVfY29vcmRzLmNvb3Jkcy53aWR0aDsKICAgICAgICB0aGlzLnJlc2l6ZV9pbml0aWFsX2hlaWdodCA9IHRoaXMucmVzaXplX2Nvb3Jkcy5jb29yZHMuaGVpZ2h0OwogICAgICAgIHRoaXMucmVzaXplX2luaXRpYWxfc2l6ZXggPSB0aGlzLnJlc2l6ZV9jb29yZHMuZ3JpZC5zaXplX3g7CiAgICAgICAgdGhpcy5yZXNpemVfaW5pdGlhbF9zaXpleSA9IHRoaXMucmVzaXplX2Nvb3Jkcy5ncmlkLnNpemVfeTsKICAgICAgICB0aGlzLnJlc2l6ZV9pbml0aWFsX2NvbCA9IHRoaXMucmVzaXplX2Nvb3Jkcy5ncmlkLmNvbDsKICAgICAgICB0aGlzLnJlc2l6ZV9sYXN0X3NpemV4ID0gdGhpcy5yZXNpemVfaW5pdGlhbF9zaXpleDsKICAgICAgICB0aGlzLnJlc2l6ZV9sYXN0X3NpemV5ID0gdGhpcy5yZXNpemVfaW5pdGlhbF9zaXpleTsKCiAgICAgICAgdGhpcy5yZXNpemVfbWF4X3NpemVfeCA9IE1hdGgubWluKHRoaXMucmVzaXplX3dnZC5tYXhfc2l6ZV94IHx8CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUubWF4X3NpemVbMF0sCiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5tYXhfY29scyAtIHRoaXMucmVzaXplX2luaXRpYWxfY29sICsgMSk7CiAgICAgICAgdGhpcy5yZXNpemVfbWF4X3NpemVfeSA9IHRoaXMucmVzaXplX3dnZC5tYXhfc2l6ZV95IHx8CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUubWF4X3NpemVbMV07CgogICAgICAgIHRoaXMucmVzaXplX21pbl9zaXplX3ggPSAodGhpcy5yZXNpemVfd2dkLm1pbl9zaXplX3ggfHwKICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJlc2l6ZS5taW5fc2l6ZVswXSB8fCAxKTsKICAgICAgICB0aGlzLnJlc2l6ZV9taW5fc2l6ZV95ID0gKHRoaXMucmVzaXplX3dnZC5taW5fc2l6ZV95IHx8CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUubWluX3NpemVbMV0gfHwgMSk7CgogICAgICAgIHRoaXMucmVzaXplX2luaXRpYWxfbGFzdF9jb2wgPSB0aGlzLmdldF9oaWdoZXN0X29jY3VwaWVkX2NlbGwoKS5jb2w7CgogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX3dpZHRoKHRoaXMuY29scyk7CgogICAgICAgIHRoaXMucmVzaXplX2RpciA9IHsKICAgICAgICAgICAgcmlnaHQ6IHVpLiRwbGF5ZXIuaXMoJy4nICsgdGhpcy5yZXNpemVfaGFuZGxlX2NsYXNzICsgJy14JyksCiAgICAgICAgICAgIGJvdHRvbTogdWkuJHBsYXllci5pcygnLicgKyB0aGlzLnJlc2l6ZV9oYW5kbGVfY2xhc3MgKyAnLXknKQogICAgICAgIH07CgogICAgICAgIHRoaXMuJHJlc2l6ZWRfd2lkZ2V0LmNzcyh7CiAgICAgICAgICAgICdtaW4td2lkdGgnOiB0aGlzLm9wdGlvbnMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1swXSwKICAgICAgICAgICAgJ21pbi1oZWlnaHQnOiB0aGlzLm9wdGlvbnMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1sxXQogICAgICAgIH0pOwoKICAgICAgICB2YXIgbm9kZU5hbWUgPSB0aGlzLiRyZXNpemVkX3dpZGdldC5nZXQoMCkudGFnTmFtZTsKICAgICAgICB0aGlzLiRyZXNpemVfcHJldmlld19ob2xkZXIgPSAkKCc8JyArIG5vZGVOYW1lICsgJyAvPicsIHsKICAgICAgICAgICAgICAnY2xhc3MnOiAncHJldmlldy1ob2xkZXIgcmVzaXplLXByZXZpZXctaG9sZGVyJywKICAgICAgICAgICAgICAnZGF0YS1yb3cnOiB0aGlzLiRyZXNpemVkX3dpZGdldC5hdHRyKCdkYXRhLXJvdycpLAogICAgICAgICAgICAgICdkYXRhLWNvbCc6IHRoaXMuJHJlc2l6ZWRfd2lkZ2V0LmF0dHIoJ2RhdGEtY29sJyksCiAgICAgICAgICAgICAgJ2Nzcyc6IHsKICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogdGhpcy5yZXNpemVfaW5pdGlhbF93aWR0aCwKICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IHRoaXMucmVzaXplX2luaXRpYWxfaGVpZ2h0CiAgICAgICAgICAgICAgfQogICAgICAgIH0pLmFwcGVuZFRvKHRoaXMuJGVsKTsKCiAgICAgICAgdGhpcy4kcmVzaXplZF93aWRnZXQuYWRkQ2xhc3MoJ3Jlc2l6aW5nJyk7CgoJCWlmICh0aGlzLm9wdGlvbnMucmVzaXplLnN0YXJ0KSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUuc3RhcnQuY2FsbCh0aGlzLCBldmVudCwgdWksIHRoaXMuJHJlc2l6ZWRfd2lkZ2V0KTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJGVsLnRyaWdnZXIoJ2dyaWRzdGVyOnJlc2l6ZXN0YXJ0Jyk7CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCBldmVyeSB0aW1lIGEgd2lkZ2V0IHN0b3BzIGJlaW5nIHJlc2l6ZWQuCiAgICAqCiAgICAqIEBtZXRob2Qgb25fc3RvcF9yZXNpemUKICAgICogQHBhcmFtIHtFdmVudH0gZXZlbnQgVGhlIG9yaWdpbmFsIGJyb3dzZXIgZXZlbnQKICAgICogQHBhcmFtIHtPYmplY3R9IHVpIEEgcHJlcGFyZWQgdWkgb2JqZWN0IHdpdGggdXNlZnVsIGRyYWctcmVsYXRlZCBkYXRhCiAgICAqLwogICAgZm4ub25fc3RvcF9yZXNpemUgPSBmdW5jdGlvbihldmVudCwgdWkpIHsKICAgICAgICB0aGlzLiRyZXNpemVkX3dpZGdldAogICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3Jlc2l6aW5nJykKICAgICAgICAgICAgLmNzcyh7CiAgICAgICAgICAgICAgICAnd2lkdGgnOiAnJywKICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnJwogICAgICAgICAgICB9KTsKCiAgICAgICAgZGVsYXkoJC5wcm94eShmdW5jdGlvbigpIHsKICAgICAgICAgICAgdGhpcy4kcmVzaXplX3ByZXZpZXdfaG9sZGVyCiAgICAgICAgICAgICAgICAucmVtb3ZlKCkKICAgICAgICAgICAgICAgIC5jc3MoewogICAgICAgICAgICAgICAgICAgICdtaW4td2lkdGgnOiAnJywKICAgICAgICAgICAgICAgICAgICAnbWluLWhlaWdodCc6ICcnCiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMucmVzaXplLnN0b3ApIHsKICAgICAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUuc3RvcC5jYWxsKHRoaXMsIGV2ZW50LCB1aSwgdGhpcy4kcmVzaXplZF93aWRnZXQpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKCdncmlkc3RlcjpyZXNpemVzdG9wJyk7CiAgICAgICAgfSwgdGhpcyksIDMwMCk7CgogICAgICAgIHRoaXMuc2V0X2RvbV9ncmlkX3dpZHRoKCk7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b2dyb3dfY29scykgewogICAgICAgICAgICB0aGlzLmRyYWdfYXBpLnNldF9saW1pdHModGhpcy5jb2xzICogdGhpcy5taW5fd2lkZ2V0X3dpZHRoKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiBpcyBleGVjdXRlZCB3aGVuIGEgd2lkZ2V0IGlzIGJlaW5nIHJlc2l6ZWQuCiAgICAqCiAgICAqIEBtZXRob2Qgb25fcmVzaXplCiAgICAqIEBwYXJhbSB7RXZlbnR9IGV2ZW50IFRoZSBvcmlnaW5hbCBicm93c2VyIGV2ZW50CiAgICAqIEBwYXJhbSB7T2JqZWN0fSB1aSBBIHByZXBhcmVkIHVpIG9iamVjdCB3aXRoIHVzZWZ1bCBkcmFnLXJlbGF0ZWQgZGF0YQogICAgKi8KICAgIGZuLm9uX3Jlc2l6ZSA9IGZ1bmN0aW9uKGV2ZW50LCB1aSkgewogICAgICAgIHZhciByZWxfeCA9ICh1aS5wb2ludGVyLmRpZmZfbGVmdCk7CiAgICAgICAgdmFyIHJlbF95ID0gKHVpLnBvaW50ZXIuZGlmZl90b3ApOwogICAgICAgIHZhciB3YmRfeCA9IHRoaXMub3B0aW9ucy53aWRnZXRfYmFzZV9kaW1lbnNpb25zWzBdOwogICAgICAgIHZhciB3YmRfeSA9IHRoaXMub3B0aW9ucy53aWRnZXRfYmFzZV9kaW1lbnNpb25zWzFdOwogICAgICAgIHZhciBtYXJnaW5feCA9IHRoaXMub3B0aW9ucy53aWRnZXRfbWFyZ2luc1swXTsKICAgICAgICB2YXIgbWFyZ2luX3kgPSB0aGlzLm9wdGlvbnMud2lkZ2V0X21hcmdpbnNbMV07CiAgICAgICAgdmFyIG1heF9zaXplX3ggPSB0aGlzLnJlc2l6ZV9tYXhfc2l6ZV94OwogICAgICAgIHZhciBtaW5fc2l6ZV94ID0gdGhpcy5yZXNpemVfbWluX3NpemVfeDsKICAgICAgICB2YXIgbWF4X3NpemVfeSA9IHRoaXMucmVzaXplX21heF9zaXplX3k7CiAgICAgICAgdmFyIG1pbl9zaXplX3kgPSB0aGlzLnJlc2l6ZV9taW5fc2l6ZV95OwogICAgICAgIHZhciBhdXRvZ3JvdyA9IHRoaXMub3B0aW9ucy5hdXRvZ3Jvd19jb2xzOwogICAgICAgIHZhciB3aWR0aDsKICAgICAgICB2YXIgbWF4X3dpZHRoID0gSW5maW5pdHk7CiAgICAgICAgdmFyIG1heF9oZWlnaHQgPSBJbmZpbml0eTsKCiAgICAgICAgdmFyIGluY191bml0c194ID0gTWF0aC5jZWlsKChyZWxfeCAvICh3YmRfeCArIG1hcmdpbl94ICogMikpIC0gMC4yKTsKICAgICAgICB2YXIgaW5jX3VuaXRzX3kgPSBNYXRoLmNlaWwoKHJlbF95IC8gKHdiZF95ICsgbWFyZ2luX3kgKiAyKSkgLSAwLjIpOwoKICAgICAgICB2YXIgc2l6ZV94ID0gTWF0aC5tYXgoMSwgdGhpcy5yZXNpemVfaW5pdGlhbF9zaXpleCArIGluY191bml0c194KTsKICAgICAgICB2YXIgc2l6ZV95ID0gTWF0aC5tYXgoMSwgdGhpcy5yZXNpemVfaW5pdGlhbF9zaXpleSArIGluY191bml0c195KTsKCiAgICAgICAgdmFyIG1heF9jb2xzID0gKHRoaXMuY29udGFpbmVyX3dpZHRoIC8gdGhpcy5taW5fd2lkZ2V0X3dpZHRoKSAtCiAgICAgICAgICAgIHRoaXMucmVzaXplX2luaXRpYWxfY29sICsgMTsKICAgICAgICB2YXIgbGltaXRfd2lkdGggPSAoKG1heF9jb2xzICogdGhpcy5taW5fd2lkZ2V0X3dpZHRoKSAtIG1hcmdpbl94ICogMik7CgogICAgICAgIHNpemVfeCA9IE1hdGgubWF4KE1hdGgubWluKHNpemVfeCwgbWF4X3NpemVfeCksIG1pbl9zaXplX3gpOwogICAgICAgIHNpemVfeCA9IE1hdGgubWluKG1heF9jb2xzLCBzaXplX3gpOwogICAgICAgIHdpZHRoID0gKG1heF9zaXplX3ggKiB3YmRfeCkgKyAoKHNpemVfeCAtIDEpICogbWFyZ2luX3ggKiAyKTsKICAgICAgICBtYXhfd2lkdGggPSBNYXRoLm1pbih3aWR0aCwgbGltaXRfd2lkdGgpOwogICAgICAgIG1pbl93aWR0aCA9IChtaW5fc2l6ZV94ICogd2JkX3gpICsgKChzaXplX3ggLSAxKSAqIG1hcmdpbl94ICogMik7CgogICAgICAgIHNpemVfeSA9IE1hdGgubWF4KE1hdGgubWluKHNpemVfeSwgbWF4X3NpemVfeSksIG1pbl9zaXplX3kpOwogICAgICAgIG1heF9oZWlnaHQgPSAobWF4X3NpemVfeSAqIHdiZF95KSArICgoc2l6ZV95IC0gMSkgKiBtYXJnaW5feSAqIDIpOwogICAgICAgIG1pbl9oZWlnaHQgPSAobWluX3NpemVfeSAqIHdiZF95KSArICgoc2l6ZV95IC0gMSkgKiBtYXJnaW5feSAqIDIpOwoKICAgICAgICBpZiAodGhpcy5yZXNpemVfZGlyLnJpZ2h0KSB7CiAgICAgICAgICAgIHNpemVfeSA9IHRoaXMucmVzaXplX2luaXRpYWxfc2l6ZXk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLnJlc2l6ZV9kaXIuYm90dG9tKSB7CiAgICAgICAgICAgIHNpemVfeCA9IHRoaXMucmVzaXplX2luaXRpYWxfc2l6ZXg7CiAgICAgICAgfQoKICAgICAgICBpZiAoYXV0b2dyb3cpIHsKICAgICAgICAgICAgdmFyIGxhc3Rfd2lkZ2V0X2NvbCA9IHRoaXMucmVzaXplX2luaXRpYWxfY29sICsgc2l6ZV94IC0gMTsKICAgICAgICAgICAgaWYgKGF1dG9ncm93ICYmIHRoaXMucmVzaXplX2luaXRpYWxfbGFzdF9jb2wgPD0gbGFzdF93aWRnZXRfY29sKSB7CiAgICAgICAgICAgICAgICB0aGlzLnNldF9kb21fZ3JpZF93aWR0aChNYXRoLm1heChsYXN0X3dpZGdldF9jb2wgKyAxLCB0aGlzLmNvbHMpKTsKCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2xzIDwgbGFzdF93aWRnZXRfY29sKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRfZmF1eF9jb2xzKGxhc3Rfd2lkZ2V0X2NvbCAtIHRoaXMuY29scyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBjc3NfcHJvcHMgPSB7fTsKICAgICAgICAhdGhpcy5yZXNpemVfZGlyLmJvdHRvbSAmJiAoY3NzX3Byb3BzLndpZHRoID0gTWF0aC5tYXgoTWF0aC5taW4oCiAgICAgICAgICAgIHRoaXMucmVzaXplX2luaXRpYWxfd2lkdGggKyByZWxfeCwgbWF4X3dpZHRoKSwgbWluX3dpZHRoKSk7CiAgICAgICAgIXRoaXMucmVzaXplX2Rpci5yaWdodCAmJiAoY3NzX3Byb3BzLmhlaWdodCA9IE1hdGgubWF4KE1hdGgubWluKAogICAgICAgICAgICB0aGlzLnJlc2l6ZV9pbml0aWFsX2hlaWdodCArIHJlbF95LCBtYXhfaGVpZ2h0KSwgbWluX2hlaWdodCkpOwoKICAgICAgICB0aGlzLiRyZXNpemVkX3dpZGdldC5jc3MoY3NzX3Byb3BzKTsKCiAgICAgICAgaWYgKHNpemVfeCAhPT0gdGhpcy5yZXNpemVfbGFzdF9zaXpleCB8fAogICAgICAgICAgICBzaXplX3kgIT09IHRoaXMucmVzaXplX2xhc3Rfc2l6ZXkpIHsKCiAgICAgICAgICAgIHRoaXMucmVzaXplX3dpZGdldCh0aGlzLiRyZXNpemVkX3dpZGdldCwgc2l6ZV94LCBzaXplX3kpOwogICAgICAgICAgICB0aGlzLnNldF9kb21fZ3JpZF93aWR0aCh0aGlzLmNvbHMpOwoKICAgICAgICAgICAgdGhpcy4kcmVzaXplX3ByZXZpZXdfaG9sZGVyLmNzcyh7CiAgICAgICAgICAgICAgICAnd2lkdGgnOiAnJywKICAgICAgICAgICAgICAgICdoZWlnaHQnOiAnJwogICAgICAgICAgICB9KS5hdHRyKHsKICAgICAgICAgICAgICAgICdkYXRhLXJvdyc6IHRoaXMuJHJlc2l6ZWRfd2lkZ2V0LmF0dHIoJ2RhdGEtcm93JyksCiAgICAgICAgICAgICAgICAnZGF0YS1zaXpleCc6IHNpemVfeCwKICAgICAgICAgICAgICAgICdkYXRhLXNpemV5Jzogc2l6ZV95CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5yZXNpemUucmVzaXplKSB7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucy5yZXNpemUucmVzaXplLmNhbGwodGhpcywgZXZlbnQsIHVpLCB0aGlzLiRyZXNpemVkX3dpZGdldCk7CiAgICAgICAgfQoKICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKCdncmlkc3RlcjpyZXNpemUnKTsKCiAgICAgICAgdGhpcy5yZXNpemVfbGFzdF9zaXpleCA9IHNpemVfeDsKICAgICAgICB0aGlzLnJlc2l6ZV9sYXN0X3NpemV5ID0gc2l6ZV95OwogICAgfTsKCgogICAgLyoqCiAgICAqIEV4ZWN1dGVzIHRoZSBjYWxsYmFja3MgcGFzc2VkIGFzIGFyZ3VtZW50cyB3aGVuIGEgY29sdW1uIGJlZ2lucyB0byBiZQogICAgKiBvdmVybGFwcGVkIG9yIHN0b3BzIGJlaW5nIG92ZXJsYXBwZWQuCiAgICAqCiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN0YXJ0X2NhbGxiYWNrIEZ1bmN0aW9uIGV4ZWN1dGVkIHdoZW4gYSBuZXcgY29sdW1uCiAgICAqICBiZWdpbnMgdG8gYmUgb3ZlcmxhcHBlZC4gVGhlIGNvbHVtbiBpcyBwYXNzZWQgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IHN0b3BfY2FsbGJhY2sgRnVuY3Rpb24gZXhlY3V0ZWQgd2hlbiBhIGNvbHVtbiBzdG9wcwogICAgKiAgYmVpbmcgb3ZlcmxhcHBlZC4gVGhlIGNvbHVtbiBpcyBwYXNzZWQgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAqIEBtZXRob2Qgb25fb3ZlcmxhcHBlZF9jb2x1bW5fY2hhbmdlCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4ub25fb3ZlcmxhcHBlZF9jb2x1bW5fY2hhbmdlID0gZnVuY3Rpb24oc3RhcnRfY2FsbGJhY2ssIHN0b3BfY2FsbGJhY2spIHsKICAgICAgICBpZiAoIXRoaXMuY29sbGlkZXJzX2RhdGEubGVuZ3RoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzOwogICAgICAgIH0KICAgICAgICB2YXIgY29scyA9IHRoaXMuZ2V0X3RhcmdldGVkX2NvbHVtbnMoCiAgICAgICAgICAgIHRoaXMuY29sbGlkZXJzX2RhdGFbMF0uZWwuZGF0YS5jb2wpOwoKICAgICAgICB2YXIgbGFzdF9uX2NvbHMgPSB0aGlzLmxhc3RfY29scy5sZW5ndGg7CiAgICAgICAgdmFyIG5fY29scyA9IGNvbHMubGVuZ3RoOwogICAgICAgIHZhciBpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbl9jb2xzOyBpKyspIHsKICAgICAgICAgICAgaWYgKCQuaW5BcnJheShjb2xzW2ldLCB0aGlzLmxhc3RfY29scykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAoc3RhcnRfY2FsbGJhY2sgfHwgJC5ub29wKS5jYWxsKHRoaXMsIGNvbHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpPCBsYXN0X25fY29sczsgaSsrKSB7CiAgICAgICAgICAgIGlmICgkLmluQXJyYXkodGhpcy5sYXN0X2NvbHNbaV0sIGNvbHMpID09PSAtMSkgewogICAgICAgICAgICAgICAgKHN0b3BfY2FsbGJhY2sgfHwgJC5ub29wKS5jYWxsKHRoaXMsIHRoaXMubGFzdF9jb2xzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXN0X2NvbHMgPSBjb2xzOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBFeGVjdXRlcyB0aGUgY2FsbGJhY2tzIHBhc3NlZCBhcyBhcmd1bWVudHMgd2hlbiBhIHJvdyBzdGFydHMgdG8gYmUKICAgICogb3ZlcmxhcHBlZCBvciBzdG9wcyBiZWluZyBvdmVybGFwcGVkLgogICAgKgogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBzdGFydF9jYWxsYmFjayBGdW5jdGlvbiBleGVjdXRlZCB3aGVuIGEgbmV3IHJvdyBiZWdpbnMKICAgICogIHRvIGJlIG92ZXJsYXBwZWQuIFRoZSByb3cgaXMgcGFzc2VkIGFzIGZpcnN0IGFyZ3VtZW50LgogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBlbmRfY2FsbGJhY2sgRnVuY3Rpb24gZXhlY3V0ZWQgd2hlbiBhIHJvdyBzdG9wcyBiZWluZwogICAgKiAgb3ZlcmxhcHBlZC4gVGhlIHJvdyBpcyBwYXNzZWQgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAqIEBtZXRob2Qgb25fb3ZlcmxhcHBlZF9yb3dfY2hhbmdlCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4ub25fb3ZlcmxhcHBlZF9yb3dfY2hhbmdlID0gZnVuY3Rpb24oc3RhcnRfY2FsbGJhY2ssIGVuZF9jYWxsYmFjaykgewogICAgICAgIGlmICghdGhpcy5jb2xsaWRlcnNfZGF0YS5sZW5ndGgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgICAgIHZhciByb3dzID0gdGhpcy5nZXRfdGFyZ2V0ZWRfcm93cyh0aGlzLmNvbGxpZGVyc19kYXRhWzBdLmVsLmRhdGEucm93KTsKICAgICAgICB2YXIgbGFzdF9uX3Jvd3MgPSB0aGlzLmxhc3Rfcm93cy5sZW5ndGg7CiAgICAgICAgdmFyIG5fcm93cyA9IHJvd3MubGVuZ3RoOwogICAgICAgIHZhciBpOwoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbl9yb3dzOyBpKyspIHsKICAgICAgICAgICAgaWYgKCQuaW5BcnJheShyb3dzW2ldLCB0aGlzLmxhc3Rfcm93cykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAoc3RhcnRfY2FsbGJhY2sgfHwgJC5ub29wKS5jYWxsKHRoaXMsIHJvd3NbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGFzdF9uX3Jvd3M7IGkrKykgewogICAgICAgICAgICBpZiAoJC5pbkFycmF5KHRoaXMubGFzdF9yb3dzW2ldLCByb3dzKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgIChlbmRfY2FsbGJhY2sgfHwgJC5ub29wKS5jYWxsKHRoaXMsIHRoaXMubGFzdF9yb3dzW2ldKTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdGhpcy5sYXN0X3Jvd3MgPSByb3dzOwogICAgfTsKCgogICAgLyoqCiAgICAqIFNldHMgdGhlIGN1cnJlbnQgcG9zaXRpb24gb2YgdGhlIHBsYXllcgogICAgKgogICAgKiBAcGFyYW0ge051bWJlcn0gY29sCiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cKICAgICogQHBhcmFtIHtCb29sZWFufSBub19wbGF5ZXIKICAgICogQG1ldGhvZCBzZXRfcGxheWVyCiAgICAqIEByZXR1cm4ge29iamVjdH0KICAgICovCiAgICBmbi5zZXRfcGxheWVyID0gZnVuY3Rpb24oY29sLCByb3csIG5vX3BsYXllcikgewogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICBpZiAoIW5vX3BsYXllcikgewogICAgICAgICAgICB0aGlzLmVtcHR5X2NlbGxzX3BsYXllcl9vY2N1cGllcygpOwogICAgICAgIH0KICAgICAgICB2YXIgY2VsbCA9ICFub19wbGF5ZXIgPyBzZWxmLmNvbGxpZGVyc19kYXRhWzBdLmVsLmRhdGEgOiB7Y29sOiBjb2x9OwogICAgICAgIHZhciB0b19jb2wgPSBjZWxsLmNvbDsKICAgICAgICB2YXIgdG9fcm93ID0gcm93IHx8IGNlbGwucm93OwoKICAgICAgICB0aGlzLnBsYXllcl9ncmlkX2RhdGEgPSB7CiAgICAgICAgICAgIGNvbDogdG9fY29sLAogICAgICAgICAgICByb3c6IHRvX3JvdywKICAgICAgICAgICAgc2l6ZV95IDogdGhpcy5wbGF5ZXJfZ3JpZF9kYXRhLnNpemVfeSwKICAgICAgICAgICAgc2l6ZV94IDogdGhpcy5wbGF5ZXJfZ3JpZF9kYXRhLnNpemVfeAogICAgICAgIH07CgogICAgICAgIHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyID0gdGhpcy5nZXRfY2VsbHNfb2NjdXBpZWQoCiAgICAgICAgICAgIHRoaXMucGxheWVyX2dyaWRfZGF0YSk7CgogICAgICAgIHZhciAkb3ZlcmxhcHBlZF93aWRnZXRzID0gdGhpcy5nZXRfd2lkZ2V0c19vdmVybGFwcGVkKAogICAgICAgICAgICB0aGlzLnBsYXllcl9ncmlkX2RhdGEpOwoKICAgICAgICB2YXIgY29uc3RyYWludHMgPSB0aGlzLndpZGdldHNfY29uc3RyYWludHMoJG92ZXJsYXBwZWRfd2lkZ2V0cyk7CgogICAgICAgIHRoaXMubWFuYWdlX21vdmVtZW50cyhjb25zdHJhaW50cy5jYW5fZ29fdXAsIHRvX2NvbCwgdG9fcm93KTsKICAgICAgICB0aGlzLm1hbmFnZV9tb3ZlbWVudHMoY29uc3RyYWludHMuY2FuX25vdF9nb191cCwgdG9fY29sLCB0b19yb3cpOwoKICAgICAgICAvKiBpZiB0aGVyZSBpcyBub3Qgd2lkZ2V0cyBvdmVybGFwcGluZyBpbiB0aGUgbmV3IHBsYXllciBwb3NpdGlvbiwKICAgICAgICAgKiB1cGRhdGUgdGhlIG5ldyBwbGFjZWhvbGRlciBwb3NpdGlvbi4gKi8KICAgICAgICBpZiAoISRvdmVybGFwcGVkX3dpZGdldHMubGVuZ3RoKSB7CiAgICAgICAgICAgIHZhciBwcCA9IHRoaXMuY2FuX2dvX3BsYXllcl91cCh0aGlzLnBsYXllcl9ncmlkX2RhdGEpOwogICAgICAgICAgICBpZiAocHAgIT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB0b19yb3cgPSBwcDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnNldF9wbGFjZWhvbGRlcih0b19jb2wsIHRvX3Jvdyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjb2w6IHRvX2NvbCwKICAgICAgICAgICAgcm93OiB0b19yb3cKICAgICAgICB9OwogICAgfTsKCgogICAgLyoqCiAgICAqIFNlZSB3aGljaCBvZiB0aGUgd2lkZ2V0cyBpbiB0aGUgJHdpZGdldHMgcGFyYW0gY29sbGVjdGlvbiBjYW4gZ28gdG8KICAgICogYSB1cHBlciByb3cgYW5kIHdoaWNoIG5vdC4KICAgICoKICAgICogQG1ldGhvZCB3aWRnZXRzX2NvbnRyYWludHMKICAgICogQHBhcmFtIHtqUXVlcnl9ICR3aWRnZXRzIEEgalF1ZXJ5IHdyYXBwZWQgY29sbGVjdGlvbiBvZgogICAgKiBIVE1MRWxlbWVudHMuCiAgICAqIEByZXR1cm4ge29iamVjdH0gUmV0dXJucyBhIGxpdGVyYWwgT2JqZWN0IHdpdGggdHdvIGtleXM6IGBjYW5fZ29fdXBgICYKICAgICogYGNhbl9ub3RfZ29fdXBgLiBFYWNoIGNvbnRhaW5zIGEgc2V0IG9mIEhUTUxFbGVtZW50cy4KICAgICovCiAgICBmbi53aWRnZXRzX2NvbnN0cmFpbnRzID0gZnVuY3Rpb24oJHdpZGdldHMpIHsKICAgICAgICB2YXIgJHdpZGdldHNfY2FuX2dvX3VwID0gJChbXSk7CiAgICAgICAgdmFyICR3aWRnZXRzX2Nhbl9ub3RfZ29fdXA7CiAgICAgICAgdmFyIHdnZF9jYW5fZ29fdXAgPSBbXTsKICAgICAgICB2YXIgd2dkX2Nhbl9ub3RfZ29fdXAgPSBbXTsKCiAgICAgICAgJHdpZGdldHMuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGksIHcpIHsKICAgICAgICAgICAgdmFyICR3ID0gJCh3KTsKICAgICAgICAgICAgdmFyIHdnZCA9ICR3LmNvb3JkcygpLmdyaWQ7CiAgICAgICAgICAgIGlmICh0aGlzLmNhbl9nb193aWRnZXRfdXAod2dkKSkgewogICAgICAgICAgICAgICAgJHdpZGdldHNfY2FuX2dvX3VwID0gJHdpZGdldHNfY2FuX2dvX3VwLmFkZCgkdyk7CiAgICAgICAgICAgICAgICB3Z2RfY2FuX2dvX3VwLnB1c2god2dkKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHdnZF9jYW5fbm90X2dvX3VwLnB1c2god2dkKTsKICAgICAgICAgICAgfQogICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgJHdpZGdldHNfY2FuX25vdF9nb191cCA9ICR3aWRnZXRzLm5vdCgkd2lkZ2V0c19jYW5fZ29fdXApOwoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBjYW5fZ29fdXA6IEdyaWRzdGVyLnNvcnRfYnlfcm93X2FzYyh3Z2RfY2FuX2dvX3VwKSwKICAgICAgICAgICAgY2FuX25vdF9nb191cDogR3JpZHN0ZXIuc29ydF9ieV9yb3dfZGVzYyh3Z2RfY2FuX25vdF9nb191cCkKICAgICAgICB9OwogICAgfTsKCgogICAgLyoqCiAgICAqIFNvcnRzIGFuIEFycmF5IG9mIGdyaWQgY29vcmRzIG9iamVjdHMgKHJlcHJlc2VudGluZyB0aGUgZ3JpZCBjb29yZHMgb2YKICAgICogZWFjaCB3aWRnZXQpIGluIGRlc2NlbmRpbmcgd2F5LgogICAgKgogICAgKiBAbWV0aG9kIG1hbmFnZV9tb3ZlbWVudHMKICAgICogQHBhcmFtIHtqUXVlcnl9ICR3aWRnZXRzIEEgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgSFRNTEVsZW1lbnRzCiAgICAqICByZXByZXNlbnRpbmcgdGhlIHdpZGdldHMgeW91IHdhbnQgdG8gbW92ZS4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHRvX2NvbCBUaGUgY29sdW1uIHRvIHdoaWNoIHdlIHdhbnQgdG8gbW92ZSB0aGUgd2lkZ2V0cy4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHRvX3JvdyBUaGUgcm93IHRvIHdoaWNoIHdlIHdhbnQgdG8gbW92ZSB0aGUgd2lkZ2V0cy4KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5tYW5hZ2VfbW92ZW1lbnRzID0gZnVuY3Rpb24oJHdpZGdldHMsIHRvX2NvbCwgdG9fcm93KSB7CiAgICAgICAgJC5lYWNoKCR3aWRnZXRzLCAkLnByb3h5KGZ1bmN0aW9uKGksIHcpIHsKICAgICAgICAgICAgdmFyIHdnZCA9IHc7CiAgICAgICAgICAgIHZhciAkdyA9IHdnZC5lbDsKCiAgICAgICAgICAgIHZhciBjYW5fZ29fd2lkZ2V0X3VwID0gdGhpcy5jYW5fZ29fd2lkZ2V0X3VwKHdnZCk7CgogICAgICAgICAgICBpZiAoY2FuX2dvX3dpZGdldF91cCkgewogICAgICAgICAgICAgICAgLy90YXJnZXQgQ0FOIGdvIHVwCiAgICAgICAgICAgICAgICAvL3NvIG1vdmUgd2lkZ2V0IHVwCiAgICAgICAgICAgICAgICB0aGlzLm1vdmVfd2lkZ2V0X3RvKCR3LCBjYW5fZ29fd2lkZ2V0X3VwKTsKICAgICAgICAgICAgICAgIHRoaXMuc2V0X3BsYWNlaG9sZGVyKHRvX2NvbCwgY2FuX2dvX3dpZGdldF91cCArIHdnZC5zaXplX3kpOwoKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIC8vdGFyZ2V0IGNhbid0IGdvIHVwCiAgICAgICAgICAgICAgICB2YXIgY2FuX2dvX3BsYXllcl91cCA9IHRoaXMuY2FuX2dvX3BsYXllcl91cCgKICAgICAgICAgICAgICAgICAgICB0aGlzLnBsYXllcl9ncmlkX2RhdGEpOwoKICAgICAgICAgICAgICAgIGlmICghY2FuX2dvX3BsYXllcl91cCkgewogICAgICAgICAgICAgICAgICAgIC8vIHRhcmdldCBjYW4ndCBnbyB1cAogICAgICAgICAgICAgICAgICAgIC8vIHBsYXllciBjYW50J3QgZ28gdXAKICAgICAgICAgICAgICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIG1vdmUgd2lkZ2V0IGRvd24gdG8gYSBwb3NpdGlvbiB0aGF0IGRvbnQKICAgICAgICAgICAgICAgICAgICAvLyBvdmVybGFwcyBwbGF5ZXIKICAgICAgICAgICAgICAgICAgICB2YXIgeSA9ICh0b19yb3cgKyB0aGlzLnBsYXllcl9ncmlkX2RhdGEuc2l6ZV95KSAtIHdnZC5yb3c7CgogICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZV93aWRnZXRfZG93bigkdywgeSk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRfcGxhY2Vob2xkZXIodG9fY29sLCB0b19yb3cpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgLyoqCiAgICAqIERldGVybWluZXMgaWYgdGhlcmUgaXMgYSB3aWRnZXQgaW4gdGhlIHJvdyBhbmQgY29sIGdpdmVuLiBPciBpZiB0aGUKICAgICogSFRNTEVsZW1lbnQgcGFzc2VkIGFzIGZpcnN0IGFyZ3VtZW50IGlzIHRoZSBwbGF5ZXIuCiAgICAqCiAgICAqIEBtZXRob2QgaXNfcGxheWVyCiAgICAqIEBwYXJhbSB7TnVtYmVyfEhUTUxFbGVtZW50fSBjb2xfb3JfZWwgQSBqUXVlcnkgd3JhcHBlZCBjb2xsZWN0aW9uIG9mCiAgICAqIEhUTUxFbGVtZW50cy4KICAgICogQHBhcmFtIHtOdW1iZXJ9IFtyb3ddIFRoZSBjb2x1bW4gdG8gd2hpY2ggd2Ugd2FudCB0byBtb3ZlIHRoZSB3aWRnZXRzLgogICAgKiBAcmV0dXJuIHtCb29sZWFufSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAqLwogICAgZm4uaXNfcGxheWVyID0gZnVuY3Rpb24oY29sX29yX2VsLCByb3cpIHsKICAgICAgICBpZiAocm93ICYmICF0aGlzLmdyaWRtYXBbY29sX29yX2VsXSkgeyByZXR1cm4gZmFsc2U7IH0KICAgICAgICB2YXIgJHcgPSByb3cgPyB0aGlzLmdyaWRtYXBbY29sX29yX2VsXVtyb3ddIDogY29sX29yX2VsOwogICAgICAgIHJldHVybiAkdyAmJiAoJHcuaXModGhpcy4kcGxheWVyKSB8fCAkdy5pcyh0aGlzLiRoZWxwZXIpKTsKICAgIH07CgoKICAgIC8qKgogICAgKiBEZXRlcm1pbmVzIGlmIHRoZSB3aWRnZXQgdGhhdCBpcyBiZWluZyBkcmFnZ2VkIGlzIGN1cnJlbnRseSBvdmVyIHRoZSByb3cKICAgICogYW5kIGNvbCBnaXZlbi4KICAgICoKICAgICogQG1ldGhvZCBpc19wbGF5ZXJfaW4KICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sdW1uIHRvIGNoZWNrLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gY2hlY2suCiAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBvciBmYWxzZS4KICAgICovCiAgICBmbi5pc19wbGF5ZXJfaW4gPSBmdW5jdGlvbihjb2wsIHJvdykgewogICAgICAgIHZhciBjID0gdGhpcy5jZWxsc19vY2N1cGllZF9ieV9wbGF5ZXIgfHwge307CiAgICAgICAgcmV0dXJuICQuaW5BcnJheShjb2wsIGMuY29scykgPj0gMCAmJiAkLmluQXJyYXkocm93LCBjLnJvd3MpID49IDA7CiAgICB9OwoKCiAgICAvKioKICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgcGxhY2Vob2xkZXIgaXMgY3VycmVudGx5IG92ZXIgdGhlIHJvdyBhbmQgY29sIGdpdmVuLgogICAgKgogICAgKiBAbWV0aG9kIGlzX3BsYWNlaG9sZGVyX2luCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIGNvbHVtbiB0byBjaGVjay4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIGNoZWNrLgogICAgKiBAcmV0dXJuIHtCb29sZWFufSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAqLwogICAgZm4uaXNfcGxhY2Vob2xkZXJfaW4gPSBmdW5jdGlvbihjb2wsIHJvdykgewogICAgICAgIHZhciBjID0gdGhpcy5jZWxsc19vY2N1cGllZF9ieV9wbGFjZWhvbGRlciB8fCB7fTsKICAgICAgICByZXR1cm4gdGhpcy5pc19wbGFjZWhvbGRlcl9pbl9jb2woY29sKSAmJiAkLmluQXJyYXkocm93LCBjLnJvd3MpID49IDA7CiAgICB9OwoKCiAgICAvKioKICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgcGxhY2Vob2xkZXIgaXMgY3VycmVudGx5IG92ZXIgdGhlIGNvbHVtbiBnaXZlbi4KICAgICoKICAgICogQG1ldGhvZCBpc19wbGFjZWhvbGRlcl9pbl9jb2wKICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sdW1uIHRvIGNoZWNrLgogICAgKiBAcmV0dXJuIHtCb29sZWFufSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAqLwogICAgZm4uaXNfcGxhY2Vob2xkZXJfaW5fY29sID0gZnVuY3Rpb24oY29sKSB7CiAgICAgICAgdmFyIGMgPSB0aGlzLmNlbGxzX29jY3VwaWVkX2J5X3BsYWNlaG9sZGVyIHx8IFtdOwogICAgICAgIHJldHVybiAkLmluQXJyYXkoY29sLCBjLmNvbHMpID49IDA7CiAgICB9OwoKCiAgICAvKioKICAgICogRGV0ZXJtaW5lcyBpZiB0aGUgY2VsbCByZXByZXNlbnRlZCBieSBjb2wgYW5kIHJvdyBwYXJhbXMgaXMgZW1wdHkuCiAgICAqCiAgICAqIEBtZXRob2QgaXNfZW1wdHkKICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sdW1uIHRvIGNoZWNrLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gY2hlY2suCiAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBvciBmYWxzZS4KICAgICovCiAgICBmbi5pc19lbXB0eSA9IGZ1bmN0aW9uKGNvbCwgcm93KSB7CiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmdyaWRtYXBbY29sXSAhPT0gJ3VuZGVmaW5lZCcpIHsKCQkJaWYodHlwZW9mIHRoaXMuZ3JpZG1hcFtjb2xdW3Jvd10gIT09ICd1bmRlZmluZWQnICYmCgkJCQkgdGhpcy5ncmlkbWFwW2NvbF1bcm93XSA9PT0gZmFsc2UKCQkJKSB7CgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfQoJCQlyZXR1cm4gZmFsc2U7CgkJfQoJCXJldHVybiB0cnVlOwogICAgfTsKCgogICAgLyoqCiAgICAqIERldGVybWluZXMgaWYgdGhlIGNlbGwgcmVwcmVzZW50ZWQgYnkgY29sIGFuZCByb3cgcGFyYW1zIGlzIG9jY3VwaWVkLgogICAgKgogICAgKiBAbWV0aG9kIGlzX29jY3VwaWVkCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIGNvbHVtbiB0byBjaGVjay4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIGNoZWNrLgogICAgKiBAcmV0dXJuIHtCb29sZWFufSBSZXR1cm5zIHRydWUgb3IgZmFsc2UuCiAgICAqLwogICAgZm4uaXNfb2NjdXBpZWQgPSBmdW5jdGlvbihjb2wsIHJvdykgewogICAgICAgIGlmICghdGhpcy5ncmlkbWFwW2NvbF0pIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KCiAgICAgICAgaWYgKHRoaXMuZ3JpZG1hcFtjb2xdW3Jvd10pIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgoKICAgIC8qKgogICAgKiBEZXRlcm1pbmVzIGlmIHRoZXJlIGlzIGEgd2lkZ2V0IGluIHRoZSBjZWxsIHJlcHJlc2VudGVkIGJ5IGNvbC9yb3cgcGFyYW1zLgogICAgKgogICAgKiBAbWV0aG9kIGlzX3dpZGdldAogICAgKiBAcGFyYW0ge051bWJlcn0gY29sIFRoZSBjb2x1bW4gdG8gY2hlY2suCiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyB0byBjaGVjay4KICAgICogQHJldHVybiB7Qm9vbGVhbnxIVE1MRWxlbWVudH0gUmV0dXJucyBmYWxzZSBpZiB0aGVyZSBpcyBubyB3aWRnZXQsCiAgICAqIGVsc2UgcmV0dXJucyB0aGUgalF1ZXJ5IEhUTUxFbGVtZW50CiAgICAqLwogICAgZm4uaXNfd2lkZ2V0ID0gZnVuY3Rpb24oY29sLCByb3cpIHsKICAgICAgICB2YXIgY2VsbCA9IHRoaXMuZ3JpZG1hcFtjb2xdOwogICAgICAgIGlmICghY2VsbCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBjZWxsID0gY2VsbFtyb3ddOwoKICAgICAgICBpZiAoY2VsbCkgewogICAgICAgICAgICByZXR1cm4gY2VsbDsKICAgICAgICB9CgogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgoKICAgIC8qKgogICAgKiBEZXRlcm1pbmVzIGlmIHRoZXJlIGlzIGEgd2lkZ2V0IGluIHRoZSBjZWxsIHJlcHJlc2VudGVkIGJ5IGNvbC9yb3cKICAgICogcGFyYW1zIGFuZCBpZiB0aGlzIGlzIHVuZGVyIHRoZSB3aWRnZXQgdGhhdCBpcyBiZWluZyBkcmFnZ2VkLgogICAgKgogICAgKiBAbWV0aG9kIGlzX3dpZGdldF91bmRlcl9wbGF5ZXIKICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sdW1uIHRvIGNoZWNrLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gY2hlY2suCiAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBvciBmYWxzZS4KICAgICovCiAgICBmbi5pc193aWRnZXRfdW5kZXJfcGxheWVyID0gZnVuY3Rpb24oY29sLCByb3cpIHsKICAgICAgICBpZiAodGhpcy5pc193aWRnZXQoY29sLCByb3cpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmlzX3BsYXllcl9pbihjb2wsIHJvdyk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgIH07CgoKICAgIC8qKgogICAgKiBHZXQgd2lkZ2V0cyBvdmVybGFwcGluZyB3aXRoIHRoZSBwbGF5ZXIgb3Igd2l0aCB0aGUgb2JqZWN0IHBhc3NlZAogICAgKiByZXByZXNlbnRpbmcgdGhlIGdyaWQgY2VsbHMuCiAgICAqCiAgICAqIEBtZXRob2QgZ2V0X3dpZGdldHNfdW5kZXJfcGxheWVyCiAgICAqIEByZXR1cm4ge0hUTUxFbGVtZW50fSBSZXR1cm5zIGEgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgSFRNTEVsZW1lbnRzCiAgICAqLwogICAgZm4uZ2V0X3dpZGdldHNfdW5kZXJfcGxheWVyID0gZnVuY3Rpb24oY2VsbHMpIHsKICAgICAgICBjZWxscyB8fCAoY2VsbHMgPSB0aGlzLmNlbGxzX29jY3VwaWVkX2J5X3BsYXllciB8fCB7Y29sczogW10sIHJvd3M6IFtdfSk7CiAgICAgICAgdmFyICR3aWRnZXRzID0gJChbXSk7CgogICAgICAgICQuZWFjaChjZWxscy5jb2xzLCAkLnByb3h5KGZ1bmN0aW9uKGksIGNvbCkgewogICAgICAgICAgICAkLmVhY2goY2VsbHMucm93cywgJC5wcm94eShmdW5jdGlvbihpLCByb3cpIHsKICAgICAgICAgICAgICAgIGlmKHRoaXMuaXNfd2lkZ2V0KGNvbCwgcm93KSkgewogICAgICAgICAgICAgICAgICAgICR3aWRnZXRzID0gJHdpZGdldHMuYWRkKHRoaXMuZ3JpZG1hcFtjb2xdW3Jvd10pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICByZXR1cm4gJHdpZGdldHM7CiAgICB9OwoKCiAgICAvKioKICAgICogUHV0IHBsYWNlaG9sZGVyIGF0IHRoZSByb3cgYW5kIGNvbHVtbiBzcGVjaWZpZWQuCiAgICAqCiAgICAqIEBtZXRob2Qgc2V0X3BsYWNlaG9sZGVyCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIGNvbHVtbiB0byB3aGljaCB3ZSB3YW50IHRvIG1vdmUgdGhlCiAgICAqICBwbGFjZWhvbGRlci4KICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgcm93IHRvIHdoaWNoIHdlIHdhbnQgdG8gbW92ZSB0aGUKICAgICogIHBsYWNlaG9sZGVyLgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnNldF9wbGFjZWhvbGRlciA9IGZ1bmN0aW9uKGNvbCwgcm93KSB7CiAgICAgICAgdmFyIHBoZ2QgPSAkLmV4dGVuZCh7fSwgdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEpOwogICAgICAgIHZhciAkbmV4dHMgPSB0aGlzLndpZGdldHNfYmVsb3coewogICAgICAgICAgICAgICAgY29sOiBwaGdkLmNvbCwKICAgICAgICAgICAgICAgIHJvdzogcGhnZC5yb3csCiAgICAgICAgICAgICAgICBzaXplX3k6IHBoZ2Quc2l6ZV95LAogICAgICAgICAgICAgICAgc2l6ZV94OiBwaGdkLnNpemVfeAogICAgICAgICAgICB9KTsKCiAgICAgICAgLy8gUHJldmVudHMgd2lkZ2V0cyBnbyBvdXQgb2YgdGhlIGdyaWQKICAgICAgICB2YXIgcmlnaHRfY29sID0gKGNvbCArIHBoZ2Quc2l6ZV94IC0gMSk7CiAgICAgICAgaWYgKHJpZ2h0X2NvbCA+IHRoaXMuY29scykgewogICAgICAgICAgICBjb2wgPSBjb2wgLSAocmlnaHRfY29sIC0gY29sKTsKICAgICAgICB9CgogICAgICAgIHZhciBtb3ZlZF9kb3duID0gdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEucm93IDwgcm93OwogICAgICAgIHZhciBjaGFuZ2VkX2NvbHVtbiA9IHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhLmNvbCAhPT0gY29sOwoKICAgICAgICB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2wgPSBjb2w7CiAgICAgICAgdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEucm93ID0gcm93OwoKICAgICAgICB0aGlzLmNlbGxzX29jY3VwaWVkX2J5X3BsYWNlaG9sZGVyID0gdGhpcy5nZXRfY2VsbHNfb2NjdXBpZWQoCiAgICAgICAgICAgIHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhKTsKCiAgICAgICAgdGhpcy4kcHJldmlld19ob2xkZXIuYXR0cih7CiAgICAgICAgICAgICdkYXRhLXJvdycgOiByb3csCiAgICAgICAgICAgICdkYXRhLWNvbCcgOiBjb2wKICAgICAgICB9KTsKCiAgICAgICAgaWYgKG1vdmVkX2Rvd24gfHwgY2hhbmdlZF9jb2x1bW4pIHsKICAgICAgICAgICAgJG5leHRzLmVhY2goJC5wcm94eShmdW5jdGlvbihpLCB3aWRnZXQpIHsKICAgICAgICAgICAgICAgIHRoaXMubW92ZV93aWRnZXRfdXAoCiAgICAgICAgICAgICAgICAgJCh3aWRnZXQpLCB0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YS5jb2wgLSBjb2wgKyBwaGdkLnNpemVfeSk7CiAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICB9CgogICAgICAgIHZhciAkd2lkZ2V0c191bmRlcl9waCA9IHRoaXMuZ2V0X3dpZGdldHNfdW5kZXJfcGxheWVyKAogICAgICAgICAgICB0aGlzLmNlbGxzX29jY3VwaWVkX2J5X3BsYWNlaG9sZGVyKTsKCiAgICAgICAgaWYgKCR3aWRnZXRzX3VuZGVyX3BoLmxlbmd0aCkgewogICAgICAgICAgICAkd2lkZ2V0c191bmRlcl9waC5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgd2lkZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgJHcgPSAkKHdpZGdldCk7CiAgICAgICAgICAgICAgICB0aGlzLm1vdmVfd2lkZ2V0X2Rvd24oCiAgICAgICAgICAgICAgICAgJHcsIHJvdyArIHBoZ2Quc2l6ZV95IC0gJHcuZGF0YSgnY29vcmRzJykuZ3JpZC5yb3cpOwogICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgfQoKICAgIH07CgoKICAgIC8qKgogICAgKiBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHBsYXllciBjYW4gbW92ZSB0byBhIHBvc2l0aW9uIGFib3ZlLgogICAgKgogICAgKiBAbWV0aG9kIGNhbl9nb19wbGF5ZXJfdXAKICAgICogQHBhcmFtIHtPYmplY3R9IHdpZGdldF9ncmlkX2RhdGEgVGhlIGFjdHVhbCBncmlkIGNvb3JkcyBvYmplY3Qgb2YgdGhlCiAgICAqICBwbGF5ZXIuCiAgICAqIEByZXR1cm4ge051bWJlcnxCb29sZWFufSBJZiB0aGUgcGxheWVyIGNhbiBiZSBtb3ZlZCB0byBhbiB1cHBlciByb3cKICAgICogIHJldHVybnMgdGhlIHJvdyBudW1iZXIsIGVsc2UgcmV0dXJucyBmYWxzZS4KICAgICovCiAgICBmbi5jYW5fZ29fcGxheWVyX3VwID0gZnVuY3Rpb24od2lkZ2V0X2dyaWRfZGF0YSkgewogICAgICAgIHZhciBwX2JvdHRvbV9yb3cgPSB3aWRnZXRfZ3JpZF9kYXRhLnJvdyArIHdpZGdldF9ncmlkX2RhdGEuc2l6ZV95IC0gMTsKICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKICAgICAgICB2YXIgdXBwZXJfcm93cyA9IFtdOwogICAgICAgIHZhciBtaW5fcm93ID0gMTAwMDA7CiAgICAgICAgdmFyICR3aWRnZXRzX3VuZGVyX3BsYXllciA9IHRoaXMuZ2V0X3dpZGdldHNfdW5kZXJfcGxheWVyKCk7CgogICAgICAgIC8qIGdlbmVyYXRlIGFuIGFycmF5IHdpdGggY29sdW1ucyBhcyBpbmRleCBhbmQgYXJyYXkgd2l0aCB1cHBlciByb3dzCiAgICAgICAgICogZW1wdHkgYXMgdmFsdWUgKi8KICAgICAgICB0aGlzLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZCh3aWRnZXRfZ3JpZF9kYXRhLCBmdW5jdGlvbih0Y29sKSB7CiAgICAgICAgICAgIHZhciBncmlkX2NvbCA9IHRoaXMuZ3JpZG1hcFt0Y29sXTsKICAgICAgICAgICAgdmFyIHIgPSBwX2JvdHRvbV9yb3cgKyAxOwogICAgICAgICAgICB1cHBlcl9yb3dzW3Rjb2xdID0gW107CgogICAgICAgICAgICB3aGlsZSAoLS1yID4gMCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNfZW1wdHkodGNvbCwgcikgfHwgdGhpcy5pc19wbGF5ZXIodGNvbCwgcikgfHwKICAgICAgICAgICAgICAgICAgICB0aGlzLmlzX3dpZGdldCh0Y29sLCByKSAmJgogICAgICAgICAgICAgICAgICAgIGdyaWRfY29sW3JdLmlzKCR3aWRnZXRzX3VuZGVyX3BsYXllcikKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgIHVwcGVyX3Jvd3NbdGNvbF0ucHVzaChyKTsKICAgICAgICAgICAgICAgICAgICBtaW5fcm93ID0gciA8IG1pbl9yb3cgPyByIDogbWluX3JvdzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh1cHBlcl9yb3dzW3Rjb2xdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsgLy9icmVhawogICAgICAgICAgICB9CgogICAgICAgICAgICB1cHBlcl9yb3dzW3Rjb2xdLnNvcnQoZnVuY3Rpb24oYSwgYikgewogICAgICAgICAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCFyZXN1bHQpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIHJldHVybiB0aGlzLmdldF92YWxpZF9yb3dzKHdpZGdldF9ncmlkX2RhdGEsIHVwcGVyX3Jvd3MsIG1pbl9yb3cpOwogICAgfTsKCgogICAgLyoqCiAgICAqIERldGVybWluZXMgd2hldGhlciBhIHdpZGdldCBjYW4gbW92ZSB0byBhIHBvc2l0aW9uIGFib3ZlLgogICAgKgogICAgKiBAbWV0aG9kIGNhbl9nb193aWRnZXRfdXAKICAgICogQHBhcmFtIHtPYmplY3R9IHdpZGdldF9ncmlkX2RhdGEgVGhlIGFjdHVhbCBncmlkIGNvb3JkcyBvYmplY3Qgb2YgdGhlCiAgICAqICB3aWRnZXQgd2Ugd2FudCB0byBjaGVjay4KICAgICogQHJldHVybiB7TnVtYmVyfEJvb2xlYW59IElmIHRoZSB3aWRnZXQgY2FuIGJlIG1vdmVkIHRvIGFuIHVwcGVyIHJvdwogICAgKiAgcmV0dXJucyB0aGUgcm93IG51bWJlciwgZWxzZSByZXR1cm5zIGZhbHNlLgogICAgKi8KICAgIGZuLmNhbl9nb193aWRnZXRfdXAgPSBmdW5jdGlvbih3aWRnZXRfZ3JpZF9kYXRhKSB7CiAgICAgICAgdmFyIHBfYm90dG9tX3JvdyA9IHdpZGdldF9ncmlkX2RhdGEucm93ICsgd2lkZ2V0X2dyaWRfZGF0YS5zaXplX3kgLSAxOwogICAgICAgIHZhciByZXN1bHQgPSB0cnVlOwogICAgICAgIHZhciB1cHBlcl9yb3dzID0gW107CiAgICAgICAgdmFyIG1pbl9yb3cgPSAxMDAwMDsKCiAgICAgICAgLyogZ2VuZXJhdGUgYW4gYXJyYXkgd2l0aCBjb2x1bW5zIGFzIGluZGV4IGFuZCBhcnJheSB3aXRoIHRvcG1vc3Qgcm93cwogICAgICAgICAqIGVtcHR5IGFzIHZhbHVlICovCiAgICAgICAgdGhpcy5mb3JfZWFjaF9jb2x1bW5fb2NjdXBpZWQod2lkZ2V0X2dyaWRfZGF0YSwgZnVuY3Rpb24odGNvbCkgewogICAgICAgICAgICB2YXIgZ3JpZF9jb2wgPSB0aGlzLmdyaWRtYXBbdGNvbF07CiAgICAgICAgICAgIHVwcGVyX3Jvd3NbdGNvbF0gPSBbXTsKCiAgICAgICAgICAgIHZhciByID0gcF9ib3R0b21fcm93ICsgMTsKICAgICAgICAgICAgLy8gaXRlcmF0ZSBvdmVyIGVhY2ggcm93CiAgICAgICAgICAgIHdoaWxlICgtLXIgPiAwKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc193aWRnZXQodGNvbCwgcikgJiYgIXRoaXMuaXNfcGxheWVyX2luKHRjb2wsIHIpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFncmlkX2NvbFtyXS5pcyh3aWRnZXRfZ3JpZF9kYXRhLmVsKSkgewogICAgICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmlzX3BsYXllcih0Y29sLCByKSAmJgogICAgICAgICAgICAgICAgICAgICF0aGlzLmlzX3BsYWNlaG9sZGVyX2luKHRjb2wsIHIpICYmCiAgICAgICAgICAgICAgICAgICAgIXRoaXMuaXNfcGxheWVyX2luKHRjb2wsIHIpKSB7CiAgICAgICAgICAgICAgICAgICAgdXBwZXJfcm93c1t0Y29sXS5wdXNoKHIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmIChyIDwgbWluX3JvdykgewogICAgICAgICAgICAgICAgICAgIG1pbl9yb3cgPSByOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAodXBwZXJfcm93c1t0Y29sXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IGZhbHNlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7IC8vYnJlYWsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdXBwZXJfcm93c1t0Y29sXS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgICAgICAgICAgIHJldHVybiBhIC0gYjsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CgogICAgICAgIGlmICghcmVzdWx0KSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICByZXR1cm4gdGhpcy5nZXRfdmFsaWRfcm93cyh3aWRnZXRfZ3JpZF9kYXRhLCB1cHBlcl9yb3dzLCBtaW5fcm93KTsKICAgIH07CgoKICAgIC8qKgogICAgKiBTZWFyY2ggYSB2YWxpZCByb3cgZm9yIHRoZSB3aWRnZXQgcmVwcmVzZW50ZWQgYnkgYHdpZGdldF9ncmlkX2RhdGEnIGluCiAgICAqIHRoZSBgdXBwZXJfcm93c2AgYXJyYXkuIEl0ZXJhdGlvbiBzdGFydHMgZnJvbSByb3cgc3BlY2lmaWVkIGluIGBtaW5fcm93YC4KICAgICoKICAgICogQG1ldGhvZCBnZXRfdmFsaWRfcm93cwogICAgKiBAcGFyYW0ge09iamVjdH0gd2lkZ2V0X2dyaWRfZGF0YSBUaGUgYWN0dWFsIGdyaWQgY29vcmRzIG9iamVjdCBvZiB0aGUKICAgICogIHBsYXllci4KICAgICogQHBhcmFtIHtBcnJheX0gdXBwZXJfcm93cyBBbiBhcnJheSB3aXRoIGNvbHVtbnMgYXMgaW5kZXggYW5kIGFycmF5cwogICAgKiAgb2YgdmFsaWQgcm93cyBhcyB2YWx1ZXMuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBtaW5fcm93IFRoZSB1cHBlciByb3cgZnJvbSB3aGljaCB0aGUgaXRlcmF0aW9uIHdpbGwgc3RhcnQuCiAgICAqIEByZXR1cm4ge051bWJlcnxCb29sZWFufSBSZXR1cm5zIHRoZSB1cHBlciByb3cgdmFsaWQgZnJvbSB0aGUgYHVwcGVyX3Jvd3NgCiAgICAqICBmb3IgdGhlIHdpZGdldCBpbiBxdWVzdGlvbi4KICAgICovCiAgICBmbi5nZXRfdmFsaWRfcm93cyA9IGZ1bmN0aW9uKHdpZGdldF9ncmlkX2RhdGEsIHVwcGVyX3Jvd3MsIG1pbl9yb3cpIHsKICAgICAgICB2YXIgcF90b3Bfcm93ID0gd2lkZ2V0X2dyaWRfZGF0YS5yb3c7CiAgICAgICAgdmFyIHBfYm90dG9tX3JvdyA9IHdpZGdldF9ncmlkX2RhdGEucm93ICsgd2lkZ2V0X2dyaWRfZGF0YS5zaXplX3kgLSAxOwogICAgICAgIHZhciBzaXplX3kgPSB3aWRnZXRfZ3JpZF9kYXRhLnNpemVfeTsKICAgICAgICB2YXIgciA9IG1pbl9yb3cgLSAxOwogICAgICAgIHZhciB2YWxpZF9yb3dzID0gW107CgogICAgICAgIHdoaWxlICgrK3IgPD0gcF9ib3R0b21fcm93ICkgewogICAgICAgICAgICB2YXIgY29tbW9uID0gdHJ1ZTsKICAgICAgICAgICAgJC5lYWNoKHVwcGVyX3Jvd3MsIGZ1bmN0aW9uKGNvbCwgcm93cykgewogICAgICAgICAgICAgICAgaWYgKCQuaXNBcnJheShyb3dzKSAmJiAkLmluQXJyYXkociwgcm93cykgPT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgY29tbW9uID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgaWYgKGNvbW1vbiA9PT0gdHJ1ZSkgewogICAgICAgICAgICAgICAgdmFsaWRfcm93cy5wdXNoKHIpOwogICAgICAgICAgICAgICAgaWYgKHZhbGlkX3Jvd3MubGVuZ3RoID09PSBzaXplX3kpIHsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgdmFyIG5ld19yb3cgPSBmYWxzZTsKICAgICAgICBpZiAoc2l6ZV95ID09PSAxKSB7CiAgICAgICAgICAgIGlmICh2YWxpZF9yb3dzWzBdICE9PSBwX3RvcF9yb3cpIHsKICAgICAgICAgICAgICAgIG5ld19yb3cgPSB2YWxpZF9yb3dzWzBdIHx8IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKHZhbGlkX3Jvd3NbMF0gIT09IHBfdG9wX3JvdykgewogICAgICAgICAgICAgICAgbmV3X3JvdyA9IHRoaXMuZ2V0X2NvbnNlY3V0aXZlX251bWJlcnNfaW5kZXgoCiAgICAgICAgICAgICAgICAgICAgdmFsaWRfcm93cywgc2l6ZV95KTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIG5ld19yb3c7CiAgICB9OwoKCiAgICBmbi5nZXRfY29uc2VjdXRpdmVfbnVtYmVyc19pbmRleCA9IGZ1bmN0aW9uKGFyciwgc2l6ZV95KSB7CiAgICAgICAgdmFyIG1heCA9IGFyci5sZW5ndGg7CiAgICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICAgIHZhciBmaXJzdCA9IHRydWU7CiAgICAgICAgdmFyIHByZXYgPSAtMTsgLy8gb3IgbnVsbD8KCiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgbWF4OyBpKyspIHsKICAgICAgICAgICAgaWYgKGZpcnN0IHx8IGFycltpXSA9PT0gcHJldiArIDEpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGkpOwogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IHNpemVfeSkgewogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZmlyc3QgPSBmYWxzZTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc3VsdCA9IFtdOwogICAgICAgICAgICAgICAgZmlyc3QgPSB0cnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwcmV2ID0gYXJyW2ldOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPj0gc2l6ZV95ID8gYXJyW3Jlc3VsdFswXV0gOiBmYWxzZTsKICAgIH07CgoKICAgIC8qKgogICAgKiBHZXQgd2lkZ2V0cyBvdmVybGFwcGluZyB3aXRoIHRoZSBwbGF5ZXIuCiAgICAqCiAgICAqIEBtZXRob2QgZ2V0X3dpZGdldHNfb3ZlcmxhcHBlZAogICAgKiBAcmV0dXJuIHtqUXVlcnl9IFJldHVybnMgYSBqUXVlcnkgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqLwogICAgZm4uZ2V0X3dpZGdldHNfb3ZlcmxhcHBlZCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciAkdzsKICAgICAgICB2YXIgJHdpZGdldHMgPSAkKFtdKTsKICAgICAgICB2YXIgdXNlZCA9IFtdOwogICAgICAgIHZhciByb3dzX2Zyb21fYm90dG9tID0gdGhpcy5jZWxsc19vY2N1cGllZF9ieV9wbGF5ZXIucm93cy5zbGljZSgwKTsKICAgICAgICByb3dzX2Zyb21fYm90dG9tLnJldmVyc2UoKTsKCiAgICAgICAgJC5lYWNoKHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyLmNvbHMsICQucHJveHkoZnVuY3Rpb24oaSwgY29sKSB7CiAgICAgICAgICAgICQuZWFjaChyb3dzX2Zyb21fYm90dG9tLCAkLnByb3h5KGZ1bmN0aW9uKGksIHJvdykgewogICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUgaXMgYSB3aWRnZXQgaW4gdGhlIHBsYXllciBwb3NpdGlvbgogICAgICAgICAgICAgICAgaWYgKCF0aGlzLmdyaWRtYXBbY29sXSkgeyByZXR1cm4gdHJ1ZTsgfSAvL25leHQgaXRlcmF0aW9uCiAgICAgICAgICAgICAgICB2YXIgJHcgPSB0aGlzLmdyaWRtYXBbY29sXVtyb3ddOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNfb2NjdXBpZWQoY29sLCByb3cpICYmICF0aGlzLmlzX3BsYXllcigkdykgJiYKICAgICAgICAgICAgICAgICAgICAkLmluQXJyYXkoJHcsIHVzZWQpID09PSAtMQogICAgICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICAgICAgJHdpZGdldHMgPSAkd2lkZ2V0cy5hZGQoJHcpOwogICAgICAgICAgICAgICAgICAgIHVzZWQucHVzaCgkdyk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9LCB0aGlzKSk7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICByZXR1cm4gJHdpZGdldHM7CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBjYWxsYmFjayBpcyBleGVjdXRlZCB3aGVuIHRoZSBwbGF5ZXIgYmVnaW5zIHRvIGNvbGxpZGUgd2l0aCBhIGNvbHVtbi4KICAgICoKICAgICogQG1ldGhvZCBvbl9zdGFydF9vdmVybGFwcGluZ19jb2x1bW4KICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sbGlkZWQgY29sdW1uLgogICAgKiBAcmV0dXJuIHtqUXVlcnl9IFJldHVybnMgYSBqUXVlcnkgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqLwogICAgZm4ub25fc3RhcnRfb3ZlcmxhcHBpbmdfY29sdW1uID0gZnVuY3Rpb24oY29sKSB7CiAgICAgICAgdGhpcy5zZXRfcGxheWVyKGNvbCwgZmFsc2UpOwogICAgfTsKCgogICAgLyoqCiAgICAqIEEgY2FsbGJhY2sgZXhlY3V0ZWQgd2hlbiB0aGUgcGxheWVyIGJlZ2lucyB0byBjb2xsaWRlIHdpdGggYSByb3cuCiAgICAqCiAgICAqIEBtZXRob2Qgb25fc3RhcnRfb3ZlcmxhcHBpbmdfcm93CiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIGNvbGxpZGVkIHJvdy4KICAgICogQHJldHVybiB7alF1ZXJ5fSBSZXR1cm5zIGEgalF1ZXJ5IGNvbGxlY3Rpb24gb2YgSFRNTEVsZW1lbnRzLgogICAgKi8KICAgIGZuLm9uX3N0YXJ0X292ZXJsYXBwaW5nX3JvdyA9IGZ1bmN0aW9uKHJvdykgewogICAgICAgIHRoaXMuc2V0X3BsYXllcihmYWxzZSwgcm93KTsKICAgIH07CgoKICAgIC8qKgogICAgKiBBIGNhbGxiYWNrIGV4ZWN1dGVkIHdoZW4gdGhlIHRoZSBwbGF5ZXIgZW5kcyB0byBjb2xsaWRlIHdpdGggYSBjb2x1bW4uCiAgICAqCiAgICAqIEBtZXRob2Qgb25fc3RvcF9vdmVybGFwcGluZ19jb2x1bW4KICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgY29sbGlkZWQgcm93LgogICAgKiBAcmV0dXJuIHtqUXVlcnl9IFJldHVybnMgYSBqUXVlcnkgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqLwogICAgZm4ub25fc3RvcF9vdmVybGFwcGluZ19jb2x1bW4gPSBmdW5jdGlvbihjb2wpIHsKICAgICAgICB0aGlzLnNldF9wbGF5ZXIoY29sLCBmYWxzZSk7CgogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB0aGlzLmZvcl9lYWNoX3dpZGdldF9iZWxvdyhjb2wsIHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyLnJvd3NbMF0sCiAgICAgICAgICAgIGZ1bmN0aW9uKHRjb2wsIHRyb3cpIHsKICAgICAgICAgICAgICAgIHNlbGYubW92ZV93aWRnZXRfdXAodGhpcywgc2VsZi5wbGF5ZXJfZ3JpZF9kYXRhLnNpemVfeSk7CiAgICAgICAgfSk7CiAgICB9OwoKCiAgICAvKioKICAgICogVGhpcyBjYWxsYmFjayBpcyBleGVjdXRlZCB3aGVuIHRoZSBwbGF5ZXIgZW5kcyB0byBjb2xsaWRlIHdpdGggYSByb3cuCiAgICAqCiAgICAqIEBtZXRob2Qgb25fc3RvcF9vdmVybGFwcGluZ19yb3cKICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvdyBUaGUgY29sbGlkZWQgcm93LgogICAgKiBAcmV0dXJuIHtqUXVlcnl9IFJldHVybnMgYSBqUXVlcnkgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqLwogICAgZm4ub25fc3RvcF9vdmVybGFwcGluZ19yb3cgPSBmdW5jdGlvbihyb3cpIHsKICAgICAgICB0aGlzLnNldF9wbGF5ZXIoZmFsc2UsIHJvdyk7CgogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgY29scyA9IHRoaXMuY2VsbHNfb2NjdXBpZWRfYnlfcGxheWVyLmNvbHM7CiAgICAgICAgZm9yICh2YXIgYyA9IDAsIGNsID0gY29scy5sZW5ndGg7IGMgPCBjbDsgYysrKSB7CiAgICAgICAgICAgIHRoaXMuZm9yX2VhY2hfd2lkZ2V0X2JlbG93KGNvbHNbY10sIHJvdywgZnVuY3Rpb24odGNvbCwgdHJvdykgewogICAgICAgICAgICAgICAgc2VsZi5tb3ZlX3dpZGdldF91cCh0aGlzLCBzZWxmLnBsYXllcl9ncmlkX2RhdGEuc2l6ZV95KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfTsKCgogICAgLyoqCiAgICAqIE1vdmUgYSB3aWRnZXQgdG8gYSBzcGVjaWZpYyByb3cuIFRoZSBjZWxsIG9yIGNlbGxzIG11c3QgYmUgZW1wdHkuCiAgICAqIElmIHRoZSB3aWRnZXQgaGFzIHdpZGdldHMgYmVsb3csIGFsbCBvZiB0aGVzZSB3aWRnZXRzIHdpbGwgYmUgbW92ZWQgYWxzbwogICAgKiBpZiB0aGV5IGNhbi4KICAgICoKICAgICogQG1ldGhvZCBtb3ZlX3dpZGdldF90bwogICAgKiBAcGFyYW0ge0hUTUxFbGVtZW50fSAkd2lkZ2V0IFRoZSBqUXVlcnkgd3JhcHBlZCBIVE1MRWxlbWVudCBvZiB0aGUKICAgICogd2lkZ2V0IGlzIGdvaW5nIHRvIGJlIG1vdmVkLgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLm1vdmVfd2lkZ2V0X3RvID0gZnVuY3Rpb24oJHdpZGdldCwgcm93KSB7CiAgICAgICAgdmFyIHNlbGYgPSB0aGlzOwogICAgICAgIHZhciB3aWRnZXRfZ3JpZF9kYXRhID0gJHdpZGdldC5jb29yZHMoKS5ncmlkOwogICAgICAgIHZhciBkaWZmID0gcm93IC0gd2lkZ2V0X2dyaWRfZGF0YS5yb3c7CiAgICAgICAgdmFyICRuZXh0X3dpZGdldHMgPSB0aGlzLndpZGdldHNfYmVsb3coJHdpZGdldCk7CgogICAgICAgIHZhciBjYW5fbW92ZV90b19uZXdfY2VsbCA9IHRoaXMuY2FuX21vdmVfdG8oCiAgICAgICAgICAgIHdpZGdldF9ncmlkX2RhdGEsIHdpZGdldF9ncmlkX2RhdGEuY29sLCByb3csICR3aWRnZXQpOwoKICAgICAgICBpZiAoY2FuX21vdmVfdG9fbmV3X2NlbGwgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMucmVtb3ZlX2Zyb21fZ3JpZG1hcCh3aWRnZXRfZ3JpZF9kYXRhKTsKICAgICAgICB3aWRnZXRfZ3JpZF9kYXRhLnJvdyA9IHJvdzsKICAgICAgICB0aGlzLmFkZF90b19ncmlkbWFwKHdpZGdldF9ncmlkX2RhdGEpOwogICAgICAgICR3aWRnZXQuYXR0cignZGF0YS1yb3cnLCByb3cpOwogICAgICAgIHRoaXMuJGNoYW5nZWQgPSB0aGlzLiRjaGFuZ2VkLmFkZCgkd2lkZ2V0KTsKCgogICAgICAgICRuZXh0X3dpZGdldHMuZWFjaChmdW5jdGlvbihpLCB3aWRnZXQpIHsKICAgICAgICAgICAgdmFyICR3ID0gJCh3aWRnZXQpOwogICAgICAgICAgICB2YXIgd2dkID0gJHcuY29vcmRzKCkuZ3JpZDsKICAgICAgICAgICAgdmFyIGNhbl9nb191cCA9IHNlbGYuY2FuX2dvX3dpZGdldF91cCh3Z2QpOwogICAgICAgICAgICBpZiAoY2FuX2dvX3VwICYmIGNhbl9nb191cCAhPT0gd2dkLnJvdykgewogICAgICAgICAgICAgICAgc2VsZi5tb3ZlX3dpZGdldF90bygkdywgY2FuX2dvX3VwKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBNb3ZlIHVwIHRoZSBzcGVjaWZpZWQgd2lkZ2V0IGFuZCBhbGwgYmVsb3cgaXQuCiAgICAqCiAgICAqIEBtZXRob2QgbW92ZV93aWRnZXRfdXAKICAgICogQHBhcmFtIHtIVE1MRWxlbWVudH0gJHdpZGdldCBUaGUgd2lkZ2V0IHlvdSB3YW50IHRvIG1vdmUuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBbeV91bml0c10gVGhlIG51bWJlciBvZiBjZWxscyB0aGF0IHRoZSB3aWRnZXQgaGFzIHRvIG1vdmUuCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4ubW92ZV93aWRnZXRfdXAgPSBmdW5jdGlvbigkd2lkZ2V0LCB5X3VuaXRzKSB7CiAgICAgICAgdmFyIGVsX2dyaWRfZGF0YSA9ICR3aWRnZXQuY29vcmRzKCkuZ3JpZDsKICAgICAgICB2YXIgYWN0dWFsX3JvdyA9IGVsX2dyaWRfZGF0YS5yb3c7CiAgICAgICAgdmFyIG1vdmVkID0gW107CiAgICAgICAgdmFyIGNhbl9nb191cCA9IHRydWU7CiAgICAgICAgeV91bml0cyB8fCAoeV91bml0cyA9IDEpOwoKICAgICAgICBpZiAoIXRoaXMuY2FuX2dvX3VwKCR3aWRnZXQpKSB7IHJldHVybiBmYWxzZTsgfSAvL2JyZWFrOwoKICAgICAgICB0aGlzLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZChlbF9ncmlkX2RhdGEsIGZ1bmN0aW9uKGNvbCkgewogICAgICAgICAgICAvLyBjYW5fZ29fdXAKICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkd2lkZ2V0LCBtb3ZlZCkgPT09IC0xKSB7CiAgICAgICAgICAgICAgICB2YXIgd2lkZ2V0X2dyaWRfZGF0YSA9ICR3aWRnZXQuY29vcmRzKCkuZ3JpZDsKICAgICAgICAgICAgICAgIHZhciBuZXh0X3JvdyA9IGFjdHVhbF9yb3cgLSB5X3VuaXRzOwogICAgICAgICAgICAgICAgbmV4dF9yb3cgPSB0aGlzLmNhbl9nb191cF90b19yb3coCiAgICAgICAgICAgICAgICAgICAgd2lkZ2V0X2dyaWRfZGF0YSwgY29sLCBuZXh0X3Jvdyk7CgogICAgICAgICAgICAgICAgaWYgKCFuZXh0X3JvdykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHZhciAkbmV4dF93aWRnZXRzID0gdGhpcy53aWRnZXRzX2JlbG93KCR3aWRnZXQpOwoKICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlX2Zyb21fZ3JpZG1hcCh3aWRnZXRfZ3JpZF9kYXRhKTsKICAgICAgICAgICAgICAgIHdpZGdldF9ncmlkX2RhdGEucm93ID0gbmV4dF9yb3c7CiAgICAgICAgICAgICAgICB0aGlzLmFkZF90b19ncmlkbWFwKHdpZGdldF9ncmlkX2RhdGEpOwogICAgICAgICAgICAgICAgJHdpZGdldC5hdHRyKCdkYXRhLXJvdycsIHdpZGdldF9ncmlkX2RhdGEucm93KTsKICAgICAgICAgICAgICAgIHRoaXMuJGNoYW5nZWQgPSB0aGlzLiRjaGFuZ2VkLmFkZCgkd2lkZ2V0KTsKCiAgICAgICAgICAgICAgICBtb3ZlZC5wdXNoKCR3aWRnZXQpOwoKICAgICAgICAgICAgICAgICRuZXh0X3dpZGdldHMuZWFjaCgkLnByb3h5KGZ1bmN0aW9uKGksIHdpZGdldCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubW92ZV93aWRnZXRfdXAoJCh3aWRnZXQpLCB5X3VuaXRzKTsKICAgICAgICAgICAgICAgIH0sIHRoaXMpKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoKICAgIH07CgoKICAgIC8qKgogICAgKiBNb3ZlIGRvd24gdGhlIHNwZWNpZmllZCB3aWRnZXQgYW5kIGFsbCBiZWxvdyBpdC4KICAgICoKICAgICogQG1ldGhvZCBtb3ZlX3dpZGdldF9kb3duCiAgICAqIEBwYXJhbSB7alF1ZXJ5fSAkd2lkZ2V0IFRoZSBqUXVlcnkgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgd2lkZ2V0CiAgICAqICB5b3Ugd2FudCB0byBtb3ZlLgogICAgKiBAcGFyYW0ge051bWJlcn0geV91bml0cyBUaGUgbnVtYmVyIG9mIGNlbGxzIHRoYXQgdGhlIHdpZGdldCBoYXMgdG8gbW92ZS4KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5tb3ZlX3dpZGdldF9kb3duID0gZnVuY3Rpb24oJHdpZGdldCwgeV91bml0cykgewogICAgICAgIHZhciBlbF9ncmlkX2RhdGEsIGFjdHVhbF9yb3csIG1vdmVkLCB5X2RpZmY7CgogICAgICAgIGlmICh5X3VuaXRzIDw9IDApIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIGVsX2dyaWRfZGF0YSA9ICR3aWRnZXQuY29vcmRzKCkuZ3JpZDsKICAgICAgICBhY3R1YWxfcm93ID0gZWxfZ3JpZF9kYXRhLnJvdzsKICAgICAgICBtb3ZlZCA9IFtdOwogICAgICAgIHlfZGlmZiA9IHlfdW5pdHM7CgogICAgICAgIGlmICghJHdpZGdldCkgeyByZXR1cm4gZmFsc2U7IH0KCiAgICAgICAgaWYgKCQuaW5BcnJheSgkd2lkZ2V0LCBtb3ZlZCkgPT09IC0xKSB7CgogICAgICAgICAgICB2YXIgd2lkZ2V0X2dyaWRfZGF0YSA9ICR3aWRnZXQuY29vcmRzKCkuZ3JpZDsKICAgICAgICAgICAgdmFyIG5leHRfcm93ID0gYWN0dWFsX3JvdyArIHlfdW5pdHM7CiAgICAgICAgICAgIHZhciAkbmV4dF93aWRnZXRzID0gdGhpcy53aWRnZXRzX2JlbG93KCR3aWRnZXQpOwoKICAgICAgICAgICAgdGhpcy5yZW1vdmVfZnJvbV9ncmlkbWFwKHdpZGdldF9ncmlkX2RhdGEpOwoKICAgICAgICAgICAgJG5leHRfd2lkZ2V0cy5lYWNoKCQucHJveHkoZnVuY3Rpb24oaSwgd2lkZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgJHcgPSAkKHdpZGdldCk7CiAgICAgICAgICAgICAgICB2YXIgd2QgPSAkdy5jb29yZHMoKS5ncmlkOwogICAgICAgICAgICAgICAgdmFyIHRtcF95ID0gdGhpcy5kaXNwbGFjZW1lbnRfZGlmZigKICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3ZCwgd2lkZ2V0X2dyaWRfZGF0YSwgeV9kaWZmKTsKCiAgICAgICAgICAgICAgICBpZiAodG1wX3kgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb3ZlX3dpZGdldF9kb3duKCR3LCB0bXBfeSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sIHRoaXMpKTsKCiAgICAgICAgICAgIHdpZGdldF9ncmlkX2RhdGEucm93ID0gbmV4dF9yb3c7CiAgICAgICAgICAgIHRoaXMudXBkYXRlX3dpZGdldF9wb3NpdGlvbih3aWRnZXRfZ3JpZF9kYXRhLCAkd2lkZ2V0KTsKICAgICAgICAgICAgJHdpZGdldC5hdHRyKCdkYXRhLXJvdycsIHdpZGdldF9ncmlkX2RhdGEucm93KTsKICAgICAgICAgICAgdGhpcy4kY2hhbmdlZCA9IHRoaXMuJGNoYW5nZWQuYWRkKCR3aWRnZXQpOwoKICAgICAgICAgICAgbW92ZWQucHVzaCgkd2lkZ2V0KTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICogQ2hlY2sgaWYgdGhlIHdpZGdldCBjYW4gbW92ZSB0byB0aGUgc3BlY2lmaWVkIHJvdywgZWxzZSByZXR1cm5zIHRoZQogICAgKiB1cHBlciByb3cgcG9zc2libGUuCiAgICAqCiAgICAqIEBtZXRob2QgY2FuX2dvX3VwX3RvX3JvdwogICAgKiBAcGFyYW0ge051bWJlcn0gd2lkZ2V0X2dyaWRfZGF0YSBUaGUgY3VycmVudCBncmlkIGNvb3JkcyBvYmplY3Qgb2YgdGhlCiAgICAqICB3aWRnZXQuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIHRhcmdldCBjb2x1bW4uCiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHRhcmdldCByb3cuCiAgICAqIEByZXR1cm4ge0Jvb2xlYW58TnVtYmVyfSBSZXR1cm5zIHRoZSByb3cgbnVtYmVyIGlmIHRoZSB3aWRnZXQgY2FuIG1vdmUKICAgICogIHRvIHRoZSB0YXJnZXQgcG9zaXRpb24sIGVsc2UgcmV0dXJucyBmYWxzZS4KICAgICovCiAgICBmbi5jYW5fZ29fdXBfdG9fcm93ID0gZnVuY3Rpb24od2lkZ2V0X2dyaWRfZGF0YSwgY29sLCByb3cpIHsKICAgICAgICB2YXIgZ2EgPSB0aGlzLmdyaWRtYXA7CiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgdmFyIHVyYyA9IFtdOyAvLyB1cHBlcl9yb3dzX2luX2NvbHVtbnMKICAgICAgICB2YXIgYWN0dWFsX3JvdyA9IHdpZGdldF9ncmlkX2RhdGEucm93OwogICAgICAgIHZhciByOwoKICAgICAgICAvKiBnZW5lcmF0ZSBhbiBhcnJheSB3aXRoIGNvbHVtbnMgYXMgaW5kZXggYW5kIGFycmF5IHdpdGgKICAgICAgICAgKiB1cHBlciByb3dzIGVtcHR5IGluIHRoZSBjb2x1bW4gKi8KICAgICAgICB0aGlzLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZCh3aWRnZXRfZ3JpZF9kYXRhLCBmdW5jdGlvbih0Y29sKSB7CiAgICAgICAgICAgIHZhciBncmlkX2NvbCA9IGdhW3Rjb2xdOwogICAgICAgICAgICB1cmNbdGNvbF0gPSBbXTsKCiAgICAgICAgICAgIHIgPSBhY3R1YWxfcm93OwogICAgICAgICAgICB3aGlsZSAoci0tKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc19lbXB0eSh0Y29sLCByKSAmJgogICAgICAgICAgICAgICAgICAgICF0aGlzLmlzX3BsYWNlaG9sZGVyX2luKHRjb2wsIHIpCiAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICB1cmNbdGNvbF0ucHVzaChyKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICghdXJjW3Rjb2xdLmxlbmd0aCkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICB9KTsKCiAgICAgICAgaWYgKCFyZXN1bHQpIHsgcmV0dXJuIGZhbHNlOyB9CgogICAgICAgIC8qIGdldCBjb21tb24gcm93cyBzdGFydGluZyBmcm9tIHVwcGVyIHBvc2l0aW9uIGluIGFsbCB0aGUgY29sdW1ucwogICAgICAgICAqIHRoYXQgd2lkZ2V0IG9jY3VwaWVzICovCiAgICAgICAgciA9IHJvdzsKICAgICAgICBmb3IgKHIgPSAxOyByIDwgYWN0dWFsX3JvdzsgcisrKSB7CiAgICAgICAgICAgIHZhciBjb21tb24gPSB0cnVlOwoKICAgICAgICAgICAgZm9yICh2YXIgdWMgPSAwLCB1Y2wgPSB1cmMubGVuZ3RoOyB1YyA8IHVjbDsgdWMrKykgewogICAgICAgICAgICAgICAgaWYgKHVyY1t1Y10gJiYgJC5pbkFycmF5KHIsIHVyY1t1Y10pID09PSAtMSkgewogICAgICAgICAgICAgICAgICAgIGNvbW1vbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoY29tbW9uID09PSB0cnVlKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSByOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKCiAgICBmbi5kaXNwbGFjZW1lbnRfZGlmZiA9IGZ1bmN0aW9uKHdpZGdldF9ncmlkX2RhdGEsIHBhcmVudF9iZ2QsIHlfdW5pdHMpIHsKICAgICAgICB2YXIgYWN0dWFsX3JvdyA9IHdpZGdldF9ncmlkX2RhdGEucm93OwogICAgICAgIHZhciBkaWZmcyA9IFtdOwogICAgICAgIHZhciBwYXJlbnRfbWF4X3kgPSBwYXJlbnRfYmdkLnJvdyArIHBhcmVudF9iZ2Quc2l6ZV95OwoKICAgICAgICB0aGlzLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZCh3aWRnZXRfZ3JpZF9kYXRhLCBmdW5jdGlvbihjb2wpIHsKICAgICAgICAgICAgdmFyIHRlbXBfeV91bml0cyA9IDA7CgogICAgICAgICAgICBmb3IgKHZhciByID0gcGFyZW50X21heF95OyByIDwgYWN0dWFsX3JvdzsgcisrKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc19lbXB0eShjb2wsIHIpKSB7CiAgICAgICAgICAgICAgICAgICAgdGVtcF95X3VuaXRzID0gdGVtcF95X3VuaXRzICsgMTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgZGlmZnMucHVzaCh0ZW1wX3lfdW5pdHMpOwogICAgICAgIH0pOwoKICAgICAgICB2YXIgbWF4X2RpZmYgPSBNYXRoLm1heC5hcHBseShNYXRoLCBkaWZmcyk7CiAgICAgICAgeV91bml0cyA9ICh5X3VuaXRzIC0gbWF4X2RpZmYpOwoKICAgICAgICByZXR1cm4geV91bml0cyA+IDAgPyB5X3VuaXRzIDogMDsKICAgIH07CgoKICAgIC8qKgogICAgKiBHZXQgd2lkZ2V0cyBiZWxvdyBhIHdpZGdldC4KICAgICoKICAgICogQG1ldGhvZCB3aWRnZXRzX2JlbG93CiAgICAqIEBwYXJhbSB7SFRNTEVsZW1lbnR9ICRlbCBUaGUgalF1ZXJ5IHdyYXBwZWQgSFRNTEVsZW1lbnQuCiAgICAqIEByZXR1cm4ge2pRdWVyeX0gQSBqUXVlcnkgY29sbGVjdGlvbiBvZiBIVE1MRWxlbWVudHMuCiAgICAqLwogICAgZm4ud2lkZ2V0c19iZWxvdyA9IGZ1bmN0aW9uKCRlbCkgewogICAgICAgIHZhciBlbF9ncmlkX2RhdGEgPSAkLmlzUGxhaW5PYmplY3QoJGVsKSA/ICRlbCA6ICRlbC5jb29yZHMoKS5ncmlkOwogICAgICAgIHZhciBzZWxmID0gdGhpczsKICAgICAgICB2YXIgZ2EgPSB0aGlzLmdyaWRtYXA7CiAgICAgICAgdmFyIG5leHRfcm93ID0gZWxfZ3JpZF9kYXRhLnJvdyArIGVsX2dyaWRfZGF0YS5zaXplX3kgLSAxOwogICAgICAgIHZhciAkbmV4dHMgPSAkKFtdKTsKCiAgICAgICAgdGhpcy5mb3JfZWFjaF9jb2x1bW5fb2NjdXBpZWQoZWxfZ3JpZF9kYXRhLCBmdW5jdGlvbihjb2wpIHsKICAgICAgICAgICAgc2VsZi5mb3JfZWFjaF93aWRnZXRfYmVsb3coY29sLCBuZXh0X3JvdywgZnVuY3Rpb24odGNvbCwgdHJvdykgewogICAgICAgICAgICAgICAgaWYgKCFzZWxmLmlzX3BsYXllcih0aGlzKSAmJiAkLmluQXJyYXkodGhpcywgJG5leHRzKSA9PT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAkbmV4dHMgPSAkbmV4dHMuYWRkKHRoaXMpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvLyBicmVhawogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KTsKICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIEdyaWRzdGVyLnNvcnRfYnlfcm93X2FzYygkbmV4dHMpOwogICAgfTsKCgogICAgLyoqCiAgICAqIFVwZGF0ZSB0aGUgYXJyYXkgb2YgbWFwcGVkIHBvc2l0aW9ucyB3aXRoIHRoZSBuZXcgcGxheWVyIHBvc2l0aW9uLgogICAgKgogICAgKiBAbWV0aG9kIHNldF9jZWxsc19wbGF5ZXJfb2NjdXBpZXMKICAgICogQHBhcmFtIHtOdW1iZXJ9IGNvbCBUaGUgbmV3IHBsYXllciBjb2wuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIG5ldyBwbGF5ZXIgcm93LgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLnNldF9jZWxsc19wbGF5ZXJfb2NjdXBpZXMgPSBmdW5jdGlvbihjb2wsIHJvdykgewogICAgICAgIHRoaXMucmVtb3ZlX2Zyb21fZ3JpZG1hcCh0aGlzLnBsYWNlaG9sZGVyX2dyaWRfZGF0YSk7CiAgICAgICAgdGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEuY29sID0gY29sOwogICAgICAgIHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhLnJvdyA9IHJvdzsKICAgICAgICB0aGlzLmFkZF90b19ncmlkbWFwKHRoaXMucGxhY2Vob2xkZXJfZ3JpZF9kYXRhLCB0aGlzLiRwbGF5ZXIpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIFJlbW92ZSBmcm9tIHRoZSBhcnJheSBvZiBtYXBwZWQgcG9zaXRpb25zIHRoZSByZWZlcmVuY2UgdG8gdGhlIHBsYXllci4KICAgICoKICAgICogQG1ldGhvZCBlbXB0eV9jZWxsc19wbGF5ZXJfb2NjdXBpZXMKICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5lbXB0eV9jZWxsc19wbGF5ZXJfb2NjdXBpZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICB0aGlzLnJlbW92ZV9mcm9tX2dyaWRtYXAodGhpcy5wbGFjZWhvbGRlcl9ncmlkX2RhdGEpOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgZm4uY2FuX2dvX3VwID0gZnVuY3Rpb24oJGVsKSB7CiAgICAgICAgdmFyIGVsX2dyaWRfZGF0YSA9ICRlbC5jb29yZHMoKS5ncmlkOwogICAgICAgIHZhciBpbml0aWFsX3JvdyA9IGVsX2dyaWRfZGF0YS5yb3c7CiAgICAgICAgdmFyIHByZXZfcm93ID0gaW5pdGlhbF9yb3cgLSAxOwogICAgICAgIHZhciBnYSA9IHRoaXMuZ3JpZG1hcDsKICAgICAgICB2YXIgdXBwZXJfcm93c19ieV9jb2x1bW4gPSBbXTsKCiAgICAgICAgdmFyIHJlc3VsdCA9IHRydWU7CiAgICAgICAgaWYgKGluaXRpYWxfcm93ID09PSAxKSB7IHJldHVybiBmYWxzZTsgfQoKICAgICAgICB0aGlzLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZChlbF9ncmlkX2RhdGEsIGZ1bmN0aW9uKGNvbCkgewogICAgICAgICAgICB2YXIgJHcgPSB0aGlzLmlzX3dpZGdldChjb2wsIHByZXZfcm93KTsKCiAgICAgICAgICAgIGlmICh0aGlzLmlzX29jY3VwaWVkKGNvbCwgcHJldl9yb3cpIHx8CiAgICAgICAgICAgICAgICB0aGlzLmlzX3BsYXllcihjb2wsIHByZXZfcm93KSB8fAogICAgICAgICAgICAgICAgdGhpcy5pc19wbGFjZWhvbGRlcl9pbihjb2wsIHByZXZfcm93KSB8fAogICAgICAgICAgICAgICAgdGhpcy5pc19wbGF5ZXJfaW4oY29sLCBwcmV2X3JvdykKICAgICAgICAgICAgKSB7CiAgICAgICAgICAgICAgICByZXN1bHQgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOyAvL2JyZWFrCiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgoKICAgIC8qKgogICAgKiBDaGVjayBpZiBpdCdzIHBvc3NpYmxlIHRvIG1vdmUgYSB3aWRnZXQgdG8gYSBzcGVjaWZpYyBjb2wvcm93LiBJdCB0YWtlcwogICAgKiBpbnRvIGFjY291bnQgdGhlIGRpbWVuc2lvbnMgKGBzaXplX3lgIGFuZCBgc2l6ZV94YCBhdHRycy4gb2YgdGhlIGdyaWQKICAgICogIGNvb3JkcyBvYmplY3QpIHRoZSB3aWRnZXQgb2NjdXBpZXMuCiAgICAqCiAgICAqIEBtZXRob2QgY2FuX21vdmVfdG8KICAgICogQHBhcmFtIHtPYmplY3R9IHdpZGdldF9ncmlkX2RhdGEgVGhlIGdyaWQgY29vcmRzIG9iamVjdCB0aGF0IHJlcHJlc2VudHMKICAgICogIHRoZSB3aWRnZXQuCiAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb2wgVGhlIGNvbCB0byBjaGVjay4KICAgICogQHBhcmFtIHtPYmplY3R9IHJvdyBUaGUgcm93IHRvIGNoZWNrLgogICAgKiBAcGFyYW0ge051bWJlcn0gW21heF9yb3ddIFRoZSBtYXggcm93IGFsbG93ZWQuCiAgICAqIEByZXR1cm4ge0Jvb2xlYW59IFJldHVybnMgdHJ1ZSBpZiBhbGwgY2VsbHMgYXJlIGVtcHR5LCBlbHNlIHJldHVybiBmYWxzZS4KICAgICovCiAgICBmbi5jYW5fbW92ZV90byA9IGZ1bmN0aW9uKHdpZGdldF9ncmlkX2RhdGEsIGNvbCwgcm93LCBtYXhfcm93KSB7CiAgICAgICAgdmFyIGdhID0gdGhpcy5ncmlkbWFwOwogICAgICAgIHZhciAkdyA9IHdpZGdldF9ncmlkX2RhdGEuZWw7CiAgICAgICAgdmFyIGZ1dHVyZV93ZCA9IHsKICAgICAgICAgICAgc2l6ZV95OiB3aWRnZXRfZ3JpZF9kYXRhLnNpemVfeSwKICAgICAgICAgICAgc2l6ZV94OiB3aWRnZXRfZ3JpZF9kYXRhLnNpemVfeCwKICAgICAgICAgICAgY29sOiBjb2wsCiAgICAgICAgICAgIHJvdzogcm93CiAgICAgICAgfTsKICAgICAgICB2YXIgcmVzdWx0ID0gdHJ1ZTsKCiAgICAgICAgLy9QcmV2ZW50cyB3aWRnZXRzIGdvIG91dCBvZiB0aGUgZ3JpZAogICAgICAgIHZhciByaWdodF9jb2wgPSBjb2wgKyB3aWRnZXRfZ3JpZF9kYXRhLnNpemVfeCAtIDE7CiAgICAgICAgaWYgKHJpZ2h0X2NvbCA+IHRoaXMuY29scykgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICBpZiAobWF4X3JvdyAmJiBtYXhfcm93IDwgcm93ICsgd2lkZ2V0X2dyaWRfZGF0YS5zaXplX3kgLSAxKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CgogICAgICAgIHRoaXMuZm9yX2VhY2hfY2VsbF9vY2N1cGllZChmdXR1cmVfd2QsIGZ1bmN0aW9uKHRjb2wsIHRyb3cpIHsKICAgICAgICAgICAgdmFyICR0dyA9IHRoaXMuaXNfd2lkZ2V0KHRjb2wsIHRyb3cpOwogICAgICAgICAgICBpZiAoJHR3ICYmICghd2lkZ2V0X2dyaWRfZGF0YS5lbCB8fCAkdHcuaXMoJHcpKSkgewogICAgICAgICAgICAgICAgcmVzdWx0ID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKCiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH07CgoKICAgIC8qKgogICAgKiBHaXZlbiB0aGUgbGVmdG1vc3QgY29sdW1uIHJldHVybnMgYWxsIGNvbHVtbnMgdGhhdCBhcmUgb3ZlcmxhcHBpbmcKICAgICogIHdpdGggdGhlIHBsYXllci4KICAgICoKICAgICogQG1ldGhvZCBnZXRfdGFyZ2V0ZWRfY29sdW1ucwogICAgKiBAcGFyYW0ge051bWJlcn0gW2Zyb21fY29sXSBUaGUgbGVmdG1vc3QgY29sdW1uLgogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyBhbiBhcnJheSB3aXRoIGNvbHVtbiBudW1iZXJzLgogICAgKi8KICAgIGZuLmdldF90YXJnZXRlZF9jb2x1bW5zID0gZnVuY3Rpb24oZnJvbV9jb2wpIHsKICAgICAgICB2YXIgbWF4ID0gKGZyb21fY29sIHx8IHRoaXMucGxheWVyX2dyaWRfZGF0YS5jb2wpICsKICAgICAgICAgICAgKHRoaXMucGxheWVyX2dyaWRfZGF0YS5zaXplX3ggLSAxKTsKICAgICAgICB2YXIgY29scyA9IFtdOwogICAgICAgIGZvciAodmFyIGNvbCA9IGZyb21fY29sOyBjb2wgPD0gbWF4OyBjb2wrKykgewogICAgICAgICAgICBjb2xzLnB1c2goY29sKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGNvbHM7CiAgICB9OwoKCiAgICAvKioKICAgICogR2l2ZW4gdGhlIHVwcGVyIHJvdyByZXR1cm5zIGFsbCByb3dzIHRoYXQgYXJlIG92ZXJsYXBwaW5nIHdpdGggdGhlIHBsYXllci4KICAgICoKICAgICogQG1ldGhvZCBnZXRfdGFyZ2V0ZWRfcm93cwogICAgKiBAcGFyYW0ge051bWJlcn0gW2Zyb21fcm93XSBUaGUgdXBwZXIgcm93LgogICAgKiBAcmV0dXJuIHtBcnJheX0gUmV0dXJucyBhbiBhcnJheSB3aXRoIHJvdyBudW1iZXJzLgogICAgKi8KICAgIGZuLmdldF90YXJnZXRlZF9yb3dzID0gZnVuY3Rpb24oZnJvbV9yb3cpIHsKICAgICAgICB2YXIgbWF4ID0gKGZyb21fcm93IHx8IHRoaXMucGxheWVyX2dyaWRfZGF0YS5yb3cpICsKICAgICAgICAgICAgKHRoaXMucGxheWVyX2dyaWRfZGF0YS5zaXplX3kgLSAxKTsKICAgICAgICB2YXIgcm93cyA9IFtdOwogICAgICAgIGZvciAodmFyIHJvdyA9IGZyb21fcm93OyByb3cgPD0gbWF4OyByb3crKykgewogICAgICAgICAgICByb3dzLnB1c2gocm93KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJvd3M7CiAgICB9OwoKICAgIC8qKgogICAgKiBHZXQgYWxsIGNvbHVtbnMgYW5kIHJvd3MgdGhhdCBhIHdpZGdldCBvY2N1cGllcy4KICAgICoKICAgICogQG1ldGhvZCBnZXRfY2VsbHNfb2NjdXBpZWQKICAgICogQHBhcmFtIHtPYmplY3R9IGVsX2dyaWRfZGF0YSBUaGUgZ3JpZCBjb29yZHMgb2JqZWN0IG9mIHRoZSB3aWRnZXQuCiAgICAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJucyBhbiBvYmplY3QgbGlrZSBgeyBjb2xzOiBbXSwgcm93czogW119YC4KICAgICovCiAgICBmbi5nZXRfY2VsbHNfb2NjdXBpZWQgPSBmdW5jdGlvbihlbF9ncmlkX2RhdGEpIHsKICAgICAgICB2YXIgY2VsbHMgPSB7IGNvbHM6IFtdLCByb3dzOiBbXX07CiAgICAgICAgdmFyIGk7CiAgICAgICAgaWYgKGFyZ3VtZW50c1sxXSBpbnN0YW5jZW9mICQpIHsKICAgICAgICAgICAgZWxfZ3JpZF9kYXRhID0gYXJndW1lbnRzWzFdLmNvb3JkcygpLmdyaWQ7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxfZ3JpZF9kYXRhLnNpemVfeDsgaSsrKSB7CiAgICAgICAgICAgIHZhciBjb2wgPSBlbF9ncmlkX2RhdGEuY29sICsgaTsKICAgICAgICAgICAgY2VsbHMuY29scy5wdXNoKGNvbCk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZWxfZ3JpZF9kYXRhLnNpemVfeTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByb3cgPSBlbF9ncmlkX2RhdGEucm93ICsgaTsKICAgICAgICAgICAgY2VsbHMucm93cy5wdXNoKHJvdyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gY2VsbHM7CiAgICB9OwoKCiAgICAvKioKICAgICogSXRlcmF0ZSBvdmVyIHRoZSBjZWxscyBvY2N1cGllZCBieSBhIHdpZGdldCBleGVjdXRpbmcgYSBmdW5jdGlvbiBmb3IKICAgICogZWFjaCBvbmUuCiAgICAqCiAgICAqIEBtZXRob2QgZm9yX2VhY2hfY2VsbF9vY2N1cGllZAogICAgKiBAcGFyYW0ge09iamVjdH0gZWxfZ3JpZF9kYXRhIFRoZSBncmlkIGNvb3JkcyBvYmplY3QgdGhhdCByZXByZXNlbnRzIHRoZQogICAgKiAgd2lkZ2V0LgogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIGNvbHVtbgogICAgKiAgaXRlcmF0aW9uLiBDb2x1bW4gYW5kIHJvdyBhcmUgcGFzc2VkIGFzIGFyZ3VtZW50cy4KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5mb3JfZWFjaF9jZWxsX29jY3VwaWVkID0gZnVuY3Rpb24oZ3JpZF9kYXRhLCBjYWxsYmFjaykgewogICAgICAgIHRoaXMuZm9yX2VhY2hfY29sdW1uX29jY3VwaWVkKGdyaWRfZGF0YSwgZnVuY3Rpb24oY29sKSB7CiAgICAgICAgICAgIHRoaXMuZm9yX2VhY2hfcm93X29jY3VwaWVkKGdyaWRfZGF0YSwgZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgICAgICBjYWxsYmFjay5jYWxsKHRoaXMsIGNvbCwgcm93KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogSXRlcmF0ZSBvdmVyIHRoZSBjb2x1bW5zIG9jY3VwaWVkIGJ5IGEgd2lkZ2V0IGV4ZWN1dGluZyBhIGZ1bmN0aW9uIGZvcgogICAgKiBlYWNoIG9uZS4KICAgICoKICAgICogQG1ldGhvZCBmb3JfZWFjaF9jb2x1bW5fb2NjdXBpZWQKICAgICogQHBhcmFtIHtPYmplY3R9IGVsX2dyaWRfZGF0YSBUaGUgZ3JpZCBjb29yZHMgb2JqZWN0IHRoYXQgcmVwcmVzZW50cwogICAgKiAgdGhlIHdpZGdldC4KICAgICogQHBhcmFtIHtGdW5jdGlvbn0gY2FsbGJhY2sgVGhlIGZ1bmN0aW9uIHRvIGV4ZWN1dGUgb24gZWFjaCBjb2x1bW4KICAgICogIGl0ZXJhdGlvbi4gVGhlIGNvbHVtbiBudW1iZXIgaXMgcGFzc2VkIGFzIGZpcnN0IGFyZ3VtZW50LgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLmZvcl9lYWNoX2NvbHVtbl9vY2N1cGllZCA9IGZ1bmN0aW9uKGVsX2dyaWRfZGF0YSwgY2FsbGJhY2spIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVsX2dyaWRfZGF0YS5zaXplX3g7IGkrKykgewogICAgICAgICAgICB2YXIgY29sID0gZWxfZ3JpZF9kYXRhLmNvbCArIGk7CiAgICAgICAgICAgIGNhbGxiYWNrLmNhbGwodGhpcywgY29sLCBlbF9ncmlkX2RhdGEpOwogICAgICAgIH0KICAgIH07CgoKICAgIC8qKgogICAgKiBJdGVyYXRlIG92ZXIgdGhlIHJvd3Mgb2NjdXBpZWQgYnkgYSB3aWRnZXQgZXhlY3V0aW5nIGEgZnVuY3Rpb24gZm9yCiAgICAqIGVhY2ggb25lLgogICAgKgogICAgKiBAbWV0aG9kIGZvcl9lYWNoX3Jvd19vY2N1cGllZAogICAgKiBAcGFyYW0ge09iamVjdH0gZWxfZ3JpZF9kYXRhIFRoZSBncmlkIGNvb3JkcyBvYmplY3QgdGhhdCByZXByZXNlbnRzCiAgICAqICB0aGUgd2lkZ2V0LgogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIGNvbHVtbgogICAgKiAgaXRlcmF0aW9uLiBUaGUgcm93IG51bWJlciBpcyBwYXNzZWQgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAqIEByZXR1cm4ge0NsYXNzfSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgQ2xhc3MuCiAgICAqLwogICAgZm4uZm9yX2VhY2hfcm93X29jY3VwaWVkID0gZnVuY3Rpb24oZWxfZ3JpZF9kYXRhLCBjYWxsYmFjaykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxfZ3JpZF9kYXRhLnNpemVfeTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByb3cgPSBlbF9ncmlkX2RhdGEucm93ICsgaTsKICAgICAgICAgICAgY2FsbGJhY2suY2FsbCh0aGlzLCByb3csIGVsX2dyaWRfZGF0YSk7CiAgICAgICAgfQogICAgfTsKCgoKICAgIGZuLl90cmF2ZXJzaW5nX3dpZGdldHMgPSBmdW5jdGlvbih0eXBlLCBkaXJlY3Rpb24sIGNvbCwgcm93LCBjYWxsYmFjaykgewogICAgICAgIHZhciBnYSA9IHRoaXMuZ3JpZG1hcDsKICAgICAgICBpZiAoIWdhW2NvbF0pIHsgcmV0dXJuOyB9CgogICAgICAgIHZhciBjciwgbWF4OwogICAgICAgIHZhciBhY3Rpb24gPSB0eXBlICsgJy8nICsgZGlyZWN0aW9uOwogICAgICAgIGlmIChhcmd1bWVudHNbMl0gaW5zdGFuY2VvZiAkKSB7CiAgICAgICAgICAgIHZhciBlbF9ncmlkX2RhdGEgPSBhcmd1bWVudHNbMl0uY29vcmRzKCkuZ3JpZDsKICAgICAgICAgICAgY29sID0gZWxfZ3JpZF9kYXRhLmNvbDsKICAgICAgICAgICAgcm93ID0gZWxfZ3JpZF9kYXRhLnJvdzsKICAgICAgICAgICAgY2FsbGJhY2sgPSBhcmd1bWVudHNbM107CiAgICAgICAgfQogICAgICAgIHZhciBtYXRjaGVkID0gW107CiAgICAgICAgdmFyIHRyb3cgPSByb3c7CgoKICAgICAgICB2YXIgbWV0aG9kcyA9IHsKICAgICAgICAgICAgJ2Zvcl9lYWNoL2Fib3ZlJzogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB3aGlsZSAodHJvdy0tKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHRyb3cgPiAwICYmIHRoaXMuaXNfd2lkZ2V0KGNvbCwgdHJvdykgJiYKICAgICAgICAgICAgICAgICAgICAgICAgJC5pbkFycmF5KGdhW2NvbF1bdHJvd10sIG1hdGNoZWQpID09PSAtMQogICAgICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICAgICAgICBjciA9IGNhbGxiYWNrLmNhbGwoZ2FbY29sXVt0cm93XSwgY29sLCB0cm93KTsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZC5wdXNoKGdhW2NvbF1bdHJvd10pOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3IpIHsgYnJlYWs7IH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICdmb3JfZWFjaC9iZWxvdyc6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZm9yICh0cm93ID0gcm93ICsgMSwgbWF4ID0gZ2FbY29sXS5sZW5ndGg7IHRyb3cgPCBtYXg7IHRyb3crKykgewogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX3dpZGdldChjb2wsIHRyb3cpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICQuaW5BcnJheShnYVtjb2xdW3Ryb3ddLCBtYXRjaGVkKSA9PT0gLTEKICAgICAgICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgICAgICAgICAgY3IgPSBjYWxsYmFjay5jYWxsKGdhW2NvbF1bdHJvd10sIGNvbCwgdHJvdyk7CiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWQucHVzaChnYVtjb2xdW3Ryb3ddKTsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNyKSB7IGJyZWFrOyB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfTsKCiAgICAgICAgaWYgKG1ldGhvZHNbYWN0aW9uXSkgewogICAgICAgICAgICBtZXRob2RzW2FjdGlvbl0uY2FsbCh0aGlzKTsKICAgICAgICB9CiAgICB9OwoKCiAgICAvKioKICAgICogSXRlcmF0ZSBvdmVyIGVhY2ggd2lkZ2V0IGFib3ZlIHRoZSBjb2x1bW4gYW5kIHJvdyBzcGVjaWZpZWQuCiAgICAqCiAgICAqIEBtZXRob2QgZm9yX2VhY2hfd2lkZ2V0X2Fib3ZlCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2wgVGhlIGNvbHVtbiB0byBzdGFydCBpdGVyYXRpbmcuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3cgVGhlIHJvdyB0byBzdGFydCBpdGVyYXRpbmcuCiAgICAqIEBwYXJhbSB7RnVuY3Rpb259IGNhbGxiYWNrIFRoZSBmdW5jdGlvbiB0byBleGVjdXRlIG9uIGVhY2ggd2lkZ2V0CiAgICAqICBpdGVyYXRpb24uIFRoZSB2YWx1ZSBvZiBgdGhpc2AgaW5zaWRlIHRoZSBmdW5jdGlvbiBpcyB0aGUgalF1ZXJ5CiAgICAqICB3cmFwcGVkIEhUTUxFbGVtZW50LgogICAgKiBAcmV0dXJuIHtDbGFzc30gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIENsYXNzLgogICAgKi8KICAgIGZuLmZvcl9lYWNoX3dpZGdldF9hYm92ZSA9IGZ1bmN0aW9uKGNvbCwgcm93LCBjYWxsYmFjaykgewogICAgICAgIHRoaXMuX3RyYXZlcnNpbmdfd2lkZ2V0cygnZm9yX2VhY2gnLCAnYWJvdmUnLCBjb2wsIHJvdywgY2FsbGJhY2spOwogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIEl0ZXJhdGUgb3ZlciBlYWNoIHdpZGdldCBiZWxvdyB0aGUgY29sdW1uIGFuZCByb3cgc3BlY2lmaWVkLgogICAgKgogICAgKiBAbWV0aG9kIGZvcl9lYWNoX3dpZGdldF9iZWxvdwogICAgKiBAcGFyYW0ge051bWJlcn0gY29sIFRoZSBjb2x1bW4gdG8gc3RhcnQgaXRlcmF0aW5nLgogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgdG8gc3RhcnQgaXRlcmF0aW5nLgogICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBjYWxsYmFjayBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSBvbiBlYWNoIHdpZGdldAogICAgKiAgaXRlcmF0aW9uLiBUaGUgdmFsdWUgb2YgYHRoaXNgIGluc2lkZSB0aGUgZnVuY3Rpb24gaXMgdGhlIGpRdWVyeSB3cmFwcGVkCiAgICAqICBIVE1MRWxlbWVudC4KICAgICogQHJldHVybiB7Q2xhc3N9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBDbGFzcy4KICAgICovCiAgICBmbi5mb3JfZWFjaF93aWRnZXRfYmVsb3cgPSBmdW5jdGlvbihjb2wsIHJvdywgY2FsbGJhY2spIHsKICAgICAgICB0aGlzLl90cmF2ZXJzaW5nX3dpZGdldHMoJ2Zvcl9lYWNoJywgJ2JlbG93JywgY29sLCByb3csIGNhbGxiYWNrKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBSZXR1cm5zIHRoZSBoaWdoZXN0IG9jY3VwaWVkIGNlbGwgaW4gdGhlIGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2QgZ2V0X2hpZ2hlc3Rfb2NjdXBpZWRfY2VsbAogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgYW4gb2JqZWN0IHdpdGggYGNvbGAgYW5kIGByb3dgIG51bWJlcnMuCiAgICAqLwogICAgZm4uZ2V0X2hpZ2hlc3Rfb2NjdXBpZWRfY2VsbCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciByOwogICAgICAgIHZhciBnbSA9IHRoaXMuZ3JpZG1hcDsKICAgICAgICB2YXIgcmwgPSBnbVsxXS5sZW5ndGg7CiAgICAgICAgdmFyIHJvd3MgPSBbXSwgY29scyA9IFtdOwogICAgICAgIHZhciByb3dfaW5fY29sID0gW107CiAgICAgICAgZm9yICh2YXIgYyA9IGdtLmxlbmd0aCAtIDE7IGMgPj0gMTsgYy0tKSB7CiAgICAgICAgICAgIGZvciAociA9IHJsIC0gMTsgciA+PSAxOyByLS0pIHsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzX3dpZGdldChjLCByKSkgewogICAgICAgICAgICAgICAgICAgIHJvd3MucHVzaChyKTsKICAgICAgICAgICAgICAgICAgICBjb2xzLnB1c2goYyk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGNvbDogTWF0aC5tYXguYXBwbHkoTWF0aCwgY29scyksCiAgICAgICAgICAgIHJvdzogTWF0aC5tYXguYXBwbHkoTWF0aCwgcm93cykKICAgICAgICB9OwogICAgfTsKCgogICAgZm4uZ2V0X3dpZGdldHNfZnJvbSA9IGZ1bmN0aW9uKGNvbCwgcm93KSB7CiAgICAgICAgdmFyIGdhID0gdGhpcy5ncmlkbWFwOwogICAgICAgIHZhciAkd2lkZ2V0cyA9ICQoKTsKCiAgICAgICAgaWYgKGNvbCkgewogICAgICAgICAgICAkd2lkZ2V0cyA9ICR3aWRnZXRzLmFkZCgKICAgICAgICAgICAgICAgIHRoaXMuJHdpZGdldHMuZmlsdGVyKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIHZhciB0Y29sID0gJCh0aGlzKS5hdHRyKCdkYXRhLWNvbCcpOwogICAgICAgICAgICAgICAgICAgIHJldHVybiAodGNvbCA9PT0gY29sIHx8IHRjb2wgPiBjb2wpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgKTsKICAgICAgICB9CgogICAgICAgIGlmIChyb3cpIHsKICAgICAgICAgICAgJHdpZGdldHMgPSAkd2lkZ2V0cy5hZGQoCiAgICAgICAgICAgICAgICB0aGlzLiR3aWRnZXRzLmZpbHRlcihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgdHJvdyA9ICQodGhpcykuYXR0cignZGF0YS1yb3cnKTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHRyb3cgPT09IHJvdyB8fCB0cm93ID4gcm93KTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gJHdpZGdldHM7CiAgICB9OwoKCiAgICAvKioKICAgICogU2V0IHRoZSBjdXJyZW50IGhlaWdodCBvZiB0aGUgcGFyZW50IGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2Qgc2V0X2RvbV9ncmlkX2hlaWdodAogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5zZXRfZG9tX2dyaWRfaGVpZ2h0ID0gZnVuY3Rpb24oaGVpZ2h0KSB7CiAgICAgICAgaWYgKHR5cGVvZiBoZWlnaHQgPT09ICd1bmRlZmluZWQnKSB7CiAgICAgICAgICAgIHZhciByID0gdGhpcy5nZXRfaGlnaGVzdF9vY2N1cGllZF9jZWxsKCkucm93OwogICAgICAgICAgICBoZWlnaHQgPSByICogdGhpcy5taW5fd2lkZ2V0X2hlaWdodDsKICAgICAgICB9CgogICAgICAgIHRoaXMuY29udGFpbmVyX2hlaWdodCA9IGhlaWdodDsKICAgICAgICB0aGlzLiRlbC5jc3MoJ2hlaWdodCcsIHRoaXMuY29udGFpbmVyX2hlaWdodCk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKICAgIC8qKgogICAgKiBTZXQgdGhlIGN1cnJlbnQgd2lkdGggb2YgdGhlIHBhcmVudCBncmlkLgogICAgKgogICAgKiBAbWV0aG9kIHNldF9kb21fZ3JpZF93aWR0aAogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5zZXRfZG9tX2dyaWRfd2lkdGggPSBmdW5jdGlvbihjb2xzKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjb2xzID09PSAndW5kZWZpbmVkJykgewogICAgICAgICAgICBjb2xzID0gdGhpcy5nZXRfaGlnaGVzdF9vY2N1cGllZF9jZWxsKCkuY29sOwogICAgICAgIH0KCiAgICAgICAgdmFyIG1heF9jb2xzID0gKHRoaXMub3B0aW9ucy5hdXRvZ3Jvd19jb2xzID8gdGhpcy5vcHRpb25zLm1heF9jb2xzIDoKICAgICAgICAgICAgdGhpcy5jb2xzKTsKCiAgICAgICAgY29scyA9IE1hdGgubWluKG1heF9jb2xzLCBNYXRoLm1heChjb2xzLCB0aGlzLm9wdGlvbnMubWluX2NvbHMpKTsKICAgICAgICB0aGlzLmNvbnRhaW5lcl93aWR0aCA9IGNvbHMgKiB0aGlzLm1pbl93aWRnZXRfd2lkdGg7CiAgICAgICAgdGhpcy4kZWwuY3NzKCd3aWR0aCcsIHRoaXMuY29udGFpbmVyX3dpZHRoKTsKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBJdCBnZW5lcmF0ZXMgdGhlIG5lY2Nlc3Nhcnkgc3R5bGVzIHRvIHBvc2l0aW9uIHRoZSB3aWRnZXRzLgogICAgKgogICAgKiBAbWV0aG9kIGdlbmVyYXRlX3N0eWxlc2hlZXQKICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvd3MgTnVtYmVyIG9mIGNvbHVtbnMuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2xzIE51bWJlciBvZiByb3dzLgogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5nZW5lcmF0ZV9zdHlsZXNoZWV0ID0gZnVuY3Rpb24ob3B0cykgewogICAgICAgIHZhciBzdHlsZXMgPSAnJzsKICAgICAgICB2YXIgbWF4X3NpemVfeCA9IHRoaXMub3B0aW9ucy5tYXhfc2l6ZV94IHx8IHRoaXMuY29sczsKICAgICAgICB2YXIgbWF4X3Jvd3MgPSAwOwogICAgICAgIHZhciBtYXhfY29scyA9IDA7CiAgICAgICAgdmFyIGk7CiAgICAgICAgdmFyIHJ1bGVzOwoKICAgICAgICBvcHRzIHx8IChvcHRzID0ge30pOwogICAgICAgIG9wdHMuY29scyB8fCAob3B0cy5jb2xzID0gdGhpcy5jb2xzKTsKICAgICAgICBvcHRzLnJvd3MgfHwgKG9wdHMucm93cyA9IHRoaXMucm93cyk7CiAgICAgICAgb3B0cy5uYW1lc3BhY2UgfHwgKG9wdHMubmFtZXNwYWNlID0gdGhpcy5vcHRpb25zLm5hbWVzcGFjZSk7CiAgICAgICAgb3B0cy53aWRnZXRfYmFzZV9kaW1lbnNpb25zIHx8CiAgICAgICAgICAgIChvcHRzLndpZGdldF9iYXNlX2RpbWVuc2lvbnMgPSB0aGlzLm9wdGlvbnMud2lkZ2V0X2Jhc2VfZGltZW5zaW9ucyk7CiAgICAgICAgb3B0cy53aWRnZXRfbWFyZ2lucyB8fAogICAgICAgICAgICAob3B0cy53aWRnZXRfbWFyZ2lucyA9IHRoaXMub3B0aW9ucy53aWRnZXRfbWFyZ2lucyk7CiAgICAgICAgb3B0cy5taW5fd2lkZ2V0X3dpZHRoID0gKG9wdHMud2lkZ2V0X21hcmdpbnNbMF0gKiAyKSArCiAgICAgICAgICAgIG9wdHMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1swXTsKICAgICAgICBvcHRzLm1pbl93aWRnZXRfaGVpZ2h0ID0gKG9wdHMud2lkZ2V0X21hcmdpbnNbMV0gKiAyKSArCiAgICAgICAgICAgIG9wdHMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1sxXTsKCiAgICAgICAgLy8gZG9uJ3QgZHVwbGljYXRlIHN0eWxlc2hlZXRzIGZvciB0aGUgc2FtZSBjb25maWd1cmF0aW9uCiAgICAgICAgdmFyIHNlcmlhbGl6ZWRfb3B0cyA9ICQucGFyYW0ob3B0cyk7CiAgICAgICAgaWYgKCQuaW5BcnJheShzZXJpYWxpemVkX29wdHMsIEdyaWRzdGVyLmdlbmVyYXRlZF9zdHlsZXNoZWV0cykgPj0gMCkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQoKICAgICAgICB0aGlzLmdlbmVyYXRlZF9zdHlsZXNoZWV0cy5wdXNoKHNlcmlhbGl6ZWRfb3B0cyk7CiAgICAgICAgR3JpZHN0ZXIuZ2VuZXJhdGVkX3N0eWxlc2hlZXRzLnB1c2goc2VyaWFsaXplZF9vcHRzKTsKCiAgICAgICAgLyogZ2VuZXJhdGUgQ1NTIHN0eWxlcyBmb3IgY29scyAqLwogICAgICAgIGZvciAoaSA9IG9wdHMuY29sczsgaSA+PSAwOyBpLS0pIHsKICAgICAgICAgICAgc3R5bGVzICs9IChvcHRzLm5hbWVzcGFjZSArICcgW2RhdGEtY29sPSInKyAoaSArIDEpICsgJyJdIHsgbGVmdDonICsKICAgICAgICAgICAgICAgICgoaSAqIG9wdHMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1swXSkgKwogICAgICAgICAgICAgICAgKGkgKiBvcHRzLndpZGdldF9tYXJnaW5zWzBdKSArCiAgICAgICAgICAgICAgICAoKGkgKyAxKSAqIG9wdHMud2lkZ2V0X21hcmdpbnNbMF0pKSArICdweDsgfVxuJyk7CiAgICAgICAgfQoKICAgICAgICAvKiBnZW5lcmF0ZSBDU1Mgc3R5bGVzIGZvciByb3dzICovCiAgICAgICAgZm9yIChpID0gb3B0cy5yb3dzOyBpID49IDA7IGktLSkgewogICAgICAgICAgICBzdHlsZXMgKz0gKG9wdHMubmFtZXNwYWNlICsgJyBbZGF0YS1yb3c9IicgKyAoaSArIDEpICsgJyJdIHsgdG9wOicgKwogICAgICAgICAgICAgICAgKChpICogb3B0cy53aWRnZXRfYmFzZV9kaW1lbnNpb25zWzFdKSArCiAgICAgICAgICAgICAgICAoaSAqIG9wdHMud2lkZ2V0X21hcmdpbnNbMV0pICsKICAgICAgICAgICAgICAgICgoaSArIDEpICogb3B0cy53aWRnZXRfbWFyZ2luc1sxXSkgKSArICdweDsgfVxuJyk7CiAgICAgICAgfQoKICAgICAgICBmb3IgKHZhciB5ID0gMTsgeSA8PSBvcHRzLnJvd3M7IHkrKykgewogICAgICAgICAgICBzdHlsZXMgKz0gKG9wdHMubmFtZXNwYWNlICsgJyBbZGF0YS1zaXpleT0iJyArIHkgKyAnIl0geyBoZWlnaHQ6JyArCiAgICAgICAgICAgICAgICAoeSAqIG9wdHMud2lkZ2V0X2Jhc2VfZGltZW5zaW9uc1sxXSArCiAgICAgICAgICAgICAgICAoeSAtIDEpICogKG9wdHMud2lkZ2V0X21hcmdpbnNbMV0gKiAyKSkgKyAncHg7IH1cbicpOwogICAgICAgIH0KCiAgICAgICAgZm9yICh2YXIgeCA9IDE7IHggPD0gbWF4X3NpemVfeDsgeCsrKSB7CiAgICAgICAgICAgIHN0eWxlcyArPSAob3B0cy5uYW1lc3BhY2UgKyAnIFtkYXRhLXNpemV4PSInICsgeCArICciXSB7IHdpZHRoOicgKwogICAgICAgICAgICAgICAgKHggKiBvcHRzLndpZGdldF9iYXNlX2RpbWVuc2lvbnNbMF0gKwogICAgICAgICAgICAgICAgKHggLSAxKSAqIChvcHRzLndpZGdldF9tYXJnaW5zWzBdICogMikpICsgJ3B4OyB9XG4nKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucmVtb3ZlX3N0eWxlX3RhZ3MoKTsKCiAgICAgICAgcmV0dXJuIHRoaXMuYWRkX3N0eWxlX3RhZyhzdHlsZXMpOwogICAgfTsKCgogICAgLyoqCiAgICAqIEluamVjdHMgdGhlIGdpdmVuIENTUyBhcyBzdHJpbmcgdG8gdGhlIGhlYWQgb2YgdGhlIGRvY3VtZW50LgogICAgKgogICAgKiBAbWV0aG9kIGFkZF9zdHlsZV90YWcKICAgICogQHBhcmFtIHtTdHJpbmd9IGNzcyBUaGUgc3R5bGVzIHRvIGFwcGx5LgogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5hZGRfc3R5bGVfdGFnID0gZnVuY3Rpb24oY3NzKSB7CiAgICAgICAgdmFyIGQgPSBkb2N1bWVudDsKICAgICAgICB2YXIgdGFnID0gZC5jcmVhdGVFbGVtZW50KCdzdHlsZScpOwoKICAgICAgICBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF0uYXBwZW5kQ2hpbGQodGFnKTsKICAgICAgICB0YWcuc2V0QXR0cmlidXRlKCd0eXBlJywgJ3RleHQvY3NzJyk7CgogICAgICAgIGlmICh0YWcuc3R5bGVTaGVldCkgewogICAgICAgICAgICB0YWcuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRhZy5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjc3MpKTsKICAgICAgICB9CgogICAgICAgIHRoaXMuJHN0eWxlX3RhZ3MgPSB0aGlzLiRzdHlsZV90YWdzLmFkZCh0YWcpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBSZW1vdmUgdGhlIHN0eWxlIHRhZyB3aXRoIHRoZSBhc3NvY2lhdGVkIGlkIGZyb20gdGhlIGhlYWQgb2YgdGhlIGRvY3VtZW50CiAgICAqCiAgICAqIEBtZXRob2QgIHJlbW92ZV9zdHlsZV90YWcKICAgICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgY2xhc3MuCiAgICAqLwogICAgZm4ucmVtb3ZlX3N0eWxlX3RhZ3MgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYWxsX3N0eWxlcyA9IEdyaWRzdGVyLmdlbmVyYXRlZF9zdHlsZXNoZWV0czsKICAgICAgICB2YXIgaW5zX3N0eWxlcyA9IHRoaXMuZ2VuZXJhdGVkX3N0eWxlc2hlZXRzOwoKICAgICAgICB0aGlzLiRzdHlsZV90YWdzLnJlbW92ZSgpOwoKICAgICAgICBHcmlkc3Rlci5nZW5lcmF0ZWRfc3R5bGVzaGVldHMgPSAkLm1hcChhbGxfc3R5bGVzLCBmdW5jdGlvbihzKSB7CiAgICAgICAgICAgIGlmICgkLmluQXJyYXkocywgaW5zX3N0eWxlcykgPT09IC0xKSB7IHJldHVybiBzOyB9CiAgICAgICAgfSk7CiAgICB9OwoKCiAgICAvKioKICAgICogR2VuZXJhdGVzIGEgZmF1eCBncmlkIHRvIGNvbGxpZGUgd2l0aCBpdCB3aGVuIGEgd2lkZ2V0IGlzIGRyYWdnZWQgYW5kCiAgICAqIGRldGVjdCByb3cgb3IgY29sdW1uIHRoYXQgd2Ugd2FudCB0byBnby4KICAgICoKICAgICogQG1ldGhvZCBnZW5lcmF0ZV9mYXV4X2dyaWQKICAgICogQHBhcmFtIHtOdW1iZXJ9IHJvd3MgTnVtYmVyIG9mIGNvbHVtbnMuCiAgICAqIEBwYXJhbSB7TnVtYmVyfSBjb2xzIE51bWJlciBvZiByb3dzLgogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5nZW5lcmF0ZV9mYXV4X2dyaWQgPSBmdW5jdGlvbihyb3dzLCBjb2xzKSB7CiAgICAgICAgdGhpcy5mYXV4X2dyaWQgPSBbXTsKICAgICAgICB0aGlzLmdyaWRtYXAgPSBbXTsKICAgICAgICB2YXIgY29sOwogICAgICAgIHZhciByb3c7CiAgICAgICAgZm9yIChjb2wgPSBjb2xzOyBjb2wgPiAwOyBjb2wtLSkgewogICAgICAgICAgICB0aGlzLmdyaWRtYXBbY29sXSA9IFtdOwogICAgICAgICAgICBmb3IgKHJvdyA9IHJvd3M7IHJvdyA+IDA7IHJvdy0tKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZF9mYXV4X2NlbGwocm93LCBjb2wpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCgogICAgLyoqCiAgICAqIEFkZCBjZWxsIHRvIHRoZSBmYXV4IGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2QgYWRkX2ZhdXhfY2VsbAogICAgKiBAcGFyYW0ge051bWJlcn0gcm93IFRoZSByb3cgZm9yIHRoZSBuZXcgZmF1eCBjZWxsLgogICAgKiBAcGFyYW0ge051bWJlcn0gY29sIFRoZSBjb2wgZm9yIHRoZSBuZXcgZmF1eCBjZWxsLgogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5hZGRfZmF1eF9jZWxsID0gZnVuY3Rpb24ocm93LCBjb2wpIHsKICAgICAgICB2YXIgY29vcmRzID0gJCh7CiAgICAgICAgICAgICAgICAgICAgICAgIGxlZnQ6IHRoaXMuYmFzZVggKyAoKGNvbCAtIDEpICogdGhpcy5taW5fd2lkZ2V0X3dpZHRoKSwKICAgICAgICAgICAgICAgICAgICAgICAgdG9wOiB0aGlzLmJhc2VZICsgKHJvdyAtMSkgKiB0aGlzLm1pbl93aWRnZXRfaGVpZ2h0LAogICAgICAgICAgICAgICAgICAgICAgICB3aWR0aDogdGhpcy5taW5fd2lkZ2V0X3dpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IHRoaXMubWluX3dpZGdldF9oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbDogY29sLAogICAgICAgICAgICAgICAgICAgICAgICByb3c6IHJvdywKICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ2luYWxfY29sOiBjb2wsCiAgICAgICAgICAgICAgICAgICAgICAgIG9yaWdpbmFsX3Jvdzogcm93CiAgICAgICAgICAgICAgICAgICAgfSkuY29vcmRzKCk7CgogICAgICAgIGlmICghJC5pc0FycmF5KHRoaXMuZ3JpZG1hcFtjb2xdKSkgewogICAgICAgICAgICB0aGlzLmdyaWRtYXBbY29sXSA9IFtdOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ncmlkbWFwW2NvbF1bcm93XSA9IGZhbHNlOwogICAgICAgIHRoaXMuZmF1eF9ncmlkLnB1c2goY29vcmRzKTsKCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogQWRkIHJvd3MgdG8gdGhlIGZhdXggZ3JpZC4KICAgICoKICAgICogQG1ldGhvZCBhZGRfZmF1eF9yb3dzCiAgICAqIEBwYXJhbSB7TnVtYmVyfSByb3dzIFRoZSBudW1iZXIgb2Ygcm93cyB5b3Ugd2FudCB0byBhZGQgdG8gdGhlIGZhdXggZ3JpZC4KICAgICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgY2xhc3MuCiAgICAqLwogICAgZm4uYWRkX2ZhdXhfcm93cyA9IGZ1bmN0aW9uKHJvd3MpIHsKICAgICAgICB2YXIgYWN0dWFsX3Jvd3MgPSB0aGlzLnJvd3M7CiAgICAgICAgdmFyIG1heF9yb3dzID0gYWN0dWFsX3Jvd3MgKyAocm93cyB8fCAxKTsKCiAgICAgICAgZm9yICh2YXIgciA9IG1heF9yb3dzOyByID4gYWN0dWFsX3Jvd3M7IHItLSkgewogICAgICAgICAgICBmb3IgKHZhciBjID0gdGhpcy5jb2xzOyBjID49IDE7IGMtLSkgewogICAgICAgICAgICAgICAgdGhpcy5hZGRfZmF1eF9jZWxsKHIsIGMpOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICB0aGlzLnJvd3MgPSBtYXhfcm93czsKCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5hdXRvZ2VuZXJhdGVfc3R5bGVzaGVldCkgewogICAgICAgICAgICB0aGlzLmdlbmVyYXRlX3N0eWxlc2hlZXQoKTsKICAgICAgICB9CgogICAgICAgIHJldHVybiB0aGlzOwogICAgfTsKCiAgICAgLyoqCiAgICAqIEFkZCBjb2xzIHRvIHRoZSBmYXV4IGdyaWQuCiAgICAqCiAgICAqIEBtZXRob2QgYWRkX2ZhdXhfY29scwogICAgKiBAcGFyYW0ge051bWJlcn0gY29scyBUaGUgbnVtYmVyIG9mIGNvbHMgeW91IHdhbnQgdG8gYWRkIHRvIHRoZSBmYXV4IGdyaWQuCiAgICAqIEByZXR1cm4ge09iamVjdH0gUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIEdyaWRzdGVyIGNsYXNzLgogICAgKi8KICAgIGZuLmFkZF9mYXV4X2NvbHMgPSBmdW5jdGlvbihjb2xzKSB7CiAgICAgICAgdmFyIGFjdHVhbF9jb2xzID0gdGhpcy5jb2xzOwogICAgICAgIHZhciBtYXhfY29scyA9IGFjdHVhbF9jb2xzICsgKGNvbHMgfHwgMSk7CiAgICAgICAgbWF4X2NvbHMgPSBNYXRoLm1pbihtYXhfY29scywgdGhpcy5vcHRpb25zLm1heF9jb2xzKTsKCiAgICAgICAgZm9yICh2YXIgYyA9IGFjdHVhbF9jb2xzICsgMTsgYyA8PSBtYXhfY29sczsgYysrKSB7CiAgICAgICAgICAgIGZvciAodmFyIHIgPSB0aGlzLnJvd3M7IHIgPj0gMTsgci0tKSB7CiAgICAgICAgICAgICAgICB0aGlzLmFkZF9mYXV4X2NlbGwociwgYyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHRoaXMuY29scyA9IG1heF9jb2xzOwoKICAgICAgICBpZiAodGhpcy5vcHRpb25zLmF1dG9nZW5lcmF0ZV9zdHlsZXNoZWV0KSB7CiAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVfc3R5bGVzaGVldCgpOwogICAgICAgIH0KCiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICB9OwoKCiAgICAvKioKICAgICogUmVjYWxjdWxhdGVzIHRoZSBvZmZzZXRzIGZvciB0aGUgZmF1eCBncmlkLiBZb3UgbmVlZCB0byB1c2UgaXQgd2hlbgogICAgKiB0aGUgYnJvd3NlciBpcyByZXNpemVkLgogICAgKgogICAgKiBAbWV0aG9kIHJlY2FsY3VsYXRlX2ZhdXhfZ3JpZAogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5yZWNhbGN1bGF0ZV9mYXV4X2dyaWQgPSBmdW5jdGlvbigpIHsKICAgICAgICB2YXIgYXcgPSB0aGlzLiR3cmFwcGVyLndpZHRoKCk7CiAgICAgICAgdGhpcy5iYXNlWCA9ICgkKHdpbmRvdykud2lkdGgoKSAtIGF3KSAvIDI7CiAgICAgICAgdGhpcy5iYXNlWSA9IHRoaXMuJHdyYXBwZXIub2Zmc2V0KCkudG9wOwoKICAgICAgICAkLmVhY2godGhpcy5mYXV4X2dyaWQsICQucHJveHkoZnVuY3Rpb24oaSwgY29vcmRzKSB7CiAgICAgICAgICAgIHRoaXMuZmF1eF9ncmlkW2ldID0gY29vcmRzLnVwZGF0ZSh7CiAgICAgICAgICAgICAgICBsZWZ0OiB0aGlzLmJhc2VYICsgKGNvb3Jkcy5kYXRhLmNvbCAtMSkgKiB0aGlzLm1pbl93aWRnZXRfd2lkdGgsCiAgICAgICAgICAgICAgICB0b3A6IHRoaXMuYmFzZVkgKyAoY29vcmRzLmRhdGEucm93IC0xKSAqIHRoaXMubWluX3dpZGdldF9oZWlnaHQKICAgICAgICAgICAgfSk7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBHZXQgYWxsIHdpZGdldHMgaW4gdGhlIERPTSBhbmQgcmVnaXN0ZXIgdGhlbS4KICAgICoKICAgICogQG1ldGhvZCBnZXRfd2lkZ2V0c19mcm9tX0RPTQogICAgKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIGluc3RhbmNlIG9mIHRoZSBHcmlkc3RlciBjbGFzcy4KICAgICovCiAgICBmbi5nZXRfd2lkZ2V0c19mcm9tX0RPTSA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciB3aWRnZXRzX2Nvb3JkcyA9IHRoaXMuJHdpZGdldHMubWFwKCQucHJveHkoZnVuY3Rpb24oaSwgd2lkZ2V0KSB7CiAgICAgICAgICAgIHZhciAkdyA9ICQod2lkZ2V0KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuZG9tX3RvX2Nvb3Jkcygkdyk7CiAgICAgICAgfSwgdGhpcykpOwoKICAgICAgICB3aWRnZXRzX2Nvb3JkcyA9IEdyaWRzdGVyLnNvcnRfYnlfcm93X2FuZF9jb2xfYXNjKHdpZGdldHNfY29vcmRzKTsKCiAgICAgICAgdmFyIGNoYW5nZXMgPSAkKHdpZGdldHNfY29vcmRzKS5tYXAoJC5wcm94eShmdW5jdGlvbihpLCB3Z2QpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJfd2lkZ2V0KHdnZCkgfHwgbnVsbDsKICAgICAgICB9LCB0aGlzKSk7CgogICAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgewogICAgICAgICAgICB0aGlzLiRlbC50cmlnZ2VyKCdncmlkc3Rlcjpwb3NpdGlvbnNjaGFuZ2VkJyk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8qKgogICAgKiBDYWxjdWxhdGUgY29sdW1ucyBhbmQgcm93cyB0byBiZSBzZXQgYmFzZWQgb24gdGhlIGNvbmZpZ3VyYXRpb24KICAgICogIHBhcmFtZXRlcnMsIGdyaWQgZGltZW5zaW9ucywgZXRjIC4uLgogICAgKgogICAgKiBAbWV0aG9kIGdlbmVyYXRlX2dyaWRfYW5kX3N0eWxlc2hlZXQKICAgICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgY2xhc3MuCiAgICAqLwogICAgZm4uZ2VuZXJhdGVfZ3JpZF9hbmRfc3R5bGVzaGVldCA9IGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBhdyA9IHRoaXMuJHdyYXBwZXIud2lkdGgoKTsKICAgICAgICB2YXIgbWF4X2NvbHMgPSB0aGlzLm9wdGlvbnMubWF4X2NvbHM7CgogICAgICAgIHZhciBjb2xzID0gTWF0aC5mbG9vcihhdyAvIHRoaXMubWluX3dpZGdldF93aWR0aCkgKwogICAgICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zLmV4dHJhX2NvbHM7CgogICAgICAgIHZhciBhY3R1YWxfY29scyA9IHRoaXMuJHdpZGdldHMubWFwKGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gJCh0aGlzKS5hdHRyKCdkYXRhLWNvbCcpOwogICAgICAgIH0pLmdldCgpOwoKICAgICAgICAvL25lZWRlZCB0byBwYXNzIHRlc3RzIHdpdGggcGhhbnRvbWpzCiAgICAgICAgYWN0dWFsX2NvbHMubGVuZ3RoIHx8IChhY3R1YWxfY29scyA9IFswXSk7CgogICAgICAgIHZhciBtaW5fY29scyA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIGFjdHVhbF9jb2xzKTsKCiAgICAgICAgdGhpcy5jb2xzID0gTWF0aC5tYXgobWluX2NvbHMsIGNvbHMsIHRoaXMub3B0aW9ucy5taW5fY29scyk7CgogICAgICAgIGlmIChtYXhfY29scyAhPT0gSW5maW5pdHkgJiYgbWF4X2NvbHMgPj0gbWluX2NvbHMgJiYgbWF4X2NvbHMgPCB0aGlzLmNvbHMpIHsKICAgICAgICAgICAgdGhpcy5jb2xzID0gbWF4X2NvbHM7CiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgYWxsIHJvd3MgdGhhdCBjb3VsZCBiZSBvY2N1cGllZCBieSB0aGUgY3VycmVudCB3aWRnZXRzCiAgICAgICAgdmFyIG1heF9yb3dzID0gdGhpcy5vcHRpb25zLmV4dHJhX3Jvd3M7CiAgICAgICAgdGhpcy4kd2lkZ2V0cy5lYWNoKGZ1bmN0aW9uKGksIHcpIHsKICAgICAgICAgICAgbWF4X3Jvd3MgKz0gKCskKHcpLmF0dHIoJ2RhdGEtc2l6ZXknKSk7CiAgICAgICAgfSk7CgogICAgICAgIHRoaXMucm93cyA9IE1hdGgubWF4KG1heF9yb3dzLCB0aGlzLm9wdGlvbnMubWluX3Jvd3MpOwoKICAgICAgICB0aGlzLmJhc2VYID0gKCQod2luZG93KS53aWR0aCgpIC0gYXcpIC8gMjsKICAgICAgICB0aGlzLmJhc2VZID0gdGhpcy4kd3JhcHBlci5vZmZzZXQoKS50b3A7CgogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0b2dlbmVyYXRlX3N0eWxlc2hlZXQpIHsKICAgICAgICAgICAgdGhpcy5nZW5lcmF0ZV9zdHlsZXNoZWV0KCk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZV9mYXV4X2dyaWQodGhpcy5yb3dzLCB0aGlzLmNvbHMpOwogICAgfTsKCiAgICAvKioKICAgICAqIERlc3Ryb3kgdGhpcyBncmlkc3RlciBieSByZW1vdmluZyBhbnkgc2lnbiBvZiBpdHMgcHJlc2VuY2UsIG1ha2luZyBpdCBlYXN5IHRvIGF2b2lkIG1lbW9yeSBsZWFrcwogICAgICoKICAgICAqIEBtZXRob2QgZGVzdHJveQogICAgICogQHBhcmFtIHtCb29sZWFufSByZW1vdmUgSWYgdHJ1ZSwgcmVtb3ZlIGdyaWRzdGVyIGZyb20gRE9NLgogICAgICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIHRoZSBpbnN0YW5jZSBvZiB0aGUgR3JpZHN0ZXIgY2xhc3MuCiAgICAgKi8KICAgIGZuLmRlc3Ryb3kgPSBmdW5jdGlvbihyZW1vdmUpIHsKICAgICAgICB0aGlzLiRlbC5yZW1vdmVEYXRhKCdncmlkc3RlcicpOwoKICAgICAgICAvLyByZW1vdmUgYm91bmQgY2FsbGJhY2sgb24gd2luZG93IHJlc2l6ZQogICAgICAgICQod2luZG93KS51bmJpbmQoJy5ncmlkc3RlcicpOwoKICAgICAgICBpZiAodGhpcy5kcmFnX2FwaSkgewogICAgICAgICAgICB0aGlzLmRyYWdfYXBpLmRlc3Ryb3koKTsKICAgICAgICB9CgogICAgICAgIHRoaXMucmVtb3ZlX3N0eWxlX3RhZ3MoKTsKCiAgICAgICAgcmVtb3ZlICYmIHRoaXMuJGVsLnJlbW92ZSgpOwoKICAgICAgICByZXR1cm4gdGhpczsKICAgIH07CgoKICAgIC8valF1ZXJ5IGFkYXB0ZXIKICAgICQuZm4uZ3JpZHN0ZXIgPSBmdW5jdGlvbihvcHRpb25zKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKICAgICAgICAgICAgaWYgKCEgJCh0aGlzKS5kYXRhKCdncmlkc3RlcicpKSB7CiAgICAgICAgICAgICAgICAkKHRoaXMpLmRhdGEoJ2dyaWRzdGVyJywgbmV3IEdyaWRzdGVyKCB0aGlzLCBvcHRpb25zICkpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgIHJldHVybiBHcmlkc3RlcjsKCn0pKTsK"></script>
<script src="data:application/x-javascript;base64,Ly8gZDMudGlwCi8vIENvcHlyaWdodCAoYykgMjAxMyBKdXN0aW4gUGFsbWVyCi8vCi8vIFRvb2x0aXBzIGZvciBkMy5qcyBTVkcgdmlzdWFsaXphdGlvbnMKCi8vIFB1YmxpYyAtIGNvbnRydWN0cyBhIG5ldyB0b29sdGlwCi8vCi8vIFJldHVybnMgYSB0aXAKZDMudGlwID0gZnVuY3Rpb24oKSB7CiAgdmFyIGRpcmVjdGlvbiA9IGQzX3RpcF9kaXJlY3Rpb24sCiAgICAgIG9mZnNldCAgICA9IGQzX3RpcF9vZmZzZXQsCiAgICAgIGh0bWwgICAgICA9IGQzX3RpcF9odG1sLAogICAgICBub2RlICAgICAgPSBpbml0Tm9kZSgpLAogICAgICBzdmcgICAgICAgPSBudWxsLAogICAgICBwb2ludCAgICAgPSBudWxsLAogICAgICB0YXJnZXQgICAgPSBudWxsCgogIGZ1bmN0aW9uIHRpcCh2aXMpIHsKICAgIHN2ZyA9IGdldFNWR05vZGUodmlzKQogICAgcG9pbnQgPSBzdmcuY3JlYXRlU1ZHUG9pbnQoKQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub2RlKQogIH0KCiAgLy8gUHVibGljIC0gc2hvdyB0aGUgdG9vbHRpcCBvbiB0aGUgc2NyZWVuCiAgLy8KICAvLyBSZXR1cm5zIGEgdGlwCiAgdGlwLnNob3cgPSBmdW5jdGlvbigpIHsKICAgIHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKQogICAgaWYoYXJnc1thcmdzLmxlbmd0aCAtIDFdIGluc3RhbmNlb2YgU1ZHRWxlbWVudCkgdGFyZ2V0ID0gYXJncy5wb3AoKQoKICAgIHZhciBjb250ZW50ID0gaHRtbC5hcHBseSh0aGlzLCBhcmdzKSwKICAgICAgICBwb2Zmc2V0ID0gb2Zmc2V0LmFwcGx5KHRoaXMsIGFyZ3MpLAogICAgICAgIGRpciAgICAgPSBkaXJlY3Rpb24uYXBwbHkodGhpcywgYXJncyksCiAgICAgICAgbm9kZWwgICA9IGQzLnNlbGVjdChub2RlKSwgaSA9IDAsCiAgICAgICAgY29vcmRzCgogICAgbm9kZWwuaHRtbChjb250ZW50KQogICAgICAuc3R5bGUoeyBvcGFjaXR5OiAxLCAncG9pbnRlci1ldmVudHMnOiAnYWxsJyB9KQoKICAgIHdoaWxlKGktLSkgbm9kZWwuY2xhc3NlZChkaXJlY3Rpb25zW2ldLCBmYWxzZSkKICAgIGNvb3JkcyA9IGRpcmVjdGlvbl9jYWxsYmFja3MuZ2V0KGRpcikuYXBwbHkodGhpcykKICAgIG5vZGVsLmNsYXNzZWQoZGlyLCB0cnVlKS5zdHlsZSh7CiAgICAgIHRvcDogKGNvb3Jkcy50b3AgKyAgcG9mZnNldFswXSkgKyAncHgnLAogICAgICBsZWZ0OiAoY29vcmRzLmxlZnQgKyBwb2Zmc2V0WzFdKSArICdweCcKICAgIH0pCgogICAgcmV0dXJuIHRpcAogIH0KCiAgLy8gUHVibGljIC0gaGlkZSB0aGUgdG9vbHRpcAogIC8vCiAgLy8gUmV0dXJucyBhIHRpcAogIHRpcC5oaWRlID0gZnVuY3Rpb24oKSB7CiAgICBub2RlbCA9IGQzLnNlbGVjdChub2RlKQogICAgbm9kZWwuc3R5bGUoeyBvcGFjaXR5OiAwLCAncG9pbnRlci1ldmVudHMnOiAnbm9uZScgfSkKICAgIHJldHVybiB0aXAKICB9CgogIC8vIFB1YmxpYzogUHJveHkgYXR0ciBjYWxscyB0byB0aGUgZDMgdGlwIGNvbnRhaW5lci4gIFNldHMgb3IgZ2V0cyBhdHRyaWJ1dGUgdmFsdWUuCiAgLy8KICAvLyBuIC0gbmFtZSBvZiB0aGUgYXR0cmlidXRlCiAgLy8gdiAtIHZhbHVlIG9mIHRoZSBhdHRyaWJ1dGUKICAvLwogIC8vIFJldHVybnMgdGlwIG9yIGF0dHJpYnV0ZSB2YWx1ZQogIHRpcC5hdHRyID0gZnVuY3Rpb24obiwgdikgewogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPCAyICYmIHR5cGVvZiBuID09PSAnc3RyaW5nJykgewogICAgICByZXR1cm4gZDMuc2VsZWN0KG5vZGUpLmF0dHIobikKICAgIH0gZWxzZSB7CiAgICAgIHZhciBhcmdzID0gIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cykKICAgICAgZDMuc2VsZWN0aW9uLnByb3RvdHlwZS5hdHRyLmFwcGx5KGQzLnNlbGVjdChub2RlKSwgYXJncykKICAgIH0KCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFByb3h5IHN0eWxlIGNhbGxzIHRvIHRoZSBkMyB0aXAgY29udGFpbmVyLiAgU2V0cyBvciBnZXRzIGEgc3R5bGUgdmFsdWUuCiAgLy8KICAvLyBuIC0gbmFtZSBvZiB0aGUgcHJvcGVydHkKICAvLyB2IC0gdmFsdWUgb2YgdGhlIHByb3BlcnR5CiAgLy8KICAvLyBSZXR1cm5zIHRpcCBvciBzdHlsZSBwcm9wZXJ0eSB2YWx1ZQogIHRpcC5zdHlsZSA9IGZ1bmN0aW9uKG4sIHYpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoIDwgMiAmJiB0eXBlb2YgbiA9PT0gJ3N0cmluZycpIHsKICAgICAgcmV0dXJuIGQzLnNlbGVjdChub2RlKS5zdHlsZShuKQogICAgfSBlbHNlIHsKICAgICAgdmFyIGFyZ3MgPSAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKQogICAgICBkMy5zZWxlY3Rpb24ucHJvdG90eXBlLnN0eWxlLmFwcGx5KGQzLnNlbGVjdChub2RlKSwgYXJncykKICAgIH0KCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFNldCBvciBnZXQgdGhlIGRpcmVjdGlvbiBvZiB0aGUgdG9vbHRpcAogIC8vCiAgLy8gdiAtIE9uZSBvZiBuKG5vcnRoKSwgcyhzb3V0aCksIGUoZWFzdCksIG9yIHcod2VzdCksIG53KG5vcnRod2VzdCksCiAgLy8gICAgIHN3KHNvdXRod2VzdCksIG5lKG5vcnRoZWFzdCkgb3Igc2Uoc291dGhlYXN0KQogIC8vCiAgLy8gUmV0dXJucyB0aXAgb3IgZGlyZWN0aW9uCiAgdGlwLmRpcmVjdGlvbiA9IGZ1bmN0aW9uKHYpIHsKICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgcmV0dXJuIGRpcmVjdGlvbgogICAgZGlyZWN0aW9uID0gdiA9PSBudWxsID8gdiA6IGQzLmZ1bmN0b3IodikKCiAgICByZXR1cm4gdGlwCiAgfQoKICAvLyBQdWJsaWM6IFNldHMgb3IgZ2V0cyB0aGUgb2Zmc2V0IG9mIHRoZSB0aXAKICAvLwogIC8vIHYgLSBBcnJheSBvZiBbeCwgeV0gb2Zmc2V0CiAgLy8KICAvLyBSZXR1cm5zIG9mZnNldCBvcgogIHRpcC5vZmZzZXQgPSBmdW5jdGlvbih2KSB7CiAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHJldHVybiBvZmZzZXQKICAgIG9mZnNldCA9IHYgPT0gbnVsbCA/IHYgOiBkMy5mdW5jdG9yKHYpCgogICAgcmV0dXJuIHRpcAogIH0KCiAgLy8gUHVibGljOiBzZXRzIG9yIGdldHMgdGhlIGh0bWwgdmFsdWUgb2YgdGhlIHRvb2x0aXAKICAvLwogIC8vIHYgLSBTdHJpbmcgdmFsdWUgb2YgdGhlIHRpcAogIC8vCiAgLy8gUmV0dXJucyBodG1sIHZhbHVlIG9yIHRpcAogIHRpcC5odG1sID0gZnVuY3Rpb24odikgewogICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSByZXR1cm4gaHRtbAogICAgaHRtbCA9IHYgPT0gbnVsbCA/IHYgOiBkMy5mdW5jdG9yKHYpCgogICAgcmV0dXJuIHRpcAogIH0KCiAgZnVuY3Rpb24gZDNfdGlwX2RpcmVjdGlvbigpIHsgcmV0dXJuICduJyB9CiAgZnVuY3Rpb24gZDNfdGlwX29mZnNldCgpIHsgcmV0dXJuIFswLCAwXSB9CiAgZnVuY3Rpb24gZDNfdGlwX2h0bWwoKSB7IHJldHVybiAnICcgfQoKICB2YXIgZGlyZWN0aW9uX2NhbGxiYWNrcyA9IGQzLm1hcCh7CiAgICBuOiAgZGlyZWN0aW9uX24sCiAgICBzOiAgZGlyZWN0aW9uX3MsCiAgICBlOiAgZGlyZWN0aW9uX2UsCiAgICB3OiAgZGlyZWN0aW9uX3csCiAgICBudzogZGlyZWN0aW9uX253LAogICAgbmU6IGRpcmVjdGlvbl9uZSwKICAgIHN3OiBkaXJlY3Rpb25fc3csCiAgICBzZTogZGlyZWN0aW9uX3NlCiAgfSksCgogIGRpcmVjdGlvbnMgPSBkaXJlY3Rpb25fY2FsbGJhY2tzLmtleXMoKQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fbigpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94Lm4ueSAtIG5vZGUub2Zmc2V0SGVpZ2h0LAogICAgICBsZWZ0OiBiYm94Lm4ueCAtIG5vZGUub2Zmc2V0V2lkdGggLyAyCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fcygpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94LnMueSwKICAgICAgbGVmdDogYmJveC5zLnggLSBub2RlLm9mZnNldFdpZHRoIC8gMgogICAgfQogIH0KCiAgZnVuY3Rpb24gZGlyZWN0aW9uX2UoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5lLnkgLSBub2RlLm9mZnNldEhlaWdodCAvIDIsCiAgICAgIGxlZnQ6IGJib3guZS54CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fdygpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94LncueSAtIG5vZGUub2Zmc2V0SGVpZ2h0IC8gMiwKICAgICAgbGVmdDogYmJveC53LnggLSBub2RlLm9mZnNldFdpZHRoCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fbncoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5udy55IC0gbm9kZS5vZmZzZXRIZWlnaHQsCiAgICAgIGxlZnQ6IGJib3gubncueCAtIG5vZGUub2Zmc2V0V2lkdGgKICAgIH0KICB9CgogIGZ1bmN0aW9uIGRpcmVjdGlvbl9uZSgpIHsKICAgIHZhciBiYm94ID0gZ2V0U2NyZWVuQkJveCgpCiAgICByZXR1cm4gewogICAgICB0b3A6ICBiYm94Lm5lLnkgLSBub2RlLm9mZnNldEhlaWdodCwKICAgICAgbGVmdDogYmJveC5uZS54CiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fc3coKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5zdy55LAogICAgICBsZWZ0OiBiYm94LnN3LnggLSBub2RlLm9mZnNldFdpZHRoCiAgICB9CiAgfQoKICBmdW5jdGlvbiBkaXJlY3Rpb25fc2UoKSB7CiAgICB2YXIgYmJveCA9IGdldFNjcmVlbkJCb3goKQogICAgcmV0dXJuIHsKICAgICAgdG9wOiAgYmJveC5zZS55LAogICAgICBsZWZ0OiBiYm94LmUueAogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdE5vZGUoKSB7CiAgICB2YXIgbm9kZSA9IGQzLnNlbGVjdChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSkKICAgIG5vZGUuc3R5bGUoewogICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJywKICAgICAgb3BhY2l0eTogMCwKICAgICAgcG9pbnRlckV2ZW50czogJ25vbmUnLAogICAgICBib3hTaXppbmc6ICdib3JkZXItYm94JwogICAgfSkKCiAgICByZXR1cm4gbm9kZS5ub2RlKCkKICB9CgogIGZ1bmN0aW9uIGdldFNWR05vZGUoZWwpIHsKICAgIGVsID0gZWwubm9kZSgpCiAgICBpZihlbC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ3N2ZycpCiAgICAgIHJldHVybiBlbAoKICAgIHJldHVybiBlbC5vd25lclNWR0VsZW1lbnQKICB9CgogIC8vIFByaXZhdGUgLSBnZXRzIHRoZSBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgYSBzaGFwZQogIC8vCiAgLy8gR2l2ZW4gYSBzaGFwZSBvbiB0aGUgc2NyZWVuLCB3aWxsIHJldHVybiBhbiBTVkdQb2ludCBmb3IgdGhlIGRpcmVjdGlvbnMKICAvLyBuKG5vcnRoKSwgcyhzb3V0aCksIGUoZWFzdCksIHcod2VzdCksIG5lKG5vcnRoZWFzdCksIHNlKHNvdXRoZWFzdCksIG53KG5vcnRod2VzdCksCiAgLy8gc3coc291dGh3ZXN0KS4KICAvLwogIC8vICAgICstKy0rCiAgLy8gICAgfCAgIHwKICAvLyAgICArICAgKwogIC8vICAgIHwgICB8CiAgLy8gICAgKy0rLSsKICAvLwogIC8vIFJldHVybnMgYW4gT2JqZWN0IHtuLCBzLCBlLCB3LCBudywgc3csIG5lLCBzZX0KICBmdW5jdGlvbiBnZXRTY3JlZW5CQm94KCkgewogICAgdmFyIHRhcmdldGVsICAgPSB0YXJnZXQgfHwgZDMuZXZlbnQudGFyZ2V0LAogICAgICAgIGJib3ggICAgICAgPSB7fSwKICAgICAgICBtYXRyaXggICAgID0gdGFyZ2V0ZWwuZ2V0U2NyZWVuQ1RNKCksCiAgICAgICAgdGJib3ggICAgICA9IHRhcmdldGVsLmdldEJCb3goKSwKICAgICAgICB3aWR0aCAgICAgID0gdGJib3gud2lkdGgsCiAgICAgICAgaGVpZ2h0ICAgICA9IHRiYm94LmhlaWdodCwKICAgICAgICB4ICAgICAgICAgID0gdGJib3gueCwKICAgICAgICB5ICAgICAgICAgID0gdGJib3gueSwKICAgICAgICBzY3JvbGxUb3AgID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCwKICAgICAgICBzY3JvbGxMZWZ0ID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxMZWZ0CgoKICAgIHBvaW50LnggPSB4ICsgc2Nyb2xsTGVmdAogICAgcG9pbnQueSA9IHkgKyBzY3JvbGxUb3AKICAgIGJib3gubncgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQogICAgcG9pbnQueCArPSB3aWR0aAogICAgYmJveC5uZSA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC55ICs9IGhlaWdodAogICAgYmJveC5zZSA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC54IC09IHdpZHRoCiAgICBiYm94LnN3ID0gcG9pbnQubWF0cml4VHJhbnNmb3JtKG1hdHJpeCkKICAgIHBvaW50LnkgLT0gaGVpZ2h0IC8gMgogICAgYmJveC53ICA9IHBvaW50Lm1hdHJpeFRyYW5zZm9ybShtYXRyaXgpCiAgICBwb2ludC54ICs9IHdpZHRoCiAgICBiYm94LmUgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQogICAgcG9pbnQueCAtPSB3aWR0aCAvIDIKICAgIHBvaW50LnkgLT0gaGVpZ2h0IC8gMgogICAgYmJveC5uID0gcG9pbnQubWF0cml4VHJhbnNmb3JtKG1hdHJpeCkKICAgIHBvaW50LnkgKz0gaGVpZ2h0CiAgICBiYm94LnMgPSBwb2ludC5tYXRyaXhUcmFuc2Zvcm0obWF0cml4KQoKICAgIHJldHVybiBiYm94CiAgfQoKICByZXR1cm4gdGlwCn07"></script>
<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpO3Rocm93IGYuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBJbnRlcnZhbCwgSW50ZXJ2YWxUcmVlLCBOb2RlLCBQb2ludCwgU29ydGVkTGlzdCwgVXRpbDsKClNvcnRlZExpc3QgPSByZXF1aXJlKCcuL3NvcnRlZC1saXN0Jyk7CgpOb2RlID0gcmVxdWlyZSgnLi9ub2RlJyk7CgpQb2ludCA9IHJlcXVpcmUoJy4vcG9pbnQnKTsKCkludGVydmFsID0gcmVxdWlyZSgnLi9pbnRlcnZhbCcpOwoKVXRpbCA9IHJlcXVpcmUoJy4vdXRpbCcpOwoKCi8qKgppbnRlcnZhbCB0cmVlCgpAY2xhc3MgSW50ZXJ2YWxUcmVlCkBtb2R1bGUgaW50ZXJ2YWwtdHJlZTIKICovCgpJbnRlcnZhbFRyZWUgPSAoZnVuY3Rpb24oKSB7CgogIC8qKgogIEBjb25zdHJ1Y3RvcgogIEBwYXJhbSB7TnVtYmVyfSBjZW50ZXIgY2VudGVyIG9mIHRoZSByb290IG5vZGUKICAgKi8KICBmdW5jdGlvbiBJbnRlcnZhbFRyZWUoY2VudGVyKSB7CiAgICBVdGlsLmFzc2VydE51bWJlcihjZW50ZXIsICdJbnRlcnZhbFRyZWU6IGNlbnRlcicpOwoKICAgIC8qKgogICAgY2VudGVyID0+IG5vZGUKICAgIAogICAgQHByb3BlcnR5IHtPYmplY3QoTm9kZSl9IG5vZGVzQnlDZW50ZXIKICAgICAqLwogICAgdGhpcy5ub2Rlc0J5Q2VudGVyID0ge307CgogICAgLyoqCiAgICByb290IG5vZGUKICAgIAogICAgQHByb3BlcnR5IHtOb2RlfSByb290CiAgICAgKi8KICAgIHRoaXMucm9vdCA9IHRoaXMuY3JlYXRlTm9kZShjZW50ZXIpOwoKICAgIC8qKgogICAgaW50ZXJ2YWwgaWQgPT4gaW50ZXJ2YWwKICAgIAogICAgQHByb3BlcnR5IHtPYmplY3QoSW50ZXJ2YWwpfSBpbnRlcnZhbHNCeUlkCiAgICAgKi8KICAgIHRoaXMuaW50ZXJ2YWxzQnlJZCA9IHt9OwoKICAgIC8qKgogICAgaW50ZXJ2YWwgaWQgPT4gbm9kZQogICAgCiAgICBAcHJvcGVydHkge09iamVjdChOb2RlKX0gbm9kZXNCeUlkCiAgICAgKi8KICAgIHRoaXMubm9kZXNCeUlkID0ge307CgogICAgLyoqCiAgICBzb3J0ZWQgbGlzdCBvZiB3aG9sZSBwb2ludAogICAgCiAgICBAcHJvcGVydHkge1NvcnRlZExpc3QoUG9pbnQpfSBwb2ludFRyZWUKICAgICAqLwogICAgdGhpcy5wb2ludFRyZWUgPSBuZXcgU29ydGVkTGlzdCgndmFsJyk7CgogICAgLyoqCiAgICB1bmlxdWUgaWQgY2FuZGlkYXRlIG9mIGludGVydmFsIHdpdGhvdXQgaWQgdG8gYmUgYWRkZWQgbmV4dCB0aW1lCiAgICAKICAgIEBwcm9wZXJ0eSB7TnVtYmVyfSBpZENhbmRpZGF0ZQogICAgICovCiAgICB0aGlzLmlkQ2FuZGlkYXRlID0gMDsKICB9CgoKICAvKioKICBhZGQgb25lIGludGVydmFsCiAgCiAgQG1ldGhvZCBhZGQKICBAcHVibGljCiAgQHBhcmFtIHtOdW1iZXJ9IHN0YXJ0IHN0YXJ0IG9mIHRoZSBpbnRlcnZhbCB0byBjcmVhdGUKICBAcGFyYW0ge051bWJlcn0gZW5kICAgZW5kIG9mIHRoZSBpbnRlcnZhbCB0byBjcmVhdGUKICBAcGFyYW0ge1N0cmluZ3xOdW1iZXJ9IFtpZF0gaWRlbnRpZmllciB0byBkaXN0aW5ndWlzaCBpbnRlcnZhbHMuIEF1dG9tYXRpY2FsbHkgZGVmaWVuZCB3aGVuIG5vdCBzZXQuCiAgQHJldHVybiB7SW50ZXJ2YWx9CiAgICovCgogIEludGVydmFsVHJlZS5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24oc3RhcnQsIGVuZCwgaWQpIHsKICAgIHZhciBpbnRlcnZhbDsKICAgIGlmICh0aGlzLmludGVydmFsc0J5SWRbaWRdICE9IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdpZCAnICsgaWQgKyAnIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4nKTsKICAgIH0KICAgIGlmIChpZCA9PSBudWxsKSB7CiAgICAgIHdoaWxlICh0aGlzLmludGVydmFsc0J5SWRbdGhpcy5pZENhbmRpZGF0ZV0gIT0gbnVsbCkgewogICAgICAgIHRoaXMuaWRDYW5kaWRhdGUrKzsKICAgICAgfQogICAgICBpZCA9IHRoaXMuaWRDYW5kaWRhdGU7CiAgICB9CiAgICBVdGlsLmFzc2VydE51bWJlcihzdGFydCwgJzFzdCBhcmd1bWVudCBvZiBJbnRlcnZhbFRyZWUjYWRkKCknKTsKICAgIFV0aWwuYXNzZXJ0TnVtYmVyKGVuZCwgJzJuZCBhcmd1bWVudCBvZiBJbnRlcnZhbFRyZWUjYWRkKCknKTsKICAgIGlmIChzdGFydCA+PSBlbmQpIHsKICAgICAgVXRpbC5hc3NlcnRPcmRlcihzdGFydCwgZW5kLCAnc3RhcnQnLCAnZW5kJyk7CiAgICB9CiAgICBpbnRlcnZhbCA9IG5ldyBJbnRlcnZhbChzdGFydCwgZW5kLCBpZCk7CiAgICB0aGlzLnBvaW50VHJlZS5pbnNlcnQobmV3IFBvaW50KGludGVydmFsLnN0YXJ0LCBpZCkpOwogICAgdGhpcy5wb2ludFRyZWUuaW5zZXJ0KG5ldyBQb2ludChpbnRlcnZhbC5lbmQsIGlkKSk7CiAgICB0aGlzLmludGVydmFsc0J5SWRbaWRdID0gaW50ZXJ2YWw7CiAgICByZXR1cm4gdGhpcy5pbnNlcnQoaW50ZXJ2YWwsIHRoaXMucm9vdCk7CiAgfTsKCgogIC8qKgogIHNlYXJjaCBpbnRlcnZhbHMKICB3aGVuIG9ubHkgb25lIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gaW50ZXJ2YWxzIHdoaWNoIGNvbnRhaW5zIHRoZSB2YWx1ZQogIHdoZW4gdHdvIGFyZ3VtZW50cyBhcmUgZ2l2ZW4sIC4uLgogIAogIEBtZXRob2Qgc2VhcmNoCiAgQHB1YmxpYwogIEBwYXJhbSB7TnVtYmVyfSB2YWwxCiAgQHBhcmFtIHtOdW1iZXJ9IHZhbDIKICBAcmV0dXJuIHtBcnJheShJbnRlcnZhbCl9IGludGVydmFscwogICAqLwoKICBJbnRlcnZhbFRyZWUucHJvdG90eXBlLnNlYXJjaCA9IGZ1bmN0aW9uKHZhbDEsIHZhbDIpIHsKICAgIFV0aWwuYXNzZXJ0TnVtYmVyKHZhbDEsICcxc3QgYXJndW1lbnQgYXQgSW50ZXJ2YWxUcmVlI3NlYXJjaCgpJyk7CiAgICBpZiAodmFsMiA9PSBudWxsKSB7CiAgICAgIHJldHVybiB0aGlzLnBvaW50U2VhcmNoKHZhbDEpOwogICAgfSBlbHNlIHsKICAgICAgVXRpbC5hc3NlcnROdW1iZXIodmFsMiwgJzJuZCBhcmd1bWVudCBhdCBJbnRlcnZhbFRyZWUjc2VhcmNoKCknKTsKICAgICAgVXRpbC5hc3NlcnRPcmRlcih2YWwxLCB2YWwyLCAnMXN0IGFyZ3VtZW50JywgJzJuZCBhcmd1bWVudCcsICdJbnRlcnZhbFRyZWUjc2VhcmNoKCknKTsKICAgICAgcmV0dXJuIHRoaXMucmFuZ2VTZWFyY2godmFsMSwgdmFsMik7CiAgICB9CiAgfTsKCgogIC8qKgogIHJlbW92ZXMgYW4gaW50ZXJ2YWwgb2YgdGhlIGdpdmVuIGlkCiAgCiAgQG1ldGhvZCByZW1vdmUKICBAcHVibGljCiAgQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSBpZCBpZCBvZiB0aGUgaW50ZXJ2YWwgdG8gcmVtb3ZlCiAgICovCgogIEludGVydmFsVHJlZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaWQpIHsKICAgIHZhciBpbnRlcnZhbCwgbm9kZTsKICAgIGludGVydmFsID0gdGhpcy5pbnRlcnZhbHNCeUlkW2lkXTsKICAgIGlmIChpbnRlcnZhbCA9PSBudWxsKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIG5vZGUgPSB0aGlzLm5vZGVzQnlJZFtpZF07CiAgICBub2RlLnJlbW92ZShpbnRlcnZhbCk7CiAgICBkZWxldGUgdGhpcy5ub2Rlc0J5SWRbaWRdOwogICAgcmV0dXJuIGRlbGV0ZSB0aGlzLmludGVydmFsc0J5SWRbaWRdOwogIH07CgoKICAvKioKICBzZWFyY2ggaW50ZXJ2YWxzIGF0IHRoZSBnaXZlbiBub2RlCiAgCiAgQG1ldGhvZCBwb2ludFNlYXJjaAogIEBwdWJsaWMKICBAcGFyYW0ge051bWJlcn0gdmFsCiAgQHBhcmFtIHtOb2RlfSBbbm9kZV0gY3VycmVudCBub2RlIHRvIHNlYXJjaC4gZGVmYXVsdCBpcyB0aGlzLnJvb3QKICBAcmV0dXJuIHtBcnJheShJbnRlcnZhbCl9CiAgICovCgogIEludGVydmFsVHJlZS5wcm90b3R5cGUucG9pbnRTZWFyY2ggPSBmdW5jdGlvbih2YWwsIG5vZGUsIHJlc3VsdHMpIHsKICAgIGlmIChub2RlID09IG51bGwpIHsKICAgICAgbm9kZSA9IHRoaXMucm9vdDsKICAgIH0KICAgIGlmIChyZXN1bHRzID09IG51bGwpIHsKICAgICAgcmVzdWx0cyA9IFtdOwogICAgfQogICAgVXRpbC5hc3NlcnROdW1iZXIodmFsLCAnMXN0IGFyZ3VtZW50IG9mIEludGVydmFsVHJlZSNwb2ludFNlYXJjaCgpJyk7CiAgICBpZiAodmFsIDwgbm9kZS5jZW50ZXIpIHsKICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KG5vZGUuc3RhcnRQb2ludFNlYXJjaCh2YWwpKTsKICAgICAgaWYgKG5vZGUubGVmdCAhPSBudWxsKSB7CiAgICAgICAgcmV0dXJuIHRoaXMucG9pbnRTZWFyY2godmFsLCBub2RlLmxlZnQsIHJlc3VsdHMpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICB9CiAgICB9CiAgICBpZiAodmFsID4gbm9kZS5jZW50ZXIpIHsKICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuY29uY2F0KG5vZGUuZW5kUG9pbnRTZWFyY2godmFsKSk7CiAgICAgIGlmIChub2RlLnJpZ2h0ICE9IG51bGwpIHsKICAgICAgICByZXR1cm4gdGhpcy5wb2ludFNlYXJjaCh2YWwsIG5vZGUucmlnaHQsIHJlc3VsdHMpOwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0cy5jb25jYXQobm9kZS5nZXRBbGxJbnRlcnZhbHMoKSk7CiAgfTsKCgogIC8qKgogIHJldHVybnMgaW50ZXJ2YWxzIHdoaWNoIGNvdmVycyB0aGUgZ2l2ZW4gc3RhcnQtZW5kIGludGVydmFsCiAgCiAgQG1ldGhvZCByYW5nZVNlYXJjaAogIEBwdWJsaWMKICBAcGFyYW0ge051bWJlcn0gc3RhcnQgc3RhcnQgb2YgdGhlIGludGVydmFsCiAgQHBhcmFtIHtOdW1iZXJ9IGVuZCBlbmQgb2YgdGhlIGludGVydmFsCiAgQHJldHVybiB7QXJyYXkoSW50ZXJ2YWwpfQogICAqLwoKICBJbnRlcnZhbFRyZWUucHJvdG90eXBlLnJhbmdlU2VhcmNoID0gZnVuY3Rpb24oc3RhcnQsIGVuZCkgewogICAgdmFyIGZpcnN0UG9zLCBpLCBpZCwgaW50ZXJ2YWwsIGosIGxhc3RQb3MsIGxlbiwgbGVuMSwgcG9pbnQsIHJlZiwgcmVmMSwgcmVzdWx0c0J5SWQ7CiAgICBVdGlsLmFzc2VydE51bWJlcihzdGFydCwgJzFzdCBhcmd1bWVudCBhdCBJbnRlcnZhbFRyZWUjcmFuZ2VTZWFyY2goKScpOwogICAgVXRpbC5hc3NlcnROdW1iZXIoZW5kLCAnMm5kIGFyZ3VtZW50IGF0IEludGVydmFsVHJlZSNyYW5nZVNlYXJjaCgpJyk7CiAgICBVdGlsLmFzc2VydE9yZGVyKHN0YXJ0LCBlbmQsICcxc3QgYXJndW1lbnQnLCAnMm5kIGFyZ3VtZW50JywgJ0ludGVydmFsVHJlZSNyYW5nZVNlYXJjaCgpJyk7CiAgICByZXN1bHRzQnlJZCA9IHt9OwogICAgcmVmID0gdGhpcy5wb2ludFNlYXJjaChzdGFydCk7CiAgICBmb3IgKGkgPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgICAgaW50ZXJ2YWwgPSByZWZbaV07CiAgICAgIHJlc3VsdHNCeUlkW2ludGVydmFsLmlkXSA9IGludGVydmFsOwogICAgfQogICAgZmlyc3RQb3MgPSB0aGlzLnBvaW50VHJlZS5maXJzdFBvc2l0aW9uT2YobmV3IFBvaW50KHN0YXJ0KSk7CiAgICBsYXN0UG9zID0gdGhpcy5wb2ludFRyZWUubGFzdFBvc2l0aW9uT2YobmV3IFBvaW50KGVuZCkpOwogICAgcmVmMSA9IHRoaXMucG9pbnRUcmVlLnNsaWNlKGZpcnN0UG9zLCBsYXN0UG9zICsgMSk7CiAgICBmb3IgKGogPSAwLCBsZW4xID0gcmVmMS5sZW5ndGg7IGogPCBsZW4xOyBqKyspIHsKICAgICAgcG9pbnQgPSByZWYxW2pdOwogICAgICByZXN1bHRzQnlJZFtwb2ludC5pZF0gPSB0aGlzLmludGVydmFsc0J5SWRbcG9pbnQuaWRdOwogICAgfQogICAgcmV0dXJuIChmdW5jdGlvbigpIHsKICAgICAgdmFyIHJlc3VsdHMxOwogICAgICByZXN1bHRzMSA9IFtdOwogICAgICBmb3IgKGlkIGluIHJlc3VsdHNCeUlkKSB7CiAgICAgICAgaW50ZXJ2YWwgPSByZXN1bHRzQnlJZFtpZF07CiAgICAgICAgcmVzdWx0czEucHVzaChpbnRlcnZhbCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdHMxOwogICAgfSkoKTsKICB9OwoKCiAgLyoqCiAgaW5zZXJ0IGludGVydmFsIHRvIHRoZSBnaXZlbiBub2RlCiAgCiAgQG1ldGhvZCBpbnNlcnQKICBAcHJpdmF0ZQogIEBwYXJhbSB7SW50ZXJ2YWx9IGludGVydmFsCiAgQHBhcmFtIHtOb2RlfSBub2RlIG5vZGUgdG8gaW5zZXJ0IHRoZSBpbnRlcnZhbAogIEByZXR1cm4ge0ludGVydmFsfSBpbnNlcnRlZCBpbnRlcnZhbAogICAqLwoKICBJbnRlcnZhbFRyZWUucHJvdG90eXBlLmluc2VydCA9IGZ1bmN0aW9uKGludGVydmFsLCBub2RlKSB7CiAgICBpZiAoaW50ZXJ2YWwuZW5kIDwgbm9kZS5jZW50ZXIpIHsKICAgICAgaWYgKG5vZGUubGVmdCA9PSBudWxsKSB7CiAgICAgICAgbm9kZS5sZWZ0ID0gdGhpcy5jcmVhdGVOb2RlKGludGVydmFsLmVuZCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuaW5zZXJ0KGludGVydmFsLCBub2RlLmxlZnQpOwogICAgfQogICAgaWYgKG5vZGUuY2VudGVyIDwgaW50ZXJ2YWwuc3RhcnQpIHsKICAgICAgaWYgKG5vZGUucmlnaHQgPT0gbnVsbCkgewogICAgICAgIG5vZGUucmlnaHQgPSB0aGlzLmNyZWF0ZU5vZGUoaW50ZXJ2YWwuc3RhcnQpOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLmluc2VydChpbnRlcnZhbCwgbm9kZS5yaWdodCk7CiAgICB9CiAgICBub2RlLmluc2VydChpbnRlcnZhbCk7CiAgICB0aGlzLm5vZGVzQnlJZFtpbnRlcnZhbC5pZF0gPSBub2RlOwogICAgcmV0dXJuIGludGVydmFsOwogIH07CgoKICAvKioKICBjcmVhdGUgbm9kZSBieSBjZW50ZXIKICAKICBAbWV0aG9kIGNyZWF0ZU5vZGUKICBAcHJpdmF0ZQogIEBwYXJhbSB7TnVtYmVyfSBjZW50ZXIKICBAcmV0dXJuIHtOb2RlfSBub2RlCiAgICovCgogIEludGVydmFsVHJlZS5wcm90b3R5cGUuY3JlYXRlTm9kZSA9IGZ1bmN0aW9uKGNlbnRlcikgewogICAgdmFyIG5vZGU7CiAgICBub2RlID0gbmV3IE5vZGUoY2VudGVyKTsKICAgIHRoaXMubm9kZXNCeUNlbnRlcltjZW50ZXJdID0gbm9kZTsKICAgIHJldHVybiBub2RlOwogIH07CgogIHJldHVybiBJbnRlcnZhbFRyZWU7Cgp9KSgpOwoKbW9kdWxlLmV4cG9ydHMgPSBJbnRlcnZhbFRyZWU7Cgp9LHsiLi9pbnRlcnZhbCI6MiwiLi9ub2RlIjozLCIuL3BvaW50Ijo0LCIuL3NvcnRlZC1saXN0Ijo1LCIuL3V0aWwiOjZ9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKCi8qKgppbnRlcnZhbCwgY29udGFpbmluZyBzdGFydCBhbmQgYW5kCgpAY2xhc3MgSW50ZXJ2YWwKQG1vZHVsZSBpbnRlcnZhbC10cmVlMgogKi8KdmFyIEludGVydmFsOwoKSW50ZXJ2YWwgPSAoZnVuY3Rpb24oKSB7CgogIC8qKgogIEBjb25zdHJ1Y3RvcgogIEBwYXJhbSB7TnVtYmVyfSBzdGFydCBzdGFydCBvZiB0aGUgaW50ZXJ2YWwKICBAcGFyYW0ge051bWJlcn0gZW5kIGVuZCBvZiB0aGUgaW50ZXJ2YWwKICBAcGFyYW0ge051bWJlcnxTdHJpbmd9IGlkIGlkIG9mIHRoZSBpbnRlcnZhbAogICAqLwogIGZ1bmN0aW9uIEludGVydmFsKHN0YXJ0LCBlbmQsIGlkKSB7CiAgICB0aGlzLnN0YXJ0ID0gc3RhcnQ7CiAgICB0aGlzLmVuZCA9IGVuZDsKICAgIHRoaXMuaWQgPSBpZDsKICB9CgoKICAvKioKICBnZXQgY2VudGVyIG9mIHRoZSBpbnRlcnZhbAogIAogIEBtZXRob2QgY2VudGVyCiAgQHJldHVybiB7TnVtYmVyfSBjZW50ZXIKICAgKi8KCiAgSW50ZXJ2YWwucHJvdG90eXBlLmNlbnRlciA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuICh0aGlzLnN0YXJ0ICsgdGhpcy5lbmQpIC8gMjsKICB9OwoKICByZXR1cm4gSW50ZXJ2YWw7Cgp9KSgpOwoKbW9kdWxlLmV4cG9ydHMgPSBJbnRlcnZhbDsKCn0se31dLDM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgTm9kZSwgU29ydGVkTGlzdDsKClNvcnRlZExpc3QgPSByZXF1aXJlKCcuL3NvcnRlZC1saXN0Jyk7CgoKLyoqCm5vZGUgb2YgSW50ZXJ2YWxUcmVlLCBjb250YWluaW5nIGludGVydmFsc2oKCkBjbGFzcyBOb2RlCkBtb2R1bGUgaW50ZXJ2YWwtdHJlZTIKICovCgpOb2RlID0gKGZ1bmN0aW9uKCkgewoKICAvKioKICBAY29uc3RydWN0b3IKICBAcGFyYW0ge051bWJlcn0gY2VudGVyIGNlbnRlciBvZiB0aGUgbm9kZQogICAqLwogIGZ1bmN0aW9uIE5vZGUoY2VudGVyKSB7CiAgICB0aGlzLmNlbnRlciA9IGNlbnRlcjsKCiAgICAvKioKICAgIGFub3RoZXIgbm9kZSB3aG9zZSBjZW50ZXIgaXMgbGVzcyB0aGFuIHRoaXMuY2VudGVyCiAgICAKICAgIEBwcm9wZXJ0eSB7Tm9kZX0gbGVmdAogICAgICovCiAgICB0aGlzLmxlZnQgPSBudWxsOwoKICAgIC8qKgogICAgYW5vdGhlciBub2RlIHdob3NlIGNlbnRlciBpcyBncmVhdGVyIHRoYW4gdGhpcy5jZW50ZXIKICAgIAogICAgQHByb3BlcnR5IHtOb2RlfSByaWdodAogICAgICovCiAgICB0aGlzLnJpZ2h0ID0gbnVsbDsKCiAgICAvKioKICAgIHNvcnRlZCBsaXN0IG9mIEludGVydmFscywgc29ydGluZyB0aGVtIGJ5IHRoZWlyIHN0YXJ0IHByb3BlcnR5CiAgICAKICAgIEBwcm9wZXJ0eSB7U29ydGVkTGlzdChJbnRlcnZhbCl9IHN0YXJ0cwogICAgICovCiAgICB0aGlzLnN0YXJ0cyA9IG5ldyBTb3J0ZWRMaXN0KCdzdGFydCcpOwoKICAgIC8qKgogICAgc29ydGVkIGxpc3Qgb2YgSW50ZXJ2YWxzLCBzb3J0aW5nIHRoZW0gYnkgdGhlaXIgZW5kIHByb3BlcnR5CiAgICAKICAgIEBwcm9wZXJ0eSB7U29ydGVkTGlzdChJbnRlcnZhbCl9IGVuZHMKICAgICAqLwogICAgdGhpcy5lbmRzID0gbmV3IFNvcnRlZExpc3QoJ2VuZCcpOwogIH0KCgogIC8qKgogIHRoZSBudW1iZXIgb2YgaW50ZXJ2YWxzCiAgCiAgQG1ldGhvZCBjb3VudAogIEByZXR1cm4ge051bWJlcn0KICAgKi8KCiAgTm9kZS5wcm90b3R5cGUuY291bnQgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnN0YXJ0cy5sZW5ndGg7CiAgfTsKCgogIC8qKgogIGluc2VydCBhbiBpbnRlcnZhbAogIAogIEBtZXRob2QgaW5zZXJ0CiAgQHBhcmFtIHtJbnRlcnZhbH0gaW50ZXJ2YWwKICAgKi8KCiAgTm9kZS5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24oaW50ZXJ2YWwpIHsKICAgIHRoaXMuc3RhcnRzLmluc2VydChpbnRlcnZhbCk7CiAgICByZXR1cm4gdGhpcy5lbmRzLmluc2VydChpbnRlcnZhbCk7CiAgfTsKCgogIC8qKgogIGdldCBpbnRlcnZhbHMgd2hvc2Ugc3RhcnQgcG9zaXRpb24gaXMgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSBnaXZlbiB2YWx1ZQogIAogIEBtZXRob2Qgc3RhcnRQb2ludFNlYXJjaAogIEBwYXJhbSB7TnVtYmVyfSB2YWwKICBAcmV0dXJuIHtBcnJheShJbnRlcnZhbCl9CiAgICovCgogIE5vZGUucHJvdG90eXBlLnN0YXJ0UG9pbnRTZWFyY2ggPSBmdW5jdGlvbih2YWwpIHsKICAgIHZhciBpbmRleDsKICAgIGluZGV4ID0gdGhpcy5zdGFydHMubGFzdFBvc2l0aW9uT2YoewogICAgICBzdGFydDogdmFsCiAgICB9KTsKICAgIHJldHVybiB0aGlzLnN0YXJ0cy5zbGljZSgwLCBpbmRleCArIDEpOwogIH07CgoKICAvKioKICBnZXQgaW50ZXJ2YWxzIHdob3NlIGVuZCBwb3NpdGlvbiBpcyBtb3JlIHRoYW4gb3IgZXF1YWwgdG8gdGhlIGdpdmVuIHZhbHVlCiAgCiAgQG1ldGhvZCBlbmRQb2ludFNlYXJjaAogIEBwYXJhbSB7TnVtYmVyfSB2YWwKICBAcmV0dXJuIHtBcnJheShJbnRlcnZhbCl9CiAgICovCgogIE5vZGUucHJvdG90eXBlLmVuZFBvaW50U2VhcmNoID0gZnVuY3Rpb24odmFsKSB7CiAgICB2YXIgaW5kZXg7CiAgICBpbmRleCA9IHRoaXMuZW5kcy5maXJzdFBvc2l0aW9uT2YoewogICAgICBlbmQ6IHZhbAogICAgfSk7CiAgICByZXR1cm4gdGhpcy5lbmRzLnNsaWNlKGluZGV4KTsKICB9OwoKCiAgLyoqCiAgZ2V0cyBhbGwgcmVnaXN0ZXJlZCBpbnRlcnZhbAogIAogIEBtZXRob2QgZ2V0QWxsSW50ZXJ2YWxzCiAgQHJldHVybiB7QXJyYXkoSW50ZXJ2YWwpfQogICAqLwoKICBOb2RlLnByb3RvdHlwZS5nZXRBbGxJbnRlcnZhbHMgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiB0aGlzLnN0YXJ0cy50b0FycmF5KCk7CiAgfTsKCgogIC8qKgogIHJlbW92ZSB0aGUgZ2l2ZW4gaW50ZXJ2YWwKICAKICBAbWV0aG9kIHJlbW92ZQogIEBwYXJhbSB7SW50ZXJ2YWx9IGludGVydmFsCiAgQHBhcmFtIHtTb3J0ZWRMaXN0fSBsaXN0CiAgICovCgogIE5vZGUucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGludGVydmFsKSB7CiAgICB0aGlzLnJlbW92ZUZyb21MaXN0KGludGVydmFsLCB0aGlzLnN0YXJ0cyk7CiAgICByZXR1cm4gdGhpcy5yZW1vdmVGcm9tTGlzdChpbnRlcnZhbCwgdGhpcy5lbmRzKTsKICB9OwoKCiAgLyoqCiAgcmVtb3ZlIHRoZSBnaXZlbiBpbnRlcnZhbCBmcm9tIHRoZSBnaXZlbiBsaXN0CiAgCiAgQG1ldGhvZCByZW1vdmVGcm9tTGlzdAogIEBwcml2YXRlCiAgQHBhcmFtIHtJbnRlcnZhbH0gaW50ZXJ2YWwKICBAcGFyYW0ge1NvcnRlZExpc3R9IGxpc3QKICAgKi8KCiAgTm9kZS5wcm90b3R5cGUucmVtb3ZlRnJvbUxpc3QgPSBmdW5jdGlvbihpbnRlcnZhbCwgbGlzdCkgewogICAgdmFyIGNhbmRpZGF0ZSwgZmlyc3RQb3MsIGksIGlkeCwgcmVmLCByZWYxLCByZXN1bHRzOwogICAgZmlyc3RQb3MgPSBsaXN0LmZpcnN0UG9zaXRpb25PZihpbnRlcnZhbCk7CiAgICByZXN1bHRzID0gW107CiAgICBmb3IgKGlkeCA9IGkgPSByZWYgPSBmaXJzdFBvcywgcmVmMSA9IGxpc3QubGVuZ3RoOyByZWYgPD0gcmVmMSA/IGkgPCByZWYxIDogaSA+IHJlZjE7IGlkeCA9IHJlZiA8PSByZWYxID8gKytpIDogLS1pKSB7CiAgICAgIGNhbmRpZGF0ZSA9IGxpc3RbaWR4XTsKICAgICAgaWYgKGNhbmRpZGF0ZS5pZCA9PT0gaW50ZXJ2YWwuaWQpIHsKICAgICAgICBsaXN0LnJlbW92ZShpZHgpOwogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgewogICAgICAgIHJlc3VsdHMucHVzaCh2b2lkIDApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0czsKICB9OwoKICByZXR1cm4gTm9kZTsKCn0pKCk7Cgptb2R1bGUuZXhwb3J0cyA9IE5vZGU7Cgp9LHsiLi9zb3J0ZWQtbGlzdCI6NX1dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoKLyoqCm51bWJlciB3aXRoIGlkCgpAY2xhc3MgUG9pbnQKQG1vZHVsZSBpbnRlcnZhbC10cmVlMgogKi8KdmFyIFBvaW50OwoKUG9pbnQgPSAoZnVuY3Rpb24oKSB7CgogIC8qKgogIEBjb25zdHJ1Y3RvcgogIEBwYXJhbSB7TnVtYmVyfSB2YWwgbnVtYmVyCiAgQHBhcmFtIHtOdW1iZXJ8U3RyaW5nfSBpZCBpZAogICAqLwogIGZ1bmN0aW9uIFBvaW50KHZhbCwgaWQpIHsKICAgIHRoaXMudmFsID0gdmFsOwogICAgdGhpcy5pZCA9IGlkOwogIH0KCiAgcmV0dXJuIFBvaW50OwoKfSkoKTsKCm1vZHVsZS5leHBvcnRzID0gUG9pbnQ7Cgp9LHt9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKCi8qKgpleHRlbmRlZCBhcnJheSBvZiBvYmplY3RzLCBhbHdheXMgc29ydGVkCgpAY2xhc3MgU29ydGVkTGlzdApAZXh0ZW5kcyBBcnJheQpAbW9kdWxlIGludGVydmFsLXRyZWUyCiAqLwp2YXIgU29ydGVkTGlzdCwKICBleHRlbmQgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKGhhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH0sCiAgaGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5OwoKU29ydGVkTGlzdCA9IChmdW5jdGlvbihzdXBlckNsYXNzKSB7CiAgZXh0ZW5kKFNvcnRlZExpc3QsIHN1cGVyQ2xhc3MpOwoKCiAgLyoqCiAgQGNvbnN0cnVjdG9yCiAgQHBhcmFtIHtTdHJpbmd9IGNvbXBhcmVLZXkga2V5IG5hbWUgdG8gY29tcGFyZSBvYmplY3RzLiBUaGUgdmFsdWUgb2YgdGhlIGtleSBtdXN0IGJlIGEgbnVtYmVyLgogICAqLwoKCiAgLyoqCiAga2V5IG5hbWUgdG8gY29tcGFyZSBvYmplY3RzLiBUaGUgdmFsdWUgb2YgdGhlIGtleSBtdXN0IGJlIGEgbnVtYmVyLgogIEBwcm9wZXJ0eSB7U3RyaW5nfSBjb21wYXJlS2V5CiAgICovCgogIGZ1bmN0aW9uIFNvcnRlZExpc3QoY29tcGFyZUtleSkgewogICAgdGhpcy5jb21wYXJlS2V5ID0gY29tcGFyZUtleTsKICB9CgoKICAvKioKICBpbnNlcnQgYSB2YWx1ZQogIAogIEBtZXRob2QgaW5zZXJ0CiAgQHBhcmFtIHthbnl9IHZhbAogIEByZXR1cm4ge051bWJlcn0gaW5zZXJ0ZWQgcG9zaXRpb24KICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUuaW5zZXJ0ID0gZnVuY3Rpb24odmFsKSB7CiAgICB2YXIgcG9zOwogICAgcG9zID0gdGhpcy5ic2VhcmNoKHZhbCk7CiAgICB0aGlzLnNwbGljZShwb3MgKyAxLCAwLCB2YWwpOwogICAgcmV0dXJuIHBvcyArIDE7CiAgfTsKCgogIC8qKgogIHJlbW92ZSB0aGUgdmFsdWUgaW4gdGhlIGdpdmVuIHBvc2l0aW9uCiAgCiAgQG1ldGhvZCByZW1vdmUKICBAcGFyYW0ge051bWJlcn0gcG9zIHBvc2l0aW9uCiAgQHJldHVybiB7U29ydGVkTGlzdH0gc2VsZgogICAqLwoKICBTb3J0ZWRMaXN0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbihwb3MpIHsKICAgIHRoaXMuc3BsaWNlKHBvcywgMSk7CiAgICByZXR1cm4gdGhpczsKICB9OwoKCiAgLyoqCiAgZ2V0IG1heGltdW0gdmFsdWUgaW4gdGhlIGxpc3QKICAKICBAbWV0aG9kIG1heAogIEByZXR1cm4ge051bWJlcn0KICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUubWF4ID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcmVmOwogICAgcmV0dXJuIChyZWYgPSB0aGlzW3RoaXMubGVuZ3RoIC0gMV0pICE9IG51bGwgPyByZWZbdGhpcy5jb21wYXJlS2V5XSA6IHZvaWQgMDsKICB9OwoKCiAgLyoqCiAgZ2V0IG1pbmltdW0gdmFsdWUgaW4gdGhlIGxpc3QKICAKICBAbWV0aG9kIG1pbgogIEByZXR1cm4ge051bWJlcn0KICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUubWluID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgcmVmOwogICAgcmV0dXJuIChyZWYgPSB0aGlzWzBdKSAhPSBudWxsID8gcmVmW3RoaXMuY29tcGFyZUtleV0gOiB2b2lkIDA7CiAgfTsKCgogIC8qKgogIGJpbmFyeSBzZWFyY2gKICAKICBAbWV0aG9kIGJzZWFyY2gKICBAcGFyYW0ge2FueX0gdmFsCiAgQHJldHVybiB7TnVtYmVyfSBwb3NpdGlvbiBvZiB0aGUgdmFsdWUKICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUuYnNlYXJjaCA9IGZ1bmN0aW9uKHZhbCkgewogICAgdmFyIGNvbXAsIGVwb3MsIG1wb3MsIG12YWwsIHNwb3M7CiAgICBpZiAoIXRoaXMubGVuZ3RoKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIG1wb3MgPSBudWxsOwogICAgbXZhbCA9IG51bGw7CiAgICBzcG9zID0gMDsKICAgIGVwb3MgPSB0aGlzLmxlbmd0aDsKICAgIHdoaWxlIChlcG9zIC0gc3BvcyA+IDEpIHsKICAgICAgbXBvcyA9IE1hdGguZmxvb3IoKHNwb3MgKyBlcG9zKSAvIDIpOwogICAgICBtdmFsID0gdGhpc1ttcG9zXTsKICAgICAgY29tcCA9IHRoaXMuY29tcGFyZSh2YWwsIG12YWwpOwogICAgICBpZiAoY29tcCA9PT0gMCkgewogICAgICAgIHJldHVybiBtcG9zOwogICAgICB9CiAgICAgIGlmIChjb21wID4gMCkgewogICAgICAgIHNwb3MgPSBtcG9zOwogICAgICB9IGVsc2UgewogICAgICAgIGVwb3MgPSBtcG9zOwogICAgICB9CiAgICB9CiAgICBpZiAoc3BvcyA9PT0gMCAmJiB0aGlzLmNvbXBhcmUodGhpc1swXSwgdmFsKSA+IDApIHsKICAgICAgcmV0dXJuIC0xOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIHNwb3M7CiAgICB9CiAgfTsKCgogIC8qKgogIGxlZnRtb3N0IHBvc2l0aW9uIG9mIHRoZSBnaXZlbiB2YWwKICAKICBAbWV0aG9kIGZpcnN0UG9zaXRpb25PZgogIEBwYXJhbSB7YW55fSB2YWwKICBAcmV0dXJuIHtOdW1iZXJ9IGxlZnRtb3N0IHBvc2l0aW9uIG9mIHRoZSB2YWx1ZQogICAqLwoKICBTb3J0ZWRMaXN0LnByb3RvdHlwZS5maXJzdFBvc2l0aW9uT2YgPSBmdW5jdGlvbih2YWwpIHsKICAgIHZhciBpbmRleCwgbnVtLCByZWY7CiAgICBpbmRleCA9IHRoaXMuYnNlYXJjaCh2YWwpOwogICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBudW0gPSB2YWxbdGhpcy5jb21wYXJlS2V5XTsKICAgIGlmIChudW0gPT09ICgocmVmID0gdGhpc1tpbmRleF0pICE9IG51bGwgPyByZWZbdGhpcy5jb21wYXJlS2V5XSA6IHZvaWQgMCkpIHsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBpZiAoaW5kZXggPD0gMCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzW2luZGV4IC0gMV1bdGhpcy5jb21wYXJlS2V5XSA8IG51bSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGluZGV4LS07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGluZGV4Kys7CiAgICB9CiAgICByZXR1cm4gaW5kZXg7CiAgfTsKCgogIC8qKgogIHJpZ2h0bW9zdCBwb3NpdGlvbiBvZiB0aGUgZ2l2ZW4gdmFsCiAgCiAgQG1ldGhvZCBsYXN0UG9zaXRpb25PZgogIEBwYXJhbSB7YW55fSB2YWwKICBAcmV0dXJuIHtOdW1iZXJ9IHJpZ2h0bW9zdCBwb3NpdGlvbiBvZiB0aGUgdmFsdWUKICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUubGFzdFBvc2l0aW9uT2YgPSBmdW5jdGlvbih2YWwpIHsKICAgIHZhciBpbmRleCwgbnVtOwogICAgaW5kZXggPSB0aGlzLmJzZWFyY2godmFsKTsKICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgbnVtID0gdmFsW3RoaXMuY29tcGFyZUtleV07CiAgICBpZiAoaW5kZXggPT09IHRoaXMubGVuZ3RoIC0gMSAmJiBudW0gPiB0aGlzLm1heCgpKSB7CiAgICAgIHJldHVybiBpbmRleCArIDE7CiAgICB9CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoaW5kZXggKyAxID49IHRoaXMubGVuZ3RoKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHRoaXNbaW5kZXggKyAxXVt0aGlzLmNvbXBhcmVLZXldID4gbnVtKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaW5kZXgrKzsKICAgIH0KICAgIHJldHVybiBpbmRleDsKICB9OwoKCiAgLyoqCiAgICogc29ydGVkLnRvQXJyYXkoKQogICAqIGdldCByYXcgYXJyYXkKICAgKgogICAqLwoKICBTb3J0ZWRMaXN0LnByb3RvdHlwZS50b0FycmF5ID0gZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gdGhpcy5zbGljZSgpOwogIH07CgoKICAvKioKICBjb21wYXJpc29uIGZ1bmN0aW9uLiBDb21wYXJlcyB0d28gb2JqZWN0cyBieSB0aGlzLmNvbXBhcmVLZXkKICAKICBAbWV0aG9kIGNvbXBhcmUKICBAcHJpdmF0ZQogIEBwYXJhbSB7YW55fSBhCiAgQHBhcmFtIHthbnl9IGIKICAgKi8KCiAgU29ydGVkTGlzdC5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHZhciBjOwogICAgaWYgKGEgPT0gbnVsbCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBpZiAoYiA9PSBudWxsKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgYyA9IGFbdGhpcy5jb21wYXJlS2V5XSAtIGJbdGhpcy5jb21wYXJlS2V5XTsKICAgIGlmIChjID4gMCkgewogICAgICByZXR1cm4gMTsKICAgIH0gZWxzZSBpZiAoYyA9PT0gMCkgewogICAgICByZXR1cm4gMDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICB9OwoKICByZXR1cm4gU29ydGVkTGlzdDsKCn0pKEFycmF5KTsKCm1vZHVsZS5leHBvcnRzID0gU29ydGVkTGlzdDsKCn0se31dLDY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgVXRpbDsKClV0aWwgPSAoZnVuY3Rpb24oKSB7CiAgZnVuY3Rpb24gVXRpbCgpIHt9CgogIFV0aWwuYXNzZXJ0TnVtYmVyID0gZnVuY3Rpb24odmFsLCBkZXNjKSB7CiAgICBpZiAodmFsID09IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGRlc2MgKyAnIGlzIHJlcXVpcmVkLicpOwogICAgfQogICAgaWYgKHR5cGVvZiB2YWwgIT09ICdudW1iZXInKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihkZXNjICsgJyBtdXN0IGJlIGEgbnVtYmVyLicpOwogICAgfQogIH07CgogIFV0aWwuYXNzZXJ0T3JkZXIgPSBmdW5jdGlvbihzdGFydCwgZW5kLCBzdGFydE5hbWUsIGVuZE5hbWUsIGRlc2MpIHsKICAgIGlmIChzdGFydCA+PSBlbmQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGRlc2MgKyAiOiAiICsgc3RhcnROYW1lICsgIigiICsgc3RhcnQgKyAiKSBtdXN0IGJlIHNtYWxsZXIgdGhhbiAiICsgZW5kTmFtZSArICIoIiArIGVuZCArICIpLiIpOwogICAgfQogIH07CgogIHJldHVybiBVdGlsOwoKfSkoKTsKCm1vZHVsZS5leHBvcnRzID0gVXRpbDsKCn0se31dLDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpTb3J0ZWRMaXN0ID0gcmVxdWlyZSgnLi9pbnRlcnZhbF90cmVlX3JlcXVpcmVtZW50cy9zb3J0ZWQtbGlzdCcpOwpJbnRlcnZhbFRyZWUgPSByZXF1aXJlKCcuL2ludGVydmFsX3RyZWVfcmVxdWlyZW1lbnRzL2ludGVydmFsLXRyZWUnKTsKfSx7Ii4vaW50ZXJ2YWxfdHJlZV9yZXF1aXJlbWVudHMvaW50ZXJ2YWwtdHJlZSI6MSwiLi9pbnRlcnZhbF90cmVlX3JlcXVpcmVtZW50cy9zb3J0ZWQtbGlzdCI6NX1dfSx7fSxbN10pOwo="></script>
<script src="data:application/x-javascript;base64,Ly8gRG93bmxvYWRzIGFuIFNWRyBvbiB0aGUgd2VicGFnZSwgYWNjZXNzZWQgYnkgaXRzIGNsYXNzIG5hbWUKZnVuY3Rpb24gZG93bmxvYWRTVkcoc3ZnQ2xhc3NOYW1lKSB7CnZhciBkb2N0eXBlID0gJzw/eG1sIHZlcnNpb249IjEuMCIgc3RhbmRhbG9uZT0ibm8iPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPic7CgogIHdpbmRvdy5VUkwgPSAod2luZG93LlVSTCB8fCB3aW5kb3cud2Via2l0VVJMKTsKCiAgdmFyIGJvZHkgPSBkb2N1bWVudC5ib2R5OwoKICB2YXIgcHJlZml4ID0gewogICAgeG1sbnM6ICJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3htbG5zLyIsCiAgICB4bGluazogImh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiLAogICAgc3ZnOiAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgfQoKICBpbml0aWFsaXplKCk7CgogIGZ1bmN0aW9uIGluaXRpYWxpemUoKSB7CiAgICB2YXIgZG9jdW1lbnRzID0gW3dpbmRvdy5kb2N1bWVudF0sCiAgICAgICAgU1ZHU291cmNlcyA9IFtdOwogICAgICAgIGlmcmFtZXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCJpZnJhbWUiKSwKICAgICAgICBvYmplY3RzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgib2JqZWN0Iik7CgogICAgW10uZm9yRWFjaC5jYWxsKGlmcmFtZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgIHRyeSB7CiAgICAgICAgaWYgKGVsLmNvbnRlbnREb2N1bWVudCkgewogICAgICAgICAgZG9jdW1lbnRzLnB1c2goZWwuY29udGVudERvY3VtZW50KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2goZXJyKSB7CiAgICAgICAgY29uc29sZS5sb2coZXJyKQogICAgICB9CiAgICB9KTsKCiAgICBbXS5mb3JFYWNoLmNhbGwob2JqZWN0cywgZnVuY3Rpb24oZWwpIHsKICAgICAgdHJ5IHsKICAgICAgICBpZiAoZWwuY29udGVudERvY3VtZW50KSB7CiAgICAgICAgICBkb2N1bWVudHMucHVzaChlbC5jb250ZW50RG9jdW1lbnQpOwogICAgICAgIH0KICAgICAgfSBjYXRjaChlcnIpIHsKICAgICAgICBjb25zb2xlLmxvZyhlcnIpCiAgICAgIH0KICAgIH0pOwoKICAgIGRvY3VtZW50cy5mb3JFYWNoKGZ1bmN0aW9uKGRvYykgewogICAgICB2YXIgc3R5bGVzID0gZ2V0U3R5bGVzKGRvYyk7CiAgICAgIHZhciBuZXdTb3VyY2VzID0gZ2V0U291cmNlcyhkb2MsIHN0eWxlcyk7CiAgICAgIC8vIGJlY2F1c2Ugb2YgcHJvdG90eXBlIG9uIE5ZVCBwYWdlcwogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld1NvdXJjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBTVkdTb3VyY2VzLnB1c2gobmV3U291cmNlc1tpXSk7CiAgICAgIH07CiAgICB9KQogICAgaWYgKFNWR1NvdXJjZXMubGVuZ3RoID4gMSkgewogICAgICBjcmVhdGVQb3BvdmVyKFNWR1NvdXJjZXMpOwogICAgfSBlbHNlIGlmIChTVkdTb3VyY2VzLmxlbmd0aCA+IDApIHsKICAgICAgZG93bmxvYWQoU1ZHU291cmNlc1swXSk7CiAgICB9IGVsc2UgewogICAgICBhbGVydCgiVGhlIENyb3diYXIgY291bGRu4oCZdCBmaW5kIGFueSBTVkcgbm9kZXMuIik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBjcmVhdGVQb3BvdmVyKHNvdXJjZXMpIHsKICAgIGNsZWFudXAoKTsKCiAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oczEpIHsKICAgICAgc291cmNlcy5mb3JFYWNoKGZ1bmN0aW9uKHMyKSB7CiAgICAgICAgaWYgKHMxICE9PSBzMikgewogICAgICAgICAgaWYgKChNYXRoLmFicyhzMS50b3AgLSBzMi50b3ApIDwgMzgpICYmIChNYXRoLmFicyhzMS5sZWZ0IC0gczIubGVmdCkgPCAzOCkpIHsKICAgICAgICAgICAgczIudG9wICs9IDM4OwogICAgICAgICAgICBzMi5sZWZ0ICs9IDM4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkKICAgIH0pOwoKICAgIHZhciBidXR0b25zQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICBib2R5LmFwcGVuZENoaWxkKGJ1dHRvbnNDb250YWluZXIpOwoKICAgIGJ1dHRvbnNDb250YWluZXIuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzdmctY3Jvd2JhciIpOwogICAgYnV0dG9uc0NvbnRhaW5lci5zdHlsZVsiei1pbmRleCJdID0gMWU3OwogICAgYnV0dG9uc0NvbnRhaW5lci5zdHlsZVsicG9zaXRpb24iXSA9ICJhYnNvbHV0ZSI7CiAgICBidXR0b25zQ29udGFpbmVyLnN0eWxlWyJ0b3AiXSA9IDA7CiAgICBidXR0b25zQ29udGFpbmVyLnN0eWxlWyJsZWZ0Il0gPSAwOwoKCgogICAgdmFyIGJhY2tncm91bmQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIGJvZHkuYXBwZW5kQ2hpbGQoYmFja2dyb3VuZCk7CgogICAgYmFja2dyb3VuZC5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInN2Zy1jcm93YmFyIik7CiAgICBiYWNrZ3JvdW5kLnN0eWxlWyJiYWNrZ3JvdW5kIl0gPSAicmdiYSgyNTUsIDI1NSwgMjU1LCAwLjcpIjsKICAgIGJhY2tncm91bmQuc3R5bGVbInBvc2l0aW9uIl0gPSAiZml4ZWQiOwogICAgYmFja2dyb3VuZC5zdHlsZVsibGVmdCJdID0gMDsKICAgIGJhY2tncm91bmQuc3R5bGVbInRvcCJdID0gMDsKICAgIGJhY2tncm91bmQuc3R5bGVbIndpZHRoIl0gPSAiMTAwJSI7CiAgICBiYWNrZ3JvdW5kLnN0eWxlWyJoZWlnaHQiXSA9ICIxMDAlIjsKCiAgICBzb3VyY2VzLmZvckVhY2goZnVuY3Rpb24oZCwgaSkgewogICAgICB2YXIgYnV0dG9uV3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBidXR0b25zQ29udGFpbmVyLmFwcGVuZENoaWxkKGJ1dHRvbldyYXBwZXIpOwogICAgICBidXR0b25XcmFwcGVyLnNldEF0dHJpYnV0ZSgiY2xhc3MiLCAic3ZnLWNyb3diYXIiKTsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsicG9zaXRpb24iXSA9ICJhYnNvbHV0ZSI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbInRvcCJdID0gKGQudG9wICsgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApICsgInB4IjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsibGVmdCJdID0gKGRvY3VtZW50LmJvZHkuc2Nyb2xsTGVmdCArIGQubGVmdCkgKyAicHgiOwogICAgICBidXR0b25XcmFwcGVyLnN0eWxlWyJwYWRkaW5nIl0gPSAiNHB4IjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiYm9yZGVyLXJhZGl1cyJdID0gIjNweCI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbImNvbG9yIl0gPSAid2hpdGUiOwogICAgICBidXR0b25XcmFwcGVyLnN0eWxlWyJ0ZXh0LWFsaWduIl0gPSAiY2VudGVyIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiZm9udC1mYW1pbHkiXSA9ICInSGVsdmV0aWNhIE5ldWUnIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiYmFja2dyb3VuZCJdID0gInJnYmEoMCwgMCwgMCwgMC44KSI7CiAgICAgIGJ1dHRvbldyYXBwZXIuc3R5bGVbImJveC1zaGFkb3ciXSA9ICIwcHggNHB4IDE4cHggcmdiYSgwLCAwLCAwLCAwLjQpIjsKICAgICAgYnV0dG9uV3JhcHBlci5zdHlsZVsiY3Vyc29yIl0gPSAibW92ZSI7CiAgICAgIGJ1dHRvbldyYXBwZXIudGV4dENvbnRlbnQgPSAgIlNWRyAjIiArIGkgKyAiOiAiICsgKGQuaWQgPyAiIyIgKyBkLmlkIDogIiIpICsgKGQuY2xhc3MgPyAiLiIgKyBkLmNsYXNzIDogIiIpOwoKICAgICAgdmFyIGJ1dHRvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImJ1dHRvbiIpOwogICAgICBidXR0b25XcmFwcGVyLmFwcGVuZENoaWxkKGJ1dHRvbik7CiAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoImRhdGEtc291cmNlLWlkIiwgaSkKICAgICAgYnV0dG9uLnN0eWxlWyJ3aWR0aCJdID0gIjE1MHB4IjsKICAgICAgYnV0dG9uLnN0eWxlWyJmb250LXNpemUiXSA9ICIxMnB4IjsKICAgICAgYnV0dG9uLnN0eWxlWyJsaW5lLWhlaWdodCJdID0gIjEuNGVtIjsKICAgICAgYnV0dG9uLnN0eWxlWyJtYXJnaW4iXSA9ICI1cHggMCAwIDAiOwogICAgICBidXR0b24udGV4dENvbnRlbnQgPSAiRG93bmxvYWQiOwoKICAgICAgYnV0dG9uLm9uY2xpY2sgPSBmdW5jdGlvbihlbCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKGVsLCBkLCBpLCBzb3VyY2VzKQogICAgICAgIGRvd25sb2FkKGQpOwogICAgICB9OwoKICAgIH0pOwoKICB9CgogIGZ1bmN0aW9uIGNsZWFudXAoKSB7CiAgICB2YXIgY3Jvd2JhckVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgiLnN2Zy1jcm93YmFyIik7CgogICAgW10uZm9yRWFjaC5jYWxsKGNyb3diYXJFbGVtZW50cywgZnVuY3Rpb24oZWwpIHsKICAgICAgZWwucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlbCk7CiAgICB9KTsKICB9CgoKICBmdW5jdGlvbiBnZXRTb3VyY2VzKGRvYywgc3R5bGVzKSB7CiAgICB2YXIgc3ZnSW5mbyA9IFtdLAogICAgICAgIHN2ZyA9IGRvYy5xdWVyeVNlbGVjdG9yKCIuIiArIHN2Z0NsYXNzTmFtZSk7CgogICAgc3R5bGVzID0gKHN0eWxlcyA9PT0gdW5kZWZpbmVkKSA/ICIiIDogc3R5bGVzOwoKCiAgICBzdmcuc2V0QXR0cmlidXRlKCJ2ZXJzaW9uIiwgIjEuMSIpOwoKICAgIHZhciBkZWZzRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkZWZzIik7CiAgICBzdmcuaW5zZXJ0QmVmb3JlKGRlZnNFbCwgc3ZnLmZpcnN0Q2hpbGQpOyAvL1RPRE8gICAuaW5zZXJ0KCJkZWZzIiwgIjpmaXJzdC1jaGlsZCIpCiAgICAvLyBkZWZzRWwuc2V0QXR0cmlidXRlKCJjbGFzcyIsICJzdmctY3Jvd2JhciIpOwoKICAgIHZhciBzdHlsZUVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3R5bGUiKQogICAgZGVmc0VsLmFwcGVuZENoaWxkKHN0eWxlRWwpOwogICAgc3R5bGVFbC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dC9jc3MiKTsKCgogICAgLy8gcmVtb3ZpbmcgYXR0cmlidXRlcyBzbyB0aGV5IGFyZW4ndCBkb3VibGVkIHVwCiAgICBzdmcucmVtb3ZlQXR0cmlidXRlKCJ4bWxucyIpOwogICAgc3ZnLnJlbW92ZUF0dHJpYnV0ZSgieGxpbmsiKTsKCiAgICAvLyBUaGVzZSBhcmUgbmVlZGVkIGZvciB0aGUgc3ZnCiAgICBpZiAoIXN2Zy5oYXNBdHRyaWJ1dGVOUyhwcmVmaXgueG1sbnMsICJ4bWxucyIpKSB7CiAgICAgIHN2Zy5zZXRBdHRyaWJ1dGVOUyhwcmVmaXgueG1sbnMsICJ4bWxucyIsIHByZWZpeC5zdmcpOwogICAgfQoKICAgIGlmICghc3ZnLmhhc0F0dHJpYnV0ZU5TKHByZWZpeC54bWxucywgInhtbG5zOnhsaW5rIikpIHsKICAgICAgc3ZnLnNldEF0dHJpYnV0ZU5TKHByZWZpeC54bWxucywgInhtbG5zOnhsaW5rIiwgcHJlZml4LnhsaW5rKTsKICAgIH0KCiAgICB2YXIgc291cmNlID0gKG5ldyBYTUxTZXJpYWxpemVyKCkpLnNlcmlhbGl6ZVRvU3RyaW5nKHN2ZykucmVwbGFjZSgnPC9zdHlsZT4nLCAnPCFbQ0RBVEFbJyArIHN0eWxlcyArICddXT48L3N0eWxlPicpOwogICAgdmFyIHJlY3QgPSBzdmcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAgICBzdmdJbmZvLnB1c2goewogICAgICB0b3A6IHJlY3QudG9wLAogICAgICBsZWZ0OiByZWN0LmxlZnQsCiAgICAgIHdpZHRoOiByZWN0LndpZHRoLAogICAgICBoZWlnaHQ6IHJlY3QuaGVpZ2h0LAogICAgICBjbGFzczogc3ZnLmdldEF0dHJpYnV0ZSgiY2xhc3MiKSwKICAgICAgaWQ6IHN2Zy5nZXRBdHRyaWJ1dGUoImlkIiksCiAgICAgIGNoaWxkRWxlbWVudENvdW50OiBzdmcuY2hpbGRFbGVtZW50Q291bnQsCiAgICAgIHNvdXJjZTogW2RvY3R5cGUgKyBzb3VyY2VdCiAgICB9KTsKCiAgICByZXR1cm4gc3ZnSW5mbzsKICB9CgogIGZ1bmN0aW9uIGRvd25sb2FkKHNvdXJjZSkgewogICAgdmFyIGZpbGVuYW1lID0gInVudGl0bGVkIjsKCiAgICBpZiAoc291cmNlLmlkKSB7CiAgICAgIGZpbGVuYW1lID0gc291cmNlLmlkOwogICAgfSBlbHNlIGlmIChzb3VyY2UuY2xhc3MpIHsKICAgICAgZmlsZW5hbWUgPSBzb3VyY2UuY2xhc3M7CiAgICB9IGVsc2UgaWYgKHdpbmRvdy5kb2N1bWVudC50aXRsZSkgewogICAgICBmaWxlbmFtZSA9IHdpbmRvdy5kb2N1bWVudC50aXRsZS5yZXBsYWNlKC9bXmEtejAtOV0vZ2ksICctJykudG9Mb3dlckNhc2UoKTsKICAgIH0KCiAgICB2YXIgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwobmV3IEJsb2Ioc291cmNlLnNvdXJjZSwgeyAidHlwZSIgOiAidGV4dFwveG1sIiB9KSk7CgogICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJhIik7CiAgICBib2R5LmFwcGVuZENoaWxkKGEpOwogICAgYS5zZXRBdHRyaWJ1dGUoImNsYXNzIiwgInN2Zy1jcm93YmFyIik7CiAgICBhLnNldEF0dHJpYnV0ZSgiZG93bmxvYWQiLCBmaWxlbmFtZSArICIuc3ZnIik7CiAgICBhLnNldEF0dHJpYnV0ZSgiaHJlZiIsIHVybCk7CiAgICBhLnN0eWxlWyJkaXNwbGF5Il0gPSAibm9uZSI7CiAgICBhLmNsaWNrKCk7CgogICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgd2luZG93LlVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKICAgIH0sIDEwKTsKICB9CgogIGZ1bmN0aW9uIGdldFN0eWxlcyhkb2MpIHsKICAgIHZhciBzdHlsZXMgPSAiIiwKICAgICAgICBzdHlsZVNoZWV0cyA9IGRvYy5zdHlsZVNoZWV0czsKCiAgICBpZiAoc3R5bGVTaGVldHMpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzdHlsZVNoZWV0cy5sZW5ndGg7IGkrKykgewogICAgICAgIHByb2Nlc3NTdHlsZVNoZWV0KHN0eWxlU2hlZXRzW2ldKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHByb2Nlc3NTdHlsZVNoZWV0KHNzKSB7CiAgICAgIGlmIChzcy5jc3NSdWxlcykgewogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3MuY3NzUnVsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIHZhciBydWxlID0gc3MuY3NzUnVsZXNbaV07CiAgICAgICAgICBpZiAocnVsZS50eXBlID09PSAzKSB7CiAgICAgICAgICAgIC8vIEltcG9ydCBSdWxlCiAgICAgICAgICAgIHByb2Nlc3NTdHlsZVNoZWV0KHJ1bGUuc3R5bGVTaGVldCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBoYWNrIGZvciBpbGx1c3RyYXRvciBjcmFzaGluZyBvbiBkZXNjZW5kZW50IHNlbGVjdG9ycwogICAgICAgICAgICBpZiAocnVsZS5zZWxlY3RvclRleHQpIHsKICAgICAgICAgICAgICBpZiAocnVsZS5zZWxlY3RvclRleHQuaW5kZXhPZigiPiIpID09PSAtMSkgewogICAgICAgICAgICAgICAgc3R5bGVzICs9ICJcbiIgKyBydWxlLmNzc1RleHQ7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3R5bGVzOwogIH0KfQ=="></script>
<link href="data:text/css;charset=utf-8,%0A%2EtsPlot%2Einactive%20%7B%0Afill%3A%20%23E4E4E4%3B%0Astroke%3A%20%23B7B7B7%3B%0A%7D%0A%2ElegendTreeNode%2Einactive%20%7B%0Afill%3A%20%23FFFFFF%3B%0Astroke%3A%20%23D3D3D3%3B%0A%7D%0A%2ElegendTreeNode%2Egtype%5FphantomRoot%20%7B%0Apointer%2Devents%3A%20none%3B%0Afill%2Dopacity%3A%200%3B%0Astroke%2Dopacity%3A%200%3B%0A%7D%0A%2EgeneTableDIV%20%7B%0Aoverflow%3A%20scroll%3B%0A%7D%0Atd%2C%20tr%2C%20th%20%7B%0Afont%2Dfamily%3A%20Arial%3B%0A%7D%0A%2EdataTables%5Finfo%20%7B%0Afont%2Dfamily%3A%20Arial%3B%20color%3A%20%27%239E9A9A%27%3B%0A%7D%0Alabel%20%7B%0Afont%2Dfamily%3A%20Arial%3B%0A%7D%0A%2EmutationTableDIV%20%2EdataTable%20thead%20th%20%7B%0Afont%2Dweight%3A%20normal%3B%0A%7D%0Atable%20%7B%0Atable%2Dlayout%3A%20fixed%0A%7D%0Atd%20%7B%0Aword%2Dwrap%3A%20break%2Dword%0A%7D%0A%0A%2Esorting%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fasc%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fdesc%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%2Esorting%5Fdisabled%20%7B%0Atext%2Dalign%3A%20left%0A%7D%0A%0A%0A%2Ed3%2Dtip%20%7B%0Aline%2Dheight%3A%201%3B%0Afont%2Dfamily%3A%20Arial%3B%0Apadding%3A%2012px%3B%0Abackground%3A%20%237C7C7C%3B%0Acolor%3A%20%23fff%3B%0Aborder%2Dradius%3A%202px%3B%0A%7D%0A%0A%2Ed3%2Dtip%3Aafter%20%7B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0Adisplay%3A%20inline%3B%0Afont%2Dsize%3A%2010px%3B%0Awidth%3A%20100%25%3B%0Aline%2Dheight%3A%201%3B%0Acolor%3A%20%237C7C7C%3B%0Acontent%3A%20%22%5C25BC%22%3B%0Aposition%3A%20absolute%3B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%0A%2Ed3%2Dtip%2En%3Aafter%20%7B%0Amargin%3A%20%2D1px%200%200%200%3B%0Atop%3A%20100%25%3B%0Aleft%3A%200%3B%0A%7D" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyogZnVuY3Rpb24gdG8gcnVuIHRpbWVzY2FwZQoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciB0aGlzIHZpZXcKKiBAcGFyYW0ge051bWJlcn0gd2lkdGggLS0gd2lkdGggb2YgdGhlIHZpZXcKKiBAcGFyYW0ge051bWJlcn0gaGVpZ2h0IC0tIGhlaWdodCBvZiB0aGUgdmlldwoqIEBwYXJhbSB7T2JqZWN0fSB1c2VyQ29uZmlnIC0tIHVzZXIgY29uZmlndXJhdGlvbnMKKi8KZnVuY3Rpb24gX3J1bl90aW1lc2NhcGUodmlld19pZCwgd2lkdGgsIGhlaWdodCwgdXNlckNvbmZpZykgewoKCS8vIGRlZmF1bHRzCgl2YXIgZGVmYXVsdHMgPSB7CgkgICAgcGFkZGluZ0dlbmVyYWw6IDE1LAoJICAgIGxlZ2VuZFdpZHRoOiAxMTAsCgkgICAgdHJlZUhlaWdodDogMTAwLAoJICAgIHRyZWVXaWR0aDogMTAwLAoJICAgIG1heF9yOiA3LCAvLyBtYXhpbXVtIHJhZGl1cyBmb3IgbGVnZW5kIHRyZWUgbm9kZXMKCSAgICBtaW5fcjogMS41LCAvLyBtaW5pbXVtIHJhZGl1cyBmb3IgbGVnZW5kIHRyZWUgbm9kZXMKCSAgICB4QXhpc0hlaWdodDogMzAsCgkgICAgeUF4aXNXaWR0aDogMjAsCgkgICAgc21hbGxNYXJnaW46IDUsCgkgICAgdHJhbnNpdGlvblNwZWVkOiAyMDAsCgkgICAgaXNQb3BPdmVyVmlzaWJsZTogZmFsc2UsCgkgICAgYnV0dG9uOiBmYWxzZSwKCSAgICBncmlkc3RlckJhc2VEaW1lbnNpb246IDEyMCwKCSAgICBwYW5lbF93aWR0aDogMzAsCgkgICAgZm9udFNpemU6IDExLAoJICAgIGNpcmNsZVI6IDIwLAoJICAgIHRocmVzaG9sZDogMC4wMDUsIC8vIGNlbGx1bGFyIHByZXZhbGVuY2UgdGhyZXNob2xkIG9mIHZpc3VhbCBkZXRlY3Rpb24KCSAgICBsZWdlbmRHdHlwZUhlaWdodDogMTMsIC8vIGhlaWdodCBmb3IgZWFjaCBnZW5vdHlwZSBpbiB0aGUgbGVnZW5kCgkgICAgY2xvbmFsVHJhamVjdG9yeUxhYmVsSGVpZ2h0OiA0MiwKCSAgICBjdXJDbG9uZUlEczogW10sIC8vIGFycmF5IG9mIGNsb25lIGlkcyBjdXJyZW50bHkgaW4gdGhlIG11dGF0aW9uIHRhYmxlCgkgICAgbkNsaWNrZWROb2RlczogMCwgLy8gbnVtYmVyIG9mIGNsaWNrZWQgbm9kZXMKCSAgICBwaGFudG9tUm9vdDogInBoYW50b21Sb290IiwKCSAgICB0cmVlTGlua0NvbG91cjogIiNEM0QzRDMiLAoJICAgIHRvcEJhckhlaWdodDogMzAsIC8vIGhlaWdodCBvZiB0b3AgcGFuZWwKCSAgICB0b3BCYXJDb2xvdXI6ICIjRDlEOUQ5IiwKCSAgICB0b3BCYXJIaWdobGlnaHQ6ICIjQzZDNkM2IiwKCSAgICB2aWV3VGl0bGU6ICJUSU1FU0NBUEUiLAoJICAgIHRpdGxlRm9udFNpemU6IDE1Cgl9OwoKCXZpek9iai50cyA9IHt9OyAvLyB2aXpPYmogZm9yIHRpbWVzY2FwZQoJdmFyIGN1clZpek9iaiA9IHZpek9iai50czsKCWN1clZpek9iai52aWV3X2lkID0gdmlld19pZDsKCWN1clZpek9iai5kYXRhID0ge307CgljdXJWaXpPYmoudmlldyA9IHt9OwoKCS8vIHNldCBjb25maWd1cmF0aW9ucwoJY3VyVml6T2JqLmdlbmVyYWxDb25maWcgPSAkLmV4dGVuZCh0cnVlLCB7fSwgZGVmYXVsdHMpOwoJdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCS8vIGdldCBwYXJhbXMgZnJvbSBSCgljdXJWaXpPYmoudXNlckNvbmZpZyA9IHVzZXJDb25maWc7CgoJLy8gY29uZmlndXJhdGlvbiBiYXNlZCBvbiBhdmFpbGFibGUgZGF0YQoJZGltLmNhbnZhc1NWR1dpZHRoID0gd2lkdGg7CglkaW0uY2FudmFzU1ZHSGVpZ2h0ID0gaGVpZ2h0IC0gZGltLnRvcEJhckhlaWdodDsKCWRpbS50c1NWR0hlaWdodCA9ICghY3VyVml6T2JqLnVzZXJDb25maWcubXV0YXRpb25zX3Byb3ZpZGVkKSA/IAoJICAgICAgICAgICAgICAgICAgICBkaW0uY2FudmFzU1ZHSGVpZ2h0IC0gZGltLnhBeGlzSGVpZ2h0IC0gZGltLnNtYWxsTWFyZ2luIC0gZGltLnBhZGRpbmdHZW5lcmFsKjI6CgkgICAgICAgICAgICAgICAgICAgIDI1MDsKCWRpbS50c1NWR1dpZHRoID0gZGltLmNhbnZhc1NWR1dpZHRoIC0gZGltLmxlZ2VuZFdpZHRoIC0gZGltLnlBeGlzV2lkdGggLSBkaW0uc21hbGxNYXJnaW4gLSBkaW0ucGFkZGluZ0dlbmVyYWw7CglkaW0ueEF4aXNXaWR0aCA9IGRpbS50c1NWR1dpZHRoOwoJZGltLnlBeGlzSGVpZ2h0ID0gZGltLnRzU1ZHSGVpZ2h0OwoJZGltLm11dGF0aW9uVGFibGVIZWlnaHQgPSBkaW0uY2FudmFzU1ZHSGVpZ2h0IC0gZGltLnRzU1ZHSGVpZ2h0IC0gZGltLnNtYWxsTWFyZ2luIC0gMjUgLSBkaW0ueEF4aXNIZWlnaHQ7CglkaW0ubXV0YXRpb25UYWJsZVdpZHRoID0gZGltLnRzU1ZHV2lkdGg7CgoJLy8gYWRqdXN0IGNhbnZhcyBTVkcgaGVpZ2h0IGlmIG11dGF0aW9uIHRhYmxlIGlzIHByZXNlbnQKCWRpbS5jYW52YXNTVkdIZWlnaHQgLT0gKCFjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpID8gCgkgICAgICAgICAgICAgICAgICAgICAgICAwIDogCgkgICAgICAgICAgICAgICAgICAgICAgICBkaW0ubXV0YXRpb25UYWJsZUhlaWdodDsKCgljb25zb2xlLmxvZygidGltZXNjYXBlIGN1clZpek9iaiIpOwoJY29uc29sZS5sb2coY3VyVml6T2JqKTsKCgkvLyBTRVQgVVAgUEFHRSBMQVlPVVQKCgl2YXIgdG9wQmFyRElWID0gZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLmFwcGVuZCgiZGl2IikKCSAgICAuYXR0cigiY2xhc3MiLCAidG9wQmFyRElWIikKCSAgICAuc3R5bGUoInBvc2l0aW9uIiwgInJlbGF0aXZlIikKCSAgICAuc3R5bGUoIndpZHRoIiwgd2lkdGggKyAicHgiKQoJICAgIC5zdHlsZSgiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCArICJweCIpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJdmFyIGNhbnZhc0RJViA9IGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5hcHBlbmQoImRpdiIpCgkgICAgLnN0eWxlKCJoZWlnaHQiLCBkaW0uY2FudmFzU1ZHSGVpZ2h0ICsgInB4IikKCSAgICAuc3R5bGUoIndpZHRoIiwgd2lkdGggKyAicHgiKQoJICAgIC5hdHRyKCJjbGFzcyIsICJkaXYiKQoJICAgIC5hdHRyKCJpZCIsIHZpZXdfaWQpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJY3VyVml6T2JqLnZpZXcubXV0YXRpb25UYWJsZURJViA9IGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKQoJICAgIC5hcHBlbmQoImRpdiIpCgkgICAgLmF0dHIoImNsYXNzIiwgIm11dGF0aW9uVGFibGVESVYiKQoJICAgIC5zdHlsZSgicG9zaXRpb24iLCAicmVsYXRpdmUiKQoJICAgIC5zdHlsZSgid2lkdGgiLCBkaW0ubXV0YXRpb25UYWJsZVdpZHRoICsgInB4IikKCSAgICAuc3R5bGUoImhlaWdodCIsIGRpbS5tdXRhdGlvblRhYmxlSGVpZ2h0ICsgInB4IikKCSAgICAuc3R5bGUoImxlZnQiLCAoZGltLnlBeGlzV2lkdGggKyBkaW0uc21hbGxNYXJnaW4pICsgInB4IikKCSAgICAuc3R5bGUoImZsb2F0IiwgImxlZnQiKTsKCgkvLyBjYW52YXMgZm9yIGltYWdlIHBuZyBvdXRwdXQKCXZhciBjYW52YXMgPSBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuYXBwZW5kKCJjYW52YXMiKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkaW0uY2FudmFzU1ZHSGVpZ2h0ICsgInB4IikKCSAgICAuYXR0cigid2lkdGgiLCB3aWR0aCArICJweCIpCgkgICAgLmF0dHIoInN0eWxlIiwgImRpc3BsYXk6bm9uZSIpOwoKCS8vIFBMT1QgVE9QIFBBTkVMCgoJLy8gc3ZnCgl2YXIgdG9wQmFyU1ZHID0gdG9wQmFyRElWLmFwcGVuZCgic3ZnOnN2ZyIpCgkgICAgLmF0dHIoImNsYXNzIiwgInRvcEJhcl8iICsgdmlld19pZCkKCSAgICAuYXR0cigieCIsIDApCgkgICAgLmF0dHIoInkiLCAwKQoJICAgIC5hdHRyKCJ3aWR0aCIsIHdpZHRoICsgInB4IikKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCArICJweCIpOwoKCS8vIGJhY2tncm91bmQgYmFyCgl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCSAgICAuYXR0cigieCIsMCkKCSAgICAuYXR0cigieSIsMCkKCSAgICAuYXR0cigid2lkdGgiLCB3aWR0aCArICJweCIpCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS50b3BCYXJIZWlnaHQpCgkgICAgLmF0dHIoInJ4IiwgMTApCgkgICAgLmF0dHIoInJ5IiwgMTApCgkgICAgLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKTsKCiAJLy8gdG9wIHBhbmVsIHRpdGxlCiAgICB0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAuYXR0cigieCIsIDEwKQogICAgICAgIC5hdHRyKCJ5IiwgZGltLnRvcEJhckhlaWdodC8yKQogICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJzdGFydCIpCiAgICAgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKQogICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgLmF0dHIoImZpbGwiLCAid2hpdGUiKQogICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKQogICAgICAgIC50ZXh0KGRpbS52aWV3VGl0bGUpOwoKCXZhciBkb3dubG9hZEJ1dHRvbldpZHRoID0gODA7IC8vIHdpZHRoIG9mIHRoZSB0b3AgcGFuZWwgZG93bmxvYWQgYnV0dG9uCgl2YXIgcmVzZXRCdXR0b25XaWR0aCA9IDQyOyAvLyB3aWR0aCBvZiB0aGUgdG9wIHBhbmVsIHJlc2V0IGJ1dHRvbgoKCXZhciByZXNldEJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSkRZWEJoWHpFaUlIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eU1EQXdMM04yWnlJZ2VHMXNibk02ZUd4cGJtczlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MekU1T1RrdmVHeHBibXNpSUhnOUlqQndlQ0lnZVQwaU1IQjRJZzBLQ1NCM2FXUjBhRDBpTlRFeWNIZ2lJR2hsYVdkb2REMGlOVEV5Y0hnaUlIWnBaWGRDYjNnOUlqQWdNQ0ExTVRJZ05URXlJaUJsYm1GaWJHVXRZbUZqYTJkeWIzVnVaRDBpYm1WM0lEQWdNQ0ExTVRJZ05URXlJaUI0Yld3NmMzQmhZMlU5SW5CeVpYTmxjblpsSWo0TkNqeG5QZzBLQ1R4d1lYUm9JR1pwYkd3OUlpTkdSa1pHUmtZaUlHUTlJazAwTXpJdU9UYzFMRGd3TGpBek5HTXRNamN1T1RrNExUSTNMamsyTXkwMk1DNDVNall0TkRjdU9EWXRPVFl1TURNM0xUVTVMamMyTkhZM05TNHhPRGtOQ2drSll6RTJMamt3TkN3NExqUXhOeXd6TWk0NU1qZ3NNVGt1TXpZNUxEUTJMams0TERNekxqUTFObU0zTUM0eE9EZ3NOekF1TWpJMExEY3dMakU0T0N3eE9EUXVNemszTERBc01qVTBMalU0TkdNdE56QXVNVGc1TERjd0xqQTROQzB4T0RRdU1qa3pMRGN3TGpBNE5DMHlOVFF1TlRnM0xEQU5DZ2tKWXkwM01DNHhNVGN0TnpBdU1qVTRMVGN3TGpFeE55MHhPRFF1TXpZeExEQXRNalUwTGpVNE5HTXdMakUzTnkwd0xqSXhNU3d3TGpjMExUQXVOVFl6TERBdU9UZzNMVEF1T0Rob01DNHdOMnczTkM0eU1UY3NPREV1TnpNeFRESXhOQzQxTERndU5VdzRMamt3TlN3ekxqTTFOZzBLQ1Fsc056SXVORFl4TERjMUxqVTRObU10TUM0eU5EY3NNQzQwTWpJdE1DNDJNelFzTUM0NE5EVXRNQzQ1TlRFc01TNHdPVEpqTFRrM0xqTXdOU3c1Tnk0eU55MDVOeTR6TURVc01qVTFMakEzT1N3d0xETTFNaTR6TkRrTkNna0pZemszTGpRME5pdzVOeTR6TnpVc01qVTFMakUxTERrM0xqTTNOU3d6TlRJdU5UWXNNRU0xTXpBdU1qQTVMRE16TlM0eE1UTXNOVE13TGpNeE5Dd3hOemN1TXpBMExEUXpNaTQ1TnpVc09EQXVNRE0wZWlJdlBnMEtQQzluUGcwS1BDOXpkbWMrRFFvPSIKCXZhciBkb3dubG9hZEJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSk1ZWGxsY2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lOQ2drZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElpQjJhV1YzUW05NFBTSXdJREFnTlRFeUlEVXhNaUlnWlc1aFlteGxMV0poWTJ0bmNtOTFibVE5SW01bGR5QXdJREFnTlRFeUlEVXhNaUlnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0RRbzhjRzlzZVdkdmJpQm1hV3hzUFNJalJrWkdSa1pHSWlCd2IybHVkSE05SWpNMU5DNDFMRE16TXk0MUlETXpNeTQxTERNeE15NDFJREkzTVM0NE16VXNNelkxTGpVMk5DQXlOekV1T0RNMUxEY3VPVEUzSURJME1DNHhOalVzTnk0NU1UY2dNalF3TGpFMk5Td3pOalV1TlRZMElERTRNQzQxTERNeE5DNDFJQTBLQ1RFMU55NDFMRE16Tmk0MUlESTFOaXcwTWpZdU1UZzRJQ0l2UGcwS1BIQnZiSGxuYjI0Z1ptbHNiRDBpSTBaR1JrWkdSaUlnY0c5cGJuUnpQU0l5T0M0MUxEUTNNaTQwTVRJZ05EZzVMalVzTkRjeUxqUXhNaUEwT1RBdU5TdzFNRFF1TURneUlESTNMalVzTlRBMExqQTRNaUFpTHo0TkNqeHdiMng1WjI5dUlHWnBiR3c5SWlOR1JrWkdSa1lpSUhCdmFXNTBjejBpTWpZdU5UZ3NNelkyTGpReE1pQTJNeTQwTmpjc016WTJMalF4TWlBMk15NDFORGNzTlRBeUxqVWdNall1TlN3MU1ESXVOU0FpTHo0TkNqeHdiMng1WjI5dUlHWnBiR3c5SWlOR1JrWkdSa1lpSUhCdmFXNTBjejBpTkRVeUxqVXpNeXd6TmpVdU5ERXlJRFE0T1M0ME1Ua3NNelkxTGpReE1pQTBPRGt1TlN3MU1ERXVOU0EwTlRJdU5EVXpMRFV3TVM0MUlDSXZQZzBLUEM5emRtYytEUW89IgoJdmFyIHRpbWVzY2FwZUJ1dHRvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwiICsgIlBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlkWFJtTFRnaVB6NE5DandoTFMwZ1IyVnVaWEpoZEc5eU9pQkJaRzlpWlNCSmJHeDFjM1J5WVhSdmNpQXhOQzR3TGpBc0lGTldSeUJGZUhCdmNuUWdVR3gxWnkxSmJpQXVJRk5XUnlCV1pYSnphVzl1T2lBMkxqQXdJRUoxYVd4a0lEUXpNell6S1NBZ0xTMCtEUW84SVVSUFExUlpVRVVnYzNabklGQlZRa3hKUXlBaUxTOHZWek5ETHk5RVZFUWdVMVpISURFdU1TOHZSVTRpSUNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk5SGNtRndhR2xqY3k5VFZrY3ZNUzR4TDBSVVJDOXpkbWN4TVM1a2RHUWlQZzBLUEhOMlp5QjJaWEp6YVc5dVBTSXhMakVpSUdsa1BTSk1ZWGxsY2w4eElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIaHRiRzV6T25oc2FXNXJQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh4T1RrNUwzaHNhVzVySWlCNFBTSXdjSGdpSUhrOUlqQndlQ0lOQ2drZ2QybGtkR2c5SWpnM01IQjRJaUJvWldsbmFIUTlJakk0TUhCNElpQjJhV1YzUW05NFBTSXdJREFnT0Rjd0lESTRNQ0lnWlc1aFlteGxMV0poWTJ0bmNtOTFibVE5SW01bGR5QXdJREFnT0Rjd0lESTRNQ0lnZUcxc09uTndZV05sUFNKd2NtVnpaWEoyWlNJK0RRbzhaR1ZtY3lBZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpFNU9Ua3ZlR2gwYld3aVBnMEtDVHh6ZEhsc1pTQWdkSGx3WlQwaWRHVjRkQzlqYzNNaVBnMEtDUWs4SVZ0RFJFRlVRVnRkWFQ0TkNnazhMM04wZVd4bFBnMEtQQzlrWldaelBnMEtQR1JsWm5NZ0lIaHRiRzV6UFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hvZEcxc0lqNE5DZ2s4YzNSNWJHVWdJSFI1Y0dVOUluUmxlSFF2WTNOeklqNDhMM04wZVd4bFBnMEtQQzlrWldaelBnMEtQSEJoZEdnZ1ptbHNiRDBpSTBaR1JrWkdSaUlnYzNSeWIydGxQU0lqUmtaR1JrWkdJaUJrUFNKTk5qY3VOU3d4TXpVdU5EZzNZelExTERBc05EVXRNVEkwTGprNE55dzVNQzB4TWpRdU9UZzNiREFzTUdNNU1Dd3dMRGt3TERBc01UZ3dMREJzTUN3d1l6RTRNQ3d3TFRnMUxEQXNPVFVzTUd3d0xEQU5DZ2wyTWpRNUxqazNOV3d3TERCakxURTRNQ3d3TERBc01DMDVOU3d3YkRBc01HTXRPVEFzTUMwNU1Dd3dMVEU0TUN3d2JEQXNNRU14TVRJdU5Td3lOakF1TkRjMUxERXhNaTQxTERFek5TNDBPRGNzTmpjdU5Td3hNelV1TkRnM0lpOCtEUW84WnlCMGNtRnVjMlp2Y20wOUluUnlZVzV6YkdGMFpTZzNOakFzTUNraVBnMEtQQzluUGcwS1BHY2dkSEpoYm5ObWIzSnRQU0owY21GdWMyeGhkR1VvTnpZd0xESXdPQ2tpUGcwS1BDOW5QZzBLUEM5emRtYytEUW89IgoJdmFyIGNsb25hbFRyYWpCdXR0b25fYmFzZTY0ID0gImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsIiArICJQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejROQ2p3aExTMGdSMlZ1WlhKaGRHOXlPaUJCWkc5aVpTQkpiR3gxYzNSeVlYUnZjaUF4TkM0d0xqQXNJRk5XUnlCRmVIQnZjblFnVUd4MVp5MUpiaUF1SUZOV1J5QldaWEp6YVc5dU9pQTJMakF3SUVKMWFXeGtJRFF6TXpZektTQWdMUzArRFFvOElVUlBRMVJaVUVVZ2MzWm5JRkJWUWt4SlF5QWlMUzh2VnpOREx5OUVWRVFnVTFaSElERXVNUzh2UlU0aUlDSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OUhjbUZ3YUdsamN5OVRWa2N2TVM0eEwwUlVSQzl6ZG1jeE1TNWtkR1FpUGcwS1BITjJaeUIyWlhKemFXOXVQU0l4TGpFaUlHbGtQU0pNWVhsbGNsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJTkNna2dkMmxrZEdnOUlqazNNSEI0SWlCb1pXbG5hSFE5SWpJNE1IQjRJaUIyYVdWM1FtOTRQU0l3SURBZ09UY3dJREk0TUNJZ1pXNWhZbXhsTFdKaFkydG5jbTkxYm1ROUltNWxkeUF3SURBZ09UY3dJREk0TUNJZ2VHMXNPbk53WVdObFBTSndjbVZ6WlhKMlpTSStEUW84WkdWbWN5QWdlRzFzYm5NOUltaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUdoMGJXd2lQZzBLQ1R4emRIbHNaU0FnZEhsd1pUMGlkR1Y0ZEM5amMzTWlQZzBLQ1FrOElWdERSRUZVUVZ0ZFhUNE5DZ2s4TDNOMGVXeGxQZzBLUEM5a1pXWnpQZzBLUEdjZ2RISmhibk5tYjNKdFBTSjBjbUZ1YzJ4aGRHVW9NalVzTUNraVBnMEtDVHh3WVhSb0lHWnBiR3c5SWlOR1JrWkdSa1lpSUhOMGNtOXJaVDBpSTBaR1JrWkdSaUlnWkQwaVRTMHlNU3cxTUM0MU1qWmpOemd1TkRFM0xEQXNOemd1TkRFM0xEQXNNVFUyTGpnek15d3diREFzTUVNeU9USXVOalkzTERVd0xqVXlOaXd5T1RJdU5qWTNMREFzTkRRNUxqVXNNR3d3TERBTkNna0pkakV3TVM0d05UUnNNQ3d3WXkweE5UWXVPRE16TERBdE1UVTJMamd6TXkwMU1DNDFNamN0TXpFekxqWTJOeTAxTUM0MU1qZHNNQ3d3UXpVM0xqUXhOeXcxTUM0MU1qWXNOVGN1TkRFM0xEVXdMalV5TmkweU1TdzFNQzQxTWpZaUx6NE5DZ2s4Y0dGMGFDQm1hV3hzUFNJalJrWkdSa1pHSWlCemRISnZhMlU5SWlOR1JrWkdSa1lpSUdROUlrMHRNakVzTWpBMExqTTFNV00zT0M0ME1UY3NNQ3czT0M0ME1UY3ROek11TWpNNExERTFOaTQ0TXpNdE56TXVNak00YkRBc01BMEtDUWxqTVRVMkxqZ3pNeXd3TERFMU5pNDRNek1zTnpNdU1EQTRMRE14TXk0Mk5qY3NOek11TURBNGJEQXNNSFl3TGpRMU5Xd3dMREJqTFRFMU5pNDRNek1zTUMweE5UWXVPRE16TERjekxqQXhNaTB6TVRNdU5qWTNMRGN6TGpBeE1td3dMREFOQ2drSlF6VTNMalF4Tnl3eU56Y3VOVGc0TERVM0xqUXhOeXd5TURRdU16VXhMVEl4TERJd05DNHpOVEVpTHo0TkNqd3ZaejROQ2p4bklIUnlZVzV6Wm05eWJUMGlkSEpoYm5Oc1lYUmxLRGcyTUN3d0tTSStEUW84TDJjK0RRbzhaeUIwY21GdWMyWnZjbTA5SW5SeVlXNXpiR0YwWlNnNE5qQXNNakE0S1NJK0RRbzhMMmMrRFFvOEwzTjJaejROQ2c9PSIKCgl2YXIgcmVzZXRCdXR0b25JY29uV2lkdGggPSBkaW0udG9wQmFySGVpZ2h0IC0gMTA7IC8vIGljb24gc2l6ZSBmb3IgcmVzZXQgYnV0dG9uCgl2YXIgZG93bmxvYWRCdXR0b25JY29uV2lkdGggPSBkaW0udG9wQmFySGVpZ2h0IC0gMTA7IC8vIGljb24gc2l6ZSBmb3IgZG93bmxvYWQgYnV0dG9uCgl2YXIgdGltZXNjYXBlQnV0dG9uSWNvbldpZHRoID0gNTA7IC8vIGljb24gc2l6ZSBmb3IgdGltZXNjYXBlIGJ1dHRvbgoJdmFyIGNsb25hbFRyYWpCdXR0b25JY29uV2lkdGggPSA2MDsgLy8gaWNvbiBzaXplIGZvciB0aW1lc2NhcGUgYnV0dG9uCgoJLy8gU1ZHIGJ1dHRvbgoJdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInN2Z0J1dHRvbiIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGgpCgkgICAgLmF0dHIoInkiLCAwKQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRvd25sb2FkQnV0dG9uV2lkdGgpCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS50b3BCYXJIZWlnaHQpCgkgICAgLmF0dHIoInJ4IiwgMTApCgkgICAgLmF0dHIoInJ5IiwgMTApCgkgICAgLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBzdmcKCSAgICAgICAgZG93bmxvYWRTVkcoInRpbWVzY2FwZV8iICsgdmlld19pZCk7CgkgICAgfSk7Cgl0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKCSAgICAuYXR0cigiY2xhc3MiLCAic3ZnQnV0dG9uVGV4dCIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIDEwKQoJICAgIC5hdHRyKCJ5IiwgZGltLnRvcEJhckhlaWdodC8yKQoJICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJlbmQiKQoJICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKCSAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQoJICAgIC5hdHRyKCJmaWxsIiwgIndoaXRlIikKCSAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCJub25lIikKCSAgICAudGV4dCgiU1ZHIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBkb3dubG9hZEJ1dHRvbl9iYXNlNjQpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGggKyAxMCkKCSAgICAuYXR0cigieSIsIDUpCgkgICAgLmF0dHIoIndpZHRoIiwgZG93bmxvYWRCdXR0b25JY29uV2lkdGgpCgkgICAgLmF0dHIoImhlaWdodCIsIGRvd25sb2FkQnV0dG9uSWNvbldpZHRoKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5zdmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5zdmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBzdmcKCSAgICAgICAgZG93bmxvYWRTVkcoInRpbWVzY2FwZV8iICsgdmlld19pZCk7CgkgICAgfSk7CgoJLy8gUE5HIGJ1dHRvbgoJdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInBuZ0J1dHRvbiIpCgkgICAgLmF0dHIoIngiLCB3aWR0aCAtIGRvd25sb2FkQnV0dG9uV2lkdGgqMikKCSAgICAuYXR0cigieSIsIDApCgkgICAgLmF0dHIoIndpZHRoIiwgZG93bmxvYWRCdXR0b25XaWR0aCkKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCkKCSAgICAuYXR0cigicngiLCAxMCkKCSAgICAuYXR0cigicnkiLCAxMCkKCSAgICAuYXR0cigiZmlsbCIsZGltLnRvcEJhckNvbG91cikKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCl7CgkgICAgICAgIC8vIGRvd25sb2FkIHRoZSBwbmcKCSAgICAgICAgX2Rvd25sb2FkUE5HKCJ0aW1lc2NhcGVfIiArIHZpZXdfaWQsICJ0aW1lc2NhcGVfIiArIHZpZXdfaWQgKyAiLnBuZyIpOwoJICAgIH0pOwoJdG9wQmFyU1ZHLmFwcGVuZCgidGV4dCIpCgkgICAgLmF0dHIoImNsYXNzIiwgInBuZ0J1dHRvblRleHQiKQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSBkb3dubG9hZEJ1dHRvbldpZHRoIC0gMTApCgkgICAgLmF0dHIoInkiLCBkaW0udG9wQmFySGVpZ2h0LzIpCgkgICAgLmF0dHIoInRleHQtYW5jaG9yIiwgImVuZCIpCgkgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKQoJICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCgkgICAgLmF0dHIoImZpbGwiLCAid2hpdGUiKQoJICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKQoJICAgIC50ZXh0KCJQTkciKTsKCXRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKCSAgICAuYXR0cigieGxpbms6aHJlZiIsIGRvd25sb2FkQnV0dG9uX2Jhc2U2NCkKCSAgICAuYXR0cigieCIsIHdpZHRoIC0gMipkb3dubG9hZEJ1dHRvbldpZHRoICsgMTApCgkgICAgLmF0dHIoInkiLCA1KQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRvd25sb2FkQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkb3dubG9hZEJ1dHRvbkljb25XaWR0aCkKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucG5nQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucG5nQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAvLyBkb3dubG9hZCB0aGUgcG5nCgkgICAgICAgIF9kb3dubG9hZFBORygidGltZXNjYXBlXyIgKyB2aWV3X2lkLCAidGltZXNjYXBlXyIgKyB2aWV3X2lkICsgIi5wbmciKTsKCSAgICB9KTsKCgkvLyBUaW1lU2NhcGUgYnV0dG9uCgl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCSAgICAuYXR0cigiY2xhc3MiLCAidHNCdXR0b24iKQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSBkb3dubG9hZEJ1dHRvbldpZHRoKjIgLSByZXNldEJ1dHRvbldpZHRoKQoJICAgIC5hdHRyKCJ5IiwgMCkKCSAgICAuYXR0cigid2lkdGgiLCByZXNldEJ1dHRvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBkaW0udG9wQmFySGVpZ2h0KQoJICAgIC5hdHRyKCJyeCIsIDEwKQoJICAgIC5hdHRyKCJyeSIsIDEwKQoJICAgIC5hdHRyKCJmaWxsIixkaW0udG9wQmFyQ29sb3VyKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKXsKCSAgICAgICAgLy8gY2hhbmdlIHZpZXcKCSAgICAgICAgX3N3ZWVwQ2xpY2soY3VyVml6T2JqKTsKCSAgICAgICAgCgkgICAgfSkKCSAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgLnRleHQoIlZpZXcgU3dpdGNoIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoImNsYXNzIiwgInRpbWVzY2FwZUljb24iKQoJICAgIC5hdHRyKCJ4bGluazpocmVmIiwgdGltZXNjYXBlQnV0dG9uX2Jhc2U2NCkKCSAgICAuYXR0cigieCIsIHdpZHRoIC0gMipkb3dubG9hZEJ1dHRvbldpZHRoIC0gcmVzZXRCdXR0b25XaWR0aCArIDUpCgkgICAgLmF0dHIoInkiLCAtMTApCgkgICAgLmF0dHIoIndpZHRoIiwgdGltZXNjYXBlQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCB0aW1lc2NhcGVCdXR0b25JY29uV2lkdGgpCgkgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRzQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJICAgIH0pCgkgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudHNCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckNvbG91cik7CgkgICAgfSkKCSAgICAuYXR0cigib3BhY2l0eSIsIDApIC8vIHN0YXJ0IHdpdGggb3BhY2l0eSB6ZXJvCgkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAvLyBjaGFuZ2UgdmlldwoJICAgICAgICBfc3dlZXBDbGljayhjdXJWaXpPYmopOwoKCSAgICAgICAgLy8gdHVybiBvZmYgb3BhY2l0eSAmIHBvaW50ZXIgZXZlbnRzCgkgICAgICAgIGQzLnNlbGVjdCh0aGlzKQoJICAgICAgICAgICAgLmF0dHIoIm9wYWNpdHkiLCAwKQoJICAgICAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwgIm5vbmUiKTsKCgkgICAgICAgIC8vIHR1cm4gb24gY2xvbmFsIHRyYWplY3RvcnkgaWNvbiBvcGFjaXR5ICYgcG9pbnRlciBldmVudHMKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmNsb25hbFRyYWpJY29uIikKCSAgICAgICAgICAgIC5hdHRyKCJvcGFjaXR5IiwgMSkKCSAgICAgICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJhdXRvIik7CgkgICAgfSkKCSAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgLnRleHQoIlZpZXcgU3dpdGNoIik7Cgl0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCgkgICAgLmF0dHIoImNsYXNzIiwgImNsb25hbFRyYWpJY29uIikKCSAgICAuYXR0cigieGxpbms6aHJlZiIsIGNsb25hbFRyYWpCdXR0b25fYmFzZTY0KQoJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSAyKmRvd25sb2FkQnV0dG9uV2lkdGggLSByZXNldEJ1dHRvbldpZHRoICsgNSkKCSAgICAuYXR0cigieSIsIC0xNSkKCSAgICAuYXR0cigid2lkdGgiLCBjbG9uYWxUcmFqQnV0dG9uSWNvbldpZHRoKQoJICAgIC5hdHRyKCJoZWlnaHQiLCBjbG9uYWxUcmFqQnV0dG9uSWNvbldpZHRoKQoJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50c0J1dHRvbiIpLmF0dHIoImZpbGwiLCBkaW0udG9wQmFySGlnaGxpZ2h0KTsKCSAgICB9KQoJICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRzQnV0dG9uIikuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJICAgIH0pCgkgICAgLmF0dHIoIm9wYWNpdHkiLCAxKSAvLyBzdGFydCB3aXRoIG9wYWNpdHkgMQoJICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKCSAgICAgICAgLy8gY2hhbmdlIHZpZXcKCSAgICAgICAgX3N3ZWVwQ2xpY2soY3VyVml6T2JqKTsKCgkgICAgICAgIC8vIHR1cm4gb2ZmIG9wYWNpdHkgJiBwb2ludGVyIGV2ZW50cwoJICAgICAgICBkMy5zZWxlY3QodGhpcykKCSAgICAgICAgICAgIC5hdHRyKCJvcGFjaXR5IiwgMCkKCSAgICAgICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsICJub25lIik7CgoJICAgICAgICAvLyB0dXJuIG9uIHRpbWVzY2FwZSBpY29uIG9wYWNpdHkgJiBwb2ludGVyIGV2ZW50cwoJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudGltZXNjYXBlSWNvbiIpCgkgICAgICAgICAgICAuYXR0cigib3BhY2l0eSIsIDEpCgkgICAgICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCAiYXV0byIpOwoKCSAgICB9KQoJICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAudGV4dCgiVmlldyBTd2l0Y2giKTsKCgkvLyByZXNldCBidXR0b24gKG9ubHkgaWYgbXV0YXRpb25zIGFyZSBwcm92aWRlZCkKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpIHsKCQl0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKCQkgICAgLmF0dHIoImNsYXNzIiwgInJlc2V0QnV0dG9uIikKCQkgICAgLmF0dHIoIngiLCB3aWR0aCAtIDIqZG93bmxvYWRCdXR0b25XaWR0aCAtIDIqcmVzZXRCdXR0b25XaWR0aCkKCQkgICAgLmF0dHIoInkiLCAwKQoJCSAgICAuYXR0cigid2lkdGgiLCByZXNldEJ1dHRvbldpZHRoKQoJCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRvcEJhckhlaWdodCkKCQkgICAgLmF0dHIoInJ4IiwgMTApCgkJICAgIC5hdHRyKCJyeSIsIDEwKQoJCSAgICAuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpCgkJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJIaWdobGlnaHQpOwoJCSAgICB9KQoJCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGRpbS50b3BCYXJDb2xvdXIpOwoJCSAgICB9KQoJCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICAvLyBiYWNrZ3JvdW5kIGNsaWNrCgkJICAgICAgICBfYmFja2dyb3VuZENsaWNrKGN1clZpek9iaik7CgkJICAgIH0pOwoJCXRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKCQkgICAgLmF0dHIoInhsaW5rOmhyZWYiLCByZXNldEJ1dHRvbl9iYXNlNjQpCgkJICAgIC5hdHRyKCJ4Iiwgd2lkdGggLSAyKmRvd25sb2FkQnV0dG9uV2lkdGggLSAyKnJlc2V0QnV0dG9uV2lkdGggKyAocmVzZXRCdXR0b25XaWR0aCAtIHJlc2V0QnV0dG9uSWNvbldpZHRoKS8yKQoJCSAgICAuYXR0cigieSIsIDUpCgkJICAgIC5hdHRyKCJ3aWR0aCIsIHJlc2V0QnV0dG9uSWNvbldpZHRoKQoJCSAgICAuYXR0cigiaGVpZ2h0IiwgcmVzZXRCdXR0b25JY29uV2lkdGgpCgkJICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CgkJICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucmVzZXRCdXR0b24iKS5hdHRyKCJmaWxsIiwgZGltLnRvcEJhckhpZ2hsaWdodCk7CgkJICAgIH0pCgkJICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKCQkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5yZXNldEJ1dHRvbiIpLmF0dHIoImZpbGwiLCBkaW0udG9wQmFyQ29sb3VyKTsKCQkgICAgfSkKCQkgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewoJCSAgICAgICAgLy8gYmFja2dyb3VuZCBjbGljawoJCSAgICAgICAgX2JhY2tncm91bmRDbGljayhjdXJWaXpPYmopOwoJCSAgICB9KTsKCX0KCgkvLyBPVEhFUiBTVkdTCgoJdmFyIGNhbnZhc1NWRyA9IGNhbnZhc0RJVgoJICAgIC5hcHBlbmQoInN2ZzpzdmciKSAgCgkgICAgLmF0dHIoImNsYXNzIiwgInRpbWVzY2FwZV8iICsgdmlld19pZCkgICAgIAoJICAgIC5hdHRyKCJ4IiwgMCkKCSAgICAuYXR0cigieSIsIDApIAoJICAgIC5hdHRyKCJ3aWR0aCIsIGRpbS5jYW52YXNTVkdXaWR0aCkgCgkgICAgLmF0dHIoImhlaWdodCIsIGRpbS5jYW52YXNTVkdIZWlnaHQpCgkgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgoJdmFyIHRzU1ZHID0gY2FudmFzU1ZHCgkgICAgLmFwcGVuZCgiZyIpICAKCSAgICAuYXR0cigiY2xhc3MiLCAidHNTVkciKSAgICAgCgkgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIiArIChkaW0ueUF4aXNXaWR0aCArIGRpbS5zbWFsbE1hcmdpbikgKyAiLCIgKyBkaW0ucGFkZGluZ0dlbmVyYWwgKyAiKSIpOwoKCXZhciB5QXhpc1NWRyA9IGNhbnZhc1NWRwoJICAgIC5hcHBlbmQoImciKSAKCSAgICAuYXR0cigiY2xhc3MiLCAieUF4aXNTVkciKSAgICAgIAoJICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIgKyAwICsgIiwiICsgZGltLnBhZGRpbmdHZW5lcmFsICsgIikiKTsKCgl2YXIgeEF4aXNTVkcgPSBjYW52YXNTVkcKCSAgICAuYXBwZW5kKCJnIikgCgkgICAgLmF0dHIoImNsYXNzIiwgInhBeGlzU1ZHIikgICAgICAKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgMCArICIsIiArIChkaW0udHNTVkdIZWlnaHQgKyBkaW0uc21hbGxNYXJnaW4gKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgIikiKTsKCgl2YXIgdHNMZWdlbmRTVkcgPSBjYW52YXNTVkcKCSAgICAuYXBwZW5kKCJnIikgCgkgICAgLmF0dHIoImNsYXNzIiwgInRzTGVnZW5kU1ZHIikKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgKGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnRzU1ZHV2lkdGggKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgCgkgICAgICAgICIsIiArIGRpbS5wYWRkaW5nR2VuZXJhbCArICIpIik7CgoJdmFyIHRzVHJlZSA9IGNhbnZhc1NWRwoJICAgIC5hcHBlbmQoImciKSAKCSAgICAuYXR0cigiY2xhc3MiLCAidHNUcmVlU1ZHIikvLyBtb3ZlIHRoZSB0cmVlIFNWRyBpbiB0aGUgeC1kaXJlY3Rpb24gcGFzdCB0aW1lc2NhcGUKCSAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgKGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnRzU1ZHV2lkdGggKyBkaW0ucGFkZGluZ0dlbmVyYWwpICsgCgkgICAgICAgICIsIiArIGRpbS5wYWRkaW5nR2VuZXJhbCArICIpIik7CgoJY3VyVml6T2JqLnZpZXcuY2FudmFzU1ZHID0gY2FudmFzU1ZHOwoJY3VyVml6T2JqLnZpZXcueEF4aXNTVkcgPSB4QXhpc1NWRzsKCWN1clZpek9iai52aWV3LnlBeGlzU1ZHID0geUF4aXNTVkc7CgljdXJWaXpPYmoudmlldy50c1NWRyA9IHRzU1ZHOwoJY3VyVml6T2JqLnZpZXcudHNMZWdlbmRTVkcgPSB0c0xlZ2VuZFNWRzsKCWN1clZpek9iai52aWV3LnRzVHJlZSA9IHRzVHJlZTsKCgoJLy8gR0VUIENPTlRFTlQKCgkvLyBleHRyYWN0IGFsbCBpbmZvIGZyb20gdHJlZSBhYm91dCBub2RlcywgZWRnZXMsIGFuY2VzdG9ycywgZGVzY2VuZGFudHMKCV9nZXRUcmVlSW5mbyhjdXJWaXpPYmopOwoKCS8vIGdldCBtdXRhdGlvbiBkYXRhIGluIGJldHRlciBmb3JtYXQKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQpIHsKCSAgICBfcmVmb3JtYXRNdXRhdGlvbnMoY3VyVml6T2JqKTsKCgkJLy8gZ2V0IGNvbHVtbiBuYW1lcyAoZGVwZW5kaW5nIG9uIHRoZSBhdmFpbGFibGUgZGF0YSwgd2hpY2ggY29sdW1ucyB3aWxsIGJlIHNob3duKQogICAgICAgIGRpbS5tdXRhdGlvbkNvbHVtbnMgPSBbIHsgImRhdGEiOiAiZW1wdHkiLCAidGl0bGUiOiAiQ2xvbmUiLCAiYlNvcnRhYmxlIjogZmFsc2UsICJkZWZhdWx0Q29udGVudCI6ICIiIH0gXTsKICAgICAgICB2YXIgY29sdW1uTmFtZXMgPSBbXTsKICAgICAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNbMF0pLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgIHZhciB0aXRsZSA9IHRvVGl0bGVDYXNlKGtleS5yZXBsYWNlKC9fL2csICcgJykpLnJlcGxhY2UoLyBJZCQvZywgJyBJRCcpOyAvLyBjYXBpdGFsaXplIHRoZSB3aG9sZSB3b3JkICJJRCIKICAgICAgICAgICAgdmFyIG5ld0NvbHVtbiA9IHsgImRhdGEiOiBrZXksICJ0aXRsZSI6IHRpdGxlLCAiZGVmYXVsdENvbnRlbnQiOiAiIiB9OwogICAgICAgICAgICBpZiAoa2V5ID09ICJjbG9uZV9pZCIpIHsgLy8gbWFrZSBzdXJlIGNsb25lX2lkIGlzIGluc2VydGVkIG5leHQgdG8gImVtcHR5Iiwgd2hpY2ggd2lsbCBiZWNvbWUgdGhlIGNsb25lIHN2ZyBjaXJjbGUKICAgICAgICAgICAgCWRpbS5tdXRhdGlvbkNvbHVtbnMuc3BsaWNlKDEsIDAsIG5ld0NvbHVtbik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIAlkaW0ubXV0YXRpb25Db2x1bW5zLnB1c2gobmV3Q29sdW1uKTsKICAgICAgICAgICAgfQogICAgICAgIH0pOwoJfQoKCS8vIGdldCB0aW1lcG9pbnRzLCBwcmVwZW5kIGEgIlQwIiB0aW1lcG9pbnQgdG8gcmVwcmVzZW50IHRoZSB0aW1lcG9pbnQgYmVmb3JlIGFueSBkYXRhIG9yaWdpbmF0ZWQKCXZhciB0aW1lcG9pbnRzID0gXy51bmlxKF8ucGx1Y2soY3VyVml6T2JqLnVzZXJDb25maWcuY2xvbmFsX3ByZXYsICJ0aW1lcG9pbnQiKSk7Cgl0aW1lcG9pbnRzLnVuc2hpZnQoIlQwIik7CgljdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzID0gdGltZXBvaW50czsKCgkvLyBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZSBpbmZvCglfZ2V0Q1BEYXRhKGN1clZpek9iaik7CgoJLy8gZ2V0IGVtZXJnZW5jZSB2YWx1ZXMgJiB0aW1lcG9pbnRzIGZvciBlYWNoIGdlbm90eXBlCgljdXJWaXpPYmouZGF0YS5lbWVyZ2VuY2VfdmFsdWVzID0gX2dldEVtZXJnZW5jZVZhbHVlcyhjdXJWaXpPYmopOwoJY3VyVml6T2JqLmRhdGEuZW1lcmdlbmNlX3RwcyA9IF9nZXRFbWVyZ2VuY2VUaW1lcG9pbnRzKGN1clZpek9iaik7CgoJLy8gY29udmVydCB0aW1lLWNlbnRyaWMgY2VsbHVsYXIgcHJldmFsZW5jZSBkYXRhIGludG8gZ2Vub3R5cGUtY2VudHJpYyBjZWxsdWxhciBwcmV2YWxlbmNlIGRhdGEKCV9nZXRHZW5vdHlwZUNQRGF0YShjdXJWaXpPYmopOwoKCS8vIGdldCB0aGUgbGF5b3V0IG9mIHRoZSB0cmFkaXRpb25hbCB0aW1lc2NhcGUKCV9nZXRMYXlvdXQoY3VyVml6T2JqKTsKCgkvLyBnZXQgcGF0aHMgZm9yIHBsb3R0aW5nCglfZ2V0UGF0aHMoY3VyVml6T2JqKTsKCgkvLyBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZSBsYWJlbHMKCWN1clZpek9iai5kYXRhLnRzX3RyYWRfbGFiZWxzID0gX2dldFRyYWRpdGlvbmFsQ1BMYWJlbHMoY3VyVml6T2JqKTsKCWN1clZpek9iai5kYXRhLnRzX3NlcF9sYWJlbHMgPSBfZ2V0U2VwYXJhdGVDUExhYmVscyhjdXJWaXpPYmopOwoKCS8vIFNFVCBDT05URU5UCgoJLy8gdGlwcyAoZm9yIFZBRiBhbmQgbm9kZSBnZW5vdHlwZXMpCgljdXJWaXpPYmoudmFmVGlwcyA9IFtdOwoJdmFyIG5vZGVUaXAgPSBkMy50aXAoKQoJICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKQoJICAgIC5vZmZzZXQoWy0xMCwwXSkKCSAgICAuaHRtbChmdW5jdGlvbihkKSB7CgkgICAgICAgIHJldHVybiAiPHNwYW4+IiArIGQgKyAiPC9zcGFuPiI7CgkgICAgfSk7ICAKCWQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50aW1lc2NhcGVfIiArIHZpZXdfaWQpLmNhbGwobm9kZVRpcCk7CgoJLy8gZ2V0IGNvbG91ciBzY2hlbWUKCV9nZXRQaHlsb0NvbG91cnMoY3VyVml6T2JqKTsKCXZhciBjb2xvdXJfYXNzaWdubWVudCA9IGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50LAoJICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQ7CgoJLy8gY29sb3VyIHBhdGhzCglfY29sb3VyUGF0aHMoY3VyVml6T2JqKTsKCgkvLyBwbG90IGxpZ2h0IGdyZXkgdGltZXNjYXBlIGJhY2tncm91bmQKCWN1clZpek9iai52aWV3LnRzU1ZHCgkgICAgLmFwcGVuZCgicmVjdCIpCgkgICAgLmF0dHIoIngiLCAwKQoJICAgIC5hdHRyKCJ5IiwgMCkKCSAgICAuYXR0cigiaGVpZ2h0IiwgZGltLnRzU1ZHSGVpZ2h0KQoJICAgIC5hdHRyKCJ3aWR0aCIsIGRpbS50c1NWR1dpZHRoKQoJICAgIC5hdHRyKCJmaWxsIiwgIiNGN0Y3RjciKTsKCgkvLyBwbG90IHRpbWVzY2FwZSBkYXRhCgljdXJWaXpPYmoudmlldy50c1NWRwoJCS5hcHBlbmQoImciKQoJCS5hdHRyKCJjbGFzcyIsICJ0c1Bsb3RHIHRyYWRpdGlvbmFsIikgLy8gc3RhcnQgd2l0aCB0cmFkaXRpb25hbCBwbG90CgkgICAgLnNlbGVjdEFsbCgnLnRzUGxvdCcpCgkgICAgLmRhdGEoY3VyVml6T2JqLmRhdGEuYmV6aWVyX3BhdGhzLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIHJldHVybiBkLmd0eXBlOwoJICAgIH0pCgkgICAgLmVudGVyKCkuYXBwZW5kKCdwYXRoJykKCSAgICAuYXR0cignY2xhc3MnLCBmdW5jdGlvbihkKSB7IHJldHVybiAndHNQbG90IGd0eXBlXycgKyBkLmd0eXBlOyB9KSAKCSAgICAuYXR0cignZCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucGF0aDsgfSkKCSAgICAuYXR0cignZmlsbCcsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIHJldHVybiBkLmZpbGw7CgkgICAgfSkgCgkgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIHJldHVybiBkLnN0cm9rZTsKCSAgICB9KQoJICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZCkgewoJICAgICAgICBpZiAoIWRpbS5zZWxlY3RPbiAmJiAhZGltLm11dFNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgCV90c01vdXNlb3Zlckdlbm90eXBlKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgCV9zaG93TGFiZWxzKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgfQoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgIAlfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgCV9oaWRlTGFiZWxzKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIFBMT1QgUEVSVFVSQkFUSU9OUyBJTkZPCgoJLy8gcGxvdCBsYWJlbHMKCWN1clZpek9iai52aWV3LnhBeGlzU1ZHCgkgICAgLnNlbGVjdEFsbCgnLnBlcnRMYWJlbCcpCgkgICAgLmRhdGEoY3VyVml6T2JqLnVzZXJDb25maWcucGVydHVyYmF0aW9ucykKCSAgICAuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKQoJICAgIC5hdHRyKCdjbGFzcycsICdwZXJ0TGFiZWwnKQoJICAgIC5hdHRyKCd4JywgZnVuY3Rpb24oZCkgeyAKCSAgICAgICAgdmFyIHByZXZUUF9pZHggPSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmluZGV4T2YoZC5wcmV2X3RwKTsKCSAgICAgICAgcmV0dXJuICgocHJldlRQX2lkeCArIDAuNSkgLyAoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGgtMSkpICogKGRpbS50c1NWR1dpZHRoKSArIAoJICAgICAgICAgICAgZGltLnNtYWxsTWFyZ2luICsgZGltLnlBeGlzV2lkdGg7IAoJICAgIH0pCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgJzExcHgnKQoJICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQucGVydF9uYW1lOyB9KQoJICAgIC5vbignbW91c2VvdmVyJywgZnVuY3Rpb24oZCkgewoJICAgICAgICBpZiAoIWRpbS5zZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICAvLyBwbG90IGd1aWRlCgkgICAgICAgICAgICBjdXJWaXpPYmoudmlldy50c1NWRwoJICAgICAgICAgICAgICAgIC5hcHBlbmQoJ2xpbmUnKQoJICAgICAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKCkgeyByZXR1cm4gJ3BlcnRHdWlkZSBwZXJ0XycgKyBkLnBlcnRfbmFtZTsgfSkKCSAgICAgICAgICAgICAgICAuYXR0cigneDEnLCBmdW5jdGlvbigpIHsgCgkgICAgICAgICAgICAgICAgICAgIHZhciBwcmV2VFBfaWR4ID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5pbmRleE9mKGQucHJldl90cCk7CgkgICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHByZXZUUF9pZHggKyAwLjUpIC8gKGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMubGVuZ3RoLTEpKSAqIChkaW0udHNTVkdXaWR0aCk7IAoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3gyJywgZnVuY3Rpb24oKSB7IAoJICAgICAgICAgICAgICAgICAgICB2YXIgcHJldlRQX2lkeCA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuaW5kZXhPZihkLnByZXZfdHApOwoJICAgICAgICAgICAgICAgICAgICByZXR1cm4gKChwcmV2VFBfaWR4ICsgMC41KSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpOyAKCSAgICAgICAgICAgICAgICB9KQoJICAgICAgICAgICAgICAgIC5hdHRyKCd5MScsIDApCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3kyJywgZGltLnRzU1ZHSGVpZ2h0KQoJICAgICAgICAgICAgICAgIC5hdHRyKCdzdHJva2UnLCAnZ3JleScpCgkgICAgICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICcxLjVweCcpCgkgICAgICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkKCSAgICAgICAgICAgICAgICAuc2VsZWN0QWxsKCIucGVydEd1aWRlLnBlcnRfIiArIGQucGVydF9uYW1lKS5yZW1vdmUoKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIFBMT1QgVElNRVBPSU5UIEdVSURFUwoKCgkvLyBwbG90IHRpbWUgcG9pbnQgZ3VpZGVzCgljdXJWaXpPYmoudmlldy50c1NWRwoJCS5hcHBlbmQoJ2cnKQoJCS5hdHRyKCJjbGFzcyIsICJ0cEd1aWRlc0ciKQoJCS5zZWxlY3RBbGwoIi50cEd1aWRlIikKCQkuZGF0YShjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzKQoJCS5lbnRlcigpCgkgICAgLmFwcGVuZCgnbGluZScpCgkgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyByZXR1cm4gJ3RwR3VpZGUgdHBfJyArIGQ7IH0pCgkgICAgLmF0dHIoJ3gxJywgZnVuY3Rpb24oZCxpKSB7IHJldHVybiAoaSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aCAtIDEpKSAqIGRpbS50c1NWR1dpZHRoOyB9KQoJICAgIC5hdHRyKCd4MicsIGZ1bmN0aW9uKGQsaSkgeyByZXR1cm4gKGkgLyAoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGggLSAxKSkgKiBkaW0udHNTVkdXaWR0aDsgfSkKCSAgICAuYXR0cigneTEnLCAwKQoJICAgIC5hdHRyKCd5MicsIGRpbS50c1NWR0hlaWdodCkKCSAgICAuYXR0cignc3Ryb2tlJywgJ3doaXRlJykKCSAgICAuYXR0cignc3Ryb2tlLW9wYWNpdHknLCAwLjQpCgkgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICcxLjVweCcpCgkgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgoJLy8gUExPVCBBWEVTCgoJLy8gcGxvdCB4LWF4aXMgbGFiZWxzCgljdXJWaXpPYmoudmlldy54QXhpc1NWRwoJICAgIC5zZWxlY3RBbGwoJy54QXhpc0xhYmVscycpCgkgICAgLmRhdGEoY3VyVml6T2JqLmRhdGEudGltZXBvaW50cykKCSAgICAuZW50ZXIoKS5hcHBlbmQoJ3RleHQnKQoJICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICd4QXhpc0xhYmVscyB0cF8nICsgZDsgfSkKCSAgICAuYXR0cigneCcsIGZ1bmN0aW9uKGQsIGkpIHsgCgkgICAgICAgIHJldHVybiAoaSAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnlBeGlzV2lkdGg7IAoJICAgIH0pCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgJzExcHgnKQoJICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgIC8vIGdldCBvcmlnaW5hbCBsYWJlbCAoc3BhY2VzIHdlcmUgcmVwbGFjZWQgd2l0aCB1bmRlcnNjb3JlcykKCSAgICAgICAgdmFyIHRwID0gKGQgPT0gIlQwIikgPyAiVDAiIDoKCSAgICAgICAgICAgIF8uZmluZFdoZXJlKGN1clZpek9iai51c2VyQ29uZmlnLnRpbWVwb2ludF9tYXAsIHsic3BhY2VfcmVwbGFjZWRfdGltZXBvaW50IjogZH0pLm9yaWdpbmFsX3RpbWVwb2ludDsKCSAgICAgICAgcmV0dXJuIHRwOwoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbihkLCBpKSB7CgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkpIHsKCSAgICAgICAgCS8vIGhpZ2hsaWdodCB0aW1lcG9pbnQgZ3VpZGUKCSAgICAgICAgCV9obFRwR3VpZGUodmlld19pZCwgZCk7CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IHRob3NlIG5vZGVzIHdpdGggdGhpcyB0aW1lcG9pbnQgaW4gc2luZ2xlIGNlbGwgdmlzCgkgICAgICAgICAgICBpZiAodHlwZW9mIF9tb3VzZW92ZXJUcCA9PSAnZnVuY3Rpb24nKSB7CgkgICAgICAgICAgICAJX21vdXNlb3ZlclRwKGQsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pCgkgICAgLm9uKCdtb3VzZW91dCcsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgLy8gaGlkZSB0aW1lcG9pbnQgZ3VpZGUKCSAgICAgICAgCV9oaWRlVHBHdWlkZXModmlld19pZCk7CgoJICAgICAgICAgICAgLy8gcmVzZXQgc2luZ2xlIGNlbGwgdmlzCgkgICAgICAgICAgICBpZiAodHlwZW9mIF9tb3VzZW91dFRwID09ICdmdW5jdGlvbicpIHsKCSAgICAgICAgICAgIAlfbW91c2VvdXRUcChjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5zdHlsZSgiY3Vyc29yIiwgImRlZmF1bHQiKTsKCgkvLyBwbG90IHktYXhpcyB0aXRsZQoJY3VyVml6T2JqLnZpZXcueUF4aXNTVkcKCSAgICAuYXBwZW5kKCd0ZXh0JykKCSAgICAuYXR0cignY2xhc3MnLCAnYXhpc1RpdGxlIHlBeGlzJykKCSAgICAuYXR0cigneCcsIDApCgkgICAgLmF0dHIoJ3knLCAwKQoJICAgIC5hdHRyKCdkeScsICcuMzVlbScpCgkgICAgLmF0dHIoJ3RleHQtYW5jaG9yJywgJ21pZGRsZScpCgkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCSAgICAuYXR0cignZm9udC1zaXplJywgZGltLnRpdGxlRm9udFNpemUpCgkgICAgLmF0dHIoJ2ZvbnQtd2VpZ2h0JywgJ2JvbGQnKQoJICAgIC5hdHRyKCd0cmFuc2Zvcm0nLCAidHJhbnNsYXRlKCIgKyAoZGltLnlBeGlzV2lkdGgvMikgKyAiLCAiICsgKGRpbS50c1NWR0hlaWdodC8yKSArICIpIHJvdGF0ZSgtOTApIikKCSAgICAudGV4dChmdW5jdGlvbigpIHsgCgkgICAgICAgIHJldHVybiBjdXJWaXpPYmoudXNlckNvbmZpZy55YXhpc190aXRsZTsKCSAgICB9KTsKCgkvLyBwbG90IHgtYXhpcyB0aXRsZQoJY3VyVml6T2JqLnZpZXcueEF4aXNTVkcKCSAgICAuYXBwZW5kKCd0ZXh0JykKCSAgICAuYXR0cignY2xhc3MnLCAnYXhpc1RpdGxlIHhBeGlzJykKCSAgICAuYXR0cigneCcsIGRpbS55QXhpc1dpZHRoICsgZGltLnNtYWxsTWFyZ2luICsgZGltLnhBeGlzV2lkdGgvMikKCSAgICAuYXR0cigneScsIDI1KQoJICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKQoJICAgIC5hdHRyKCdmb250LWZhbWlseScsICdBcmlhbCcpCgkgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS50aXRsZUZvbnRTaXplKQoJICAgIC5hdHRyKCdmb250LXdlaWdodCcsICdib2xkJykKCSAgICAudGV4dChmdW5jdGlvbigpIHsgCgkgICAgICAgIHJldHVybiBjdXJWaXpPYmoudXNlckNvbmZpZy54YXhpc190aXRsZTsKCSAgICB9KTsKCgoJLy8gUExPVCBUUkVFIEdMWVBICgoJLy8gcGxvdCB0cmVlIHRpdGxlCgl2YXIgdHJlZVRpdGxlID0gY3VyVml6T2JqLnVzZXJDb25maWcucGh5bG9nZW55X3RpdGxlLnNwbGl0KCIgIik7Cgl2YXIgdHJlZVRpdGxlU3BhY2luZyA9IDI7IC8vIHNwYWNpbmcgYmV0d2VlbiB0aXRsZSB3b3JkcyAKCXRyZWVUaXRsZS5mb3JFYWNoKGZ1bmN0aW9uKHdvcmQsIHdvcmRfaSkgewoJCWN1clZpek9iai52aWV3LnRzVHJlZQoJCSAgICAuYXBwZW5kKCd0ZXh0JykKCQkgICAgLmF0dHIoJ2NsYXNzJywgJ3RyZWVUaXRsZScpCgkJICAgIC5hdHRyKCd4JywgMCkKCQkgICAgLmF0dHIoJ3knLCB3b3JkX2kqKGRpbS50aXRsZUZvbnRTaXplICsgdHJlZVRpdGxlU3BhY2luZykpCgkJICAgIC5hdHRyKCdkeScsICcuNzFlbScpCgkJICAgIC5hdHRyKCd0ZXh0LWFuY2hvcicsICdsZWZ0JykKCQkgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKCQkgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS50aXRsZUZvbnRTaXplKQoJCSAgICAuYXR0cignZm9udC13ZWlnaHQnLCAnYm9sZCcpCgkJICAgIC50ZXh0KHdvcmQpOyAJCQoJfSkKCgoJLy8gZDMgdHJlZSBsYXlvdXQKCXZhciB0cmVlUiA9IDQsCgkgICAgdHJlZVBhZGRpbmcgPSAxMCwKCSAgICB0cmVlVGl0bGVIZWlnaHQgPSB0cmVlVGl0bGUubGVuZ3RoICogKGRpbS50aXRsZUZvbnRTaXplICsgdHJlZVRpdGxlU3BhY2luZyksCgkgICAgdHJlZUxheW91dCA9IGQzLmxheW91dC50cmVlKCkgICAgICAgICAgIAoJICAgICAgICAuc2l6ZShbZGltLnRyZWVIZWlnaHQgLSB0cmVlUGFkZGluZywgZGltLnRyZWVXaWR0aCAtIHRyZWVQYWRkaW5nXSk7IAoKCS8vIGdldCBub2RlIHJhZGl1cyBmb3IgbGVnZW5kIHBoeWxvZ2VueSAoNyA9PSAjIHBpeGVscyBiZXR3ZWVuIG5vZGVzKQoJdmFyIHRyZWVfaGVpZ2h0ID0gY3VyVml6T2JqLmRhdGEudHJlZV9oZWlnaHQ7CglkaW0ubGVnZW5kTm9kZV9yID0gKCgoZGltLnRyZWVXaWR0aC10cmVlUGFkZGluZykgLSA3KnRyZWVfaGVpZ2h0KS90cmVlX2hlaWdodCkvMjsKCWRpbS5sZWdlbmROb2RlX3IgPSAoZGltLmxlZ2VuZE5vZGVfciA+IGRpbS5tYXhfcikgPyBkaW0ubWF4X3IgOiBkaW0ubGVnZW5kTm9kZV9yOwoJZGltLmxlZ2VuZE5vZGVfciA9IChkaW0ubGVnZW5kTm9kZV9yIDwgZGltLm1pbl9yKSA/IGRpbS5taW5fciA6IGRpbS5sZWdlbmROb2RlX3I7CgoJLy8gZ2V0IG5vZGVzIGFuZCBsaW5rcwoJdmFyIHJvb3QgPSAkLmV4dGVuZCh7fSwgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSksIC8vIGNvcHkgdHJlZSBpbnRvIG5ldyB2YXJpYWJsZQoJICAgIG5vZGVzID0gdHJlZUxheW91dC5ub2Rlcyhyb290KSwgCgkgICAgbGlua3MgPSB0cmVlTGF5b3V0LmxpbmtzKG5vZGVzKTsgICAKCgkvLyBzd2FwIHggYW5kIHkgZGlyZWN0aW9uCglub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUpIHsKCSAgICBub2RlLnRtcCA9IG5vZGUueTsKCSAgICBub2RlLnkgPSBub2RlLnggKyAodHJlZVBhZGRpbmcvMikgKyB0cmVlVGl0bGVIZWlnaHQ7CgkgICAgbm9kZS54ID0gbm9kZS50bXAgKyAodHJlZVBhZGRpbmcvMik7CgkgICAgZGVsZXRlIG5vZGUudG1wOwoJfSk7CgoJLy8gY3JlYXRlIGxpbmtzCgljdXJWaXpPYmoubGlua19pZHMgPSBbXTsKCXZhciBsaW5rID0gY3VyVml6T2JqLnZpZXcudHNUcmVlLmFwcGVuZCgiZyIpCgkgICAgLmNsYXNzZWQoInRyZWVMaW5rcyIsIHRydWUpCgkgICAgLnNlbGVjdEFsbCgiLmxlZ2VuZFRyZWVMaW5rIikgICAgICAgICAgICAgICAgICAKCSAgICAuZGF0YShsaW5rcykgICAgICAgICAgICAgICAgICAgCgkgICAgLmVudGVyKCkuYXBwZW5kKCJwYXRoIikgICAgICAgICAgICAgICAgICAgCgkgICAgLmF0dHIoImNsYXNzIiwgZnVuY3Rpb24oZCkgeyAKCSAgICAgICAgZC5saW5rX2lkID0gInRyZWVMaW5rX3NvdXJjZV8iICsgZC5zb3VyY2UuaWQgKyAiX3RhcmdldF8iICsgZC50YXJnZXQuaWQ7CgkgICAgICAgIGN1clZpek9iai5saW5rX2lkcy5wdXNoKGQubGlua19pZCk7CgkgICAgICAgIHJldHVybiAibGVnZW5kVHJlZUxpbmsgIiArIGQubGlua19pZDsKCSAgICB9KQoJICAgIC5hdHRyKCdzdHJva2UnLCBkaW0udHJlZUxpbmtDb2xvdXIpCgkgICAgLmF0dHIoJ3N0cm9rZS13aWR0aCcsICczcHgnKQoJICAgIC5hdHRyKCdmaWxsJywgJ25vbmUnKSAgICAgICAgICAgICAgICAKCSAgICAuYXR0cigiZCIsIF9lbGJvdykKCSAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgLy8gd2UncmUgbm90IHNlbGVjdGluZyBub2RlcyBvciBtdXRhdGlvbnMKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgoJICAgICAgICAgICAgLy8gaW5hY3RpdmF0ZSBhbGwgZ2Vub3R5cGVzIAoJICAgICAgICAgICAgX3RzSW5hY3RpdmF0ZUdlbm90eXBlcyhjdXJWaXpPYmoudmlld19pZCk7CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IGFsbCBlbGVtZW50cyBkb3duc3RyZWFtIG9mIGxpbmsKCSAgICAgICAgICAgIF9wcm9wYWdhdGVkRWZmZWN0cyhjdXJWaXpPYmosIGQubGlua19pZCwgY3VyVml6T2JqLmxpbmtfaWRzLCAiZG93bnN0cmVhbSIpOwoJICAgICAgICB9CgkgICAgfSkKCSAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIC8vIHdlJ3JlIG5vdCBzZWxlY3Rpbmcgbm9kZXMgb3IgbXV0YXRpb25zCgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgX3RzTW91c2VvdXRHZW5vdHlwZShjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgIH0KCSAgICB9KTsgCgoJLy8gY3JlYXRlIG5vZGVzCgl2YXIgbm9kZSA9IGN1clZpek9iai52aWV3LnRzVHJlZS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTm9kZSIpICAgICAgICAgICAgICAgICAgCgkgICAgLmRhdGEobm9kZXMpICAgICAgICAgICAgICAgICAgIAoJICAgIC5lbnRlcigpCgkgICAgLmFwcGVuZCgiY2lyY2xlIikgICAgIAoJICAgIC5hdHRyKCJjeCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueH0pCgkgICAgLmF0dHIoImN5IiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC55fSkgICAgICAgICAgICAgIAoJICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJsZWdlbmRUcmVlTm9kZSBndHlwZV8iICsgZC5pZDsgfSkKCSAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKCSAgICAJZC5maWxsID0gKGQuaWQgPT0gZGltLnBoYW50b21Sb290KSA/ICJub25lIiA6IGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2QuaWRdOwoJICAgICAgICByZXR1cm4gZC5maWxsOwoJICAgIH0pCgkgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsKCSAgICAJZC5zdHJva2UgPSAoZC5pZCA9PSBkaW0ucGhhbnRvbVJvb3QpID8gIm5vbmUiIDogY29sb3VyX2Fzc2lnbm1lbnRbZC5pZF07CgkgICAgICAgIHJldHVybiBkLnN0cm9rZTsKCSAgICB9KQoJICAgIC5hdHRyKCJpZCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc2NfaWQ7IH0pCgkgICAgLmF0dHIoInIiLCBkaW0ubGVnZW5kTm9kZV9yICsgInB4IikKCSAgICAub24oJ21vdXNlb3ZlcicsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgLy8gc2hvdyBub2RlIGdlbm90eXBlIHRvb2x0aXAKCSAgICAgICAgdmFyIGNsb25lX25hbWUgPSAvLyBnZXQgb3JpZ2luYWwgc2FtcGxlIG5hbWUgKHNwYWNlcyBtYXkgaGF2ZSBiZWVuIHJlcGxhY2VkIHdpdGggdW5kZXJzY29yZXMpCgkgICAgICAgICAgICBfLmZpbmRXaGVyZShjdXJWaXpPYmoudXNlckNvbmZpZy5jbG9uZV9pZF9tYXAsIHsic3BhY2VfcmVwbGFjZWRfY2xvbmVfaWQiOiBkLmlkfSkub3JpZ2luYWxfY2xvbmVfaWQ7CgkgICAgICAgIG5vZGVUaXAuc2hvdygiQ2xvbmU6ICIgKyBjbG9uZV9uYW1lKTsKCgkgICAgICAgIC8vIGlmIHdlJ3JlIHNlbGVjdGluZyBub2RlcwoJICAgICAgICBpZiAoZGltLm5DbGlja2VkTm9kZXMgPiAwICYmIGQuaWQgIT0gZGltLnBoYW50b21Sb290KSB7CgkgICAgICAgICAgICAvLyBoaWdobGlnaHQgbm9kZSBpbiB0aGUgbGVnZW5kCgkgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykKCSAgICAgICAgICAgICAgICAuYXR0cignZmlsbCcsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2QuaWRdOyB9KQoJICAgICAgICAgICAgICAgIC5hdHRyKCdzdHJva2UnLCBmdW5jdGlvbihkKSB7IHJldHVybiBjb2xvdXJfYXNzaWdubWVudFtkLmlkXTsgfSk7CgkgICAgICAgIH0KCSAgICAgICAgLy8gd2UncmUgbm90IHNlbGVjdGluZyBub2RlcyBvciBtdXRhdGlvbnMgLSBoaWdobGlnaHQgZ2Vub3R5cGUKCSAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICBfdHNNb3VzZW92ZXJHZW5vdHlwZShkLmlkLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgICAgICBfc2hvd0xhYmVscyhkLmlkLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgICAgIH0KCSAgICB9KQoJICAgIC5vbignbW91c2VvdXQnLCBmdW5jdGlvbihkKSB7CgkgICAgICAgIC8vIGhpZGUgbm9kZSBnZW5vdHlwZQoJICAgICAgICBub2RlVGlwLmhpZGUoKTsKCgkgICAgICAgIC8vIHdlJ3JlIG5vdCBzZWxlY3Rpbmcgbm9kZXMgb3IgbXV0YXRpb25zIC0gbW91c2VvdXQgYXMgbm9ybWFsCgkgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAJX3RzTW91c2VvdXRHZW5vdHlwZShjdXJWaXpPYmoudmlld19pZCk7CiAgIAkgCQkJX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICB9CgkgICAgfSkKCSAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oZCkgewoJICAgICAgICAvLyBpZiB0aGVyZSBhcmUgbXV0YXRpb25zIGFuZCB3ZSdyZSBub3Qgc2VsZWN0aW5nIGFueSBvZiB0aGVtCgkgICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnNfcHJvdmlkZWQgJiYgIWRpbS5tdXRTZWxlY3RPbikgewoKCSAgICAgICAgICAgIGRpbS5zZWxlY3RPbiA9IHRydWU7CgkgICAgICAgICAgICBkaW0ubkNsaWNrZWROb2RlcysrOyAvLyBpbmNyZW1lbnQgdGhlIG51bWJlciBvZiBjbGlja2VkIG5vZGVzCgoJICAgICAgICAgICAgLy8gcmVzZXQgdmlldyAoZ2V0IHJpZCBvZiBhbnkgbGFiZWxzLCBldGMuKQoJICAgICAgICAgICAgX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoKCSAgICAgICAgICAgIC8vIGdldCBkYXRhIGZvciB0aGlzIGNsb25lCgkgICAgICAgICAgICB2YXIgZmlsdGVyZWRfbXV0cyA9IAoJICAgICAgICAgICAgICAgIF8uZmlsdGVyKGN1clZpek9iai5kYXRhLm11dGF0aW9ucywgZnVuY3Rpb24obXV0KSB7IHJldHVybiBtdXQuY2xvbmVfaWQgPT0gZC5pZDsgfSk7CgoJICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBubyBkYXRhIGZvciB0aGlzIGNsb25lLCBhZGQgYSByb3cgb2YgIk5vbmUiCgkgICAgICAgICAgICBpZiAoZmlsdGVyZWRfbXV0cy5sZW5ndGggPT09IDApIHsgCgkgICAgICAgICAgICAgICAgZmlsdGVyZWRfbXV0cyA9IFt7fV07CgkgICAgICAgICAgICAgICAgZGltLm11dGF0aW9uQ29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCkgewoJICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9tdXRzWzBdW2NvbC5kYXRhXSA9IChjb2wuZGF0YSA9PSAiZW1wdHkiKSA/ICIiIDogIk5vbmUiOwoJICAgICAgICAgICAgICAgIH0pCgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBmaWx0ZXJlZF9tdXRzWzBdLmNsb25lX2lkID0gZC5pZDsKCgkgICAgICAgICAgICAvLyBpZiBpdCdzIHRoZSBmaXJzdCBjbGlja2VkIG5vZGUKCSAgICAgICAgICAgIGlmIChkaW0ubkNsaWNrZWROb2RlcyA9PSAxKSB7CgkgICAgICAgICAgICAgICAgLy8gZGVsZXRlIGV4aXN0aW5nIGRhdGEgdGFibGUKCSAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQgKyAiX211dGF0aW9uVGFibGUiICsgIl93cmFwcGVyIikucmVtb3ZlKCk7ICAgCgoJICAgICAgICAgICAgICAgIC8vIHBsb3QgZmlsdGVyZWQgZGF0YSB0YWJsZQoJICAgICAgICAgICAgICAgIF9tYWtlTXV0YXRpb25UYWJsZShjdXJWaXpPYmosIGN1clZpek9iai52aWV3Lm11dGF0aW9uVGFibGVESVYsIGZpbHRlcmVkX211dHMsCgkgICAgICAgICAgICAgICAgICAgIGRpbS5tdXRhdGlvblRhYmxlSGVpZ2h0KTsgCgoJICAgICAgICAgICAgICAgIC8vIGluYWN0aXZhdGUgYWxsIGdlbm90eXBlcwoJICAgICAgICAgICAgICAgIF90c0luYWN0aXZhdGVHZW5vdHlwZXMoY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gb3RoZXJ3aXNlCgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAvLyBhZGQgdG8gZXhpc3RpbmcgZGF0YSB0YWJsZQoJICAgICAgICAgICAgICAgIHZhciB0YWJsZSA9ICQoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQgKyAiX211dGF0aW9uVGFibGUiKS5EYXRhVGFibGUoKTsKCSAgICAgICAgICAgICAgICB0YWJsZS5yb3dzLmFkZChmaWx0ZXJlZF9tdXRzKS5kcmF3KGZhbHNlKTsKCgkgICAgICAgICAgICAgICAgLy8gYWRkIHRoaXMgY2xvbmUgaWQgdG8gdGhlIGxpc3Qgb2YgY2xvbmUgaWRzIGluIHRoZSBtdXRhdGlvbiB0YWJsZQoJICAgICAgICAgICAgICAgIGRpbS5jdXJDbG9uZUlEcyA9IGRpbS5jdXJDbG9uZUlEcy5jb25jYXQoXy5wbHVjayhmaWx0ZXJlZF9tdXRzLCAiY2xvbmVfaWQiKSk7CgoJICAgICAgICAgICAgICAgIC8vIHBsb3QgY2xvbmUgc3ZnIGNpcmNsZXMgaW4gbXV0YXRpb24gdGFibGUKCSAgICAgICAgICAgICAgICBfYWRkQ2xvbmVTVkdzVG9UYWJsZShjdXJWaXpPYmosIGRpbS5jdXJDbG9uZUlEcyk7CgkgICAgICAgICAgICB9CgoJICAgICAgICAgICAgLy8gaGlnaGxpZ2h0IHRoaXMgY2xvbmUKCSAgICAgICAgICAgIF90c0hpZ2hsaWdodEdlbm90eXBlKGQuaWQsIGN1clZpek9iai52aWV3X2lkKTsKCgkgICAgICAgICAgICBkMy5ldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKCSAgICAgICAgfQoJICAgIH0pOwoKCS8vIENSRUFURSBDTE9OQUwgUFJFVkFMRU5DRSBMQUJFTFMKICAgIF9jcmVhdGVMYWJlbHMoY3VyVml6T2JqLCBjdXJWaXpPYmouZGF0YS50c190cmFkX2xhYmVscyk7CiAgICBfY3JlYXRlTGFiZWxzKGN1clZpek9iaiwgY3VyVml6T2JqLmRhdGEudHNfc2VwX2xhYmVscyk7CgoKCS8vIE1VVEFUSU9OIFRBQkxFCgoJLy8gaWYgbXV0YXRpb25zIGFyZSBzcGVjaWZpZWQgYnkgdGhlIHVzZXIKCWlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbnMgIT0gIk5BIikgewoKCSAgICAvLyBtYWtlIHRoZSB0YWJsZQoJICAgIF9tYWtlTXV0YXRpb25UYWJsZShjdXJWaXpPYmosIGN1clZpek9iai52aWV3Lm11dGF0aW9uVGFibGVESVYsIGN1clZpek9iai5kYXRhLm11dGF0aW9ucywKCSAgICAgICAgZGltLm11dGF0aW9uVGFibGVIZWlnaHQpOwoJfQoKCS8vICoqKioqKioqIEhFTFBFUiBGVU5DVElPTlMgKioqKioqKiogLy8KCgkvLyBEMyBFRkZFQ1RTIEZVTkNUSU9OUwoKCS8qIGZ1bmN0aW9uIHRvIGNoZWNrIGZvciBzaW5nbGUgY2VsbCB2aWV3ZXIgc2VsZWN0aW9ucwoJKi8KCWZ1bmN0aW9uIF9jaGVja0ZvckNlbGxTY2FwZVNlbGVjdGlvbnModmlld19pZCkgewoJCXJldHVybiAodHlwZW9mIF9jaGVja0ZvclNlbGVjdGlvbnMgIT09ICJmdW5jdGlvbiIgfHwgLy8gaWYgbm8gY2VsbFNjYXBlLCByZXR1cm4gdHJ1ZQogICAgICAgIAkJKHR5cGVvZiBfY2hlY2tGb3JTZWxlY3Rpb25zID09PSAiZnVuY3Rpb24iICYmIF9jaGVja0ZvclNlbGVjdGlvbnMoY3VyVml6T2JqLnZpZXdfaWQpKSk7IC8vIGlmIGNlbGxTY2FwZSwgY2hlY2sgZm9yIGl0cyBzZWxlY3Rpb25zCgl9CgoJLyogZnVuY3Rpb24gZm9yIGdlbm90eXBlIG1vdXNlb3ZlcgoJKiBAcGFyYW0ge1N0cmluZ30gZ3R5cGUgLS0gZ2Vub3R5cGUgdG8gaGlnaGxpZ2h0CgkqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIG9mIGN1cnJlbnQgdmlldwoJKi8KCWZ1bmN0aW9uIF90c01vdXNlb3Zlckdlbm90eXBlKGd0eXBlLCB2aWV3X2lkKSB7CgoJICAgIF90c0luYWN0aXZhdGVHZW5vdHlwZXModmlld19pZCk7CgkgICAgX3RzSGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpOwoJfQoKCS8qIGZ1bmN0aW9uIGZvciBnZW5vdHlwZSBtb3VzZW92ZXIKCSogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CgkqLwoJZnVuY3Rpb24gX3RzTW91c2VvdXRHZW5vdHlwZSh2aWV3X2lkKSB7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHJlZS5ub2RlIikuY2xhc3NlZCgiaW5hY3RpdmUiLCBmYWxzZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmdyYXBoLm5vZGUiKS5jbGFzc2VkKCJhY3RpdmUiLCBmYWxzZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0IikuY2xhc3NlZCgiYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50c1Bsb3QiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kVHJlZU5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuaW5kaWMiKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwKTsKCX0KCgkvKiBmdW5jdGlvbiB0byBoaWdobGlnaHQgYSBwYXJ0aWN1bGFyIGdlbm90eXBlCgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSBnZW5vdHlwZSB0byBoaWdobGlnaHQKCSogQHBhcmFtIHtTdHJpbmd9IHZpZXdfaWQgLS0gaWQgb2YgY3VycmVudCB2aWV3CgkqLwoJZnVuY3Rpb24gX3RzSGlnaGxpZ2h0R2Vub3R5cGUoZ3R5cGUsIHZpZXdfaWQpIHsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuaW5kaWMuZ3R5cGVfIiArIGd0eXBlKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAxKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZS5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cmVlLm5vZGUuZ3R5cGVfIiArIGd0eXBlKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kR3JvdXBSZWN0Lmd0eXBlXyIgKyBndHlwZSkuY2xhc3NlZCgiYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRzUGxvdC5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTm9kZS5ndHlwZV8iICsgZ3R5cGUpLmNsYXNzZWQoImluYWN0aXZlIiwgZmFsc2UpOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGluYWN0aXZhdGUgYWxsIGdlbm90eXBlcwoJKiBAcGFyYW0ge1N0cmluZ30gdmlld19pZCAtLSBpZCBvZiBjdXJyZW50IHZpZXcKCSovCglmdW5jdGlvbiBfdHNJbmFjdGl2YXRlR2Vub3R5cGVzKHZpZXdfaWQpIHsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuZ3JhcGgubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnRyZWUubm9kZSIpLmNsYXNzZWQoImluYWN0aXZlIiwgdHJ1ZSk7CgkgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZEdyb3VwUmVjdCIpLmNsYXNzZWQoImFjdGl2ZSIsIGZhbHNlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHNQbG90IikuY2xhc3NlZCgiaW5hY3RpdmUiLCB0cnVlKTsKCSAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIubGVnZW5kVHJlZU5vZGUiKS5jbGFzc2VkKCJpbmFjdGl2ZSIsIHRydWUpOwoJfQoKCgkvKiByZWN1cnNpdmUgZnVuY3Rpb24gdG8gcGVyZm9ybSBkb3duc3RyZWFtIG9yIHVwc3RyZWFtIGVmZmVjdHMgb24gbGVnZW5kIHRyZWUgbGluawoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKiBAcGFyYW0ge1N0cmluZ30gbGlua19pZCAtLSBpZCBmb3IgdGhlIGxpbmsgdGhhdCdzIGN1cnJlbnRseSBoaWdobGlnaHRlZAoJKiBAcGFyYW0ge0FycmF5fSBsaW5rX2lkcyAtLSBpZHMgZm9yIGFsbCBsaW5rcyBpbiB0cmVlCgkqIEBwYXJhbSB7U3RyaW5nfSBzdHJlYW1fZGlyZWN0aW9uIC0tICJkb3duc3RyZWFtIiBvciAidXBzdHJlYW0iCgkqLwoJZnVuY3Rpb24gX3Byb3BhZ2F0ZWRFZmZlY3RzKGN1clZpek9iaiwgbGlua19pZCwgbGlua19pZHMsIHN0cmVhbV9kaXJlY3Rpb24pIHsKCSAgICB2YXIgdmlld19pZCA9IGN1clZpek9iai52aWV3X2lkLAoJICAgICAgICBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKCSAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5jb2xvdXJfYXNzaWdubWVudCwKCSAgICAgICAgYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSBjdXJWaXpPYmoudmlldy5hbHBoYV9jb2xvdXJfYXNzaWdubWVudDsKCgkgICAgLy8gY2xlYXIgcHJvcGFnYXRpb24gaW5mbyBpbiB2aXpPYmoKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbiA9IHt9OwoKCSAgICAvLyBnZXQgcHJvcGFnYXRpb24gaW5mbwoJICAgIF9nZXRQcm9wYXRhZ2VkSXRlbXMoY3VyVml6T2JqLCBsaW5rX2lkLCBsaW5rX2lkcywgc3RyZWFtX2RpcmVjdGlvbik7CgoJICAgIC8vIGhpZ2hsaWdodCBsaW5rcyBpbiBsZWdlbmQKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbi5saW5rX2lkcy5mb3JFYWNoKGZ1bmN0aW9uKGN1cl9saW5rX2lkKSB7CgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkKCSAgICAgICAgICAgIC5zZWxlY3QoIi5sZWdlbmRUcmVlTGluay4iICsgY3VyX2xpbmtfaWQpCgkgICAgICAgICAgICAuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCAxKTsKCSAgICB9KTsKCiAgICAJLy8gaGlnaGxpZ2h0IHRoZSBkb3duc3RyZWFtIGdlbm90eXBlcyBpbiB0aGUgc2luZ2xlIGNlbGwgdmlldwogICAgCWN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLm5vZGVfaWRzLmZvckVhY2goZnVuY3Rpb24obm9kZSkgewoJICAgIAlfdHNIaWdobGlnaHRHZW5vdHlwZShub2RlLCBjdXJWaXpPYmoudmlld19pZCk7CgkgICAgfSk7Cgl9OwoKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIGxpbmtzLCBub2Rlcywgc2FtcGxlcyBhbmQgc2FtcGxlIGxvY2F0aW9ucyBwYXJ0aWNpcGF0aW5nIGluIHRoZSBjdXJyZW50IHByb3BhZ2F0aW9uCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogLS0gdml6T2JqIGZvciB0aGUgY3VycmVudCB2aWV3CgkqIEBwYXJhbSB7U3RyaW5nfSBsaW5rX2lkIC0tIGlkIGZvciB0aGUgbGluayB0aGF0J3MgY3VycmVudGx5IGhpZ2hsaWdodGVkCgkqIEBwYXJhbSB7QXJyYXl9IGxpbmtfaWRzIC0tIGlkcyBmb3IgYWxsIGxpbmtzIGluIHRyZWUKCSogQHBhcmFtIHtTdHJpbmd9IHN0cmVhbV9kaXJlY3Rpb24gLS0gImRvd25zdHJlYW0iIG9yICJ1cHN0cmVhbSIKCSovCglmdW5jdGlvbiBfZ2V0UHJvcGF0YWdlZEl0ZW1zKGN1clZpek9iaiwgbGlua19pZCwgbGlua19pZHMsIHN0cmVhbV9kaXJlY3Rpb24pIHsKCSAgICB2YXIgdmlld19pZCA9IGN1clZpek9iai52aWV3X2lkLAoJICAgICAgICBnZW5lcmFsVGFyZ2V0UlggPSBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfLitfdGFyZ2V0XyguKykiKSwgLy8gcmVnZXggdG8gZ2V0IHRhcmdldAoJICAgICAgICBnZW5lcmFsU291cmNlUlggPSBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfKC4rKV90YXJnZXRfLisiKTsgLy8gcmVnZXggdG8gZ2V0IHNvdXJjZQoKCSAgICAvLyBnZXQgdGFyZ2V0ICYgc291cmNlIGlkIG9mIHRoaXMgbGluawoJICAgIHZhciB0YXJnZXRfaWQgPSBnZW5lcmFsVGFyZ2V0UlguZXhlYyhsaW5rX2lkKVsxXTsKCSAgICB2YXIgc291cmNlX2lkID0gZ2VuZXJhbFNvdXJjZVJYLmV4ZWMobGlua19pZClbMV07CgoJICAgIC8vIGdldCB0aGUgdGFyZ2V0cyBvZiB0aGlzIHRhcmdldCwgb3Igc291cmNlcyBvZiBzb3VyY2UKCSAgICB2YXIgbmV4dE5vZGVSWCA9IChzdHJlYW1fZGlyZWN0aW9uID09ICJkb3duc3RyZWFtIikgPyAKCSAgICAgICAgbmV3IFJlZ0V4cCgidHJlZUxpbmtfc291cmNlXyIgKyB0YXJnZXRfaWQgKyAiX3RhcmdldF8oLispIikgOgoJICAgICAgICBuZXcgUmVnRXhwKCJ0cmVlTGlua19zb3VyY2VfKC4rKV90YXJnZXRfIiArIHNvdXJjZV9pZCk7CgkgICAgdmFyIHRhcmdldExpbmtzX29mX3RhcmdldE5vZGUgPSBbXTsKCSAgICBsaW5rX2lkcy5tYXAoZnVuY3Rpb24oaWQpIHsKCSAgICAgICAgaWYgKGlkLm1hdGNoKG5leHROb2RlUlgpKSB7CgkgICAgICAgICAgICB0YXJnZXRMaW5rc19vZl90YXJnZXROb2RlLnB1c2goaWQpOwoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8vIGFkZCBpbmZvcm1hdGlvbiB0byBjdXJWaXpPYmoKCSAgICBjdXJWaXpPYmoudmlldy5wcm9wYWdhdGlvbiA9IGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uIHx8IHt9OwoJICAgIGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLm5vZGVfaWRzID0gY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubm9kZV9pZHMgfHwgW107CgkgICAgY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubm9kZV9pZHMucHVzaCh0YXJnZXRfaWQpOwoJICAgIGN1clZpek9iai52aWV3LnByb3BhZ2F0aW9uLmxpbmtfaWRzID0gY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubGlua19pZHMgfHwgW107CgkgICAgY3VyVml6T2JqLnZpZXcucHJvcGFnYXRpb24ubGlua19pZHMucHVzaChsaW5rX2lkKTsKCgkgICAgLy8gZm9yIGVhY2ggb2YgdGhlIHRhcmdldCdzIHRhcmdldHMsIGhpZ2hsaWdodCB0aGVpciBkb3duc3RyZWFtIGxpbmtzCgkgICAgdGFyZ2V0TGlua3Nfb2ZfdGFyZ2V0Tm9kZS5tYXAoZnVuY3Rpb24odGFyZ2V0X2xpbmtfaWQpIHsKCSAgICAgICAgX2dldFByb3BhdGFnZWRJdGVtcyhjdXJWaXpPYmosIHRhcmdldF9saW5rX2lkLCBsaW5rX2lkcywgc3RyZWFtX2RpcmVjdGlvbik7CgkgICAgfSk7Cgl9OwoKCglmdW5jdGlvbiBfc3dlZXBDbGljayhjdXJWaXpPYmopIHsKCSAgICB2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkgICAgICAgIGNvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuY29sb3VyX2Fzc2lnbm1lbnQsCgkgICAgICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50ID0gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQsCgkgICAgICAgIHggPSBjdXJWaXpPYmoudXNlckNvbmZpZzsKCgkgICAgLy8gaGlkZSBhbnkgY2VsbHVsYXIgcHJldmFsZW5jZSBsYWJlbHMKCSAgICBkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLmxhYmVsLCAuc2VwTGFiZWwiKQoJICAgICAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMCk7CgkgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5sYWJlbENpcmMsIC5zZXBMYWJlbENpcmMiKQoJICAgICAgICAuYXR0cignZmlsbC1vcGFjaXR5JywgMCk7CgoJICAgIC8vIHRyYW5zaXRpb24gdG8gdHJhY2tzIHRpbWVzY2FwZSB2aWV3CgkgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIudHNQbG90RyIpLmNsYXNzZWQoInRyYWRpdGlvbmFsIikpIHsKCSAgICAgICAgdmFyIHN3ZWVwcyA9IGN1clZpek9iai52aWV3LnRzU1ZHCgkgICAgICAgICAgICAuc2VsZWN0QWxsKCcudHNQbG90JykKCSAgICAgICAgICAgIC5kYXRhKGN1clZpek9iai5kYXRhLnRyYWNrc19iZXppZXJfcGF0aHMsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZC5ndHlwZTsKCSAgICAgICAgICAgIH0pCgoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC50cmFuc2l0aW9uKCkKCSAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKQoJICAgICAgICAgICAgLmF0dHJUd2VlbigiZCIsIF9wYXRoVHdlZW4oY3VyVml6T2JqLCAibW92ZSIpKTsKCgkgICAgICAgIC8vIHJlbW92ZSBnZW5vdHlwZXMgdGhhdCBkbyBub3QgaGF2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIHZhbHVlcwoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC5leGl0KCkKCSAgICAgICAgICAgIC50cmFuc2l0aW9uKCkKCSAgICAgICAgICAgIC5kdXJhdGlvbigxMDAwKQoJICAgICAgICAgICAgLmF0dHJUd2VlbigiZCIsIF9wYXRoVHdlZW4oY3VyVml6T2JqLCAiZXhpdCIpKQoJICAgICAgICAgICAgLnJlbW92ZSgpOwoKCSAgICAgICAgLy8gc3dpdGNoIGNsYXNzIHRvICJ0cmFja3MiCgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIudHNQbG90RyIpLmNsYXNzZWQoInRyYWRpdGlvbmFsIiwgZmFsc2UpLmNsYXNzZWQoInRyYWNrcyIsIHRydWUpOwoJICAgIH0KCSAgICAvLyB0cmFuc2l0aW9uIHRvIHRyYWRpdGlvbmFsIHRpbWVzY2FwZSB2aWV3CgkgICAgZWxzZSB7CgkgICAgICAgIHZhciBzd2VlcHMgPSBjdXJWaXpPYmoudmlldy50c1NWRwoJICAgICAgICAJLnNlbGVjdCgiLnRzUGxvdEciKQoJICAgICAgICAgICAgLnNlbGVjdEFsbCgnLnRzUGxvdCcpCgkgICAgICAgICAgICAuZGF0YShjdXJWaXpPYmouZGF0YS5iZXppZXJfcGF0aHMsIGZ1bmN0aW9uKGQpIHsKCSAgICAgICAgICAgICAgICByZXR1cm4gZC5ndHlwZTsKCSAgICAgICAgICAgIH0pOwoKCSAgICAgICAgc3dlZXBzCgkgICAgICAgICAgICAudHJhbnNpdGlvbigpCgkgICAgICAgICAgICAuZHVyYXRpb24oMTAwMCkKCSAgICAgICAgICAgIC5hdHRyVHdlZW4oImQiLCBfcGF0aFR3ZWVuKGN1clZpek9iaiwgIm1vdmUiKSk7CgoJICAgICAgICAvLyBhZGQgdGhvc2UgZ2Vub3R5cGVzIHRoYXQgZG8gbm90IGhhdmUgY2VsbHVsYXIgcHJldmFsZW5jZSB2YWx1ZXMsIGJ1dCBhcmUgaW4gdGhlIGhpZXJhcmNoeQoJICAgICAgICBzd2VlcHMKCSAgICAgICAgICAgIC5lbnRlcigpCgkgICAgICAgICAgICAuaW5zZXJ0KCdwYXRoJykKCSAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsIGZ1bmN0aW9uKGQpIHsgCgkgICAgICAgICAgICAJLy8gaWYgd2UncmUgc2VsZWN0aW5nIG5vZGVzLCBidXQgd2UgaGF2ZW4ndCBjbGlja2VkIHRoaXMgb25lIHlldAoJICAgICAgICAgICAgICAgIGlmICgoZGltLm5DbGlja2VkTm9kZXMgPiAwKSAmJiAoXy51bmlxKGRpbS5jdXJDbG9uZUlEcykuaW5kZXhPZihkLmlkKSA9PSAtMSkpIHsKCSAgICAgICAgICAgICAgICAJcmV0dXJuICd0c1Bsb3QgaW5hY3RpdmUgZ3R5cGVfJyArIGQuZ3R5cGU7IAoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIAlyZXR1cm4gJ3RzUGxvdCBndHlwZV8nICsgZC5ndHlwZTsgCgkgICAgICAgICAgICB9KQoJICAgICAgICAgICAgLmF0dHIoImQiLCBfY2VudHJlTGluZShjdXJWaXpPYmopKQoJICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmZpbGw7IH0pIAoJICAgICAgICAgICAgLmF0dHIoJ3N0cm9rZScsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQuc3Ryb2tlOyB9KQoJICAgICAgICAgICAgLm9uKCdtb3VzZW92ZXInLCBmdW5jdGlvbihkKSB7CgkgICAgICAgICAgICAgICAgaWYgKCFkaW0uc2VsZWN0T24gJiYgIWRpbS5tdXRTZWxlY3RPbiAmJiBfY2hlY2tGb3JDZWxsU2NhcGVTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CgkgICAgICAgICAgICAgICAgCV90c01vdXNlb3Zlckdlbm90eXBlKGQuZ3R5cGUsIGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgICAgICAJX3Nob3dMYWJlbHMoZC5ndHlwZSwgY3VyVml6T2JqLnZpZXdfaWQpOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pCgkgICAgICAgICAgICAub24oJ21vdXNlb3V0JywgZnVuY3Rpb24oZCkgewoJICAgICAgICAgICAgICAgIGlmICghZGltLnNlbGVjdE9uICYmICFkaW0ubXV0U2VsZWN0T24gJiYgX2NoZWNrRm9yQ2VsbFNjYXBlU2VsZWN0aW9ucyh2aWV3X2lkKSkgewoJICAgICAgICAgICAgICAgICAgICBfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKICAgCSAJCQkJCV9oaWRlTGFiZWxzKGN1clZpek9iai52aWV3X2lkKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KQoJICAgICAgICAgICAgLnRyYW5zaXRpb24oKQoJICAgICAgICAgICAgLmR1cmF0aW9uKDEwMDApCgkgICAgICAgICAgICAuYXR0clR3ZWVuKCJkIiwgX3BhdGhUd2VlbihjdXJWaXpPYmosICJtb3ZlIikpOwoKCSAgICAgICAgLy8gc3dpdGNoIGNsYXNzIHRvICJ0cmFkaXRpb25hbCIKCSAgICAgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3QoIi50c1Bsb3RHIikuY2xhc3NlZCgidHJhY2tzIiwgZmFsc2UpLmNsYXNzZWQoInRyYWRpdGlvbmFsIiwgdHJ1ZSk7CgkgICAgfQoJfQoKCS8qIENyZWF0ZSBjbG9uYWwgcHJldmFsZW5jZSBsYWJlbHMgd2l0aCBmaWxsIG9wYWNpdHkgMAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKiBAcGFyYW0ge0FycmF5fSBsYWJlbF9kYXRhIC0tIGFycmF5IG9mIG9iamVjdHMgY29udGFpbmluZyBsYWJlbCBkYXRhLCBvbmUgbGFiZWwgcGVyIG9iamVjdAoJKi8KCWZ1bmN0aW9uIF9jcmVhdGVMYWJlbHMoY3VyVml6T2JqLCBsYWJlbF9kYXRhKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCSAgICAvLyBmb3IgZWFjaCBjZWxsdWxhciBwcmV2YWxlbmNlIGxhYmVsIGZvciB0aGlzIGdlbm90eXBlCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHNTVkcKICAgICAgICAJLmFwcGVuZCgiZyIpCiAgICAgICAgCS5hdHRyKCJjbGFzcyIsICJsYWJlbENpcmNsZXNHIikKICAgICAgICAJLnNlbGVjdEFsbCgiY2lyY2xlIikKICAgICAgICAJLmRhdGEobGFiZWxfZGF0YSkKICAgICAgICAJLmVudGVyKCkKICAgICAgICAgICAgLmFwcGVuZCgnY2lyY2xlJykKICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIGlmIChkLnR5cGUgPT0gInRyYWRpdGlvbmFsIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWxDaXJjIHRwXycgKyBkLnRwICsgJyBndHlwZV8nICsgZC5ndHlwZTsgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gJ3NlcExhYmVsQ2lyYyB0cF8nICsgZC50cCArICcgZ3R5cGVfJyArIGQuZ3R5cGU7IAogICAgICAgICAgICB9KSAKICAgICAgICAgICAgLmF0dHIoJ2N4JywgZnVuY3Rpb24oZCkgeyAKCiAgICAgICAgICAgICAgICAvLyBpbmRleCBvZiB0aGlzIHRpbWUgcG9pbnQgcmVsYXRpdmUgdG8gb3RoZXJzCiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmluZGV4T2YoZC50cCk7IAoKICAgICAgICAgICAgICAgIHZhciB4X3ZhbCA9IChpbmRleCAvIChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aC0xKSkgKiAoZGltLnRzU1ZHV2lkdGgpOwoKICAgICAgICAgICAgICAgIC8vIGlmIHRoZSB0aW1lIHBvaW50IGlzIHRoZSBsYXN0CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPT0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cy5sZW5ndGggLSAxKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2hpZnQgaXQgdG8gdGhlIGxlZnQKICAgICAgICAgICAgICAgICAgICB4X3ZhbCAtPSBkaW0uY2lyY2xlUjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4geF92YWw7IAogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cignY3knLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgdmFyIHk7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgbGFiZWwsIHdoZW4gY2VudGVyZWQgdmVydGljYWxseS4uLgogICAgICAgICAgICAgICAgLy8gLi4uIGlzIGN1dCBvZmYgYXQgdGhlIHRvcCwgc2hpZnQgZG93bgogICAgICAgICAgICAgICAgaWYgKChkaW0udHNTVkdIZWlnaHQtKGQubWlkZGxlKmRpbS50c1NWR0hlaWdodCkpIDwgZGltLmNpcmNsZVIpIHsKICAgICAgICAgICAgICAgICAgICB5ID0gMSArIGRpbS5jaXJjbGVSOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSBib3R0b20sIHNoaWZ0IHVwCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZC5taWRkbGUqZGltLnRzU1ZHSGVpZ2h0KSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IGRpbS50c1NWR0hlaWdodCAtIDEgLSBkaW0uY2lyY2xlUjsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyAuLi4gaXMgbm90IGN1dCBvZmYsIGNlbnRlciB2ZXJ0aWNhbGx5CiAgICAgICAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB5ID0gKDEgLSBkLm1pZGRsZSkqZGltLnRzU1ZHSGVpZ2h0OyAKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICByZXR1cm4gZGltLnRzU1ZHSGVpZ2h0IC0geTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmF0dHIoJ3InLCBkaW0uY2lyY2xlUikKICAgICAgICAgICAgLmF0dHIoJ2ZpbGwnLCAnd2hpdGUnKQogICAgICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCkKICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7CgogICAgICAgIGN1clZpek9iai52aWV3LnRzU1ZHCiAgICAgICAgCS5hcHBlbmQoImciKQogICAgICAgIAkuYXR0cigiY2xhc3MiLCAibGFiZWxUZXh0RyIpCiAgICAgICAgCS5zZWxlY3RBbGwoInRleHQiKQogICAgICAgIAkuZGF0YShsYWJlbF9kYXRhKQogICAgICAgIAkuZW50ZXIoKQogICAgICAgICAgICAuYXBwZW5kKCd0ZXh0JykKICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtZmFtaWx5JywgJ0FyaWFsJykKICAgICAgICAgICAgLmF0dHIoJ2ZvbnQtc2l6ZScsIGRpbS5mb250U2l6ZSkKICAgICAgICAgICAgLmF0dHIoJ2NsYXNzJywgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIGlmIChkLnR5cGUgPT0gInRyYWRpdGlvbmFsIikgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnbGFiZWwgdHBfJyArIGQudHAgKyAnIGd0eXBlXycgKyBkLmd0eXBlOyAKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiAnc2VwTGFiZWwgdHBfJyArIGQudHAgKyAnIGd0eXBlXycgKyBkLmd0eXBlOyAKICAgICAgICAgICAgfSkgCiAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgIHZhciBjcCA9IChNYXRoLnJvdW5kKGQuY3AgKiAxMDApIC8gMSk7CiAgICAgICAgICAgICAgICBpZiAoY3AgPT09IDApIHsKICAgICAgICAgICAgICAgIAlkLmxhYmVsX3RleHQgPSAiPCAwLjAxIjsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gIiI7IC8vIHRleHQgcmVtb3ZlZCBmb3IgcHVycG9zZXMgb2Ygc3ZnIGRvd25sb2FkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBjcF9mcmFjID0gKGNwLzEwMCkudG9GaXhlZCgyKTsKICAgICAgICAgICAgICAgIGQubGFiZWxfdGV4dCA9IGNwX2ZyYWMudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIHJldHVybiAiIjsgLy8gdGV4dCByZW1vdmVkIGZvciBwdXJwb3NlcyBvZiBzdmcgZG93bmxvYWQKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmF0dHIoJ3gnLCBmdW5jdGlvbihkKSB7IAoKICAgICAgICAgICAgICAgIC8vIGluZGV4IG9mIHRoaXMgdGltZSBwb2ludCByZWxhdGl2ZSB0byBvdGhlcnMKICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuaW5kZXhPZihkLnRwKTsgCgogICAgICAgICAgICAgICAgdmFyIHhfdmFsID0gKGluZGV4IC8gKGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMubGVuZ3RoLTEpKSAqIChkaW0udHNTVkdXaWR0aCk7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIHRpbWUgcG9pbnQgaXMgdGhlIGxhc3QKICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgICAgICAgICAvLyBzaGlmdCBpdCB0byB0aGUgbGVmdAogICAgICAgICAgICAgICAgICAgIHhfdmFsIC09IGRpbS5jaXJjbGVSOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHJldHVybiB4X3ZhbDsgCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hdHRyKCd5JywgZnVuY3Rpb24oZCkgeyByZXR1cm4gZGltLnRzU1ZHSGVpZ2h0IC0gKDEgLSBkLm1pZGRsZSkqZGltLnRzU1ZHSGVpZ2h0OyB9KQogICAgICAgICAgICAuYXR0cignZHknLCBmdW5jdGlvbihkKSB7CgogICAgICAgICAgICAgICAgLy8gaWYgdGhlIGxhYmVsLCB3aGVuIGNlbnRlcmVkIHZlcnRpY2FsbHkuLi4KICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSB0b3AsIHNoaWZ0IGRvd24KICAgICAgICAgICAgICAgIGlmICgoZGltLnRzU1ZHSGVpZ2h0LShkLm1pZGRsZSpkaW0udHNTVkdIZWlnaHQpKSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoJ3knLCBkaW0udHNTVkdIZWlnaHQgLSAxIC0gZGltLmNpcmNsZVIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBjdXQgb2ZmIGF0IHRoZSBib3R0b20sIHNoaWZ0IHVwCiAgICAgICAgICAgICAgICBlbHNlIGlmICgoZC5taWRkbGUqZGltLnRzU1ZHSGVpZ2h0KSA8IGRpbS5jaXJjbGVSKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoJ3knLCAxICsgZGltLmNpcmNsZVIpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8vIC4uLiBpcyBub3QgY3V0IG9mZiwgY2VudGVyIHZlcnRpY2FsbHkKICAgICAgICAgICAgICAgIHJldHVybiAnLjM1ZW0nOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cignZmlsbCcsICdibGFjaycpCiAgICAgICAgICAgIC5hdHRyKCJmaWxsLW9wYWNpdHkiLCAwKQogICAgICAgICAgICAuYXR0cigndGV4dC1hbmNob3InLCAnbWlkZGxlJykKICAgICAgICAgICAgLnN0eWxlKCdwb2ludGVyLWV2ZW50cycsICdub25lJyk7Cgl9CgoJLyogYmFja2dyb3VuZCBjbGljayBmdW5jdGlvbiAodHVybnMgb2ZmIHNlbGVjdGlvbnMsIHJlc2V0cyB2aWV3KQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKi8KCWZ1bmN0aW9uIF9iYWNrZ3JvdW5kQ2xpY2soY3VyVml6T2JqKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCSAgICAvLyBpZiB0aGVyZSB3YXMganVzdCBhIGxpbmsgc2VsZWN0aW9uLCByZWZyZXNoIHRoZSBtdXRhdGlvbnMgdGFibGUKCSAgICBpZiAoZGltLnNlbGVjdE9uKSB7CgkgICAgICAgIC8vIGRlbGV0ZSBleGlzdGluZyBkYXRhIHRhYmxlCgkgICAgICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCArICJfbXV0YXRpb25UYWJsZSIgKyAiX3dyYXBwZXIiKS5yZW1vdmUoKTsKCgkgICAgICAgIC8vIG1ha2UgbmV3IGZ1bGwgdGFibGUKCSAgICAgICAgX21ha2VNdXRhdGlvblRhYmxlKGN1clZpek9iaiwgY3VyVml6T2JqLnZpZXcubXV0YXRpb25UYWJsZURJViwgY3VyVml6T2JqLmRhdGEubXV0YXRpb25zLAoJICAgICAgICAgICAgZGltLm11dGF0aW9uVGFibGVIZWlnaHQpOwoJICAgIH0KCgkgICAgZGltLnNlbGVjdE9uID0gZmFsc2U7CgkgICAgZGltLm11dFNlbGVjdE9uID0gZmFsc2U7CgkgICAgZGltLm5DbGlja2VkTm9kZXMgPSAwOwoJICAgIGRpbS5jdXJDbG9uZUlEcyA9IFtdOwoKCSAgICAvLyBtYXJrIGFsbCBtdXRhdGlvbnMgYXMgdW5zZWxlY3RlZAoJICAgIGQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCArICJfbXV0YXRpb25UYWJsZSIpLnNlbGVjdEFsbCgidHIiKS5jbGFzc2VkKCdzZWxlY3RlZCcsIGZhbHNlKTsKCgkgICAgLy8gdW5oaWdobGlnaHQgcGh5bG9nZW55IGxpbmtzIChoaWdobGlnaHRpbmcgb2NjdXJzIHdoZW4gbXV0YXRpb24gc2VsZWN0ZWQpCgkgICAgZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5sZWdlbmRUcmVlTGluayIpLmF0dHIoInN0cm9rZSIsIGRpbS50cmVlTGlua0NvbG91cik7CgoJICAgIC8vIGhpZGUgVkFGIHRvb2x0aXBzCgkgICAgY3VyVml6T2JqLnZhZlRpcHMuZm9yRWFjaChmdW5jdGlvbihjdXJUaXApIHsKCSAgICAgICAgY3VyVGlwLmhpZGUoKTsKCSAgICB9KQoKCSAgICBfdHNNb3VzZW91dEdlbm90eXBlKGN1clZpek9iai52aWV3X2lkKTsKICAgCSAJX2hpZGVMYWJlbHMoY3VyVml6T2JqLnZpZXdfaWQpOwoJfQoKCS8vIFRSRUUgRlVOQ1RJT05TCgoJLyogZXh0cmFjdCBhbGwgaW5mbyBmcm9tIHRyZWUgYWJvdXQgbm9kZXMsIGVkZ2VzLCBhbmNlc3RvcnMsIGRlc2NlbmRhbnRzCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmogCgkqLwoJZnVuY3Rpb24gX2dldFRyZWVJbmZvKGN1clZpek9iaikgewoJICAgIHZhciB1c2VyQ29uZmlnID0gY3VyVml6T2JqLnVzZXJDb25maWcsCgkgICAgICAgIGN1cl9lZGdlcyA9IHVzZXJDb25maWcuZ3R5cGVfdHJlZV9lZGdlcywKCSAgICAgICAgcGhhbnRvbVJvb3QgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdDsgLy8gcm9vdCBzbyB3ZSBoYXZlIGEgbGVhZC1pbiBsaW5rIHRvIHRoZSByZWFsIHJvb3QKCgkgICAgLy8gZ2V0IHRyZWUgbm9kZXMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlTm9kZXMgPSBfLnVuaXEoXy5wbHVjayhjdXJfZWRnZXMsICJzb3VyY2UiKS5jb25jYXQoXy5wbHVjayhjdXJfZWRnZXMsICJ0YXJnZXQiKSkpOwoJICAgIGN1clZpek9iai5kYXRhLnRyZWVOb2Rlcy5wdXNoKHBoYW50b21Sb290KTsKCgkgICAgLy8gZ2V0IHRyZWUgZWRnZXMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMgPSBbXTsKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cl9lZGdlcy5sZW5ndGg7IGkrKykgewoJICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMucHVzaCh7CgkgICAgICAgICAgICAic291cmNlIjogY3VyX2VkZ2VzW2ldLnNvdXJjZSwKCSAgICAgICAgICAgICJ0YXJnZXQiOiBjdXJfZWRnZXNbaV0udGFyZ2V0CgkgICAgICAgIH0pCgkgICAgfQoKCSAgICAvLyBmaW5kIHRyZWUgcm9vdAoJICAgIHZhciBjdXJfc291cmNlID0gY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzWzBdLnNvdXJjZTsKCSAgICB2YXIgc291cmNlX2FzX3RhcmdldCA9IC8vIGVkZ2Ugd2hlcmUgdGhlIGN1cnJlbnQgc291cmNlIGlzIHRoZSB0YXJnZXQKCSAgICAgICAgXy5maW5kV2hlcmUoY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzLCB7InRhcmdldCI6IGN1cl9zb3VyY2V9KTsgCgkgICAgd2hpbGUgKHNvdXJjZV9hc190YXJnZXQpIHsgLy8gaXRlcmF0ZSBhcyBsb25nIGFzIHRoZXJlIGFyZSBlZGdlcyB3aXRoIHRoZSBjdXJyZW50IHNvdXJjZSBhcyB0aGUgdGFyZ2V0CgkgICAgICAgIGN1cl9zb3VyY2UgPSBzb3VyY2VfYXNfdGFyZ2V0LnNvdXJjZTsKCSAgICAgICAgc291cmNlX2FzX3RhcmdldCA9IF8uZmluZFdoZXJlKGN1clZpek9iai5kYXRhLnRyZWVFZGdlcywgeyJ0YXJnZXQiOiBjdXJfc291cmNlfSk7CgkgICAgfQoJICAgIHZhciByb290TmFtZSA9IGN1cl9zb3VyY2U7CgoJICAgIC8vIGFkZCB0aGUgcGhhbnRvbVJvb3QgdG8gdGhlIHRyZWUgZWRnZXMgYXJyYXkKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMucHVzaCh7CgkgICAgICAgICJzb3VyY2UiOiBwaGFudG9tUm9vdCwKCSAgICAgICAgInRhcmdldCI6IHJvb3ROYW1lCgkgICAgfSkKCgkgICAgLy8gZ2V0IHRyZWUgc3RydWN0dXJlCgkgICAgdmFyIG5vZGVzQnlOYW1lID0gW107CgkgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJWaXpPYmouZGF0YS50cmVlRWRnZXMubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgdmFyIHBhcmVudCA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzW2ldLnNvdXJjZSk7CgkgICAgICAgIHZhciBjaGlsZCA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgY3VyVml6T2JqLmRhdGEudHJlZUVkZ2VzW2ldLnRhcmdldCk7CgkgICAgICAgIHBhcmVudC5jaGlsZHJlbi5wdXNoKGNoaWxkKTsKCSAgICB9CgkgICAgdmFyIHJvb3RfdHJlZSA9IF9maW5kTm9kZUJ5TmFtZShub2Rlc0J5TmFtZSwgcGhhbnRvbVJvb3QpOyAKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlID0gcm9vdF90cmVlOyAKCgkgICAgLy8gZ2V0IGxpbmVhciBjaGFpbnMKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlQ2hhaW5Sb290cyA9IFtdOyAvLyBrZWVwIHRyYWNrIG9mIGxpbmVhciBjaGFpbiBzZWdtZW50IHJvb3RzCgkgICAgY3VyVml6T2JqLmRhdGEudHJlZUNoYWlucyA9IAoJICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSwge30sICIiKTsKCgkgICAgLy8gZ2V0IGRlc2NlbmRhbnRzIGZvciBlYWNoIG5vZGUKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIgPSB7fTsKCSAgICBjdXJWaXpPYmouZGF0YS50cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgdmFyIGN1clJvb3QgPSBfZmluZE5vZGVCeU5hbWUobm9kZXNCeU5hbWUsIG5vZGUpOwoJICAgICAgICB2YXIgY3VyRGVzY2VuZGFudHMgPSBfZ2V0RGVzY2VuZGFudElkcyhjdXJSb290LCBbXSk7CgkgICAgICAgIGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0Fycltub2RlXSA9IGN1ckRlc2NlbmRhbnRzOwoJICAgIH0pCgkgICAgY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzID0gX2dldERpcmVjdERlc2NlbmRhbnRzKGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmUsIHt9KTsKCgkgICAgLy8gZ2V0IGFuY2VzdG9ycyBmb3IgZWFjaCBub2RlCgkgICAgY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FyciA9IF9nZXRBbmNlc3RvcklkcyhjdXJWaXpPYmopOwoJICAgIGN1clZpek9iai5kYXRhLmRpcmVjdF9hbmNlc3RvcnMgPSBfZ2V0RGlyZWN0QW5jZXN0b3JzKGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmUsIHt9KTsKCgkgICAgLy8gZ2V0IHNpYmxpbmdzIGZvciBlYWNoIG5vZGUKCSAgICBjdXJWaXpPYmouZGF0YS5zaWJsaW5ncyA9IF9nZXRTaWJsaW5ncyhjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlLCB7fSk7IAoKCSAgICAvLyBnZXQgdGhlIGhlaWdodCBvZiB0aGUgdHJlZQoJICAgIGN1clZpek9iai5kYXRhLnRyZWVfaGVpZ2h0ID0gMDsKCSAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyKS5mb3JFYWNoKGZ1bmN0aW9uKGtleSkgewoJICAgICAgICB2YXIgYW5jZXN0b3JfYXJyID0gY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FycltrZXldOwoJICAgICAgICBpZiAoYW5jZXN0b3JfYXJyLmxlbmd0aCA+IGN1clZpek9iai5kYXRhLnRyZWVfaGVpZ2h0KSB7CgkgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlX2hlaWdodCA9IGFuY2VzdG9yX2Fyci5sZW5ndGg7CgkgICAgICAgIH0KCSAgICB9KQoJfQoKCS8qIGZ1bmN0aW9uIHRvIGZpbmQgYSBrZXkgYnkgaXRzIG5hbWUgLSBpZiB0aGUga2V5IGRvZXNuJ3QgZXhpc3QsIGl0IHdpbGwgYmUgY3JlYXRlZCBhbmQgYWRkZWQgdG8gdGhlIGxpc3Qgb2Ygbm9kZXMKCSogQHBhcmFtIHtBcnJheX0gbGlzdCAtIGxpc3Qgb2Ygbm9kZXMKCSogQHBhcmFtIHtTdHJpbmd9IG5hbWUgLSBuYW1lIG9mIGtleSB0byBmaW5kCgkqLwoJZnVuY3Rpb24gX2ZpbmROb2RlQnlOYW1lKGxpc3QsIG5hbWUpIHsKCSAgICB2YXIgZm91bmROb2RlID0gXy5maW5kV2hlcmUobGlzdCwge2lkOiBuYW1lfSksCgkgICAgICAgIGN1ck5vZGU7CgoJICAgIGlmICghZm91bmROb2RlKSB7CgkgICAgICAgIGN1ck5vZGUgPSB7J2lkJzogbmFtZSwgJ2NoaWxkcmVuJzogW119OwoJICAgICAgICBsaXN0LnB1c2goY3VyTm9kZSk7CgkgICAgICAgIHJldHVybiBjdXJOb2RlOwoJICAgIH0KCgkgICAgcmV0dXJuIGZvdW5kTm9kZTsKCX0KCgkvKiBmdW5jdGlvbiB0byBnZXQgZGVzY2VuZGFudHMgaWQncyBmb3IgdGhlIHNwZWNpZmllZCBrZXkKCSogQHBhcmFtIHtPYmplY3R9IHJvb3QgLSBrZXkgZm9yIHdoaWNoIHdlIHdhbnQgZGVzY2VuZGFudHMKCSogQHBhcmFtIHtBcnJheX0gZGVzY2VuZGFudHMgLSBpbml0aWFsbHkgZW1wdHkgYXJyYXkgZm9yIGRlc2NlbmRhbnRzIHRvIGJlIHBsYWNlZCBpbnRvCgkqLwoJZnVuY3Rpb24gX2dldERlc2NlbmRhbnRJZHMocm9vdCwgZGVzY2VuZGFudHMpIHsKCSAgICB2YXIgY2hpbGQ7CgoJICAgIGlmIChyb290LmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByb290LmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBjaGlsZCA9IHJvb3QuY2hpbGRyZW5baV07CgkgICAgICAgICAgICBkZXNjZW5kYW50cy5wdXNoKGNoaWxkLmlkKTsKCSAgICAgICAgICAgIF9nZXREZXNjZW5kYW50SWRzKGNoaWxkLCBkZXNjZW5kYW50cyk7CgkgICAgICAgIH0KCSAgICB9CgkgICAgcmV0dXJuIGRlc2NlbmRhbnRzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgYW5jZXN0b3IgaWRzIGZvciBhbGwgbm9kZXMKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRBbmNlc3RvcklkcyhjdXJWaXpPYmopIHsKCSAgICB2YXIgYW5jZXN0b3JzID0ge30sCgkgICAgICAgIGN1ckRlc2NlbmRhbnRzLAoJICAgICAgICBkZXNjZW5kYW50c19hcnIgPSBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnIsCgkgICAgICAgIHRyZWVOb2RlcyA9IGN1clZpek9iai5kYXRhLnRyZWVOb2RlczsKCgkgICAgLy8gc2V0IHVwIGVhY2ggbm9kZSBhcyBvcmlnaW5hbGx5IGNvbnRhaW5pbmcgYW4gZW1wdHkgbGlzdCBvZiBhbmNlc3RvcnMKCSAgICB0cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgYW5jZXN0b3JzW25vZGVdID0gW107CgkgICAgfSkKCgkgICAgLy8gZ2V0IGFuY2VzdG9ycyBkYXRhIGZyb20gdGhlIGRlc2NlbmRhbnRzIGRhdGEKCSAgICB0cmVlTm9kZXMuZm9yRWFjaChmdW5jdGlvbihub2RlLCBpZHgpIHsKCSAgICAgICAgLy8gZm9yIGVhY2ggZGVzY2VuZGFudCBvZiB0aGlzIG5vZGUKCSAgICAgICAgY3VyRGVzY2VuZGFudHMgPSBkZXNjZW5kYW50c19hcnJbbm9kZV07CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VyRGVzY2VuZGFudHMubGVuZ3RoOyBpKyspIHsgCgkgICAgICAgICAgICAvLyBhZGQgdGhlIG5vZGUgdG8gZGVzY2VudGFudCdzIGFuY2VzdG9yIGxpc3QKCSAgICAgICAgICAgIGFuY2VzdG9yc1tjdXJEZXNjZW5kYW50c1tpXV0ucHVzaChub2RlKTsKCSAgICAgICAgfQoJICAgIH0pCgoJICAgIHJldHVybiBhbmNlc3RvcnM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBESVJFQ1QgZGVzY2VuZGFudCBpZCBmb3IgYWxsIG5vZGVzCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJOb2RlIC0tIGN1cnJlbnQgbm9kZSBpbiB0aGUgdHJlZSAob3JpZ2luYWxseSB0aGUgcm9vdCkKCSogQHBhcmFtIHtPYmplY3R9IGRpcl9kZXNjZW5kYW50cyAtLSBvcmlnaW5hbGx5IGVtcHR5IGFycmF5IG9mIGRpcmVjdCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCgkqLwoJZnVuY3Rpb24gX2dldERpcmVjdERlc2NlbmRhbnRzKGN1ck5vZGUsIGRpcl9kZXNjZW5kYW50cykgewoJICAgIGRpcl9kZXNjZW5kYW50c1tjdXJOb2RlLmlkXSA9IFtdOwoKCSAgICBpZiAoY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGg7IGkrKykgewoJICAgICAgICAgICAgZGlyX2Rlc2NlbmRhbnRzW2N1ck5vZGUuaWRdLnB1c2goY3VyTm9kZS5jaGlsZHJlbltpXS5pZCk7CgkgICAgICAgICAgICBfZ2V0RGlyZWN0RGVzY2VuZGFudHMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2Rlc2NlbmRhbnRzKQoJICAgICAgICB9CgkgICAgfQoKCSAgICByZXR1cm4gZGlyX2Rlc2NlbmRhbnRzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgRElSRUNUIGFuY2VzdG9yIGlkIGZvciBhbGwgbm9kZXMKCSogQHBhcmFtIHtPYmplY3R9IGN1ck5vZGUgLS0gY3VycmVudCBub2RlIGluIHRoZSB0cmVlIChvcmlnaW5hbGx5IHRoZSByb290KQoJKiBAcGFyYW0ge09iamVjdH0gZGlyX2FuY2VzdG9ycyAtLSBvcmlnaW5hbGx5IGVtcHR5IGFycmF5IG9mIGRpcmVjdCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCgkqLwoJZnVuY3Rpb24gX2dldERpcmVjdEFuY2VzdG9ycyhjdXJOb2RlLCBkaXJfYW5jZXN0b3JzKSB7CgoJICAgIGlmIChjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aCA+IDApIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBkaXJfYW5jZXN0b3JzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdID0gY3VyTm9kZS5pZDsKCSAgICAgICAgICAgIF9nZXREaXJlY3RBbmNlc3RvcnMoY3VyTm9kZS5jaGlsZHJlbltpXSwgZGlyX2FuY2VzdG9ycykKCSAgICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGRpcl9hbmNlc3RvcnM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBzaWJsaW5nIElEJ3MgZm9yIGVhY2ggbm9kZQoJKiBAcGFyYW0ge09iamVjdH0gY3VyTm9kZSAtLSBjdXJyZW50IG5vZGUgaW4gdGhlIHRyZWUgKG9yaWdpbmFsbHkgdGhlIHJvb3QpCgkqIEBwYXJhbSB7T2JqZWN0fSBzaWJzIC0tIG9yaWdpbmFsbHkgZW1wdHkgYXJyYXkgb2Ygc2libGluZ3MgZm9yIGVhY2ggbm9kZQoJKi8KCWZ1bmN0aW9uIF9nZXRTaWJsaW5ncyhjdXJOb2RlLCBzaWJzKSB7CgkgICAgdmFyIGN1cl9zaWJzID0gW107CgoJICAgIC8vIGdldCBjdXJyZW50IHNpYmxpbmdzCgkgICAgaWYgKGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewoJICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIGN1cl9zaWJzLnB1c2goY3VyTm9kZS5jaGlsZHJlbltpXS5pZCk7CgkgICAgICAgICAgICBfZ2V0U2libGluZ3MoY3VyTm9kZS5jaGlsZHJlbltpXSwgc2licykKCSAgICAgICAgfQoJICAgIH0KCSAgICAKCSAgICAvLyBub3RlIHNpYmxpbmdzIGZvciBlYWNoIHNpYmxpbmcKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGN1cl9zaWJzLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY3VyX3NpYnMubGVuZ3RoOyBqKyspIHsKCSAgICAgICAgICAgIGlmIChjdXJfc2lic1tqXSAhPSBjdXJfc2lic1tpXSkgewoJICAgICAgICAgICAgICAgIHNpYnNbY3VyX3NpYnNbaV1dID0gc2lic1tjdXJfc2lic1tpXV0gfHwgW107CgkgICAgICAgICAgICAgICAgc2lic1tjdXJfc2lic1tpXV0ucHVzaChjdXJfc2lic1tqXSk7CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiBzaWJzOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGZpbmQgdGhlIGFuY2VzdG9ycyBvZiB0aGUgc3BlY2lmaWVkIGdlbm90eXBlIHRoYXQgZW1lcmdlIGF0IGEgcGFydGljdWxhciB0aW1lIHBvaW50CgkqIEBwYXJhbSB7T2JqZWN0fSBsYXlvdXQgLS0gZm9yIGVhY2ggdGltZSBwb2ludCwgdGhlIGludGVydmFsIGJvdW5kYXJpZXMgZm9yIGVhY2ggZ2Vub3R5cGUgYXQgdGhhdCB0aW1lIHBvaW50CgkqIEBwYXJhbSB7T2JqZWN0fSB0cmVlQW5jZXN0b3JzQXJyIC0tIGZvciBlYWNoIGdlbm90eXBlIChwcm9wZXJ0aWVzKSwgYW4gYXJyYXkgb2YgdGhlaXIgYW5jZXN0b3JzICh2YWx1ZXMpCgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSB0aGUgZ2Vub3R5cGUgb2YgaW50ZXJlc3QKCSogQHBhcmFtIHtTdHJpbmd9IHRwIC0tIHRoZSB0aW1lIHBvaW50IG9mIGludGVyZXN0CgkqLwoJZnVuY3Rpb24gX2ZpbmRFbWVyZ2VudEFuY2VzdG9ycyhsYXlvdXQsIHRyZWVBbmNlc3RvcnNBcnIsIGd0eXBlLCB0cCkgewoJICAgIHZhciBhbmNlc3RvcnMgPSBbXSwKCSAgICAgICAgcG90X2FuY2VzdG9yOyAvLyBwb3RlbnRpYWwgYW5jZXN0b3IKCgkgICAgLy8gZm9yIGVhY2ggYW5jZXN0cmFsIGdlbm90eXBlLCAKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRyZWVBbmNlc3RvcnNBcnJbZ3R5cGVdLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIHBvdF9hbmNlc3RvciA9IHRyZWVBbmNlc3RvcnNBcnJbZ3R5cGVdW2ldOwoKCSAgICAgICAgLy8gaWYgdGhpcyBhbmNlc3RvciBlbWVyZ2VkIGhlcmUgYXMgd2VsbCwgaW5jcmVhc2UgdGhlICMgYW5jZXN0b3JzIGZvciB0aGlzIGdlbm90eXBlCgkgICAgICAgIGlmIChsYXlvdXRbdHBdW3BvdF9hbmNlc3Rvcl0gJiYgbGF5b3V0W3RwXVtwb3RfYW5jZXN0b3JdLnN0YXRlID09ICJlbWVyZ2VzIikgewoJICAgICAgICAgICAgYW5jZXN0b3JzLnB1c2gocG90X2FuY2VzdG9yKTsKCSAgICAgICAgfQoJICAgIH0KCgkgICAgcmV0dXJuIGFuY2VzdG9yczsKCX0KCgkvKiBlbGJvdyBmdW5jdGlvbiB0byBkcmF3IHBoeWxvZ2VueSBsaW5rcyAKCSovCglmdW5jdGlvbiBfZWxib3coZCkgewoJICAgIHJldHVybiAiTSIgKyBkLnNvdXJjZS54ICsgIiwiICsgZC5zb3VyY2UueSArIAoJICAgIAkiSCIgKyAoZC5zb3VyY2UueCArIChkLnRhcmdldC54LWQuc291cmNlLngpLzIpICsgCgkgICAgCSJWIiArIGQudGFyZ2V0LnkgKyAiSCIgKyBkLnRhcmdldC54OwoJfQoKCS8qCgkqIGZ1bmN0aW9uIHRvLCB1c2luZyB0aGUgdHJlZSBoaWVyYXJjaHksIGdldCB0aGUgbGluZWFyIHNlZ21lbnRzJyBzdGFydGluZyBrZXkgYW5kIGxlbmd0aCAoaW5jbHVkaW5nIHN0YXJ0aW5nIGtleSkKCSogQHBhcmFtIHtPYmplY3R9IGN1ck5vZGUgLS0gY3VycmVudCBrZXkgaW4gdGhlIHRyZWUKCSogQHBhcmFtIHtPYmplY3R9IGNoYWlucyAtLSBvcmlnaW5hbGx5IGVtcHR5IG9iamVjdCBvZiB0aGUgc2VnbWVudHMgCgkqICAgICAgICAgICAgICAgICAgICAgICAgICAgKGtleSBpcyBzZWdtZW50IHN0YXJ0IGtleSwgdmFsdWUgaXMgYXJyYXkgb2YgZGVzY2VuZGFudHMgaW4gdGhpcyBjaGFpbikKCSogQHBhcmFtIHtPYmplY3R9IGJhc2UgLS0gdGhlIGJhc2Uga2V5IG9mIHRoaXMgY2hhaW4gKG9yaWdpbmFsbHkgIiIpCgkqLwoJZnVuY3Rpb24gX2dldExpbmVhclRyZWVTZWdtZW50cyhjdXJWaXpPYmosIGN1ck5vZGUsIGNoYWlucywgYmFzZSkgewoKCSAgICAvLyBpZiBpdCdzIGEgbmV3IGJhc2UsIGNyZWF0ZSB0aGUgYmFzZSwgd2l0aCBubyBkZXNjZW5kYW50cyBpbiBpdHMgYXJyYXkgeWV0CgkgICAgaWYgKGJhc2UgPT09ICIiKSB7CgkgICAgICAgIGJhc2UgPSBjdXJOb2RlLmlkOwoJICAgICAgICBjaGFpbnNbYmFzZV0gPSBbXTsKCSAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZUNoYWluUm9vdHMucHVzaChjdXJOb2RlLmlkKTsKCSAgICB9CgkgICAgLy8gaWYgaXQncyBhIGxpbmVhciBkZXNjZW5kYW50LCBhcHBlbmQgdGhlIGN1cnJlbnQga2V5IHRvIHRoZSBjaGFpbgoJICAgIGVsc2UgewoJICAgICAgICBjaGFpbnNbYmFzZV0ucHVzaChjdXJOb2RlLmlkKTsKCSAgICB9CgoJICAgIC8vIGlmIHRoZSBjdXJyZW50IGtleSBoYXMgMSBjaGlsZCB0byBzZWFyY2ggdGhyb3VnaAoJICAgIGlmIChjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aCA9PSAxKSB7IAoJICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZS5jaGlsZHJlblswXSwgY2hhaW5zLCBiYXNlKTsKCSAgICB9CgoJICAgIC8vIG90aGVyd2lzZSBmb3IgZWFjaCBjaGlsZCwgY3JlYXRlIGEgYmxhbmsgYmFzZSAod2lsbCBiZWNvbWUgdGhhdCBjaGlsZCkKCSAgICBlbHNlIHsKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJOb2RlLmNoaWxkcmVuLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgICAgICBfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyTm9kZS5jaGlsZHJlbltpXSwgY2hhaW5zLCAiIik7CgkgICAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiBjaGFpbnM7Cgl9CgoJLy8gQ0VMTFVMQVIgUFJFVkFMRU5DRSBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIGNlbGx1bGFyIHByZXZhbGVuY2UgZGF0YSBpbiBhIGJldHRlciBmb3JtYXQgCgkqIChwcm9wZXJ0aWVzIGF0IGxldmVsIDEgaXMgdGltZSwgYXQgbGV2ZWwgMiBpcyBndHlwZSkKCSovCglmdW5jdGlvbiBfZ2V0Q1BEYXRhKGN1clZpek9iaikgewoJICAgIHZhciB4ID0gY3VyVml6T2JqLnVzZXJDb25maWc7CgoJICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQsIGZvciBlYWNoIGdlbm90eXBlLCBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZQoJICAgIHZhciBjcF9kYXRhX29yaWdpbmFsID0ge307CgkgICAgJC5lYWNoKHguY2xvbmFsX3ByZXYsIGZ1bmN0aW9uKGlkeCwgaGl0KSB7IC8vIGZvciBlYWNoIGhpdCAoZ2Vub3R5cGUvdGltZXBvaW50IGNvbWJpbmF0aW9uKQoJICAgICAgICBjcF9kYXRhX29yaWdpbmFsW2hpdC50aW1lcG9pbnRdID0gY3BfZGF0YV9vcmlnaW5hbFtoaXQudGltZXBvaW50XSB8fCB7fTsKCSAgICAgICAgLy8gb25seSBub3RlIGNlbGx1bGFyIHByZXZhbGVuY2VzIG5vdCBtYXJrZWQgYXMgemVybwoJICAgICAgICBpZiAocGFyc2VGbG9hdChoaXQuY2xvbmFsX3ByZXYpICE9PSAwKSB7CgkgICAgICAgICAgICBjcF9kYXRhX29yaWdpbmFsW2hpdC50aW1lcG9pbnRdW2hpdC5jbG9uZV9pZF0gPSBwYXJzZUZsb2F0KGhpdC5jbG9uYWxfcHJldik7IAoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIC8vIGNyZWF0ZSB0aW1lcG9pbnQgemVybyB3aXRoIDEwMCUgY2VsbHVsYXIgcHJldmFsZW5jZSBmb3IgdGhlIHJvb3Qgb2YgdGhlIHRyZWUKCSAgICBjcF9kYXRhX29yaWdpbmFsLlQwID0ge307CgkgICAgY3VyVml6T2JqLmRhdGEuY3BfZGF0YV9vcmlnaW5hbCA9IGNwX2RhdGFfb3JpZ2luYWw7CgoJICAgIC8vIGdldCBub3JtYWxpemVkIGNwIGRhdGEgKGluIGNhc2VzIHdoZXJlIGNwIGRvZXNuJ3QgYWRkIHRvIDEpCgkgICAgdmFyIGNwX2RhdGFfbm9ybSA9IHt9OwoJICAgIE9iamVjdC5rZXlzKGNwX2RhdGFfb3JpZ2luYWwpLmZvckVhY2goZnVuY3Rpb24odHBfa2V5KSB7CgkgICAgICAgIC8vIGdldCB0b3RhbCBjcCBmb3IgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgdmFyIHRwX3RvdGFsID0gMDsKCSAgICAgICAgT2JqZWN0LmtleXMoY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlX2tleSkgewoJICAgICAgICAgICAgdHBfdG90YWwgKz0gY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldW2d0eXBlX2tleV07CgkgICAgICAgIH0pOwoKCSAgICAgICAgLy8gZ2V0IHByb3BvcnRpb25hdGUgY3AgZm9yIGVhY2ggZ2Vub3R5cGUKCSAgICAgICAgY3BfZGF0YV9ub3JtW3RwX2tleV0gPSB7fTsKCSAgICAgICAgT2JqZWN0LmtleXMoY3BfZGF0YV9vcmlnaW5hbFt0cF9rZXldKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlX2tleSkgewoJICAgICAgICAgICAgY3BfZGF0YV9ub3JtW3RwX2tleV1bZ3R5cGVfa2V5XSA9IGNwX2RhdGFfb3JpZ2luYWxbdHBfa2V5XVtndHlwZV9rZXldL3RwX3RvdGFsOwoJICAgICAgICB9KTsKCSAgICB9KQoKCSAgICBjdXJWaXpPYmouZGF0YS5jcF9kYXRhID0gY3BfZGF0YV9ub3JtOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgY2VsbHVsYXIgcHJldmFsZW5jZSB2YWx1ZSBmb3IgZWFjaCBnZW5vdHlwZSBhdCBpdHMgZW1lcmdlbmNlCgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfZ2V0RW1lcmdlbmNlVmFsdWVzKGN1clZpek9iaikgewoJICAgIHZhciBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgZW1lcmdlbmNlX3ZhbHVlcyA9IHt9LAoJICAgICAgICBndHlwZXM7CgoJICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQKCSAgICBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLmZvckVhY2goZnVuY3Rpb24odHApIHsgCgoJICAgICAgICAvLyBnZXQgZ2Vub3R5cGVzCgkgICAgICAgIGd0eXBlcyA9IE9iamVjdC5rZXlzKGNwX2RhdGFbdHBdKTsgCgoJICAgICAgICAvLyBhZGQgZ2Vub3R5cGVzIGlmIG5vdCBwcmVzZW50IGFscmVhZHkKCSAgICAgICAgJC5lYWNoKGd0eXBlcywgZnVuY3Rpb24oaWR4LCBnKSB7CgkgICAgICAgICAgICBpZiAoT2JqZWN0LmtleXMoZW1lcmdlbmNlX3ZhbHVlcykuaW5kZXhPZihnKSA9PSAtMSkgeyAKCSAgICAgICAgICAgICAgICBlbWVyZ2VuY2VfdmFsdWVzW2ddID0gY3BfZGF0YVt0cF1bZ107CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pCgkgICAgfSk7CgoJICAgIHJldHVybiBlbWVyZ2VuY2VfdmFsdWVzOwoJfTsKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIHRpbWVwb2ludCB0aGF0IGVhY2ggZ2Vub3R5cGUgZW1lcmdlcwoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldEVtZXJnZW5jZVRpbWVwb2ludHMoY3VyVml6T2JqKSB7CgkgICAgdmFyIGNwX2RhdGEgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhLAoJICAgICAgICBlbWVyZ2VuY2VfdHBzID0ge30sCgkgICAgICAgIGd0eXBlczsKCgkgICAgLy8gZm9yIGVhY2ggdGltZSBwb2ludAoJICAgIGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMuZm9yRWFjaChmdW5jdGlvbih0cCkgeyAKCgkgICAgICAgIC8vIGdldCBnZW5vdHlwZXMKCSAgICAgICAgZ3R5cGVzID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pOyAKCgkgICAgICAgIC8vIGFkZCBnZW5vdHlwZXMgaWYgbm90IHByZXNlbnQgYWxyZWFkeQoJICAgICAgICAkLmVhY2goZ3R5cGVzLCBmdW5jdGlvbihpZHgsIGcpIHsKCSAgICAgICAgICAgIGlmIChPYmplY3Qua2V5cyhlbWVyZ2VuY2VfdHBzKS5pbmRleE9mKGcpID09IC0xKSB7IAoJICAgICAgICAgICAgICAgIGVtZXJnZW5jZV90cHNbZ10gPSB0cDsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCSAgICB9KTsKCgkgICAgcmV0dXJuIGVtZXJnZW5jZV90cHM7Cgl9OwoKCS8qIGZ1bmN0aW9uIHRvIGdldCB0aGUgZ2Vub3R5cGUtY2VudHJpYyBjZWxsdWxhciBwcmV2YWxlbmNlIGRhdGEgZnJvbSB0aGUgdGltZS1jZW50cmljIGNlbGx1bGFyIHByZXZhbGVuY2UgZGF0YQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldEdlbm90eXBlQ1BEYXRhKGN1clZpek9iaikgewoJICAgIHZhciBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgZ2Vub3R5cGVfY3AgPSB7fTsKCgkgICAgT2JqZWN0LmtleXMoY3BfZGF0YSkuZm9yRWFjaChmdW5jdGlvbih0cCwgdHBfaWR4KSB7CgkgICAgICAgIE9iamVjdC5rZXlzKGNwX2RhdGFbdHBdKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlLCBndHlwZV9pZHgpIHsKCSAgICAgICAgICAgIGdlbm90eXBlX2NwW2d0eXBlXSA9IGdlbm90eXBlX2NwW2d0eXBlXSB8fCB7fTsKCSAgICAgICAgICAgIGdlbm90eXBlX2NwW2d0eXBlXVt0cF0gPSBjcF9kYXRhW3RwXVtndHlwZV07CgkgICAgICAgIH0pOwoJICAgIH0pOyAKCgkgICAgY3VyVml6T2JqLmRhdGEuZ2Vub3R5cGVfY3AgPSBnZW5vdHlwZV9jcDsKCX0KCgkvLyBMQVlPVVQgRlVOQ1RJT05TCgoJLyogZnVuY3Rpb24gdG8gZ2V0IHRoZSBsYXlvdXQgb2YgdGhlIHRpbWVzY2FwZSwgZGlmZmVyZW50IGRlcGVuZGluZyBvbiB3aGV0aGVyIHVzZXIgd2FudHMgY2VudHJlZCwKCSogc3RhY2tlZCBvciBzcGFjZWQgdmlldwoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldExheW91dChjdXJWaXpPYmopIHsKCSAgICB2YXIgZ3R5cGVQb3MgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5nZW5vdHlwZV9wb3NpdGlvbjsKCgoJICAgIC8vIHRyYXZlcnNlIHRoZSB0cmVlIHRvIHNvcnQgdGhlIGdlbm90eXBlcyBpbnRvIGEgZmluYWwgdmVydGljYWwgc3RhY2tpbmcgb3JkZXIgKGluY29ycG9yYXRpbmcgaGllcmFyY2h5KQoJICAgIGN1clZpek9iai5kYXRhLmxheW91dE9yZGVyID0gX2dldExheW91dE9yZGVyKGN1clZpek9iai5nZW5lcmFsQ29uZmlnLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmVtZXJnZW5jZV92YWx1ZXMsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmVtZXJnZW5jZV90cHMsIAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLnVzZXJDb25maWcuc29ydF9ndHlwZXMpOwoKCSAgICAvLyAtLS0tLS0+IENFTlRSRUQgCgkgICAgaWYgKGd0eXBlUG9zID09ICJjZW50cmUiKSB7CgoJICAgICAgICAvLyBnZXQgbGF5b3V0IG9mIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lcG9pbnQKCSAgICAgICAgY3VyVml6T2JqLmRhdGEubGF5b3V0ID0ge307CgkgICAgICAgICQuZWFjaChjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLCBmdW5jdGlvbih0cF9pZHgsIHRwKSB7IAoJICAgICAgICAgICAgX2dldENlbnRyZWRMYXlvdXQoY3VyVml6T2JqLCBjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlLCB0cCwgY3VyVml6T2JqLmRhdGEubGF5b3V0LCAwKTsKCSAgICAgICAgfSkKCSAgICB9CgoJICAgIC8vIC0tLS0tLT4gU1RBQ0tFRCBhbmQgU1BBQ0VECgkgICAgZWxzZSB7CgoJICAgICAgICAvLyBnZXQgbGF5b3V0IG9mIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lcG9pbnQKCSAgICAgICAgaWYgKGd0eXBlUG9zID09ICJzdGFjayIpIHsKCSAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmxheW91dCA9IF9nZXRTdGFja2VkTGF5b3V0KGN1clZpek9iaik7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSBpZiAoZ3R5cGVQb3MgPT0gInNwYWNlIikgewoJICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEubGF5b3V0ID0gX2dldFNwYWNlZExheW91dChjdXJWaXpPYmopOyAKCSAgICAgICAgfQoJICAgIH0gICAKCgkgICAgLy8gU0hJRlQgRU1FUkdFTkNFIFgtQ09PUkRJTkFURVMKCgkgICAgLy8gaW4gdGhlIGxheW91dCwgc2hpZnQgeC12YWx1ZXMgaWYgPjEgZ2Vub3R5cGUgZW1lcmdlcyBhdCB0aGUgCgkgICAgLy8gc2FtZSB0aW1lIHBvaW50IGZyb20gdGhlIHNhbWUgY2xhZGUgaW4gdGhlIHRyZWUKCSAgICBfc2hpZnRFbWVyZ2VuY2UoY3VyVml6T2JqKQoJfQoKCS8qCgkqIGZ1bmN0aW9uIHRvLCB1c2luZyB0aGUgb3JkZXIgb2YgZ2Vub3R5cGUgZW1lcmdlbmNlICh2YWx1ZSAmIHRwKSBhbmQgdGhlIHRyZWUgaGllcmFyY2h5LCBnZXQgdGhlIHZlcnRpY2FsCgkqIHN0YWNraW5nIG9yZGVyIG9mIHRoZSBnZW5vdHlwZXMKCSogLS0gZW5zdXJlcyB0aGF0IHRoZSAqbGF0ZXIqIGNoaWxkcmVuIGVtZXJnZSwgdGhlICpjbG9zZXIqIHRoZXkgYXJlIHRvIHRoZSB0b3Agb2YgdGhlIHBhcmVudCBzd2VlcAoJKiBAcGFyYW0ge09iamVjdH0gZGltIC0tIGdlbmVyYWwgY29uZmlndXJhdGlvbnMgb2YgdGhlIHZpc3VhbGl6YXRpb24KCSogQHBhcmFtIHtPYmplY3R9IHRpbWVzY2FwZV9kYXRhIC0tIHRpbWVzY2FwZSBkYXRhCgkqIEBwYXJhbSB7QXJyYXl9IGVtZXJnZW5jZV92YWx1ZXMgLS0gdmFsdWVzIG9mIGdlbm90eXBlIGVtZXJnZW5jZQoJKiBAcGFyYW0ge0FycmF5fSBlbWVyZ2VuY2VfdHBzIC0tIHRpbWVwb2ludHMgb2YgZ2Vub3R5cGUgZW1lcmdlbmNlCgkqIEBwYXJhbSB7QXJyYXl9IHRpbWVwb2ludHMgLS0gdGltZXBvaW50cyBpbiBkYXRhc2V0CgkqIEBwYXJhbSB7QXJyYXl9IGxheW91dE9yZGVyIC0tIG9yaWdpbmFsbHkgZW1wdHkgYXJyYXkgb2YgdGhlIGZpbmFsIHZlcnRpY2FsIHN0YWNraW5nIG9yZGVyCgkqIEBwYXJhbSB7Qm9vbGVhbn0gc29ydF9ieV9lbWVyZyAtLSB3aGV0aGVyIG9yIG5vdCB0byB2ZXJ0aWNhbGx5IHNvcnQgY2hpbGRyZW4gYnkgZW1lcmdlbmNlIHZhbHVlcwoJKi8KCWZ1bmN0aW9uIF9nZXRMYXlvdXRPcmRlcihkaW0sIGN1ck5vZGUsIGVtZXJnZW5jZV92YWx1ZXMsIGVtZXJnZW5jZV90cHMsIHRpbWVwb2ludHMsIGxheW91dE9yZGVyLCBzb3J0X2J5X2VtZXJnKSB7CgkgICAgdmFyIGNoaWxkX2VtZXJnX3ZhbHMgPSBbXSwgLy8gZW1lcmdlbmNlIHZhbHVlcyBvZiBjaGlsZHJlbgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4sIC8vIGNoaWxkcmVuIHNvcnRlZCBieSB0aGVpciBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgIGNoaWxkX29iajsgLy8gY3VycmVudCBjaGlsZCBub2RlCgoJICAgIC8vIGFkZCB0aGUgY3VycmVudCBrZXkgaWQgdG8gdGhlIGZpbmFsIHZlcnRpY2FsIHN0YWNraW5nIG9yZGVyCgkgICAgaWYgKGN1ck5vZGUuaWQgIT0gZGltLnBoYW50b21Sb290KSB7CgkgICAgICAgIGxheW91dE9yZGVyLnB1c2goY3VyTm9kZS5pZCk7CgkgICAgfQoKCSAgICAvLyBpZiB0aGUgY3VycmVudCBrZXkgaGFzIGNoaWxkcmVuIHRvIHNlYXJjaCB0aHJvdWdoCgkgICAgaWYgKGN1ck5vZGUuY2hpbGRyZW4gJiYgY3VyTm9kZS5jaGlsZHJlbi5sZW5ndGggPiAwKSB7CgoJICAgICAgICAvLyBnZXQgZW1lcmdlbmNlIHZhbHVlICYgdGltZXBvaW50IG9mIGNoaWxkcmVuCgkgICAgICAgIGZvciAoaT0wOyBpPGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBlbWVyZ192YWwgPSBlbWVyZ2VuY2VfdmFsdWVzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdLAoJICAgICAgICAgICAgICAgIGVtZXJnZV90cCA9IHRpbWVwb2ludHMuaW5kZXhPZihlbWVyZ2VuY2VfdHBzW2N1ck5vZGUuY2hpbGRyZW5baV0uaWRdKTsKCgkgICAgICAgICAgICBjaGlsZF9lbWVyZ192YWxzLnB1c2goCgkgICAgICAgICAgICAgICAgewoJICAgICAgICAgICAgICAgICAgICAiaWQiOiBjdXJOb2RlLmNoaWxkcmVuW2ldLmlkLAoJICAgICAgICAgICAgICAgICAgICAiZW1lcmdfdmFsIjogZW1lcmdfdmFsLAoJICAgICAgICAgICAgICAgICAgICAidHAiOiB0aW1lcG9pbnRzLmxlbmd0aCAtIGVtZXJnZV90cCAKCSAgICAgICAgICAgICAgICB9KTsKCSAgICAgICAgICAgIC8vIHZlcnRpY2FsbHkgc29ydCBjaGlsZHJlbiBieSB0aGVpciBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgICAgICBpZiAoc29ydF9ieV9lbWVyZykgewoJICAgICAgICAgICAgICAgIHNvcnRlZF9jaGlsZHJlbiA9IF9zb3J0QnlLZXkoY2hpbGRfZW1lcmdfdmFscywgInRwIiwgImVtZXJnX3ZhbCIpOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgLy8gZG8gbm90IHZlcnRpY2FsbHkgc29ydCBieSBlbWVyZ2VuY2UgdmFsdWVzCgkgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICBzb3J0ZWRfY2hpbGRyZW4gPSBfc29ydEJ5S2V5KGNoaWxkX2VtZXJnX3ZhbHMsICJ0cCIpOwoJICAgICAgICAgICAgfQoJICAgICAgICB9CgoJICAgICAgICAvLyBpbiB0aGUgKnJldmVyc2UqIG9yZGVyIG9mIGVtZXJnZW5jZSB2YWx1ZXMsIHNlYXJjaCBjaGlsZHJlbgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKGNoaWxkKSB7CgkgICAgICAgICAgICBjaGlsZF9vYmogPSBfLmZpbmRXaGVyZShjdXJOb2RlLmNoaWxkcmVuLCB7aWQ6IGNoaWxkLmlkfSk7CgkgICAgICAgICAgICBfZ2V0TGF5b3V0T3JkZXIoZGltLCBjaGlsZF9vYmosIGVtZXJnZW5jZV92YWx1ZXMsIGVtZXJnZW5jZV90cHMsIHRpbWVwb2ludHMsIGxheW91dE9yZGVyLCBzb3J0X2J5X2VtZXJnKTsKCSAgICAgICAgfSkKCSAgICB9CgoJICAgIHJldHVybiBsYXlvdXRPcmRlcjsKCX0KCgkvKgoJKiBmdW5jdGlvbiB0byBnZXQgdGhlIGxheW91dCBvZiB0aGUgdGltZXNjYXBlCgkqIC0tIGVuc3VyZXMgdGhhdCB0aGUgKmxhdGVyKiBjaGlsZHJlbiBlbWVyZ2UsIHRoZSAqY2xvc2VyKiB0aGV5IGFyZSB0byB0aGUgdG9wIG9mIHRoZSBwYXJlbnQgc3dlZXAKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKiBAcGFyYW0ge09iamVjdH0gY3VyTm9kZSAtLSBjdXJyZW50IGtleSBpbiB0aGUgdHJlZQoJKiBAcGFyYW0ge051bWJlcn0geUJvdHRvbSAtLSB3aGVyZSBpcyB0aGUgYm90dG9tIG9mIHRoaXMgZ2Vub3R5cGUsIGluIHRoZSB5LWRpbWVuc2lvbgoJKi8KCWZ1bmN0aW9uIF9nZXRDZW50cmVkTGF5b3V0KGN1clZpek9iaiwgY3VyTm9kZSwgdHAsIGxheW91dCwgeUJvdHRvbSkgewoJICAgIHZhciBndHlwZSA9IGN1ck5vZGUuaWQsCgkgICAgICAgIGNwX2RhdGEgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhLAoJICAgICAgICB0aW1lcG9pbnRzID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cywKCSAgICAgICAgbmV4dF90cCA9IHRpbWVwb2ludHNbdGltZXBvaW50cy5pbmRleE9mKHRwKSsxXSwKCSAgICAgICAgcHJldl90cCA9IHRpbWVwb2ludHNbdGltZXBvaW50cy5pbmRleE9mKHRwKS0xXSwKCSAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBDVVJSRU5UIHRpbWUgcG9pbnQKCSAgICAgICAgLy8gZ2Vub3R5cGVzIHdpdGggY3AgZGF0YSBhdCB0aGUgUFJFVklPVVMgdGltZSBwb2ludAoJICAgICAgICBnVHlwZXNfcHJldlRQID0gKGNwX2RhdGFbcHJldl90cF0pID8gT2JqZWN0LmtleXMoY3BfZGF0YVtwcmV2X3RwXSkgOiB1bmRlZmluZWQsIAoJICAgICAgICBjdXJEZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltndHlwZV0sCgkgICAgICAgIGdUeXBlQW5kRGVzY2VuZGFudHMgPSAoJC5leHRlbmQoW10sIGN1ckRlc2NlbmRhbnRzKSksCgkgICAgICAgIG5DaGlsZHJlbiA9IGN1ck5vZGUuY2hpbGRyZW4ubGVuZ3RoLAoJICAgICAgICBjaGlsZENQID0gMCwgLy8gY3VtdWxhdGl2ZSBhbW91bnQgb2YgY2VsbHVsYXIgcHJldmFsZW5jZSBpbiB0aGUgY2hpbGRyZW47CgkgICAgICAgIGNoaWxkWUJvdHRvbSwgLy8gYm90dG9tIHktdmFsdWUgZm9yIHRoZSBuZXh0IGNoaWxkCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIHNvcnRlZF9jaGlsZHJlbiwgLy8gY2hpbGRyZW4gc29ydGVkIGJ5IHRoZSBsYXlvdXQgb3JkZXIKCSAgICAgICAgY3VyX2NwID0gY3BfZGF0YVt0cF1bZ3R5cGVdLAoJICAgICAgICBwcmV2X2NwID0gKGNwX2RhdGFbcHJldl90cF0pID8gY3BfZGF0YVtwcmV2X3RwXVtndHlwZV0gOiB1bmRlZmluZWQsIC8vIENQIGZvciB0aGlzIGdlbm90eXBlLCBwcmV2IHRwCgkgICAgICAgIHRocmVzaG9sZCA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRocmVzaG9sZCwgLy8gY2VsbHVsYXIgcHJldmFsZW5jZSB0aHJlc2hvbGQgZm9yIHZpc2liaWxpdHkgb2YgYSBnZW5vdHlwZQoJICAgICAgICAvLyB0aGUgd2lkdGggb2YgdGhpcyBnZW5vdHlwZSwgaW5jbHVkaW5nIGRlc2NlbmRhbnRzCgkgICAgICAgIHdpZHRoID0gX2NhbGN1bGF0ZVdpZHRoKGN1clZpek9iaiwgdHAsIGd0eXBlLCB0aHJlc2hvbGQpLndpZHRoLCAKCSAgICAgICAgZW1lcmdlZCwgLy8gd2hldGhlciBvciBub3QgdGhlIGdlbm90eXBlIGVtZXJnZWQgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgIGRpc2FwcGVhcnMgPSAocHJldl9jcCAmJiAhY3VyX2NwKTsgLy8gd2hldGhlciB0aGlzIGdlbm90eXBlIGRpc2FwcGVhcnMgYXQgdGhlIGN1cnJlbnQgdGltZSBwb2ludAoJICAgIAoJICAgIGdUeXBlQW5kRGVzY2VuZGFudHMucHVzaChndHlwZSk7CgkgICAgCgkgICAgZW1lcmdlZCA9IF9nZXRJbnRlcnNlY3Rpb24oZ1R5cGVBbmREZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwICYmIAoJICAgICAgICBnVHlwZXNfcHJldlRQICYmIAoJICAgICAgICBfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19wcmV2VFApLmxlbmd0aCA9PT0gMDsgCgoJICAgIC8vIGxheW91dCBmb3IgdGhpcyB0aW1lcG9pbnQKCSAgICBsYXlvdXRbdHBdID0gbGF5b3V0W3RwXSB8fCB7fTsKCgkgICAgLy8gaWYgdGhlIGdlbm90eXBlIG9yIGFueSBkZXNjZW5kYW50cyBleGlzdCBhdCB0aGlzIHRpbWVwb2ludCwgb3IgaWYgdGhlIGdlbm90eXBlIGRpc2FwcGVhcnMgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgaWYgKGN1cl9jcCB8fCAoX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGggPiAwKSB8fCBkaXNhcHBlYXJzKSB7CgoJICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIGVtZXJnZWQgYXQgdGhlIHByZXZpb3VzIHRpbWUgcG9pbnQKCSAgICAgICAgaWYgKGVtZXJnZWQgJiYgZ3R5cGUgIT0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcucGhhbnRvbVJvb3QpIHsKCgkgICAgICAgICAgICBsYXlvdXRbcHJldl90cF1bZ3R5cGVdID0gewoJICAgICAgICAgICAgICAgICJ3aWR0aCI6IDAsCgkgICAgICAgICAgICAgICAgIm1pZGRsZSI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgImJvdHRvbSI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgInRvcCI6IHlCb3R0b20gKyAod2lkdGgvMiksCgkgICAgICAgICAgICAgICAgImNwIjogMCwKCSAgICAgICAgICAgICAgICAic3RhdGUiOiAiZW1lcmdlcyIKCSAgICAgICAgICAgIH07CgkgICAgICAgIH0KCgkgICAgICAgIC8vIHNldCB0aGlzIGdlbm90eXBlIGluIHRoZSBsYXlvdXQgCgkgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdID0gewoJICAgICAgICAgICAgIndpZHRoIjogd2lkdGgsCgkgICAgICAgICAgICAibWlkZGxlIjogeUJvdHRvbSArICh3aWR0aC8yKSwKCSAgICAgICAgICAgICJib3R0b20iOiB5Qm90dG9tLAoJICAgICAgICAgICAgInRvcCI6IHlCb3R0b20gKyB3aWR0aCwKCSAgICAgICAgICAgICJjcCI6IGN1cl9jcCwKCSAgICAgICAgICAgICJzdGF0ZSI6ICJwcmVzZW50IiwKCSAgICAgICAgICAgICJwcmVzZW50Q2hpbGRyZW4iOiBfZ2V0SW50ZXJzZWN0aW9uKGN1clZpek9iai5kYXRhLmRpcmVjdF9kZXNjZW5kYW50c1tndHlwZV0sIGdUeXBlc19jdXJUUCkubGVuZ3RoCgkgICAgICAgIH0KCgkgICAgICAgIC8vIG1hcmsgZGlzYXBwZWFyYW5jZSBzdGF0ZQoJICAgICAgICBpZiAoZGlzYXBwZWFycykgewoJICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0uc3RhdGUgPSAiZGlzYXBwZWFyc19zdHJldGNoZWQiOwoJICAgICAgICB9CgkgICAgfQoKCSAgICAvLyBpZiB0aGVyZSBhcmUgY2hpbGRyZW4KCSAgICBpZiAobkNoaWxkcmVuID4gMCkgewoKCSAgICAgICAgLy8gc29ydCB0aGUgY2hpbGRyZW4gYnkgdGhlIGxheW91dCBvcmRlcgoJICAgICAgICBzb3J0ZWRfY2hpbGRyZW4gPSAkLmV4dGVuZChbXSwgY3VyTm9kZS5jaGlsZHJlbik7CgkgICAgICAgIHNvcnRlZF9jaGlsZHJlbi5zb3J0KF9zb3J0QnlMYXlvdXRPcmRlcihsYXlvdXRPcmRlcikpOwoKCSAgICAgICAgLy8gZm9yIGVhY2ggY2hpbGQKCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuQ2hpbGRyZW47IGkrKykgewoKCSAgICAgICAgICAgIC8vIGdldCB0aGUgeS1jb29yZGluYXRlIGZvciB0aGUgYm90dG9tIG9mIHRoZSBjaGlsZCdzIGludGVydmFsCgkgICAgICAgICAgICBjaGlsZFlCb3R0b20gPSAoY3VyX2NwKSA/IC8vIGlmIHRoZSBjaGlsZCdzIGRpcmVjdCBhbmNlc3RvciBoYXMgY2VsbHVsYXIgcHJldmFsZW5jZSBhdCB0aGlzIHRpbWUKCSAgICAgICAgICAgICAgICAoKChpKzEpLyhuQ2hpbGRyZW4rMSkpICogY3VyX2NwKSArIGNoaWxkQ1AgKyB5Qm90dG9tIDogCgkgICAgICAgICAgICAgICAgY2hpbGRDUCArIHlCb3R0b207CgoJICAgICAgICAgICAgLy8gZ2V0IHRoZSBjaGlsZCdzIGxheW91dAoJICAgICAgICAgICAgX2dldENlbnRyZWRMYXlvdXQoY3VyVml6T2JqLCBzb3J0ZWRfY2hpbGRyZW5baV0sIHRwLCBsYXlvdXQsIGNoaWxkWUJvdHRvbSk7CgoJICAgICAgICAgICAgLy8gaW5jcmVhc2UgdGhlIGNlbGx1bGFyIHByZXZhbGVuY2Ugb2YgdGhlIGN1cnJlbnQgZ2Vub3R5cGUncyBjaGlsZHJlbiAoK2Rlc2NlbmRhbnRzKSBhY2NvdW50ZWQgZm9yCgkgICAgICAgICAgICBjaGlsZENQICs9IF9jYWxjdWxhdGVXaWR0aChjdXJWaXpPYmosIHRwLCBzb3J0ZWRfY2hpbGRyZW5baV0uaWQsIHRocmVzaG9sZCkud2lkdGg7CgkgICAgICAgIH0KCSAgICB9Cgl9OwoKCS8qIGZ1bmN0aW9uIHRvIGdldCBjZWxsdWxhciBwcmV2YWxlbmNlcyBmb3IgZWFjaCBnZW5vdHlwZSBpbiBhIHN0YWNrLCBvbmUgc3RhY2sgZm9yIGVhY2ggdGltZSBwb2ludAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldFN0YWNrZWRMYXlvdXQoY3VyVml6T2JqKSB7CgkgICAgdmFyIGxheW91dCA9IHt9LAoJICAgICAgICBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIGN1ckRlc2NlbmRhbnRzLAoJICAgICAgICBnVHlwZUFuZERlc2NlbmRhbnRzLCAvLyBnZW5vdHlwZSBhbmQgZGVzY2VuZGFudHMKCSAgICAgICAgZ1R5cGVzX2N1clRQLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBDVVJSRU5UIHRpbWUgcG9pbnQKCSAgICAgICAgZWZmZWN0aXZlX2NwLCAvLyBlZmZlY3RpdmUgY3AgZm9yIHRoaXMgZ2Vub3R5cGUgYXQgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgd2lkdGgsIC8vIHdpZHRoIHRvIGFkZCBmb3IgdGhpcyBnZW5vdHlwZSBhdCB0aGlzIHRpbWVwb2ludCAoaW5jbHVkZXMgZGVzY2VuZGFudHMgd2lkdGhzKQoJICAgICAgICBtaWRwb2ludCwgLy8gbWlkcG9pbnQgZm9yIGVtZXJnZW5jZQoJICAgICAgICB0aHJlc2hvbGQgPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy50aHJlc2hvbGQ7IC8vIGNlbGx1bGFyIHByZXZhbGVuY2UgdGhyZXNob2xkIGZvciB2aXNpYmlsaXR5IG9mIGEgZ2Vub3R5cGUKCgkgICAgLy8gZm9yIGVhY2ggdGltZXBvaW50IChpbiBvcmRlcikuLi4KCSAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24odHBfaWR4LCB0cCkgeyAKCgkgICAgICAgIC8vIHN0YWNrIGZvciB0aGlzIHRpbWUgcG9pbnQgKG1heSBhbHJlYWR5IGJlIGNyZWF0ZWQgaWYgZGlzYXBwZWFyYW5jZSBvY2N1cnMgYXQgdGhpcyB0aW1lIHBvaW50KQoJICAgICAgICBsYXlvdXRbdHBdID0gbGF5b3V0W3RwXSB8fCB7fTsgCgoJICAgICAgICB2YXIgY3AgPSBjcF9kYXRhW3RwXSwgLy8gY2VsbHVsYXIgcHJldmFsZW5jZSBkYXRhIGZvciB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgIHNIZWlnaHQgPSAwLCAvLyBjdXJyZW50IGhlaWdodCBvZiB0aGUgc3RhY2sKCSAgICAgICAgICAgIHByZXZfdHAgPSB0aW1lcG9pbnRzW3RwX2lkeC0xXSwKCSAgICAgICAgICAgIG5leHRfdHAgPSB0aW1lcG9pbnRzW3RwX2lkeCsxXTsKCgkgICAgICAgIC8vIC4uLiBmb3IgZWFjaCBnZW5vdHlwZSAuLi4KCSAgICAgICAgJC5lYWNoKGxheW91dE9yZGVyLCBmdW5jdGlvbihndHlwZV9pZHgsIGd0eXBlKSB7IAoJICAgICAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pOyAKCSAgICAgICAgICAgIGdUeXBlc19wcmV2VFAgPSAoY3BfZGF0YVtwcmV2X3RwXSkgPyBPYmplY3Qua2V5cyhjcF9kYXRhW3ByZXZfdHBdKSA6IHVuZGVmaW5lZDsgCgkgICAgICAgICAgICBjdXJEZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltndHlwZV07CgkgICAgICAgICAgICBnVHlwZUFuZERlc2NlbmRhbnRzID0gKCQuZXh0ZW5kKFtdLCBjdXJEZXNjZW5kYW50cykpOyAKCSAgICAgICAgICAgIGdUeXBlQW5kRGVzY2VuZGFudHMucHVzaChndHlwZSk7IAoJICAgICAgICAgICAgCgkgICAgICAgICAgICAvLyBjYWxjdWxhdGUgZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgCgkgICAgICAgICAgICAvLyAiZWZmZWN0aXZlIiBiZWNhdXNlOiAKCSAgICAgICAgICAgIC8vICAgICAgICAgICAgICAgICAgLSBpdCBpcyBpbmNyZWFzZWQgaWYgaXQncyBiZWxvdyB0aGUgdGhyZXNob2xkCgkgICAgICAgICAgICAvLyAgICAgICAgICAgICAgICAgIC0gaXQgaXMgcmVkdWNlZCBpZiBzaWJsaW5ncyBhcmUgYmVsb3cgdGhyZXNob2xkIGFuZCB0aGVyZWZvcmUgaW5jcmVhc2VkCgkgICAgICAgICAgICBlZmZlY3RpdmVfY3AgPSBfY2FsY3VsYXRlV2lkdGgoY3VyVml6T2JqLCB0cCwgZ3R5cGUsIHRocmVzaG9sZCkuZWZmZWN0aXZlX2NwOwoJICAgICAgICAgICAgd2lkdGggPSBfY2FsY3VsYXRlV2lkdGgoY3VyVml6T2JqLCB0cCwgZ3R5cGUsIHRocmVzaG9sZCkud2lkdGg7CgoKCSAgICAgICAgICAgIC8vIERJU0FQUEVBUklORyBMSU5FQUdFCgkgICAgICAgICAgICAvLyBpZiB0aGlzIGdlbm90eXBlIGV4aXN0ZWQgYXQgdGhlIHByZXYgdGltZSBwb2ludCwgCgkgICAgICAgICAgICAvLyBidXQgbmVpdGhlciBpdCBub3IgaXRzIGRlc2NlbmRhbnRzIGFyZSBjdXJyZW50bHkgcHJlc2VudAoJICAgICAgICAgICAgaWYgKGNwX2RhdGFbcHJldl90cF0gJiYgY3BfZGF0YVtwcmV2X3RwXVtndHlwZV0gJiYgIWNwX2RhdGFbdHBdW2d0eXBlXSAmJiAKCSAgICAgICAgICAgICAgICBfZ2V0SW50ZXJzZWN0aW9uKGdUeXBlQW5kRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoID09PSAwKSB7CgkgICAgICAgICAgICAgICAgX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgdHAsIGd0eXBlLCBzSGVpZ2h0LCBzSGVpZ2h0LCBlZmZlY3RpdmVfY3AsICJkaXNhcHBlYXJzX3N0cmV0Y2hlZCIpOwoJICAgICAgICAgICAgfQoKCSAgICAgICAgICAgIC8vIE5PTi1ESVNBUFBFQVJJTkcgTElORUFHRQoJICAgICAgICAgICAgZWxzZSB7CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgZ2Vub3R5cGUgaXMgUkVQTEFDRUQgYnkgYW55IGRlc2NlbmRhbnQgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgaWYgKCFjcF9kYXRhW3RwXVtndHlwZV0gJiYgKF9nZXRJbnRlcnNlY3Rpb24oY3VyRGVzY2VuZGFudHMsIGdUeXBlc19jdXJUUCkubGVuZ3RoID4gMCkpIHsKCgkgICAgICAgICAgICAgICAgICAgIF9jcmVhdGVTdGFja0VsZW1lbnQoY3VyVml6T2JqLCBsYXlvdXQsIHRwLCBndHlwZSwgc0hlaWdodCwgc0hlaWdodCArIHdpZHRoLCBlZmZlY3RpdmVfY3AsICJyZXBsYWNlZCIpOwoJICAgICAgICAgICAgICAgICAgICBtaWRwb2ludCA9IChsYXlvdXRbdHBdW2d0eXBlXS5ib3R0b20gKyBsYXlvdXRbdHBdW2d0eXBlXS50b3ApLzI7CgoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBnZW5vdHlwZSBvciBhbnkgZGVzY2VuZGFudHMgRVhJU1QgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgZWxzZSBpZiAoX2dldEludGVyc2VjdGlvbihnVHlwZUFuZERlc2NlbmRhbnRzLCBnVHlwZXNfY3VyVFApLmxlbmd0aCA+IDApIHsKCSAgICAgICAgICAgICAgICAgICAgdmFyIG5fZGVzY19wcmVzZW50ID0gX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGg7CgoJICAgICAgICAgICAgICAgICAgICAvLyBjcmVhdGUgaXQgYXMgcHJlc2VudAoJICAgICAgICAgICAgICAgICAgICBfY3JlYXRlU3RhY2tFbGVtZW50KGN1clZpek9iaiwgbGF5b3V0LCB0cCwgZ3R5cGUsIHNIZWlnaHQsIHNIZWlnaHQgKyB3aWR0aCwgZWZmZWN0aXZlX2NwLCAicHJlc2VudCIpOwoJICAgICAgICAgICAgICAgICAgICBtaWRwb2ludCA9IChsYXlvdXRbdHBdW2d0eXBlXS5ib3R0b20gKyBsYXlvdXRbdHBdW2d0eXBlXS50b3ApLzI7CgoJICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgc3RhY2sgaGVpZ2h0CgkgICAgICAgICAgICAgICAgICAgIHNIZWlnaHQgKz0gZWZmZWN0aXZlX2NwOwoJICAgICAgICAgICAgICAgIH0KCgoJICAgICAgICAgICAgICAgIC8vIGlmIGl0IEVNRVJHRUQgYXQgdGhlIHByZXZpb3VzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBpZiAoY3BfZGF0YVtwcmV2X3RwXSAmJgoJICAgICAgICAgICAgICAgICAgICAoX2dldEludGVyc2VjdGlvbihnVHlwZUFuZERlc2NlbmRhbnRzLCBnVHlwZXNfcHJldlRQKS5sZW5ndGggPT09IDApICYmCgkgICAgICAgICAgICAgICAgICAgIChnVHlwZXNfY3VyVFAgJiYgX2dldEludGVyc2VjdGlvbihnVHlwZUFuZERlc2NlbmRhbnRzLCBnVHlwZXNfY3VyVFApLmxlbmd0aCA+IDApKSB7CgoJICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGUgaXRzIGVtZXJnZW5jZSB5LXZhbHVlCgkgICAgICAgICAgICAgICAgICAgIF9jcmVhdGVTdGFja0VsZW1lbnQoY3VyVml6T2JqLCBsYXlvdXQsIHByZXZfdHAsIGd0eXBlLCBtaWRwb2ludCwgbWlkcG9pbnQsIGVmZmVjdGl2ZV9jcCwgImVtZXJnZXMiKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0pCgkgICAgfSkKCgkgICAgcmV0dXJuIGxheW91dDsKCX0KCgkvKiBmdW5jdGlvbiB0byBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZXMgZm9yIGVhY2ggZ2Vub3R5cGUgaW4gYSAqc3BhY2VkKiBzdGFjaywgb25lIHN0YWNrIGZvciBlYWNoIHRpbWUgcG9pbnQKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRTcGFjZWRMYXlvdXQoY3VyVml6T2JqKSB7CgkgICAgdmFyIGxheW91dCA9IHt9LAoJICAgICAgICBjcF9kYXRhID0gY3VyVml6T2JqLmRhdGEuY3BfZGF0YSwKCSAgICAgICAgdGltZXBvaW50cyA9IGN1clZpek9iai5kYXRhLnRpbWVwb2ludHMsCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIGN1ckRlc2NlbmRhbnRzLAoJICAgICAgICBnVHlwZUFuZERlc2NlbmRhbnRzLCAvLyBnZW5vdHlwZSBhbmQgZGVzY2VuZGFudHMKCSAgICAgICAgY3VyQW5jZXN0b3JzLCAvLyBhbGwgYW5jZXN0b3JzIG9mIGN1cnJlbnQgZ2Vub3R5cGUKCSAgICAgICAgZ1R5cGVzX2N1clRQLCAvLyBnZW5vdHlwZXMgd2l0aCBjcCBkYXRhIGF0IHRoZSBDVVJSRU5UIHRpbWUgcG9pbnQKCSAgICAgICAgZ1R5cGVzX25leHRUUCwgLy8gZ2Vub3R5cGVzIHdpdGggY3AgZGF0YSBhdCB0aGUgTkVYVCB0aW1lIHBvaW50CgkgICAgICAgIHdpZHRoLCAvLyB0aGUgY3AgYXMgdGhlIHdpZHRoIHRvIGFkZCBmb3IgdGhpcyBnZW5vdHlwZSBhdCB0aGlzIHRpbWVwb2ludAoJICAgICAgICBtaWRwb2ludCwgLy8gbWlkcG9pbnQgZm9yIGVtZXJnZW5jZQoJICAgICAgICBhbmNlc3Rvcl9taWRwb2ludCwgLy8gYW5jZXN0b3IncyBtaWRwb2ludCBmb3IgZW1lcmdlbmNlCgkgICAgICAgIGRpcmVjdF9hbmNlc3RvcnMgPSBjdXJWaXpPYmouZGF0YS5kaXJlY3RfYW5jZXN0b3JzLCAvLyBkaXJlY3QgYW5jZXN0b3IgZm9yIGVhY2ggZ2Vub3R5cGUKCSAgICAgICAgZGlyZWN0X2Rlc2NlbmRhbnRzID0gY3VyVml6T2JqLmRhdGEuZGlyZWN0X2Rlc2NlbmRhbnRzLCAvLyBkaXJlY3QgZGVzY2VuZGFudCBmb3IgZWFjaCBnZW5vdHlwZQoJICAgICAgICBzcGFjZSA9IDgvY3VyVml6T2JqLmdlbmVyYWxDb25maWcudHNTVkdIZWlnaHQ7IC8vIHNwYWNlIGJldHdlZW4gZ2Vub3R5cGVzIChpbiBwaXhlbHMpIAoKCSAgICAvLyBHRVQgU1RBQ0tFRCBMQVlPVVQKCgkgICAgbGF5b3V0ID0gX2dldFN0YWNrZWRMYXlvdXQoY3VyVml6T2JqKTsKCgkgICAgLy8gU1BBQ0UgVEhFIFNUQUNLRUQgTEFZT1VUCgoJICAgIC8vIGZvciBlYWNoIHRpbWVwb2ludCAoaW4gb3JkZXIpLi4uCgkgICAgJC5lYWNoKHRpbWVwb2ludHMsIGZ1bmN0aW9uKHRwX2lkeCwgdHApIHsgCgoJICAgICAgICB2YXIgc2VlbkdUeXBlcyA9IFtdOwoJICAgICAgICBwcmV2X3RwID0gdGltZXBvaW50c1t0cF9pZHgtMV07CgoJICAgICAgICAvLyAuLi4gZm9yIGVhY2ggZ2Vub3R5cGUgLi4uCgkgICAgICAgICQuZWFjaChsYXlvdXRPcmRlciwgZnVuY3Rpb24oZ3R5cGVfaWR4LCBndHlwZSkgewoKCSAgICAgICAgICAgIC8vIGlmIHRoZSBnZW5vdHlwZSBoYXNuJ3QgYWxyZWFkeSBiZWVuIHNwYWNlZCwgYW5kIG5vciBpcyBpdCB0aGUgcm9vdAoJICAgICAgICAgICAgaWYgKHNlZW5HVHlwZXMuaW5kZXhPZihndHlwZSkgPT0gLTEpIHsKCgkgICAgICAgICAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3BfZGF0YVt0cF0pOwoJICAgICAgICAgICAgICAgIHZhciBjdXJfYW5jZXN0b3IgPSBkaXJlY3RfYW5jZXN0b3JzW2d0eXBlXSwKCSAgICAgICAgICAgICAgICAgICAgY3VyX2FuY2VzdG9yX2NwID0gY3BfZGF0YVt0cF1bY3VyX2FuY2VzdG9yXSB8fCAwLAoJICAgICAgICAgICAgICAgICAgICBjdXJfc2libGluZ3MgPSBkaXJlY3RfZGVzY2VuZGFudHNbY3VyX2FuY2VzdG9yXSwKCSAgICAgICAgICAgICAgICAgICAgcHJlc2VudF9zaWJsaW5ncyA9IF9nZXRJbnRlcnNlY3Rpb24oZGlyZWN0X2Rlc2NlbmRhbnRzW2N1cl9hbmNlc3Rvcl0sIGdUeXBlc19jdXJUUCksCgkgICAgICAgICAgICAgICAgICAgIGN1cl9zcGFjZSA9ICgocHJlc2VudF9zaWJsaW5ncy5sZW5ndGgrMSkgKiBzcGFjZSA8IGN1cl9hbmNlc3Rvcl9jcCkgPyAKCSAgICAgICAgICAgICAgICAgICAgICAgIHNwYWNlIDogCgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJfYW5jZXN0b3JfY3AvKHByZXNlbnRfc2libGluZ3MubGVuZ3RoKzEpOwoKCSAgICAgICAgICAgICAgICAvLyBzb3J0IGNoaWxkcmVuIGJ5IHJldmVyc2UgbGF5b3V0IG9yZGVyICh0b3AgdG8gYm90dG9tIChpbiB0ZXJtcyBvZiB5LXZhbHVlKSkKCSAgICAgICAgICAgICAgICB2YXIgc29ydGVkX3ByZXNlbnRfc2licyA9IHByZXNlbnRfc2libGluZ3Muc29ydChfc29ydEJ5TGF5b3V0T3JkZXIobGF5b3V0T3JkZXIpKS5yZXZlcnNlKCk7CgkgICAgICAgICAgICAgICAgdmFyIHNvcnRlZF9jdXJfc2licyA9IGN1cl9zaWJsaW5ncy5zb3J0KF9zb3J0QnlMYXlvdXRPcmRlcihsYXlvdXRPcmRlcikpLnJldmVyc2UoKTsKCgkgICAgICAgICAgICAgICAgaWYgKHNvcnRlZF9wcmVzZW50X3NpYnMubGVuZ3RoID4gMCkgewoKCSAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHRoZSBzdGFjayBoZWlnaHQgKGZyb20gdGhlIHRvcCkKCSAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhlcmUncyBhbiBhbmNlc3RvciAKCSAgICAgICAgICAgICAgICAgICAgaWYgKGxheW91dFt0cF1bY3VyX2FuY2VzdG9yXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgc0hlaWdodCA9IChsYXlvdXRbdHBdW2N1cl9hbmNlc3Rvcl0udG9wID09IGxheW91dFt0cF1bY3VyX2FuY2VzdG9yXS5ib3R0b20pID8KCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgYW5jZXN0b3IgaGFzIGJlZW4gcmVwbGFjZWQsIHNldCBzdGFjayB0b3AgYXMgdGhlIGZpcnN0IHNpYmxpbmcncyB0b3AgdmFsdWUKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW3NvcnRlZF9zaWJsaW5nc1swXV0udG9wIDogCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gb3RoZXJ3aXNlLCBzZXQgdGhlIHRvcCBhcyB0aGUgYW5jZXN0b3IncyB0b3AgdmFsdWUKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2N1cl9hbmNlc3Rvcl0udG9wOyAKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAvLyBubyBhbmNlc3RvcgoJICAgICAgICAgICAgICAgICAgICBlbHNlIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNIZWlnaHQgPSAxOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBmb3IgZWFjaCBzaWJsaW5nCgkgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc29ydGVkX2N1cl9zaWJzLmxlbmd0aDsgaSsrKSB7CgoJICAgICAgICAgICAgICAgICAgICAgICAgLy8gY3VycmVudCBzaWJsaW5nCgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgc2liID0gc29ydGVkX2N1cl9zaWJzW2ldOyAKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyB3aWR0aCBvZiBzaWJsaW5nCgkgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY3VyX3dpZHRoID0gKGxheW91dFt0cF1bc2liXSkgPyAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGUgc2libGluZyAob3IgaXRzIGRlc2NlbmRhbnRzKSBleGlzdCBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW3NpYl0udG9wIC0gbGF5b3V0W3RwXVtzaWJdLmJvdHRvbSA6CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2libGluZyBkb2Vzbid0IGV4aXN0IGF0IHRoaXMgdHAsIG5vciBkb2VzIGFueSBvZiBpdHMgZGVzY2VuZGFudHMKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAwOyAKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiBzaWJsaW5nIGV4aXN0cywgYWx0ZXIgaXRzIGxheW91dCBhdCB0aGlzIHRpbWVwb2ludAoJICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxheW91dFt0cF1bc2liXSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bc2liXS50b3AgPSBzSGVpZ2h0IC0gY3VyX3NwYWNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bc2liXS5ib3R0b20gPSBzSGVpZ2h0IC0gY3VyX3dpZHRoIC0gY3VyX3NwYWNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgc2libGluZyBlbWVyZ2VzIGF0IHRoZSBwcmV2aW91cyB0aW1lIHBvaW50LCB1cGRhdGUgaXRzIGVtZXJnZW5jZSB5LWNvb3JkaW5hdGUKCSAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjcF9kYXRhW3ByZXZfdHBdICYmIGxheW91dFtwcmV2X3RwXVtzaWJdICYmIGxheW91dFtwcmV2X3RwXVtzaWJdLnN0YXRlID09ICJlbWVyZ2VzIikgewoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pZHBvaW50ID0gKGxheW91dFt0cF1bc2liXS50b3AgKyBsYXlvdXRbdHBdW3NpYl0uYm90dG9tKS8yOwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFtwcmV2X3RwXVtzaWJdLnRvcCA9IG1pZHBvaW50OwoJICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxheW91dFtwcmV2X3RwXVtzaWJdLmJvdHRvbSA9IG1pZHBvaW50OwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgY3VycmVudCBzaWJsaW5nJ3Mgd2lkdGggdG8gdGhlIHN0YWNrIGhlaWdodAoJICAgICAgICAgICAgICAgICAgICAgICAgc0hlaWdodCAtPSAoY3VyX3dpZHRoICsgY3VyX3NwYWNlKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNlZW5HVHlwZXMucHVzaChzaWIpOwoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vdGUgdGhlIGFtb3VudCBvZiBzcGFjZSBzdWJ0cmFjdGVkIGZyb20gYW5jZXN0b3IncyBjZWxsdWxhciBwcmV2YWxlbmNlCgkgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaSA9PSAoc29ydGVkX3ByZXNlbnRfc2licy5sZW5ndGgtMSkgJiYgbGF5b3V0W3RwXVtjdXJfYW5jZXN0b3JdKSB7CgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtjdXJfYW5jZXN0b3JdLnNwYWNlID0gKGkrMSkqY3VyX3NwYWNlOwoJICAgICAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfQoJICAgICAgICB9KQoJICAgIH0pCgoJICAgIHJldHVybiBsYXlvdXQ7Cgl9CgoJLyogZnVuY3Rpb24gdG8gY3JlYXRlIGEgc3RhY2sgZWxlbWVudCAoYSBnZW5vdHlwZSBpbnRlcnZhbCBhdCBhIHBhcnRpY3VsYXIgdGltZSBwb2ludCkKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKiBAcGFyYW0ge09iamVjdH0gbGF5b3V0IC0tIGxheW91dCBvZiBlYWNoIGdlbm90eXBlIGF0IGVhY2ggdGltZSBwb2ludAoJKiBAcGFyYW0ge1N0cmluZ30gdHAgLS0gdGltZSBwb2ludCBvZiBpbnRlcmVzdAoJKiBAcGFyYW0ge1N0cmluZ30gZ3R5cGUgLS0gZ2Vub3R5cGUgb2YgaW50ZXJlc3QKCSogQHBhcmFtIHtOdW1iZXJ9IGJvdHRvbV92YWwgLS0gdmFsdWUgZm9yIHRoZSBib3R0b20gb2YgdGhlIGludGVydmFsCgkqIEBwYXJhbSB7TnVtYmVyfSB0b3BfdmFsIC0tIHZhbHVlIGZvciB0aGUgdG9wIG9mIHRoZSBpbnRlcnZhbAoJKiBAcGFyYW0ge051bWJlcn0gZWZmZWN0aXZlX2NwIC0tIHRoZSBjZWxsdWxhciBwcmV2YWxlbmNlIHZhbHVlIGZvciB2aXN1YWwgcGxvdHRpbmcgCgkqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGluY3JlYXNlZCBpZiBzbWFsbCwgZGVjcmVhc2VkIGlmIG90aGVycyBhcmUgc21hbGwpCgkqIEBwYXJhbSB7U3RyaW5nfSBzdGF0ZSAtLSBzdGF0ZSBvZiB0aGUgZ2Vub3R5cGUgYXQgdGhpcyB0aW1lIHBvaW50IChlLmcuICJlbWVyZ2VzIiwgInByZXNlbnQiLCAiZGlzYXBwZWFycyIpCgkqLwoJZnVuY3Rpb24gX2NyZWF0ZVN0YWNrRWxlbWVudChjdXJWaXpPYmosIGxheW91dCwgdHAsIGd0eXBlLCBib3R0b21fdmFsLCB0b3BfdmFsLCBlZmZlY3RpdmVfY3AsIHN0YXRlKSB7CgkgICAgLy8gY3JlYXRlIHRoZSB0aW1lIHBvaW50IGluIHRoZSBzdGFjayBpZiBpdCBkb2Vzbid0IGFscmVhZHkgZXhpc3QKCSAgICBsYXlvdXRbdHBdID0gbGF5b3V0W3RwXSB8fCB7fTsgCgoJICAgIC8vIGNyZWF0ZSB0aGUgZ2Vub3R5cGUgaW4gdGhlIHN0YWNrCgkgICAgbGF5b3V0W3RwXVtndHlwZV0gPSB7CgkgICAgICAgICJib3R0b20iOiBib3R0b21fdmFsLAoJICAgICAgICAidG9wIjogdG9wX3ZhbCwKCSAgICAgICAgInN0YXRlIjogc3RhdGUsCgkgICAgICAgICJjcCI6IGN1clZpek9iai5kYXRhLmNwX2RhdGFbdHBdW2d0eXBlXSwKCSAgICAgICAgImVmZmVjdGl2ZV9jcCI6IGVmZmVjdGl2ZV9jcAoJICAgIH07Cgl9CgoJLyogZnVuY3Rpb24gdG8gY2FsY3VsYXRlIGVmZmVjdGl2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIGFuZCB3aWR0aCBvZiBlYWNoIGdlbm90eXBlIGluIHRoZSB0aW1lc2NhcGUKCSoKCSogbm90ZTogLSBlZmZlY3RpdmUgY2VsbHVsYXIgcHJldmFsZW5jZSAtLSB3aWxsIGNvcnJlc3BvbmQgdG8gdGhlIGludGVydmFsIHdpZHRoIGluIHRoZSBzdGFja2VkIGxheW91dAoJKiAgICAgICAtICJlZmZlY3RpdmUiIGJlY2F1c2U6IAoJKiAgICAgICAgICAgICAgICAgICAgICAgICAtIGl0IGlzIGluY3JlYXNlZCBpZiBpdCdzIGJlbG93IHRoZSB0aHJlc2hvbGQKCSogICAgICAgICAgICAgICAgICAgICAgICAgLSBpdCBpcyByZWR1Y2VkIGlmIHNpYmxpbmdzIGFyZSBiZWxvdyB0aHJlc2hvbGQgYW5kIHRoZXJlZm9yZSBpbmNyZWFzZWQKCSogICAgICAgLSB3aWR0aCAtLSB0aGUgZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgUExVUyB0aGUgZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgZm9yIGl0cyBkZXNjZW5kYW50cwoJKgoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqIEBwYXJhbSB7U3RyaW5nfSB0cCAtLSB0aW1lIHBvaW50IG9mIGludGVyZXN0CgkqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSBnZW5vdHlwZSBvZiBpbnRlcmVzdAoJKiBAcGFyYW0ge051bWJlcn0gdGhyZXNob2xkIC0tIHRocmVzaG9sZCBjZWxsdWxhciBwcmV2YWxlbmNlIGZvciB2aXN1YWwgZGV0ZWN0aW9uCgkqLwoJZnVuY3Rpb24gX2NhbGN1bGF0ZVdpZHRoKGN1clZpek9iaiwgdHAsIGd0eXBlLCB0aHJlc2hvbGQpIHsKCSAgICB2YXIgd2lkdGgsIC8vIHdpZHRoIG9mIHRoaXMgZ2Vub3R5cGUgKGluY2x1ZGluZyBhbGwgZGVzY2VuZGFudHMpCgkgICAgICAgIGVmZmVjdGl2ZV9jcCwgLy8gZWZmZWN0aXZlIGNlbGx1bGFyIHByZXZhbGVuY2UgZm9yIHRoaXMgZ2Vub3R5cGUKCSAgICAgICAgY3AgPSBjdXJWaXpPYmouZGF0YS5jcF9kYXRhW3RwXSwgLy8gY2VsbHVsYXIgcHJldmFsZW5jZSBmb3IgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgIGdUeXBlc19jdXJUUCA9IE9iamVjdC5rZXlzKGNwKSwgLy8gZ2Vub3R5cGVzIGV4aXN0aW5nIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgY3VyX2RpcmVjdF9kZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLmRpcmVjdF9kZXNjZW5kYW50c1tndHlwZV0sIC8vIGN1cnJlbnQgZGlyZWN0IGRlc2NlbmRhbnRzIG9mIGdlbm90eXBlCgkgICAgICAgIHN1bV9pbmNyZW1lbnQgPSAwLCAvLyBzdW0gb2YgaW5jcmVtZW50IHRvIGxvdyBwcmV2YWxlbmNlIGdlbm90eXBlcyBmb3IgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgIG5fZ3R5cGVzX2hpZ2hfY3AgPSAwOyAvLyBudW1iZXIgb2YgZ2Vub3R5cGVzIGFib3ZlIHRocmVzaG9sZCBjcAoKCSAgICAvLyBmaW5kIG91dCBob3cgbWFueSBnZW5vdHlwZXMgYXJlIGJlbG93IHRocmVzaG9sZCBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICBmb3IgKHZhciBpID0gMDsgaSA8IGdUeXBlc19jdXJUUC5sZW5ndGg7IGkrKykgewoJICAgICAgICBpZiAoY3BbZ1R5cGVzX2N1clRQW2ldXSA8IHRocmVzaG9sZCkgewoJICAgICAgICAgICAgc3VtX2luY3JlbWVudCArPSAodGhyZXNob2xkIC0gY3BbZ1R5cGVzX2N1clRQW2ldXSk7CgkgICAgICAgIH0KCSAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICBuX2d0eXBlc19oaWdoX2NwKys7CgkgICAgICAgIH0gICAgICAgICAgICAgICAgCgkgICAgfQoKCSAgICAvLyAtLT4gR0VOT1RZUEUgRE9FU04nVCBFWElTVCBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICBpZiAoIWNwW2d0eXBlXSkgewoJICAgICAgICAvLyBlZmZlY3RpdmUgY2VsbHVsYXIgcHJldmFsZW5jZSBpcyAwCgkgICAgICAgIGVmZmVjdGl2ZV9jcCA9IDA7CgkgICAgfQoKCgkgICAgLy8gLS0+IExPVyBQUkVWQUxFTkNFIC0tIGlmIHRoaXMgZ2Vub3R5cGUgZXhpc3RzIGF0IGxvdyBwcmV2YWxlbmNlCgkgICAgZWxzZSBpZiAoY3BbZ3R5cGVdIDwgdGhyZXNob2xkKSB7CgkgICAgICAgIC8vIGVmZmVjdGl2ZSBjZWxsdWxhciBwcmV2YWxlbmNlIGlzIHRoZSB0aHJlc2hvbGQgdmFsdWUKCSAgICAgICAgZWZmZWN0aXZlX2NwID0gdGhyZXNob2xkOwoJICAgIH0KCgkgICAgLy8gLS0+IE5PUk1BTCBQUkVWQUxFTkNFCgkgICAgZWxzZSB7CgkgICAgICAgIC8vIGZvciBlYWNoIHByZXNlbnQgc2libGluZyB3aXRoIENQIGJlbG93IHRocmVzaG9sZCwgc3VidHJhY3QgdGhlIHNpYmxpbmcncyB3aWR0aCAoaW5jbHVkaW5nIGRlc2NlbmRhbnRzKSAKCSAgICAgICAgLy8gZnJvbSB0aGUgY3VycmVudCBnZW5vdHlwZSwgYmVjYXVzZSB0aGUgc2libGluZydzIHN3ZWVwIGludGVydmFsIHdpbGwgYmUgaW5jcmVhc2VkCgkgICAgICAgIGVmZmVjdGl2ZV9jcCA9IGNwW2d0eXBlXTsKCSAgICAgICAgLy8gc3VidHJhY3QgdGhlIHRvdGFsIGluY3JlbWVudCBmb3IgbG93IHByZXYgQ1BzLCBkaXZpZGVkIGJ5IHRoZSBudW1iZXIgb2YgaGlnaCBDUCBnZW5vdHlwZXMKCSAgICAgICAgZWZmZWN0aXZlX2NwIC09IChzdW1faW5jcmVtZW50KSAvIChuX2d0eXBlc19oaWdoX2NwKTsgCgkgICAgfQoJICAgIAoJICAgIC8vIGZvciBlYWNoIGRpcmVjdCBkZXNjZW5kYW50LCBhZGQgaXRzIGNlbGx1bGFyIHByZXZhbGVuY2UgCgkgICAgd2lkdGggPSBlZmZlY3RpdmVfY3A7CgkgICAgJC5lYWNoKGN1cl9kaXJlY3RfZGVzY2VuZGFudHMsIGZ1bmN0aW9uKGRlc2NfaWR4LCBkZXNjKSB7CgkgICAgICAgIHdpZHRoICs9IF9jYWxjdWxhdGVXaWR0aChjdXJWaXpPYmosIHRwLCBkZXNjLCB0aHJlc2hvbGQpLndpZHRoOwoJICAgIH0pCgkgICAgcmV0dXJuIHsid2lkdGgiOiB3aWR0aCwgImVmZmVjdGl2ZV9jcCI6IGVmZmVjdGl2ZV9jcH07CgoJfQoKCS8qIGZ1bmN0aW9uIHRvIHNvcnQgZ2Vub3R5cGVzIGJ5IGxheW91dCBvcmRlciAoYm90dG9tIHRvIHRvcCkKCSogQHBhcmFtIHtBcnJheX0gbGF5b3V0T3JkZXIgLS0gdmVydGljYWwgb3JkZXIgb2YgZ2Vub3R5cGVzIGZvciBsYXlvdXQgcHVycG9zZXMKCSovCglmdW5jdGlvbiBfc29ydEJ5TGF5b3V0T3JkZXIobGF5b3V0T3JkZXIpIHsKCSAgICByZXR1cm4gZnVuY3Rpb24gX3NvcnRpbmdGdW5jKGEsIGIpIHsKCSAgICAgICAgdmFyIHNvcnRpbmdBcnIgPSBsYXlvdXRPcmRlcjsKCSAgICAgICAgaWYgKHR5cGVvZiBhID09PSAnb2JqZWN0JykgewoJICAgICAgICAgICAgaWYgKHNvcnRpbmdBcnIuaW5kZXhPZihhLmlkKSA+IHNvcnRpbmdBcnIuaW5kZXhPZihiLmlkKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiAxOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIC0xOwoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgaWYgKHNvcnRpbmdBcnIuaW5kZXhPZihhKSA+IHNvcnRpbmdBcnIuaW5kZXhPZihiKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiAxOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgcmV0dXJuIC0xOwoJICAgICAgICB9CgkgICAgfQoJfQoKCgkvKiBmdW5jdGlvbiB0byBzaGlmdCB0aGUgZW1lcmdlbmNlIGluIHRoZSB4LWRpcmVjdGlvbiBpZiBtdWx0aXBsZSBnZW5vdHlwZXMgZnJvbSB0aGUgc2FtZSBsaW5lYWdlIGVtZXJnZSAKCSogYXQgdGhlIHNhbWUgdGltZXBvaW50CgkqIEBwYXJhbSB7T2JqZWN0fSBjdXJWaXpPYmoKCSovCglmdW5jdGlvbiBfc2hpZnRFbWVyZ2VuY2UoY3VyVml6T2JqKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLAoJICAgICAgICBsYXlvdXQgPSBjdXJWaXpPYmouZGF0YS5sYXlvdXQsCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIHRpbWVwb2ludHMgPSBjdXJWaXpPYmouZGF0YS50aW1lcG9pbnRzLAoJICAgICAgICB0cmVlQW5jZXN0b3JzQXJyID0gY3VyVml6T2JqLmRhdGEudHJlZUFuY2VzdG9yc0FyciwKCSAgICAgICAgdHJlZURlc2NlbmRhbnRzQXJyID0gY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyLAoJICAgICAgICBuUGFydGl0aW9ucywKCSAgICAgICAgbGF5b3V0T3JkZXJfcmV2LAoJICAgICAgICBhbmNlc3RvcnMsCgkgICAgICAgIGFuY2VzdG9yc19vZl9hbmNlc3RvciwKCSAgICAgICAgY3VyTlBhcnRpdGlvbnMsCgkgICAgICAgIGdlbm90eXBlc194c2hpZnRlZDsKCgkgICAgJC5lYWNoKHRpbWVwb2ludHMsIGZ1bmN0aW9uKHRwX2lkeCwgdHApIHsgCgoJICAgICAgICAvLyAtLT4gZ2V0IHRoZSBudW1iZXIgb2YgcGFydGl0aW9ucyBmb3IgdGhpcyB0aW1lIHBvaW50IDwtLSAvLwoKCSAgICAgICAgLy8gZm9yIGVhY2ggZ2Vub3R5cGUgKGJhY2t3YXJkcyBpbiBzdGFja2luZyBvcmRlciAtLSBkZXNjZW5kYW50IGJlZm9yZSBhbmNlc3RyYWwpCgkgICAgICAgIG5QYXJ0aXRpb25zID0gLTE7CgkgICAgICAgIGxheW91dE9yZGVyX3JldiA9ICgkLmV4dGVuZChbXSwgbGF5b3V0T3JkZXIpKS5yZXZlcnNlKCk7CgkgICAgICAgICQuZWFjaChsYXlvdXRPcmRlcl9yZXYsIGZ1bmN0aW9uKGd0eXBlX2lkeCwgZ3R5cGUpIHsKCgkgICAgICAgICAgICAvLyBpZiB0aGUgZ2Vub3R5cGUgaXMgZW1lcmdpbmcgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICBpZiAobGF5b3V0W3RwXVtndHlwZV0gJiYgKGxheW91dFt0cF1bZ3R5cGVdLnN0YXRlID09ICJlbWVyZ2VzIikpIHsKCSAgICAgICAgICAgICAgICAKCSAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIGFuY2VzdG9ycyB0aGF0IGFsc28gZW1lcmdlIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIGFuY2VzdG9ycyA9IF9maW5kRW1lcmdlbnRBbmNlc3RvcnMobGF5b3V0LCB0cmVlQW5jZXN0b3JzQXJyLCBndHlwZSwgdHApOwoJICAgICAgICAgICAgICAgIGN1ck5QYXJ0aXRpb25zID0gYW5jZXN0b3JzLmxlbmd0aCsyOwoKCSAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIHRoZSBsYXJnZXN0IG51bWJlciBvZiBhbmNlc3RvcnMgc28gZmFyLCB1cGRhdGUgdGhlIG51bWJlciBvZiBwYXJ0aXRpb25zCgkgICAgICAgICAgICAgICAgaWYgKGN1ck5QYXJ0aXRpb25zID4gblBhcnRpdGlvbnMpIHsKCSAgICAgICAgICAgICAgICAgICAgblBhcnRpdGlvbnMgPSBjdXJOUGFydGl0aW9uczsKCSAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgfQoKCSAgICAgICAgfSkKCgkgICAgICAgIC8vIC0tPiB4LXNoaWZ0IGdlbm90eXBlcyA8LS0gLy8KCgkgICAgICAgIC8vIGtlZXAgdHJhY2sgb2Ygd2hpY2ggZ2Vub3R5cGVzIGhhdmUgYmVlbiB4LXNoaWZ0ZWQKCSAgICAgICAgZ2Vub3R5cGVzX3hzaGlmdGVkID0gW107CgoJICAgICAgICAvLyBmb3IgZWFjaCBnZW5vdHlwZSAoYmFja3dhcmRzIGluIHN0YWNraW5nIG9yZGVyIC0tIGRlc2NlbmRhbnQgYmVmb3JlIGFuY2VzdHJhbCkKCSAgICAgICAgJC5lYWNoKGxheW91dE9yZGVyX3JldiwgZnVuY3Rpb24oZ3R5cGVfaWR4LCBndHlwZSkgewoKCSAgICAgICAgICAgIC8vIHNldCB0aGUgbnVtYmVyIG9mIHBhcnRpdGlvbnMKCSAgICAgICAgICAgIGlmIChsYXlvdXRbdHBdW2d0eXBlXSkgewoJICAgICAgICAgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdLm5QYXJ0aXRpb25zID0gblBhcnRpdGlvbnM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICAKCSAgICAgICAgICAgIC8vIGlmIHRoaXMgZ2Vub3R5cGUgaGFzIG5vdCBhbHJlYWR5IGJlZW4geC1zaGlmdGVkIGFuZCBlbWVyZ2VzIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgaWYgKChnZW5vdHlwZXNfeHNoaWZ0ZWQuaW5kZXhPZihndHlwZSkgPT0gLTEpICYmIGxheW91dFt0cF1bZ3R5cGVdICYmIAoJICAgICAgICAgICAgICAgIChsYXlvdXRbdHBdW2d0eXBlXS5zdGF0ZSA9PSAiZW1lcmdlcyIpKSB7CgoJICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgYW5jZXN0b3JzIHRoYXQgYWxzbyBlbWVyZ2UgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgYW5jZXN0b3JzID0gX2ZpbmRFbWVyZ2VudEFuY2VzdG9ycyhsYXlvdXQsIHRyZWVBbmNlc3RvcnNBcnIsIGd0eXBlLCB0cCk7CgoJICAgICAgICAgICAgICAgIC8vIHgtc2hpZnQgYW5kIHgtcGFydGl0aW9uIGZvciB0aGUgY3VycmVudCBnZW5vdHlwZSAoZGVwZW5kcyBvbiBob3cgbWFueSBvZiBpdHMgYW5jZXN0b3JzIGVtZXJnZSkKCSAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQgPSAoYW5jZXN0b3JzLmxlbmd0aCsxKSAvIG5QYXJ0aXRpb25zOwoJICAgICAgICAgICAgICAgIAoJICAgICAgICAgICAgICAgIGdlbm90eXBlc194c2hpZnRlZC5wdXNoKGd0eXBlKTsKCgkgICAgICAgICAgICAgICAgLy8gZm9yIGVhY2ggYW5jZXN0b3IgdGhhdCBhbHNvIGVtZXJnZWQgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbmNlc3RvcnMubGVuZ3RoOyBpKyspIHsKCgkgICAgICAgICAgICAgICAgICAgIC8vIGZpbmQgdGhlIGFuY2VzdG9yJ3MgYW5jZXN0b3JzIHRoYXQgYWxzbyBlbWVyZ2UgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgIGFuY2VzdG9yc19vZl9hbmNlc3RvciA9IF9maW5kRW1lcmdlbnRBbmNlc3RvcnMobGF5b3V0LCB0cmVlQW5jZXN0b3JzQXJyLCBhbmNlc3RvcnNbaV0sIHRwKTsKCSAgICAgICAgICAgICAgICAgICAgCgkgICAgICAgICAgICAgICAgICAgIC8vIHgtc2hpZnQgYW5kIHgtcGFydGl0aW9uIGZvciB0aGUgY3VycmVudCBhbmNlc3RvciAoZGVwZW5kcyBvbiBob3cgbWFueSBvZiBpdHMgYW5jZXN0b3JzIGVtZXJnZSkKCSAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVthbmNlc3RvcnNbaV1dLnhTaGlmdCA9IChhbmNlc3RvcnNfb2ZfYW5jZXN0b3IubGVuZ3RoKzEpIC8gblBhcnRpdGlvbnM7CgoJICAgICAgICAgICAgICAgICAgICBnZW5vdHlwZXNfeHNoaWZ0ZWQucHVzaChhbmNlc3RvcnNbaV0pOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0KCSAgICAgICAgfSkKCSAgICB9KQoJfQoKCS8vIExBQkVMUyBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBnZXQgY2VsbHVsYXIgcHJldmFsZW5jZSBsYWJlbHMgZm9yIGVhY2ggZ2Vub3R5cGUgYXQgZWFjaCB0aW1lIHBvaW50LCBmb3IgdHJhZGl0aW9uYWwgdGltZXNjYXBlIHZpZXcKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRUcmFkaXRpb25hbENQTGFiZWxzKGN1clZpek9iaikgewoJICAgIHZhciBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKCSAgICAgICAgbGF5b3V0ID0gY3VyVml6T2JqLmRhdGEubGF5b3V0LAoJICAgICAgICBsYWJlbHMgPSBbXSwgLy8gYXJyYXkgb2YgbGFiZWxzCgkgICAgICAgIGRhdGEsIC8vIGRhdGEgZm9yIGEgZ2Vub3R5cGUgYXQgYSB0aW1lIHBvaW50CgkgICAgICAgIGxhYmVsLCAvLyBjdXJyZW50IGxhYmVsIHRvIGFkZAoJICAgICAgICBjdXJEZXNjZW5kYW50cywKCSAgICAgICAgY3BfZGF0YV9vcmlnaW5hbCA9IGN1clZpek9iai5kYXRhLmNwX2RhdGFfb3JpZ2luYWwsCgkgICAgICAgIGdUeXBlc19jdXJUUDsgCgoJICAgIC8vIGZvciBlYWNoIHRpbWUgcG9pbnQKCSAgICBPYmplY3Qua2V5cyhsYXlvdXQpLmZvckVhY2goZnVuY3Rpb24odHAsIHRwX2lkeCkgewoJICAgICAgICBpZiAodHAgIT0gIlQwIikgewoKCSAgICAgICAgICAgIC8vIGZvciBlYWNoIGdlbm90eXBlCgkgICAgICAgICAgICBPYmplY3Qua2V5cyhsYXlvdXRbdHBdKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlLCBndHlwZV9pZHgpIHsKCSAgICAgICAgICAgICAgICBjdXJEZXNjZW5kYW50cyA9IGN1clZpek9iai5kYXRhLnRyZWVEZXNjZW5kYW50c0FycltndHlwZV07CgkgICAgICAgICAgICAgICAgZ1R5cGVzX2N1clRQID0gT2JqZWN0LmtleXMoY3VyVml6T2JqLmRhdGEuY3BfZGF0YVt0cF0pOyAKCgkgICAgICAgICAgICAgICAgLy8gZGF0YSBmb3IgdGhpcyBnZW5vdHlwZSBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBkYXRhID0gbGF5b3V0W3RwXVtndHlwZV07CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBnZW5vdHlwZSBleGlzdHMgYXQgdGhpcyB0aW1lIHBvaW50IChpc24ndCBlbWVyZ2luZyBvciBkaXNhcHBlYXJpbmcgLyByZXBsYWNlZCkKCSAgICAgICAgICAgICAgICBpZiAoKGRhdGEuc3RhdGUgPT0gInByZXNlbnQiKSkgewoKCSAgICAgICAgICAgICAgICAgICAgdmFyIG5EZXNjID0gX2dldEludGVyc2VjdGlvbihjdXJEZXNjZW5kYW50cywgZ1R5cGVzX2N1clRQKS5sZW5ndGg7CgoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgaXRzIGluZm9ybWF0aW9uIAoJICAgICAgICAgICAgICAgICAgICBsYWJlbCA9IHt9OwoKCSAgICAgICAgICAgICAgICAgICAgLy8gQ0VOVFJFRCB2aWV3CgkgICAgICAgICAgICAgICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5nZW5vdHlwZV9wb3NpdGlvbiA9PSAiY2VudHJlIikgeyAKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLnRwID0gdHA7CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5ndHlwZSA9IGd0eXBlOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuY3AgPSBjcF9kYXRhX29yaWdpbmFsW3RwXVtndHlwZV07CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5taWRkbGUgPSBkYXRhLnRvcCAtIChkYXRhLmNwLygyKihkYXRhLnByZXNlbnRDaGlsZHJlbisxKSkpOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwudHlwZSA9ICJ0cmFkaXRpb25hbCI7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAgICAgLy8gU1RBQ0tFRCB2aWV3CgkgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLmdlbm90eXBlX3Bvc2l0aW9uID09ICJzdGFjayIpIHsgCgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC50cCA9IHRwOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwuZ3R5cGUgPSBndHlwZTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmNwID0gY3BfZGF0YV9vcmlnaW5hbFt0cF1bZ3R5cGVdOwoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwubWlkZGxlID0gKDIqZGF0YS5ib3R0b20gKyBkYXRhLmVmZmVjdGl2ZV9jcCkvMjsgCgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC50eXBlID0gInRyYWRpdGlvbmFsIjsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAvLyBTUEFDRUQgdmlldwoJICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5nZW5vdHlwZV9wb3NpdGlvbiA9PSAic3BhY2UiKSB7IAoJICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWwudHAgPSB0cDsKCSAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsLmd0eXBlID0gZ3R5cGU7CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5jcCA9IGNwX2RhdGFfb3JpZ2luYWxbdHBdW2d0eXBlXTsKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgZ2Vub3R5cGUgd2FzIHNwbGl0IGZvciBzcGFjaW5nLCBob3cgbXVjaCBDUCBoYXMgYmVlbiB0YWtlbiB1cCBieSB0aGUgdXBwZXIgc3BsaXRzCgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC5taWRkbGUgPSAoZGF0YS5zcGFjZSkgPyAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAoMipkYXRhLmJvdHRvbSArIGRhdGEuZWZmZWN0aXZlX2NwIC0gZGF0YS5zcGFjZSkvMiA6IAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICgyKmRhdGEuYm90dG9tICsgZGF0YS5lZmZlY3RpdmVfY3ApLzI7CgkgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbC50eXBlID0gInRyYWRpdGlvbmFsIjsKCSAgICAgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgICAgICAgICAKCSAgICAgICAgICAgICAgICAgICAgbGFiZWxzLnB1c2gobGFiZWwpOwoKCSAgICAgICAgICAgICAgICB9ICAgCgkgICAgICAgICAgICAgICAgCgkgICAgICAgICAgICB9KQoJICAgICAgICB9CgkgICAgfSk7CgoJICAgIHJldHVybiBsYWJlbHM7Cgl9CgoJLyogZnVuY3Rpb24gdG8gZ2V0IGNlbGx1bGFyIHByZXZhbGVuY2UgbGFibGVzIGZvciBlYWNoIGdlbm90eXBlIGF0IGVhY2ggdGltZSBwb2ludCwgZm9yIHRyYWNrcyB0aW1lc2NhcGUgdmlldwoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldFNlcGFyYXRlQ1BMYWJlbHMoY3VyVml6T2JqKSB7CgkgICAgdmFyIHRyYWNrc19wYXRocyA9IGN1clZpek9iai5kYXRhLnRyYWNrc19wYXRocywKCSAgICAgICAgY3BfZGF0YV9vcmlnaW5hbCA9IGN1clZpek9iai5kYXRhLmNwX2RhdGFfb3JpZ2luYWwsCgkgICAgICAgIGxhYmVscyA9IFtdLAoJICAgICAgICBsYWJlbCwKCSAgICAgICAgZ3R5cGUsCgkgICAgICAgIG1pZHBvaW50LAoJICAgICAgICBwYXRoLAoJICAgICAgICB0cDsgLy8gdGltZSBwb2ludAoKCSAgICAvLyBmb3IgZWFjaCBnZW5vdHlwZQoJICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdHJhY2tzX3BhdGhzLmxlbmd0aDsgaSsrKSB7CgkgICAgICAgIGd0eXBlID0gdHJhY2tzX3BhdGhzW2ldLmd0eXBlOwoJICAgICAgICBtaWRwb2ludCA9IHRyYWNrc19wYXRoc1tpXS5taWRwb2ludDsKCSAgICAgICAgcGF0aCA9IHRyYWNrc19wYXRoc1tpXS5wYXRoOwoKCSAgICAgICAgLy8gZm9yIGVhY2ggcG9pbnQgaW4gdGhlIHBhdGgKCSAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwYXRoLmxlbmd0aDsgaisrKSB7CgkgICAgICAgICAgICB0cCA9IHBhdGhbal0udHA7CgoJICAgICAgICAgICAgaWYgKHRwICE9ICJUMCIpIHsKCgkgICAgICAgICAgICAgICAgLy8gaWYgdGhlIGdlbm90eXBlIGV4aXN0cyBhdCB0aGlzIHRpbWUgcG9pbnQgKGlzbid0IGVtZXJnaW5nIG9yIGRpc2FwcGVhcmluZyAvIHJlcGxhY2VkKQoJICAgICAgICAgICAgICAgIGlmIChjcF9kYXRhX29yaWdpbmFsW3RwXVtndHlwZV0pIHsKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwgPSB7fTsKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwudHAgPSB0cDsKCSAgICAgICAgICAgICAgICAgICAgbGFiZWwuY3AgPSBjcF9kYXRhX29yaWdpbmFsW3RwXVtndHlwZV07CgkgICAgICAgICAgICAgICAgICAgIGxhYmVsLm1pZGRsZSA9IG1pZHBvaW50OwoJICAgICAgICAgICAgICAgICAgICBsYWJlbC5ndHlwZSA9IGd0eXBlOwoJICAgICAgICAgICAgICAgICAgICBsYWJlbC50eXBlID0gInRyYWNrcyI7CgkgICAgICAgICAgICAgICAgICAgIGxhYmVscy5wdXNoKGxhYmVsKTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9CgkgICAgICAgIH0KCSAgICB9CgoJICAgIHJldHVybiBsYWJlbHM7Cgl9CgoJLy8gUEFUSCBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBnZXQgcGF0aHMgdG8gcGxvdC4gCgkqIEZpcnN0IGdldHMgcGF0aHMgKHNjYWxlIDAgdG8gMSkgd2l0aCBzdHJhaWdodCBlZGdlcy4KCSogVGhlbiBnZXRzIHBhdGhzIChzY2FsZSBvZiB0aGUgcGxvdCBwaXhlbCBjb3VudCkgd2l0aCBiZXppZXIgZWRnZXMKCSovCglmdW5jdGlvbiBfZ2V0UGF0aHMoY3VyVml6T2JqKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKCSAgICAvLyBHRVQgUFJPUE9SVElPTkFURSwgU1RSQUlHSFQgRURHRUQgUEFUSFMKCgkgICAgLy8gY29udmVydCBsYXlvdXQgYXQgZWFjaCB0aW1lIHBvaW50IGludG8gYSBsaXN0IG9mIG1vdmVzIGZvciBlYWNoIGdlbm90eXBlJ3MgZDMgcGF0aCBvYmplY3QKCSAgICBjdXJWaXpPYmouZGF0YS50cmFja3NfcGF0aHMgPSBfZ2V0U2VwYXJhdGVQYXRocyhjdXJWaXpPYmopOwoJICAgIGN1clZpek9iai5kYXRhLnRyYWRpdGlvbmFsX3BhdGhzID0gX2dldFRyYWRpdGlvbmFsUGF0aHMoY3VyVml6T2JqKTsKCgkgICAgLy8gR0VUIEJFWklFUiBQQVRIUyBSRUFEWSBGT1IgUExPVFRJTkcKCgkgICAgLy8gY29udmVydCBwcm9wb3J0aW9uYXRlIHBhdGhzIGludG8gcGF0aHMgcmVhZHkgZm9yIHBsb3R0aW5nLCB3aXRoIGJlemllciBjdXJ2ZXMKCSAgICBjdXJWaXpPYmouZGF0YS5iZXppZXJfcGF0aHMgPSBfZ2V0QmV6aWVyUGF0aHMoY3VyVml6T2JqLmRhdGEudHJhZGl0aW9uYWxfcGF0aHMsIGRpbS50c1NWR1dpZHRoLCBkaW0udHNTVkdIZWlnaHQpOwoJICAgIGN1clZpek9iai5kYXRhLnRyYWNrc19iZXppZXJfcGF0aHMgPSBfZ2V0QmV6aWVyUGF0aHMoY3VyVml6T2JqLmRhdGEudHJhY2tzX3BhdGhzLCBkaW0udHNTVkdXaWR0aCwgZGltLnRzU1ZHSGVpZ2h0KTsKCgl9CgoJLyogZnVuY3Rpb24gdG8gY29sb3VyIHBhdGhzCgkqLwoJZnVuY3Rpb24gX2NvbG91clBhdGhzKGN1clZpek9iaikgewoJCXZhciBwaGFudG9tUm9vdCA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnBoYW50b21Sb290LAoJCQljb2xvdXJfYXNzaWdubWVudCA9IGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50LAoJCQlhbHBoYV9jb2xvdXJfYXNzaWdubWVudCA9IGN1clZpek9iai52aWV3LmFscGhhX2NvbG91cl9hc3NpZ25tZW50OwoKCQljdXJWaXpPYmouZGF0YS5iZXppZXJfcGF0aHMuZm9yRWFjaChmdW5jdGlvbihjdXJfcGF0aCkgewoJCSAgICBjdXJfcGF0aC5maWxsID0gKGN1cl9wYXRoLmd0eXBlID09IHBoYW50b21Sb290KSA/ICJub25lIiA6IGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2N1cl9wYXRoLmd0eXBlXTsKCSAgICAgICAgY3VyX3BhdGguc3Ryb2tlID0gKGN1cl9wYXRoLmd0eXBlID09IHBoYW50b21Sb290KSA/ICJub25lIiA6IGNvbG91cl9hc3NpZ25tZW50W2N1cl9wYXRoLmd0eXBlXTsKCQl9KQoJCWN1clZpek9iai5kYXRhLnRyYWNrc19iZXppZXJfcGF0aHMuZm9yRWFjaChmdW5jdGlvbihjdXJfcGF0aCkgewoJCSAgICBjdXJfcGF0aC5maWxsID0gKGN1cl9wYXRoLmd0eXBlID09IHBoYW50b21Sb290KSA/ICJub25lIiA6IGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2N1cl9wYXRoLmd0eXBlXTsKCSAgICAgICAgY3VyX3BhdGguc3Ryb2tlID0gKGN1cl9wYXRoLmd0eXBlID09IHBoYW50b21Sb290KSA/ICJub25lIiA6IGNvbG91cl9hc3NpZ25tZW50W2N1cl9wYXRoLmd0eXBlXTsKCQl9KQoJfQoKCS8qIGZ1bmN0aW9uIHRvIGNvbnZlcnQgZ2Vub3R5cGUgc3RhY2tzIGF0IGVhY2ggdGltZSBwb2ludCBpbnRvIGEgbGlzdCBvZiBtb3ZlcyBmb3IgZWFjaCBnZW5vdHlwZSdzIGQzIHBhdGggb2JqZWN0IAoJKiAodHJhZGl0aW9uYWwgdGltZXNjYXBlIHZpZXcpCgkqIE5vdGU6IHRoZSBhcHBlYXJhbmNlIHRpbWVwb2ludCBpcyB0aGUgdGltZSBhdCB3aGljaCB0aGUgZ2Vub3R5cGUgYXBwZWFycyBpbiB0aGUgZGF0YXNldAoJKiAgICAgICB0aGUgZW1lcmdlbmNlIHRpbWVwb2ludCBpcyB0aGUgdGltZSBhdCB3aGljaCB0aGUgZ2Vub3R5cGUgbXVzdCBoYXZlIGVtZXJnZWQgKGFwcGVhcmFuY2UgdGltZXBvaW50IC0gMSkKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9nZXRUcmFkaXRpb25hbFBhdGhzKGN1clZpek9iaikgewoJICAgIHZhciBkaW0gPSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZywKCSAgICAgICAgbGF5b3V0ID0gY3VyVml6T2JqLmRhdGEubGF5b3V0LAoJICAgICAgICB0aW1lcG9pbnRzID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cywKCSAgICAgICAgdGltZXBvaW50c19yZXYgPSAoJC5leHRlbmQoW10sIHRpbWVwb2ludHMpKS5yZXZlcnNlKCksCgkgICAgICAgIG1pZF90cCA9ICgxLygodGltZXBvaW50cy5sZW5ndGgtMSkqMikpLCAvLyBoYWxmIG9mIHgtZGlzdGFuY2UgYmV0d2VlbiB0aW1lIHBvaW50cwoJICAgICAgICBsYXlvdXRPcmRlciA9IGN1clZpek9iai5kYXRhLmxheW91dE9yZGVyLAoJICAgICAgICBwYXRocyA9IFtdLAoJICAgICAgICBjdXJfcGF0aCwKCSAgICAgICAgZW1lcmdlcywgLy8gd2hldGhlciBvciBub3QgYSBnZW5vdHlwZSBlbWVyZ2VzIGF0IGEgdGltZSBwb2ludAoJICAgICAgICB4U2hpZnRfaW5fbGF5b3V0LCAvLyB0aGUgYW1vdW50IG9mIHNoaWZ0IGluIHRoZSB4LWRpcmVjdGlvbiBmb3IgYSBnZW5vdHlwZSAod2hlbiBpdCdzIGVtZXJnaW5nKSwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFzIGlzIHByZXNlbnQgaW4gdGhlIGxheW91dCBkYXRhCgkgICAgICAgIHhTaGlmdCwgLy8gdGhlIGFtb3VudCBvZiBzaGlmdCBpbiB0aGUgeC1kaXJlY3Rpb24gZm9yIGEgZ2Vub3R5cGUgKHdoZW4gaXQncyBlbWVyZ2luZyksIAoJICAgICAgICAgICAgICAgIC8vIHRha2luZyBpbnRvIGFjY291bnQgZXZlbnRzIHRoYXQgb2NjdXIKCSAgICAgICAgblBhcnRpdGlvbnMsIC8vIG51bWJlciBvZiBwYXJ0aXRpb25zIGJldHdlZW4gdHdvIHRpbWUgcG9pbnRzIAoJICAgICAgICBuZXh0X3RwLCAKCSAgICAgICAgeEJvdHRvbSwgLy8geC12YWx1ZSBhdCB0aGUgYm90dG9tIG9mIHRoZSBnZW5vdHlwZSBzd2VlcCBhdCBhIHRpbWUgcG9pbnQKCSAgICAgICAgeFRvcCwgLy8geC12YWx1ZSBhdCB0aGUgdG9wIG9mIHRoZSBnZW5vdHlwZSBzd2VlcCBhdCBhIHRpbWUgcG9pbnQKCSAgICAgICAgeV9taWQsIC8vIHkgcHJvcG9ydGlvbiBhcyBoYWxmd2F5IGJldHdlZW4gdGhpcyBhbmQgdGhlIG5leHQgdGltZSBwb2ludAoJICAgICAgICBhcHBlYXJfeEJvdHRvbSwKCSAgICAgICAgYXBwZWFyX3hUb3AsCgkgICAgICAgIGV2ZW50X29jY3VycywgLy8gd2hldGhlciBvciBub3QgYW4gZXZlbnQgb2NjdXJzIGFmdGVyIGEgdGltZSBwb2ludAoJICAgICAgICBldmVudF9pbmRleCwgLy8gaW5kZXggb2YgdGhlIGN1cnJlbnQgZXZlbnQgCgkgICAgICAgIHBlcnR1cmJhdGlvbnMgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5wZXJ0dXJiYXRpb25zLCAvLyB1c2VyIHNwZWNpZmllZCBwZXJ0dXJiYXRpb25zIGluIHRoZSB0aW1lLXNlcmllcyBkYXRhCgkgICAgICAgIGZyYWM7IC8vIGZyYWN0aW9uIG9mIHRvdGFsIHR1bW91ciBjb250ZW50IHJlbWFpbmluZyBhdCB0aGUgcGVydHVyYmF0aW9uIGV2ZW50OwoKCSAgICAkLmVhY2gobGF5b3V0T3JkZXIsIGZ1bmN0aW9uKGd0eXBlX2lkeCwgZ3R5cGUpIHsKCSAgICAgICAgCgkgICAgICAgIC8vIHBhdGggZm9yIHRoZSBjdXJyZW50IGdlbm90eXBlCgkgICAgICAgIGN1cl9wYXRoID0geyJndHlwZSI6IGd0eXBlLCAicGF0aCI6W119OwoJICAgICAgICAKCSAgICAgICAgLy8gZm9yIGVhY2ggdGltZSBwb2ludCAoaW4gc2VxdWVuY2UpLi4uCgkgICAgICAgICQuZWFjaCh0aW1lcG9pbnRzLCBmdW5jdGlvbihpZHgsIHRwKSB7CgkgICAgICAgICAgICAKCSAgICAgICAgICAgIC8vIHdoZXRoZXIgb3Igbm90IGFuIGV2ZW50IG9jY3VycyBhZnRlciB0aGlzIHRpbWVwb2ludAoJICAgICAgICAgICAgZXZlbnRfb2NjdXJzID0gKF9nZXRJbnRlcnNlY3Rpb24oXy5wbHVjayhwZXJ0dXJiYXRpb25zLCAicHJldl90cCIpLCB0cCkubGVuZ3RoID4gMCk7CgkgICAgICAgICAgICBldmVudF9pbmRleCA9IF8ucGx1Y2socGVydHVyYmF0aW9ucywgInByZXZfdHAiKS5pbmRleE9mKHRwKTsKCgkgICAgICAgICAgICAvLyBpZiB0aGUgZ2Vub3R5cGUgZXhpc3RzIG9yIGVtZXJnZXMvZGlzYXBwZWFycyBhdCB0aGlzIHRpbWUgcG9pbnQKCSAgICAgICAgICAgIGlmIChsYXlvdXRbdHBdW2d0eXBlXSkgewoJICAgICAgICAgICAgICAgIGVtZXJnZXMgPSAobGF5b3V0W3RwXVtndHlwZV0uc3RhdGUgPT0gImVtZXJnZXMiKTsKCSAgICAgICAgICAgICAgICBuUGFydGl0aW9ucyA9IChldmVudF9vY2N1cnMpID8KCSAgICAgICAgICAgICAgICAgICAgbGF5b3V0W3RwXVtndHlwZV0ublBhcnRpdGlvbnMqMiA6CgkgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdLm5QYXJ0aXRpb25zOwoJICAgICAgICAgICAgICAgIG5leHRfdHAgPSB0aW1lcG9pbnRzW2lkeCsxXTsKCSAgICAgICAgICAgICAgICB4U2hpZnRfaW5fbGF5b3V0ID0gKGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCkgPyBsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQgOiAwOwoJICAgICAgICAgICAgICAgIHhTaGlmdCA9IAoJICAgICAgICAgICAgICAgICAgICAoZXZlbnRfb2NjdXJzKSA/IAoJICAgICAgICAgICAgICAgICAgICAwLjUgKyAoeFNoaWZ0X2luX2xheW91dC8yKSA6IAoJICAgICAgICAgICAgICAgICAgICB4U2hpZnRfaW5fbGF5b3V0OwoKCSAgICAgICAgICAgICAgICAvLyBnZXQgdGhlIHgtY29vcmRpbmF0ZSBmb3IgdGhlIGJvdHRvbSBvZiB0aGlzIGdlbm90eXBlJ3MgaW50ZXJ2YWwgCgkgICAgICAgICAgICAgICAgeEJvdHRvbSA9IChlbWVyZ2VzKSA/IAoJICAgICAgICAgICAgICAgICAgICAoaWR4ICsgeFNoaWZ0KS8odGltZXBvaW50cy5sZW5ndGgtMSkgOiAKCSAgICAgICAgICAgICAgICAgICAgKGlkeCkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoKCSAgICAgICAgICAgICAgICAvLyBpZiB0aGUgY3VycmVudCBnZW5vdHlwZSBpcyAuLi4KCSAgICAgICAgICAgICAgICAvLyAuLi4gRU1FUkdJTkcgYXQgdGhpcyB0aW1lIHBvaW50Li4uIAoJICAgICAgICAgICAgICAgIGlmIChlbWVyZ2VzKSB7CgoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwYXRoIHBvaW50IGZvciB0aGUgYm90dG9tIG9mIHRoZSBnZW5vdHlwZSdzIGludGVydmFsIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4Qm90dG9tLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbdHBdW2d0eXBlXS5ib3R0b20sCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoKCSAgICAgICAgICAgICAgICAgICAgLy8gLi4uIGFkZCBhIHBhdGggcG9pbnQgdG8gZXhwYW5kIHRoZSBzd2VlcCBzdWNoIHRoYXQgaXRzIGRlc2NlbmRhbnRzIGNhbiBiZSBjb250YWluZWQgd2l0aGluIGl0CgkgICAgICAgICAgICAgICAgICAgIGFwcGVhcl94Qm90dG9tID0gKGlkeCArIHhTaGlmdCArICgxL25QYXJ0aXRpb25zKSkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoJICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IGFwcGVhcl94Qm90dG9tLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IGxheW91dFtuZXh0X3RwXVtndHlwZV0uYm90dG9tLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOyAvLyB5LWNvb3JkaW5hdGUgYXQgbmV4dCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgfSAgIAoKCSAgICAgICAgICAgICAgICAvLyAuLi4gTk9UIEVNRVJHSU5HIGF0IHRoaXMgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwYXRoIHBvaW50IGZvciB0aGUgYm90dG9tIG9mIHRoZSBnZW5vdHlwZSdzIGludGVydmFsIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4Qm90dG9tLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbdHBdW2d0eXBlXS5ib3R0b20sCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoKCSAgICAgICAgICAgICAgICAgICAgLy8gaWYgZXZlbnQgb2NjdXJzIGFmdGVyIHRoaXMgdGltZXBvaW50CgkgICAgICAgICAgICAgICAgICAgIGlmIChldmVudF9vY2N1cnMpIHsKCgkgICAgICAgICAgICAgICAgICAgICAgICBmcmFjID0gcGVydHVyYmF0aW9uc1tldmVudF9pbmRleF0uZnJhYzsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgeSBwcm9wb3J0aW9uIGFzIGhhbGZ3YXkgYmV0d2VlbiB0aGlzIGFuZCB0aGUgbmV4dCB0aW1lIHBvaW50CgkgICAgICAgICAgICAgICAgICAgICAgICB5X21pZCA9IChsYXlvdXRbbmV4dF90cF1bZ3R5cGVdLmJvdHRvbSArIGxheW91dFt0cF1bZ3R5cGVdLmJvdHRvbSkvMjsKCgkgICAgICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwb2ludCBpbiB0aGUgbWlkZGxlCgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IHhCb3R0b20gKyBtaWRfdHAsIC8vIGhhbGZ3YXkgYmV0d2VlbiB0aGlzIGFuZCBuZXh0IHRwCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6ICh5X21pZCpmcmFjKSArICgoMS1mcmFjKS8yKSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6ICJldmVudCIgfSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoZXJlIGFyZSBwYXJ0aXRpb25zIGFmdGVyIHRoaXMgdGltZXBvaW50LCBhZGQgYSBwYXRocG9pbnQgYXQgdGhlIGZpcnN0IHBhcnRpdGlvbgoJICAgICAgICAgICAgICAgICAgICBpZiAobmV4dF90cCAmJiBsYXlvdXRbbmV4dF90cF1bZ3R5cGVdICYmIGxheW91dFt0cF1bZ3R5cGVdLm5QYXJ0aXRpb25zID4gMSkgewoJICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5leHRfeEJvdHRvbSA9IChpZHggKyB4U2hpZnQgKyAoMS9uUGFydGl0aW9ucykpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogbmV4dF94Qm90dG9tLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbbmV4dF90cF1bZ3R5cGVdLmJvdHRvbSwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRwIjogdHAgfSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgICAgICAgICAgICAgIAoJICAgICAgICAgICAgfQoJICAgICAgICB9KQoKCSAgICAgICAgLy8gZm9yIGVhY2ggdGltZSBwb2ludCAoaW4gKnJldmVyc2UqIHNlcXVlbmNlKS4uLgoJICAgICAgICAkLmVhY2godGltZXBvaW50c19yZXYsIGZ1bmN0aW9uKGlkeCwgdHApIHsKCgkgICAgICAgICAgICAvLyB3aGV0aGVyIG9yIG5vdCBhbiBldmVudCBvY2N1cnMgYWZ0ZXIgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgICAgIGV2ZW50X29jY3VycyA9IChfZ2V0SW50ZXJzZWN0aW9uKF8ucGx1Y2socGVydHVyYmF0aW9ucywgInByZXZfdHAiKSwgdHApLmxlbmd0aCA+IDApOwoJICAgICAgICAgICAgZXZlbnRfaW5kZXggPSBfLnBsdWNrKHBlcnR1cmJhdGlvbnMsICJwcmV2X3RwIikuaW5kZXhPZih0cCk7CgoJICAgICAgICAgICAgLy8gaWYgdGhlIGdlbm90eXBlIGV4aXN0cyBvciBlbWVyZ2VzL2Rpc2FwcGVhcnMgYXQgdGhpcyB0aW1lIHBvaW50CgkgICAgICAgICAgICBpZiAobGF5b3V0W3RwXVtndHlwZV0pIHsKCSAgICAgICAgICAgICAgICBlbWVyZ2VzID0gKGxheW91dFt0cF1bZ3R5cGVdLnN0YXRlID09ICJlbWVyZ2VzIik7CgkgICAgICAgICAgICAgICAgblBhcnRpdGlvbnMgPSAoZXZlbnRfb2NjdXJzKSA/CgkgICAgICAgICAgICAgICAgICAgIGxheW91dFt0cF1bZ3R5cGVdLm5QYXJ0aXRpb25zKjIgOgoJICAgICAgICAgICAgICAgICAgICBsYXlvdXRbdHBdW2d0eXBlXS5uUGFydGl0aW9uczsKCSAgICAgICAgICAgICAgICBuZXh0X3RwID0gdGltZXBvaW50c19yZXZbaWR4LTFdOwoJICAgICAgICAgICAgICAgIHhTaGlmdF9pbl9sYXlvdXQgPSAobGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0KSA/IGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCA6IDA7CgkgICAgICAgICAgICAgICAgeFNoaWZ0ID0gCgkgICAgICAgICAgICAgICAgICAgIChldmVudF9vY2N1cnMpID8gCgkgICAgICAgICAgICAgICAgICAgIDAuNSArICh4U2hpZnRfaW5fbGF5b3V0LzIpIDogCgkgICAgICAgICAgICAgICAgICAgIHhTaGlmdF9pbl9sYXlvdXQ7CgoJICAgICAgICAgICAgICAgIC8vIGdldCB0aGUgeC1jb29yZGluYXRlIGZvciB0aGUgdG9wIG9mIHRoaXMgZ2Vub3R5cGUncyBpbnRlcnZhbCAKCSAgICAgICAgICAgICAgICB4VG9wID0gKGVtZXJnZXMpID8gCgkgICAgICAgICAgICAgICAgICAgICgodGltZXBvaW50cy5sZW5ndGgtMSkgLSBpZHggKyB4U2hpZnQpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKSA6IAoJICAgICAgICAgICAgICAgICAgICAoKHRpbWVwb2ludHMubGVuZ3RoLTEpIC0gaWR4KS8odGltZXBvaW50cy5sZW5ndGgtMSk7CgoJICAgICAgICAgICAgICAgIC8vIGlmIHRoZSBjdXJyZW50IGdlbm90eXBlIC4uLgoJICAgICAgICAgICAgICAgIC8vIC4uLiBFTUVSR0VTIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQuLi4KCSAgICAgICAgICAgICAgICBpZiAoZW1lcmdlcykgewoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwYXRoIHBvaW50IHRvIGJyaW5nIGZvcndhcmQgdGhlIHN3ZWVwIHN1Y2ggdGhhdCBpdHMgZGVzY2VuZGFudHMgY2FuIGJlIGNvbnRhaW5lZCB3L2luIGl0CgkgICAgICAgICAgICAgICAgICAgIGFwcGVhcl94VG9wID0gKCh0aW1lcG9pbnRzLmxlbmd0aC0xKSAtIGlkeCArIHhTaGlmdCArICgxL25QYXJ0aXRpb25zKSkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoJICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IGFwcGVhcl94VG9wLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IGxheW91dFtuZXh0X3RwXVtndHlwZV0udG9wLAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOyAvLyB5LWNvb3JkaW5hdGUgYXQgbmV4dCB0aW1lIHBvaW50CgoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgYSBwYXRoIHBvaW50IGZvciB0aGUgdG9wIG9mIHRoZSBnZW5vdHlwZSdzIGludGVydmFsIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4VG9wLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInkiOiBsYXlvdXRbdHBdW2d0eXBlXS50b3AsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoJICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgLy8gLi4uIERPRVNOJ1QgRU1FUkdFIGF0IHRoZSBjdXJyZW50IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICBlbHNlIHsKCgoJICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSBhcmUgcGFydGl0aW9ucyBhZnRlciB0aGlzIHRpbWVwb2ludCwgYWRkIGEgcGF0aHBvaW50IGF0IHRoZSBmaXJzdCBwYXJ0aXRpb24KCSAgICAgICAgICAgICAgICAgICAgaWYgKG5leHRfdHAgJiYgbGF5b3V0W25leHRfdHBdW2d0eXBlXSAmJiBsYXlvdXRbdHBdW2d0eXBlXS5uUGFydGl0aW9ucyA+IDEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXh0X3hUb3AgPSAoKHRpbWVwb2ludHMubGVuZ3RoLTEpIC0gaWR4ICsgeFNoaWZ0ICsgKDEvblBhcnRpdGlvbnMpKS8odGltZXBvaW50cy5sZW5ndGgtMSk7CgkgICAgICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IG5leHRfeFRvcCwgCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogbGF5b3V0W25leHRfdHBdW2d0eXBlXS50b3AsCgkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6IHRwIH0pOwoJICAgICAgICAgICAgICAgICAgICB9CgoJICAgICAgICAgICAgICAgICAgICAvLyBpZiBldmVudCBvY2N1cnMgYWZ0ZXIgdGhpcyB0aW1lcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50X29jY3VycykgewoKCSAgICAgICAgICAgICAgICAgICAgICAgIGZyYWMgPSBwZXJ0dXJiYXRpb25zW2V2ZW50X2luZGV4XS5mcmFjOwoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCB5IHByb3BvcnRpb24gYXMgaGFsZndheSBiZXR3ZWVuIHRoaXMgYW5kIHRoZSBuZXh0IHRpbWUgcG9pbnQKCSAgICAgICAgICAgICAgICAgICAgICAgIHlfbWlkID0gKGxheW91dFtuZXh0X3RwXVtndHlwZV0udG9wICsgbGF5b3V0W3RwXVtndHlwZV0udG9wKS8yOwoKCSAgICAgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBhIHBvaW50IGluIHRoZSBtaWRkbGUKCSAgICAgICAgICAgICAgICAgICAgICAgIGN1cl9wYXRoLnBhdGgucHVzaCh7ICJ4IjogeFRvcCArIG1pZF90cCwgLy8gaGFsZndheSBiZXR3ZWVuIHRoaXMgYW5kIG5leHQgdHAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ5IjogKHlfbWlkKmZyYWMpICsgKCgxLWZyYWMpLzIpLCAKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ0cCI6ICJldmVudCIgfSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIC8vIGFkZCBhIHBhdGggcG9pbnQgZm9yIHRoZSB0b3Agb2YgdGhlIGdlbm90eXBlJ3MgaW50ZXJ2YWwgYXQgdGhlIGN1cnJlbnQgdGltZSBwb2ludAoJICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IHhUb3AsIAoJICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAieSI6IGxheW91dFt0cF1bZ3R5cGVdLnRvcCwKCSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInRwIjogdHAgfSk7CgkgICAgICAgICAgICAgICAgfSAgIAoJICAgICAgICAgICAgfQoJICAgICAgICB9KQoJICAgICAgICAKCSAgICAgICAgLy8gYWRkIHRoZSBwYXRoIGZvciB0aGlzIGdlbm90eXBlIHRvIHRoZSBsaXN0IG9mIGFsbCBwYXRocyB0byBwbG90CgkgICAgICAgIHBhdGhzLnB1c2goY3VyX3BhdGgpOwoJICAgIH0pCgoJICAgIHJldHVybiBwYXRoczsKCX0KCgkvKiBmdW5jdGlvbiB0byBjb252ZXJ0IGdlbm90eXBlIHN0YWNrcyBhdCBlYWNoIHRpbWUgcG9pbnQgaW50byBhIGxpc3Qgb2YgbW92ZXMgZm9yIGVhY2ggZ2Vub3R5cGUncyBkMyBwYXRoIG9iamVjdCAKCSogKHRyYWNrcyB0aW1lc2NhcGUgdmlldykKCSogTm90ZTogdGhlIGFwcGVhcmFuY2UgdGltZXBvaW50IGlzIHRoZSB0aW1lIGF0IHdoaWNoIHRoZSBnZW5vdHlwZSBhcHBlYXJzIGluIHRoZSBkYXRhc2V0CgkqICAgICAgIHRoZSBlbWVyZ2VuY2UgdGltZXBvaW50IGlzIHRoZSB0aW1lIGF0IHdoaWNoIHRoZSBnZW5vdHlwZSBtdXN0IGhhdmUgZW1lcmdlZCAoYXBwZWFyYW5jZSB0aW1lcG9pbnQgLSAxKQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqCgkqLwoJZnVuY3Rpb24gX2dldFNlcGFyYXRlUGF0aHMoY3VyVml6T2JqKSB7CgkgICAgdmFyIGRpbSA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLAoJICAgICAgICB0aW1lcG9pbnRzID0gY3VyVml6T2JqLmRhdGEudGltZXBvaW50cywKCSAgICAgICAgdGltZXBvaW50c19yZXYgPSAoJC5leHRlbmQoW10sIHRpbWVwb2ludHMpKS5yZXZlcnNlKCksCgkgICAgICAgIGxheW91dE9yZGVyID0gY3VyVml6T2JqLmRhdGEubGF5b3V0T3JkZXIsCgkgICAgICAgIGdlbm90eXBlX2NwID0gY3VyVml6T2JqLmRhdGEuZ2Vub3R5cGVfY3AsCgkgICAgICAgIGxheW91dCA9IGN1clZpek9iai5kYXRhLmxheW91dCwKCSAgICAgICAgcGFkZGluZyA9IDAuMDMsCgkgICAgICAgIHRzX3NlcF9sYWJlbHMgPSBjdXJWaXpPYmouZGF0YS50c19zZXBfbGFiZWxzLAoJICAgICAgICBwYXRocyA9IFtdLAoJICAgICAgICBzSGVpZ2h0ID0gMCwKCSAgICAgICAgc2VlbkdUeXBlcyA9IFtdLAoJICAgICAgICBsYXJnZXN0X2NwcyA9IHt9LAoJICAgICAgICBzY2FsZWRfbWlkcG9pbnQsCgkgICAgICAgIGVudHJ5X2V4aXRfb3B0aW9ucywKCSAgICAgICAgZW50cnlfZXhpdCwKCSAgICAgICAgeFNoaWZ0LAoJICAgICAgICB4LAoJICAgICAgICB5LAoJICAgICAgICBjdXJfcGF0aCwKCSAgICAgICAgZnVsbF9wYWRkaW5nLAoJICAgICAgICBkZW5vbWluYXRvcjsKCgkgICAgLy8gZmluZCB0aGUgZGVub21pbmF0b3IgKHRvdGFsIGhlaWdodCBvZiB0aGUgdmlldyksIGluIHRlcm1zIG9mIHRoZSBzd2VlcHMgKHN1bSBvZiBsYXJnZXN0IGNwIGZvciBlYWNoIGdlbm90eXBlKQoJICAgIE9iamVjdC5rZXlzKGdlbm90eXBlX2NwKS5mb3JFYWNoKGZ1bmN0aW9uKGd0eXBlLCBndHlwZV9pZHgpIHsKCSAgICAgICAgdmFyIGNwcyA9IE9iamVjdC5rZXlzKGdlbm90eXBlX2NwW2d0eXBlXSkubWFwKGZ1bmN0aW9uIChrZXkpIHsgcmV0dXJuIGdlbm90eXBlX2NwW2d0eXBlXVtrZXldOyB9KTsKCSAgICAgICAgbGFyZ2VzdF9jcHNbZ3R5cGVdID0gTWF0aC5tYXgoLi4uY3BzKTsKCSAgICB9KQoJICAgIGRlbm9taW5hdG9yID0gT2JqZWN0LmtleXMobGFyZ2VzdF9jcHMpLm1hcChmdW5jdGlvbiAoa2V5KSB7IHJldHVybiBsYXJnZXN0X2Nwc1trZXldOyB9KS5yZWR1Y2UoZnVuY3Rpb24oYSwgYikgewoJICAgICAgICByZXR1cm4gYSArIGI7CgkgICAgfSk7IAoJICAgIGZ1bGxfcGFkZGluZyA9IHBhZGRpbmcgKiAoT2JqZWN0LmtleXMobGFyZ2VzdF9jcHMpLmxlbmd0aCsxKTsgLy8gcGFkZGluZyBiZXR3ZWVuIGVhY2ggZ2Vub3R5cGUgKCsgYWJvdmUgJiBiZWxvdykKCSAgICBkZW5vbWluYXRvciArPSBmdWxsX3BhZGRpbmc7CgoJICAgIC8vIGZvciBlYWNoIGdlbm90eXBlLCBnZXQgaXRzIHBhdGggdGhyb3VnaCB0aGUgdGltZSBwb2ludHMKCSAgICAkLmVhY2gobGF5b3V0T3JkZXIsIGZ1bmN0aW9uKGd0eXBlX2lkeCwgZ3R5cGUpIHsKCgkgICAgICAgIGlmIChPYmplY3Qua2V5cyhsYXJnZXN0X2NwcykuaW5kZXhPZihndHlwZSkgIT0gLTEpIHsKCgkgICAgICAgICAgICAvLyBzY2FsZWQgbWlkcG9pbnQgZm9yIHRoaXMgZ2Vub3R5cGUncyB0aW1lc2NhcGUgYmFuZAoJICAgICAgICAgICAgc2NhbGVkX21pZHBvaW50ID0gKGxhcmdlc3RfY3BzW2d0eXBlXSAvIGRlbm9taW5hdG9yKS8yICsgc0hlaWdodDsKCSAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludCArPSAoKHNlZW5HVHlwZXMubGVuZ3RoKS8oT2JqZWN0LmtleXMobGFyZ2VzdF9jcHMpLmxlbmd0aCsxKSkgKiBmdWxsX3BhZGRpbmcvZGVub21pbmF0b3I7CgoJICAgICAgICAgICAgLy8gcGF0aCBmb3IgdGhlIGN1cnJlbnQgZ2Vub3R5cGUKCSAgICAgICAgICAgIGN1cl9wYXRoID0geyJndHlwZSI6IGd0eXBlLCAibWlkcG9pbnQiOiBzY2FsZWRfbWlkcG9pbnQsICJwYXRoIjpbXX07CgkgICAgICAgICAgICAKCSAgICAgICAgICAgIC8vIEJPVFRPTSBDT09SRElOQVRFIGZvciBlYWNoIHRpbWUgcG9pbnQgCgkgICAgICAgICAgICAkLmVhY2godGltZXBvaW50cywgZnVuY3Rpb24odHBfaWR4LCB0cCkgewoKCSAgICAgICAgICAgICAgICAvLyB4U2hpZnQgaW5mbwoJICAgICAgICAgICAgICAgIGVudHJ5X2V4aXRfb3B0aW9ucyA9IFsiZGlzYXBwZWFyc19zdHJldGNoZWQiLCAiZW1lcmdlcyIsICJyZXBsYWNlZCJdOwoJICAgICAgICAgICAgICAgIGVudHJ5X2V4aXQgPSAobGF5b3V0W3RwXVtndHlwZV0pID8gCgkgICAgICAgICAgICAgICAgICAgIChlbnRyeV9leGl0X29wdGlvbnMuaW5kZXhPZihsYXlvdXRbdHBdW2d0eXBlXS5zdGF0ZSkgIT0gLTEpIDogCgkgICAgICAgICAgICAgICAgICAgIGZhbHNlOwoJICAgICAgICAgICAgICAgIHhTaGlmdCA9IChsYXlvdXRbdHBdW2d0eXBlXSAmJiBsYXlvdXRbdHBdW2d0eXBlXS54U2hpZnQpID8gbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0IDogMDsKCgkgICAgICAgICAgICAgICAgaWYgKGVudHJ5X2V4aXQgfHwgZ2Vub3R5cGVfY3BbZ3R5cGVdW3RwXSkgewoJICAgICAgICAgICAgICAgICAgICAvLyBhZGQgdGhpcyBnZW5vdHlwZSB0byB0aGUgc2VlbiBnZW5vdHlwZXMKCSAgICAgICAgICAgICAgICAgICAgaWYgKHNlZW5HVHlwZXMuaW5kZXhPZihndHlwZSkgPT0gLTEpIHsKCSAgICAgICAgICAgICAgICAgICAgICAgIHNlZW5HVHlwZXMucHVzaChndHlwZSk7CgkgICAgICAgICAgICAgICAgICAgIH0KCgkgICAgICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgcGF0aCBwb2ludAoJICAgICAgICAgICAgICAgICAgICB4ID0gKHRwX2lkeCArIHhTaGlmdCkvKHRpbWVwb2ludHMubGVuZ3RoLTEpOwoJICAgICAgICAgICAgICAgICAgICB5ID0gZ2Vub3R5cGVfY3BbZ3R5cGVdW3RwXSA/IAoJICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVkX21pZHBvaW50IC0gKGdlbm90eXBlX2NwW2d0eXBlXVt0cF0gLyBkZW5vbWluYXRvcikvMiA6IAoJICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGVkX21pZHBvaW50OwoJICAgICAgICAgICAgICAgICAgICBjdXJfcGF0aC5wYXRoLnB1c2goeyAieCI6IHgsICJ5IjogeSwgInRwIjogdHAsICJjcCI6IGdlbm90eXBlX2NwW2d0eXBlXVt0cF19KTsKCSAgICAgICAgICAgICAgICB9CgkgICAgICAgICAgICB9KTsKCgkgICAgICAgICAgICAvLyBUT1AgQ09PUkRJTkFURSBmb3IgZWFjaCB0aW1lIHBvaW50IChpbiAqcmV2ZXJzZSogc2VxdWVuY2UpLi4uCgkgICAgICAgICAgICAkLmVhY2godGltZXBvaW50c19yZXYsIGZ1bmN0aW9uKHRwX2lkeCwgdHApIHsKCgkgICAgICAgICAgICAgICAgLy8geFNoaWZ0IGluZm8KCSAgICAgICAgICAgICAgICBlbnRyeV9leGl0X29wdGlvbnMgPSBbImRpc2FwcGVhcnNfc3RyZXRjaGVkIiwgImVtZXJnZXMiLCAicmVwbGFjZWQiXTsKCSAgICAgICAgICAgICAgICBlbnRyeV9leGl0ID0gKGxheW91dFt0cF1bZ3R5cGVdKSA/IAoJICAgICAgICAgICAgICAgICAgICAoZW50cnlfZXhpdF9vcHRpb25zLmluZGV4T2YobGF5b3V0W3RwXVtndHlwZV0uc3RhdGUpICE9IC0xKSA6IAoJICAgICAgICAgICAgICAgICAgICBmYWxzZTsKCSAgICAgICAgICAgICAgICB4U2hpZnQgPSAobGF5b3V0W3RwXVtndHlwZV0gJiYgbGF5b3V0W3RwXVtndHlwZV0ueFNoaWZ0KSA/IGxheW91dFt0cF1bZ3R5cGVdLnhTaGlmdCA6IDA7CgoJICAgICAgICAgICAgICAgIC8vIGFkZCB0aGUgcGF0aCBwb2ludAoJICAgICAgICAgICAgICAgIGlmIChlbnRyeV9leGl0IHx8IGdlbm90eXBlX2NwW2d0eXBlXVt0cF0pIHsKCSAgICAgICAgICAgICAgICAgICAgeCA9ICgodGltZXBvaW50cy5sZW5ndGgtMSkgLSB0cF9pZHggKyB4U2hpZnQpLyh0aW1lcG9pbnRzLmxlbmd0aC0xKTsKCSAgICAgICAgICAgICAgICAgICAgeSA9IGdlbm90eXBlX2NwW2d0eXBlXVt0cF0gPyAKCSAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludCArIChnZW5vdHlwZV9jcFtndHlwZV1bdHBdIC8gZGVub21pbmF0b3IpLzIgOiAKCSAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlZF9taWRwb2ludDsKCSAgICAgICAgICAgICAgICAgICAgY3VyX3BhdGgucGF0aC5wdXNoKHsgIngiOiB4LCAieSI6IHksICJ0cCI6IHRwLCAiY3AiOiBnZW5vdHlwZV9jcFtndHlwZV1bdHBdfSk7CgkgICAgICAgICAgICAgICAgfQoJICAgICAgICAgICAgfSk7CgkgICAgICAgICAgICAKCSAgICAgICAgICAgIC8vIGFkZCB0aGUgcGF0aCBmb3IgdGhpcyBnZW5vdHlwZSB0byB0aGUgbGlzdCBvZiBhbGwgcGF0aHMgdG8gcGxvdAoJICAgICAgICAgICAgcGF0aHMucHVzaChjdXJfcGF0aCk7CgoJICAgICAgICAgICAgLy8gdXBkYXRlIHRoZSBzdGFjayBoZWlnaHQKCSAgICAgICAgICAgIHNIZWlnaHQgKz0gbGFyZ2VzdF9jcHNbZ3R5cGVdL2Rlbm9taW5hdG9yOwoJICAgICAgICB9CgkgICAgfSkKCgkgICAgcmV0dXJuIHBhdGhzOwoJfQoKCgkvKiBmdW5jdGlvbiB0byBjYWxjdWxhdGUgYW5kIHJldHVybiBhIHBhdGggcmVwcmVzZW50aW5nIGEgaG9yaXpvbnRhbCBsaW5lIHRocm91Z2ggdGhlIGNlbnRyZSBvZiB0aGUgdGltZXNjYXBlIHN2ZyAKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKi8KCWZ1bmN0aW9uIF9jZW50cmVMaW5lKGN1clZpek9iaikgewoJICAgIHZhciB0c1NWR1dpZHRoID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcudHNTVkdXaWR0aCwgLy8gdGltZXNjYXBlIHN2ZyB3aWR0aAoJICAgICAgICB0c1NWR0hlaWdodCA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnLnRzU1ZHSGVpZ2h0OyAvLyB0aW1lc2NhcGUgc3ZnIGhlaWdodAoKCSAgICByZXR1cm4gIk0gMCAiICsgdHNTVkdIZWlnaHQvMiArICIgTCAiICsgdHNTVkdXaWR0aCArICIgIiArIHRzU1ZHSGVpZ2h0LzIgKyAiIEwgMCAiICsgdHNTVkdIZWlnaHQvMjsKCX0KCgkvKiB0d2VlbiBmdW5jdGlvbiB0byB0cmFuc2l0aW9uIHRvIHRoZSBuZXh0IHBhdGggKCJwYXRoIiBpbiB0aGUgZGF0YSkKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iagoJKiBAcGFyYW0ge1N0cmluZ30gdHlwZSAtIHRoZSB0eXBlIG9mIHRyYW5zaXRpb24gKCJtb3ZlIiBvciBvdGhlcndpc2UgLSBpZiBvdGhlcndpc2UsIHdpbGwgbW92ZSB0byBjZW50cmUgbGluZSkKCSogTm90ZTogc2l0dWF0aW9ucyBvdGhlciB0aGFuICJtb3ZlIiAtIGNvdWxkIGJlIGFuIGV4aXQgc2l0dWF0aW9uLCB3aGVyZSB0aGUgbmV4dCBwYXRoIGlzIGJsYW5rCgkqLwoJZnVuY3Rpb24gX3BhdGhUd2VlbihjdXJWaXpPYmosIHR5cGUpIHsgCgkgICAgCgkgICAgdmFyIHByZWNpc2lvbiA9IDQ7CgoJICAgIHJldHVybiBmdW5jdGlvbigpIHsKCSAgICAgICAgdmFyIGRlc3RfcGF0aCwKCSAgICAgICAgICAgIHBhdGgwLAoJICAgICAgICAgICAgcGF0aDEsCgkgICAgICAgICAgICBuMCwgCgkgICAgICAgICAgICBuMSwKCSAgICAgICAgICAgIGRpc3RhbmNlcywKCSAgICAgICAgICAgIHBvaW50cywKCSAgICAgICAgICAgIHAwLAoJICAgICAgICAgICAgcDE7CgoJICAgICAgICAvLyBmb3IgYW4gZXhpdCBzaXR1YXRpb24sIHRoZSBwYXRoIHRvIG1vdmUgdG8gaXMgYSBsaW5lIGluIHRoZSBjZW50cmUgb2YgdGhlIHRpbWVzY2FwZSBzdmcKCSAgICAgICAgZGVzdF9wYXRoID0gKHR5cGUgPT0gIm1vdmUiKSA/IHRoaXMuX19kYXRhX18ucGF0aCA6IF9jZW50cmVMaW5lKGN1clZpek9iaik7IAoJICAgICAgICBwYXRoMCA9IHRoaXM7CgkgICAgICAgIHBhdGgxID0gcGF0aDAuY2xvbmVOb2RlKCk7CgkgICAgICAgIG4wID0gcGF0aDAuZ2V0VG90YWxMZW5ndGgoKTsKCSAgICAgICAgbjEgPSAocGF0aDEuc2V0QXR0cmlidXRlKCJkIiwgZGVzdF9wYXRoKSwgcGF0aDEpLmdldFRvdGFsTGVuZ3RoKCk7CgoJICAgICAgICAvLyBVbmlmb3JtIHNhbXBsaW5nIG9mIGRpc3RhbmNlIGJhc2VkIG9uIHNwZWNpZmllZCBwcmVjaXNpb24uCgkgICAgICAgIGRpc3RhbmNlcyA9IFswXSwgaSA9IDAsIGR0ID0gcHJlY2lzaW9uIC8gTWF0aC5tYXgobjAsIG4xKTsKCSAgICAgICAgd2hpbGUgKChpICs9IGR0KSA8IDEpIGRpc3RhbmNlcy5wdXNoKGkpOwoJICAgICAgICBkaXN0YW5jZXMucHVzaCgxKTsKCSAgICAgICAgLy8gQ29tcHV0ZSBwb2ludC1pbnRlcnBvbGF0b3JzIGF0IGVhY2ggZGlzdGFuY2UuCgkgICAgICAgIHBvaW50cyA9IGRpc3RhbmNlcy5tYXAoZnVuY3Rpb24odCkgewoJICAgICAgICAgICAgcDAgPSBwYXRoMC5nZXRQb2ludEF0TGVuZ3RoKHQgKiBuMCk7CgkgICAgICAgICAgICBwMSA9IHBhdGgxLmdldFBvaW50QXRMZW5ndGgodCAqIG4xKTsKCSAgICAgICAgICAgIHJldHVybiBkMy5pbnRlcnBvbGF0ZShbcDAueCwgcDAueV0sIFtwMS54LCBwMS55XSk7CgkgICAgICAgIH0pOwoJICAgICAgICByZXR1cm4gZnVuY3Rpb24odCkgewoJICAgICAgICAgICAgcmV0dXJuIHQgPCAxID8gIk0iICsgcG9pbnRzLm1hcChmdW5jdGlvbihwKSB7IHJldHVybiBwKHQpOyB9KS5qb2luKCJMIikgOiBkZXN0X3BhdGg7CgkgICAgICAgIH07CgkgICAgfTsKCX0KCgkvKiBmdW5jdGlvbiB0byBjb252ZXJ0IHN0cmFpZ2h0IHBhdGhzIGZvciBlYWNoIGdlbm90eXBlIHRvIGJlemllciBjdXJ2ZSBwYXRocwoJKiBAcGFyYW0ge09iamVjdH0gcGF0aHMgLS0gc3RyYWlnaHQgcGF0aCBmb3IgZWFjaCBnZW5vdHlwZQoJKiBAcGFyYW0ge051bWJlcn0gdHNTVkdXaWR0aCAtLSB3aWR0aCBvZiB0aGUgdGltZXNjYXBlIHN2ZwoJKiBAcGFyYW0ge051bWJlcn0gdHNTVkdIZWlnaHQgLS0gaGVpZ2h0IG9mIHRoZSB0aW1lc2NhcGUgc3ZnCgkqLwoJZnVuY3Rpb24gX2dldEJlemllclBhdGhzKHBhdGhzLCB0c1NWR1dpZHRoLCB0c1NWR0hlaWdodCkgewoKCSAgICB2YXIgYmV6aWVyX3BhdGhzID0gW10sCgkgICAgICAgIHBhdGgsCgkgICAgICAgIGJlemllcl9wYXRoLAoJICAgICAgICB4c291cmNlLAoJICAgICAgICB4dGFyZ2V0LAoJICAgICAgICB5c291cmNlLAoJICAgICAgICB5dGFyZ2V0LAoJICAgICAgICBkaWFnb25hbDsKCgkgICAgLy8gZm9yIGVhY2ggZ2Vub3R5cGUncyBwYXRoCgkgICAgJC5lYWNoKHBhdGhzLCBmdW5jdGlvbihwYXRoX2lkeCwgY3VyX3BhdGgpIHsgCgoJICAgICAgICBwYXRoID0gY3VyX3BhdGgucGF0aDsKCSAgICAgICAgYmV6aWVyX3BhdGggPSAiIjsKCgkgICAgICAgIC8vIGZvciBlYWNoIHBvaW50IGluIHRoZSBwYXRoLCBnZXQgaXRzIGRpYWdvbmFsIHRvIHRoZSBuZXh0IHBvaW50CgkgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGF0aC5sZW5ndGgtMTsgaSsrKSB7CgkgICAgICAgICAgICB4c291cmNlID0gcGF0aFtpXS54ICogdHNTVkdXaWR0aDsKCSAgICAgICAgICAgIHh0YXJnZXQgPSBwYXRoW2krMV0ueCAqIHRzU1ZHV2lkdGg7CgkgICAgICAgICAgICB5c291cmNlID0gcGF0aFtpXS55ICogdHNTVkdIZWlnaHQ7CgkgICAgICAgICAgICB5dGFyZ2V0ID0gcGF0aFtpKzFdLnkgKiB0c1NWR0hlaWdodDsKCgkgICAgICAgICAgICAvLyBkaWFnb25hbCBsaW5lIGdlbmVyYXRvciBmb3IgYmV6aWVyIGN1cnZlIGJldHdlZW4gdHdvIHBvaW50cwoJICAgICAgICAgICAgZGlhZ29uYWwgPSBkMy5zdmcuZGlhZ29uYWwoKQoJICAgICAgICAgICAgICAgIC5zb3VyY2UoZnVuY3Rpb24oKSB7IHJldHVybiB7InkiOiB4c291cmNlLCAieCI6IHlzb3VyY2UgfTsgfSkKCSAgICAgICAgICAgICAgICAudGFyZ2V0KGZ1bmN0aW9uKCkgeyByZXR1cm4geyJ5IjogeHRhcmdldCwgIngiOiB5dGFyZ2V0fTt9KQoJICAgICAgICAgICAgICAgIC5wcm9qZWN0aW9uKGZ1bmN0aW9uKGQpIHsgcmV0dXJuIFtkLnksIGQueF0gfSk7CgoJICAgICAgICAgICAgLy8gZm9yIHRoaXMgZ2Vub3R5cGUsIGFwcGVuZCB0aGUgYmV6aWVyIGN1cnZlIGNvbm5lY3RpbmcgdGhpcyBwb2ludCBhbmQgdGhlIG5leHQgCgkgICAgICAgICAgICBiZXppZXJfcGF0aCA9IChpID09PSAwKSA/IGJlemllcl9wYXRoICsgZGlhZ29uYWwoKSA6IGJlemllcl9wYXRoICsgIkwiICsgZGlhZ29uYWwoKS5zdWJzdHJpbmcoMSk7CgkgICAgICAgIH0KCgkgICAgICAgIGJlemllcl9wYXRocy5wdXNoKHsiZ3R5cGUiOiBjdXJfcGF0aC5ndHlwZSwgInBhdGgiOiBiZXppZXJfcGF0aH0pOwoJICAgIH0pCgoJICAgIHJldHVybiBiZXppZXJfcGF0aHM7Cgl9CgoJLy8gQ09MT1VSIEZVTkNUSU9OUwoKCS8qIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSBjb2xvdXJzIGJhc2VkIG9uIHBoeWxvZ2VueSAKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iaiAtLSB2aXpPYmogZm9yIHRoZSBjdXJyZW50IHZpZXcKCSovCglmdW5jdGlvbiBfZ2V0UGh5bG9Db2xvdXJzKGN1clZpek9iaikgewoKCSAgICB2YXIgY29sb3VyX2Fzc2lnbm1lbnQgPSB7fSwgLy8gc3RhbmRhcmQgY29sb3VyIGFzc2lnbm1lbnQKCSAgICAgICAgYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSB7fSwgLy8gYWxwaGEgY29sb3VyIGFzc2lnbm1lbnQKCSAgICAgICAgY3VyX2NvbG91cnMgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5jbG9uZV9jb2xzOwoKCSAgICAvLyBjbG9uZSBjb2xvdXJzIHNwZWNpZmllZAoJICAgIGlmIChjdXJfY29sb3VycyAhPSAiTkEiKSB7CgkgICAgICAgIC8vIGdldCBjb2xvdXIgYXNzaWdubWVudCAtIHVzZSBzcGVjaWZpZWQgY29sb3VycwoJICAgICAgICAvLyBoYW5kbGluZyBkaWZmZXJlbnQgaW5wdXRzIC0tIFRPRE8gc2hvdWxkIHByb2JhYmx5IGJlIGRvbmUgaW4gUgoJICAgICAgICBjdXJfY29sb3Vycy5mb3JFYWNoKGZ1bmN0aW9uKGNvbCwgY29sX2lkeCkgewoJICAgICAgICAgICAgdmFyIGNvbF92YWx1ZSA9IGNvbC5jb2xvdXI7CgkgICAgICAgICAgICBpZiAoY29sX3ZhbHVlWzBdICE9ICIjIikgeyAvLyBhcHBlbmQgYSBoYXNodGFnIGlmIG5lY2Vzc2FyeQoJICAgICAgICAgICAgICAgIGNvbF92YWx1ZSA9ICIjIi5jb25jYXQoY29sX3ZhbHVlKTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGlmIChjb2xfdmFsdWUubGVuZ3RoID4gNykgeyAvLyByZW1vdmUgYW55IGFscGhhIHRoYXQgbWF5IGJlIHByZXNlbnQgaW4gdGhlIGhleCB2YWx1ZQoJICAgICAgICAgICAgICAgIGNvbF92YWx1ZSA9IGNvbF92YWx1ZS5zdWJzdHJpbmcoMCw3KTsKCSAgICAgICAgICAgIH0KCSAgICAgICAgICAgIGNvbG91cl9hc3NpZ25tZW50W2NvbC5jbG9uZV9pZF0gPSBjb2xfdmFsdWU7CgkgICAgICAgIH0pOwoJICAgIH0KCgkgICAgLy8gY2xvbmUgY29sb3VycyBub3Qgc3BlY2lmaWVkCgkgICAgZWxzZSB7CgkgICAgICAgIHZhciBzID0gMC44OCwgLy8gc2F0dXJhdGlvbgoJICAgICAgICAgICAgbCA9IDAuNzc7IC8vIGxpZ2h0bmVzcwoKCSAgICAgICAgLy8gbnVtYmVyIG9mIG5vZGVzCgkgICAgICAgIHZhciBuX25vZGVzID0gY3VyVml6T2JqLmRhdGEudHJlZUNoYWluUm9vdHMubGVuZ3RoOwoKCSAgICAgICAgLy8gY29sb3VyIGVhY2ggdHJlZSBjaGFpbiByb290IGEgc2VxdWVudGlhbCBjb2xvdXIgZnJvbSB0aGUgc3BlY3RydW0KCSAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBuX25vZGVzOyBpKyspIHsKCSAgICAgICAgICAgIHZhciBjdXJfbm9kZSA9IGN1clZpek9iai5kYXRhLnRyZWVDaGFpblJvb3RzW2ldOwoJICAgICAgICAgICAgdmFyIGggPSAoaS9uX25vZGVzICsgMC45NikgJSAxOwoJICAgICAgICAgICAgdmFyIHJnYiA9IF9oc2xUb1JnYihoLCBzLCBsKTsgLy8gaHNsIHRvIHJnYgoJICAgICAgICAgICAgdmFyIGNvbCA9IF9yZ2IyaGV4KCJyZ2IoIiArIHJnYlswXSArICIsIiArIHJnYlsxXSArICIsIiArIHJnYlsyXSArICIpIik7IC8vIHJnYiB0byBoZXgKCgkgICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtjdXJfbm9kZV0gPSBjb2w7CgoJICAgICAgICAgICAgLy8gZm9yIGVhY2ggb2YgdGhlIGNoYWluJ3MgZGVzY2VuZGFudHMKCSAgICAgICAgICAgIHZhciBwcmV2X2NvbG91ciA9IGNvbDsKCSAgICAgICAgICAgIGN1clZpek9iai5kYXRhLnRyZWVDaGFpbnNbY3VyX25vZGVdLmZvckVhY2goZnVuY3Rpb24oZGVzYywgZGVzY19pKSB7CgkgICAgICAgICAgICAgICAgLy8gaWYgd2UncmUgb24gdGhlIHBoYW50b20gcm9vdCdzIGJyYW5jaCBhbmQgaXQncyB0aGUgZmlyc3QgZGVzY2VuZGFudAoJICAgICAgICAgICAgICAgIGlmIChjdXJfbm9kZSA9PSBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdCAmJiBkZXNjX2kgPT09IDApIHsKCgkgICAgICAgICAgICAgICAgICAgIC8vIGRvIG5vdCBkZWNyZWFzZSB0aGUgYnJpZ2h0bmVzcwoJICAgICAgICAgICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtkZXNjXSA9IHByZXZfY29sb3VyOwoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgICAgICAvLyB3ZSdyZSBub3Qgb24gdGhlIHBoYW50b20gcm9vdCBicmFuY2gncyBmaXJzdCBkZXNjZW5kYW50CgkgICAgICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgICAgIC8vIGNvbG91ciB0aGUgZGVzY2VuZGFudCBhIGxpZ2h0ZXIgdmVyc2lvbiBvZiB0aGUgcHJldmlvdXMgY29sb3VyIGluIHRoZSBjaGFpbgoJICAgICAgICAgICAgICAgICAgICBjb2xvdXJfYXNzaWdubWVudFtkZXNjXSA9IAoJICAgICAgICAgICAgICAgICAgICAgICAgX2RlY3JlYXNlX2JyaWdodG5lc3MocHJldl9jb2xvdXIsIDIwKTsKCgkgICAgICAgICAgICAgICAgICAgIC8vIHNldCB0aGUgcHJldmlvdXMgY29sb3VyIHRvIHRoZSBsaWdodGVuZWQgY29sb3VyCgkgICAgICAgICAgICAgICAgICAgIHByZXZfY29sb3VyID0gY29sb3VyX2Fzc2lnbm1lbnRbZGVzY107IAoJICAgICAgICAgICAgICAgIH0KCSAgICAgICAgICAgIH0pCgkgICAgICAgIH0KCSAgICB9CgkgICAgY3VyVml6T2JqLnZpZXcuY29sb3VyX2Fzc2lnbm1lbnQgPSBjb2xvdXJfYXNzaWdubWVudDsgIAoKCSAgICAvLyBnZXQgdGhlIGFscGhhIGNvbG91ciBhc3NpZ25tZW50CgkgICAgT2JqZWN0LmtleXMoY29sb3VyX2Fzc2lnbm1lbnQpLmZvckVhY2goZnVuY3Rpb24oa2V5LCBrZXlfaWR4KSB7CgkgICAgICAgIGFscGhhX2NvbG91cl9hc3NpZ25tZW50W2tleV0gPSAKCSAgICAgICAgICAgIF9pbmNyZWFzZV9icmlnaHRuZXNzKGNvbG91cl9hc3NpZ25tZW50W2tleV0sIGN1clZpek9iai51c2VyQ29uZmlnLmFscGhhKTsKCSAgICB9KTsKCSAgICBjdXJWaXpPYmoudmlldy5hbHBoYV9jb2xvdXJfYXNzaWdubWVudCA9IGFscGhhX2NvbG91cl9hc3NpZ25tZW50OwoJfQoKCS8vIENoZWNrIGNvbG9yIGJyaWdodG5lc3MKCS8vIHJldHVybnMgYnJpZ2h0bmVzcyB2YWx1ZSBmcm9tIDAgdG8gMjU1CgkvLyBodHRwOi8vd3d3LndlYm1hc3RlcndvcmxkLmNvbS9mb3J1bTg4Lzk3NjkuaHRtCglmdW5jdGlvbiBfZ2V0X2JyaWdodG5lc3MoaGV4Q29kZSkgewoJICAgIGlmIChoZXhDb2RlID09IHVuZGVmaW5lZCkgewoJICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwoJICAgIH0KCgkgICAgLy8gc3RyaXAgb2ZmIGFueSBsZWFkaW5nICMKCSAgICBoZXhDb2RlID0gaGV4Q29kZS5yZXBsYWNlKCcjJywgJycpOwoKCSAgICB2YXIgY19yID0gcGFyc2VJbnQoaGV4Q29kZS5zdWJzdHIoMCwgMiksMTYpOwoJICAgIHZhciBjX2cgPSBwYXJzZUludChoZXhDb2RlLnN1YnN0cigyLCAyKSwxNik7CgkgICAgdmFyIGNfYiA9IHBhcnNlSW50KGhleENvZGUuc3Vic3RyKDQsIDIpLDE2KTsKCgkgICAgcmV0dXJuICgoY19yICogMjk5KSArIChjX2cgKiA1ODcpICsgKGNfYiAqIDExNCkpIC8gMTAwMDsKCX0KCgkvKioKCSAqIENvbnZlcnRzIGFuIEhTTCBjb2xvciB2YWx1ZSB0byBSR0IuIENvbnZlcnNpb24gZm9ybXVsYQoJICogYWRhcHRlZCBmcm9tIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvSFNMX2NvbG9yX3NwYWNlLgoJICogQXNzdW1lcyBoLCBzLCBhbmQgbCBhcmUgY29udGFpbmVkIGluIHRoZSBzZXQgWzAsIDFdIGFuZAoJICogcmV0dXJucyByLCBnLCBhbmQgYiBpbiB0aGUgc2V0IFswLCAyNTVdLgoJICoKCSAqIEBwYXJhbSAgIE51bWJlciAgaCAgICAgICBUaGUgaHVlCgkgKiBAcGFyYW0gICBOdW1iZXIgIHMgICAgICAgVGhlIHNhdHVyYXRpb24KCSAqIEBwYXJhbSAgIE51bWJlciAgbCAgICAgICBUaGUgbGlnaHRuZXNzCgkgKiBAcmV0dXJuICBBcnJheSAgICAgICAgICAgVGhlIFJHQiByZXByZXNlbnRhdGlvbgoJICovCglmdW5jdGlvbiBfaHNsVG9SZ2IoaCwgcywgbCl7CgkgICAgdmFyIHIsIGcsIGI7CgoJICAgIGlmKHMgPT09IDApewoJICAgICAgICByID0gZyA9IGIgPSBsOyAvLyBhY2hyb21hdGljCgkgICAgfWVsc2V7CgkgICAgICAgIHZhciBodWUycmdiID0gZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KXsKCSAgICAgICAgICAgIGlmKHQgPCAwKSB0ICs9IDE7CgkgICAgICAgICAgICBpZih0ID4gMSkgdCAtPSAxOwoJICAgICAgICAgICAgaWYodCA8IDEvNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7CgkgICAgICAgICAgICBpZih0IDwgMS8yKSByZXR1cm4gcTsKCSAgICAgICAgICAgIGlmKHQgPCAyLzMpIHJldHVybiBwICsgKHEgLSBwKSAqICgyLzMgLSB0KSAqIDY7CgkgICAgICAgICAgICByZXR1cm4gcDsKCSAgICAgICAgfQoKCSAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwoJICAgICAgICB2YXIgcCA9IDIgKiBsIC0gcTsKCSAgICAgICAgciA9IGh1ZTJyZ2IocCwgcSwgaCArIDEvMyk7CgkgICAgICAgIGcgPSBodWUycmdiKHAsIHEsIGgpOwoJICAgICAgICBiID0gaHVlMnJnYihwLCBxLCBoIC0gMS8zKTsKCSAgICB9CgoJICAgIHJldHVybiBbTWF0aC5yb3VuZChyICogMjU1KSwgTWF0aC5yb3VuZChnICogMjU1KSwgTWF0aC5yb3VuZChiICogMjU1KV07Cgl9CgoJLy8gY29udmVydCBSR0IgdG8gaGV4CgkvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE3NDA3MDAvZ2V0LWhleC12YWx1ZS1yYXRoZXItdGhhbi1yZ2ItdmFsdWUtdXNpbmctanF1ZXJ5CglmdW5jdGlvbiBfcmdiMmhleChyZ2IpIHsKCSAgICAgaWYgKCAgcmdiLnNlYXJjaCgicmdiIikgPT0gLTEgKSB7CgkgICAgICAgICAgcmV0dXJuIHJnYjsKCSAgICAgfSBlbHNlIHsKCSAgICAgICAgICByZ2IgPSByZ2IubWF0Y2goL15yZ2JhP1woKFxkKyksXHMqKFxkKyksXHMqKFxkKykoPzosXHMqKFxkKykpP1wpJC8pOwoJICAgICAgICAgIGZ1bmN0aW9uIGhleCh4KSB7CgkgICAgICAgICAgICAgICByZXR1cm4gKCIwIiArIHBhcnNlSW50KHgpLnRvU3RyaW5nKDE2KSkuc2xpY2UoLTIpOwoJICAgICAgICAgIH0KCSAgICAgICAgICByZXR1cm4gIiMiICsgaGV4KHJnYlsxXSkgKyBoZXgocmdiWzJdKSArIGhleChyZ2JbM10pOyAKCSAgICAgfQoJfQoKCS8vIGZ1bmN0aW9uIHRvIGluY3JlYXNlIGJyaWdodG5lc3Mgb2YgaGV4IGNvbG91cgoJLy8gZnJvbTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy82NDQzOTkwL2phdmFzY3JpcHQtY2FsY3VsYXRlLWJyaWdodGVyLWNvbG91cgoJZnVuY3Rpb24gX2luY3JlYXNlX2JyaWdodG5lc3MoaGV4LCBwZXJjZW50KXsKCSAgICAvLyBzdHJpcCB0aGUgbGVhZGluZyAjIGlmIGl0J3MgdGhlcmUKCSAgICBoZXggPSBoZXgucmVwbGFjZSgvXlxzKiN8XHMqJC9nLCAnJyk7CgoJICAgIC8vIGNvbnZlcnQgMyBjaGFyIGNvZGVzIC0tPiA2LCBlLmcuIGBFMEZgIC0tPiBgRUUwMEZGYAoJICAgIGlmKGhleC5sZW5ndGggPT0gMyl7CgkgICAgICAgIGhleCA9IGhleC5yZXBsYWNlKC8oLikvZywgJyQxJDEnKTsKCSAgICB9CgoJICAgIHZhciByID0gcGFyc2VJbnQoaGV4LnN1YnN0cigwLCAyKSwgMTYpLAoJICAgICAgICBnID0gcGFyc2VJbnQoaGV4LnN1YnN0cigyLCAyKSwgMTYpLAoJICAgICAgICBiID0gcGFyc2VJbnQoaGV4LnN1YnN0cig0LCAyKSwgMTYpOwoKCSAgICByZXR1cm4gJyMnICsKCSAgICAgICAoKDB8KDE8PDgpICsgciArICgyNTYgLSByKSAqIHBlcmNlbnQgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpICsKCSAgICAgICAoKDB8KDE8PDgpICsgZyArICgyNTYgLSBnKSAqIHBlcmNlbnQgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpICsKCSAgICAgICAoKDB8KDE8PDgpICsgYiArICgyNTYgLSBiKSAqIHBlcmNlbnQgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpOwoJfQoKCS8vIGZ1bmN0aW9uIHRvIGRlY3JlYXNlIGJyaWdodG5lc3Mgb2YgaGV4IGNvbG91cgoJLy8gZnJvbTogaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMjY2MDkxOS9qYXZhc2NyaXB0LWJyaWdodG5lc3MtZnVuY3Rpb24tZGVjcmVhc2UKCWZ1bmN0aW9uIF9kZWNyZWFzZV9icmlnaHRuZXNzKGhleCwgcGVyY2VudCl7CgkgICAgdmFyIHIgPSBwYXJzZUludChoZXguc3Vic3RyKDEsIDIpLCAxNiksCgkgICAgICAgIGcgPSBwYXJzZUludChoZXguc3Vic3RyKDMsIDIpLCAxNiksCgkgICAgICAgIGIgPSBwYXJzZUludChoZXguc3Vic3RyKDUsIDIpLCAxNik7CgoJICAgcmV0dXJuICcjJyArCgkgICAgICAgKCgwfCgxPDw4KSArIHIgKiAoMTAwIC0gcGVyY2VudCkgLyAxMDApLnRvU3RyaW5nKDE2KSkuc3Vic3RyKDEpICsKCSAgICAgICAoKDB8KDE8PDgpICsgZyAqICgxMDAgLSBwZXJjZW50KSAvIDEwMCkudG9TdHJpbmcoMTYpKS5zdWJzdHIoMSkgKwoJICAgICAgICgoMHwoMTw8OCkgKyBiICogKDEwMCAtIHBlcmNlbnQpIC8gMTAwKS50b1N0cmluZygxNikpLnN1YnN0cigxKTsKCX0KCgkvLyBNVVRBVElPTiBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIG11dGF0aW9ucyBpbnRvIGEgYmV0dGVyIGZvcm1hdAoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKi8KCWZ1bmN0aW9uIF9yZWZvcm1hdE11dGF0aW9ucyhjdXJWaXpPYmopIHsKCSAgICB2YXIgb3JpZ2luYWxfbXV0cyA9IGN1clZpek9iai51c2VyQ29uZmlnLm11dGF0aW9ucywgLy8gbXV0cyBmcm9tIHVzZXIgZGF0YQoJICAgICAgICBtdXRzX2FyciA9IFtdOwoKCSAgICAvLyBjb252ZXJ0IG9iamVjdCBpbnRvIGFycmF5CgkgICAgb3JpZ2luYWxfbXV0cy5mb3JFYWNoKGZ1bmN0aW9uKG11dCkgewoKCSAgICAgICAgLy8gbGluayBpZCB3aGVyZSBtdXRhdGlvbiBvY2N1cnJlZAoJICAgICAgICB2YXIgbGlua19pZCA9ICJ0cmVlTGlua19zb3VyY2VfIiArIGN1clZpek9iai5kYXRhLmRpcmVjdF9hbmNlc3RvcnNbbXV0LmNsb25lX2lkXSArICJfdGFyZ2V0XyIgKyAgbXV0LmNsb25lX2lkOwoKCSAgICAgICAgLy8gYWRkIHRoaXMgbXV0YXRpb24gdG8gdGhlIGFycmF5CgkgICAgICAgIHZhciBjdXJfbXV0ID0gewoJICAgICAgICAgICAgImVtcHR5IjogIiIsIC8vIGFkZCBhbiBlbXB0eSBzdHJpbmcgZm9yIGFuIGVtcHR5IGNvbHVtbiAoY2xvbmUgY29sdW1uKSB0aGF0IHdpbGwgY29udGFpbiBhbiBTVkcKCSAgICAgICAgICAgICJsaW5rX2lkIjogbGlua19pZCwKCSAgICAgICAgfQogICAgICAgICAgICBPYmplY3Qua2V5cyhtdXQpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgICAgICBjdXJfbXV0W2tleV0gPSBtdXRba2V5XTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgbXV0c19hcnIucHVzaChjdXJfbXV0KTsKCSAgICB9KTsKCgkgICAgY3VyVml6T2JqLmRhdGEubXV0YXRpb25zID0gbXV0c19hcnI7Cgl9CgoJLy8gR0VORVJBTCBGVU5DVElPTlMKCgkvKiBmdW5jdGlvbiB0byBjYXBpdGFsaXplIGVhY2ggd29yZCBpbiBhIHN0cmluZwoJKiBGcm9tOiBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQ4Nzg3NTYvamF2YXNjcmlwdC1ob3ctdG8tY2FwaXRhbGl6ZS1maXJzdC1sZXR0ZXItb2YtZWFjaC13b3JkLWxpa2UtYS0yLXdvcmQtY2l0eQoJKi8KCWZ1bmN0aW9uIHRvVGl0bGVDYXNlKHN0cikKCXsKCSAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1x3XFMqL2csIGZ1bmN0aW9uKHR4dCl7cmV0dXJuIHR4dC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHR4dC5zdWJzdHIoMSkudG9Mb3dlckNhc2UoKTt9KTsKCX0KCgkvKiBmdW5jdGlvbiB0byBnZXQgdGhlIGludGVyc2VjdGlvbiBvZiB0d28gYXJyYXlzCgkqIEBwYXJhbSB7QXJyYXl9IGFycmF5MSAtLSBmaXJzdCBhcnJheQoJKiBAcGFyYW0ge0FycmF5fSBhcnJheTIgLS0gc2Vjb25kIGFycmF5CgkqLwoJZnVuY3Rpb24gX2dldEludGVyc2VjdGlvbihhcnJheTEsIGFycmF5MikgewoKCSAgICBpZiAoYXJyYXkxID09IHVuZGVmaW5lZCB8fCBhcnJheTIgPT0gdW5kZWZpbmVkKSB7CgkgICAgICAgIHJldHVybiBbXTsKCSAgICB9CgoJICAgIHJldHVybiBhcnJheTEuZmlsdGVyKGZ1bmN0aW9uKG4pIHsKCSAgICAgICAgcmV0dXJuIGFycmF5Mi5pbmRleE9mKG4pICE9IC0xCgkgICAgfSk7Cgl9CgoJLyogZnVuY3Rpb24gdG8gc29ydCBhIDJEIGFycmF5IGJ5IHRoZSBzZWNvbmQgdmFsdWUgaW4gZWFjaCBjb250YWluZWQgYXJyYXksIAoJKiBAcmV0dXJucyB0aGUgc29ydGVkIGZpcnN0IGVsZW1lbnRzIG9mIGVhY2ggY29udGFpbmVkIGFycmF5IAoJKi8KCWZ1bmN0aW9uIF9zb3J0MkRBcnJCeVZhbHVlKG9iaikKCXsKCSAgICB2YXIgeCwKCSAgICAgICAgeTsKCgkgICAgLy8gc29ydCBpdGVtcyBieSB2YWx1ZQoJICAgIG9iai5zb3J0KGZ1bmN0aW9uKGEsIGIpCgkgICAgewoJICAgICAgICB4PWFbMV07CgkgICAgICAgIHk9YlsxXTsKCSAgICAgICAgcmV0dXJuIHg8eSA/IC0xIDogeD55ID8gMSA6IDA7CgkgICAgfSk7CgoJICAgIC8vIGdldCBmaXJzdCBlbGVtZW50IG9mIGVhY2ggY29udGFpbmVkIGFycmF5CgkgICAgZmlyc3RfZWxlbWVudHMgPSBbXTsKCSAgICBmb3IodmFyIGk9MDsgaTxvYmoubGVuZ3RoOyBpKyspIHsKCSAgICAgICAgZmlyc3RfZWxlbWVudHMucHVzaChvYmpbaV1bMF0pOwoJICAgIH0KCgkgICAgcmV0dXJuIGZpcnN0X2VsZW1lbnRzOyAKCX0KCgkvKiBmdW5jdGlvbiB0byBkb3dubG9hZCBQTkcKCSogQHBhcmFtIGNsYXNzTmFtZSAtLSBuYW1lIG9mIHRoZSBjbGFzcyBvZiB0aGUgc3ZnIHRvIGRvd25sb2FkIChlLmcuICJteVNWRyIpCgkqIEBwYXJhbSBmaWxlT3V0cHV0TmFtZSAtLSBmaWxlbmFtZSBmb3Igb3V0cHV0CgkqLwoJZnVuY3Rpb24gX2Rvd25sb2FkUE5HKGNsYXNzTmFtZSwgZmlsZU91dHB1dE5hbWUpIHsKCSAgICAvLyBnZXQgY3VycmVudCBtYXJnaW4gb2Ygc3ZnIGVsZW1lbnQKCSAgICB2YXIgY3VyX21hcmdpbiA9IGQzLnNlbGVjdCgiLiIgKyBjbGFzc05hbWUpLnN0eWxlKCJtYXJnaW4iKTsKCgkgICAgLy8gdGVtcG9yYXJpbHkgcmVtb3ZlIHRoZSBtYXJnaW4gc28gdGhlIHZpZXcgaXNuJ3QgY3V0IG9mZgoJICAgIGQzLnNlbGVjdCgiLiIgKyBjbGFzc05hbWUpCgkgICAgICAgIC5zdHlsZSgibWFyZ2luIiwgIjBweCIpOwoKCSAgICB2YXIgaHRtbCA9IGQzLnNlbGVjdCgiLiIgKyBjbGFzc05hbWUpCgkgICAgICAgIC5hdHRyKCJ2ZXJzaW9uIiwgMS4xKQoJICAgICAgICAuYXR0cigieG1sbnMiLCAiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciKQoJICAgICAgICAubm9kZSgpLnBhcmVudE5vZGUuaW5uZXJIVE1MOwoKCSAgICB2YXIgaW1nc3JjID0gJ2RhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsJysgYnRvYShodG1sKTsKCgkgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoImNhbnZhcyIpLAoJICAgICAgICBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CgoJICAgIHZhciBpbWFnZSA9IG5ldyBJbWFnZTsKCSAgICBpbWFnZS5zcmMgPSBpbWdzcmM7CgkgICAgaW1hZ2Uub25sb2FkID0gZnVuY3Rpb24oKSB7CgkgICAgICAgIGNvbnRleHQuZHJhd0ltYWdlKGltYWdlLCAwLCAwKTsKCgkgICAgICAgIHZhciBjYW52YXNkYXRhID0gY2FudmFzLnRvRGF0YVVSTCgiaW1hZ2UvcG5nIik7CgoJICAgICAgICB2YXIgcG5naW1nID0gJzxpbWcgc3JjPSInK2NhbnZhc2RhdGErJyI+JzsgCgoJICAgICAgICB2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImEiKTsKCSAgICAgICAgYS5kb3dubG9hZCA9IGZpbGVPdXRwdXROYW1lOwoJICAgICAgICBhLmhyZWYgPSBjYW52YXNkYXRhOwoJICAgICAgICBhLmNsaWNrKCk7CgkgICAgfTsKCgkgICAgLy8gcmVzZXQgdGhlIG1hcmdpbiBvZiB0aGUgc3ZnIGVsZW1lbnQKCSAgICBkMy5zZWxlY3QoIi4iICsgY2xhc3NOYW1lKQoJICAgICAgICAuc3R5bGUoIm1hcmdpbiIsIGN1cl9tYXJnaW4pOwoJfQoKCS8qIGZ1bmN0aW9uIHRvIHNvcnQgYXJyYXkgb2Ygb2JqZWN0cyBieSBrZXkgCgkqIG1vZGlmaWVkIGZyb206IGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODgzNzQ1NC9zb3J0LWFycmF5LW9mLW9iamVjdHMtYnktc2luZ2xlLWtleS13aXRoLWRhdGUtdmFsdWUKCSovCglmdW5jdGlvbiBfc29ydEJ5S2V5KGFycmF5LCBmaXJzdEtleSwgc2Vjb25kS2V5KSB7CgkgICAgc2Vjb25kS2V5ID0gc2Vjb25kS2V5IHx8ICJOQSI7CgkgICAgcmV0dXJuIGFycmF5LnNvcnQoZnVuY3Rpb24oYSwgYikgewoJICAgICAgICB2YXIgeCA9IGFbZmlyc3RLZXldOyB2YXIgeSA9IGJbZmlyc3RLZXldOwoJICAgICAgICB2YXIgcmVzID0gKCh4IDwgeSkgPyAtMSA6ICgoeCA+IHkpID8gMSA6IDApKTsKCSAgICAgICAgaWYgKHNlY29uZEtleSA9PSAiTkEiKSB7CgkgICAgICAgICAgICByZXR1cm4gcmVzOyAgICAgICAgICAgIAoJICAgICAgICB9CgkgICAgICAgIGVsc2UgewoJICAgICAgICAgICAgaWYgKHR5cGVvZihhW3NlY29uZEtleV0gPT0gInN0cmluZyIpKSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIChyZXMgPT09IDApID8gKGFbc2Vjb25kS2V5XSA+IGJbc2Vjb25kS2V5XSkgOiByZXM7CgkgICAgICAgICAgICB9CgkgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YoYVtzZWNvbmRLZXldID09ICJudW1iZXIiKSkgewoJICAgICAgICAgICAgICAgIHJldHVybiAocmVzID09PSAwKSA/IChhW3NlY29uZEtleV0gLSBiW3NlY29uZEtleV0pIDogcmVzOwoJICAgICAgICAgICAgfQoJICAgICAgICAgICAgZWxzZSB7CgkgICAgICAgICAgICAgICAgcmV0dXJuIHJlczsKCSAgICAgICAgICAgIH0KCSAgICAgICAgfQoJICAgIH0pOwoJfQoKCS8vIE1VVEFUSU9OIFRBQkxFIEZVTkNUSU9OUwoKCS8qIGZ1bmN0aW9uIHRvIG1ha2UgbXV0YXRpb24gdGFibGUKCSogQHBhcmFtIHtPYmplY3R9IGN1clZpek9iaiAtLSB2aXpPYmogZm9yIHRoZSBjdXJyZW50IHZpZXcKCSogQHBhcmFtIHtPYmplY3R9IG11dGF0aW9uVGFibGVESVYgLS0gRElWIGZvciBtdXRhdGlvbiB0YWJsZQoJKiBAcGFyYW0ge0FycmF5fSBkYXRhIC0tIGRhdGEgdG8gcGxvdCB3aXRoaW4gdGFibGUKCSogQHBhcmFtIHtOdW1iZXJ9IHRhYmxlX2hlaWdodCAtLSBoZWlnaHQgb2YgdGhlIHRhYmxlIChpbiBweCkKCSovCglmdW5jdGlvbiBfbWFrZU11dGF0aW9uVGFibGUoY3VyVml6T2JqLCBtdXRhdGlvblRhYmxlRElWLCBkYXRhLCB0YWJsZV9oZWlnaHQpIHsKCQl2YXIgZGltID0gY3VyVml6T2JqLmdlbmVyYWxDb25maWcsCgkJCXZpZXdfaWQgPSBjdXJWaXpPYmoudmlld19pZCwKCQkJdGFibGU7CgoJCS8vIG1ha2UgZGVmZXJyZWQgb2JqZWN0IGZvciBtdXRhdGlvbiB0YWJsZSBzZXR1cAoJCWN1clZpek9iai5tdXRUYWJsZURlZiA9IG5ldyAkLkRlZmVycmVkKCk7CgoJICAgIC8vIGNyZWF0ZSB0YWJsZSBza2VsZXRvbgoJICAJbXV0YXRpb25UYWJsZURJVi5hcHBlbmQoInRhYmxlIikKCSAgCQkuYXR0cigiY2xhc3MiLCAiZGlzcGxheSBjb21wYWN0IikKCSAgICAJLmF0dHIoImlkIiwgZnVuY3Rpb24oKSB7IHJldHVybiB2aWV3X2lkICsgIl9tdXRhdGlvblRhYmxlIjsgfSk7CgoJICAgIC8vIGNyZWF0ZSBkYXRhIHRhYmxlCgkJJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKSB7CgkJICAgIHRhYmxlID0gJCgiIyIgKyB2aWV3X2lkICsgIl9tdXRhdGlvblRhYmxlIikuRGF0YVRhYmxlKHsKCQkgICAgICAJImRhdGEiOiBkYXRhLAoJCSAgICAgIAkiY29sdW1ucyI6IGRpbS5tdXRhdGlvbkNvbHVtbnMsCgkJCSAgICAic2Nyb2xsWSI6ICAgICAgICB0YWJsZV9oZWlnaHQgLSA1MCwgLy8gLSA1MCBmb3Igc2VhcmNoIGJhciwgZXRjLgoJCSAgICAgICAgInNjcm9sbENvbGxhcHNlIjogdHJ1ZSwKCQkgICAgICAgICJwYWdpbmciOiAgICAgICAgIGZhbHNlLAoJCSAgICAgICAgImluZm8iOiAJCSAgdHJ1ZSwKCQkgICAgICAgICJsYW5ndWFnZSI6IHsKCQkgICAgICAgIAkiaW5mbyI6ICAgICAgICAgICAiU2hvd2luZyBfVE9UQUxfIGVudHJpZXMiLAoJCSAgICAgICAgCSJpbmZvRW1wdHkiOiAgICAgICJTaG93aW5nIDAgZW50cmllcyIKCQkgICAgICAgIH0sCgkgICAgICAgCQkiYWFTb3J0aW5nIjogW10gLy8gZGlzYWJsZSBpbml0aWFsIHNvcnQKCQkgICAgfSk7CgoJCSAgICBjdXJWaXpPYmoubXV0VGFibGVEZWYucmVzb2x2ZSgiRmluaXNoZWQgY3JlYXRpbmcgdGFibGUgc2V0dXAuIik7CgkJfSk7CQoKCgkJLy8gd2hlbiBtdXRhdGlvbiB0YWJsZSBpcyBzZXQgdXAKCQljdXJWaXpPYmoubXV0VGFibGVEZWYuZG9uZShmdW5jdGlvbigpIHsKCgkJCS8vIGQzIGVmZmVjdHMKCQkJJCgiIyIgKyB2aWV3X2lkICsgIl9tdXRhdGlvblRhYmxlIikKCQkgICAgICAgIC5vbignY2xpY2snLCAndHInLCBmdW5jdGlvbiAoKSB7IAoJCSAgICAgICAgCQoJCSAgICAgICAgCS8vIGhpZGUgVkFGIHRvb2x0aXBzCgkJICAgICAgICAJY3VyVml6T2JqLnZhZlRpcHMuZm9yRWFjaChmdW5jdGlvbihjdXJUaXApIHsKCQkgICAgICAgIAkJY3VyVGlwLmhpZGUoKTsKCQkgICAgICAgIAl9KQoKCQkgICAgICAgIAkvLyBpZiBtdXRhdGlvbiBpcyBhbHJlYWR5IHNlbGVjdGVkLCAKCQkgICAgICAgIAlpZiAoJCh0aGlzKS5oYXNDbGFzcygic2VsZWN0ZWQiKSkgewoJCSAgICAgICAgCQkvLyBzd2l0Y2ggbXV0YXRpb24gc2VsZWN0aW9uIHRvIGZhbHNlCgkJICAgICAgICAJCWRpbS5tdXRTZWxlY3RPbiA9IGZhbHNlOwoJCSAgICAgICAgCX0KCQkgICAgICAgIAkvLyBvdGhlcndpc2UsIAoJCSAgICAgICAgCWVsc2UgewoJCSAgICAgICAgCQkvLyBzd2l0Y2ggb24gbXV0YXRpb24gc2VsZWN0aW9uCgkJICAgICAgICAJCWRpbS5tdXRTZWxlY3RPbiA9IHRydWU7CgkJICAgICAgICAJfQoKCQkgICAgICAgIAkvLyBNVVRBVElPTiBTRUxFQ1RFRAoKCQkgICAgICAgIAlpZiAoZGltLm11dFNlbGVjdE9uKSB7CgoJCQkgICAgICAgIAkvLyBkYXRhIGZvciB0aGUgcm93IG9uIG1vdXNlb3ZlcgoJCQkgICAgICAgIAl2YXIgY3VyX2RhdGEgPSB0YWJsZS5yb3dzKHRoaXMpLmRhdGEoKVswXTsKCgkJICAgICAgICAJCS8vIGlmIGEgZGlmZmVyZW50IHJvdyB3YXMgcHJldmlvdXNseSBzZWxlY3RlZAoJCSAgICAgICAgCQlpZiAoZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5zZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CgoJCSAgICAgICAgCQkJLy8gZGVzZWxlY3QgdGhhdCByb3cKCQkJICAgICAgICAJCWQzLnNlbGVjdCgiIyIgKyBjdXJWaXpPYmoudmlld19pZCkuc2VsZWN0KCIuc2VsZWN0ZWQiKS5jbGFzc2VkKCJzZWxlY3RlZCIsIGZhbHNlKTsKCgkJCSAgICAgICAgCQkvLyByZW1vdmUgYWxsIG11dGF0aW9uIHByZXZhbGVuY2VzIGluZm9ybWF0aW9uIGZyb20gdmlldwogICAgCQkJCQkJZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkKS5zZWxlY3RBbGwoIi5tdXRhdGlvblByZXYiKS5yZW1vdmUoKTsKCiAgICAJCQkJCQkvLyB1bmhpZ2hsaWdodCAocmVkKSB0aGUgcHJldmlvdXMgbGluawogICAgCQkJCQkJZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmxlZ2VuZFRyZWVMaW5rIikuYXR0cigic3Ryb2tlIiwgZGltLnRyZWVMaW5rQ29sb3VyKTsKCQkJICAgICAgICAJfQoKCQkgICAgICAgIAkJLy8gaW5hY3RpdmF0ZSBnZW5vdHlwZXMKCSAgICAgICAgICAgICAgICAgICAgX3RzSW5hY3RpdmF0ZUdlbm90eXBlcyhjdXJWaXpPYmoudmlld19pZCk7CgogICAgICAgICAgICAgICAgICAgIAkvLyBoaWdobGlnaHQgdGhpcyBsaW5rIAoJICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkKCSAgICAgICAgICAgICAgICAgICAgICAgIC5zZWxlY3QoIi5sZWdlbmRUcmVlTGluay4iICsgY3VyX2RhdGEubGlua19pZCkKCSAgICAgICAgICAgICAgICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCAicmVkIik7CgoJICAgICAgICAgICAgICAgICAgICAvLyBoaWdobGlnaHQgYWxsIGVsZW1lbnRzIGRvd25zdHJlYW0gb2YgbGluayAKCSAgICAgICAgICAgICAgICAgICAgX3Byb3BhZ2F0ZWRFZmZlY3RzKGN1clZpek9iaiwgY3VyX2RhdGEubGlua19pZCwgY3VyVml6T2JqLmxpbmtfaWRzLCAiZG93bnN0cmVhbSIpOwoKCQkgICAgICAgIAkJLy8gbWFyayBhcyBzZWxlY3RlZAoJICAgICAgICAJCQkkKHRoaXMpLmFkZENsYXNzKCdzZWxlY3RlZCcpOwoKICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbXV0YXRpb24gcHJldmFsZW5jZXMgZXhpc3QsIHNob3cgdGhlbSBmb3IgdGhpcyBtdXRhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcubXV0YXRpb25fcHJldmFsZW5jZXMpIHsKICAgICAgICAgICAgICAgICAgICAgICAgCS8vIGdlbm9taWMgbG9jYXRpb24gb2YgbXV0YXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsb2NhdGlvbiA9IGN1cl9kYXRhLmNocm9tICsgIjoiICsgY3VyX2RhdGEuY29vcmQ7IAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHByZXZhbGVuY2VzIG9mIHRoaXMgbXV0YXRpb24gYXQgZWFjaCBzYW1wbGUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJfcHJldnMgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5tdXRhdGlvbl9wcmV2YWxlbmNlc1tsb2NhdGlvbl07IAoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRocmVzaG9sZCBmb3IgbXV0YXRpb24gcHJldmFsZW5jZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRocmVzaG9sZCA9IDAuMDE7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmlsdGVyIG11dGF0aW9ucyAoZ2V0IHJpZCBvZiB0aG9zZSA8IHRocmVzaG9sZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJfcHJldnNfZmlsdGVyZWQgPSBfLmZpbHRlcihjdXJfcHJldnMsIGZ1bmN0aW9uKFZBRikgeyAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAlyZXR1cm4gVkFGLlZBRiA+PSB0aHJlc2hvbGQ7IAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgoJCSAgICAgICAgCQkJLy8gZm9yIGVhY2ggcHJldmFsZW5jZQoJCSAgICAgICAgCQkJY3VyX3ByZXZzX2ZpbHRlcmVkLmZvckVhY2goZnVuY3Rpb24ocHJldikgewoKCQkJCQkJCSAgICAvLyB0b29sdGlwIGZvciBtdXRhdGlvbiBWQUZzCgkJCQkJCQkgICAgdmFyIGN1clRpcCA9IGQzLnRpcCgpCgkJCQkJCQkgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKQoJCQkJCQkJICAgICAgICAub2Zmc2V0KFstMTAsMF0pCgkJCQkJCQkgICAgICAgIC5odG1sKGZ1bmN0aW9uKGQpIHsKCQkJCQkJCSAgICAJCXJldHVybiAiPHNwYW4+VkFGOiAiICsgZCArICI8L3NwYW4+IjsKCQkJCQkJCSAgCQl9KQkKCgkJCQkJCQkgIAkvLyBhZGQgdG8gbGlzdCBvZiB0aXBzCgkJCQkJCQkgIAljdXJWaXpPYmoudmFmVGlwcy5wdXNoKGN1clRpcCk7CgoJCQkJCQkJICAJLy8gaW52b2tlIHRoZSB0aXAgaW4gdGhlIGNvbnRleHQgb2YgdGhpcyB2aXN1YWxpemF0aW9uCgkJCQkJCQkgIAlkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIudGltZXNjYXBlXyIgKyB2aWV3X2lkKS5jYWxsKGN1clRpcCk7CgoJCQkJCQkJICAJLy8gc2hvdyB0b29sdGlwCgkJCQkJCQkgIAl2YXIgcm91bmRlZF9WQUYgPSAoTWF0aC5yb3VuZChwcmV2LlZBRioxMDApLzEwMCkudG9GaXhlZCgyKTsKCQkJCQkJCSAgCWN1clRpcC5zaG93KHJvdW5kZWRfVkFGLCAKCQkJCQkJCSAgCQlkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIueEF4aXNMYWJlbHMudHBfIiArIHByZXYudGltZXBvaW50KVswXVswXSk7CgkJICAgICAgICAJCQl9KQogICAgICAgICAgICAgICAgICAgICAgICB9CgkJICAgICAgICAJfQoKCQkgICAgICAgIAkvLyBNVVRBVElPTiBERS1TRUxFQ1RFRCAoY2xpY2sgYW55d2hlcmUgaW4gdGFibGUpCgoJCSAgICAgICAgCWVsc2UgewoJCSAgICAgICAgCQlfYmFja2dyb3VuZENsaWNrKGN1clZpek9iaik7CgkJICAgICAgICAJfQoKCQkgICAgICAgIH0pOwoKCgkJCS8vIGFkZCBjbG9uZSBTVkdzCgkJCWRpbS5jdXJDbG9uZUlEcyA9IF8ucGx1Y2soZGF0YSwgImNsb25lX2lkIik7CgkJCV9hZGRDbG9uZVNWR3NUb1RhYmxlKGN1clZpek9iaiwgZGltLmN1ckNsb25lSURzKTsKCSAgICB9KQoJfQoKCS8qIGZ1bmN0aW9uIHRvIGFkZCBjbG9uZSBTVkdzIHRvIHRoZSBtdXRhdGlvbiB0YWJsZQoJKiBAcGFyYW0ge09iamVjdH0gY3VyVml6T2JqIC0tIHZpek9iaiBmb3IgdGhlIGN1cnJlbnQgdmlldwoJKiBAcGFyYW0ge0FycmF5fSBjbG9uZV9pZHMgLS0gY2xvbmUgaWRzIHRvIHBsb3Qgd2l0aGluIHRhYmxlCgkqLwoJZnVuY3Rpb24gX2FkZENsb25lU1ZHc1RvVGFibGUoY3VyVml6T2JqLCBjbG9uZV9pZHMpIHsKCQkvLyByZW1vdmUgYW55IHByZXZpb3VzIGNsb25lIFNWR3MKCQlkMy5zZWxlY3QoIiMiICsgY3VyVml6T2JqLnZpZXdfaWQpLnNlbGVjdEFsbCgiLnN2Z0Nsb25lQ2lyY2xlIikucmVtb3ZlKCk7CgoJCS8vIGdldCBjbG9uZSBjb2x1bW4gbnVtYmVyCgkJdmFyIG11dF9jb2x1bW5zID0gXy5wbHVjayhjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5tdXRhdGlvbkNvbHVtbnMsICJkYXRhIik7CgkJdmFyIGNsb25lX2NvbHVtbl9ubyA9IG11dF9jb2x1bW5zLmluZGV4T2YoImVtcHR5IikgKyAxOwoKCQkvLyBhZGQgY2xvbmUgU1ZHcwoJCXZhciByb3dzID0gZDMuc2VsZWN0KCIjIiArIGN1clZpek9iai52aWV3X2lkICsgIl9tdXRhdGlvblRhYmxlIikuc2VsZWN0QWxsKCJ0ciIpOwoJCXZhciBzdmdDb2x1bW4gPSByb3dzLnNlbGVjdEFsbCgidGQ6bnRoLWNoaWxkKCIgKyBjbG9uZV9jb2x1bW5fbm8gKyAiKSIpCgkJCS5hcHBlbmQoImRpdiIpCgkJCS5hdHRyKCJpZCIsICJzdmdDbG9uZUNpcmNsZURJViIpCgkJCS5zdHlsZSgiaGVpZ2h0IiwiMTAwJSIpCgkgICAgICAgIC5zdHlsZSgid2lkdGgiLCIxMDAlIik7IAoJICAgIHZhciBpbmRleCA9IDA7IC8vIGluZGV4IG9mIGNsb25lIGlkIGluIGNsb25lX2lkcyBhcnJheQoJICAgIHZhciBzdmdDaXJjbGUgPSBzdmdDb2x1bW4KCSAgICAgICAgLmFwcGVuZCgic3ZnIikKCSAgICAgICAgLmF0dHIoIndpZHRoIiwgMTApCgkgICAgICAgIC5hdHRyKCJoZWlnaHQiLCAxMCkKCSAgICAgICAgLmF0dHIoImNsYXNzIiwic3ZnQ2xvbmVDaXJjbGUiKQoJICAgICAgICAuYXBwZW5kKCJjaXJjbGUiKQoJICAgICAgICAuYXR0cigiY3giLCA1KQoJICAgICAgICAuYXR0cigiY3kiLCA1KQoJICAgICAgICAuYXR0cigiciIsIDQpCgkgICAgICAgIC5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oKSB7CgkgICAgICAgIAlyZXR1cm4gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnRbY2xvbmVfaWRzW2luZGV4KytdXTsKCSAgICAgICAgfSkKCSAgICAgICAgLmF0dHIoInN0cm9rZSIsIGZ1bmN0aW9uKCkgewoJICAgICAgICAJLy8gZmlsbCBoYXBwZW5zIGZpcnN0IGZvciBhbGwgcm93cywgc28gd2UgaGF2ZSB0byByZXNldCB0aGUgaW5kZXggdG8gemVybwoJICAgICAgICAJLy8gYmVmb3JlIHNldHRpbmcgdGhlIHN0cm9rZSBmb3IgYWxsIHJvd3MKCSAgICAgICAgCWlmIChpbmRleCA9PSBjbG9uZV9pZHMubGVuZ3RoKSB7CgkgICAgICAgIAkJaW5kZXggPSAwOwoJICAgICAgICAJfQoJICAgICAgICAJcmV0dXJuIGN1clZpek9iai52aWV3LmNvbG91cl9hc3NpZ25tZW50W2Nsb25lX2lkc1tpbmRleCsrXV07CgkgICAgICAgIH0pOwoJfQoKfQoKLyogZnVuY3Rpb24gdG8gc2hvdyBsYWJlbHMgZm9yIGEgcGFydGljdWxhciBnZW5vdHlwZQoqIEBwYXJhbSB7U3RyaW5nfSBndHlwZSAtLSB0aGUgY3VycmVudCBnZW5vdHlwZSBiZWluZyBtb3VzZWQgb3ZlcgoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciB0aGUgY3VycmVudCB2aWV3CiovCmZ1bmN0aW9uIF9zaG93TGFiZWxzKGd0eXBlLCB2aWV3X2lkKSB7CiAgICB2YXIgY3VyVmlldyA9IGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKTsKCiAgICAvLyB0cmFkaXRpb25hbCB2aWV3CiAgICBpZiAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnRzUGxvdEciKS5jbGFzc2VkKCJ0cmFkaXRpb25hbCIpKSB7IAogICAgCWN1clZpZXcuc2VsZWN0QWxsKCIubGFiZWwuZ3R5cGVfIiArIGd0eXBlKS5hdHRyKCJmaWxsLW9wYWNpdHkiLCAxKQogICAgCQkudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLmxhYmVsX3RleHQ7IH0pOwogICAgCWN1clZpZXcuc2VsZWN0QWxsKCIubGFiZWxDaXJjLmd0eXBlXyIgKyBndHlwZSkuYXR0cigiZmlsbC1vcGFjaXR5IiwgMSk7CiAgICB9CgogICAgLy8gdHJhY2tzIHZpZXcKICAgIGVsc2UgeyAKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLnNlcExhYmVsLmd0eXBlXyIgKyBndHlwZSkuYXR0cigiZmlsbC1vcGFjaXR5IiwgMSkKICAgIAkJLnRleHQoZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5sYWJlbF90ZXh0OyB9KTsKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLnNlcExhYmVsQ2lyYy5ndHlwZV8iICsgZ3R5cGUpLmF0dHIoImZpbGwtb3BhY2l0eSIsIDEpOwogICAgfQp9CgovKiBmdW5jdGlvbiB0byBoaWRlIGxhYmVscyBhbmQgbGFiZWwgY2lyY2xlcwoqIEBwYXJhbSB7U3RyaW5nfSB2aWV3X2lkIC0tIGlkIGZvciBjdXJyZW50IHZpZXcKKi8KZnVuY3Rpb24gX2hpZGVMYWJlbHModmlld19pZCkgewogICAgdmFyIGN1clZpZXcgPSBkMy5zZWxlY3QoIiMiICsgdmlld19pZCk7CgogICAgLy8gdHJhZGl0aW9uYWwgdmlldwogICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi50c1Bsb3RHIikuY2xhc3NlZCgidHJhZGl0aW9uYWwiKSkgeyAKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLmxhYmVsIikuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCkKICAgIAkJLnRleHQoZnVuY3Rpb24oKSB7IHJldHVybiAiIjsgfSk7IC8vIHRleHQgcmVtb3ZlZCBmb3IgcHVycG9zZXMgb2Ygc3ZnIGRvd25sb2FkIChvdGhlcndpc2Ugd2lsbCBzaG93IHVwKQogICAgCWN1clZpZXcuc2VsZWN0QWxsKCIubGFiZWxDaXJjIikuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCk7CiAgICB9CgogICAgLy8gdHJhY2tzIHZpZXcKICAgIGVsc2UgeyAKICAgIAljdXJWaWV3LnNlbGVjdEFsbCgiLnNlcExhYmVsIikuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCkKICAgIAkJLnRleHQoZnVuY3Rpb24oKSB7IHJldHVybiAiIjsgfSk7IC8vIHRleHQgcmVtb3ZlZCBmb3IgcHVycG9zZXMgb2Ygc3ZnIGRvd25sb2FkIChvdGhlcndpc2Ugd2lsbCBzaG93IHVwKQogICAgCWN1clZpZXcuc2VsZWN0QWxsKCIuc2VwTGFiZWxDaXJjIikuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCk7CiAgICB9Cn0KCi8qIGZ1bmN0aW9uIHRvIGhpZ2hsaWdodCB0aW1lcG9pbnQgZ3VpZGUKKi8KZnVuY3Rpb24gX2hsVHBHdWlkZSh2aWV3X2lkLCB0cCkgewoJLy8gdmlldyB0aW1lcG9pbnQgZ3VpZGUKCWQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi50cEd1aWRlLnRwXyIgKyB0cCkKCQkuYXR0cigic3Ryb2tlIiwgImJsYWNrIikKCQkuYXR0cigic3Ryb2tlLW9wYWNpdHkiLCAxKTsKfQoKLyogZnVuY3Rpb24gdG8gaGlkZSB0aW1lcG9pbnQgZ3VpZGVzCiovCmZ1bmN0aW9uIF9oaWRlVHBHdWlkZXModmlld19pZCkgewoJLy8gaGlkZSB0aW1lcG9pbnQgZ3VpZGVzCglkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIudHBHdWlkZSIpCgkJLmF0dHIoInN0cm9rZSIsICJ3aGl0ZSIpCgkJLmF0dHIoInN0cm9rZS1vcGFjaXR5IiwgMC40KTsKCn0K"></script>
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgICBuYW1lOiAnY2VsbHNjYXBlJywKCiAgICB0eXBlOiAnb3V0cHV0JywKCiAgICBpbml0aWFsaXplOiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewoKICAgICAgICB2aXpPYmogPSB7fTsKICAgICAgICB2aXpPYmoud2lkdGggPSB3aWR0aDsKICAgICAgICB2aXpPYmouaGVpZ2h0ID0gaGVpZ2h0OwoKICAgICAgICByZXR1cm4ge30KCiAgICB9LAoKICAgIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKICAgICAgICB2YXIgdmlld19pZCA9IGVsLmlkOwoKICAgICAgICAvLyBkZWZhdWx0cwogICAgICAgIHZhciBkZWZhdWx0cyA9IHsKICAgICAgICAgICAgLy8gdHJlZQogICAgICAgICAgICB0cmVlX3I6IDQsIC8vIHRyZWUgbm9kZSByYWRpdXMKICAgICAgICAgICAgbWluX3RyZWVfcjogMy41LCAvLyBtaW5pbXVtIHRyZWUgbm9kZSByYWRpdXMKICAgICAgICAgICAgbWF4X3RyZWVfcjogNS41LCAvLyBtYXhpbXVtIHRyZWUgbm9kZSByYWRpdXMKICAgICAgICAgICAgdHJlZV93X2xhYmVsc19yOiA3LCAvLyB0cmVlIG5vZGUgcmFkaXVzIHdoZW4gbGFiZWxzIGRpc3BsYXllZCB3aXRoaW4KICAgICAgICAgICAgZGlzdE9uOiBmYWxzZSwgLy8gd2hldGhlciBvciBub3Qgd2UncmUgc2NhbGluZyBieSBlZGdlIGRpc3RhbmNlcwogICAgICAgICAgICB0cmVlT3BhY2l0eTogMSwgLy8gdHJlZSBzdGFydHMgd2l0aCBvcGFjaXR5IDEgCiAgICAgICAgICAgIGdyYXBoT3BhY2l0eTogMCwgLy8gZ3JhcGggc3RhcnRzIHdpdGggb3BhY2l0eSAwCiAgICAgICAgICAgIHBoYW50b21Sb290OiAicGhhbnRvbVJvb3QiLAoKICAgICAgICAgICAgLy8gZ2VuZXJhbCBwYWRkaW5nIChhYm92ZSBtYWluIHZpZXcsIGJldHdlZW4gdmlld3MpCiAgICAgICAgICAgIHBhZGRpbmdHZW5lcmFsOiAxNSwKCiAgICAgICAgICAgIC8vIGFubm90YXRpb25zICYgaW5kaWNhdG9yIHdpZHRoCiAgICAgICAgICAgIGFubm90Q29sV2lkdGg6IDcsIC8vIHdpZHRoIG9mIHRoZSBzZWxlY3RlZCBzaW5nbGUgY2VsbCBpbmRpY2F0b3IgYW5kIGFubm90YXRpb25zIGNvbHVtbnMKCiAgICAgICAgICAgIC8vIHNwYWNlIGJldHdlZW4gYW5ub3RhdGlvbnMgYW5kIGhlYXRtYXAKICAgICAgICAgICAgYW5ub3RIbVNwYWNlOiAzLAoKICAgICAgICAgICAgLy8gY29sb3VycwogICAgICAgICAgICBkZWZhdWx0Tm9kZUNvbG91cjogIiNBM0EzQTMiLAogICAgICAgICAgICBoaWdobGlnaHRDb2xvdXI6ICIjMDAwMDAwIiwKICAgICAgICAgICAgbGlua0hpZ2hsaWdodENvbG91cjogIiMwMDAwMDAiLAogICAgICAgICAgICBkZWZhdWx0TGlua0NvbG91cjogIiNDRUNFQ0UiLAoKICAgICAgICAgICAgLy8gY2hyb21vc29tZSBsZWdlbmQKICAgICAgICAgICAgY2hyb21MZWdlbmRIZWlnaHQ6IDE1LCAvLyBoZWlnaHQgb2YgY2hyb21vc29tZSBsZWdlbmQKCiAgICAgICAgICAgIC8vIGhlYXRtYXAgYW5kIGdlbm90eXBlIGxlZ2VuZHMKICAgICAgICAgICAgaGVhdG1hcExlZ2VuZFdpZHRoOiA2MCwKICAgICAgICAgICAgbGVnZW5kVGl0bGVIZWlnaHQ6IDE1LCAvLyBoZWlnaHQgb2YgbGVnZW5kIHRpdGxlcwogICAgICAgICAgICByZWN0SGVpZ2h0OiAxMiwgLy8gcmVjdGFuZ2xlIGluIGxlZ2VuZAogICAgICAgICAgICByZWN0U3BhY2luZzogMiwgLy8gc3BhY2luZyBiZXR3ZWVuIGxlZ2VuZCByZWN0YW5nbGVzCiAgICAgICAgICAgIGxlZ2VuZEZvbnRIZWlnaHQ6IDEyLAoKICAgICAgICAgICAgLy8gdG9wIGJhcgogICAgICAgICAgICB0b3BCYXJIZWlnaHQ6IDMwLCAvLyBoZWlnaHQgb2YgdG9wIHBhbmVsCiAgICAgICAgICAgIHRvcEJhckNvbG91cjogIiNEOUQ5RDkiLAogICAgICAgICAgICB0b3BCYXJIaWdobGlnaHQ6ICIjQzZDNkM2IiwKCiAgICAgICAgICAgIC8vIHN3aXRjaCBiZXR3ZWVuIGdyYXBoL3RyZWUKICAgICAgICAgICAgc3dpdGNoVmlldzogdHJ1ZSwKCiAgICAgICAgICAgIC8vIHRpdGxlCiAgICAgICAgICAgIHZpZXdUaXRsZTogIkNFTExTQ0FQRSIKICAgICAgICB9OwoKICAgICAgICAvLyBnbG9iYWwgdmFyaWFibGUgY3VyVml6T2JqCiAgICAgICAgY3VyVml6T2JqID0ge307CiAgICAgICAgY3VyVml6T2JqLmRhdGEgPSB7fTsKICAgICAgICBjdXJWaXpPYmoudmlldyA9IHt9OwogICAgICAgIGN1clZpek9iai52aWV3X2lkID0gdmlld19pZDsKCiAgICAgICAgY29uc29sZS5sb2coImN1clZpek9iaiIpCiAgICAgICAgY29uc29sZS5sb2coY3VyVml6T2JqKQogICAgICAgIC8vIGdldCBwYXJhbXMgZnJvbSBSCiAgICAgICAgY3VyVml6T2JqLnVzZXJDb25maWcgPSB4OwogICAgICAgIGN1clZpek9iai52aWV3Lmd0eXBlc1NwZWNpZmllZCA9IChjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdF9wcm92aWRlZCk7IC8vIChUL0YpIGdlbm90eXBlIGFubm90YXRpb24gaXMgc3BlY2lmaWVkCiAgICAgICAgY3VyVml6T2JqLnZpZXcudHBzU3BlY2lmaWVkID0gLy8gKFQvRikgdGltZXBvaW50IGFubm90YXRpb24gaXMgc3BlY2lmaWVkCiAgICAgICAgICAgIChjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdF9wcm92aWRlZCkgPyBjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdFswXVsidGltZXBvaW50Il0gOiBmYWxzZTsKCiAgICAgICAgLy8gc2VsZWN0ZWQgc2luZ2xlIGNlbGxzIGxpc3QgJiBzZWxlY3RlZCBsaW5rcyBsaXN0CiAgICAgICAgY3VyVml6T2JqLnZpZXcuc2VsZWN0ZWRTQ3MgPSBbXTsKICAgICAgICBjdXJWaXpPYmoudmlldy5zZWxlY3RlZExpbmtzID0gW107CgogICAgICAgIC8vIG1vcmUgY29uZmlndXJhdGlvbnMKICAgICAgICBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZyA9ICQuZXh0ZW5kKHRydWUsIHt9LCBkZWZhdWx0cyk7CiAgICAgICAgdmFyIGNvbmZpZyA9IGN1clZpek9iai5nZW5lcmFsQ29uZmlnOwoKICAgICAgICAvLyB3aWR0aCBhbmQgaGVpZ2h0IG9mIHZpZXcKICAgICAgICBjb25maWcud2lkdGggPSB2aXpPYmoud2lkdGggLSAxNTsgICAgCiAgICAgICAgY29uZmlnLmNlbGxzY2FwZVZpZXdIZWlnaHQ7CiAgICAgICAgLy8gdXNlciB3YW50cyB0aW1lc2NhcGUgCiAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLnRpbWVzY2FwZV93YW50ZWQpIHsKICAgICAgICAgICAgY29uZmlnLmNlbGxzY2FwZVZpZXdIZWlnaHQgPSAodml6T2JqLmhlaWdodCkgKiAyLzM7CiAgICAgICAgICAgIGNvbmZpZy50c1ZpZXdIZWlnaHQgPSAodml6T2JqLmhlaWdodCkgKiAxLzM7CiAgICAgICAgfSAKICAgICAgICAvLyB1c2VyIG9ubHkgd2FudHMgY2VsbHNjYXBlCiAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIGNvbmZpZy5jZWxsc2NhcGVWaWV3SGVpZ2h0ID0gKHZpek9iai5oZWlnaHQpOwogICAgICAgIH0KCiAgICAgICAgLy8gdmlldyBjb250YWluZXIgY29uZmlndXJhdGlvbnMKICAgICAgICBjb25maWcuY29udGFpbmVySGVpZ2h0ID0gY29uZmlnLmNlbGxzY2FwZVZpZXdIZWlnaHQgLSBjb25maWcudG9wQmFySGVpZ2h0OwogICAgICAgIGNvbmZpZy5jb250YWluZXJXaWR0aCA9IGNvbmZpZy53aWR0aDsKCiAgICAgICAgLy8gdmVydGljYWwgc3BhY2luZyByZXF1aXJlZCBmb3IgdGhlIHRpdGxlIG9mIHRoZSBoZWF0bWFwL3RyZWUsIGFuZCB0aGUgc3BhY2UgYmVsb3cgaXQKICAgICAgICBjb25maWcuc3BhY2luZ0ZvclRpdGxlID0gY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKjI7CgogICAgICAgIC8vIGhlYXRtYXAgY29uZmlndXJhdGlvbnMKICAgICAgICBjb25maWcuaG1IZWlnaHQgPSBjb25maWcuY2VsbHNjYXBlVmlld0hlaWdodCAtIGNvbmZpZy50b3BCYXJIZWlnaHQgLSBjb25maWcucGFkZGluZ0dlbmVyYWwqMiAtIGNvbmZpZy5zcGFjaW5nRm9yVGl0bGU7CgogICAgICAgIC8vIHRyZWUgY29uZmlndXJhdGlvbnMKICAgICAgICBjb25maWcudHJlZUhlaWdodCA9IGNvbmZpZy5jZWxsc2NhcGVWaWV3SGVpZ2h0IC0gY29uZmlnLnRvcEJhckhlaWdodCAtIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCoyIC0gY29uZmlnLnNwYWNpbmdGb3JUaXRsZTsKCiAgICAgICAgLy8gaGVhdG1hcCBsZWdlbmQgc3RhcnQKICAgICAgICBjb25maWcuaGVhdG1hcExlZ2VuZFN0YXJ0WSA9IDEgKyBjb25maWcucGFkZGluZ0dlbmVyYWw7IC8vIHN0YXJ0aW5nIHktcGl4ZWwgZm9yIGhlYXRtYXAgbGVnZW5kCgogICAgICAgIC8vIFVQREFURSBHRU5FUkFMIFBBUkFNUywgR0lWRU4gVVNFUiBQQVJBTVMKCiAgICAgICAgLy8gZXh0ZW5kIGhlYXRtYXBMZWdlbmRXaWR0aCBpZiB0aW1lc2NhcGUgcHJlc2VudAogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy50aW1lc2NhcGVfd2FudGVkKSB7CiAgICAgICAgICAgIGNvbmZpZy5oZWF0bWFwTGVnZW5kV2lkdGggPSAxMTA7CiAgICAgICAgfQoKICAgICAgICAvLyB0cmVlIGNvbmZpZ3VyYXRpb25zCiAgICAgICAgY29uZmlnLnRyZWVXaWR0aCA9IGNvbmZpZy53aWR0aCAtIGNvbmZpZy5hbm5vdENvbFdpZHRoIC0gY29uZmlnLmhlYXRtYXBMZWdlbmRXaWR0aCAtIGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBXaWR0aCAtIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCoyOwoKICAgICAgICAvLyBpZiBnZW5vdHlwZSBhbm5vdGF0aW9uIHNwZWNpZmllZCwgcmVkdWNlIHRoZSB3aWR0aCBvZiB0aGUgdHJlZQogICAgICAgIGlmIChjdXJWaXpPYmoudmlldy5ndHlwZXNTcGVjaWZpZWQpIHsKICAgICAgICAgICAgY29uZmlnLnRyZWVXaWR0aCAtPSAoY29uZmlnLmFubm90Q29sV2lkdGggKyBjb25maWcuYW5ub3RIbVNwYWNlKTsgCiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGUgdGltZXBvaW50IGFubm90YXRpb24gaXMgc3BlY2lmaWVkLCByZWR1Y2UgdGhlIHdpZHRoIG9mIHRoZSB0cmVlIGZ1cnRoZXIKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcudHBzU3BlY2lmaWVkKSB7CiAgICAgICAgICAgIGNvbmZpZy50cmVlV2lkdGggLT0gY29uZmlnLmFubm90Q29sV2lkdGg7CiAgICAgICAgfQoKICAgICAgICAvLyBpZiB0aGUgdHlwZSBvZiBkYXRhIGlzIGNudiwgcmVkdWNlIHRyZWUgaGVpZ2h0IHRvIGFjY291bnQgZm9yIGNocm9tb3NvbWUgbGVnZW5kCiAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBfdHlwZSA9PSAiY252IikgewogICAgICAgICAgICBjb25maWcudHJlZUhlaWdodCAtPSBjb25maWcuY2hyb21MZWdlbmRIZWlnaHQ7CiAgICAgICAgfQoKICAgICAgICAvLyBzbWFsbGVzdCB0cmVlIGRpbWVuc2lvbiBvbiB0aGUgdmlldyAod2lkdGggb3IgaGVpZ2h0KQogICAgICAgIGNvbmZpZy5zbWFsbGVzdF90cmVlX2RpbSA9IChjb25maWcudHJlZVdpZHRoIDwgY29uZmlnLnRyZWVIZWlnaHQpID8gY29uZmlnLnRyZWVXaWR0aCA6IGNvbmZpZy50cmVlSGVpZ2h0OwoKICAgICAgICAvLyBHRVQgVFJFRSBDT05URU5UCgogICAgICAgIC8vIGdldCBnZW5vdHlwZSB0cmVlIHN0cnVjdHVyZQogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5ndHlwZV90cmVlX2VkZ2VzKSB7CiAgICAgICAgICAgIC8vIGdlbm90eXBlIHRyZWUgZWRnZXMgZnJvbSB1c2VyCiAgICAgICAgICAgIHZhciBndHlwZV90cmVlX2VkZ2VzID0gJC5leHRlbmQoW10sIGN1clZpek9iai51c2VyQ29uZmlnLmd0eXBlX3RyZWVfZWRnZXMpOwoKICAgICAgICAgICAgLy8gZmluZCB0cmVlIHJvb3QKICAgICAgICAgICAgdmFyIGN1cl9zb3VyY2UgPSBndHlwZV90cmVlX2VkZ2VzWzBdLnNvdXJjZTsKICAgICAgICAgICAgdmFyIHNvdXJjZV9hc190YXJnZXQgPSAvLyBlZGdlIHdoZXJlIHRoZSBjdXJyZW50IHNvdXJjZSBpcyB0aGUgdGFyZ2V0CiAgICAgICAgICAgICAgICBfLmZpbmRXaGVyZShndHlwZV90cmVlX2VkZ2VzLCB7InRhcmdldCI6IGN1cl9zb3VyY2V9KTsgCiAgICAgICAgICAgIHdoaWxlIChzb3VyY2VfYXNfdGFyZ2V0KSB7IC8vIGl0ZXJhdGUgYXMgbG9uZyBhcyB0aGVyZSBhcmUgZWRnZXMgd2l0aCB0aGUgY3VycmVudCBzb3VyY2UgYXMgdGhlIHRhcmdldAogICAgICAgICAgICAgICAgY3VyX3NvdXJjZSA9IHNvdXJjZV9hc190YXJnZXQuc291cmNlOwogICAgICAgICAgICAgICAgc291cmNlX2FzX3RhcmdldCA9IF8uZmluZFdoZXJlKGd0eXBlX3RyZWVfZWRnZXMsIHsidGFyZ2V0IjogY3VyX3NvdXJjZX0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciByb290TmFtZSA9IGN1cl9zb3VyY2U7CgogICAgICAgICAgICAvLyBhZGQgdGhlIHBoYW50b21Sb290IHRvIHRoZSB0cmVlIGVkZ2VzIGFycmF5CiAgICAgICAgICAgIGd0eXBlX3RyZWVfZWRnZXMucHVzaCh7CiAgICAgICAgICAgICAgICAic291cmNlIjogY3VyVml6T2JqLmdlbmVyYWxDb25maWcucGhhbnRvbVJvb3QsCiAgICAgICAgICAgICAgICAidGFyZ2V0Ijogcm9vdE5hbWUKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgIC8vIGdldCB0cmVlIHN0cnVjdHVyZQogICAgICAgICAgICB2YXIgcm9vdGVkVHJlZXMgPSBbXTsgLy8gYXJyYXkgb2YgdHJlZXMgcm9vdGVkIGF0IGVhY2ggbm9kZSAKICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBndHlwZV90cmVlX2VkZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gX2d0X2ZpbmRUcmVlQnlSb290KHJvb3RlZFRyZWVzLCBndHlwZV90cmVlX2VkZ2VzW2ldLnNvdXJjZSk7CiAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBfZ3RfZmluZFRyZWVCeVJvb3Qocm9vdGVkVHJlZXMsIGd0eXBlX3RyZWVfZWRnZXNbaV0udGFyZ2V0KTsKICAgICAgICAgICAgICAgIHBhcmVudFsiY2hpbGRyZW4iXS5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgcm9vdF90cmVlID0gX2d0X2ZpbmRUcmVlQnlSb290KHJvb3RlZFRyZWVzLCBjdXJWaXpPYmouZ2VuZXJhbENvbmZpZy5waGFudG9tUm9vdCk7IC8vIHBoYW50b20gcm9vdCB0cmVlCiAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmd0eXBlVHJlZVN0cnVjdHVyZSA9IHJvb3RfdHJlZTsgCiAgICAgICAgfQoKICAgICAgICAvLyBnZXQgdHJlZSBzdHJ1Y3R1cmVzIGZvciBlYWNoIG5vZGUKICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlcyA9IF9nZXRUcmVlU3RydWN0dXJlcyhjdXJWaXpPYmoudXNlckNvbmZpZy5zY190cmVlX2VkZ2VzKTsKICAgICAgICAKICAgICAgICAvLyB0aGUgcm9vdCB0cmVlIHN0cnVjdHVyZQogICAgICAgIGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmUgPSBfLmZpbmRXaGVyZShjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlcywge3NjX2lkOiBjdXJWaXpPYmoudXNlckNvbmZpZy5yb290fSk7CgogICAgICAgIC8vIGdldCBkZXNjZW5kYW50cyBmb3IgZWFjaCBub2RlCiAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyID0ge307CiAgICAgICAgY3VyVml6T2JqLnVzZXJDb25maWcuc2NfdHJlZV9ub2Rlcy5mb3JFYWNoKGZ1bmN0aW9uKG5vZGUsIGlkeCkgewogICAgICAgICAgICB2YXIgY3VyUm9vdCA9IF8uZmluZFdoZXJlKGN1clZpek9iai5kYXRhLnRyZWVTdHJ1Y3R1cmVzLCB7c2NfaWQ6IG5vZGUuc2NfaWR9KTsKICAgICAgICAgICAgdmFyIGN1ckRlc2NlbmRhbnRzID0gX2dldERlc2NlbmRhbnRJZHMoY3VyUm9vdCwgW10pOwogICAgICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlRGVzY2VuZGFudHNBcnJbbm9kZS5zY19pZF0gPSBjdXJEZXNjZW5kYW50czsKICAgICAgICB9KQoKICAgICAgICAvLyBnZXQgZGlyZWN0IGRlc2NlbmRhbnRzIGZvciBlYWNoIG5vZGUKICAgICAgICBjdXJWaXpPYmouZGF0YS5kaXJlY3RfZGVzY2VuZGFudHMgPSBfZ2V0RGlyZWN0RGVzY2VuZGFudHMoY3VyVml6T2JqLmRhdGEudHJlZVN0cnVjdHVyZSwge30pOwoKICAgICAgICAvLyBnZXQgYW5jZXN0b3JzIGZvciBlYWNoIG5vZGUKICAgICAgICBjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyID0gX2dldEFuY2VzdG9ySWRzKGN1clZpek9iaik7CgogICAgICAgIC8vIGdldCBkaXJlY3QgYW5jZXN0b3JzIGZvciBlYWNoIG5kb2UKICAgICAgICBjdXJWaXpPYmouZGF0YS5kaXJlY3RfYW5jZXN0b3JzID0gX2dldERpcmVjdEFuY2VzdG9ycyhjdXJWaXpPYmouZGF0YS50cmVlU3RydWN0dXJlLCB7fSk7CgogICAgICAgIC8vIGdldCBub2RlcyBtaXNzaW5nIGhlYXRtYXAgZGF0YSB0aGF0IHdlIHNob3VsZCBzdGlsbCBwbG90IChhbmQgbm90ZSB0aG9zZSB0aGF0IHdlIHNob3VsZG4ndCkKICAgICAgICBfaGFuZGxlTWlzc2luZ1NjcyhjdXJWaXpPYmopOwoKICAgICAgICAvLyBnZXQgbGluZWFyIGNoYWlucyBpbiBnZW5vdHlwZSB0cmVlIAogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5ndHlwZV90cmVlX2VkZ2VzKSB7CiAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmd0eXBlVHJlZUNoYWluUm9vdHMgPSBbXTsgLy8ga2VlcCB0cmFjayBvZiBsaW5lYXIgY2hhaW4gc2VnbWVudCByb290cwogICAgICAgICAgICBjdXJWaXpPYmouZGF0YS5ndHlwZVRyZWVDaGFpbnMgPSBfZ3RfZ2V0TGluZWFyVHJlZVNlZ21lbnRzKGN1clZpek9iaiwgY3VyVml6T2JqLmRhdGEuZ3R5cGVUcmVlU3RydWN0dXJlLCB7fSwgIiIpOwogICAgICAgIH0KCiAgICAgICAgLy8gZ2V0IHRoZSBoZWlnaHQgb2YgdGhlIHRyZWUgKCMgbm9kZXMpCiAgICAgICAgY3VyVml6T2JqLmRhdGEudHJlZV9oZWlnaHQgPSAwOwogICAgICAgIE9iamVjdC5rZXlzKGN1clZpek9iai5kYXRhLnRyZWVBbmNlc3RvcnNBcnIpLmZvckVhY2goZnVuY3Rpb24oa2V5KSB7CiAgICAgICAgICAgIHZhciBhbmNlc3Rvcl9hcnIgPSBjdXJWaXpPYmouZGF0YS50cmVlQW5jZXN0b3JzQXJyW2tleV07CiAgICAgICAgICAgIGlmICgoYW5jZXN0b3JfYXJyLmxlbmd0aCArIDEpID4gY3VyVml6T2JqLmRhdGEudHJlZV9oZWlnaHQpIHsKICAgICAgICAgICAgICAgIGN1clZpek9iai5kYXRhLnRyZWVfaGVpZ2h0ID0gKGFuY2VzdG9yX2Fyci5sZW5ndGggKyAxKTsKICAgICAgICAgICAgfQogICAgICAgIH0pCgogICAgICAgIC8vIGdldCB0aGUgY3VtdWxhdGl2ZSBkaXN0YW5jZXMgdG8gZWFjaCBub2RlICYgdGhlIG1heGltdW0gY3VtdWxhdGl2ZSBwYXRoIGRpc3RhbmNlCiAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLmRpc3RhbmNlc19wcm92aWRlZCkgewogICAgICAgICAgICBfZ2V0RGlzdFRvTm9kZXMoY3VyVml6T2JqLCBjdXJWaXpPYmoudXNlckNvbmZpZy5yb290LCAwKTsgCiAgICAgICAgfQoKICAgICAgICAvLyBvcmRlciBzaW5nbGUgY2VsbHMgYnkgdHJlZQogICAgICAgIGN1clZpek9iai5kYXRhLmhtX3NjX2lkcyA9IF9nZXROb2RlT3JkZXIoY3VyVml6T2JqLmRhdGEudHJlZURlc2NlbmRhbnRzQXJyLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai51c2VyQ29uZmlnLmxpbmtfaWRzLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai51c2VyQ29uZmlnLnJvb3QsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW10pOwoKICAgICAgICAvLyBmb3IgcGxvdHRpbmcgdGhlIGhlYXRtYXAsIHJlbW92ZSBzaW5nbGUgY2VsbCBpZHMgdGhhdCBhcmUgaW4gdGhlIHRyZWUgYnV0IG5vdCB0aGUgaGVhdG1hcAogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY3VyVml6T2JqLnVzZXJDb25maWcuc2NzX21pc3NpbmdfZnJvbV9obS5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB2YXIgY3VyX3NjX21pc3NpbmcgPSBjdXJWaXpPYmoudXNlckNvbmZpZy5zY3NfbWlzc2luZ19mcm9tX2htW2ldOwogICAgICAgICAgICB2YXIgaW5kZXggPSBjdXJWaXpPYmouZGF0YS5obV9zY19pZHMuaW5kZXhPZihjdXJfc2NfbWlzc2luZyk7CiAgICAgICAgICAgIGN1clZpek9iai5kYXRhLmhtX3NjX2lkcy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICAgIH0KCiAgICAgICAgLy8ga2VlcCB0cmFjayBvZiBvcmlnaW5hbCBsaXN0IG9mIHNjcywgZm9yIHRyZWUgcHJ1bmluZyBwdXJwb3NlcwogICAgICAgIGN1clZpek9iai52aWV3Lm9yaWdpbmFsX3NjX2xpc3QgPSAkLmV4dGVuZChbXSwgY3VyVml6T2JqLmRhdGEuaG1fc2NfaWRzKTsKCiAgICAgICAgLy8gR0VUIENOViBDT05URU5UCgogICAgICAgIC8vIGNudiBwbG90IG51bWJlciBvZiByb3dzCiAgICAgICAgY3VyVml6T2JqLnZpZXcuaG0gPSB7fTsKICAgICAgICBjdXJWaXpPYmoudmlldy5obS5ucm93cyA9IGN1clZpek9iai5kYXRhLmhtX3NjX2lkcy5sZW5ndGg7CgogICAgICAgIC8vIGhlaWdodCBvZiBlYWNoIGNudiByb3cKICAgICAgICBjdXJWaXpPYmoudmlldy5obS5yb3dIZWlnaHQgPSAoMS9jdXJWaXpPYmoudmlldy5obS5ucm93cykqKGNvbmZpZy5obUhlaWdodC1jb25maWcuY2hyb21MZWdlbmRIZWlnaHQpOwoKICAgICAgICAvLyBnZXQgZ2Vub3R5cGUgYW5ub3RhdGlvbiBpbmZvIGFzIG9iamVjdCB3L3Byb3BlcnR5ICJnZW5vdHlwZSIgOiBbYXJyYXkgb2Ygc2luZ2xlIGNlbGxzXQogICAgICAgIGlmIChjdXJWaXpPYmoudmlldy5ndHlwZXNTcGVjaWZpZWQpIHsKICAgICAgICAgICAgX3JlZm9ybWF0R3JvdXBBbm5vdHMoY3VyVml6T2JqKTsKICAgICAgICB9CgogICAgICAgIC8vIEFESlVTVCBUUkVFIE5PREUgUkFESVVTIEJBU0VEIE9OIFJPVyBIRUlHSFQgCgogICAgICAgIGNvbmZpZy50cmVlX3IgPSAoY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0LzIgPCBjb25maWcubWluX3RyZWVfcikgPyAKICAgICAgICAgICAgY29uZmlnLm1pbl90cmVlX3IgOiBjdXJWaXpPYmoudmlldy5obS5yb3dIZWlnaHQvMjsKICAgICAgICBjb25maWcudHJlZV9yID0gKGNvbmZpZy50cmVlX3IgPiBjb25maWcubWF4X3RyZWVfcikgPyBjb25maWcubWF4X3RyZWVfciA6IGNvbmZpZy50cmVlX3I7CgogICAgICAgIC8vIEdFVCBYLSBhbmQgWS1DT09SRElOQVRFIEZPUiBFQUNIIFNJTkdMRSBDRUxMCgogICAgICAgIF9nZXRZQ29vcmRpbmF0ZXMoY3VyVml6T2JqKTsKICAgICAgICBfZ2V0WENvb3JkaW5hdGVzKGN1clZpek9iaik7CgogICAgICAgIC8vIHN0b3JlIG9yaWdpbmFsIHkgY29vcmRpbmF0ZXMsIGZvciB0cmVlIHBydW5pbmcgcHVycG9zZXMKICAgICAgICBjdXJWaXpPYmouZGF0YS5vcmlnaW5hbFlDb29yZGluYXRlcyA9ICQuZXh0ZW5kKHt9LCBjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXMpOwoKICAgICAgICBjb25zb2xlLmxvZygiY252IGN1clZpek9iaiIpOwogICAgICAgIGNvbnNvbGUubG9nKGN1clZpek9iaik7CgogICAgICAgIC8vIENPTE9VUlMKCiAgICAgICAgLy8gQ05WIGNvbG91ciBzY2FsZQogICAgICAgIHZhciBtYXhDTlYgPSA2OwogICAgICAgIHZhciBjbnZDb2xvclNjYWxlOwogICAgICAgIHZhciBkaXNjcmV0ZV9jb2xvdXJzID0gWyIjNDE3RUFBIiwgIiNENkQ1RDUiLCAiI0M2M0M0QyJdOwogICAgICAgIHZhciB0YXJnZXRlZF9jb2xvdXJzID0gWyIjNmE5MGMzIiwgIiNmZmZmYmYiLCAiI2RmNTk1MiJdOwogICAgICAgIC8vIGNvbnRpbnVvdXMgZGF0YQogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5jb250aW51b3VzX2NudikgewogICAgICAgICAgICBjbnZDb2xvclNjYWxlID0gZDMuc2NhbGUubGluZWFyKCkgIAogICAgICAgICAgICAgICAgLmRvbWFpbihbMCwgMiwgbWF4Q05WXSkgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAucmFuZ2UoZGlzY3JldGVfY29sb3VycykKICAgICAgICB9CiAgICAgICAgLy8gZGlzY3JldGUgZGF0YQogICAgICAgIGVsc2UgewogICAgICAgICAgICBjbnZDb2xvclNjYWxlID0gZDMuc2NhbGUub3JkaW5hbCgpIAogICAgICAgICAgICAgICAgLmRvbWFpbihbMCwxLDIsMyw0LDUsNl0pCiAgICAgICAgICAgICAgICAucmFuZ2UoWyIjMmU3YWFiIiwgIiM3M2E5ZDQiLCAiI0Q2RDVENSIsICIjZmVjMjhiIiwgIiNmZDhiM2EiLCAiI2NhNjMyYyIsICIjOTU0YzI1Il0pOwogICAgICAgIH0KCiAgICAgICAgLy8gdGFyZ2V0ZWQgbXV0YXRpb24gY29sb3VyIHNjYWxlCiAgICAgICAgdmFyIHRhcmdldGVkQ29sb3JTY2FsZSA9IGQzLnNjYWxlLmxpbmVhcigpICAKICAgICAgICAgICAgLmRvbWFpbihbMCwgMC41LCAxXSkgICAgICAgICAgICAgCiAgICAgICAgICAgIC5yYW5nZSh0YXJnZXRlZF9jb2xvdXJzKQoKICAgICAgICAvLyBnZW5vdHlwZSBhbm5vdGF0aW9uIGNvbG91cnMKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkKSB7CgogICAgICAgICAgICAvLyBib3RoIGFscGhhIGFuZCByZWd1bGFyIGNvbG91ciBhc3NpZ25tZW50cwogICAgICAgICAgICAvLyBpZiB0aGUgZ2Vub3R5cGUgdHJlZSBpcyBwcm92aWRlZCwgY29sb3VyIG5vZGVzIGJ5IGl0cyBwaHlsb2dlbnkKICAgICAgICAgICAgdmFyIGNvbG91cl9hc3NpZ25tZW50czsKICAgICAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLmd0eXBlX3RyZWVfZWRnZXMpIHsKICAgICAgICAgICAgICAgIGNvbG91cl9hc3NpZ25tZW50cyA9IF9nZXRQaHlsb0NvbG91cnMoY3VyVml6T2JqKTsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyBnZW5vdHlwZSB0cmVlIG5vdCBwcm92aWRlZCAtIHJhbmRvbSBjb2xvdXJzCiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgY29sb3VyX2Fzc2lnbm1lbnRzID0gX2dldEd0eXBlQ29sb3VycyhfLnVuaXEoXy5wbHVjayhjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCwgImdlbm90eXBlIikpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1clZpek9iai51c2VyQ29uZmlnLmNsb25lX2NvbHMpOyAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXJWaXpPYmoudmlldy5jb2xvdXJfYXNzaWdubWVudCA9IGNvbG91cl9hc3NpZ25tZW50cy5jb2xvdXJfYXNzaWdubWVudDsKICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQgPSBjb2xvdXJfYXNzaWdubWVudHMuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnQ7CiAgICAgICAgfQoKICAgICAgICAvLyB0aW1lcG9pbnQgYW5ub3RhdGlvbiBjb2xvdXJzCiAgICAgICAgaWYgKGN1clZpek9iai52aWV3Lmd0eXBlc1NwZWNpZmllZCkgewoKICAgICAgICAgICAgLy8gc29ydGVkIHRpbWVwb2ludHMKICAgICAgICAgICAgY3VyVml6T2JqLmRhdGEudHBzID0gXy51bmlxKF8ucGx1Y2soY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsICJ0aW1lcG9pbnQiKSkuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciByZWdleCA9IC8oXlthLXpBLVpdKikoXGQqKSQvOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaEEgPSByZWdleC5leGVjKGEpOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaEIgPSByZWdleC5leGVjKGIpOyAKCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG1hdGNoQVsxXSA9PT0gbWF0Y2hCWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hdGNoQVsyXSA+IG1hdGNoQlsyXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hBWzFdID4gbWF0Y2hCWzFdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICBjdXJWaXpPYmoudmlldy50cF9jb2xvdXJTY2FsZSA9IGQzLnNjYWxlLm9yZGluYWwoKQogICAgICAgICAgICAgICAgLmRvbWFpbihjdXJWaXpPYmouZGF0YS50cHMpCiAgICAgICAgICAgICAgICAucmFuZ2UoY29sb3JicmV3ZXJbIkdyZXlzIl1bY3VyVml6T2JqLmRhdGEudHBzLmxlbmd0aF0pOwogICAgICAgIH0KCiAgICAgICAgLy8gQlJVU0ggU0VMRUNUSU9OIEZVTkNUSU9OCgogICAgICAgIHZhciBzcGFjZUJldHdlZW5Ub3BCYXJBbmRWaWV3ID0gY29uZmlnLnBhZGRpbmdHZW5lcmFsICsgY29uZmlnLnNwYWNpbmdGb3JUaXRsZTsKICAgICAgICB2YXIgYnJ1c2ggPSBkMy5zdmcuYnJ1c2goKQogICAgICAgICAgICAueShkMy5zY2FsZS5saW5lYXIoKQogICAgICAgICAgICAgICAgLmRvbWFpbihbc3BhY2VCZXR3ZWVuVG9wQmFyQW5kVmlldywgY29uZmlnLmhtSGVpZ2h0ICsgc3BhY2VCZXR3ZWVuVG9wQmFyQW5kVmlld10pCiAgICAgICAgICAgICAgICAucmFuZ2UoW3NwYWNlQmV0d2VlblRvcEJhckFuZFZpZXcsIGNvbmZpZy5obUhlaWdodCArIHNwYWNlQmV0d2VlblRvcEJhckFuZFZpZXddKQogICAgICAgICAgICApCiAgICAgICAgICAgIC5vbigiYnJ1c2hzdGFydCIsIGZ1bmN0aW9uKCkgeyBkMy5zZWxlY3QoIi5jbnZTVkciKS5jbGFzc2VkKCJicnVzaGVkIiwgdHJ1ZSk7IH0pCiAgICAgICAgICAgIC5vbigiYnJ1c2hlbmQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBfYnJ1c2hFbmQoY3VyVml6T2JqLCBicnVzaCk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAvLyBDQU5WQVMgZm9yIFBORyBvdXRwdXQKICAgICAgICAKICAgICAgICB2YXIgY2FudmFzID0gZDMuc2VsZWN0KGVsKS5hcHBlbmQoImNhbnZhcyIpCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBjb25maWcuaG1IZWlnaHQgKyAicHgiKQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBjb25maWcud2lkdGggKyAicHgiKQogICAgICAgICAgICAuYXR0cigic3R5bGUiLCAiZGlzcGxheTpub25lIik7CgogICAgICAgIC8vIFRPUCBCQVIgRElWCgogICAgICAgIHZhciB0b3BCYXJESVYgPSBkMy5zZWxlY3QoZWwpLmFwcGVuZCgiZGl2IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgInRvcEJhckRJViIpCiAgICAgICAgICAgIC5zdHlsZSgicG9zaXRpb24iLCAicmVsYXRpdmUiKQogICAgICAgICAgICAuc3R5bGUoIndpZHRoIiwgY29uZmlnLndpZHRoICsgInB4IikKICAgICAgICAgICAgLnN0eWxlKCJoZWlnaHQiLCBjb25maWcudG9wQmFySGVpZ2h0ICsgInB4IikKICAgICAgICAgICAgLnN0eWxlKCJmbG9hdCIsICJsZWZ0Iik7CgogICAgICAgIC8vIENPTlRBSU5FUiBESVYgYW5kIFNWRwoKICAgICAgICB2YXIgY29udGFpbmVyRElWID0gZDMuc2VsZWN0KGVsKQogICAgICAgICAgICAuYXBwZW5kKCJkaXYiKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiY29udGFpbmVyRElWIikKICAgICAgICAgICAgLnN0eWxlKCJ3aWR0aCIsIGNvbmZpZy53aWR0aCArICJweCIpCiAgICAgICAgICAgIC5zdHlsZSgiaGVpZ2h0IiwgY29uZmlnLmNvbnRhaW5lckhlaWdodCArICJweCIpCiAgICAgICAgICAgIC5zdHlsZSgiZmxvYXQiLCAibGVmdCIpCiAgICAgICAgICAgIC5hdHRyKCJpZCIsIHZpZXdfaWQpOwoKICAgICAgICB2YXIgY29udGFpbmVyU1ZHID0gY29udGFpbmVyRElWCiAgICAgICAgICAgIC5hcHBlbmQoInN2ZzpzdmciKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiY29udGFpbmVyU1ZHXyIgKyB2aWV3X2lkKQogICAgICAgICAgICAuYXR0cigieCIsIDApCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgMCkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLmNvbnRhaW5lcldpZHRoKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLmNvbnRhaW5lckhlaWdodCk7CgogICAgICAgIC8vIFRSRUUgU1ZHCgogICAgICAgIGN1clZpek9iai52aWV3LnRyZWVTVkcgPSBjb250YWluZXJTVkcuYXBwZW5kKCJnIikgIAogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAidHJlZVNWRyIpICAgICAKICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIiArIDAgKyAiLCIgKyAwICsgIikiKTsKCiAgICAgICAgLy8gSU5ESUNBVE9SIFNWRwoKICAgICAgICBjdXJWaXpPYmoudmlldy5pbmRpY2F0b3JTVkcgPSBjb250YWluZXJTVkcuYXBwZW5kKCJnIikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgImluZGljYXRvclNWRyIpCiAgICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIgKyAoY29uZmlnLnRyZWVXaWR0aCArIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCkgKyAiLCIgKyAwICsgIikiKTsKCiAgICAgICAgLy8gR1JPVVAgQU5OT1RBVElPTiBTVkcKCiAgICAgICAgaWYgKGN1clZpek9iai52aWV3Lmd0eXBlc1NwZWNpZmllZCkgewogICAgICAgICAgICBjdXJWaXpPYmoudmlldy5ndHlwZUFubm90U1ZHID0gY29udGFpbmVyU1ZHLmFwcGVuZCgiZyIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiZ3R5cGVBbm5vdFNWRyIpCiAgICAgICAgICAgICAgICAuYXR0cigidHJhbnNmb3JtIiwgInRyYW5zbGF0ZSgiICsgKGNvbmZpZy50cmVlV2lkdGggKyBjb25maWcucGFkZGluZ0dlbmVyYWwgKyBjb25maWcuYW5ub3RDb2xXaWR0aCkgKyAiLCIgKyAwICsgIikiKTsKICAgICAgICB9CgogICAgICAgIC8vIFRJTUUgUE9JTlQgQU5OT1RBVElPTiBTVkcKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcudHBzU3BlY2lmaWVkKSB7CiAgICAgICAgICAgIGN1clZpek9iai52aWV3LnRwQW5ub3RTVkcgPSBjb250YWluZXJTVkcuYXBwZW5kKCJnIikKICAgICAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJ0cEFubm90U1ZHIikKICAgICAgICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIgKyAoY29uZmlnLnRyZWVXaWR0aCArIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5hbm5vdENvbFdpZHRoKjIpICsgIiwiICsgMCArICIpIik7CiAgICAgICAgfQoKICAgICAgICAvLyBDTlYgU1ZHCgogICAgICAgIC8vIHggdHJhbnNmb3JtYXRpb24gZm9yIGhlYXRtYXAKICAgICAgICB2YXIgaG1fdF94OyAKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkICYmIGN1clZpek9iai52aWV3LnRwc1NwZWNpZmllZCkgeyAvLyBndHlwZSBhbmQgdHAgYW5ub3RzCiAgICAgICAgICAgIGhtX3RfeCA9IChjb25maWcudHJlZVdpZHRoICsgY29uZmlnLnBhZGRpbmdHZW5lcmFsICsgY29uZmlnLmFubm90Q29sV2lkdGgqMyArIGNvbmZpZy5hbm5vdEhtU3BhY2UpOwogICAgICAgIH0KICAgICAgICBlbHNlIGlmIChjdXJWaXpPYmoudmlldy5ndHlwZXNTcGVjaWZpZWQpIHsgLy8gZ3R5cGUgYW5ub3Qgb25seQogICAgICAgICAgICBobV90X3ggPSAoY29uZmlnLnRyZWVXaWR0aCArIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5hbm5vdENvbFdpZHRoKjIgKyBjb25maWcuYW5ub3RIbVNwYWNlKTsKICAgICAgICB9CiAgICAgICAgZWxzZSB7IC8vIG5vIGFubm90cwogICAgICAgICAgICBobV90X3ggPSAoY29uZmlnLnRyZWVXaWR0aCArIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5hbm5vdENvbFdpZHRoKTsKICAgICAgICB9CgogICAgICAgIGN1clZpek9iai52aWV3LmNudlNWRyA9IGNvbnRhaW5lclNWRy5hcHBlbmQoImciKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiY252U1ZHIikKICAgICAgICAgICAgLmF0dHIoInRyYW5zZm9ybSIsICJ0cmFuc2xhdGUoIiArIGhtX3RfeCArICIsIiArIDAgKyAiKSIpOwoKICAgICAgICAvLyBDTlYgTEVHRU5EIFNWRwoKICAgICAgICBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcgPSBjb250YWluZXJTVkcuYXBwZW5kKCJnIikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgImNudkxlZ2VuZFNWRyIpCiAgICAgICAgICAgIC5hdHRyKCJ0cmFuc2Zvcm0iLCAidHJhbnNsYXRlKCIgKyAoaG1fdF94ICsgY3VyVml6T2JqLnVzZXJDb25maWcuaGVhdG1hcFdpZHRoKSArICIsIiArIDAgKyAiKSIpOwoKCiAgICAgICAgLy8gVElUTEUgRk9SIFRSRUUgQU5EIEhFQVRNQVAKCiAgICAgICAgY29udGFpbmVyU1ZHLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgaG1fdF94ICsgKGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBXaWR0aC8yKSkKICAgICAgICAgICAgLmF0dHIoInkiLCBjb25maWcucGFkZGluZ0dlbmVyYWwpCiAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC43MWVtIikKICAgICAgICAgICAgLmF0dHIoInRleHQtYW5jaG9yIiwgIm1pZGRsZSIpCiAgICAgICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgICAgIC5hdHRyKCJmb250LXdlaWdodCIsICJib2xkIikKICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIGNvbmZpZy5sZWdlbmRUaXRsZUhlaWdodCkKICAgICAgICAgICAgLnRleHQoIkhlYXRtYXAiKTsKICAgICAgICBjb250YWluZXJTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcudHJlZVdpZHRoLzIpCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsKQogICAgICAgICAgICAuYXR0cigiZHkiLCAiKzAuNzFlbSIpCiAgICAgICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKQogICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAuYXR0cigiZm9udC13ZWlnaHQiLCAiYm9sZCIpCiAgICAgICAgICAgIC5hdHRyKCJmb250LXNpemUiLCBjb25maWcubGVnZW5kVGl0bGVIZWlnaHQpCiAgICAgICAgICAgIC50ZXh0KCJTaW5nbGUgQ2VsbCBQaHlsb2dlbnkiKTsKCiAgICAgICAgLy8gUExPVCBUT1AgUEFORUwKCiAgICAgICAgLy8gc3ZnCiAgICAgICAgdmFyIHRvcEJhclNWRyA9IHRvcEJhckRJVi5hcHBlbmQoInN2ZzpzdmciKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAidG9wQmFyIikKICAgICAgICAgICAgLmF0dHIoIngiLCAwKQogICAgICAgICAgICAuYXR0cigieSIsIDApCiAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIGNvbmZpZy53aWR0aCArICJweCIpCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBjb25maWcudG9wQmFySGVpZ2h0ICsgInB4Iik7CgogICAgICAgIC8vIGJhY2tncm91bmQgYmFyCiAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwwKQogICAgICAgICAgICAuYXR0cigieSIsMCkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLndpZHRoICsgInB4IikKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGNvbmZpZy50b3BCYXJIZWlnaHQpCiAgICAgICAgICAgIC5hdHRyKCJyeCIsIDEwKQogICAgICAgICAgICAuYXR0cigicnkiLCAxMCkKICAgICAgICAgICAgLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKTsKCiAgICAgICAgLy8gdG9wIHBhbmVsIHRpdGxlCiAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgMTApCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgY29uZmlnLnRvcEJhckhlaWdodC8yKQogICAgICAgICAgICAuYXR0cigidGV4dC1hbmNob3IiLCAic3RhcnQiKQogICAgICAgICAgICAuYXR0cigiZHkiLCAiKzAuMzVlbSIpCiAgICAgICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgIndoaXRlIikKICAgICAgICAgICAgLmF0dHIoInBvaW50ZXItZXZlbnRzIiwibm9uZSIpCiAgICAgICAgICAgIC50ZXh0KGNvbmZpZy52aWV3VGl0bGUpOwoKCiAgICAgICAgLy8gYnV0dG9uIHdpZHRocwogICAgICAgIHZhciBzbWFsbEJ1dHRvbldpZHRoID0gNDI7IAogICAgICAgIHZhciBiaWdCdXR0b25XaWR0aCA9IDg0OwoKICAgICAgICAvLyBiYXNlIDY0IGZvciBlYWNoIGljb24KICAgICAgICB2YXIgc2VsZWN0aW9uQnV0dG9uX2Jhc2U2NCA9ICJkYXRhOmltYWdlL3N2Zyt4bWw7dXRmODtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWFYTnZMVGc0TlRrdE1TSS9QZ284SVMwdElFZGxibVZ5WVhSdmNqb2dRV1J2WW1VZ1NXeHNkWE4wY21GMGIzSWdNVGd1TVM0eExDQlRWa2NnUlhod2IzSjBJRkJzZFdjdFNXNGdMaUJUVmtjZ1ZtVnljMmx2YmpvZ05pNHdNQ0JDZFdsc1pDQXdLU0FnTFMwK0NqeHpkbWNnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SWdkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGlRMkZ3WVY4eElpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJZ2RtbGxkMEp2ZUQwaU1DQXdJRFUzTGpZM05DQTFOeTQyTnpRaUlITjBlV3hsUFNKbGJtRmliR1V0WW1GamEyZHliM1Z1WkRwdVpYY2dNQ0F3SURVM0xqWTNOQ0ExTnk0Mk56UTdJaUI0Yld3NmMzQmhZMlU5SW5CeVpYTmxjblpsSWlCM2FXUjBhRDBpTVRad2VDSWdhR1ZwWjJoMFBTSXhObkI0SWo0S1BHYytDZ2s4Wno0S0NRazhjR0YwYUNCa1BTSk5OVFV1TXpNNExERTRMakU0TW1NeExqSTVNU3d3TERJdU16TTJMVEV1TURRM0xESXVNek0yTFRJdU16TTNWamN1TURFeVl6QXRNUzR5T1MweExqQTBOUzB5TGpNek55MHlMak16TmkweUxqTXpOMmd0T0M0NE16UWdJQ0FnWXkweExqSTVNU3d3TFRJdU16TTRMREV1TURRM0xUSXVNek00TERJdU16TTNkakl1TURoSU1UTXVOVEE0VmpjdU1ERXpZekF0TVM0eU9TMHhMakEwTmkweUxqTXpOeTB5TGpNek55MHlMak16TjBneUxqTXpOME14TGpBME5pdzBMalkzTml3d0xEVXVOekl6TERBc055NHdNVE4yT0M0NE16TWdJQ0FnWXpBc01TNHlPU3d4TGpBME5pd3lMak16Tnl3eUxqTXpOeXd5TGpNek4yZ3lMakE0ZGpJeExqTXhTREl1TXpNNFl5MHhMakk1TVN3d0xUSXVNek0zTERFdU1EUTNMVEl1TXpNM0xESXVNek0zZGpndU9ETXpZekFzTVM0eU9URXNNUzR3TkRZc01pNHpNemNzTWk0ek16Y3NNaTR6TXpkb09DNDRNelFnSUNBZ1l6RXVNamt4TERBc01pNHpNemN0TVM0d05EY3NNaTR6TXpjdE1pNHpNemQyTFRJdU1EaG9NekF1TmpVM2RqSXVNRGhqTUN3eExqSTVNU3d4TGpBME5pd3lMak16Tnl3eUxqTXpOeXd5TGpNek4yZzRMamd6TTJNeExqSTVNU3d3TERJdU16TTRMVEV1TURRM0xESXVNek00TFRJdU16TTNJQ0FnSUhZdE9DNDRNek5qTUMweExqSTVNUzB4TGpBME55MHlMak16TnkweUxqTXpPQzB5TGpNek4yZ3RNaTR3TnpoV01UZ3VNVGd5U0RVMUxqTXpPSG9nVFRRNExqZzBNU3c1TGpNME9VZzFNM1kwTGpFMU9HZ3RNaTR3T0dndE1pNHdOemwyTFRJdU1EYzRJQ0FnSUVNME9DNDROREVzTVRFdU5ESTVMRFE0TGpnME1TdzVMak0wT1N3ME9DNDROREVzT1M0ek5EbDZJRTAwTGpZM05DdzVMak0xTVdnMExqRTJkakl1TURjNGRqSXVNRGhvTFRJdU1EaG9MVEl1TURoV09TNHpOVEY2SUUwNExqZ3pOQ3cwT0M0ek1qWklOQzQyTnpWMkxUUXVNVFU1YURJdU1EYzVJQ0FnSUdneUxqQTRkakl1TURjNVZqUTRMak15Tm5vZ1RUVXpMRFE0TGpNeU5tZ3ROQzR4Tm5ZdE1pNHdPSFl0TWk0d056bG9NaTR3T0VnMU0wTTFNeXcwTkM0eE5qY3NOVE1zTkRndU16STJMRFV6TERRNExqTXlObm9nVFRRNExqVTRNeXd6T1M0ME9UTm9MVEl1TURnZ0lDQWdZeTB4TGpJNU1Td3dMVEl1TXpNM0xERXVNRFEzTFRJdU16TTNMREl1TXpNM2RqSXVNRGM0U0RFekxqVXdPVlkwTVM0NE0yTXdMVEV1TWpreExURXVNRFEyTFRJdU16TTNMVEl1TXpNM0xUSXVNek0zYUMweUxqQTRkaTB5TVM0ek1XZ3lMakEzT1NBZ0lDQmpNUzR5T1RFc01Dd3lMak16TnkweExqQTBOeXd5TGpNek55MHlMak16TjNZdE1pNHdPR2d6TUM0Mk5UaDJNaTR3Tnpsak1Dd3hMakk1TERFdU1EUTNMREl1TXpNM0xESXVNek00TERJdU16TTNhREl1TURjNUlDQWdJRU0wT0M0MU9ETXNNVGd1TVRneUxEUTRMalU0TXl3ek9TNDBPVE1zTkRndU5UZ3pMRE01TGpRNU0zb2lJR1pwYkd3OUlpTkdSa1pHUmtZaUx6NEtDVHd2Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284Wno0S1BDOW5QZ284TDNOMlp6NEsiCiAgICAgICAgdmFyIHNjaXNzb3JzQnV0dG9uX2Jhc2U2NCA9ICJkYXRhOmltYWdlL3N2Zyt4bWw7dXRmODtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWFYTnZMVGc0TlRrdE1TSS9QZ284SVMwdElFZGxibVZ5WVhSdmNqb2dRV1J2WW1VZ1NXeHNkWE4wY21GMGIzSWdNVGt1TUM0d0xDQlRWa2NnUlhod2IzSjBJRkJzZFdjdFNXNGdMaUJUVmtjZ1ZtVnljMmx2YmpvZ05pNHdNQ0JDZFdsc1pDQXdLU0FnTFMwK0NqeHpkbWNnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SWdkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGlUR0Y1WlhKZk1TSWdlRDBpTUhCNElpQjVQU0l3Y0hnaUlIWnBaWGRDYjNnOUlqQWdNQ0EwTlRFdU5qYzBJRFExTVM0Mk56UWlJSE4wZVd4bFBTSmxibUZpYkdVdFltRmphMmR5YjNWdVpEcHVaWGNnTUNBd0lEUTFNUzQyTnpRZ05EVXhMalkzTkRzaUlIaHRiRHB6Y0dGalpUMGljSEpsYzJWeWRtVWlJSGRwWkhSb1BTSXhObkI0SWlCb1pXbG5hSFE5SWpFMmNIZ2lQZ284Wno0S0NUeHdZWFJvSUdROUlrMHhOamN1T0RVMExESTVNeTR5T1RsakxUY3VNVEEwTFRZdU9ETTBMVEUxTGpRekxURXlMall6TWkweU5DNDROUzB4Tnk0d01qVmpMVEV5TGpJNU1pMDFMamN6TVMweU5TNHpOVFl0T0M0Mk16Z3RNemd1T0RNdE9DNDJNemdnSUNCakxUTTFMall6TERBdE5qZ3VNemM0TERJd0xqZzFOeTA0TXk0ME16RXNOVE11TVRNNFl5MHhNQzR6T0RVc01qSXVNamN4TFRFeExqUTNOaXcwTnk0eU5UVXRNeTR3TnpFc056QXVNelEzY3pJMUxqSTVPU3cwTVM0MU1qa3NORGN1TlRjeExEVXhMamt4TkNBZ0lHTXhNaTR5T1N3MUxqY3pMREkxTGpNMU5DdzRMall6Tnl3ek9DNDRNeXc0TGpZek9XTXpOUzQyTXpFc01DdzJPQzR6TnprdE1qQXVPRFU1TERnekxqUXpNUzAxTXk0eE16aGpNQzB3TGpBd01Td3lNUzR3TURNdE16WXVNamt6TERJeExqQXdNeTB6Tmk0eU9UTnNMVFF3TGpJM05pMDJPUzQxT1RZZ0lDQk1NVFkzTGpnMU5Dd3lPVE11TWprNWVpQk5NVFl3TGpNeE15d3pPRFV1T0RVNFl5MHhNQzR4TkRZc01qRXVOelUzTFRNeUxqSXhPQ3d6TlM0NE1UVXROVFl1TWpNMExETTFMamd4TldNdE9TNHdOamt0TUM0d01ERXRNVGN1T0RZNExURXVPVFl5TFRJMkxqRTFPUzAxTGpneU9DQWdJR010TVRVdU1EQTVMVFl1T1RrNUxUSTJMak01TkMweE9TNDBNak10TXpJdU1EVTRMVE0wTGprNE5YTXROQzQ1TWprdE16SXVNems0TERJdU1EY3RORGN1TkRBNFl6RXdMakUwTmkweU1TNDNOVGNzTXpJdU1qSXlMVE0xTGpneE5TdzFOaTR5TkRJdE16VXVPREUxSUNBZ1l6a3VNRFl4TERBc01UY3VPRFU1TERFdU9UWXhMREkyTGpFMU1TdzFMamd5TjBNeE5qRXVNekE0TERNeE55NDVNVElzTVRjMExqYzJNU3d6TlRRdU9EYzBMREUyTUM0ek1UTXNNemcxTGpnMU9Ib2lJR1pwYkd3OUlpTkdSa1pHUmtZaUx6NEtDVHh3WVhSb0lHUTlJazB6TmpJdU9EQTBMRGsxTGpZeU1tTXhPUzR6TXkwek15NDBPQ3czTGpnMU9TMDNOaTR5T1RJdE1qVXVOakl5TFRrMUxqWXlNbXd0T1RRdU1ESTFMREUyTWk0NE5qUnNOREF1TXpFNExEWTVMamd6Tmt3ek5qSXVPREEwTERrMUxqWXlNbm9pSUdacGJHdzlJaU5HUmtaR1JrWWlMejRLQ1R4d1lYUm9JR1E5SWswME16QXVPVE15TERNeU1DNDNOek5qTFRFMUxqQTFNeTB6TWk0eU56a3RORGN1T0RBeExUVXpMakV6TnkwNE15NDBNekV0TlRNdU1UTTNZeTB4TXk0ME56UXNNQzB5Tmk0MU16Z3NNaTQ1TURZdE16Z3VPRE1zT0M0Mk16Z2dJQ0JqTFRrdU5ESXNOQzR6T1RNdE1UY3VOelEzTERFd0xqRTVMVEkwTGpnMUxERTNMakF5TlV3eE1UUXVORGt5TERCRE9ERXVNREV4TERFNUxqTXpMRFk1TGpVMExEWXlMakUwTVN3NE9DNDROeXc1TlM0Mk1qSnNNVGMxTGpJNU9Td3pNREl1T1RFZ0lDQmpNVFV1TURVMUxETXlMakk0TkN3ME55NDRNRE1zTlRNdU1UUXlMRGd6TGpRek1pdzFNeTR4TkRKak1UTXVORGMxTERBc01qWXVOVE01TFRJdU9UQTNMRE00TGpnek1TMDRMall6T1dNeU1pNHlOekV0TVRBdU16ZzFMRE01TGpFMk5pMHlPQzQ0TWpJc05EY3VOVGN4TFRVeExqa3hOQ0FnSUZNME5ERXVNekUzTERNME15NHdORFlzTkRNd0xqa3pNaXd6TWpBdU56Y3plaUJOTkRBMUxqZ3hNaXd6T0RBdU9EWmpMVFV1TmpZMExERTFMalUyTXkweE55NHdORGtzTWpjdU9UZzJMVE15TGpBMU9Td3pOQzQ1T0RVZ0lDQmpMVGd1TWpreUxETXVPRFkzTFRFM0xqQTVNU3cxTGpneU9DMHlOaTR4TlRJc05TNDRNamhqTFRJMExqQXlMREF0TkRZdU1EazFMVEUwTGpBMU9TMDFOaTR5TkRFdE16VXVPREUxWXkweE5DNDBORGd0TXpBdU9UZzBMVEF1T1RrMUxUWTNMamswTml3eU9TNDVPRGd0T0RJdU16azFJQ0FnWXpndU1qa3lMVE11T0RZMkxERTNMakE1TVMwMUxqZ3lOeXd5Tmk0eE5USXROUzQ0TWpkak1qUXVNRElzTUN3ME5pNHdPVFlzTVRRdU1EVTVMRFUyTGpJME1pd3pOUzQ0TVRWRE5ERXdMamMwTVN3ek5EZ3VORFl5TERReE1TNDBOellzTXpZMUxqSTVPQ3cwTURVdU9ERXlMRE00TUM0NE5ub2lJR1pwYkd3OUlpTkdSa1pHUmtZaUx6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOFp6NEtQQzluUGdvOEwzTjJaejRLIgogICAgICAgIHZhciBmb3JjZURpcmVjdGVkSWNvbl9iYXNlNjQgPSAiZGF0YTppbWFnZS9zdmcreG1sO3V0Zjg7YmFzZTY0LFBEOTRiV3dnZG1WeWMybHZiajBpTVM0d0lpQmxibU52WkdsdVp6MGlhWE52TFRnNE5Ua3RNU0kvUGdvOElTMHRJRWRsYm1WeVlYUnZjam9nUVdSdlltVWdTV3hzZFhOMGNtRjBiM0lnTVRZdU1DNHdMQ0JUVmtjZ1JYaHdiM0owSUZCc2RXY3RTVzRnTGlCVFZrY2dWbVZ5YzJsdmJqb2dOaTR3TUNCQ2RXbHNaQ0F3S1NBZ0xTMCtDandoUkU5RFZGbFFSU0J6ZG1jZ1VGVkNURWxESUNJdEx5OVhNME12TDBSVVJDQlRWa2NnTVM0eEx5OUZUaUlnSW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTDBkeVlYQm9hV056TDFOV1J5OHhMakV2UkZSRUwzTjJaekV4TG1SMFpDSStDanh6ZG1jZ2VHMXNibk05SW1oMGRIQTZMeTkzZDNjdWR6TXViM0puTHpJd01EQXZjM1puSWlCNGJXeHVjenA0YkdsdWF6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNVGs1T1M5NGJHbHVheUlnZG1WeWMybHZiajBpTVM0eElpQnBaRDBpUTJGd1lWOHhJaUI0UFNJd2NIZ2lJSGs5SWpCd2VDSWdkMmxrZEdnOUlqVXhNbkI0SWlCb1pXbG5hSFE5SWpVeE1uQjRJaUIyYVdWM1FtOTRQU0l3SURBZ016RTBMakF4TkNBek1UUXVNREUxSWlCemRIbHNaVDBpWlc1aFlteGxMV0poWTJ0bmNtOTFibVE2Ym1WM0lEQWdNQ0F6TVRRdU1ERTBJRE14TkM0d01UVTdJaUI0Yld3NmMzQmhZMlU5SW5CeVpYTmxjblpsSWo0S1BHYytDZ2s4WnlCcFpEMGlYM2d6TkY4eU9DNWZUbVYwZDI5eWF5SStDZ2tKUEdjK0Nna0pDVHh3WVhSb0lHUTlJazB5TmpZdU9URXhMREV3T1M0NE9UaGpMVEl3TGpRNU9Dd3dMVE0zTGpnNU5Dd3hNeTR4TWpVdE5EUXVNelUwTERNeExqUXdPRWd4TVRZdU5EQTJiRFV4TGpjek5DMDFNUzQzTXpKak5pNHhORGNzTWk0NU16WXNNVE1zTkM0Mk16RXNNakF1TWpjc05DNDJNekVnSUNBZ0lHTXlOaTR3TURRc01DdzBOeTR4TURRdE1qRXVNRGsxTERRM0xqRXdOQzAwTnk0eE1EUkRNak0xTGpVeE15d3lNUzR3T0Rjc01qRTBMalF4TkN3d0xERTRPQzQwTVN3d1l5MHlOaTR3TURVc01DMDBOeTR4TURRc01qRXVNRGczTFRRM0xqRXdOQ3cwTnk0eE1ESWdJQ0FnSUdNd0xEY3VNalk0TERFdU5qazFMREUwTGpFeU1pdzBMall6TVN3eU1DNHlOalJzTFRZeExqSTNPQ3cyTVM0eU9EaGpMVGd1TlRrdE1URXVNemd6TFRJeUxqSXdNUzB4T0M0M05EY3RNemN1TlRVNExURTRMamMwTnlBZ0lDQWdRekl4TGpBNU15d3hNRGt1T1RBMkxEQXNNVE13TGprNU1Td3dMREUxTnk0d01EZGpNQ3d5Tmk0d01EUXNNakV1TURrekxEUTNMakV3TXl3ME55NHhNREVzTkRjdU1UQXpZekUxTGpNMk5Td3dMREk0TGprMk9DMDNMak0yTVN3ek55NDFOVGd0TVRndU56VTFiRFl4TGpJM09DdzJNUzR5T0RZZ0lDQWdJR010TWk0NU16WXNOaTR4TlRFdE5DNDJNekVzTVRNdU1EQTBMVFF1TmpNeExESXdMakkzWXpBc01qWXVNREEwTERJeExqQTVPU3cwTnk0eE1EUXNORGN1TVRBMExEUTNMakV3TkdNeU5pNHdNRFFzTUN3ME55NHhNRFF0TWpFdU1TdzBOeTR4TURRdE5EY3VNVEEwSUNBZ0lDQmpNQzB5Tmk0d01UY3RNakV1TVMwME55NHhMVFEzTGpFd05DMDBOeTR4WXkwM0xqSTNMREF0TVRRdU1USXlMREV1TmpreExUSXdMakkzTERRdU5qSTViQzAxTVM0M016UXROVEV1TnpNeWFERXdOaTR4TlRFZ0lDQWdJR00yTGpRMk9Dd3hPQzR5T0RZc01qTXVPRFUxTERNeExqUXdNaXcwTkM0ek5UUXNNekV1TkRBeVl6STJMakF3T1N3d0xEUTNMakV3TkMweU1TNHdPVGtzTkRjdU1UQTBMVFEzTGpFd015QWdJQ0FnUXpNeE5DNHdNVFFzTVRNd0xqazVNU3d5T1RJdU9URTVMREV3T1M0NE9UZ3NNalkyTGpreE1Td3hNRGt1T0RrNGVpQk5NVGc0TGpReExETXhMalF3TW1NNExqWTJOQ3d3TERFMUxqY3dNU3czTGpBeU5Td3hOUzQzTURFc01UVXVOams1SUNBZ0lDQmpNQ3c0TGpZMk9DMDNMakF6Tnl3eE5TNDNNREV0TVRVdU56QXhMREUxTGpjd01YTXRNVFV1TnpBeExUY3VNRE16TFRFMUxqY3dNUzB4TlM0M01ERkRNVGN5TGpjd09Dd3pPQzQwTWpnc01UYzVMamMwTml3ek1TNDBNRElzTVRnNExqUXhMRE14TGpRd01ub2dUVFEzTGpFd01pd3hOekl1TnpBNElDQWdJQ0JqTFRndU5qWTJMREF0TVRVdU5qazVMVGN1TURNM0xURTFMalk1T1MweE5TNDNNREZqTUMwNExqWTNOQ3czTGpBek15MHhOUzQzTURFc01UVXVOams1TFRFMUxqY3dNV000TGpZMk9Dd3dMREUxTGpjd01TdzNMakF5Tnl3eE5TNDNNREVzTVRVdU56QXhJQ0FnSUNCRE5qSXVPREF6TERFMk5TNDJOekVzTlRVdU56Y3NNVGN5TGpjd09DdzBOeTR4TURJc01UY3lMamN3T0hvZ1RURTRPQzQwTVN3eU5URXVNakUwWXpndU5qWTBMREFzTVRVdU56QXhMRGN1TURJeExERTFMamN3TVN3eE5TNDJPVGNnSUNBZ0lHTXdMRGd1TmpZMExUY3VNRE0zTERFMUxqY3dNUzB4TlM0M01ERXNNVFV1TnpBeGN5MHhOUzQzTURFdE55NHdNemN0TVRVdU56QXhMVEUxTGpjd01VTXhOekl1TnpBNExESTFPQzR5TXpRc01UYzVMamMwTml3eU5URXVNakUwTERFNE9DNDBNU3d5TlRFdU1qRTBlaUFnSUNBZ0lFMHlOall1T1RFeExERTNNaTQzTURoakxUZ3VOallzTUMweE5TNDJPVGN0Tnk0d016Y3RNVFV1TmprM0xURTFMamN3TVdNd0xUZ3VOamMwTERjdU1ETTNMVEUxTGpjd01Td3hOUzQyT1RjdE1UVXVOekF4WXpndU5qWTBMREFzTVRVdU56QXhMRGN1TURJM0xERTFMamN3TVN3eE5TNDNNREVnSUNBZ0lFTXlPREl1TmpFeUxERTJOUzQyTnpFc01qYzFMalUzTlN3eE56SXVOekE0TERJMk5pNDVNVEVzTVRjeUxqY3dPSG9pSUdacGJHdzlJaU5HUmtaR1JrWWlMejRLQ1FrOEwyYytDZ2s4TDJjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEdjK0Nqd3ZaejRLUEM5emRtYytDZz09IgogICAgICAgIHZhciBwaHlsb2dlbnlJY29uX2Jhc2U2NCA9ICJkYXRhOmltYWdlL3N2Zyt4bWw7dXRmODtiYXNlNjQsUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWFYTnZMVGc0TlRrdE1TSS9QZ284SVMwdElFZGxibVZ5WVhSdmNqb2dRV1J2WW1VZ1NXeHNkWE4wY21GMGIzSWdNVFl1TUM0d0xDQlRWa2NnUlhod2IzSjBJRkJzZFdjdFNXNGdMaUJUVmtjZ1ZtVnljMmx2YmpvZ05pNHdNQ0JDZFdsc1pDQXdLU0FnTFMwK0Nqd2hSRTlEVkZsUVJTQnpkbWNnVUZWQ1RFbERJQ0l0THk5WE0wTXZMMFJVUkNCVFZrY2dNUzR4THk5RlRpSWdJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5MMGR5WVhCb2FXTnpMMU5XUnk4eExqRXZSRlJFTDNOMlp6RXhMbVIwWkNJK0NqeHpkbWNnZUcxc2JuTTlJbWgwZEhBNkx5OTNkM2N1ZHpNdWIzSm5Mekl3TURBdmMzWm5JaUI0Yld4dWN6cDRiR2x1YXowaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1UazVPUzk0YkdsdWF5SWdkbVZ5YzJsdmJqMGlNUzR4SWlCcFpEMGlRMkZ3WVY4eElpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJZ2QybGtkR2c5SWpVeE1uQjRJaUJvWldsbmFIUTlJalV4TW5CNElpQjJhV1YzUW05NFBTSXdJREFnTXpFMExqQXhOQ0F6TVRRdU1ERTFJaUJ6ZEhsc1pUMGlaVzVoWW14bExXSmhZMnRuY205MWJtUTZibVYzSURBZ01DQXpNVFF1TURFMElETXhOQzR3TVRVN0lpQjRiV3c2YzNCaFkyVTlJbkJ5WlhObGNuWmxJajRLUEdjK0NnazhaeUJwWkQwaVgzZ3pORjh5T1M1ZlRtVjBkMjl5YXlJK0Nna0pQR2MrQ2drSkNUeHdZWFJvSUdROUlrMHlPREl1TmpFeUxESXlNaTQxTlRkMkxUUTVMamcwT1dNd0xURTNMak0wTWkweE5DNHdOVGd0TXpFdU5EQXlMVE14TGpNNU9DMHpNUzQwTURKb0xUYzRMalV3TlZZNU1TNDBOalFnSUNBZ0lHTXhPQzR5T0RZdE5pNDBOelFzTXpFdU5EQXlMVEl6TGpnMk5pd3pNUzQwTURJdE5EUXVNelk0WXpBdE1qWXVNREE0TFRJeExqRXRORGN1TURrMkxUUTNMakV3TkMwME55NHdPVFpqTFRJMkxqQXdPQ3d3TFRRM0xqRXdNaXd5TVM0d09EY3RORGN1TVRBeUxEUTNMakE1TmlBZ0lDQWdZekFzTWpBdU5UQXlMREV6TGpFeE55d3pOeTQ0T1RRc016RXVOQ3cwTkM0ek5qaDJORGt1T0RReVNEWXlMamd3TTJNdE1UY3VNelFzTUMwek1TNDBMREUwTGpBMkxUTXhMalFzTXpFdU5EQXlkalE1TGpnME9VTXhNeTR4TVRjc01qSTVMakF4Tnl3d0xESTBOaTQwTVRNc01Dd3lOall1T1RFeElDQWdJQ0JqTUN3eU5pNHdNRFFzTWpFdU1Ea3pMRFEzTGpFd05DdzBOeTR4TURFc05EY3VNVEEwY3pRM0xqRXdNeTB5TVM0eExEUTNMakV3TXkwME55NHhNRFJqTUMweU1DNDBPVGd0TVRNdU1URTRMVE0zTGpnNU5TMHpNUzQwTURJdE5EUXVNelUwZGkwME9TNDRORGxvTnpndU5UQXpkalE1TGpnME9TQWdJQ0FnWXkweE9DNHlPRFFzTmk0ME5pMHpNUzQwTERJekxqZzFOaTB6TVM0MExEUTBMak0xTkdNd0xESTJMakF3TkN3eU1TNHdPVE1zTkRjdU1UQTBMRFEzTGpFd01pdzBOeTR4TURSak1qWXVNREEwTERBc05EY3VNVEEwTFRJeExqRXNORGN1TVRBMExUUTNMakV3TkNBZ0lDQWdZekF0TWpBdU5EazRMVEV6TGpFeE5pMHpOeTQ0T1RVdE16RXVOREF5TFRRMExqTTFOSFl0TkRrdU9EUTVhRGM0TGpVd05YWTBPUzQ0TkRsakxURTRMakk0TlN3MkxqUTJMVE14TGpRd01Td3lNeTQ0TlRZdE16RXVOREF4TERRMExqTTFOQ0FnSUNBZ1l6QXNNall1TURBMExESXhMakE1TlN3ME55NHhNRFFzTkRjdU1EazVMRFEzTGpFd05HTXlOaTR3TURrc01DdzBOeTR4TURRdE1qRXVNU3cwTnk0eE1EUXRORGN1TVRBMFF6TXhOQzR3TVRRc01qUTJMalF4TXl3ek1EQXVPRGs0TERJeU9TNHdNVGNzTWpneUxqWXhNaXd5TWpJdU5UVTNlaUFnSUNBZ0lFMDBOeTR4TURJc01qZ3lMall4TW1NdE9DNDJOallzTUMweE5TNDJPVGt0Tnk0d016Y3RNVFV1TmprNUxURTFMamN3TVdNd0xUZ3VOamMzTERjdU1ETXpMVEUxTGpZNU55d3hOUzQyT1RrdE1UVXVOamszWXpndU5qWTRMREFzTVRVdU56QXhMRGN1TURJeExERTFMamN3TVN3eE5TNDJPVGNnSUNBZ0lFTTJNaTQ0TURNc01qYzFMalUzTlN3MU5TNDNOeXd5T0RJdU5qRXlMRFEzTGpFd01pd3lPREl1TmpFeWVpQk5NVFUzTGpBd055d3lPREl1TmpFeVl5MDRMalkyTml3d0xURTFMamN3TVMwM0xqQXpOeTB4TlM0M01ERXRNVFV1TnpBeElDQWdJQ0JqTUMwNExqWTNOeXczTGpBek5TMHhOUzQyT1Rjc01UVXVOekF4TFRFMUxqWTVOMk00TGpZMk5Dd3dMREUxTGpjd01TdzNMakF5TVN3eE5TNDNNREVzTVRVdU5qazNRekUzTWk0M01EZ3NNamMxTGpVM05Td3hOalV1TmpjeExESTRNaTQyTVRJc01UVTNMakF3Tnl3eU9ESXVOakV5ZWlBZ0lDQWdJRTB4TlRjdU1EQTNMRFl5TGpnd00yTXRPQzQyTmpZc01DMHhOUzQzTURFdE55NHdNek10TVRVdU56QXhMVEUxTGpjd04yTXdMVGd1TmpjMkxEY3VNRE0xTFRFMUxqWTVNeXd4TlM0M01ERXRNVFV1Tmprell6Z3VOalkwTERBc01UVXVOekF4TERjdU1ESTFMREUxTGpjd01Td3hOUzQyT1RNZ0lDQWdJRU14TnpJdU56QTRMRFUxTGpjMk1pd3hOalV1TmpjeExEWXlMamd3TXl3eE5UY3VNREEzTERZeUxqZ3dNM29nVFRJMk5pNDVNVEVzTWpneUxqWXhNbU10T0M0Mk5pd3dMVEUxTGpZNU55MDNMakF6TnkweE5TNDJPVGN0TVRVdU56QXhJQ0FnSUNCak1DMDRMalkzTnl3M0xqQXpOeTB4TlM0Mk9UY3NNVFV1TmprM0xURTFMalk1TjJNNExqWTJOQ3d3TERFMUxqY3dNU3czTGpBeU1Td3hOUzQzTURFc01UVXVOamszUXpJNE1pNDJNVElzTWpjMUxqVTNOU3d5TnpVdU5UYzFMREk0TWk0Mk1USXNNalkyTGpreE1Td3lPREl1TmpFeWVpSWdabWxzYkQwaUkwWkdSa1pHUmlJdlBnb0pDVHd2Wno0S0NUd3ZaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhaejRLUEM5blBnbzhMM04yWno0SyIKICAgICAgICB2YXIgZG93bmxvYWRCdXR0b25fYmFzZTY0ID0gImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsIiArICJQRDk0Yld3Z2RtVnljMmx2YmowaU1TNHdJaUJsYm1OdlpHbHVaejBpZFhSbUxUZ2lQejROQ2p3aExTMGdSMlZ1WlhKaGRHOXlPaUJCWkc5aVpTQkpiR3gxYzNSeVlYUnZjaUF4TkM0d0xqQXNJRk5XUnlCRmVIQnZjblFnVUd4MVp5MUpiaUF1SUZOV1J5QldaWEp6YVc5dU9pQTJMakF3SUVKMWFXeGtJRFF6TXpZektTQWdMUzArRFFvOElVUlBRMVJaVUVVZ2MzWm5JRkJWUWt4SlF5QWlMUzh2VnpOREx5OUVWRVFnVTFaSElERXVNUzh2UlU0aUlDSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OUhjbUZ3YUdsamN5OVRWa2N2TVM0eEwwUlVSQzl6ZG1jeE1TNWtkR1FpUGcwS1BITjJaeUIyWlhKemFXOXVQU0l4TGpFaUlHbGtQU0pNWVhsbGNsOHhJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSGh0Ykc1ek9uaHNhVzVyUFNKb2RIUndPaTh2ZDNkM0xuY3pMbTl5Wnk4eE9UazVMM2hzYVc1cklpQjRQU0l3Y0hnaUlIazlJakJ3ZUNJTkNna2dkMmxrZEdnOUlqVXhNbkI0SWlCb1pXbG5hSFE5SWpVeE1uQjRJaUIyYVdWM1FtOTRQU0l3SURBZ05URXlJRFV4TWlJZ1pXNWhZbXhsTFdKaFkydG5jbTkxYm1ROUltNWxkeUF3SURBZ05URXlJRFV4TWlJZ2VHMXNPbk53WVdObFBTSndjbVZ6WlhKMlpTSStEUW84Y0c5c2VXZHZiaUJtYVd4c1BTSWpSa1pHUmtaR0lpQndiMmx1ZEhNOUlqTTFOQzQxTERNek15NDFJRE16TXk0MUxETXhNeTQxSURJM01TNDRNelVzTXpZMUxqVTJOQ0F5TnpFdU9ETTFMRGN1T1RFM0lESTBNQzR4TmpVc055NDVNVGNnTWpRd0xqRTJOU3d6TmpVdU5UWTBJREU0TUM0MUxETXhOQzQxSUEwS0NURTFOeTQxTERNek5pNDFJREkxTml3ME1qWXVNVGc0SUNJdlBnMEtQSEJ2YkhsbmIyNGdabWxzYkQwaUkwWkdSa1pHUmlJZ2NHOXBiblJ6UFNJeU9DNDFMRFEzTWk0ME1USWdORGc1TGpVc05EY3lMalF4TWlBME9UQXVOU3cxTURRdU1EZ3lJREkzTGpVc05UQTBMakE0TWlBaUx6NE5Danh3YjJ4NVoyOXVJR1pwYkd3OUlpTkdSa1pHUmtZaUlIQnZhVzUwY3owaU1qWXVOVGdzTXpZMkxqUXhNaUEyTXk0ME5qY3NNelkyTGpReE1pQTJNeTQxTkRjc05UQXlMalVnTWpZdU5TdzFNREl1TlNBaUx6NE5Danh3YjJ4NVoyOXVJR1pwYkd3OUlpTkdSa1pHUmtZaUlIQnZhVzUwY3owaU5EVXlMalV6TXl3ek5qVXVOREV5SURRNE9TNDBNVGtzTXpZMUxqUXhNaUEwT0RrdU5TdzFNREV1TlNBME5USXVORFV6TERVd01TNDFJQ0l2UGcwS1BDOXpkbWMrRFFvPSIKICAgICAgICB2YXIgcnVsZXJJY29uX2Jhc2U2NCA9ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LCIgKyAiUEQ5NGJXd2dkbVZ5YzJsdmJqMGlNUzR3SWlCbGJtTnZaR2x1WnowaWRYUm1MVGdpUHo0TkNqd2hMUzBnUjJWdVpYSmhkRzl5T2lCQlpHOWlaU0JKYkd4MWMzUnlZWFJ2Y2lBeE5DNHdMakFzSUZOV1J5QkZlSEJ2Y25RZ1VHeDFaeTFKYmlBdUlGTldSeUJXWlhKemFXOXVPaUEyTGpBd0lFSjFhV3hrSURRek16WXpLU0FnTFMwK0RRbzhJVVJQUTFSWlVFVWdjM1puSUZCVlFreEpReUFpTFM4dlZ6TkRMeTlFVkVRZ1UxWkhJREV1TVM4dlJVNGlJQ0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTlIY21Gd2FHbGpjeTlUVmtjdk1TNHhMMFJVUkM5emRtY3hNUzVrZEdRaVBnMEtQSE4yWnlCMlpYSnphVzl1UFNJeExqRWlJR2xrUFNKTVlYbGxjbDh4SWlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhodGJHNXpPbmhzYVc1clBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHhPVGs1TDNoc2FXNXJJaUI0UFNJd2NIZ2lJSGs5SWpCd2VDSU5DZ2tnZDJsa2RHZzlJak14Tmk0NU9YQjRJaUJvWldsbmFIUTlJakV5Tnk0Mk4zQjRJaUIyYVdWM1FtOTRQU0l3SURBZ016RTJMams1SURFeU55NDJOeUlnWlc1aFlteGxMV0poWTJ0bmNtOTFibVE5SW01bGR5QXdJREFnTXpFMkxqazVJREV5Tnk0Mk55SWdlRzFzT25Od1lXTmxQU0p3Y21WelpYSjJaU0krRFFvOGNtVmpkQ0I0UFNJNExqY3pPU0lnZVQwaU9TNDNNRGdpSUdacGJHdzlJbTV2Ym1VaUlITjBjbTlyWlQwaUkwWkdSa1pHUmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l5TXlJZ2QybGtkR2c5SWpJNU9TNDVPVGtpSUdobGFXZG9kRDBpTVRBNUxqY3dPQ0l2UGcwS1BHeHBibVVnWm1sc2JEMGlibTl1WlNJZ2MzUnliMnRsUFNJalJrWkdSa1pHSWlCemRISnZhMlV0ZDJsa2RHZzlJakl6SWlCNE1UMGlOakV1TVRNM0lpQjVNVDBpT1M0M05TSWdlREk5SWpZeExqRXpOeUlnZVRJOUlqUTNMalV6TVNJdlBnMEtQR3hwYm1VZ1ptbHNiRDBpYm05dVpTSWdjM1J5YjJ0bFBTSWpSa1pHUmtaR0lpQnpkSEp2YTJVdGQybGtkR2c5SWpJeklpQjRNVDBpTVRFd0xqWXlNaUlnZVRFOUlqRXdMakV4TlNJZ2VESTlJakV4TUM0Mk1qSWlJSGt5UFNJM05TNDNNamdpTHo0TkNqeHNhVzVsSUdacGJHdzlJbTV2Ym1VaUlITjBjbTlyWlQwaUkwWkdSa1pHUmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l5TXlJZ2VERTlJakUyTVM0eE5qVWlJSGt4UFNJeE1DNHlOellpSUhneVBTSXhOakV1TVRZMUlpQjVNajBpTkRndU1EVTRJaTgrRFFvOGJHbHVaU0JtYVd4c1BTSnViMjVsSWlCemRISnZhMlU5SWlOR1JrWkdSa1lpSUhOMGNtOXJaUzEzYVdSMGFEMGlNak1pSUhneFBTSXlNRGt1TnpZM0lpQjVNVDBpTVRBdU1EZzJJaUI0TWowaU1qQTVMamMyTnlJZ2VUSTlJamMzTGpFNE5DSXZQZzBLUEd4cGJtVWdabWxzYkQwaWJtOXVaU0lnYzNSeWIydGxQU0lqUmtaR1JrWkdJaUJ6ZEhKdmEyVXRkMmxrZEdnOUlqSXpJaUI0TVQwaU1qVTVMakk0TWlJZ2VURTlJamt1TmpBeElpQjRNajBpTWpVNUxqSTRNaUlnZVRJOUlqUTNMak00TWlJdlBnMEtQQzl6ZG1jK0RRbz0iCgogICAgICAgIC8vIGljb24gc2l6ZXMKICAgICAgICB2YXIgc2VsZWN0aW9uQnV0dG9uSWNvbldpZHRoID0gMTY7CiAgICAgICAgdmFyIHNjaXNzb3JzQnV0dG9uSWNvbldpZHRoID0gMTY7CiAgICAgICAgdmFyIGdyYXBoVHJlZUljb25XaWR0aCA9IDE2OwogICAgICAgIHZhciBkb3dubG9hZEJ1dHRvbkljb25XaWR0aCA9IGNvbmZpZy50b3BCYXJIZWlnaHQgLSAxMDsgLy8gaWNvbiBzaXplIGZvciBkb3dubG9hZCBidXR0b24KICAgICAgICB2YXIgcnVsZXJJY29uV2lkdGggPSAyMTsKCgogICAgICAgIC8vIFNWRyBidXR0b24KICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgInN2Z0J1dHRvbiIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gYmlnQnV0dG9uV2lkdGgpCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgMCkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgYmlnQnV0dG9uV2lkdGgpCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBjb25maWcudG9wQmFySGVpZ2h0KQogICAgICAgICAgICAuYXR0cigicngiLCAxMCkKICAgICAgICAgICAgLmF0dHIoInJ5IiwgMTApCiAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cikKICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cik7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGRvd25sb2FkIHRoZSBzdmcKICAgICAgICAgICAgICAgIGRvd25sb2FkU1ZHKCJjb250YWluZXJTVkdfIiArIHZpZXdfaWQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgIC50ZXh0KCJEb3dubG9hZCBTVkciKTsKICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgInN2Z0J1dHRvblRleHQiKQogICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy53aWR0aCAtIDEwKQogICAgICAgICAgICAuYXR0cigieSIsIGNvbmZpZy50b3BCYXJIZWlnaHQvMikKICAgICAgICAgICAgLmF0dHIoInRleHQtYW5jaG9yIiwgImVuZCIpCiAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgLmF0dHIoImZpbGwiLCAid2hpdGUiKQogICAgICAgICAgICAuYXR0cigicG9pbnRlci1ldmVudHMiLCJub25lIikKICAgICAgICAgICAgLnRleHQoIlNWRyIpCiAgICAgICAgICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAgICAgLnRleHQoIkRvd25sb2FkIFNWRyIpOwogICAgICAgIHRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKICAgICAgICAgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBkb3dubG9hZEJ1dHRvbl9iYXNlNjQpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gYmlnQnV0dG9uV2lkdGggKyAxMCkKICAgICAgICAgICAgLmF0dHIoInkiLCA1KQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBkb3dubG9hZEJ1dHRvbkljb25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGRvd25sb2FkQnV0dG9uSWNvbldpZHRoKQogICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnN2Z0J1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFySGlnaGxpZ2h0KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnN2Z0J1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gZG93bmxvYWQgdGhlIHN2ZwogICAgICAgICAgICAgICAgZG93bmxvYWRTVkcoImNvbnRhaW5lclNWR18iICsgdmlld19pZCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAgICAgLnRleHQoIkRvd25sb2FkIFNWRyIpOwoKCiAgICAgICAgLy8gUE5HIGJ1dHRvbgogICAgICAgIHRvcEJhclNWRy5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAicG5nQnV0dG9uIikKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSBiaWdCdXR0b25XaWR0aCoyKQogICAgICAgICAgICAuYXR0cigieSIsIDApCiAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIGJpZ0J1dHRvbldpZHRoKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLnRvcEJhckhlaWdodCkKICAgICAgICAgICAgLmF0dHIoInJ4IiwgMTApCiAgICAgICAgICAgIC5hdHRyKCJyeSIsIDEwKQogICAgICAgICAgICAuYXR0cigiZmlsbCIsY29uZmlnLnRvcEJhckNvbG91cikKICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cik7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpewogICAgICAgICAgICAgICAgLy8gZG93bmxvYWQgdGhlIHBuZwogICAgICAgICAgICAgICAgX2Rvd25sb2FkUE5HKCJjb250YWluZXJTVkdfIiArIHZpZXdfaWQsICJjb250YWluZXJTVkdfIiArIHZpZXdfaWQgKyAiLnBuZyIpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgIC50ZXh0KCJEb3dubG9hZCBQTkciKTsKICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgInBuZ0J1dHRvblRleHQiKQogICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy53aWR0aCAtIGJpZ0J1dHRvbldpZHRoIC0gMTApCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgY29uZmlnLnRvcEJhckhlaWdodC8yKQogICAgICAgICAgICAuYXR0cigidGV4dC1hbmNob3IiLCAiZW5kIikKICAgICAgICAgICAgLmF0dHIoImR5IiwgIiswLjM1ZW0iKQogICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAuYXR0cigiZmlsbCIsICJ3aGl0ZSIpCiAgICAgICAgICAgIC5hdHRyKCJwb2ludGVyLWV2ZW50cyIsIm5vbmUiKQogICAgICAgICAgICAudGV4dCgiUE5HIikKICAgICAgICAgICAgLmFwcGVuZCgidGl0bGUiKQogICAgICAgICAgICAudGV4dCgiRG93bmxvYWQgUE5HIik7CiAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgiaW1hZ2UiKQogICAgICAgICAgICAuYXR0cigieGxpbms6aHJlZiIsIGRvd25sb2FkQnV0dG9uX2Jhc2U2NCkKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSAyKmJpZ0J1dHRvbldpZHRoICsgMTApCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgNSkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgZG93bmxvYWRCdXR0b25JY29uV2lkdGgpCiAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBkb3dubG9hZEJ1dHRvbkljb25XaWR0aCkKICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5wbmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5wbmdCdXR0b24iKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cik7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGRvd25sb2FkIHRoZSBwbmcKICAgICAgICAgICAgICAgIF9kb3dubG9hZFBORygiY29udGFpbmVyU1ZHXyIgKyB2aWV3X2lkLCAiY29udGFpbmVyU1ZHXyIgKyB2aWV3X2lkICsgIi5wbmciKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgidGl0bGUiKQogICAgICAgICAgICAudGV4dCgiRG93bmxvYWQgUE5HIik7CgogICAgICAgIC8vIGJydXNoIHNlbGVjdGlvbiBidXR0b24KICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgInNlbGVjdGlvbkJ1dHRvbiIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gMipiaWdCdXR0b25XaWR0aCAtIHNtYWxsQnV0dG9uV2lkdGgpCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgMCkKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgc21hbGxCdXR0b25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGNvbmZpZy50b3BCYXJIZWlnaHQpCiAgICAgICAgICAgIC5hdHRyKCJyeCIsIDEwKQogICAgICAgICAgICAuYXR0cigicnkiLCAxMCkKICAgICAgICAgICAgLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKQogICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBidXR0b24gaXMgbm90IHNlbGVjdGVkCiAgICAgICAgICAgICAgICBpZiAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmJydXNoQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJIaWdobGlnaHQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGJ1dHRvbiBpcyBub3Qgc2VsZWN0ZWQKICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuYnJ1c2hCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHNjaXNzb3JzIGJ1dHRvbiBpcyBzZWxlY3RlZCwgdHVybiBvZmYgc2Npc3NvcnMKICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuc2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgX3B1c2hTY2lzc29yc0J1dHRvbihjdXJWaXpPYmopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gcHVzaCBzZWxlY3Rpb24gYnV0dG9uIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICBfcHVzaEJydXNoU2VsZWN0aW9uQnV0dG9uKGJydXNoLCBjdXJWaXpPYmopOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgIC50ZXh0KCJTZWxlY3QgU2luZ2xlIENlbGxzIGluIEhlYXRtYXAiKTsKICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCiAgICAgICAgICAgIC5hdHRyKCJ4bGluazpocmVmIiwgc2VsZWN0aW9uQnV0dG9uX2Jhc2U2NCkKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSAyKmJpZ0J1dHRvbldpZHRoIC0gc21hbGxCdXR0b25XaWR0aCArIChzbWFsbEJ1dHRvbldpZHRoIC0gc2VsZWN0aW9uQnV0dG9uSWNvbldpZHRoKS8yKQogICAgICAgICAgICAuYXR0cigieSIsIDcpCiAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIHNlbGVjdGlvbkJ1dHRvbkljb25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIHNlbGVjdGlvbkJ1dHRvbkljb25XaWR0aCkKICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgYnV0dG9uIGlzIG5vdCBzZWxlY3RlZAogICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5icnVzaEJ1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnNlbGVjdGlvbkJ1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFySGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBidXR0b24gaXMgbm90IHNlbGVjdGVkCiAgICAgICAgICAgICAgICBpZiAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLmJydXNoQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIuc2VsZWN0aW9uQnV0dG9uIikuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBzY2lzc29ycyBidXR0b24gaXMgc2VsZWN0ZWQsIHR1cm4gb2ZmIHNjaXNzb3JzCiAgICAgICAgICAgICAgICBpZiAoZDMuc2VsZWN0QWxsKCIuc2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgX3B1c2hTY2lzc29yc0J1dHRvbihjdXJWaXpPYmopOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgLy8gcHVzaCBzZWxlY3Rpb24gYnV0dG9uIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICBfcHVzaEJydXNoU2VsZWN0aW9uQnV0dG9uKGJydXNoLCBjdXJWaXpPYmopOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgIC50ZXh0KCJTZWxlY3QgU2luZ2xlIENlbGxzIGluIEhlYXRtYXAiKTsKCiAgICAgICAgLy8gc2Npc3NvcnMgYnV0dG9uCiAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJzY2lzc29yc0J1dHRvbiIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gMipiaWdCdXR0b25XaWR0aCAtIDIqc21hbGxCdXR0b25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoInkiLCAwKQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBzbWFsbEJ1dHRvbldpZHRoKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLnRvcEJhckhlaWdodCkKICAgICAgICAgICAgLmF0dHIoInJ4IiwgMTApCiAgICAgICAgICAgIC5hdHRyKCJyeSIsIDEwKQogICAgICAgICAgICAuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpCiAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGJ1dHRvbiBpcyBub3Qgc2VsZWN0ZWQKICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuc2Npc3NvcnNCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgYnV0dG9uIGlzIG5vdCBzZWxlY3RlZAogICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5zY2lzc29yc0J1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gaWYgYnJ1c2ggc2VsZWN0aW9uIGJ1dHRvbiBpcyBzZWxlY3RlZCwgdHVybiBpdCBvZmYKICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuYnJ1c2hCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgX2NsZWFyQnJ1c2goY3VyVml6T2JqLnZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgIF9wdXNoQnJ1c2hTZWxlY3Rpb25CdXR0b24oYnJ1c2gsIGN1clZpek9iaik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBwdXNoIHNjaXNzb3JzIGJ1dHRvbiBmdW5jdGlvbgogICAgICAgICAgICAgICAgX3B1c2hTY2lzc29yc0J1dHRvbihjdXJWaXpPYmopOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgIC50ZXh0KCJQcnVuZSBUcmVlL0dyYXBoIik7CiAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgiaW1hZ2UiKQogICAgICAgICAgICAuYXR0cigieGxpbms6aHJlZiIsIHNjaXNzb3JzQnV0dG9uX2Jhc2U2NCkKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSAyKmJpZ0J1dHRvbldpZHRoIC0gMipzbWFsbEJ1dHRvbldpZHRoICsgKHNtYWxsQnV0dG9uV2lkdGggLSBzY2lzc29yc0J1dHRvbkljb25XaWR0aCkvMikKICAgICAgICAgICAgLmF0dHIoInkiLCA3KQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBzY2lzc29yc0J1dHRvbkljb25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIHNjaXNzb3JzQnV0dG9uSWNvbldpZHRoKQogICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBidXR0b24gaXMgbm90IHNlbGVjdGVkCiAgICAgICAgICAgICAgICBpZiAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnNjaXNzb3JzQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIuc2Npc3NvcnNCdXR0b24iKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgYnV0dG9uIGlzIG5vdCBzZWxlY3RlZAogICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5zY2lzc29yc0J1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLnNjaXNzb3JzQnV0dG9uIikuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBpZiBicnVzaCBzZWxlY3Rpb24gYnV0dG9uIGlzIHNlbGVjdGVkLCB0dXJuIGl0IG9mZgogICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5icnVzaEJ1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICBfY2xlYXJCcnVzaChjdXJWaXpPYmoudmlld19pZCk7CiAgICAgICAgICAgICAgICAgICAgX3B1c2hCcnVzaFNlbGVjdGlvbkJ1dHRvbihicnVzaCwgY3VyVml6T2JqKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIC8vIHB1c2ggc2Npc3NvcnMgYnV0dG9uIGZ1bmN0aW9uCiAgICAgICAgICAgICAgICBfcHVzaFNjaXNzb3JzQnV0dG9uKGN1clZpek9iaik7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAgICAgLnRleHQoIlBydW5lIFRyZWUvR3JhcGgiKTsKCiAgICAgICAgLy8gZ3JhcGgvdHJlZSBidXR0b24KICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgImdyYXBoVHJlZUJ1dHRvbiIpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gMipiaWdCdXR0b25XaWR0aCAtIDMqc21hbGxCdXR0b25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoInkiLCAwKQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBzbWFsbEJ1dHRvbldpZHRoKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLnRvcEJhckhlaWdodCkKICAgICAgICAgICAgLmF0dHIoInJ4IiwgMTApCiAgICAgICAgICAgIC5hdHRyKCJyeSIsIDEwKQogICAgICAgICAgICAuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpCiAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJIaWdobGlnaHQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkMy5zZWxlY3QodGhpcykuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBzd2l0Y2ggYmV0d2VlbiB0cmVlIGFuZCBncmFwaCB2aWV3cwogICAgICAgICAgICAgICAgX3N3aXRjaFZpZXcoY3VyVml6T2JqKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgidGl0bGUiKQogICAgICAgICAgICAudGV4dCgiU3dpdGNoIFRyZWUvR3JhcGggVmlldyIpOwogICAgICAgIHRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKICAgICAgICAgICAgLmNsYXNzZWQoImZvcmNlRGlyZWN0ZWRJY29uIiwgdHJ1ZSkKICAgICAgICAgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBmb3JjZURpcmVjdGVkSWNvbl9iYXNlNjQpCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gMipiaWdCdXR0b25XaWR0aCAtIDMqc21hbGxCdXR0b25XaWR0aCArIChzbWFsbEJ1dHRvbldpZHRoIC0gZ3JhcGhUcmVlSWNvbldpZHRoKS8yKQogICAgICAgICAgICAuYXR0cigieSIsIDcpCiAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIGdyYXBoVHJlZUljb25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGdyYXBoVHJlZUljb25XaWR0aCkKICAgICAgICAgICAgLmF0dHIoIm9wYWNpdHkiLCAxKQogICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmdyYXBoVHJlZUJ1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFySGlnaGxpZ2h0KTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdCgiLmdyYXBoVHJlZUJ1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgLy8gc3dpdGNoIGJldHdlZW4gdHJlZSBhbmQgZ3JhcGggdmlld3MKICAgICAgICAgICAgICAgIF9zd2l0Y2hWaWV3KGN1clZpek9iaik7CiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAgICAgLnRleHQoIlN3aXRjaCBUcmVlL0dyYXBoIFZpZXciKTsKICAgICAgICB0b3BCYXJTVkcuYXBwZW5kKCJpbWFnZSIpCiAgICAgICAgICAgIC5jbGFzc2VkKCJwaHlsb2dlbnlJY29uIiwgdHJ1ZSkKICAgICAgICAgICAgLmF0dHIoInhsaW5rOmhyZWYiLCBwaHlsb2dlbnlJY29uX2Jhc2U2NCkKICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSAyKmJpZ0J1dHRvbldpZHRoIC0gMypzbWFsbEJ1dHRvbldpZHRoICsgKHNtYWxsQnV0dG9uV2lkdGggLSBncmFwaFRyZWVJY29uV2lkdGgpLzIpCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgNykKICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgZ3JhcGhUcmVlSWNvbldpZHRoKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgZ3JhcGhUcmVlSWNvbldpZHRoKQogICAgICAgICAgICAuYXR0cigib3BhY2l0eSIsIDApCiAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIuZ3JhcGhUcmVlQnV0dG9uIikuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJIaWdobGlnaHQpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIuZ3JhcGhUcmVlQnV0dG9uIikuYXR0cigiZmlsbCIsIGNvbmZpZy50b3BCYXJDb2xvdXIpOwogICAgICAgICAgICB9KQogICAgICAgICAgICAub24oImNsaWNrIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAvLyBzd2l0Y2ggYmV0d2VlbiB0cmVlIGFuZCBncmFwaCB2aWV3cwogICAgICAgICAgICAgICAgX3N3aXRjaFZpZXcoY3VyVml6T2JqKTsKICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmFwcGVuZCgidGl0bGUiKQogICAgICAgICAgICAudGV4dCgiU3dpdGNoIFRyZWUvR3JhcGggVmlldyIpOwoKICAgICAgICAvLyBydWxlciBpY29uIGJ1dHRvbgogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5kaXN0YW5jZXNfcHJvdmlkZWQpIHsKICAgICAgICAgICAgdG9wQmFyU1ZHLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAicnVsZXJCdXR0b24iKQogICAgICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcud2lkdGggLSAyKmJpZ0J1dHRvbldpZHRoIC0gNCpzbWFsbEJ1dHRvbldpZHRoKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCAwKQogICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgc21hbGxCdXR0b25XaWR0aCkKICAgICAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBjb25maWcudG9wQmFySGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoInJ4IiwgMTApCiAgICAgICAgICAgICAgICAuYXR0cigicnkiLCAxMCkKICAgICAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cikKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBidXR0b24gaXMgbm90IHNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5ydWxlckJ1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCh0aGlzKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckhpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGJ1dHRvbiBpcyBub3Qgc2VsZWN0ZWQKICAgICAgICAgICAgICAgICAgICBpZiAoZDMuc2VsZWN0KCIjIiArIHZpZXdfaWQpLnNlbGVjdEFsbCgiLnJ1bGVyQnV0dG9uU2VsZWN0ZWQiKVswXS5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgZDMuc2VsZWN0KHRoaXMpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFyQ29sb3VyKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLm9uKCJjbGljayIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIGJydXNoIHNlbGVjdGlvbiBidXR0b24gaXMgc2VsZWN0ZWQsIHR1cm4gaXQgb2ZmCiAgICAgICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5icnVzaEJ1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3B1c2hCcnVzaFNlbGVjdGlvbkJ1dHRvbihicnVzaCwgY3VyVml6T2JqKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgLy8gc2NhbGUgb3IgdW5zY2FsZSB0cmVlCiAgICAgICAgICAgICAgICAgICAgX3NjYWxlVHJlZShjdXJWaXpPYmopOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5hcHBlbmQoInRpdGxlIikKICAgICAgICAgICAgICAgIC50ZXh0KCJTY2FsZSBUcmVlL0dyYXBoIik7CiAgICAgICAgICAgIHRvcEJhclNWRy5hcHBlbmQoImltYWdlIikKICAgICAgICAgICAgICAgIC5hdHRyKCJ4bGluazpocmVmIiwgcnVsZXJJY29uX2Jhc2U2NCkKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLndpZHRoIC0gMipiaWdCdXR0b25XaWR0aCAtIDQqc21hbGxCdXR0b25XaWR0aCArIChzbWFsbEJ1dHRvbldpZHRoIC0gcnVsZXJJY29uV2lkdGgpLzIpCiAgICAgICAgICAgICAgICAuYXR0cigieSIsIDUpCiAgICAgICAgICAgICAgICAuYXR0cigid2lkdGgiLCBydWxlckljb25XaWR0aCkKICAgICAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBydWxlckljb25XaWR0aCkKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gaWYgdGhpcyBidXR0b24gaXMgbm90IHNlbGVjdGVkCiAgICAgICAgICAgICAgICAgICAgaWYgKGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3RBbGwoIi5ydWxlckJ1dHRvblNlbGVjdGVkIilbMF0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGQzLnNlbGVjdCgiIyIgKyB2aWV3X2lkKS5zZWxlY3QoIi5ydWxlckJ1dHRvbiIpLmF0dHIoImZpbGwiLCBjb25maWcudG9wQmFySGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgIC8vIGlmIHRoaXMgYnV0dG9uIGlzIG5vdCBzZWxlY3RlZAogICAgICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIucnVsZXJCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0KCIucnVsZXJCdXR0b24iKS5hdHRyKCJmaWxsIiwgY29uZmlnLnRvcEJhckNvbG91cik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5vbigiY2xpY2siLCBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAvLyBpZiBicnVzaCBzZWxlY3Rpb24gYnV0dG9uIGlzIHNlbGVjdGVkLCB0dXJuIGl0IG9mZgogICAgICAgICAgICAgICAgICAgIGlmIChkMy5zZWxlY3QoIiMiICsgdmlld19pZCkuc2VsZWN0QWxsKCIuYnJ1c2hCdXR0b25TZWxlY3RlZCIpWzBdLmxlbmd0aCA9PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9wdXNoQnJ1c2hTZWxlY3Rpb25CdXR0b24oYnJ1c2gsIGN1clZpek9iaik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIC8vIHNjYWxlIG9yIHVuc2NhbGUgdHJlZQogICAgICAgICAgICAgICAgICAgIF9zY2FsZVRyZWUoY3VyVml6T2JqKTsKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuYXBwZW5kKCJ0aXRsZSIpCiAgICAgICAgICAgICAgICAudGV4dCgiU2NhbGUgVHJlZS9HcmFwaCIpOwogICAgICAgIH0KCiAgICAgICAgLy8gVE9PTFRJUCBGVU5DVElPTlMKCiAgICAgICAgLy8gc2luZ2xlIGNlbGwgbm9kZSB0aXAKICAgICAgICBjdXJWaXpPYmoubm9kZVRpcCA9IGQzLnRpcCgpCiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKQogICAgICAgICAgICAub2Zmc2V0KFstMTAsIDBdKQogICAgICAgICAgICAuaHRtbChmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxzdHJvbmc+IiArIGN1clZpek9iai51c2VyQ29uZmlnLm5vZGVfdHlwZSArICI6PC9zdHJvbmc+IDxzcGFuIHN0eWxlPSdjb2xvcjp3aGl0ZSc+IiArIAogICAgICAgICAgICAgICAgICAgIGQgKyAiPC9zcGFuPiI7CiAgICAgICAgICAgIH0pOwogICAgICAgIGN1clZpek9iai52aWV3LnRyZWVTVkcuY2FsbChjdXJWaXpPYmoubm9kZVRpcCk7CgogICAgICAgIC8vIG11dGF0aW9uIHNpdGUgdGlwCiAgICAgICAgY3VyVml6T2JqLm11dFRpcCA9IGQzLnRpcCgpCiAgICAgICAgICAgIC5hdHRyKCdjbGFzcycsICdkMy10aXAnKQogICAgICAgICAgICAub2Zmc2V0KFstMTAsIDBdKQogICAgICAgICAgICAuaHRtbChmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gIjxzdHJvbmc+U2l0ZTo8L3N0cm9uZz4gPHNwYW4gc3R5bGU9J2NvbG9yOndoaXRlJz4iICsgZCArICI8L3NwYW4+IjsKICAgICAgICAgICAgfSk7CiAgICAgICAgY3VyVml6T2JqLnZpZXcuY252U1ZHLmNhbGwoY3VyVml6T2JqLm11dFRpcCk7CgogICAgICAgIC8vIG11dGF0aW9uIHZhbHVlIHRpcAogICAgICAgIGN1clZpek9iai52YWxUaXAgPSBkMy50aXAoKQogICAgICAgICAgICAuYXR0cignY2xhc3MnLCAnZDMtdGlwJykKICAgICAgICAgICAgLm9mZnNldChbLTEwLCAwXSkKICAgICAgICAgICAgLmh0bWwoZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICI8c3Ryb25nPiIgKyBjdXJWaXpPYmoudXNlckNvbmZpZy52YWx1ZV90eXBlICsgIjo8L3N0cm9uZz4gPHNwYW4gc3R5bGU9J2NvbG9yOndoaXRlJz4iICsgCiAgICAgICAgICAgICAgICAgICAgZCArICI8L3NwYW4+IjsKICAgICAgICAgICAgfSk7CiAgICAgICAgY3VyVml6T2JqLnZpZXcuY252U1ZHLmNhbGwoY3VyVml6T2JqLnZhbFRpcCk7CgogICAgICAgIC8vIFBMT1QgQ05WIAoKICAgICAgICB2YXIgZ3JpZENlbGxzRyA9IGN1clZpek9iai52aWV3LmNudlNWRwogICAgICAgICAgICAuYXBwZW5kKCJnIikKICAgICAgICAgICAgLmNsYXNzZWQoImdyaWRDZWxscyIsIHRydWUpCgogICAgICAgIC8vIGZvciBlYWNoIHNpbmdsZSBjZWxsCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjdXJWaXpPYmouZGF0YS5obV9zY19pZHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgdmFyIGN1cl9zYyA9IGN1clZpek9iai5kYXRhLmhtX3NjX2lkc1tpXTsKICAgICAgICAgICAgdmFyIGN1cl9kYXRhID0gY3VyVml6T2JqLnVzZXJDb25maWcuaGVhdG1hcF9pbmZvW1tjdXJfc2NdXTsgCgogICAgICAgICAgICAvLyBpZiB0aGlzIHNpbmdsZSBjZWxsIGhhcyBoZWF0bWFwIGRhdGEsIHBsb3QgdGhlIGRhdGEKICAgICAgICAgICAgaWYgKGN1cl9kYXRhKSB7CiAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZ3JpZENlbGxzRwogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoImciKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJncmlkQ2VsbEcgc2NfIiArIGN1cl9zYykKICAgICAgICAgICAgICAgICAgICAuc2VsZWN0QWxsKCIuZ3JpZENlbGwuc2NfIiArIGN1cl9zYykKICAgICAgICAgICAgICAgICAgICAuZGF0YShjdXJfZGF0YSkKICAgICAgICAgICAgICAgICAgICAuZW50ZXIoKQogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2Vub3R5cGUgYW5ub3RhdGlvbgogICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2Vub3R5cGU7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJWaXpPYmoudmlldy5ndHlwZXNTcGVjaWZpZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHRoYXQgdGhpcyBzaW5nbGUgY2VsbCBoYXMgYSBnZW5vdHlwZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNjX3dfZ3R5cGUgPSBfLmZpbmRXaGVyZShjdXJWaXpPYmoudXNlckNvbmZpZy5zY19hbm5vdCwge3NpbmdsZV9jZWxsX2lkOiBkLnNjX2lkfSk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5vdHlwZSA9IChzY193X2d0eXBlKSA/IHNjX3dfZ3R5cGUuZ2Vub3R5cGUgOiAibm9uZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5vdHlwZSA9ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgbXV0ID0gKGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBfdHlwZSA9PSAidGFyZ2V0ZWQiKSA/IGQuc2l0ZS5yZXBsYWNlKCI6IiwiY29vcmQiKSA6ICJub25lIjsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJncmlkQ2VsbCBzY18iICsgZC5zY19pZCArICIgZ3R5cGVfIiArIGdlbm90eXBlICsgIiBtdXRfIiArIG11dDsKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQueDsgCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIGQueSA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnNjX2lkXTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGQueTsgCiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ3aWR0aCIsIGZ1bmN0aW9uKGQpIHsgCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkLnB4X3dpZHRoOyAKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29sb3Igc2NhbGUKICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGN1cl9jb2xvcnNjYWxlID0gKGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBfdHlwZSA9PSAiY252IikgPwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY252Q29sb3JTY2FsZSA6IHRhcmdldGVkQ29sb3JTY2FsZTsKCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG5vIGRhdGEKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZihkLmdyaWRDZWxsX3ZhbHVlKSA9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ3aGl0ZSI7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNudiBkYXRhLCBidXQgYWJvdmUgbWF4IGNudiB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5oZWF0bWFwX3R5cGUgPT0gImNudiIgJiYgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZC5ncmlkQ2VsbF92YWx1ZSA+IG1heENOVikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN1cl9jb2xvcnNjYWxlKG1heENOVik7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlZ3VsYXIgZGF0YQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyX2NvbG9yc2NhbGUoZC5ncmlkQ2VsbF92YWx1ZSk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9tb3VzZW92ZXJOb2RlKGQuc2NfaWQsIHZpZXdfaWQsIGN1clZpek9iai5ub2RlVGlwLCBjb25maWcuc3dpdGNoVmlldywgY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QpOwoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZvciB0YXJnZXRlZCBtdXRhdGlvbnMsIHNob3cgbXV0YXRpb24gdG9vbHRpcCBvbiB0b3Agb2YgdGhlIGZpcnN0IHJvdyBpbiB0aGUgaGVhdG1hcAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLmhlYXRtYXBfdHlwZSA9PSAidGFyZ2V0ZWQiKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLm11dFRpcC5zaG93KGQuc2l0ZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lckRJVi5zZWxlY3QoIi5ncmlkQ2VsbC5zY18iICsgY3VyVml6T2JqLmRhdGEuaG1fc2NfaWRzWzBdICsgIi5tdXRfIiArIGQuc2l0ZS5yZXBsYWNlKCI6IiwiY29vcmQiKSkubm9kZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IG11dGF0aW9uIHZhbHVlIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLnZhbFRpcC5zaG93KGQuZ3JpZENlbGxfdmFsdWUpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoX2NoZWNrRm9yU2VsZWN0aW9ucyh2aWV3X2lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3V0Tm9kZShkLnNjX2lkLCBjdXJWaXpPYmoudmlld19pZCwgY3VyVml6T2JqLm5vZGVUaXApOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VyVml6T2JqLm11dFRpcC5oaWRlKCk7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJWaXpPYmoudmFsVGlwLmhpZGUoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICAvLyBQTE9UIENIUk9NT1NPTUUgTEVHRU5ECiAgICAgICAgLy8gbm90ZSB5LWNvb3JkaW5hdGUgZm9yIGNocm9tb3NvbWUgbGVnZW5kCiAgICAgICAgY29uZmlnLmNocm9tTGVnZW5kU3RhcnRZQ29vcmQgPSBjb25maWcucGFkZGluZ0dlbmVyYWwgKyBjb25maWcuc3BhY2luZ0ZvclRpdGxlICsgY29uZmlnLmhtSGVpZ2h0IC0gY29uZmlnLmNocm9tTGVnZW5kSGVpZ2h0OwogICAgICAgIHZhciBjaHJvbUJveGVzID0gY3VyVml6T2JqLnZpZXcuY252U1ZHCiAgICAgICAgICAgIC5hcHBlbmQoImciKQogICAgICAgICAgICAuY2xhc3NlZCgiY2hyb21MZWdlbmQiLCB0cnVlKQogICAgICAgICAgICAuc2VsZWN0QWxsKCIuY2hyb21Cb3hHIikKICAgICAgICAgICAgLmRhdGEoY3VyVml6T2JqLnVzZXJDb25maWcuY2hyb21fYm94ZXMpCiAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgiZyIpCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJjaHJvbUJveEciKQoKICAgICAgICB2YXIgbmV4dENvbG91ciA9ICIjRkZGRkZGIjsKICAgICAgICBjaHJvbUJveGVzLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJjaHJvbUJveCBjaHIiICsgZC5jaHI7IH0pCiAgICAgICAgICAgIC5hdHRyKCJ4IiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC54OyB9KQogICAgICAgICAgICAuYXR0cigieSIsIGNvbmZpZy5jaHJvbUxlZ2VuZFN0YXJ0WUNvb3JkKQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLmNocm9tTGVnZW5kSGVpZ2h0KQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLndpZHRoOyB9KQogICAgICAgICAgICAuc3R5bGUoImZpbGwiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgaWYgKG5leHRDb2xvdXIgPT0gIiNGRkZGRkYiKQogICAgICAgICAgICAgICAgICAgIG5leHRDb2xvdXIgPSAiI0Y3RjdGNyI7CiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgbmV4dENvbG91ciA9ICIjRkZGRkZGIjsKICAgICAgICAgICAgICAgIHJldHVybiBuZXh0Q29sb3VyOwogICAgICAgICAgICB9KQoKICAgICAgICBjaHJvbUJveGVzLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJjaHJvbUJveFRleHQgY2hyIiArIGQuY2hyOyB9KQogICAgICAgICAgICAuYXR0cigieCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQueCArIChkLndpZHRoIC8gMik7IH0pCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgY29uZmlnLmNocm9tTGVnZW5kU3RhcnRZQ29vcmQgKyAoY29uZmlnLmNocm9tTGVnZW5kSGVpZ2h0IC8gMikpCiAgICAgICAgICAgIC5hdHRyKCJkeSIsICIuMzVlbSIpCiAgICAgICAgICAgIC5hdHRyKCJ0ZXh0LWFuY2hvciIsICJtaWRkbGUiKQogICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAudGV4dChmdW5jdGlvbihkKSB7IHJldHVybiBkLmNocjsgfSkKICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsICI4cHgiKTsKCiAgICAgICAgLy8gUExPVCBJTkRJQ0FUT1IgUkVDVEFOR0xFUwoKICAgICAgICB2YXIgaW5kaWNhdG9ycyA9IGN1clZpek9iai52aWV3LmluZGljYXRvclNWRwogICAgICAgICAgICAuYXBwZW5kKCJnIikKICAgICAgICAgICAgLmNsYXNzZWQoImluZGljYXRvcnMiLCB0cnVlKQogICAgICAgICAgICAuc2VsZWN0QWxsKCIuaW5kaWMiKQogICAgICAgICAgICAuZGF0YShjdXJWaXpPYmouZGF0YS5obV9zY19pZHMpCiAgICAgICAgICAgIC5lbnRlcigpCiAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICB2YXIgZ3R5cGUgPSBfZ2V0R2Vub3R5cGUoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QsIGQpOwogICAgICAgICAgICAgICAgdmFyIHRwID0gX2dldFRQKGN1clZpek9iai51c2VyQ29uZmlnLnNjX2Fubm90LCBkKTsKICAgICAgICAgICAgICAgIHJldHVybiAiaW5kaWMgc2NfIiArIGQgKyAiIGd0eXBlXyIgKyBndHlwZSArICIgdHBfIiArIHRwOwogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cigieCIsIDApCiAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgIHJldHVybiBjdXJWaXpPYmouZGF0YS55Q29vcmRpbmF0ZXNbZF07IAogICAgICAgICAgICB9KQogICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0KQogICAgICAgICAgICAuYXR0cigid2lkdGgiLCBjb25maWcuYW5ub3RDb2xXaWR0aCkKICAgICAgICAgICAgLmF0dHIoImZpbGwiLCBjb25maWcuaGlnaGxpZ2h0Q29sb3VyKQogICAgICAgICAgICAuYXR0cigiZmlsbC1vcGFjaXR5IiwgMCkKICAgICAgICAgICAgLmF0dHIoInN0cm9rZSIsICJub25lIik7CiAgICAgICAgCiAgICAgICAgCiAgICAgICAgLy8gUExPVCBHUk9VUCBBTk5PVEFUSU9OIENPTFVNTgoKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkKSB7CgogICAgICAgICAgICB2YXIgZ3R5cGVBbm5vdCA9IGN1clZpek9iai52aWV3Lmd0eXBlQW5ub3RTVkcKICAgICAgICAgICAgICAgIC5hcHBlbmQoImciKQogICAgICAgICAgICAgICAgLmNsYXNzZWQoImd0eXBlQW5ub3RHIiwgdHJ1ZSkKICAgICAgICAgICAgICAgIC5zZWxlY3RBbGwoIi5ndHlwZUFubm90IikKICAgICAgICAgICAgICAgIC5kYXRhKGN1clZpek9iai51c2VyQ29uZmlnLnNjX2Fubm90KQogICAgICAgICAgICAgICAgLmVudGVyKCkKICAgICAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAiZ3R5cGVBbm5vdCBndHlwZV8iICsgZC5nZW5vdHlwZSArICIgc2NfIiArIGQuc2luZ2xlX2NlbGxfaWQ7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoIngiLCAwKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgICAgIGQueSA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnNpbmdsZV9jZWxsX2lkXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC55OyAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLmFubm90Q29sV2lkdGgpCiAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcuY29sb3VyX2Fzc2lnbm1lbnRbZC5nZW5vdHlwZV07CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoInN0cm9rZSIsICJub25lIikKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdmVyIiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9tb3VzZW92ZXJOb2RlKGQuc2luZ2xlX2NlbGxfaWQsIHZpZXdfaWQsIGN1clZpek9iai5ub2RlVGlwLCBjb25maWcuc3dpdGNoVmlldywgY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9tb3VzZW91dE5vZGUoZC5zaW5nbGVfY2VsbF9pZCwgY3VyVml6T2JqLnZpZXdfaWQsIGN1clZpek9iai5ub2RlVGlwKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9CgogICAgICAgIC8vIFBMT1QgVElNRVBPSU5UIEFOTk9UQVRJT04gQ09MVU1OCgogICAgICAgIGlmIChjdXJWaXpPYmoudmlldy50cHNTcGVjaWZpZWQpIHsKCiAgICAgICAgICAgIHZhciB0cEFubm90ID0gY3VyVml6T2JqLnZpZXcudHBBbm5vdFNWRwogICAgICAgICAgICAgICAgLmFwcGVuZCgiZyIpCiAgICAgICAgICAgICAgICAuY2xhc3NlZCgidHBBbm5vdEciLCB0cnVlKQogICAgICAgICAgICAgICAgLnNlbGVjdEFsbCgiLnRwQW5ub3QiKQogICAgICAgICAgICAgICAgLmRhdGEoY3VyVml6T2JqLnVzZXJDb25maWcuc2NfYW5ub3QpCiAgICAgICAgICAgICAgICAuZW50ZXIoKQogICAgICAgICAgICAgICAgLmFwcGVuZCgicmVjdCIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICJ0cEFubm90IHRwXyIgKyBkLnRpbWVwb2ludCArICIgc2NfIiArIGQuc2luZ2xlX2NlbGxfaWQ7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoIngiLCAwKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbihkKSB7IAogICAgICAgICAgICAgICAgICAgIGQueSA9IGN1clZpek9iai5kYXRhLnlDb29yZGluYXRlc1tkLnNpbmdsZV9jZWxsX2lkXTsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZC55OyAKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY3VyVml6T2JqLnZpZXcuaG0ucm93SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLmFubm90Q29sV2lkdGgpCiAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcudHBfY29sb3VyU2NhbGUoZC50aW1lcG9pbnQpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJzdHJva2UiLCAibm9uZSIpCiAgICAgICAgICAgICAgICAub24oIm1vdXNlb3ZlciIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NoZWNrRm9yU2VsZWN0aW9ucyh2aWV3X2lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfbW91c2VvdmVyTm9kZShkLnNpbmdsZV9jZWxsX2lkLCB2aWV3X2lkLCBjdXJWaXpPYmoubm9kZVRpcCwgY29uZmlnLnN3aXRjaFZpZXcsIGN1clZpek9iai51c2VyQ29uZmlnLnNjX2Fubm90KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW91dCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoX2NoZWNrRm9yU2VsZWN0aW9ucyh2aWV3X2lkKSkgewogICAgICAgICAgICAgICAgICAgICAgICBfbW91c2VvdXROb2RlKGQuc2luZ2xlX2NlbGxfaWQsIGN1clZpek9iai52aWV3X2lkLCBjdXJWaXpPYmoubm9kZVRpcCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgfQoKICAgICAgICAvLyBQTE9UIENMQVNTSUNBTCBQSFlMT0dFTlkgJiBGT1JDRSBESVJFQ1RFRCBHUkFQSAoKICAgICAgICBfcGxvdEZvcmNlRGlyZWN0ZWRHcmFwaChjdXJWaXpPYmopOyAvLyBvcmlnaW5hbGx5IGZvcmNlLWRpcmVjdGVkIGdyYXBoIGhhcyBvcGFjaXR5IG9mIDAKICAgICAgICBfcGxvdEFsaWduZWRQaHlsb2dlbnkoY3VyVml6T2JqKTsKCiAgICAgICAgLy8gUExPVCBIRUFUTUFQIExFR0VORAoKICAgICAgICAvLyBoZWF0bWFwIGxlZ2VuZCB0aXRsZQogICAgICAgIGN1clZpek9iai52aWV3LmNudkxlZ2VuZFNWRy5hcHBlbmQoInRleHQiKQogICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCkKICAgICAgICAgICAgLmF0dHIoInkiLCBjb25maWcuaGVhdG1hcExlZ2VuZFN0YXJ0WSkgCiAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC43MWVtIikKICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgLmF0dHIoImZvbnQtd2VpZ2h0IiwgImJvbGQiKQogICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0KQogICAgICAgICAgICAudGV4dChjdXJWaXpPYmoudXNlckNvbmZpZy52YWx1ZV90eXBlKTsKCiAgICAgICAgLy8gc3RhcnRpbmcgeS1jb29yZGluYXRlIGZvciB0aGUgaGVhdG1hcCByZWN0YW5nbGUocykgaW4gbGVnZW5kCiAgICAgICAgdmFyIGxlZ2VuZFJlY3RTdGFydCA9IGNvbmZpZy5oZWF0bWFwTGVnZW5kU3RhcnRZICsgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKjI7CiAgICAgICAgCiAgICAgICAgLy8gaGVpZ2h0IGZvciBjb250aW51b3VzIGNudiBkYXRhIGxlZ2VuZCByZWN0YW5nbGUgKG1ha2UgaXQgdGhlIHNhbWUgYXMgdGhlIGRpc2NyZXRlIENOViBsZWdlbmQgaGVpZ2h0KQogICAgICAgIHZhciBsZWdlbmRSZWN0SGVpZ2h0ID0gKG1heENOVisxKSooY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpOwoKCiAgICAgICAgLy8gQ05WIExFR0VORAogICAgICAgIGlmIChjdXJWaXpPYmoudXNlckNvbmZpZy5oZWF0bWFwX3R5cGUgPT0gImNudiIpIHsKCiAgICAgICAgICAgIC8vIENPTlRJTlVPVVMgREFUQQogICAgICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcuY29udGludW91c19jbnYpIHsKICAgICAgICAgICAgICAgIC8vIDIvbWF4Q05WIAogICAgICAgICAgICAgICAgdmFyIG5vcm1hbF9yZWxhdGl2ZSA9ICgyL21heENOVik7CgogICAgICAgICAgICAgICAgLy8gbGluZWFyIGdyYWRpZW50IGZvciBmaWxsIG9mIHRhcmdldGVkIG11dGF0aW9uIGxlZ2VuZAogICAgICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcuY252TGVnZW5kU1ZHCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgibGluZWFyR3JhZGllbnQiKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJpZCIsICJ0YXJnZXRlZEdyYWRpZW50IikKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZ3JhZGllbnRVbml0cyIsICJ1c2VyU3BhY2VPblVzZSIpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoIngxIiwgMCkuYXR0cigieTEiLCBsZWdlbmRSZWN0U3RhcnQpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoIngyIiwgMCkuYXR0cigieTIiLCBsZWdlbmRSZWN0U3RhcnQgKyBsZWdlbmRSZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIC5zZWxlY3RBbGwoInN0b3AiKQogICAgICAgICAgICAgICAgICAgIC5kYXRhKFsKICAgICAgICAgICAgICAgICAgICAgICAge29mZnNldDogIjAlIiwgY29sb3I6IGRpc2NyZXRlX2NvbG91cnNbMl19LAogICAgICAgICAgICAgICAgICAgICAgICB7b2Zmc2V0OiAoKCgxIC0gbm9ybWFsX3JlbGF0aXZlKSoxMDApICsgIiUiKSwgY29sb3I6IGRpc2NyZXRlX2NvbG91cnNbMV19LCAKICAgICAgICAgICAgICAgICAgICAgICAge29mZnNldDogIjEwMCUiLCBjb2xvcjogZGlzY3JldGVfY29sb3Vyc1swXX0KICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgIC5lbnRlcigpLmFwcGVuZCgic3RvcCIpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoIm9mZnNldCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQub2Zmc2V0OyB9KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJzdG9wLWNvbG9yIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gZC5jb2xvcjsgfSk7CgogICAgICAgICAgICAgICAgLy8gbGVnZW5kIHJlY3RhbmdsZSB3aXRoIGdyYWRpZW50CiAgICAgICAgICAgICAgICBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCkKICAgICAgICAgICAgICAgICAgICAuYXR0cigieSIsIGxlZ2VuZFJlY3RTdGFydCkKICAgICAgICAgICAgICAgICAgICAuYXR0cigid2lkdGgiLCBjb25maWcucmVjdEhlaWdodCkKICAgICAgICAgICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgbGVnZW5kUmVjdEhlaWdodCkKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsICJ1cmwoI3RhcmdldGVkR3JhZGllbnQpIik7CgogICAgICAgICAgICAgICAgLy8gbGVnZW5kIHRleHQKICAgICAgICAgICAgICAgIGN1clZpek9iai52aWV3LmNudkxlZ2VuZFNWRwogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoInRleHQiKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsICsgY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoInkiLCBsZWdlbmRSZWN0U3RhcnQpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImR5IiwgIiswLjcxZW0iKQogICAgICAgICAgICAgICAgICAgIC50ZXh0KCI+PSIgKyBtYXhDTlYpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCJmaWxsIiwgImJsYWNrIik7CiAgICAgICAgICAgICAgICBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5yZWN0SGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgbGVnZW5kUmVjdFN0YXJ0ICsgKDEtbm9ybWFsX3JlbGF0aXZlKSpsZWdlbmRSZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKICAgICAgICAgICAgICAgICAgICAudGV4dCgiMiIpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCJmaWxsIiwgImJsYWNrIik7CiAgICAgICAgICAgICAgICBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5yZWN0SGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgbGVnZW5kUmVjdFN0YXJ0ICsgbGVnZW5kUmVjdEhlaWdodCkKICAgICAgICAgICAgICAgICAgICAudGV4dCgiMCIpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgLnN0eWxlKCJmaWxsIiwgImJsYWNrIik7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIC8vIERJU0NSRVRFIERBVEEKICAgICAgICAgICAgZWxzZSB7CgogICAgICAgICAgICAgICAgLy8gaGVhdG1hcCBsZWdlbmQgcmVjdGFuZ2xlIC8gdGV4dCBnZW5vdHlwZQogICAgICAgICAgICAgICAgdmFyIGhlYXRtYXBMZWdlbmRHID0gY3VyVml6T2JqLnZpZXcuY252TGVnZW5kU1ZHCiAgICAgICAgICAgICAgICAgICAgLnNlbGVjdEFsbCgiLmhlYXRtYXBMZWdlbmRHIikKICAgICAgICAgICAgICAgICAgICAuZGF0YShjbnZDb2xvclNjYWxlLmRvbWFpbigpKQogICAgICAgICAgICAgICAgICAgIC5lbnRlcigpCiAgICAgICAgICAgICAgICAgICAgLmFwcGVuZCgiZyIpCiAgICAgICAgICAgICAgICAgICAgLmNsYXNzZWQoImhlYXRtYXBMZWdlbmRHIiwgdHJ1ZSk7CgogICAgICAgICAgICAgICAgLy8gQ05WIGxlZ2VuZCByZWN0YW5nbGVzCiAgICAgICAgICAgICAgICBoZWF0bWFwTGVnZW5kRwogICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCxpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBsZWdlbmRSZWN0U3RhcnQgKyBpKihjb25maWcucmVjdEhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyk7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuYXR0cigiaGVpZ2h0IiwgY29uZmlnLnJlY3RIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLnJlY3RIZWlnaHQpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImZpbGwiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjbnZDb2xvclNjYWxlKGQpOwogICAgICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIC8vIENOViBsZWdlbmQgdGV4dAogICAgICAgICAgICAgICAgaGVhdG1hcExlZ2VuZEcKICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5yZWN0SGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCxpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuaGVhdG1hcExlZ2VuZFN0YXJ0WSArIGNvbmZpZy5sZWdlbmRUaXRsZUhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyoyICsgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpKihjb25maWcucmVjdEhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZykgKyAoY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQvMik7CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAuYXR0cigiZHkiLCAiKzAuMzVlbSIpCiAgICAgICAgICAgICAgICAgICAgLnRleHQoZnVuY3Rpb24oZCkgeyAKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGQ9PW1heENOVikgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuICI+PSIgKyBkOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBkOyAKICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0KQogICAgICAgICAgICAgICAgICAgIC5zdHlsZSgiZmlsbCIsICJibGFjayIpOwogICAgICAgICAgICB9CgogICAgICAgIH0KICAgICAgICAvLyBUQVJHRVRFRCBIRUFUTUFQIExFR0VORAogICAgICAgIGVsc2UgewogICAgICAgICAgICAvLyBsaW5lYXIgZ3JhZGllbnQgZm9yIGZpbGwgb2YgdGFyZ2V0ZWQgbXV0YXRpb24gbGVnZW5kCiAgICAgICAgICAgIGN1clZpek9iai52aWV3LmNudkxlZ2VuZFNWRy5hcHBlbmQoImxpbmVhckdyYWRpZW50IikKICAgICAgICAgICAgICAgIC5hdHRyKCJpZCIsICJ0YXJnZXRlZEdyYWRpZW50IikKICAgICAgICAgICAgICAgIC5hdHRyKCJncmFkaWVudFVuaXRzIiwgInVzZXJTcGFjZU9uVXNlIikKICAgICAgICAgICAgICAgIC5hdHRyKCJ4MSIsIDApLmF0dHIoInkxIiwgbGVnZW5kUmVjdFN0YXJ0KQogICAgICAgICAgICAgICAgLmF0dHIoIngyIiwgMCkuYXR0cigieTIiLCBsZWdlbmRSZWN0U3RhcnQgKyBsZWdlbmRSZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgLnNlbGVjdEFsbCgic3RvcCIpCiAgICAgICAgICAgICAgICAuZGF0YShbCiAgICAgICAgICAgICAgICAgICAge29mZnNldDogIjAlIiwgY29sb3I6IHRhcmdldGVkX2NvbG91cnNbMl19LAogICAgICAgICAgICAgICAgICAgIHtvZmZzZXQ6ICI1MCUiLCBjb2xvcjogdGFyZ2V0ZWRfY29sb3Vyc1sxXX0sCiAgICAgICAgICAgICAgICAgICAge29mZnNldDogIjEwMCUiLCBjb2xvcjogdGFyZ2V0ZWRfY29sb3Vyc1swXX0KICAgICAgICAgICAgICAgIF0pCiAgICAgICAgICAgICAgICAuZW50ZXIoKS5hcHBlbmQoInN0b3AiKQogICAgICAgICAgICAgICAgLmF0dHIoIm9mZnNldCIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQub2Zmc2V0OyB9KQogICAgICAgICAgICAgICAgLmF0dHIoInN0b3AtY29sb3IiLCBmdW5jdGlvbihkKSB7IHJldHVybiBkLmNvbG9yOyB9KTsKCiAgICAgICAgICAgIC8vIFZBRiBsZWdlbmQgcmVjdGFuZ2xlIHdpdGggZ3JhZGllbnQKICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcuY252TGVnZW5kU1ZHCiAgICAgICAgICAgICAgICAuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBsZWdlbmRSZWN0U3RhcnQpCiAgICAgICAgICAgICAgICAuYXR0cigid2lkdGgiLCBjb25maWcucmVjdEhlaWdodCkKICAgICAgICAgICAgICAgIC5hdHRyKCJoZWlnaHQiLCBsZWdlbmRSZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoImZpbGwiLCAidXJsKCN0YXJnZXRlZEdyYWRpZW50KSIpOwoKICAgICAgICAgICAgLy8gVkFGIGxlZ2VuZCB0ZXh0CiAgICAgICAgICAgIGN1clZpek9iai52aWV3LmNudkxlZ2VuZFNWRwogICAgICAgICAgICAgICAgLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiVkFGbGVnZW5kVGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5yZWN0SGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBsZWdlbmRSZWN0U3RhcnQpCiAgICAgICAgICAgICAgICAuYXR0cigiZHkiLCAiKzAuNzFlbSIpCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQogICAgICAgICAgICAgICAgLnRleHQoIjEiKTsKICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcuY252TGVnZW5kU1ZHCiAgICAgICAgICAgICAgICAuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsICJWQUZsZWdlbmRUZXh0IikKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsICsgY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpCiAgICAgICAgICAgICAgICAuYXR0cigieSIsIGxlZ2VuZFJlY3RTdGFydCArIGxlZ2VuZFJlY3RIZWlnaHQvMikKICAgICAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQpCiAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsICJibGFjayIpCiAgICAgICAgICAgICAgICAudGV4dCgiMC41Iik7CiAgICAgICAgICAgIGN1clZpek9iai52aWV3LmNudkxlZ2VuZFNWRwogICAgICAgICAgICAgICAgLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCAiVkFGbGVnZW5kVGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCArIGNvbmZpZy5yZWN0SGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBsZWdlbmRSZWN0U3RhcnQgKyBsZWdlbmRSZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LXNpemUiLCBjb25maWcubGVnZW5kRm9udEhlaWdodCkKICAgICAgICAgICAgICAgIC5hdHRyKCJmaWxsIiwgImJsYWNrIikKICAgICAgICAgICAgICAgIC50ZXh0KCIwIik7CiAgICAgICAgfQogICAgICAgIGNvbmZpZy5ndHlwZUFubm90U3RhcnRZID0gbGVnZW5kUmVjdFN0YXJ0ICsgbGVnZW5kUmVjdEhlaWdodCArIGNvbmZpZy5wYWRkaW5nR2VuZXJhbDsgLy8gc3RhcnRpbmcgeS1waXhlbCBmb3IgZ2Vub3R5cGUgYW5ub3RhdGlvbiBsZWdlbmQKCiAgICAgICAgLy8gR0VOT1RZUEUgQU5OT1RBVElPTiBMRUdFTkQKICAgICAgICBpZiAoY3VyVml6T2JqLnZpZXcuZ3R5cGVzU3BlY2lmaWVkKSB7CgogICAgICAgICAgICAvLyBnZW5vdHlwZSBhbm5vdGF0aW9uIGxlZ2VuZCB0aXRsZQogICAgICAgICAgICBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcuYXBwZW5kKCJ0ZXh0IikKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBjb25maWcuZ3R5cGVBbm5vdFN0YXJ0WSkKICAgICAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC43MWVtIikKICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LWZhbWlseSIsICJBcmlhbCIpCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC13ZWlnaHQiLCAiYm9sZCIpCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1zaXplIiwgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0KQogICAgICAgICAgICAgICAgLnRleHQoY3VyVml6T2JqLnVzZXJDb25maWcuY2xvbmVfdGl0bGUpOwoKICAgICAgICAgICAgLy8gZ2Vub3R5cGUgYW5ub3RhdGlvbiBsZWdlbmQgcmVjdGFuZ2xlIC8gdGV4dCBnZW5vdHlwZQogICAgICAgICAgICB2YXIgZ3R5cGVBbm5vdExlZ2VuZEcgPSBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcKICAgICAgICAgICAgICAgIC5zZWxlY3RBbGwoIi5ndHlwZUFubm90TGVnZW5kRyIpCiAgICAgICAgICAgICAgICAuZGF0YShPYmplY3Qua2V5cyhjdXJWaXpPYmouZGF0YS5ndHlwZXMpKQogICAgICAgICAgICAgICAgLmVudGVyKCkKICAgICAgICAgICAgICAgIC5hcHBlbmQoImciKQogICAgICAgICAgICAgICAgLmNsYXNzZWQoImd0eXBlQW5ub3RMZWdlbmRHIiwgdHJ1ZSk7CgogICAgICAgICAgICAvLyBnZW5vdHlwZSBhbm5vdGF0aW9uIGxlZ2VuZCByZWN0YW5nbGVzCiAgICAgICAgICAgIGd0eXBlQW5ub3RMZWdlbmRHCiAgICAgICAgICAgICAgICAuYXBwZW5kKCJyZWN0IikKICAgICAgICAgICAgICAgIC5hdHRyKCJjbGFzcyIsIGZ1bmN0aW9uKGQpIHsgcmV0dXJuICJsZWdlbmRHcm91cFJlY3QgZ3R5cGVfIiArIGQ7IH0pCiAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCkKICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCxpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5ndHlwZUFubm90U3RhcnRZICsgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKjIgKyBpKihjb25maWcucmVjdEhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGNvbmZpZy5yZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLnJlY3RIZWlnaHQpCiAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcuYWxwaGFfY29sb3VyX2Fzc2lnbm1lbnRbZF07CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoInN0cm9rZSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcuY29sb3VyX2Fzc2lnbm1lbnRbZF07CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3Zlckdlbm90eXBlKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGxhYmVscyBpbiB0aW1lc2NhcGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLnRpbWVzY2FwZV93YW50ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93TGFiZWxzKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3V0R2Vub3R5cGUodmlld19pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgbGFiZWxzIGluIHRpbWVzY2FwZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcudGltZXNjYXBlX3dhbnRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGVMYWJlbHModmlld19pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIGdlbm90eXBlIGFubm90YXRpb24gbGVnZW5kIHRleHQKICAgICAgICAgICAgZ3R5cGVBbm5vdExlZ2VuZEcKICAgICAgICAgICAgICAgIC5hcHBlbmQoInRleHQiKQogICAgICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gImxlZ2VuZEdyb3VwVGV4dCBndHlwZV8iICsgZDsgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsICsgY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpCiAgICAgICAgICAgICAgICAuYXR0cigieSIsIGZ1bmN0aW9uKGQsaSkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWcuZ3R5cGVBbm5vdFN0YXJ0WSArIGNvbmZpZy5sZWdlbmRUaXRsZUhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyoyICsgaSooY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpICsgKGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0LzIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQ7IH0pCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3Zlckdlbm90eXBlKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICAvLyBzaG93IGxhYmVscyBpbiB0aW1lc2NhcGUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1clZpek9iai51c2VyQ29uZmlnLnRpbWVzY2FwZV93YW50ZWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9zaG93TGFiZWxzKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5vbigibW91c2VvdXQiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3V0R2Vub3R5cGUodmlld19pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGhpZGUgbGFiZWxzIGluIHRpbWVzY2FwZQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcudGltZXNjYXBlX3dhbnRlZCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgX2hpZGVMYWJlbHModmlld19pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIC8vIG5vdGUgZW5kIG9mIGdlbm90eXBlIGFubm90YXRpb24gbGVnZW5kCiAgICAgICAgICAgIGNvbmZpZy5ndHlwZUFubm90RW5kWSA9IGNvbmZpZy5ndHlwZUFubm90U3RhcnRZICsgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKjIgKyAKICAgICAgICAgICAgICBPYmplY3Qua2V5cyhjdXJWaXpPYmouZGF0YS5ndHlwZXMpLmxlbmd0aCooY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpICsgCiAgICAgICAgICAgICAgY29uZmlnLmxlZ2VuZEZvbnRIZWlnaHQ7CiAgICAgICAgfQoKCiAgICAgICAgLy8gVElNRVBPSU5UIEFOTk9UQVRJT04gTEVHRU5ECiAgICAgICAgaWYgKGN1clZpek9iai52aWV3LnRwc1NwZWNpZmllZCkgewoKICAgICAgICAgICAgLy8gZ2Vub3R5cGUgYW5ub3RhdGlvbiBsZWdlbmQgdGl0bGUKICAgICAgICAgICAgY3VyVml6T2JqLnZpZXcuY252TGVnZW5kU1ZHLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigieCIsIGNvbmZpZy5wYWRkaW5nR2VuZXJhbCkKICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgY29uZmlnLmd0eXBlQW5ub3RFbmRZKQogICAgICAgICAgICAgICAgLmF0dHIoImR5IiwgIiswLjcxZW0iKQogICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtZmFtaWx5IiwgIkFyaWFsIikKICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LXdlaWdodCIsICJib2xkIikKICAgICAgICAgICAgICAgIC5hdHRyKCJmb250LXNpemUiLCBjb25maWcubGVnZW5kVGl0bGVIZWlnaHQpCiAgICAgICAgICAgICAgICAudGV4dChjdXJWaXpPYmoudXNlckNvbmZpZy50aW1lcG9pbnRfdGl0bGUpOwoKICAgICAgICAgICAgLy8gZ2Vub3R5cGUgYW5ub3RhdGlvbiBsZWdlbmQgcmVjdGFuZ2xlIC8gdGV4dCBnZW5vdHlwZQogICAgICAgICAgICB2YXIgdHBBbm5vdExlZ2VuZEcgPSBjdXJWaXpPYmoudmlldy5jbnZMZWdlbmRTVkcKICAgICAgICAgICAgICAgIC5zZWxlY3RBbGwoIi50cEFubm90TGVnZW5kRyIpCiAgICAgICAgICAgICAgICAuZGF0YShjdXJWaXpPYmouZGF0YS50cHMpCiAgICAgICAgICAgICAgICAuZW50ZXIoKQogICAgICAgICAgICAgICAgLmFwcGVuZCgiZyIpCiAgICAgICAgICAgICAgICAuY2xhc3NlZCgidHBBbm5vdExlZ2VuZEciLCB0cnVlKTsKCiAgICAgICAgICAgIC8vIGdlbm90eXBlIGFubm90YXRpb24gbGVnZW5kIHJlY3RhbmdsZXMKICAgICAgICAgICAgdHBBbm5vdExlZ2VuZEcKICAgICAgICAgICAgICAgIC5hcHBlbmQoInJlY3QiKQogICAgICAgICAgICAgICAgLmF0dHIoImNsYXNzIiwgZnVuY3Rpb24oZCkgeyByZXR1cm4gImxlZ2VuZFRwUmVjdCB0cF8iICsgZDsgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJ4IiwgY29uZmlnLnBhZGRpbmdHZW5lcmFsKQogICAgICAgICAgICAgICAgLmF0dHIoInkiLCBmdW5jdGlvbihkLGkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnLmd0eXBlQW5ub3RFbmRZICsgY29uZmlnLmxlZ2VuZFRpdGxlSGVpZ2h0ICsgY29uZmlnLnJlY3RTcGFjaW5nKjIgKyBpKihjb25maWcucmVjdEhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoImhlaWdodCIsIGNvbmZpZy5yZWN0SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoIndpZHRoIiwgY29uZmlnLnJlY3RIZWlnaHQpCiAgICAgICAgICAgICAgICAuYXR0cigiZmlsbCIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcudHBfY29sb3VyU2NhbGUoZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmF0dHIoInN0cm9rZSIsIGZ1bmN0aW9uKGQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VyVml6T2JqLnZpZXcudHBfY29sb3VyU2NhbGUoZCk7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3ZlclRwKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9tb3VzZW91dFRwKHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gZ2Vub3R5cGUgYW5ub3RhdGlvbiBsZWdlbmQgdGV4dAogICAgICAgICAgICB0cEFubm90TGVnZW5kRwogICAgICAgICAgICAgICAgLmFwcGVuZCgidGV4dCIpCiAgICAgICAgICAgICAgICAuYXR0cigiY2xhc3MiLCBmdW5jdGlvbihkKSB7IHJldHVybiAibGVnZW5kVHBUZXh0IHRwXyIgKyBkOyB9KQogICAgICAgICAgICAgICAgLmF0dHIoIngiLCBjb25maWcucGFkZGluZ0dlbmVyYWwgKyBjb25maWcucmVjdEhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZykKICAgICAgICAgICAgICAgIC5hdHRyKCJ5IiwgZnVuY3Rpb24oZCxpKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZy5ndHlwZUFubm90RW5kWSArIGNvbmZpZy5sZWdlbmRUaXRsZUhlaWdodCArIGNvbmZpZy5yZWN0U3BhY2luZyoyICsgaSooY29uZmlnLnJlY3RIZWlnaHQgKyBjb25maWcucmVjdFNwYWNpbmcpICsgKGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0LzIpOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIC5hdHRyKCJkeSIsICIrMC4zNWVtIikKICAgICAgICAgICAgICAgIC50ZXh0KGZ1bmN0aW9uKGQpIHsgcmV0dXJuIGQ7IH0pCiAgICAgICAgICAgICAgICAuYXR0cigiZm9udC1mYW1pbHkiLCAiQXJpYWwiKQogICAgICAgICAgICAgICAgLmF0dHIoImZvbnQtc2l6ZSIsIGNvbmZpZy5sZWdlbmRGb250SGVpZ2h0KQogICAgICAgICAgICAgICAgLmF0dHIoImZpbGwiLCAiYmxhY2siKQogICAgICAgICAgICAgICAgLm9uKCJtb3VzZW92ZXIiLCBmdW5jdGlvbihkKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKF9jaGVja0ZvclNlbGVjdGlvbnModmlld19pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX21vdXNlb3ZlclRwKGQsIHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAub24oIm1vdXNlb3V0IiwgZnVuY3Rpb24oZCkgewogICAgICAgICAgICAgICAgICAgIGlmIChfY2hlY2tGb3JTZWxlY3Rpb25zKHZpZXdfaWQpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIF9tb3VzZW91dFRwKHZpZXdfaWQpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgIH0KCgogICAgICAgIC8vIFJVTiBUSU1FU0NBUEUKICAgICAgICBpZiAoY3VyVml6T2JqLnVzZXJDb25maWcudGltZXNjYXBlX3dhbnRlZCkgewogICAgICAgICAgICBfcnVuX3RpbWVzY2FwZShlbC5pZCwgY29uZmlnLndpZHRoLCBjb25maWcudHNWaWV3SGVpZ2h0LCB4KTsKICAgICAgICB9CiAgICB9LAoKICAgIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CgogICAgfQoKfSk7Cg=="></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">CellScape vignette</h1>



<p>CellScape is a visualization tool for integrating single cell phylogeny with genomic content to clearly display evolutionary progression and tumour heterogeneity.</p>
<p>To run CellScape, type the following commands in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;devtools&quot;</span>) <span class="co"># if not already installed  </span>
<span class="kw">library</span>(devtools)  
<span class="kw">install_bitbucket</span>(<span class="st">&quot;MO_BCCRC/cellscape&quot;</span>)  
<span class="kw">library</span>(cellscape)  
<span class="kw">example</span>(cellscape) <span class="co"># to run examples</span></code></pre></div>
<p>One of these, for example, is copy number data of a triple negative breast cancer patient published in Wang et al. (2014).</p>
<pre><code>## Warning: package 'devtools' was built under R version 3.2.5</code></pre>
<pre><code>## Downloading bitbucket repo MO_BCCRC/cellscape@master</code></pre>
<pre><code>## Installing cellscape</code></pre>
<pre><code>## '/Library/Frameworks/R.framework/Resources/bin/R' --no-site-file  \
##   --no-environ --no-save --no-restore --quiet CMD INSTALL  \
##   '/private/var/folders/0y/35gjqtd56g55yjc46_4tnsmm0000gn/T/Rtmp0TOfVV/devtools8044507b540/MO_BCCRC-cellscape-04926b9f76d8'  \
##   --library='/usr/local/lib/R/site-library' --install-tests</code></pre>
<pre><code>## </code></pre>
<pre><code>## Note: the specification for S3 class &quot;AsIs&quot; in package 'jsonlite' seems equivalent to one from package 'DBI': not turning on duplicate class definitions for this class.</code></pre>
<div id="htmlwidget-fd4c8b80fe1e222772ba" style="width:800px;height:475px;" class="cellscape html-widget"></div>
<script type="application/json" data-for="htmlwidget-fd4c8b80fe1e222772ba">{"x":{"clone_cols":[{"clone_id":"1","colour":"7fc97f"},{"clone_id":"2","colour":"beaed4"},{"clone_id":"3","colour":"fdc086"}],"sc_annot":[{"single_cell_id":"c0","genotype":"1"},{"single_cell_id":"c1","genotype":"1"},{"single_cell_id":"c2","genotype":"1"},{"single_cell_id":"c3","genotype":"1"},{"single_cell_id":"c4","genotype":"1"},{"single_cell_id":"c5","genotype":"1"},{"single_cell_id":"c6","genotype":"1"},{"single_cell_id":"c7","genotype":"1"},{"single_cell_id":"c8","genotype":"1"},{"single_cell_id":"c9","genotype":"1"},{"single_cell_id":"c10","genotype":"1"},{"single_cell_id":"c11","genotype":"1"},{"single_cell_id":"c12","genotype":"1"},{"single_cell_id":"c13","genotype":"1"},{"single_cell_id":"c14","genotype":"1"},{"single_cell_id":"c15","genotype":"1"},{"single_cell_id":"c16","genotype":"1"},{"single_cell_id":"c17","genotype":"2"},{"single_cell_id":"c18","genotype":"2"},{"single_cell_id":"c19","genotype":"2"},{"single_cell_id":"c20","genotype":"2"},{"single_cell_id":"c21","genotype":"2"},{"single_cell_id":"c22","genotype":"2"},{"single_cell_id":"c23","genotype":"2"},{"single_cell_id":"c24","genotype":"2"},{"single_cell_id":"c25","genotype":"2"},{"single_cell_id":"c26","genotype":"2"},{"single_cell_id":"c27","genotype":"2"},{"single_cell_id":"c28","genotype":"2"},{"single_cell_id":"c29","genotype":"2"},{"single_cell_id":"c30","genotype":"2"},{"single_cell_id":"c31","genotype":"3"},{"single_cell_id":"c32","genotype":"3"},{"single_cell_id":"c33","genotype":"3"},{"single_cell_id":"c34","genotype":"3"},{"single_cell_id":"c35","genotype":"3"},{"single_cell_id":"c36","genotype":"3"},{"single_cell_id":"c37","genotype":"3"},{"single_cell_id":"c38","genotype":"3"},{"single_cell_id":"c39","genotype":"3"},{"single_cell_id":"c40","genotype":"3"},{"single_cell_id":"c41","genotype":"3"},{"single_cell_id":"c42","genotype":"3"},{"single_cell_id":"c43","genotype":"3"},{"single_cell_id":"c44","genotype":"3"},{"single_cell_id":"c45","genotype":"3"},{"single_cell_id":"c46","genotype":"3"},{"single_cell_id":"c47","genotype":"3"},{"single_cell_id":"c48","genotype":"3"},{"single_cell_id":"c49","genotype":"3"}],"sc_annot_provided":true,"sc_tree_edges":[{"source":0,"source_sc_id":"51","target":1,"target_sc_id":"50","link_id":"link_source_51_target_50","_row":"50"},{"source":0,"source_sc_id":"51","target":18,"target_sc_id":"c16","link_id":"link_source_51_target_c16","_row":"c16"},{"source":1,"source_sc_id":"50","target":19,"target_sc_id":"c13","link_id":"link_source_50_target_c13","_row":"c13"},{"source":1,"source_sc_id":"50","target":20,"target_sc_id":"c12","link_id":"link_source_50_target_c12","_row":"c12"},{"source":2,"source_sc_id":"c2","target":0,"target_sc_id":"51","link_id":"link_source_c2_target_51","_row":"51"},{"source":3,"source_sc_id":"c14","target":21,"target_sc_id":"c7","link_id":"link_source_c14_target_c7","_row":"c7"},{"source":4,"source_sc_id":"c6","target":22,"target_sc_id":"c8","link_id":"link_source_c6_target_c8","_row":"c8"},{"source":5,"source_sc_id":"c18","target":23,"target_sc_id":"c27","link_id":"link_source_c18_target_c27","_row":"c27"},{"source":6,"source_sc_id":"c38","target":24,"target_sc_id":"c44","link_id":"link_source_c38_target_c44","_row":"c44"},{"source":6,"source_sc_id":"c38","target":13,"target_sc_id":"c26","link_id":"link_source_c38_target_c26","_row":"c26"},{"source":6,"source_sc_id":"c38","target":25,"target_sc_id":"c34","link_id":"link_source_c38_target_c34","_row":"c34"},{"source":6,"source_sc_id":"c38","target":16,"target_sc_id":"c31","link_id":"link_source_c38_target_c31","_row":"c31"},{"source":6,"source_sc_id":"c38","target":26,"target_sc_id":"c33","link_id":"link_source_c38_target_c33","_row":"c33"},{"source":6,"source_sc_id":"c38","target":27,"target_sc_id":"c32","link_id":"link_source_c38_target_c32","_row":"c32"},{"source":7,"source_sc_id":"c37","target":28,"target_sc_id":"c35","link_id":"link_source_c37_target_c35","_row":"c35"},{"source":8,"source_sc_id":"c36","target":29,"target_sc_id":"c46","link_id":"link_source_c36_target_c46","_row":"c46"},{"source":8,"source_sc_id":"c36","target":6,"target_sc_id":"c38","link_id":"link_source_c36_target_c38","_row":"c38"},{"source":8,"source_sc_id":"c36","target":30,"target_sc_id":"c49","link_id":"link_source_c36_target_c49","_row":"c49"},{"source":9,"source_sc_id":"c30","target":31,"target_sc_id":"c19","link_id":"link_source_c30_target_c19","_row":"c19"},{"source":10,"source_sc_id":"c11","target":32,"target_sc_id":"c15","link_id":"link_source_c11_target_c15","_row":"c15"},{"source":11,"source_sc_id":"c20","target":33,"target_sc_id":"c22","link_id":"link_source_c20_target_c22","_row":"c22"},{"source":11,"source_sc_id":"c20","target":34,"target_sc_id":"c23","link_id":"link_source_c20_target_c23","_row":"c23"},{"source":11,"source_sc_id":"c20","target":35,"target_sc_id":"c21","link_id":"link_source_c20_target_c21","_row":"c21"},{"source":11,"source_sc_id":"c20","target":36,"target_sc_id":"c24","link_id":"link_source_c20_target_c24","_row":"c24"},{"source":12,"source_sc_id":"c3","target":37,"target_sc_id":"c1","link_id":"link_source_c3_target_c1","_row":"c1"},{"source":13,"source_sc_id":"c26","target":11,"target_sc_id":"c20","link_id":"link_source_c26_target_c20","_row":"c20"},{"source":13,"source_sc_id":"c26","target":38,"target_sc_id":"c25","link_id":"link_source_c26_target_c25","_row":"c25"},{"source":13,"source_sc_id":"c26","target":39,"target_sc_id":"c28","link_id":"link_source_c26_target_c28","_row":"c28"},{"source":13,"source_sc_id":"c26","target":40,"target_sc_id":"c29","link_id":"link_source_c26_target_c29","_row":"c29"},{"source":13,"source_sc_id":"c26","target":5,"target_sc_id":"c18","link_id":"link_source_c26_target_c18","_row":"c18"},{"source":13,"source_sc_id":"c26","target":41,"target_sc_id":"c17","link_id":"link_source_c26_target_c17","_row":"c17"},{"source":13,"source_sc_id":"c26","target":9,"target_sc_id":"c30","link_id":"link_source_c26_target_c30","_row":"c30"},{"source":14,"source_sc_id":"c10","target":17,"target_sc_id":"c48","link_id":"link_source_c10_target_c48","_row":"c48"},{"source":14,"source_sc_id":"c10","target":42,"target_sc_id":"c9","link_id":"link_source_c10_target_c9","_row":"c9"},{"source":14,"source_sc_id":"c10","target":3,"target_sc_id":"c14","link_id":"link_source_c10_target_c14","_row":"c14"},{"source":14,"source_sc_id":"c10","target":12,"target_sc_id":"c3","link_id":"link_source_c10_target_c3","_row":"c3"},{"source":14,"source_sc_id":"c10","target":2,"target_sc_id":"c2","link_id":"link_source_c10_target_c2","_row":"c2"},{"source":14,"source_sc_id":"c10","target":10,"target_sc_id":"c11","link_id":"link_source_c10_target_c11","_row":"c11"},{"source":14,"source_sc_id":"c10","target":43,"target_sc_id":"c0","link_id":"link_source_c10_target_c0","_row":"c0"},{"source":14,"source_sc_id":"c10","target":4,"target_sc_id":"c6","link_id":"link_source_c10_target_c6","_row":"c6"},{"source":14,"source_sc_id":"c10","target":44,"target_sc_id":"c5","link_id":"link_source_c10_target_c5","_row":"c5"},{"source":14,"source_sc_id":"c10","target":45,"target_sc_id":"c4","link_id":"link_source_c10_target_c4","_row":"c4"},{"source":15,"source_sc_id":"c43","target":46,"target_sc_id":"c45","link_id":"link_source_c43_target_c45","_row":"c45"},{"source":15,"source_sc_id":"c43","target":47,"target_sc_id":"c47","link_id":"link_source_c43_target_c47","_row":"c47"},{"source":15,"source_sc_id":"c43","target":8,"target_sc_id":"c36","link_id":"link_source_c43_target_c36","_row":"c36"},{"source":15,"source_sc_id":"c43","target":48,"target_sc_id":"c42","link_id":"link_source_c43_target_c42","_row":"c42"},{"source":16,"source_sc_id":"c31","target":7,"target_sc_id":"c37","link_id":"link_source_c31_target_c37","_row":"c37"},{"source":17,"source_sc_id":"c48","target":49,"target_sc_id":"c39","link_id":"link_source_c48_target_c39","_row":"c39"},{"source":17,"source_sc_id":"c48","target":50,"target_sc_id":"c40","link_id":"link_source_c48_target_c40","_row":"c40"},{"source":17,"source_sc_id":"c48","target":51,"target_sc_id":"c41","link_id":"link_source_c48_target_c41","_row":"c41"},{"source":17,"source_sc_id":"c48","target":15,"target_sc_id":"c43","link_id":"link_source_c48_target_c43","_row":"c43"}],"sc_tree_nodes":[{"sc_id":"51","index":0},{"sc_id":"50","index":1},{"sc_id":"c2","index":2},{"sc_id":"c14","index":3},{"sc_id":"c6","index":4},{"sc_id":"c18","index":5},{"sc_id":"c38","index":6},{"sc_id":"c37","index":7},{"sc_id":"c36","index":8},{"sc_id":"c30","index":9},{"sc_id":"c11","index":10},{"sc_id":"c20","index":11},{"sc_id":"c3","index":12},{"sc_id":"c26","index":13},{"sc_id":"c10","index":14},{"sc_id":"c43","index":15},{"sc_id":"c31","index":16},{"sc_id":"c48","index":17},{"sc_id":"c16","index":18},{"sc_id":"c13","index":19},{"sc_id":"c12","index":20},{"sc_id":"c7","index":21},{"sc_id":"c8","index":22},{"sc_id":"c27","index":23},{"sc_id":"c44","index":24},{"sc_id":"c34","index":25},{"sc_id":"c33","index":26},{"sc_id":"c32","index":27},{"sc_id":"c35","index":28},{"sc_id":"c46","index":29},{"sc_id":"c49","index":30},{"sc_id":"c19","index":31},{"sc_id":"c15","index":32},{"sc_id":"c22","index":33},{"sc_id":"c23","index":34},{"sc_id":"c21","index":35},{"sc_id":"c24","index":36},{"sc_id":"c1","index":37},{"sc_id":"c25","index":38},{"sc_id":"c28","index":39},{"sc_id":"c29","index":40},{"sc_id":"c17","index":41},{"sc_id":"c9","index":42},{"sc_id":"c0","index":43},{"sc_id":"c5","index":44},{"sc_id":"c4","index":45},{"sc_id":"c45","index":46},{"sc_id":"c47","index":47},{"sc_id":"c42","index":48},{"sc_id":"c39","index":49},{"sc_id":"c40","index":50},{"sc_id":"c41","index":51}],"link_ids":["link_source_51_target_50","link_source_51_target_c16","link_source_50_target_c13","link_source_50_target_c12","link_source_c2_target_51","link_source_c14_target_c7","link_source_c6_target_c8","link_source_c18_target_c27","link_source_c38_target_c44","link_source_c38_target_c26","link_source_c38_target_c34","link_source_c38_target_c31","link_source_c38_target_c33","link_source_c38_target_c32","link_source_c37_target_c35","link_source_c36_target_c46","link_source_c36_target_c38","link_source_c36_target_c49","link_source_c30_target_c19","link_source_c11_target_c15","link_source_c20_target_c22","link_source_c20_target_c23","link_source_c20_target_c21","link_source_c20_target_c24","link_source_c3_target_c1","link_source_c26_target_c20","link_source_c26_target_c25","link_source_c26_target_c28","link_source_c26_target_c29","link_source_c26_target_c18","link_source_c26_target_c17","link_source_c26_target_c30","link_source_c10_target_c48","link_source_c10_target_c9","link_source_c10_target_c14","link_source_c10_target_c3","link_source_c10_target_c2","link_source_c10_target_c11","link_source_c10_target_c0","link_source_c10_target_c6","link_source_c10_target_c5","link_source_c10_target_c4","link_source_c43_target_c45","link_source_c43_target_c47","link_source_c43_target_c36","link_source_c43_target_c42","link_source_c31_target_c37","link_source_c48_target_c39","link_source_c48_target_c40","link_source_c48_target_c41","link_source_c48_target_c43"],"distances_provided":false,"chroms":["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","X","Y"],"chrom_boxes":[{"chr":"1","x":0,"width":29,"_row":"1"},{"chr":"2","x":30,"width":29,"_row":"2"},{"chr":"3","x":60,"width":23,"_row":"3"},{"chr":"4","x":84,"width":23,"_row":"4"},{"chr":"5","x":108,"width":22,"_row":"5"},{"chr":"6","x":131,"width":21,"_row":"6"},{"chr":"7","x":153,"width":19,"_row":"7"},{"chr":"8","x":173,"width":18,"_row":"8"},{"chr":"9","x":192,"width":17,"_row":"9"},{"chr":"10","x":210,"width":16,"_row":"10"},{"chr":"11","x":227,"width":17,"_row":"11"},{"chr":"12","x":245,"width":16,"_row":"12"},{"chr":"13","x":262,"width":14,"_row":"13"},{"chr":"14","x":277,"width":13,"_row":"14"},{"chr":"15","x":291,"width":13,"_row":"15"},{"chr":"16","x":305,"width":12,"_row":"16"},{"chr":"17","x":318,"width":10,"_row":"17"},{"chr":"18","x":329,"width":10,"_row":"18"},{"chr":"19","x":340,"width":8,"_row":"19"},{"chr":"20","x":349,"width":8,"_row":"20"},{"chr":"21","x":358,"width":6,"_row":"21"},{"chr":"22","x":365,"width":7,"_row":"22"},{"chr":"X","x":373,"width":19,"_row":"X"},{"chr":"Y","x":393,"width":3,"_row":"Y"}],"heatmap_info":{"c0":[{"sc_id":"c0","x":0,"px_width":1,"chr":"1","cumsum_values":3},{"sc_id":"c0","x":1,"px_width":28,"chr":"1","gridCell_value":1.7909,"cumsum_values":5.7909},{"sc_id":"c0","x":30,"px_width":29,"chr":"2","gridCell_value":1.8609,"cumsum_values":9.6518},{"sc_id":"c0","x":60,"px_width":5,"chr":"3","gridCell_value":1.9148,"cumsum_values":13.5666},{"sc_id":"c0","x":65,"px_width":1,"chr":"3","gridCell_value":1.1524,"cumsum_values":15.719},{"sc_id":"c0","x":66,"px_width":17,"chr":"3","gridCell_value":1.9545,"cumsum_values":18.6735},{"sc_id":"c0","x":84,"px_width":1,"chr":"4","cumsum_values":21.6735},{"sc_id":"c0","x":85,"px_width":1,"chr":"4","gridCell_value":1.2099,"cumsum_values":23.8834},{"sc_id":"c0","x":86,"px_width":21,"chr":"4","gridCell_value":2.0227,"cumsum_values":26.9061},{"sc_id":"c0","x":108,"px_width":22,"chr":"5","gridCell_value":1.9248,"cumsum_values":30.8309},{"sc_id":"c0","x":131,"px_width":3,"chr":"6","gridCell_value":1.8478,"cumsum_values":34.6787},{"sc_id":"c0","x":134,"px_width":1,"chr":"6","gridCell_value":0.4627,"cumsum_values":36.1414},{"sc_id":"c0","x":135,"px_width":3,"chr":"6","gridCell_value":1.7845,"cumsum_values":38.9258},{"sc_id":"c0","x":138,"px_width":1,"chr":"6","cumsum_values":40.9258},{"sc_id":"c0","x":139,"px_width":13,"chr":"6","gridCell_value":2.0028,"cumsum_values":43.9286},{"sc_id":"c0","x":153,"px_width":8,"chr":"7","gridCell_value":1.9291,"cumsum_values":47.8577},{"sc_id":"c0","x":161,"px_width":1,"chr":"7","cumsum_values":49.8577},{"sc_id":"c0","x":162,"px_width":10,"chr":"7","gridCell_value":1.9095,"cumsum_values":52.7672},{"sc_id":"c0","x":173,"px_width":16,"chr":"8","gridCell_value":1.9245,"cumsum_values":56.6917},{"sc_id":"c0","x":189,"px_width":2,"chr":"8","gridCell_value":0.7826,"cumsum_values":58.4743},{"sc_id":"c0","x":192,"px_width":14,"chr":"9","gridCell_value":1.9247,"cumsum_values":62.3989},{"sc_id":"c0","x":206,"px_width":3,"chr":"9","gridCell_value":1.1821,"cumsum_values":64.581},{"sc_id":"c0","x":210,"px_width":9,"chr":"10","gridCell_value":1.8655,"cumsum_values":68.4465},{"sc_id":"c0","x":219,"px_width":1,"chr":"10","cumsum_values":70.4465},{"sc_id":"c0","x":220,"px_width":6,"chr":"10","gridCell_value":1.8073,"cumsum_values":73.2538},{"sc_id":"c0","x":227,"px_width":1,"chr":"11","gridCell_value":0.8811,"cumsum_values":76.1349},{"sc_id":"c0","x":228,"px_width":16,"chr":"11","gridCell_value":1.8378,"cumsum_values":78.9727},{"sc_id":"c0","x":245,"px_width":16,"chr":"12","gridCell_value":1.8354,"cumsum_values":82.8081},{"sc_id":"c0","x":262,"px_width":2,"chr":"13","cumsum_values":85.8081},{"sc_id":"c0","x":264,"px_width":12,"chr":"13","gridCell_value":1.9374,"cumsum_values":88.7455},{"sc_id":"c0","x":277,"px_width":4,"chr":"14","cumsum_values":91.7455},{"sc_id":"c0","x":281,"px_width":8,"chr":"14","gridCell_value":1.8856,"cumsum_values":94.6311},{"sc_id":"c0","x":289,"px_width":1,"chr":"14","cumsum_values":96.6311},{"sc_id":"c0","x":291,"px_width":3,"chr":"15","cumsum_values":97.6311},{"sc_id":"c0","x":294,"px_width":10,"chr":"15","gridCell_value":1.8174,"cumsum_values":100.4485},{"sc_id":"c0","x":305,"px_width":1,"chr":"16","gridCell_value":0.8979,"cumsum_values":103.3465},{"sc_id":"c0","x":306,"px_width":9,"chr":"16","gridCell_value":1.7068,"cumsum_values":106.0533},{"sc_id":"c0","x":315,"px_width":2,"chr":"16","gridCell_value":1.027,"cumsum_values":108.0803},{"sc_id":"c0","x":318,"px_width":10,"chr":"17","gridCell_value":1.4777,"cumsum_values":111.5581},{"sc_id":"c0","x":329,"px_width":10,"chr":"18","gridCell_value":1.8891,"cumsum_values":115.4472},{"sc_id":"c0","x":340,"px_width":1,"chr":"19","cumsum_values":118.4472},{"sc_id":"c0","x":341,"px_width":7,"chr":"19","gridCell_value":1.5324,"cumsum_values":120.9796},{"sc_id":"c0","x":349,"px_width":6,"chr":"20","gridCell_value":1.7275,"cumsum_values":124.7071},{"sc_id":"c0","x":355,"px_width":2,"chr":"20","gridCell_value":0.7864,"cumsum_values":126.4935},{"sc_id":"c0","x":358,"px_width":2,"chr":"21","cumsum_values":129.4935},{"sc_id":"c0","x":360,"px_width":4,"chr":"21","gridCell_value":1.7655,"cumsum_values":132.259},{"sc_id":"c0","x":365,"px_width":2,"chr":"22","cumsum_values":135.259},{"sc_id":"c0","x":367,"px_width":5,"chr":"22","gridCell_value":1.4038,"cumsum_values":137.6628},{"sc_id":"c0","x":373,"px_width":1,"chr":"X","cumsum_values":140.6628},{"sc_id":"c0","x":374,"px_width":4,"chr":"X","gridCell_value":2.0258,"cumsum_values":143.6886},{"sc_id":"c0","x":378,"px_width":1,"chr":"X","cumsum_values":145.6886},{"sc_id":"c0","x":379,"px_width":13,"chr":"X","gridCell_value":2.4014,"cumsum_values":149.09},{"sc_id":"c0","x":393,"px_width":1,"chr":"Y","cumsum_values":152.09},{"sc_id":"c0","x":394,"px_width":2,"chr":"Y","gridCell_value":0.3256,"cumsum_values":153.4156}],"c1":[{"sc_id":"c1","x":0,"px_width":1,"chr":"1","cumsum_values":132.4156},{"sc_id":"c1","x":1,"px_width":28,"chr":"1","gridCell_value":1.6287,"cumsum_values":135.0443},{"sc_id":"c1","x":30,"px_width":19,"chr":"2","gridCell_value":1.5981,"cumsum_values":138.6425},{"sc_id":"c1","x":49,"px_width":1,"chr":"2","cumsum_values":140.6425},{"sc_id":"c1","x":50,"px_width":5,"chr":"2","gridCell_value":1.6202,"cumsum_values":143.2627},{"sc_id":"c1","x":55,"px_width":1,"chr":"2","cumsum_values":145.2627},{"sc_id":"c1","x":56,"px_width":3,"chr":"2","gridCell_value":1.6513,"cumsum_values":147.914},{"sc_id":"c1","x":60,"px_width":22,"chr":"3","gridCell_value":1.8352,"cumsum_values":151.7491},{"sc_id":"c1","x":82,"px_width":1,"chr":"3","cumsum_values":153.7491},{"sc_id":"c1","x":84,"px_width":23,"chr":"4","gridCell_value":1.9626,"cumsum_values":157.7118},{"sc_id":"c1","x":108,"px_width":22,"chr":"5","gridCell_value":1.9756,"cumsum_values":161.6874},{"sc_id":"c1","x":131,"px_width":3,"chr":"6","gridCell_value":1.9086,"cumsum_values":165.596},{"sc_id":"c1","x":134,"px_width":1,"chr":"6","gridCell_value":0.4582,"cumsum_values":167.0542},{"sc_id":"c1","x":135,"px_width":17,"chr":"6","gridCell_value":1.7456,"cumsum_values":169.7997},{"sc_id":"c1","x":153,"px_width":9,"chr":"7","gridCell_value":2.0196,"cumsum_values":173.8194},{"sc_id":"c1","x":162,"px_width":1,"chr":"7","cumsum_values":175.8194},{"sc_id":"c1","x":163,"px_width":9,"chr":"7","gridCell_value":1.8461,"cumsum_values":178.6655},{"sc_id":"c1","x":173,"px_width":16,"chr":"8","gridCell_value":1.953,"cumsum_values":182.6185},{"sc_id":"c1","x":189,"px_width":2,"chr":"8","gridCell_value":1.1263,"cumsum_values":184.7448},{"sc_id":"c1","x":192,"px_width":14,"chr":"9","gridCell_value":2.03,"cumsum_values":188.7748},{"sc_id":"c1","x":206,"px_width":2,"chr":"9","gridCell_value":1.1137,"cumsum_values":190.8886},{"sc_id":"c1","x":208,"px_width":1,"chr":"9","cumsum_values":192.8886},{"sc_id":"c1","x":210,"px_width":16,"chr":"10","gridCell_value":1.8227,"cumsum_values":196.7113},{"sc_id":"c1","x":227,"px_width":1,"chr":"11","gridCell_value":0.9408,"cumsum_values":199.6521},{"sc_id":"c1","x":228,"px_width":1,"chr":"11","cumsum_values":201.6521},{"sc_id":"c1","x":229,"px_width":6,"chr":"11","gridCell_value":1.9777,"cumsum_values":204.6298},{"sc_id":"c1","x":235,"px_width":1,"chr":"11","cumsum_values":206.6298},{"sc_id":"c1","x":236,"px_width":8,"chr":"11","gridCell_value":1.8273,"cumsum_values":209.4571},{"sc_id":"c1","x":245,"px_width":16,"chr":"12","gridCell_value":1.8601,"cumsum_values":213.3172},{"sc_id":"c1","x":262,"px_width":2,"chr":"13","cumsum_values":216.3172},{"sc_id":"c1","x":264,"px_width":12,"chr":"13","gridCell_value":1.8114,"cumsum_values":219.1286},{"sc_id":"c1","x":277,"px_width":3,"chr":"14","cumsum_values":222.1286},{"sc_id":"c1","x":280,"px_width":10,"chr":"14","gridCell_value":1.8237,"cumsum_values":224.9523},{"sc_id":"c1","x":291,"px_width":3,"chr":"15","cumsum_values":227.9523},{"sc_id":"c1","x":294,"px_width":10,"chr":"15","gridCell_value":1.7983,"cumsum_values":230.7506},{"sc_id":"c1","x":305,"px_width":12,"chr":"16","gridCell_value":1.6275,"cumsum_values":234.3781},{"sc_id":"c1","x":318,"px_width":4,"chr":"17","gridCell_value":1.5609,"cumsum_values":237.9391},{"sc_id":"c1","x":322,"px_width":1,"chr":"17","gridCell_value":0.7022,"cumsum_values":239.6412},{"sc_id":"c1","x":323,"px_width":5,"chr":"17","gridCell_value":1.6486,"cumsum_values":242.2898},{"sc_id":"c1","x":329,"px_width":10,"chr":"18","gridCell_value":1.9229,"cumsum_values":246.2127},{"sc_id":"c1","x":340,"px_width":1,"chr":"19","cumsum_values":249.2127},{"sc_id":"c1","x":341,"px_width":7,"chr":"19","gridCell_value":1.5926,"cumsum_values":251.8053},{"sc_id":"c1","x":349,"px_width":8,"chr":"20","gridCell_value":1.6202,"cumsum_values":255.4256},{"sc_id":"c1","x":358,"px_width":2,"chr":"21","cumsum_values":258.4256},{"sc_id":"c1","x":360,"px_width":4,"chr":"21","gridCell_value":1.8275,"cumsum_values":261.2531},{"sc_id":"c1","x":365,"px_width":2,"chr":"22","cumsum_values":264.2531},{"sc_id":"c1","x":367,"px_width":5,"chr":"22","gridCell_value":1.5179,"cumsum_values":266.771},{"sc_id":"c1","x":373,"px_width":1,"chr":"X","cumsum_values":269.771},{"sc_id":"c1","x":374,"px_width":18,"chr":"X","gridCell_value":2.2774,"cumsum_values":273.0484},{"sc_id":"c1","x":393,"px_width":1,"chr":"Y","cumsum_values":276.0484},{"sc_id":"c1","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2974,"cumsum_values":277.3458}],"c10":[{"sc_id":"c10","x":0,"px_width":8,"chr":"1","gridCell_value":1.8543,"cumsum_values":257.2001},{"sc_id":"c10","x":8,"px_width":1,"chr":"1","cumsum_values":259.2001},{"sc_id":"c10","x":9,"px_width":20,"chr":"1","gridCell_value":1.8635,"cumsum_values":262.0636},{"sc_id":"c10","x":30,"px_width":29,"chr":"2","gridCell_value":1.826,"cumsum_values":265.8896},{"sc_id":"c10","x":60,"px_width":23,"chr":"3","gridCell_value":1.8547,"cumsum_values":269.7444},{"sc_id":"c10","x":84,"px_width":23,"chr":"4","gridCell_value":1.8176,"cumsum_values":273.5619},{"sc_id":"c10","x":108,"px_width":22,"chr":"5","gridCell_value":1.8507,"cumsum_values":277.4127},{"sc_id":"c10","x":131,"px_width":3,"chr":"6","gridCell_value":1.8895,"cumsum_values":281.3021},{"sc_id":"c10","x":134,"px_width":1,"chr":"6","gridCell_value":0.4074,"cumsum_values":282.7095},{"sc_id":"c10","x":135,"px_width":17,"chr":"6","gridCell_value":1.8711,"cumsum_values":285.5807},{"sc_id":"c10","x":153,"px_width":19,"chr":"7","gridCell_value":1.8976,"cumsum_values":289.4783},{"sc_id":"c10","x":173,"px_width":18,"chr":"8","gridCell_value":1.8483,"cumsum_values":293.3266},{"sc_id":"c10","x":192,"px_width":17,"chr":"9","gridCell_value":1.8547,"cumsum_values":297.1813},{"sc_id":"c10","x":210,"px_width":16,"chr":"10","gridCell_value":1.8947,"cumsum_values":301.0761},{"sc_id":"c10","x":227,"px_width":6,"chr":"11","gridCell_value":1.8367,"cumsum_values":304.9127},{"sc_id":"c10","x":233,"px_width":1,"chr":"11","gridCell_value":3.4687,"cumsum_values":309.3814},{"sc_id":"c10","x":234,"px_width":10,"chr":"11","gridCell_value":1.8516,"cumsum_values":312.2331},{"sc_id":"c10","x":245,"px_width":16,"chr":"12","gridCell_value":1.8658,"cumsum_values":316.0989},{"sc_id":"c10","x":262,"px_width":2,"chr":"13","cumsum_values":319.0989},{"sc_id":"c10","x":264,"px_width":12,"chr":"13","gridCell_value":1.781,"cumsum_values":321.8799},{"sc_id":"c10","x":277,"px_width":3,"chr":"14","cumsum_values":324.8799},{"sc_id":"c10","x":280,"px_width":10,"chr":"14","gridCell_value":1.8279,"cumsum_values":327.7078},{"sc_id":"c10","x":291,"px_width":3,"chr":"15","cumsum_values":330.7078},{"sc_id":"c10","x":294,"px_width":10,"chr":"15","gridCell_value":1.9161,"cumsum_values":333.624},{"sc_id":"c10","x":305,"px_width":1,"chr":"16","cumsum_values":336.624},{"sc_id":"c10","x":306,"px_width":11,"chr":"16","gridCell_value":1.8841,"cumsum_values":339.5081},{"sc_id":"c10","x":318,"px_width":10,"chr":"17","gridCell_value":1.8139,"cumsum_values":343.322},{"sc_id":"c10","x":329,"px_width":10,"chr":"18","gridCell_value":1.8452,"cumsum_values":347.1672},{"sc_id":"c10","x":340,"px_width":1,"chr":"19","cumsum_values":350.1672},{"sc_id":"c10","x":341,"px_width":7,"chr":"19","gridCell_value":1.9067,"cumsum_values":353.0739},{"sc_id":"c10","x":349,"px_width":8,"chr":"20","gridCell_value":1.8679,"cumsum_values":356.9418},{"sc_id":"c10","x":358,"px_width":2,"chr":"21","cumsum_values":359.9418},{"sc_id":"c10","x":360,"px_width":4,"chr":"21","gridCell_value":1.7886,"cumsum_values":362.7304},{"sc_id":"c10","x":365,"px_width":2,"chr":"22","cumsum_values":365.7304},{"sc_id":"c10","x":367,"px_width":5,"chr":"22","gridCell_value":1.8168,"cumsum_values":368.5472},{"sc_id":"c10","x":373,"px_width":1,"chr":"X","cumsum_values":371.5472},{"sc_id":"c10","x":374,"px_width":18,"chr":"X","gridCell_value":2.1133,"cumsum_values":374.6605},{"sc_id":"c10","x":393,"px_width":1,"chr":"Y","cumsum_values":377.6605},{"sc_id":"c10","x":394,"px_width":2,"chr":"Y","gridCell_value":0.252,"cumsum_values":378.9125}],"c11":[{"sc_id":"c11","x":0,"px_width":29,"chr":"1","gridCell_value":1.8279,"cumsum_values":358.7404},{"sc_id":"c11","x":30,"px_width":29,"chr":"2","gridCell_value":1.8135,"cumsum_values":362.5539},{"sc_id":"c11","x":60,"px_width":23,"chr":"3","gridCell_value":1.8392,"cumsum_values":366.3931},{"sc_id":"c11","x":84,"px_width":23,"chr":"4","gridCell_value":1.7917,"cumsum_values":370.1848},{"sc_id":"c11","x":108,"px_width":22,"chr":"5","gridCell_value":1.8096,"cumsum_values":373.9944},{"sc_id":"c11","x":131,"px_width":3,"chr":"6","gridCell_value":1.8599,"cumsum_values":377.8543},{"sc_id":"c11","x":134,"px_width":1,"chr":"6","gridCell_value":0.4265,"cumsum_values":379.2808},{"sc_id":"c11","x":135,"px_width":17,"chr":"6","gridCell_value":1.8358,"cumsum_values":382.1166},{"sc_id":"c11","x":153,"px_width":19,"chr":"7","gridCell_value":1.7981,"cumsum_values":385.9147},{"sc_id":"c11","x":173,"px_width":18,"chr":"8","gridCell_value":1.7998,"cumsum_values":389.7144},{"sc_id":"c11","x":192,"px_width":17,"chr":"9","gridCell_value":1.801,"cumsum_values":393.5154},{"sc_id":"c11","x":210,"px_width":16,"chr":"10","gridCell_value":1.8632,"cumsum_values":397.3787},{"sc_id":"c11","x":227,"px_width":17,"chr":"11","gridCell_value":1.8427,"cumsum_values":401.2213},{"sc_id":"c11","x":245,"px_width":16,"chr":"12","gridCell_value":1.8203,"cumsum_values":405.0417},{"sc_id":"c11","x":262,"px_width":2,"chr":"13","cumsum_values":408.0417},{"sc_id":"c11","x":264,"px_width":12,"chr":"13","gridCell_value":1.7269,"cumsum_values":410.7686},{"sc_id":"c11","x":277,"px_width":3,"chr":"14","cumsum_values":413.7686},{"sc_id":"c11","x":280,"px_width":10,"chr":"14","gridCell_value":1.8367,"cumsum_values":416.6053},{"sc_id":"c11","x":291,"px_width":3,"chr":"15","cumsum_values":419.6053},{"sc_id":"c11","x":294,"px_width":10,"chr":"15","gridCell_value":1.8487,"cumsum_values":422.454},{"sc_id":"c11","x":305,"px_width":12,"chr":"16","gridCell_value":1.8191,"cumsum_values":426.273},{"sc_id":"c11","x":318,"px_width":10,"chr":"17","gridCell_value":1.8325,"cumsum_values":430.1055},{"sc_id":"c11","x":329,"px_width":10,"chr":"18","gridCell_value":1.8261,"cumsum_values":433.9316},{"sc_id":"c11","x":340,"px_width":8,"chr":"19","gridCell_value":1.9255,"cumsum_values":437.8571},{"sc_id":"c11","x":349,"px_width":8,"chr":"20","gridCell_value":1.7969,"cumsum_values":441.654},{"sc_id":"c11","x":358,"px_width":2,"chr":"21","cumsum_values":444.654},{"sc_id":"c11","x":360,"px_width":4,"chr":"21","gridCell_value":1.7598,"cumsum_values":447.4138},{"sc_id":"c11","x":365,"px_width":2,"chr":"22","cumsum_values":450.4138},{"sc_id":"c11","x":367,"px_width":5,"chr":"22","gridCell_value":1.8425,"cumsum_values":453.2563},{"sc_id":"c11","x":373,"px_width":19,"chr":"X","gridCell_value":2.0481,"cumsum_values":457.3044},{"sc_id":"c11","x":393,"px_width":1,"chr":"Y","cumsum_values":460.3044},{"sc_id":"c11","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2839,"cumsum_values":461.5884}],"c12":[{"sc_id":"c12","x":0,"px_width":29,"chr":"1","gridCell_value":1.7904,"cumsum_values":441.3788},{"sc_id":"c12","x":30,"px_width":29,"chr":"2","gridCell_value":1.6916,"cumsum_values":445.0704},{"sc_id":"c12","x":60,"px_width":23,"chr":"3","gridCell_value":1.8144,"cumsum_values":448.8848},{"sc_id":"c12","x":84,"px_width":16,"chr":"4","gridCell_value":1.7647,"cumsum_values":452.6495},{"sc_id":"c12","x":100,"px_width":1,"chr":"4","cumsum_values":454.6495},{"sc_id":"c12","x":101,"px_width":6,"chr":"4","gridCell_value":1.7208,"cumsum_values":457.3703},{"sc_id":"c12","x":108,"px_width":22,"chr":"5","gridCell_value":1.7652,"cumsum_values":461.1355},{"sc_id":"c12","x":131,"px_width":3,"chr":"6","gridCell_value":1.8887,"cumsum_values":465.0242},{"sc_id":"c12","x":134,"px_width":1,"chr":"6","gridCell_value":0.3283,"cumsum_values":466.3524},{"sc_id":"c12","x":135,"px_width":9,"chr":"6","gridCell_value":1.731,"cumsum_values":469.0834},{"sc_id":"c12","x":144,"px_width":1,"chr":"6","cumsum_values":471.0834},{"sc_id":"c12","x":145,"px_width":7,"chr":"6","gridCell_value":1.6967,"cumsum_values":473.7801},{"sc_id":"c12","x":153,"px_width":19,"chr":"7","gridCell_value":1.7157,"cumsum_values":477.4958},{"sc_id":"c12","x":173,"px_width":18,"chr":"8","gridCell_value":1.6635,"cumsum_values":481.1593},{"sc_id":"c12","x":192,"px_width":17,"chr":"9","gridCell_value":1.6369,"cumsum_values":484.7962},{"sc_id":"c12","x":210,"px_width":16,"chr":"10","gridCell_value":1.7002,"cumsum_values":488.4964},{"sc_id":"c12","x":227,"px_width":17,"chr":"11","gridCell_value":1.6863,"cumsum_values":492.1828},{"sc_id":"c12","x":245,"px_width":16,"chr":"12","gridCell_value":1.7522,"cumsum_values":495.935},{"sc_id":"c12","x":262,"px_width":2,"chr":"13","cumsum_values":498.935},{"sc_id":"c12","x":264,"px_width":12,"chr":"13","gridCell_value":1.6325,"cumsum_values":501.5675},{"sc_id":"c12","x":277,"px_width":3,"chr":"14","cumsum_values":504.5675},{"sc_id":"c12","x":280,"px_width":10,"chr":"14","gridCell_value":1.6152,"cumsum_values":507.1827},{"sc_id":"c12","x":291,"px_width":3,"chr":"15","cumsum_values":510.1827},{"sc_id":"c12","x":294,"px_width":2,"chr":"15","gridCell_value":1.9704,"cumsum_values":513.1531},{"sc_id":"c12","x":296,"px_width":1,"chr":"15","cumsum_values":515.1531},{"sc_id":"c12","x":297,"px_width":7,"chr":"15","gridCell_value":1.7438,"cumsum_values":517.8969},{"sc_id":"c12","x":305,"px_width":12,"chr":"16","gridCell_value":1.7242,"cumsum_values":521.621},{"sc_id":"c12","x":318,"px_width":10,"chr":"17","gridCell_value":1.65,"cumsum_values":525.2711},{"sc_id":"c12","x":329,"px_width":10,"chr":"18","gridCell_value":1.6287,"cumsum_values":528.8998},{"sc_id":"c12","x":340,"px_width":1,"chr":"19","cumsum_values":531.8998},{"sc_id":"c12","x":341,"px_width":7,"chr":"19","gridCell_value":1.6639,"cumsum_values":534.5637},{"sc_id":"c12","x":349,"px_width":8,"chr":"20","gridCell_value":1.7118,"cumsum_values":538.2755},{"sc_id":"c12","x":358,"px_width":2,"chr":"21","cumsum_values":541.2755},{"sc_id":"c12","x":360,"px_width":4,"chr":"21","gridCell_value":1.5692,"cumsum_values":543.8446},{"sc_id":"c12","x":365,"px_width":2,"chr":"22","cumsum_values":546.8446},{"sc_id":"c12","x":367,"px_width":5,"chr":"22","gridCell_value":1.692,"cumsum_values":549.5366},{"sc_id":"c12","x":373,"px_width":19,"chr":"X","gridCell_value":1.9565,"cumsum_values":553.4931},{"sc_id":"c12","x":393,"px_width":1,"chr":"Y","cumsum_values":556.4931},{"sc_id":"c12","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2845,"cumsum_values":557.7776}],"c13":[{"sc_id":"c13","x":0,"px_width":29,"chr":"1","gridCell_value":1.8164,"cumsum_values":537.594},{"sc_id":"c13","x":30,"px_width":2,"chr":"2","gridCell_value":1.614,"cumsum_values":541.208},{"sc_id":"c13","x":32,"px_width":1,"chr":"2","cumsum_values":543.208},{"sc_id":"c13","x":33,"px_width":26,"chr":"2","gridCell_value":1.7371,"cumsum_values":545.9451},{"sc_id":"c13","x":60,"px_width":23,"chr":"3","gridCell_value":1.7292,"cumsum_values":549.6743},{"sc_id":"c13","x":84,"px_width":23,"chr":"4","gridCell_value":1.7381,"cumsum_values":553.4124},{"sc_id":"c13","x":108,"px_width":22,"chr":"5","gridCell_value":1.7513,"cumsum_values":557.1637},{"sc_id":"c13","x":131,"px_width":3,"chr":"6","gridCell_value":1.7138,"cumsum_values":560.8775},{"sc_id":"c13","x":134,"px_width":1,"chr":"6","gridCell_value":0.4255,"cumsum_values":562.3029},{"sc_id":"c13","x":135,"px_width":17,"chr":"6","gridCell_value":1.6605,"cumsum_values":564.9634},{"sc_id":"c13","x":153,"px_width":19,"chr":"7","gridCell_value":1.7809,"cumsum_values":568.7443},{"sc_id":"c13","x":173,"px_width":18,"chr":"8","gridCell_value":1.7059,"cumsum_values":572.4501},{"sc_id":"c13","x":192,"px_width":17,"chr":"9","gridCell_value":1.7131,"cumsum_values":576.1632},{"sc_id":"c13","x":210,"px_width":16,"chr":"10","gridCell_value":1.7525,"cumsum_values":579.9157},{"sc_id":"c13","x":227,"px_width":13,"chr":"11","gridCell_value":1.7904,"cumsum_values":583.7061},{"sc_id":"c13","x":240,"px_width":1,"chr":"11","gridCell_value":0.6149,"cumsum_values":585.321},{"sc_id":"c13","x":241,"px_width":3,"chr":"11","gridCell_value":1.6492,"cumsum_values":587.9703},{"sc_id":"c13","x":245,"px_width":16,"chr":"12","gridCell_value":1.781,"cumsum_values":591.7513},{"sc_id":"c13","x":262,"px_width":2,"chr":"13","cumsum_values":594.7513},{"sc_id":"c13","x":264,"px_width":12,"chr":"13","gridCell_value":1.5185,"cumsum_values":597.2697},{"sc_id":"c13","x":277,"px_width":3,"chr":"14","cumsum_values":600.2697},{"sc_id":"c13","x":280,"px_width":10,"chr":"14","gridCell_value":1.7717,"cumsum_values":603.0414},{"sc_id":"c13","x":291,"px_width":3,"chr":"15","cumsum_values":606.0414},{"sc_id":"c13","x":294,"px_width":10,"chr":"15","gridCell_value":1.6984,"cumsum_values":608.7398},{"sc_id":"c13","x":305,"px_width":12,"chr":"16","gridCell_value":1.668,"cumsum_values":612.4078},{"sc_id":"c13","x":318,"px_width":10,"chr":"17","gridCell_value":1.7099,"cumsum_values":616.1177},{"sc_id":"c13","x":329,"px_width":8,"chr":"18","gridCell_value":1.6522,"cumsum_values":619.7699},{"sc_id":"c13","x":337,"px_width":1,"chr":"18","cumsum_values":621.7699},{"sc_id":"c13","x":338,"px_width":1,"chr":"18","gridCell_value":1.6296,"cumsum_values":624.3995},{"sc_id":"c13","x":340,"px_width":8,"chr":"19","gridCell_value":1.8649,"cumsum_values":628.2644},{"sc_id":"c13","x":349,"px_width":8,"chr":"20","gridCell_value":1.7536,"cumsum_values":632.018},{"sc_id":"c13","x":358,"px_width":2,"chr":"21","cumsum_values":635.018},{"sc_id":"c13","x":360,"px_width":4,"chr":"21","gridCell_value":1.6113,"cumsum_values":637.6292},{"sc_id":"c13","x":365,"px_width":2,"chr":"22","cumsum_values":640.6292},{"sc_id":"c13","x":367,"px_width":5,"chr":"22","gridCell_value":1.6548,"cumsum_values":643.2841},{"sc_id":"c13","x":373,"px_width":19,"chr":"X","gridCell_value":1.879,"cumsum_values":647.1631},{"sc_id":"c13","x":393,"px_width":1,"chr":"Y","cumsum_values":650.1631},{"sc_id":"c13","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2802,"cumsum_values":651.4433}],"c14":[{"sc_id":"c14","x":0,"px_width":29,"chr":"1","gridCell_value":1.7779,"cumsum_values":631.2213},{"sc_id":"c14","x":30,"px_width":11,"chr":"2","gridCell_value":1.8191,"cumsum_values":635.0403},{"sc_id":"c14","x":41,"px_width":1,"chr":"2","gridCell_value":0.9515,"cumsum_values":636.9918},{"sc_id":"c14","x":42,"px_width":6,"chr":"2","gridCell_value":1.9826,"cumsum_values":639.9744},{"sc_id":"c14","x":48,"px_width":1,"chr":"2","cumsum_values":641.9744},{"sc_id":"c14","x":49,"px_width":10,"chr":"2","gridCell_value":1.6944,"cumsum_values":644.6688},{"sc_id":"c14","x":60,"px_width":23,"chr":"3","gridCell_value":1.763,"cumsum_values":648.4318},{"sc_id":"c14","x":84,"px_width":7,"chr":"4","gridCell_value":1.7475,"cumsum_values":652.1793},{"sc_id":"c14","x":91,"px_width":1,"chr":"4","gridCell_value":0.7778,"cumsum_values":653.9571},{"sc_id":"c14","x":92,"px_width":15,"chr":"4","gridCell_value":1.8942,"cumsum_values":656.8513},{"sc_id":"c14","x":108,"px_width":22,"chr":"5","gridCell_value":1.8056,"cumsum_values":660.6569},{"sc_id":"c14","x":131,"px_width":3,"chr":"6","gridCell_value":1.9199,"cumsum_values":664.5768},{"sc_id":"c14","x":134,"px_width":1,"chr":"6","cumsum_values":666.5768},{"sc_id":"c14","x":135,"px_width":17,"chr":"6","gridCell_value":1.808,"cumsum_values":669.3848},{"sc_id":"c14","x":153,"px_width":19,"chr":"7","gridCell_value":1.811,"cumsum_values":673.1958},{"sc_id":"c14","x":173,"px_width":18,"chr":"8","gridCell_value":1.8334,"cumsum_values":677.0292},{"sc_id":"c14","x":192,"px_width":17,"chr":"9","gridCell_value":1.7098,"cumsum_values":680.7389},{"sc_id":"c14","x":210,"px_width":16,"chr":"10","gridCell_value":1.7404,"cumsum_values":684.4793},{"sc_id":"c14","x":227,"px_width":17,"chr":"11","gridCell_value":1.6813,"cumsum_values":688.1606},{"sc_id":"c14","x":245,"px_width":16,"chr":"12","gridCell_value":1.7447,"cumsum_values":691.9054},{"sc_id":"c14","x":262,"px_width":2,"chr":"13","cumsum_values":694.9054},{"sc_id":"c14","x":264,"px_width":12,"chr":"13","gridCell_value":1.7954,"cumsum_values":697.7007},{"sc_id":"c14","x":277,"px_width":3,"chr":"14","cumsum_values":700.7007},{"sc_id":"c14","x":280,"px_width":10,"chr":"14","gridCell_value":1.749,"cumsum_values":703.4497},{"sc_id":"c14","x":291,"px_width":3,"chr":"15","cumsum_values":706.4497},{"sc_id":"c14","x":294,"px_width":6,"chr":"15","gridCell_value":1.8555,"cumsum_values":709.3052},{"sc_id":"c14","x":300,"px_width":1,"chr":"15","gridCell_value":0.8895,"cumsum_values":711.1947},{"sc_id":"c14","x":301,"px_width":3,"chr":"15","gridCell_value":1.7498,"cumsum_values":713.9445},{"sc_id":"c14","x":305,"px_width":12,"chr":"16","gridCell_value":1.6518,"cumsum_values":717.5962},{"sc_id":"c14","x":318,"px_width":10,"chr":"17","gridCell_value":1.6184,"cumsum_values":721.2147},{"sc_id":"c14","x":329,"px_width":4,"chr":"18","gridCell_value":1.8696,"cumsum_values":725.0842},{"sc_id":"c14","x":333,"px_width":1,"chr":"18","cumsum_values":727.0842},{"sc_id":"c14","x":334,"px_width":5,"chr":"18","gridCell_value":1.8279,"cumsum_values":729.9121},{"sc_id":"c14","x":340,"px_width":8,"chr":"19","gridCell_value":1.6817,"cumsum_values":733.5938},{"sc_id":"c14","x":349,"px_width":8,"chr":"20","gridCell_value":1.6584,"cumsum_values":737.2522},{"sc_id":"c14","x":358,"px_width":2,"chr":"21","cumsum_values":740.2522},{"sc_id":"c14","x":360,"px_width":4,"chr":"21","gridCell_value":1.6064,"cumsum_values":742.8586},{"sc_id":"c14","x":365,"px_width":2,"chr":"22","cumsum_values":745.8586},{"sc_id":"c14","x":367,"px_width":5,"chr":"22","gridCell_value":1.63,"cumsum_values":748.4886},{"sc_id":"c14","x":373,"px_width":1,"chr":"X","cumsum_values":751.4886},{"sc_id":"c14","x":374,"px_width":18,"chr":"X","gridCell_value":2.0796,"cumsum_values":754.5682},{"sc_id":"c14","x":393,"px_width":1,"chr":"Y","cumsum_values":757.5682},{"sc_id":"c14","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2623,"cumsum_values":758.8305}],"c15":[{"sc_id":"c15","x":0,"px_width":29,"chr":"1","gridCell_value":1.6644,"cumsum_values":738.4949},{"sc_id":"c15","x":30,"px_width":29,"chr":"2","gridCell_value":1.6672,"cumsum_values":742.1621},{"sc_id":"c15","x":60,"px_width":23,"chr":"3","gridCell_value":1.7257,"cumsum_values":745.8878},{"sc_id":"c15","x":84,"px_width":23,"chr":"4","gridCell_value":1.744,"cumsum_values":749.6318},{"sc_id":"c15","x":108,"px_width":22,"chr":"5","gridCell_value":1.7288,"cumsum_values":753.3606},{"sc_id":"c15","x":131,"px_width":3,"chr":"6","gridCell_value":1.7657,"cumsum_values":757.1263},{"sc_id":"c15","x":134,"px_width":1,"chr":"6","gridCell_value":0.3543,"cumsum_values":758.4806},{"sc_id":"c15","x":135,"px_width":15,"chr":"6","gridCell_value":1.8222,"cumsum_values":761.3028},{"sc_id":"c15","x":150,"px_width":1,"chr":"6","cumsum_values":763.3028},{"sc_id":"c15","x":151,"px_width":1,"chr":"6","gridCell_value":1.7509,"cumsum_values":766.0537},{"sc_id":"c15","x":153,"px_width":19,"chr":"7","gridCell_value":1.7186,"cumsum_values":769.7723},{"sc_id":"c15","x":173,"px_width":18,"chr":"8","gridCell_value":1.7593,"cumsum_values":773.5316},{"sc_id":"c15","x":192,"px_width":17,"chr":"9","gridCell_value":1.7365,"cumsum_values":777.2681},{"sc_id":"c15","x":210,"px_width":16,"chr":"10","gridCell_value":1.6624,"cumsum_values":780.9305},{"sc_id":"c15","x":227,"px_width":17,"chr":"11","gridCell_value":1.7053,"cumsum_values":784.6358},{"sc_id":"c15","x":245,"px_width":16,"chr":"12","gridCell_value":1.7328,"cumsum_values":788.3686},{"sc_id":"c15","x":262,"px_width":2,"chr":"13","cumsum_values":791.3686},{"sc_id":"c15","x":264,"px_width":12,"chr":"13","gridCell_value":1.6535,"cumsum_values":794.0221},{"sc_id":"c15","x":277,"px_width":3,"chr":"14","cumsum_values":797.0221},{"sc_id":"c15","x":280,"px_width":10,"chr":"14","gridCell_value":1.6907,"cumsum_values":799.7127},{"sc_id":"c15","x":291,"px_width":3,"chr":"15","cumsum_values":802.7127},{"sc_id":"c15","x":294,"px_width":10,"chr":"15","gridCell_value":1.7042,"cumsum_values":805.4169},{"sc_id":"c15","x":305,"px_width":1,"chr":"16","cumsum_values":808.4169},{"sc_id":"c15","x":306,"px_width":11,"chr":"16","gridCell_value":1.6689,"cumsum_values":811.0858},{"sc_id":"c15","x":318,"px_width":10,"chr":"17","gridCell_value":1.5311,"cumsum_values":814.617},{"sc_id":"c15","x":329,"px_width":10,"chr":"18","gridCell_value":1.6466,"cumsum_values":818.2636},{"sc_id":"c15","x":340,"px_width":8,"chr":"19","gridCell_value":1.5384,"cumsum_values":821.802},{"sc_id":"c15","x":349,"px_width":8,"chr":"20","gridCell_value":1.6567,"cumsum_values":825.4586},{"sc_id":"c15","x":358,"px_width":2,"chr":"21","cumsum_values":828.4586},{"sc_id":"c15","x":360,"px_width":4,"chr":"21","gridCell_value":1.5025,"cumsum_values":830.9612},{"sc_id":"c15","x":365,"px_width":2,"chr":"22","cumsum_values":833.9612},{"sc_id":"c15","x":367,"px_width":5,"chr":"22","gridCell_value":1.6641,"cumsum_values":836.6252},{"sc_id":"c15","x":373,"px_width":19,"chr":"X","gridCell_value":1.8705,"cumsum_values":840.4957},{"sc_id":"c15","x":393,"px_width":1,"chr":"Y","cumsum_values":843.4957},{"sc_id":"c15","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2342,"cumsum_values":844.7299}],"c16":[{"sc_id":"c16","x":0,"px_width":29,"chr":"1","gridCell_value":1.7092,"cumsum_values":824.4391},{"sc_id":"c16","x":30,"px_width":29,"chr":"2","gridCell_value":1.6984,"cumsum_values":828.1375},{"sc_id":"c16","x":60,"px_width":23,"chr":"3","gridCell_value":1.7312,"cumsum_values":831.8688},{"sc_id":"c16","x":84,"px_width":23,"chr":"4","gridCell_value":1.6708,"cumsum_values":835.5395},{"sc_id":"c16","x":108,"px_width":22,"chr":"5","gridCell_value":1.7309,"cumsum_values":839.2704},{"sc_id":"c16","x":131,"px_width":3,"chr":"6","gridCell_value":1.89,"cumsum_values":843.1604},{"sc_id":"c16","x":134,"px_width":1,"chr":"6","gridCell_value":0.4355,"cumsum_values":844.5959},{"sc_id":"c16","x":135,"px_width":17,"chr":"6","gridCell_value":1.7623,"cumsum_values":847.3582},{"sc_id":"c16","x":153,"px_width":19,"chr":"7","gridCell_value":1.8305,"cumsum_values":851.1887},{"sc_id":"c16","x":173,"px_width":18,"chr":"8","gridCell_value":1.6982,"cumsum_values":854.8869},{"sc_id":"c16","x":192,"px_width":17,"chr":"9","gridCell_value":1.7201,"cumsum_values":858.607},{"sc_id":"c16","x":210,"px_width":16,"chr":"10","gridCell_value":1.5565,"cumsum_values":862.1635},{"sc_id":"c16","x":227,"px_width":17,"chr":"11","gridCell_value":1.6982,"cumsum_values":865.8617},{"sc_id":"c16","x":245,"px_width":16,"chr":"12","gridCell_value":1.7048,"cumsum_values":869.5665},{"sc_id":"c16","x":262,"px_width":2,"chr":"13","cumsum_values":872.5665},{"sc_id":"c16","x":264,"px_width":12,"chr":"13","gridCell_value":1.665,"cumsum_values":875.2314},{"sc_id":"c16","x":277,"px_width":3,"chr":"14","cumsum_values":878.2314},{"sc_id":"c16","x":280,"px_width":10,"chr":"14","gridCell_value":1.8463,"cumsum_values":881.0777},{"sc_id":"c16","x":291,"px_width":3,"chr":"15","cumsum_values":884.0777},{"sc_id":"c16","x":294,"px_width":10,"chr":"15","gridCell_value":1.6616,"cumsum_values":886.7393},{"sc_id":"c16","x":305,"px_width":12,"chr":"16","gridCell_value":1.6391,"cumsum_values":890.3784},{"sc_id":"c16","x":318,"px_width":10,"chr":"17","gridCell_value":1.5787,"cumsum_values":893.9571},{"sc_id":"c16","x":329,"px_width":10,"chr":"18","gridCell_value":1.5099,"cumsum_values":897.467},{"sc_id":"c16","x":340,"px_width":8,"chr":"19","gridCell_value":1.5681,"cumsum_values":901.0351},{"sc_id":"c16","x":349,"px_width":8,"chr":"20","gridCell_value":1.5237,"cumsum_values":904.5588},{"sc_id":"c16","x":358,"px_width":2,"chr":"21","cumsum_values":907.5588},{"sc_id":"c16","x":360,"px_width":4,"chr":"21","gridCell_value":1.5501,"cumsum_values":910.109},{"sc_id":"c16","x":365,"px_width":2,"chr":"22","cumsum_values":913.109},{"sc_id":"c16","x":367,"px_width":5,"chr":"22","gridCell_value":1.654,"cumsum_values":915.763},{"sc_id":"c16","x":373,"px_width":19,"chr":"X","gridCell_value":1.9781,"cumsum_values":919.7411},{"sc_id":"c16","x":393,"px_width":1,"chr":"Y","cumsum_values":922.7411},{"sc_id":"c16","x":394,"px_width":2,"chr":"Y","gridCell_value":0.256,"cumsum_values":923.9971}],"c17":[{"sc_id":"c17","x":0,"px_width":29,"chr":"1","gridCell_value":2.3068,"cumsum_values":904.3039},{"sc_id":"c17","x":30,"px_width":5,"chr":"2","gridCell_value":1.0863,"cumsum_values":907.3902},{"sc_id":"c17","x":35,"px_width":1,"chr":"2","gridCell_value":0.1425,"cumsum_values":908.5327},{"sc_id":"c17","x":36,"px_width":23,"chr":"2","gridCell_value":1.2541,"cumsum_values":910.7867},{"sc_id":"c17","x":60,"px_width":23,"chr":"3","gridCell_value":1.5377,"cumsum_values":914.3245},{"sc_id":"c17","x":84,"px_width":23,"chr":"4","gridCell_value":1.1106,"cumsum_values":917.435},{"sc_id":"c17","x":108,"px_width":22,"chr":"5","gridCell_value":1.6208,"cumsum_values":921.0558},{"sc_id":"c17","x":131,"px_width":3,"chr":"6","gridCell_value":2.2046,"cumsum_values":925.2604},{"sc_id":"c17","x":134,"px_width":1,"chr":"6","gridCell_value":0.3708,"cumsum_values":926.6312},{"sc_id":"c17","x":135,"px_width":17,"chr":"6","gridCell_value":2.1066,"cumsum_values":929.7378},{"sc_id":"c17","x":153,"px_width":19,"chr":"7","gridCell_value":2.1324,"cumsum_values":933.8702},{"sc_id":"c17","x":173,"px_width":18,"chr":"8","gridCell_value":2.2122,"cumsum_values":938.0824},{"sc_id":"c17","x":192,"px_width":17,"chr":"9","gridCell_value":1.0664,"cumsum_values":941.1488},{"sc_id":"c17","x":210,"px_width":6,"chr":"10","gridCell_value":1.1001,"cumsum_values":944.2489},{"sc_id":"c17","x":216,"px_width":1,"chr":"10","cumsum_values":946.2489},{"sc_id":"c17","x":217,"px_width":2,"chr":"10","gridCell_value":1.1484,"cumsum_values":948.3973},{"sc_id":"c17","x":219,"px_width":1,"chr":"10","cumsum_values":950.3973},{"sc_id":"c17","x":220,"px_width":1,"chr":"10","gridCell_value":1.2672,"cumsum_values":952.6646},{"sc_id":"c17","x":221,"px_width":2,"chr":"10","cumsum_values":954.6646},{"sc_id":"c17","x":223,"px_width":1,"chr":"10","gridCell_value":0.4031,"cumsum_values":956.0677},{"sc_id":"c17","x":224,"px_width":2,"chr":"10","gridCell_value":1.095,"cumsum_values":958.1627},{"sc_id":"c17","x":227,"px_width":11,"chr":"11","gridCell_value":2.1228,"cumsum_values":962.2855},{"sc_id":"c17","x":238,"px_width":1,"chr":"11","cumsum_values":964.2855},{"sc_id":"c17","x":239,"px_width":5,"chr":"11","gridCell_value":2.2631,"cumsum_values":967.5486},{"sc_id":"c17","x":245,"px_width":16,"chr":"12","gridCell_value":1.059,"cumsum_values":970.6076},{"sc_id":"c17","x":262,"px_width":2,"chr":"13","cumsum_values":973.6076},{"sc_id":"c17","x":264,"px_width":12,"chr":"13","gridCell_value":1.4487,"cumsum_values":976.0564},{"sc_id":"c17","x":277,"px_width":3,"chr":"14","cumsum_values":979.0564},{"sc_id":"c17","x":280,"px_width":7,"chr":"14","gridCell_value":2.0734,"cumsum_values":982.1298},{"sc_id":"c17","x":287,"px_width":1,"chr":"14","cumsum_values":984.1298},{"sc_id":"c17","x":288,"px_width":2,"chr":"14","gridCell_value":2.3903,"cumsum_values":987.5201},{"sc_id":"c17","x":291,"px_width":3,"chr":"15","cumsum_values":990.5201},{"sc_id":"c17","x":294,"px_width":2,"chr":"15","gridCell_value":1.3057,"cumsum_values":992.8257},{"sc_id":"c17","x":296,"px_width":1,"chr":"15","cumsum_values":994.8257},{"sc_id":"c17","x":297,"px_width":5,"chr":"15","gridCell_value":1.2962,"cumsum_values":997.122},{"sc_id":"c17","x":302,"px_width":1,"chr":"15","gridCell_value":0.5896,"cumsum_values":998.7116},{"sc_id":"c17","x":303,"px_width":1,"chr":"15","cumsum_values":1000.7116},{"sc_id":"c17","x":305,"px_width":12,"chr":"16","gridCell_value":2.1541,"cumsum_values":1004.8657},{"sc_id":"c17","x":318,"px_width":10,"chr":"17","gridCell_value":1.0881,"cumsum_values":1007.9538},{"sc_id":"c17","x":329,"px_width":10,"chr":"18","gridCell_value":1.4853,"cumsum_values":1011.4392},{"sc_id":"c17","x":340,"px_width":2,"chr":"19","cumsum_values":1014.4392},{"sc_id":"c17","x":342,"px_width":6,"chr":"19","gridCell_value":2.3203,"cumsum_values":1017.7594},{"sc_id":"c17","x":349,"px_width":8,"chr":"20","gridCell_value":2.2484,"cumsum_values":1022.0078},{"sc_id":"c17","x":358,"px_width":2,"chr":"21","cumsum_values":1025.0078},{"sc_id":"c17","x":360,"px_width":4,"chr":"21","gridCell_value":2.0794,"cumsum_values":1028.0873},{"sc_id":"c17","x":365,"px_width":2,"chr":"22","cumsum_values":1031.0873},{"sc_id":"c17","x":367,"px_width":5,"chr":"22","gridCell_value":1.2338,"cumsum_values":1033.3211},{"sc_id":"c17","x":373,"px_width":19,"chr":"X","gridCell_value":2.3233,"cumsum_values":1037.6444},{"sc_id":"c17","x":393,"px_width":1,"chr":"Y","cumsum_values":1040.6444},{"sc_id":"c17","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2391,"cumsum_values":1041.8835}],"c18":[{"sc_id":"c18","x":0,"px_width":29,"chr":"1","gridCell_value":2.4001,"cumsum_values":1022.2836},{"sc_id":"c18","x":30,"px_width":5,"chr":"2","gridCell_value":1.1384,"cumsum_values":1025.422},{"sc_id":"c18","x":35,"px_width":1,"chr":"2","gridCell_value":0.1621,"cumsum_values":1026.5841},{"sc_id":"c18","x":36,"px_width":5,"chr":"2","gridCell_value":2.227,"cumsum_values":1029.8111},{"sc_id":"c18","x":41,"px_width":18,"chr":"2","gridCell_value":1.1552,"cumsum_values":1031.9663},{"sc_id":"c18","x":60,"px_width":23,"chr":"3","gridCell_value":1.6923,"cumsum_values":1035.6586},{"sc_id":"c18","x":84,"px_width":4,"chr":"4","gridCell_value":1.2054,"cumsum_values":1038.864},{"sc_id":"c18","x":88,"px_width":1,"chr":"4","gridCell_value":0.5338,"cumsum_values":1040.3979},{"sc_id":"c18","x":89,"px_width":18,"chr":"4","gridCell_value":1.1942,"cumsum_values":1042.592},{"sc_id":"c18","x":108,"px_width":22,"chr":"5","gridCell_value":1.6856,"cumsum_values":1046.2777},{"sc_id":"c18","x":131,"px_width":3,"chr":"6","gridCell_value":2.327,"cumsum_values":1050.6047},{"sc_id":"c18","x":134,"px_width":1,"chr":"6","gridCell_value":0.3978,"cumsum_values":1052.0025},{"sc_id":"c18","x":135,"px_width":17,"chr":"6","gridCell_value":2.1922,"cumsum_values":1055.1947},{"sc_id":"c18","x":153,"px_width":19,"chr":"7","gridCell_value":2.2498,"cumsum_values":1059.4445},{"sc_id":"c18","x":173,"px_width":18,"chr":"8","gridCell_value":2.1979,"cumsum_values":1063.6424},{"sc_id":"c18","x":192,"px_width":17,"chr":"9","gridCell_value":1.1305,"cumsum_values":1066.7729},{"sc_id":"c18","x":210,"px_width":16,"chr":"10","gridCell_value":1.1429,"cumsum_values":1069.9158},{"sc_id":"c18","x":227,"px_width":1,"chr":"11","gridCell_value":0.8455,"cumsum_values":1072.7613},{"sc_id":"c18","x":228,"px_width":2,"chr":"11","gridCell_value":2.3432,"cumsum_values":1076.1045},{"sc_id":"c18","x":230,"px_width":1,"chr":"11","cumsum_values":1078.1045},{"sc_id":"c18","x":231,"px_width":13,"chr":"11","gridCell_value":2.2571,"cumsum_values":1081.3617},{"sc_id":"c18","x":245,"px_width":16,"chr":"12","gridCell_value":1.1622,"cumsum_values":1084.5239},{"sc_id":"c18","x":262,"px_width":2,"chr":"13","cumsum_values":1087.5239},{"sc_id":"c18","x":264,"px_width":12,"chr":"13","gridCell_value":1.5057,"cumsum_values":1090.0296},{"sc_id":"c18","x":277,"px_width":3,"chr":"14","cumsum_values":1093.0296},{"sc_id":"c18","x":280,"px_width":10,"chr":"14","gridCell_value":2.2842,"cumsum_values":1096.3138},{"sc_id":"c18","x":291,"px_width":3,"chr":"15","cumsum_values":1099.3138},{"sc_id":"c18","x":294,"px_width":5,"chr":"15","gridCell_value":1.1855,"cumsum_values":1101.4993},{"sc_id":"c18","x":299,"px_width":1,"chr":"15","cumsum_values":1103.4993},{"sc_id":"c18","x":300,"px_width":4,"chr":"15","gridCell_value":1.2734,"cumsum_values":1105.7727},{"sc_id":"c18","x":305,"px_width":12,"chr":"16","gridCell_value":2.2241,"cumsum_values":1109.9968},{"sc_id":"c18","x":318,"px_width":10,"chr":"17","gridCell_value":1.1332,"cumsum_values":1113.13},{"sc_id":"c18","x":329,"px_width":10,"chr":"18","gridCell_value":1.737,"cumsum_values":1116.867},{"sc_id":"c18","x":340,"px_width":2,"chr":"19","cumsum_values":1119.867},{"sc_id":"c18","x":342,"px_width":6,"chr":"19","gridCell_value":2.3134,"cumsum_values":1123.1803},{"sc_id":"c18","x":349,"px_width":8,"chr":"20","gridCell_value":2.3055,"cumsum_values":1127.4859},{"sc_id":"c18","x":358,"px_width":2,"chr":"21","cumsum_values":1130.4859},{"sc_id":"c18","x":360,"px_width":4,"chr":"21","gridCell_value":2.1613,"cumsum_values":1133.6472},{"sc_id":"c18","x":365,"px_width":2,"chr":"22","cumsum_values":1136.6472},{"sc_id":"c18","x":367,"px_width":5,"chr":"22","gridCell_value":1.0548,"cumsum_values":1138.702},{"sc_id":"c18","x":373,"px_width":19,"chr":"X","gridCell_value":2.5128,"cumsum_values":1143.2148},{"sc_id":"c18","x":393,"px_width":1,"chr":"Y","cumsum_values":1146.2148},{"sc_id":"c18","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2612,"cumsum_values":1147.476}],"c19":[{"sc_id":"c19","x":0,"px_width":29,"chr":"1","gridCell_value":2.4222,"cumsum_values":1127.8982},{"sc_id":"c19","x":30,"px_width":5,"chr":"2","gridCell_value":1.1111,"cumsum_values":1131.0093},{"sc_id":"c19","x":35,"px_width":1,"chr":"2","gridCell_value":0.1962,"cumsum_values":1132.2055},{"sc_id":"c19","x":36,"px_width":3,"chr":"2","gridCell_value":1.0904,"cumsum_values":1134.2959},{"sc_id":"c19","x":39,"px_width":2,"chr":"2","cumsum_values":1136.2959},{"sc_id":"c19","x":41,"px_width":18,"chr":"2","gridCell_value":1.1174,"cumsum_values":1138.4133},{"sc_id":"c19","x":60,"px_width":23,"chr":"3","gridCell_value":1.6513,"cumsum_values":1142.0646},{"sc_id":"c19","x":84,"px_width":23,"chr":"4","gridCell_value":1.1876,"cumsum_values":1145.2522},{"sc_id":"c19","x":108,"px_width":22,"chr":"5","gridCell_value":1.7213,"cumsum_values":1148.9735},{"sc_id":"c19","x":131,"px_width":3,"chr":"6","gridCell_value":2.1846,"cumsum_values":1153.1582},{"sc_id":"c19","x":134,"px_width":1,"chr":"6","gridCell_value":0.4171,"cumsum_values":1154.5753},{"sc_id":"c19","x":135,"px_width":17,"chr":"6","gridCell_value":2.2276,"cumsum_values":1157.8029},{"sc_id":"c19","x":153,"px_width":13,"chr":"7","gridCell_value":2.2939,"cumsum_values":1162.0968},{"sc_id":"c19","x":166,"px_width":1,"chr":"7","cumsum_values":1164.0968},{"sc_id":"c19","x":167,"px_width":5,"chr":"7","gridCell_value":2.2581,"cumsum_values":1167.3549},{"sc_id":"c19","x":173,"px_width":18,"chr":"8","gridCell_value":2.2507,"cumsum_values":1171.6056},{"sc_id":"c19","x":192,"px_width":17,"chr":"9","gridCell_value":1.1326,"cumsum_values":1174.7382},{"sc_id":"c19","x":210,"px_width":7,"chr":"10","gridCell_value":1.17,"cumsum_values":1177.9082},{"sc_id":"c19","x":217,"px_width":1,"chr":"10","gridCell_value":0.6026,"cumsum_values":1179.5108},{"sc_id":"c19","x":218,"px_width":8,"chr":"10","gridCell_value":1.1682,"cumsum_values":1181.679},{"sc_id":"c19","x":227,"px_width":1,"chr":"11","gridCell_value":0.8241,"cumsum_values":1184.5031},{"sc_id":"c19","x":228,"px_width":7,"chr":"11","gridCell_value":2.2689,"cumsum_values":1187.772},{"sc_id":"c19","x":235,"px_width":1,"chr":"11","cumsum_values":1189.772},{"sc_id":"c19","x":236,"px_width":8,"chr":"11","gridCell_value":2.2804,"cumsum_values":1193.0525},{"sc_id":"c19","x":245,"px_width":7,"chr":"12","gridCell_value":1.1423,"cumsum_values":1196.1948},{"sc_id":"c19","x":252,"px_width":1,"chr":"12","cumsum_values":1198.1948},{"sc_id":"c19","x":253,"px_width":4,"chr":"12","gridCell_value":1.108,"cumsum_values":1200.3028},{"sc_id":"c19","x":257,"px_width":1,"chr":"12","cumsum_values":1202.3028},{"sc_id":"c19","x":258,"px_width":3,"chr":"12","gridCell_value":1.0891,"cumsum_values":1204.392},{"sc_id":"c19","x":262,"px_width":2,"chr":"13","cumsum_values":1207.392},{"sc_id":"c19","x":264,"px_width":12,"chr":"13","gridCell_value":1.5327,"cumsum_values":1209.9247},{"sc_id":"c19","x":277,"px_width":3,"chr":"14","cumsum_values":1212.9247},{"sc_id":"c19","x":280,"px_width":10,"chr":"14","gridCell_value":2.2952,"cumsum_values":1216.2199},{"sc_id":"c19","x":291,"px_width":3,"chr":"15","cumsum_values":1219.2199},{"sc_id":"c19","x":294,"px_width":10,"chr":"15","gridCell_value":1.1597,"cumsum_values":1221.3796},{"sc_id":"c19","x":305,"px_width":8,"chr":"16","gridCell_value":2.2158,"cumsum_values":1225.5954},{"sc_id":"c19","x":313,"px_width":1,"chr":"16","cumsum_values":1227.5954},{"sc_id":"c19","x":314,"px_width":3,"chr":"16","gridCell_value":2.2222,"cumsum_values":1230.8176},{"sc_id":"c19","x":318,"px_width":10,"chr":"17","gridCell_value":1.1634,"cumsum_values":1233.981},{"sc_id":"c19","x":329,"px_width":10,"chr":"18","gridCell_value":1.7372,"cumsum_values":1237.7182},{"sc_id":"c19","x":340,"px_width":2,"chr":"19","cumsum_values":1240.7182},{"sc_id":"c19","x":342,"px_width":6,"chr":"19","gridCell_value":2.3177,"cumsum_values":1244.0359},{"sc_id":"c19","x":349,"px_width":8,"chr":"20","gridCell_value":2.1944,"cumsum_values":1248.2303},{"sc_id":"c19","x":358,"px_width":2,"chr":"21","cumsum_values":1251.2303},{"sc_id":"c19","x":360,"px_width":4,"chr":"21","gridCell_value":2.1781,"cumsum_values":1254.4084},{"sc_id":"c19","x":365,"px_width":2,"chr":"22","cumsum_values":1257.4084},{"sc_id":"c19","x":367,"px_width":5,"chr":"22","gridCell_value":1.0553,"cumsum_values":1259.4637},{"sc_id":"c19","x":373,"px_width":19,"chr":"X","gridCell_value":2.4026,"cumsum_values":1263.8664},{"sc_id":"c19","x":393,"px_width":1,"chr":"Y","cumsum_values":1266.8664},{"sc_id":"c19","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2441,"cumsum_values":1268.1105}],"c2":[{"sc_id":"c2","x":0,"px_width":29,"chr":"1","gridCell_value":1.6589,"cumsum_values":1247.7693},{"sc_id":"c2","x":30,"px_width":29,"chr":"2","gridCell_value":1.659,"cumsum_values":1251.4283},{"sc_id":"c2","x":60,"px_width":23,"chr":"3","gridCell_value":1.7502,"cumsum_values":1255.1785},{"sc_id":"c2","x":84,"px_width":23,"chr":"4","gridCell_value":1.8236,"cumsum_values":1259.0021},{"sc_id":"c2","x":108,"px_width":22,"chr":"5","gridCell_value":1.7345,"cumsum_values":1262.7366},{"sc_id":"c2","x":131,"px_width":3,"chr":"6","gridCell_value":1.7302,"cumsum_values":1266.4667},{"sc_id":"c2","x":134,"px_width":1,"chr":"6","gridCell_value":0.4108,"cumsum_values":1267.8775},{"sc_id":"c2","x":135,"px_width":17,"chr":"6","gridCell_value":1.713,"cumsum_values":1270.5905},{"sc_id":"c2","x":153,"px_width":19,"chr":"7","gridCell_value":1.6965,"cumsum_values":1274.287},{"sc_id":"c2","x":173,"px_width":18,"chr":"8","gridCell_value":1.7262,"cumsum_values":1278.0132},{"sc_id":"c2","x":192,"px_width":15,"chr":"9","gridCell_value":1.7208,"cumsum_values":1281.7341},{"sc_id":"c2","x":207,"px_width":2,"chr":"9","gridCell_value":0.6829,"cumsum_values":1283.417},{"sc_id":"c2","x":210,"px_width":16,"chr":"10","gridCell_value":1.6965,"cumsum_values":1287.1135},{"sc_id":"c2","x":227,"px_width":17,"chr":"11","gridCell_value":1.6216,"cumsum_values":1290.7351},{"sc_id":"c2","x":245,"px_width":16,"chr":"12","gridCell_value":1.6491,"cumsum_values":1294.3842},{"sc_id":"c2","x":262,"px_width":2,"chr":"13","cumsum_values":1297.3842},{"sc_id":"c2","x":264,"px_width":12,"chr":"13","gridCell_value":1.7465,"cumsum_values":1300.1308},{"sc_id":"c2","x":277,"px_width":3,"chr":"14","cumsum_values":1303.1308},{"sc_id":"c2","x":280,"px_width":10,"chr":"14","gridCell_value":1.6544,"cumsum_values":1305.7852},{"sc_id":"c2","x":291,"px_width":3,"chr":"15","cumsum_values":1308.7852},{"sc_id":"c2","x":294,"px_width":10,"chr":"15","gridCell_value":1.6495,"cumsum_values":1311.4346},{"sc_id":"c2","x":305,"px_width":1,"chr":"16","cumsum_values":1314.4346},{"sc_id":"c2","x":306,"px_width":11,"chr":"16","gridCell_value":1.4176,"cumsum_values":1316.8523},{"sc_id":"c2","x":318,"px_width":10,"chr":"17","gridCell_value":1.4061,"cumsum_values":1320.2584},{"sc_id":"c2","x":329,"px_width":10,"chr":"18","gridCell_value":1.6933,"cumsum_values":1323.9517},{"sc_id":"c2","x":340,"px_width":8,"chr":"19","gridCell_value":1.3614,"cumsum_values":1327.3131},{"sc_id":"c2","x":349,"px_width":8,"chr":"20","gridCell_value":1.4925,"cumsum_values":1330.8055},{"sc_id":"c2","x":358,"px_width":2,"chr":"21","cumsum_values":1333.8055},{"sc_id":"c2","x":360,"px_width":4,"chr":"21","gridCell_value":1.6474,"cumsum_values":1336.4529},{"sc_id":"c2","x":365,"px_width":2,"chr":"22","cumsum_values":1339.4529},{"sc_id":"c2","x":367,"px_width":5,"chr":"22","gridCell_value":1.4061,"cumsum_values":1341.859},{"sc_id":"c2","x":373,"px_width":1,"chr":"X","cumsum_values":1344.859},{"sc_id":"c2","x":374,"px_width":18,"chr":"X","gridCell_value":1.932,"cumsum_values":1347.791},{"sc_id":"c2","x":393,"px_width":1,"chr":"Y","cumsum_values":1350.791},{"sc_id":"c2","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2003,"cumsum_values":1351.9914}],"c20":[{"sc_id":"c20","x":0,"px_width":29,"chr":"1","gridCell_value":2.4104,"cumsum_values":1332.4018},{"sc_id":"c20","x":30,"px_width":5,"chr":"2","gridCell_value":1.168,"cumsum_values":1335.5699},{"sc_id":"c20","x":35,"px_width":1,"chr":"2","gridCell_value":0.1707,"cumsum_values":1336.7405},{"sc_id":"c20","x":36,"px_width":23,"chr":"2","gridCell_value":1.2672,"cumsum_values":1339.0078},{"sc_id":"c20","x":60,"px_width":10,"chr":"3","gridCell_value":1.2118,"cumsum_values":1342.2195},{"sc_id":"c20","x":70,"px_width":1,"chr":"3","cumsum_values":1344.2195},{"sc_id":"c20","x":71,"px_width":12,"chr":"3","gridCell_value":2.4402,"cumsum_values":1347.6597},{"sc_id":"c20","x":84,"px_width":4,"chr":"4","gridCell_value":1.2494,"cumsum_values":1350.9091},{"sc_id":"c20","x":88,"px_width":1,"chr":"4","cumsum_values":1352.9091},{"sc_id":"c20","x":89,"px_width":8,"chr":"4","gridCell_value":1.2444,"cumsum_values":1355.1535},{"sc_id":"c20","x":97,"px_width":3,"chr":"4","gridCell_value":0.6343,"cumsum_values":1356.7878},{"sc_id":"c20","x":100,"px_width":1,"chr":"4","cumsum_values":1358.7878},{"sc_id":"c20","x":101,"px_width":6,"chr":"4","gridCell_value":0.5993,"cumsum_values":1360.3871},{"sc_id":"c20","x":108,"px_width":22,"chr":"5","gridCell_value":1.7742,"cumsum_values":1364.1613},{"sc_id":"c20","x":131,"px_width":3,"chr":"6","gridCell_value":2.3946,"cumsum_values":1368.5559},{"sc_id":"c20","x":134,"px_width":1,"chr":"6","gridCell_value":0.4185,"cumsum_values":1369.9745},{"sc_id":"c20","x":135,"px_width":10,"chr":"6","gridCell_value":2.3659,"cumsum_values":1373.3404},{"sc_id":"c20","x":145,"px_width":1,"chr":"6","cumsum_values":1375.3404},{"sc_id":"c20","x":146,"px_width":6,"chr":"6","gridCell_value":2.4267,"cumsum_values":1378.7671},{"sc_id":"c20","x":153,"px_width":19,"chr":"7","gridCell_value":2.2966,"cumsum_values":1383.0637},{"sc_id":"c20","x":173,"px_width":18,"chr":"8","gridCell_value":2.1142,"cumsum_values":1387.1779},{"sc_id":"c20","x":192,"px_width":17,"chr":"9","gridCell_value":1.1473,"cumsum_values":1390.3251},{"sc_id":"c20","x":210,"px_width":16,"chr":"10","gridCell_value":1.2379,"cumsum_values":1393.563},{"sc_id":"c20","x":227,"px_width":1,"chr":"11","gridCell_value":0.6141,"cumsum_values":1396.1771},{"sc_id":"c20","x":228,"px_width":7,"chr":"11","gridCell_value":2.3303,"cumsum_values":1399.5074},{"sc_id":"c20","x":235,"px_width":1,"chr":"11","cumsum_values":1401.5074},{"sc_id":"c20","x":236,"px_width":8,"chr":"11","gridCell_value":2.2078,"cumsum_values":1404.7152},{"sc_id":"c20","x":245,"px_width":14,"chr":"12","gridCell_value":1.2367,"cumsum_values":1407.9519},{"sc_id":"c20","x":259,"px_width":2,"chr":"12","gridCell_value":0.5307,"cumsum_values":1409.4826},{"sc_id":"c20","x":262,"px_width":2,"chr":"13","cumsum_values":1412.4826},{"sc_id":"c20","x":264,"px_width":12,"chr":"13","gridCell_value":1.6171,"cumsum_values":1415.0997},{"sc_id":"c20","x":277,"px_width":3,"chr":"14","cumsum_values":1418.0997},{"sc_id":"c20","x":280,"px_width":9,"chr":"14","gridCell_value":2.3911,"cumsum_values":1421.4908},{"sc_id":"c20","x":289,"px_width":1,"chr":"14","cumsum_values":1423.4908},{"sc_id":"c20","x":291,"px_width":3,"chr":"15","cumsum_values":1424.4908},{"sc_id":"c20","x":294,"px_width":10,"chr":"15","gridCell_value":1.1862,"cumsum_values":1426.677},{"sc_id":"c20","x":305,"px_width":12,"chr":"16","gridCell_value":2.2644,"cumsum_values":1430.9414},{"sc_id":"c20","x":318,"px_width":10,"chr":"17","gridCell_value":1.1507,"cumsum_values":1434.092},{"sc_id":"c20","x":329,"px_width":10,"chr":"18","gridCell_value":1.6143,"cumsum_values":1437.7063},{"sc_id":"c20","x":340,"px_width":2,"chr":"19","cumsum_values":1440.7063},{"sc_id":"c20","x":342,"px_width":6,"chr":"19","gridCell_value":2.3666,"cumsum_values":1444.0729},{"sc_id":"c20","x":349,"px_width":8,"chr":"20","gridCell_value":2.4034,"cumsum_values":1448.4763},{"sc_id":"c20","x":358,"px_width":2,"chr":"21","cumsum_values":1451.4763},{"sc_id":"c20","x":360,"px_width":4,"chr":"21","gridCell_value":2.108,"cumsum_values":1454.5844},{"sc_id":"c20","x":365,"px_width":2,"chr":"22","cumsum_values":1457.5844},{"sc_id":"c20","x":367,"px_width":5,"chr":"22","gridCell_value":1.0427,"cumsum_values":1459.6271},{"sc_id":"c20","x":373,"px_width":1,"chr":"X","cumsum_values":1462.6271},{"sc_id":"c20","x":374,"px_width":18,"chr":"X","gridCell_value":2.5786,"cumsum_values":1466.2057},{"sc_id":"c20","x":393,"px_width":1,"chr":"Y","cumsum_values":1469.2057},{"sc_id":"c20","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2719,"cumsum_values":1470.4776}],"c21":[{"sc_id":"c21","x":0,"px_width":22,"chr":"1","gridCell_value":2.3951,"cumsum_values":1450.8728},{"sc_id":"c21","x":22,"px_width":1,"chr":"1","gridCell_value":1.178,"cumsum_values":1453.0507},{"sc_id":"c21","x":23,"px_width":6,"chr":"1","gridCell_value":2.5291,"cumsum_values":1456.5798},{"sc_id":"c21","x":30,"px_width":5,"chr":"2","gridCell_value":1.0919,"cumsum_values":1459.6717},{"sc_id":"c21","x":35,"px_width":1,"chr":"2","gridCell_value":0.1832,"cumsum_values":1460.8548},{"sc_id":"c21","x":36,"px_width":11,"chr":"2","gridCell_value":1.6615,"cumsum_values":1463.5164},{"sc_id":"c21","x":47,"px_width":1,"chr":"2","cumsum_values":1465.5164},{"sc_id":"c21","x":48,"px_width":11,"chr":"2","gridCell_value":1.237,"cumsum_values":1467.7534},{"sc_id":"c21","x":60,"px_width":10,"chr":"3","gridCell_value":1.2333,"cumsum_values":1470.9867},{"sc_id":"c21","x":70,"px_width":1,"chr":"3","cumsum_values":1472.9867},{"sc_id":"c21","x":71,"px_width":12,"chr":"3","gridCell_value":2.3251,"cumsum_values":1476.3118},{"sc_id":"c21","x":84,"px_width":1,"chr":"4","gridCell_value":2.8103,"cumsum_values":1481.122},{"sc_id":"c21","x":85,"px_width":22,"chr":"4","gridCell_value":1.1667,"cumsum_values":1483.2887},{"sc_id":"c21","x":108,"px_width":18,"chr":"5","gridCell_value":1.7425,"cumsum_values":1487.0313},{"sc_id":"c21","x":126,"px_width":1,"chr":"5","gridCell_value":0.9794,"cumsum_values":1489.0107},{"sc_id":"c21","x":127,"px_width":3,"chr":"5","gridCell_value":1.7784,"cumsum_values":1491.7891},{"sc_id":"c21","x":131,"px_width":3,"chr":"6","gridCell_value":2.1959,"cumsum_values":1495.985},{"sc_id":"c21","x":134,"px_width":1,"chr":"6","gridCell_value":0.4264,"cumsum_values":1497.4114},{"sc_id":"c21","x":135,"px_width":17,"chr":"6","gridCell_value":2.2933,"cumsum_values":1500.7046},{"sc_id":"c21","x":153,"px_width":19,"chr":"7","gridCell_value":2.2589,"cumsum_values":1504.9635},{"sc_id":"c21","x":173,"px_width":3,"chr":"8","gridCell_value":2.2409,"cumsum_values":1509.2044},{"sc_id":"c21","x":176,"px_width":1,"chr":"8","cumsum_values":1511.2044},{"sc_id":"c21","x":177,"px_width":14,"chr":"8","gridCell_value":2.2703,"cumsum_values":1514.4748},{"sc_id":"c21","x":192,"px_width":17,"chr":"9","gridCell_value":1.1642,"cumsum_values":1517.639},{"sc_id":"c21","x":210,"px_width":2,"chr":"10","cumsum_values":1520.639},{"sc_id":"c21","x":212,"px_width":14,"chr":"10","gridCell_value":1.1824,"cumsum_values":1522.8214},{"sc_id":"c21","x":227,"px_width":1,"chr":"11","gridCell_value":0.3545,"cumsum_values":1525.1759},{"sc_id":"c21","x":228,"px_width":16,"chr":"11","gridCell_value":1.6824,"cumsum_values":1527.8583},{"sc_id":"c21","x":245,"px_width":16,"chr":"12","gridCell_value":1.1767,"cumsum_values":1531.035},{"sc_id":"c21","x":262,"px_width":2,"chr":"13","cumsum_values":1534.035},{"sc_id":"c21","x":264,"px_width":12,"chr":"13","gridCell_value":1.5609,"cumsum_values":1536.596},{"sc_id":"c21","x":277,"px_width":3,"chr":"14","cumsum_values":1539.596},{"sc_id":"c21","x":280,"px_width":10,"chr":"14","gridCell_value":2.3473,"cumsum_values":1542.9432},{"sc_id":"c21","x":291,"px_width":3,"chr":"15","cumsum_values":1545.9432},{"sc_id":"c21","x":294,"px_width":1,"chr":"15","gridCell_value":1.2918,"cumsum_values":1548.2351},{"sc_id":"c21","x":295,"px_width":2,"chr":"15","cumsum_values":1550.2351},{"sc_id":"c21","x":297,"px_width":7,"chr":"15","gridCell_value":1.202,"cumsum_values":1552.437},{"sc_id":"c21","x":305,"px_width":12,"chr":"16","gridCell_value":2.2509,"cumsum_values":1556.6879},{"sc_id":"c21","x":318,"px_width":10,"chr":"17","gridCell_value":1.135,"cumsum_values":1559.8229},{"sc_id":"c21","x":329,"px_width":10,"chr":"18","gridCell_value":1.6033,"cumsum_values":1563.4262},{"sc_id":"c21","x":340,"px_width":2,"chr":"19","cumsum_values":1566.4262},{"sc_id":"c21","x":342,"px_width":6,"chr":"19","gridCell_value":2.1209,"cumsum_values":1569.5471},{"sc_id":"c21","x":349,"px_width":8,"chr":"20","gridCell_value":2.1771,"cumsum_values":1573.7242},{"sc_id":"c21","x":358,"px_width":2,"chr":"21","cumsum_values":1576.7242},{"sc_id":"c21","x":360,"px_width":4,"chr":"21","gridCell_value":2.16,"cumsum_values":1579.8842},{"sc_id":"c21","x":365,"px_width":2,"chr":"22","cumsum_values":1582.8842},{"sc_id":"c21","x":367,"px_width":5,"chr":"22","gridCell_value":1.1336,"cumsum_values":1585.0178},{"sc_id":"c21","x":373,"px_width":19,"chr":"X","gridCell_value":2.5236,"cumsum_values":1589.5414},{"sc_id":"c21","x":393,"px_width":1,"chr":"Y","cumsum_values":1592.5414},{"sc_id":"c21","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2503,"cumsum_values":1593.7917}],"c22":[{"sc_id":"c22","x":0,"px_width":8,"chr":"1","gridCell_value":2.3384,"cumsum_values":1574.1301},{"sc_id":"c22","x":8,"px_width":1,"chr":"1","cumsum_values":1576.1301},{"sc_id":"c22","x":9,"px_width":20,"chr":"1","gridCell_value":2.5417,"cumsum_values":1579.6718},{"sc_id":"c22","x":30,"px_width":5,"chr":"2","gridCell_value":1.1447,"cumsum_values":1582.8165},{"sc_id":"c22","x":35,"px_width":1,"chr":"2","gridCell_value":0.1692,"cumsum_values":1583.9858},{"sc_id":"c22","x":36,"px_width":13,"chr":"2","gridCell_value":1.4455,"cumsum_values":1586.4313},{"sc_id":"c22","x":49,"px_width":1,"chr":"2","cumsum_values":1588.4313},{"sc_id":"c22","x":50,"px_width":9,"chr":"2","gridCell_value":1.115,"cumsum_values":1590.5462},{"sc_id":"c22","x":60,"px_width":3,"chr":"3","gridCell_value":1.225,"cumsum_values":1593.7713},{"sc_id":"c22","x":63,"px_width":1,"chr":"3","cumsum_values":1595.7713},{"sc_id":"c22","x":64,"px_width":6,"chr":"3","gridCell_value":1.1928,"cumsum_values":1597.9641},{"sc_id":"c22","x":70,"px_width":1,"chr":"3","cumsum_values":1599.9641},{"sc_id":"c22","x":71,"px_width":12,"chr":"3","gridCell_value":2.2464,"cumsum_values":1603.2105},{"sc_id":"c22","x":84,"px_width":23,"chr":"4","gridCell_value":1.148,"cumsum_values":1606.3585},{"sc_id":"c22","x":108,"px_width":22,"chr":"5","gridCell_value":1.7478,"cumsum_values":1610.1062},{"sc_id":"c22","x":131,"px_width":3,"chr":"6","gridCell_value":2.2609,"cumsum_values":1614.3671},{"sc_id":"c22","x":134,"px_width":1,"chr":"6","gridCell_value":0.4336,"cumsum_values":1615.8007},{"sc_id":"c22","x":135,"px_width":7,"chr":"6","gridCell_value":2.306,"cumsum_values":1619.1067},{"sc_id":"c22","x":142,"px_width":1,"chr":"6","cumsum_values":1621.1067},{"sc_id":"c22","x":143,"px_width":9,"chr":"6","gridCell_value":2.2108,"cumsum_values":1624.3176},{"sc_id":"c22","x":153,"px_width":19,"chr":"7","gridCell_value":1.8802,"cumsum_values":1628.1978},{"sc_id":"c22","x":173,"px_width":1,"chr":"8","gridCell_value":2.2672,"cumsum_values":1632.465},{"sc_id":"c22","x":174,"px_width":2,"chr":"8","cumsum_values":1634.465},{"sc_id":"c22","x":176,"px_width":15,"chr":"8","gridCell_value":2.2224,"cumsum_values":1637.6873},{"sc_id":"c22","x":192,"px_width":12,"chr":"9","gridCell_value":1.1876,"cumsum_values":1640.8749},{"sc_id":"c22","x":204,"px_width":1,"chr":"9","gridCell_value":0.3501,"cumsum_values":1642.225},{"sc_id":"c22","x":205,"px_width":4,"chr":"9","gridCell_value":1.1159,"cumsum_values":1644.3409},{"sc_id":"c22","x":210,"px_width":16,"chr":"10","gridCell_value":1.2212,"cumsum_values":1647.5621},{"sc_id":"c22","x":227,"px_width":1,"chr":"11","gridCell_value":0.7926,"cumsum_values":1650.3547},{"sc_id":"c22","x":228,"px_width":9,"chr":"11","gridCell_value":2.0922,"cumsum_values":1653.4468},{"sc_id":"c22","x":237,"px_width":1,"chr":"11","cumsum_values":1655.4468},{"sc_id":"c22","x":238,"px_width":6,"chr":"11","gridCell_value":1.7503,"cumsum_values":1658.1971},{"sc_id":"c22","x":245,"px_width":16,"chr":"12","gridCell_value":1.1901,"cumsum_values":1661.3873},{"sc_id":"c22","x":262,"px_width":2,"chr":"13","cumsum_values":1664.3873},{"sc_id":"c22","x":264,"px_width":7,"chr":"13","gridCell_value":1.5257,"cumsum_values":1666.913},{"sc_id":"c22","x":271,"px_width":1,"chr":"13","cumsum_values":1668.913},{"sc_id":"c22","x":272,"px_width":4,"chr":"13","gridCell_value":1.6434,"cumsum_values":1671.5564},{"sc_id":"c22","x":277,"px_width":3,"chr":"14","cumsum_values":1674.5564},{"sc_id":"c22","x":280,"px_width":7,"chr":"14","gridCell_value":2.3465,"cumsum_values":1677.9029},{"sc_id":"c22","x":287,"px_width":1,"chr":"14","cumsum_values":1679.9029},{"sc_id":"c22","x":288,"px_width":2,"chr":"14","gridCell_value":2.3996,"cumsum_values":1683.3025},{"sc_id":"c22","x":291,"px_width":3,"chr":"15","cumsum_values":1686.3025},{"sc_id":"c22","x":294,"px_width":10,"chr":"15","gridCell_value":1.3389,"cumsum_values":1688.6414},{"sc_id":"c22","x":305,"px_width":12,"chr":"16","gridCell_value":2.4118,"cumsum_values":1693.0531},{"sc_id":"c22","x":318,"px_width":10,"chr":"17","gridCell_value":1.2309,"cumsum_values":1696.284},{"sc_id":"c22","x":329,"px_width":10,"chr":"18","gridCell_value":1.762,"cumsum_values":1700.046},{"sc_id":"c22","x":340,"px_width":2,"chr":"19","cumsum_values":1703.046},{"sc_id":"c22","x":342,"px_width":6,"chr":"19","gridCell_value":2.4734,"cumsum_values":1706.5194},{"sc_id":"c22","x":349,"px_width":8,"chr":"20","gridCell_value":2.3269,"cumsum_values":1710.8463},{"sc_id":"c22","x":358,"px_width":2,"chr":"21","cumsum_values":1713.8463},{"sc_id":"c22","x":360,"px_width":4,"chr":"21","gridCell_value":2.2587,"cumsum_values":1717.105},{"sc_id":"c22","x":365,"px_width":2,"chr":"22","cumsum_values":1720.105},{"sc_id":"c22","x":367,"px_width":5,"chr":"22","gridCell_value":1.2857,"cumsum_values":1722.3908},{"sc_id":"c22","x":373,"px_width":19,"chr":"X","gridCell_value":1.9078,"cumsum_values":1726.2985},{"sc_id":"c22","x":393,"px_width":1,"chr":"Y","cumsum_values":1729.2985},{"sc_id":"c22","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2304,"cumsum_values":1730.529}],"c23":[{"sc_id":"c23","x":0,"px_width":29,"chr":"1","gridCell_value":2.2316,"cumsum_values":1710.7606},{"sc_id":"c23","x":30,"px_width":5,"chr":"2","gridCell_value":1.0242,"cumsum_values":1713.7848},{"sc_id":"c23","x":35,"px_width":1,"chr":"2","gridCell_value":0.1503,"cumsum_values":1714.9351},{"sc_id":"c23","x":36,"px_width":23,"chr":"2","gridCell_value":1.2751,"cumsum_values":1717.2102},{"sc_id":"c23","x":60,"px_width":3,"chr":"3","gridCell_value":1.2194,"cumsum_values":1720.4296},{"sc_id":"c23","x":63,"px_width":1,"chr":"3","cumsum_values":1722.4296},{"sc_id":"c23","x":64,"px_width":5,"chr":"3","gridCell_value":1.1283,"cumsum_values":1724.558},{"sc_id":"c23","x":69,"px_width":1,"chr":"3","gridCell_value":0.3693,"cumsum_values":1725.9273},{"sc_id":"c23","x":70,"px_width":13,"chr":"3","gridCell_value":2.1862,"cumsum_values":1729.1134},{"sc_id":"c23","x":84,"px_width":23,"chr":"4","gridCell_value":1.0358,"cumsum_values":1732.1493},{"sc_id":"c23","x":108,"px_width":22,"chr":"5","gridCell_value":1.657,"cumsum_values":1735.8063},{"sc_id":"c23","x":131,"px_width":3,"chr":"6","gridCell_value":2.3566,"cumsum_values":1740.1629},{"sc_id":"c23","x":134,"px_width":1,"chr":"6","gridCell_value":0.4745,"cumsum_values":1741.6374},{"sc_id":"c23","x":135,"px_width":17,"chr":"6","gridCell_value":2.1739,"cumsum_values":1744.8113},{"sc_id":"c23","x":153,"px_width":19,"chr":"7","gridCell_value":2.2548,"cumsum_values":1749.0661},{"sc_id":"c23","x":173,"px_width":13,"chr":"8","gridCell_value":2.296,"cumsum_values":1753.3621},{"sc_id":"c23","x":186,"px_width":1,"chr":"8","gridCell_value":0.6495,"cumsum_values":1755.0115},{"sc_id":"c23","x":187,"px_width":4,"chr":"8","gridCell_value":1.9557,"cumsum_values":1757.9673},{"sc_id":"c23","x":192,"px_width":17,"chr":"9","gridCell_value":1.0814,"cumsum_values":1761.0487},{"sc_id":"c23","x":210,"px_width":16,"chr":"10","gridCell_value":1.1248,"cumsum_values":1764.1735},{"sc_id":"c23","x":227,"px_width":1,"chr":"11","gridCell_value":0.6752,"cumsum_values":1766.8486},{"sc_id":"c23","x":228,"px_width":16,"chr":"11","gridCell_value":2.1005,"cumsum_values":1769.9491},{"sc_id":"c23","x":245,"px_width":16,"chr":"12","gridCell_value":1.1419,"cumsum_values":1773.091},{"sc_id":"c23","x":262,"px_width":2,"chr":"13","cumsum_values":1776.091},{"sc_id":"c23","x":264,"px_width":12,"chr":"13","gridCell_value":1.4937,"cumsum_values":1778.5847},{"sc_id":"c23","x":277,"px_width":3,"chr":"14","cumsum_values":1781.5847},{"sc_id":"c23","x":280,"px_width":10,"chr":"14","gridCell_value":2.1809,"cumsum_values":1784.7655},{"sc_id":"c23","x":291,"px_width":3,"chr":"15","cumsum_values":1787.7655},{"sc_id":"c23","x":294,"px_width":10,"chr":"15","gridCell_value":1.0586,"cumsum_values":1789.8242},{"sc_id":"c23","x":305,"px_width":12,"chr":"16","gridCell_value":2.2248,"cumsum_values":1794.049},{"sc_id":"c23","x":318,"px_width":10,"chr":"17","gridCell_value":1.0024,"cumsum_values":1797.0514},{"sc_id":"c23","x":329,"px_width":10,"chr":"18","gridCell_value":1.6562,"cumsum_values":1800.7076},{"sc_id":"c23","x":340,"px_width":2,"chr":"19","cumsum_values":1803.7076},{"sc_id":"c23","x":342,"px_width":6,"chr":"19","gridCell_value":2.1687,"cumsum_values":1806.8762},{"sc_id":"c23","x":349,"px_width":8,"chr":"20","gridCell_value":2.0108,"cumsum_values":1810.8871},{"sc_id":"c23","x":358,"px_width":2,"chr":"21","cumsum_values":1813.8871},{"sc_id":"c23","x":360,"px_width":4,"chr":"21","gridCell_value":2.0638,"cumsum_values":1816.9509},{"sc_id":"c23","x":365,"px_width":2,"chr":"22","cumsum_values":1819.9509},{"sc_id":"c23","x":367,"px_width":5,"chr":"22","gridCell_value":0.9545,"cumsum_values":1821.9054},{"sc_id":"c23","x":373,"px_width":19,"chr":"X","gridCell_value":2.3221,"cumsum_values":1826.2274},{"sc_id":"c23","x":393,"px_width":1,"chr":"Y","cumsum_values":1829.2274},{"sc_id":"c23","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2518,"cumsum_values":1830.4793}],"c24":[{"sc_id":"c24","x":0,"px_width":8,"chr":"1","gridCell_value":2.2003,"cumsum_values":1810.6796},{"sc_id":"c24","x":8,"px_width":1,"chr":"1","cumsum_values":1812.6796},{"sc_id":"c24","x":9,"px_width":20,"chr":"1","gridCell_value":2.5184,"cumsum_values":1816.198},{"sc_id":"c24","x":30,"px_width":5,"chr":"2","gridCell_value":1.0523,"cumsum_values":1819.2503},{"sc_id":"c24","x":35,"px_width":1,"chr":"2","gridCell_value":0.195,"cumsum_values":1820.4453},{"sc_id":"c24","x":36,"px_width":23,"chr":"2","gridCell_value":1.3911,"cumsum_values":1822.8364},{"sc_id":"c24","x":60,"px_width":10,"chr":"3","gridCell_value":1.1423,"cumsum_values":1825.9787},{"sc_id":"c24","x":70,"px_width":1,"chr":"3","cumsum_values":1827.9787},{"sc_id":"c24","x":71,"px_width":12,"chr":"3","gridCell_value":2.2958,"cumsum_values":1831.2745},{"sc_id":"c24","x":84,"px_width":2,"chr":"4","gridCell_value":1.4477,"cumsum_values":1834.7222},{"sc_id":"c24","x":86,"px_width":1,"chr":"4","cumsum_values":1836.7222},{"sc_id":"c24","x":87,"px_width":20,"chr":"4","gridCell_value":1.1907,"cumsum_values":1838.9129},{"sc_id":"c24","x":108,"px_width":22,"chr":"5","gridCell_value":1.7276,"cumsum_values":1842.6406},{"sc_id":"c24","x":131,"px_width":3,"chr":"6","gridCell_value":2.4732,"cumsum_values":1847.1138},{"sc_id":"c24","x":134,"px_width":1,"chr":"6","gridCell_value":0.4476,"cumsum_values":1848.5614},{"sc_id":"c24","x":135,"px_width":17,"chr":"6","gridCell_value":2.2899,"cumsum_values":1851.8513},{"sc_id":"c24","x":153,"px_width":1,"chr":"7","gridCell_value":2.2444,"cumsum_values":1856.0957},{"sc_id":"c24","x":154,"px_width":1,"chr":"7","cumsum_values":1858.0957},{"sc_id":"c24","x":155,"px_width":17,"chr":"7","gridCell_value":2.3102,"cumsum_values":1861.4058},{"sc_id":"c24","x":173,"px_width":18,"chr":"8","gridCell_value":2.315,"cumsum_values":1865.7208},{"sc_id":"c24","x":192,"px_width":17,"chr":"9","gridCell_value":1.1157,"cumsum_values":1868.8365},{"sc_id":"c24","x":210,"px_width":2,"chr":"10","gridCell_value":1.3402,"cumsum_values":1872.1767},{"sc_id":"c24","x":212,"px_width":1,"chr":"10","cumsum_values":1874.1767},{"sc_id":"c24","x":213,"px_width":4,"chr":"10","gridCell_value":1.1087,"cumsum_values":1876.2855},{"sc_id":"c24","x":217,"px_width":1,"chr":"10","gridCell_value":0.3304,"cumsum_values":1877.6159},{"sc_id":"c24","x":218,"px_width":8,"chr":"10","gridCell_value":1.1163,"cumsum_values":1879.7322},{"sc_id":"c24","x":227,"px_width":1,"chr":"11","gridCell_value":0.6843,"cumsum_values":1882.4165},{"sc_id":"c24","x":228,"px_width":16,"chr":"11","gridCell_value":2.0718,"cumsum_values":1885.4884},{"sc_id":"c24","x":245,"px_width":16,"chr":"12","gridCell_value":1.2297,"cumsum_values":1888.7181},{"sc_id":"c24","x":262,"px_width":2,"chr":"13","cumsum_values":1891.7181},{"sc_id":"c24","x":264,"px_width":2,"chr":"13","gridCell_value":1.1223,"cumsum_values":1893.8403},{"sc_id":"c24","x":266,"px_width":1,"chr":"13","cumsum_values":1895.8403},{"sc_id":"c24","x":267,"px_width":9,"chr":"13","gridCell_value":1.2856,"cumsum_values":1898.1259},{"sc_id":"c24","x":277,"px_width":3,"chr":"14","cumsum_values":1901.1259},{"sc_id":"c24","x":280,"px_width":1,"chr":"14","gridCell_value":2.188,"cumsum_values":1904.3139},{"sc_id":"c24","x":281,"px_width":1,"chr":"14","gridCell_value":1.0447,"cumsum_values":1906.3586},{"sc_id":"c24","x":282,"px_width":8,"chr":"14","gridCell_value":2.2795,"cumsum_values":1909.638},{"sc_id":"c24","x":291,"px_width":3,"chr":"15","cumsum_values":1912.638},{"sc_id":"c24","x":294,"px_width":10,"chr":"15","gridCell_value":1.1836,"cumsum_values":1914.8216},{"sc_id":"c24","x":305,"px_width":12,"chr":"16","gridCell_value":2.1486,"cumsum_values":1918.9703},{"sc_id":"c24","x":318,"px_width":10,"chr":"17","gridCell_value":1.0703,"cumsum_values":1922.0405},{"sc_id":"c24","x":329,"px_width":10,"chr":"18","gridCell_value":1.6496,"cumsum_values":1925.6901},{"sc_id":"c24","x":340,"px_width":2,"chr":"19","cumsum_values":1928.6901},{"sc_id":"c24","x":342,"px_width":6,"chr":"19","gridCell_value":2.2658,"cumsum_values":1931.9559},{"sc_id":"c24","x":349,"px_width":8,"chr":"20","gridCell_value":2.2006,"cumsum_values":1936.1565},{"sc_id":"c24","x":358,"px_width":2,"chr":"21","cumsum_values":1939.1565},{"sc_id":"c24","x":360,"px_width":4,"chr":"21","gridCell_value":2.0667,"cumsum_values":1942.2232},{"sc_id":"c24","x":365,"px_width":2,"chr":"22","cumsum_values":1945.2232},{"sc_id":"c24","x":367,"px_width":5,"chr":"22","gridCell_value":1.0801,"cumsum_values":1947.3032},{"sc_id":"c24","x":373,"px_width":19,"chr":"X","gridCell_value":2.4791,"cumsum_values":1951.7823},{"sc_id":"c24","x":393,"px_width":1,"chr":"Y","cumsum_values":1954.7823},{"sc_id":"c24","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2606,"cumsum_values":1956.0429}],"c25":[{"sc_id":"c25","x":0,"px_width":24,"chr":"1","gridCell_value":2.4118,"cumsum_values":1936.4547},{"sc_id":"c25","x":24,"px_width":1,"chr":"1","cumsum_values":1938.4547},{"sc_id":"c25","x":25,"px_width":1,"chr":"1","gridCell_value":2.5378,"cumsum_values":1941.9925},{"sc_id":"c25","x":26,"px_width":1,"chr":"1","cumsum_values":1943.9925},{"sc_id":"c25","x":27,"px_width":2,"chr":"1","gridCell_value":2.8787,"cumsum_values":1947.8712},{"sc_id":"c25","x":30,"px_width":5,"chr":"2","gridCell_value":1.156,"cumsum_values":1951.0271},{"sc_id":"c25","x":35,"px_width":1,"chr":"2","gridCell_value":0.2197,"cumsum_values":1952.2468},{"sc_id":"c25","x":36,"px_width":5,"chr":"2","gridCell_value":2.3858,"cumsum_values":1955.6327},{"sc_id":"c25","x":41,"px_width":12,"chr":"2","gridCell_value":1.1171,"cumsum_values":1957.7498},{"sc_id":"c25","x":53,"px_width":1,"chr":"2","gridCell_value":0.4116,"cumsum_values":1959.1614},{"sc_id":"c25","x":54,"px_width":1,"chr":"2","gridCell_value":1.0873,"cumsum_values":1961.2487},{"sc_id":"c25","x":55,"px_width":3,"chr":"2","cumsum_values":1963.2487},{"sc_id":"c25","x":58,"px_width":1,"chr":"2","gridCell_value":0.9763,"cumsum_values":1965.225},{"sc_id":"c25","x":60,"px_width":10,"chr":"3","gridCell_value":1.1711,"cumsum_values":1968.3961},{"sc_id":"c25","x":70,"px_width":7,"chr":"3","gridCell_value":2.1892,"cumsum_values":1971.5853},{"sc_id":"c25","x":77,"px_width":1,"chr":"3","cumsum_values":1973.5853},{"sc_id":"c25","x":78,"px_width":5,"chr":"3","gridCell_value":2.1296,"cumsum_values":1976.7149},{"sc_id":"c25","x":84,"px_width":1,"chr":"4","gridCell_value":2.8333,"cumsum_values":1981.5483},{"sc_id":"c25","x":85,"px_width":14,"chr":"4","gridCell_value":1.129,"cumsum_values":1983.6772},{"sc_id":"c25","x":99,"px_width":1,"chr":"4","gridCell_value":0.5747,"cumsum_values":1985.2519},{"sc_id":"c25","x":100,"px_width":7,"chr":"4","gridCell_value":1.0867,"cumsum_values":1987.3386},{"sc_id":"c25","x":108,"px_width":12,"chr":"5","gridCell_value":1.7413,"cumsum_values":1991.08},{"sc_id":"c25","x":120,"px_width":1,"chr":"5","cumsum_values":1993.08},{"sc_id":"c25","x":121,"px_width":9,"chr":"5","gridCell_value":1.7696,"cumsum_values":1995.8495},{"sc_id":"c25","x":131,"px_width":3,"chr":"6","gridCell_value":2.2974,"cumsum_values":2000.1469},{"sc_id":"c25","x":134,"px_width":1,"chr":"6","gridCell_value":0.412,"cumsum_values":2001.5589},{"sc_id":"c25","x":135,"px_width":17,"chr":"6","gridCell_value":2.2292,"cumsum_values":2004.7881},{"sc_id":"c25","x":153,"px_width":13,"chr":"7","gridCell_value":2.1991,"cumsum_values":2008.9872},{"sc_id":"c25","x":166,"px_width":1,"chr":"7","gridCell_value":0.7701,"cumsum_values":2010.7573},{"sc_id":"c25","x":167,"px_width":5,"chr":"7","gridCell_value":2.3584,"cumsum_values":2014.1157},{"sc_id":"c25","x":173,"px_width":18,"chr":"8","gridCell_value":2.1732,"cumsum_values":2018.2889},{"sc_id":"c25","x":192,"px_width":17,"chr":"9","gridCell_value":1.2166,"cumsum_values":2021.5054},{"sc_id":"c25","x":210,"px_width":13,"chr":"10","gridCell_value":1.1928,"cumsum_values":2024.6983},{"sc_id":"c25","x":223,"px_width":3,"chr":"10","gridCell_value":0.6553,"cumsum_values":2026.3536},{"sc_id":"c25","x":227,"px_width":17,"chr":"11","gridCell_value":2.1349,"cumsum_values":2030.4885},{"sc_id":"c25","x":245,"px_width":8,"chr":"12","gridCell_value":1.0926,"cumsum_values":2033.5811},{"sc_id":"c25","x":253,"px_width":1,"chr":"12","cumsum_values":2035.5811},{"sc_id":"c25","x":254,"px_width":7,"chr":"12","gridCell_value":1.0564,"cumsum_values":2037.6375},{"sc_id":"c25","x":262,"px_width":2,"chr":"13","cumsum_values":2040.6375},{"sc_id":"c25","x":264,"px_width":2,"chr":"13","gridCell_value":1.2268,"cumsum_values":2042.8643},{"sc_id":"c25","x":266,"px_width":1,"chr":"13","gridCell_value":0.364,"cumsum_values":2044.2283},{"sc_id":"c25","x":267,"px_width":9,"chr":"13","gridCell_value":1.6216,"cumsum_values":2046.8499},{"sc_id":"c25","x":277,"px_width":3,"chr":"14","cumsum_values":2049.8499},{"sc_id":"c25","x":280,"px_width":2,"chr":"14","gridCell_value":2.1666,"cumsum_values":2053.0165},{"sc_id":"c25","x":282,"px_width":1,"chr":"14","cumsum_values":2055.0165},{"sc_id":"c25","x":283,"px_width":7,"chr":"14","gridCell_value":2.2338,"cumsum_values":2058.2503},{"sc_id":"c25","x":291,"px_width":3,"chr":"15","cumsum_values":2061.2503},{"sc_id":"c25","x":294,"px_width":10,"chr":"15","gridCell_value":1.2011,"cumsum_values":2063.4514},{"sc_id":"c25","x":305,"px_width":12,"chr":"16","gridCell_value":2.3342,"cumsum_values":2067.7856},{"sc_id":"c25","x":318,"px_width":10,"chr":"17","gridCell_value":1.1654,"cumsum_values":2070.9509},{"sc_id":"c25","x":329,"px_width":10,"chr":"18","gridCell_value":1.6773,"cumsum_values":2074.6282},{"sc_id":"c25","x":340,"px_width":2,"chr":"19","cumsum_values":2077.6282},{"sc_id":"c25","x":342,"px_width":6,"chr":"19","gridCell_value":2.525,"cumsum_values":2081.1532},{"sc_id":"c25","x":349,"px_width":4,"chr":"20","gridCell_value":2.3338,"cumsum_values":2085.487},{"sc_id":"c25","x":353,"px_width":1,"chr":"20","cumsum_values":2087.487},{"sc_id":"c25","x":354,"px_width":3,"chr":"20","gridCell_value":2.5263,"cumsum_values":2091.0133},{"sc_id":"c25","x":358,"px_width":2,"chr":"21","cumsum_values":2094.0133},{"sc_id":"c25","x":360,"px_width":4,"chr":"21","gridCell_value":2.2282,"cumsum_values":2097.2415},{"sc_id":"c25","x":365,"px_width":2,"chr":"22","cumsum_values":2100.2415},{"sc_id":"c25","x":367,"px_width":5,"chr":"22","gridCell_value":1.1106,"cumsum_values":2102.3522},{"sc_id":"c25","x":373,"px_width":19,"chr":"X","gridCell_value":2.4373,"cumsum_values":2106.7895},{"sc_id":"c25","x":393,"px_width":1,"chr":"Y","cumsum_values":2109.7895},{"sc_id":"c25","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2322,"cumsum_values":2111.0217}],"c26":[{"sc_id":"c26","x":0,"px_width":29,"chr":"1","gridCell_value":2.359,"cumsum_values":2091.3807},{"sc_id":"c26","x":30,"px_width":5,"chr":"2","gridCell_value":1.0073,"cumsum_values":2094.388},{"sc_id":"c26","x":35,"px_width":1,"chr":"2","gridCell_value":0.1386,"cumsum_values":2095.5266},{"sc_id":"c26","x":36,"px_width":4,"chr":"2","gridCell_value":2.3413,"cumsum_values":2098.8679},{"sc_id":"c26","x":40,"px_width":1,"chr":"2","cumsum_values":2100.8679},{"sc_id":"c26","x":41,"px_width":5,"chr":"2","gridCell_value":1.1806,"cumsum_values":2103.0485},{"sc_id":"c26","x":46,"px_width":2,"chr":"2","cumsum_values":2105.0485},{"sc_id":"c26","x":48,"px_width":11,"chr":"2","gridCell_value":1.1313,"cumsum_values":2107.1798},{"sc_id":"c26","x":60,"px_width":10,"chr":"3","gridCell_value":1.1449,"cumsum_values":2110.3247},{"sc_id":"c26","x":70,"px_width":6,"chr":"3","gridCell_value":2.2788,"cumsum_values":2113.6035},{"sc_id":"c26","x":76,"px_width":1,"chr":"3","cumsum_values":2115.6035},{"sc_id":"c26","x":77,"px_width":6,"chr":"3","gridCell_value":2.193,"cumsum_values":2118.7965},{"sc_id":"c26","x":84,"px_width":14,"chr":"4","gridCell_value":1.2156,"cumsum_values":2122.0121},{"sc_id":"c26","x":98,"px_width":1,"chr":"4","cumsum_values":2124.0121},{"sc_id":"c26","x":99,"px_width":8,"chr":"4","gridCell_value":1.1548,"cumsum_values":2126.167},{"sc_id":"c26","x":108,"px_width":22,"chr":"5","gridCell_value":1.7663,"cumsum_values":2129.9333},{"sc_id":"c26","x":131,"px_width":3,"chr":"6","gridCell_value":2.2662,"cumsum_values":2134.1995},{"sc_id":"c26","x":134,"px_width":1,"chr":"6","gridCell_value":0.3868,"cumsum_values":2135.5863},{"sc_id":"c26","x":135,"px_width":17,"chr":"6","gridCell_value":2.3068,"cumsum_values":2138.8931},{"sc_id":"c26","x":153,"px_width":13,"chr":"7","gridCell_value":2.3806,"cumsum_values":2143.2736},{"sc_id":"c26","x":166,"px_width":1,"chr":"7","cumsum_values":2145.2736},{"sc_id":"c26","x":167,"px_width":5,"chr":"7","gridCell_value":2.4094,"cumsum_values":2148.6831},{"sc_id":"c26","x":173,"px_width":16,"chr":"8","gridCell_value":2.3574,"cumsum_values":2153.0405},{"sc_id":"c26","x":189,"px_width":2,"chr":"8","gridCell_value":1.2662,"cumsum_values":2155.3067},{"sc_id":"c26","x":192,"px_width":9,"chr":"9","gridCell_value":1.2476,"cumsum_values":2158.5542},{"sc_id":"c26","x":201,"px_width":1,"chr":"9","cumsum_values":2160.5542},{"sc_id":"c26","x":202,"px_width":7,"chr":"9","gridCell_value":1.1513,"cumsum_values":2162.7055},{"sc_id":"c26","x":210,"px_width":12,"chr":"10","gridCell_value":1.1412,"cumsum_values":2165.8467},{"sc_id":"c26","x":222,"px_width":1,"chr":"10","cumsum_values":2167.8467},{"sc_id":"c26","x":223,"px_width":3,"chr":"10","gridCell_value":1.1532,"cumsum_values":2169.9999},{"sc_id":"c26","x":227,"px_width":1,"chr":"11","gridCell_value":0.7993,"cumsum_values":2172.7992},{"sc_id":"c26","x":228,"px_width":16,"chr":"11","gridCell_value":2.1738,"cumsum_values":2175.9729},{"sc_id":"c26","x":245,"px_width":16,"chr":"12","gridCell_value":1.1401,"cumsum_values":2179.1131},{"sc_id":"c26","x":262,"px_width":2,"chr":"13","cumsum_values":2182.1131},{"sc_id":"c26","x":264,"px_width":1,"chr":"13","gridCell_value":1.1808,"cumsum_values":2184.2939},{"sc_id":"c26","x":265,"px_width":1,"chr":"13","cumsum_values":2186.2939},{"sc_id":"c26","x":266,"px_width":10,"chr":"13","gridCell_value":1.5883,"cumsum_values":2188.8822},{"sc_id":"c26","x":277,"px_width":3,"chr":"14","cumsum_values":2191.8822},{"sc_id":"c26","x":280,"px_width":10,"chr":"14","gridCell_value":2.2634,"cumsum_values":2195.1456},{"sc_id":"c26","x":291,"px_width":3,"chr":"15","cumsum_values":2198.1456},{"sc_id":"c26","x":294,"px_width":10,"chr":"15","gridCell_value":1.1897,"cumsum_values":2200.3353},{"sc_id":"c26","x":305,"px_width":12,"chr":"16","gridCell_value":2.0457,"cumsum_values":2204.381},{"sc_id":"c26","x":318,"px_width":3,"chr":"17","gridCell_value":1.0924,"cumsum_values":2207.4734},{"sc_id":"c26","x":321,"px_width":1,"chr":"17","cumsum_values":2209.4734},{"sc_id":"c26","x":322,"px_width":6,"chr":"17","gridCell_value":0.9155,"cumsum_values":2211.3889},{"sc_id":"c26","x":329,"px_width":10,"chr":"18","gridCell_value":1.7518,"cumsum_values":2215.1407},{"sc_id":"c26","x":340,"px_width":2,"chr":"19","cumsum_values":2218.1407},{"sc_id":"c26","x":342,"px_width":6,"chr":"19","gridCell_value":2.0361,"cumsum_values":2221.1768},{"sc_id":"c26","x":349,"px_width":8,"chr":"20","gridCell_value":2.0864,"cumsum_values":2225.2631},{"sc_id":"c26","x":358,"px_width":2,"chr":"21","cumsum_values":2228.2631},{"sc_id":"c26","x":360,"px_width":4,"chr":"21","gridCell_value":2.2173,"cumsum_values":2231.4804},{"sc_id":"c26","x":365,"px_width":2,"chr":"22","cumsum_values":2234.4804},{"sc_id":"c26","x":367,"px_width":2,"chr":"22","gridCell_value":1.031,"cumsum_values":2236.5115},{"sc_id":"c26","x":369,"px_width":2,"chr":"22","cumsum_values":2238.5115},{"sc_id":"c26","x":371,"px_width":1,"chr":"22","gridCell_value":0.8938,"cumsum_values":2240.4053},{"sc_id":"c26","x":373,"px_width":1,"chr":"X","cumsum_values":2243.4053},{"sc_id":"c26","x":374,"px_width":16,"chr":"X","gridCell_value":2.6279,"cumsum_values":2247.0331},{"sc_id":"c26","x":390,"px_width":1,"chr":"X","cumsum_values":2249.0331},{"sc_id":"c26","x":391,"px_width":1,"chr":"X","gridCell_value":2.1798,"cumsum_values":2252.2129},{"sc_id":"c26","x":393,"px_width":1,"chr":"Y","cumsum_values":2255.2129},{"sc_id":"c26","x":394,"px_width":2,"chr":"Y","gridCell_value":0.199,"cumsum_values":2256.412}],"c27":[{"sc_id":"c27","x":0,"px_width":8,"chr":"1","gridCell_value":2.1339,"cumsum_values":2236.5459},{"sc_id":"c27","x":8,"px_width":1,"chr":"1","cumsum_values":2238.5459},{"sc_id":"c27","x":9,"px_width":2,"chr":"1","gridCell_value":2.2675,"cumsum_values":2241.8134},{"sc_id":"c27","x":11,"px_width":1,"chr":"1","cumsum_values":2243.8134},{"sc_id":"c27","x":12,"px_width":17,"chr":"1","gridCell_value":2.6097,"cumsum_values":2247.4231},{"sc_id":"c27","x":30,"px_width":5,"chr":"2","gridCell_value":1.168,"cumsum_values":2250.5911},{"sc_id":"c27","x":35,"px_width":1,"chr":"2","gridCell_value":0.2373,"cumsum_values":2251.8285},{"sc_id":"c27","x":36,"px_width":4,"chr":"2","gridCell_value":2.5282,"cumsum_values":2255.3566},{"sc_id":"c27","x":40,"px_width":1,"chr":"2","cumsum_values":2257.3566},{"sc_id":"c27","x":41,"px_width":18,"chr":"2","gridCell_value":1.1301,"cumsum_values":2259.4867},{"sc_id":"c27","x":60,"px_width":9,"chr":"3","gridCell_value":1.1338,"cumsum_values":2262.6205},{"sc_id":"c27","x":69,"px_width":2,"chr":"3","cumsum_values":2264.6205},{"sc_id":"c27","x":71,"px_width":3,"chr":"3","gridCell_value":2.4183,"cumsum_values":2268.0388},{"sc_id":"c27","x":74,"px_width":1,"chr":"3","cumsum_values":2270.0388},{"sc_id":"c27","x":75,"px_width":8,"chr":"3","gridCell_value":2.3951,"cumsum_values":2273.434},{"sc_id":"c27","x":84,"px_width":2,"chr":"4","gridCell_value":1.2169,"cumsum_values":2276.6508},{"sc_id":"c27","x":86,"px_width":1,"chr":"4","cumsum_values":2278.6508},{"sc_id":"c27","x":87,"px_width":8,"chr":"4","gridCell_value":1.1102,"cumsum_values":2280.761},{"sc_id":"c27","x":95,"px_width":1,"chr":"4","cumsum_values":2282.761},{"sc_id":"c27","x":96,"px_width":4,"chr":"4","gridCell_value":1.1401,"cumsum_values":2284.9012},{"sc_id":"c27","x":100,"px_width":1,"chr":"4","cumsum_values":2286.9012},{"sc_id":"c27","x":101,"px_width":6,"chr":"4","gridCell_value":1.0447,"cumsum_values":2288.9459},{"sc_id":"c27","x":108,"px_width":16,"chr":"5","gridCell_value":1.6897,"cumsum_values":2292.6356},{"sc_id":"c27","x":124,"px_width":1,"chr":"5","gridCell_value":0.5978,"cumsum_values":2294.2334},{"sc_id":"c27","x":125,"px_width":5,"chr":"5","gridCell_value":1.528,"cumsum_values":2296.7614},{"sc_id":"c27","x":131,"px_width":3,"chr":"6","gridCell_value":2.1076,"cumsum_values":2300.8689},{"sc_id":"c27","x":134,"px_width":1,"chr":"6","gridCell_value":0.4743,"cumsum_values":2302.3433},{"sc_id":"c27","x":135,"px_width":17,"chr":"6","gridCell_value":2.2335,"cumsum_values":2305.5767},{"sc_id":"c27","x":153,"px_width":19,"chr":"7","gridCell_value":2.2653,"cumsum_values":2309.842},{"sc_id":"c27","x":173,"px_width":18,"chr":"8","gridCell_value":2.1694,"cumsum_values":2314.0115},{"sc_id":"c27","x":192,"px_width":17,"chr":"9","gridCell_value":1.1123,"cumsum_values":2317.1237},{"sc_id":"c27","x":210,"px_width":16,"chr":"10","gridCell_value":1.1222,"cumsum_values":2320.2459},{"sc_id":"c27","x":227,"px_width":1,"chr":"11","gridCell_value":0.9683,"cumsum_values":2323.2142},{"sc_id":"c27","x":228,"px_width":4,"chr":"11","gridCell_value":2.3887,"cumsum_values":2326.6029},{"sc_id":"c27","x":232,"px_width":1,"chr":"11","cumsum_values":2328.6029},{"sc_id":"c27","x":233,"px_width":11,"chr":"11","gridCell_value":2.2799,"cumsum_values":2331.8828},{"sc_id":"c27","x":245,"px_width":16,"chr":"12","gridCell_value":1.1249,"cumsum_values":2335.0077},{"sc_id":"c27","x":262,"px_width":2,"chr":"13","cumsum_values":2338.0077},{"sc_id":"c27","x":264,"px_width":12,"chr":"13","gridCell_value":1.4714,"cumsum_values":2340.4792},{"sc_id":"c27","x":277,"px_width":3,"chr":"14","cumsum_values":2343.4792},{"sc_id":"c27","x":280,"px_width":9,"chr":"14","gridCell_value":2.3224,"cumsum_values":2346.8015},{"sc_id":"c27","x":289,"px_width":1,"chr":"14","cumsum_values":2348.8015},{"sc_id":"c27","x":291,"px_width":3,"chr":"15","cumsum_values":2349.8015},{"sc_id":"c27","x":294,"px_width":10,"chr":"15","gridCell_value":1.2256,"cumsum_values":2352.0271},{"sc_id":"c27","x":305,"px_width":12,"chr":"16","gridCell_value":2.1348,"cumsum_values":2356.1619},{"sc_id":"c27","x":318,"px_width":1,"chr":"17","gridCell_value":1.0006,"cumsum_values":2359.1626},{"sc_id":"c27","x":319,"px_width":1,"chr":"17","cumsum_values":2361.1626},{"sc_id":"c27","x":320,"px_width":8,"chr":"17","gridCell_value":1.1902,"cumsum_values":2363.3528},{"sc_id":"c27","x":329,"px_width":10,"chr":"18","gridCell_value":1.7159,"cumsum_values":2367.0687},{"sc_id":"c27","x":340,"px_width":2,"chr":"19","cumsum_values":2370.0687},{"sc_id":"c27","x":342,"px_width":4,"chr":"19","gridCell_value":2.3561,"cumsum_values":2373.4248},{"sc_id":"c27","x":346,"px_width":1,"chr":"19","cumsum_values":2375.4248},{"sc_id":"c27","x":347,"px_width":1,"chr":"19","gridCell_value":2.3196,"cumsum_values":2378.7444},{"sc_id":"c27","x":349,"px_width":8,"chr":"20","gridCell_value":2.2568,"cumsum_values":2383.0013},{"sc_id":"c27","x":358,"px_width":2,"chr":"21","cumsum_values":2386.0013},{"sc_id":"c27","x":360,"px_width":4,"chr":"21","gridCell_value":2.0809,"cumsum_values":2389.0822},{"sc_id":"c27","x":365,"px_width":2,"chr":"22","cumsum_values":2392.0822},{"sc_id":"c27","x":367,"px_width":5,"chr":"22","gridCell_value":1.2145,"cumsum_values":2394.2967},{"sc_id":"c27","x":373,"px_width":1,"chr":"X","cumsum_values":2397.2967},{"sc_id":"c27","x":374,"px_width":5,"chr":"X","gridCell_value":2.291,"cumsum_values":2400.5877},{"sc_id":"c27","x":379,"px_width":1,"chr":"X","cumsum_values":2402.5877},{"sc_id":"c27","x":380,"px_width":12,"chr":"X","gridCell_value":2.5352,"cumsum_values":2406.1229},{"sc_id":"c27","x":393,"px_width":1,"chr":"Y","cumsum_values":2409.1229},{"sc_id":"c27","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2518,"cumsum_values":2410.3747}],"c28":[{"sc_id":"c28","x":0,"px_width":1,"chr":"1","cumsum_values":2389.3747},{"sc_id":"c28","x":1,"px_width":28,"chr":"1","gridCell_value":2.4825,"cumsum_values":2392.8572},{"sc_id":"c28","x":30,"px_width":1,"chr":"2","gridCell_value":1.1639,"cumsum_values":2396.0212},{"sc_id":"c28","x":31,"px_width":1,"chr":"2","cumsum_values":2398.0212},{"sc_id":"c28","x":32,"px_width":3,"chr":"2","gridCell_value":1.2089,"cumsum_values":2400.2301},{"sc_id":"c28","x":35,"px_width":1,"chr":"2","gridCell_value":0.1714,"cumsum_values":2401.4014},{"sc_id":"c28","x":36,"px_width":5,"chr":"2","gridCell_value":2.5539,"cumsum_values":2404.9553},{"sc_id":"c28","x":41,"px_width":18,"chr":"2","gridCell_value":1.1865,"cumsum_values":2407.1418},{"sc_id":"c28","x":60,"px_width":10,"chr":"3","gridCell_value":1.2075,"cumsum_values":2410.3493},{"sc_id":"c28","x":70,"px_width":1,"chr":"3","cumsum_values":2412.3493},{"sc_id":"c28","x":71,"px_width":12,"chr":"3","gridCell_value":2.4255,"cumsum_values":2415.7748},{"sc_id":"c28","x":84,"px_width":2,"chr":"4","cumsum_values":2418.7748},{"sc_id":"c28","x":86,"px_width":21,"chr":"4","gridCell_value":1.2797,"cumsum_values":2421.0545},{"sc_id":"c28","x":108,"px_width":22,"chr":"5","gridCell_value":1.8282,"cumsum_values":2424.8827},{"sc_id":"c28","x":131,"px_width":3,"chr":"6","gridCell_value":2.3382,"cumsum_values":2429.2209},{"sc_id":"c28","x":134,"px_width":1,"chr":"6","gridCell_value":0.4084,"cumsum_values":2430.6293},{"sc_id":"c28","x":135,"px_width":1,"chr":"6","gridCell_value":1.964,"cumsum_values":2433.5933},{"sc_id":"c28","x":136,"px_width":1,"chr":"6","cumsum_values":2435.5933},{"sc_id":"c28","x":137,"px_width":1,"chr":"6","gridCell_value":2.4405,"cumsum_values":2439.0339},{"sc_id":"c28","x":138,"px_width":1,"chr":"6","cumsum_values":2441.0339},{"sc_id":"c28","x":139,"px_width":13,"chr":"6","gridCell_value":2.3974,"cumsum_values":2444.4313},{"sc_id":"c28","x":153,"px_width":19,"chr":"7","gridCell_value":2.3568,"cumsum_values":2448.7881},{"sc_id":"c28","x":173,"px_width":16,"chr":"8","gridCell_value":2.4326,"cumsum_values":2453.2207},{"sc_id":"c28","x":189,"px_width":2,"chr":"8","gridCell_value":1.1646,"cumsum_values":2455.3852},{"sc_id":"c28","x":192,"px_width":14,"chr":"9","gridCell_value":1.2471,"cumsum_values":2458.6324},{"sc_id":"c28","x":206,"px_width":1,"chr":"9","gridCell_value":0.7423,"cumsum_values":2460.3747},{"sc_id":"c28","x":207,"px_width":2,"chr":"9","gridCell_value":0.4457,"cumsum_values":2461.8204},{"sc_id":"c28","x":210,"px_width":16,"chr":"10","gridCell_value":1.2026,"cumsum_values":2465.0229},{"sc_id":"c28","x":227,"px_width":1,"chr":"11","gridCell_value":0.6329,"cumsum_values":2467.6558},{"sc_id":"c28","x":228,"px_width":5,"chr":"11","gridCell_value":2.2818,"cumsum_values":2470.9376},{"sc_id":"c28","x":233,"px_width":1,"chr":"11","gridCell_value":3.7033,"cumsum_values":2475.6409},{"sc_id":"c28","x":234,"px_width":1,"chr":"11","gridCell_value":2.268,"cumsum_values":2478.9089},{"sc_id":"c28","x":235,"px_width":1,"chr":"11","gridCell_value":1.5378,"cumsum_values":2481.4467},{"sc_id":"c28","x":236,"px_width":8,"chr":"11","gridCell_value":2.3658,"cumsum_values":2484.8125},{"sc_id":"c28","x":245,"px_width":16,"chr":"12","gridCell_value":1.2174,"cumsum_values":2488.0299},{"sc_id":"c28","x":262,"px_width":2,"chr":"13","cumsum_values":2491.0299},{"sc_id":"c28","x":264,"px_width":12,"chr":"13","gridCell_value":1.6879,"cumsum_values":2493.7177},{"sc_id":"c28","x":277,"px_width":3,"chr":"14","cumsum_values":2496.7177},{"sc_id":"c28","x":280,"px_width":9,"chr":"14","gridCell_value":2.3865,"cumsum_values":2500.1042},{"sc_id":"c28","x":289,"px_width":1,"chr":"14","cumsum_values":2502.1042},{"sc_id":"c28","x":291,"px_width":3,"chr":"15","cumsum_values":2503.1042},{"sc_id":"c28","x":294,"px_width":10,"chr":"15","gridCell_value":1.1995,"cumsum_values":2505.3037},{"sc_id":"c28","x":305,"px_width":1,"chr":"16","gridCell_value":1.1933,"cumsum_values":2508.497},{"sc_id":"c28","x":306,"px_width":9,"chr":"16","gridCell_value":2.1673,"cumsum_values":2511.6643},{"sc_id":"c28","x":315,"px_width":1,"chr":"16","cumsum_values":2513.6643},{"sc_id":"c28","x":316,"px_width":1,"chr":"16","gridCell_value":1.1392,"cumsum_values":2515.8034},{"sc_id":"c28","x":318,"px_width":10,"chr":"17","gridCell_value":1.061,"cumsum_values":2518.8644},{"sc_id":"c28","x":329,"px_width":10,"chr":"18","gridCell_value":1.7808,"cumsum_values":2522.6452},{"sc_id":"c28","x":340,"px_width":2,"chr":"19","cumsum_values":2525.6452},{"sc_id":"c28","x":342,"px_width":3,"chr":"19","gridCell_value":2.0006,"cumsum_values":2528.6458},{"sc_id":"c28","x":345,"px_width":1,"chr":"19","gridCell_value":1.1175,"cumsum_values":2530.7633},{"sc_id":"c28","x":346,"px_width":1,"chr":"19","cumsum_values":2532.7633},{"sc_id":"c28","x":347,"px_width":1,"chr":"19","gridCell_value":2.3287,"cumsum_values":2536.0919},{"sc_id":"c28","x":349,"px_width":6,"chr":"20","gridCell_value":2.2677,"cumsum_values":2540.3596},{"sc_id":"c28","x":355,"px_width":2,"chr":"20","gridCell_value":1.1609,"cumsum_values":2542.5204},{"sc_id":"c28","x":358,"px_width":2,"chr":"21","cumsum_values":2545.5204},{"sc_id":"c28","x":360,"px_width":4,"chr":"21","gridCell_value":2.4079,"cumsum_values":2548.9284},{"sc_id":"c28","x":365,"px_width":2,"chr":"22","cumsum_values":2551.9284},{"sc_id":"c28","x":367,"px_width":5,"chr":"22","gridCell_value":0.9554,"cumsum_values":2553.8838},{"sc_id":"c28","x":373,"px_width":1,"chr":"X","cumsum_values":2556.8838},{"sc_id":"c28","x":374,"px_width":18,"chr":"X","gridCell_value":2.682,"cumsum_values":2560.5658},{"sc_id":"c28","x":393,"px_width":1,"chr":"Y","cumsum_values":2563.5658},{"sc_id":"c28","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2227,"cumsum_values":2564.7885}],"c29":[{"sc_id":"c29","x":0,"px_width":29,"chr":"1","gridCell_value":2.4329,"cumsum_values":2545.2214},{"sc_id":"c29","x":30,"px_width":5,"chr":"2","gridCell_value":1.1431,"cumsum_values":2548.3646},{"sc_id":"c29","x":35,"px_width":1,"chr":"2","gridCell_value":0.1346,"cumsum_values":2549.4992},{"sc_id":"c29","x":36,"px_width":4,"chr":"2","gridCell_value":2.2481,"cumsum_values":2552.7473},{"sc_id":"c29","x":40,"px_width":1,"chr":"2","cumsum_values":2554.7473},{"sc_id":"c29","x":41,"px_width":8,"chr":"2","gridCell_value":1.1835,"cumsum_values":2556.9307},{"sc_id":"c29","x":49,"px_width":1,"chr":"2","cumsum_values":2558.9307},{"sc_id":"c29","x":50,"px_width":9,"chr":"2","gridCell_value":1.1348,"cumsum_values":2561.0655},{"sc_id":"c29","x":60,"px_width":10,"chr":"3","gridCell_value":1.1662,"cumsum_values":2564.2317},{"sc_id":"c29","x":70,"px_width":1,"chr":"3","cumsum_values":2566.2317},{"sc_id":"c29","x":71,"px_width":12,"chr":"3","gridCell_value":2.2744,"cumsum_values":2569.5061},{"sc_id":"c29","x":84,"px_width":4,"chr":"4","gridCell_value":1.3081,"cumsum_values":2572.8142},{"sc_id":"c29","x":88,"px_width":1,"chr":"4","cumsum_values":2574.8142},{"sc_id":"c29","x":89,"px_width":12,"chr":"4","gridCell_value":1.1617,"cumsum_values":2576.9759},{"sc_id":"c29","x":101,"px_width":1,"chr":"4","gridCell_value":0.5948,"cumsum_values":2578.5707},{"sc_id":"c29","x":102,"px_width":5,"chr":"4","gridCell_value":1.2561,"cumsum_values":2580.8267},{"sc_id":"c29","x":108,"px_width":22,"chr":"5","gridCell_value":1.7516,"cumsum_values":2584.5784},{"sc_id":"c29","x":131,"px_width":3,"chr":"6","gridCell_value":2.1282,"cumsum_values":2588.7065},{"sc_id":"c29","x":134,"px_width":1,"chr":"6","gridCell_value":0.3802,"cumsum_values":2590.0867},{"sc_id":"c29","x":135,"px_width":17,"chr":"6","gridCell_value":2.3656,"cumsum_values":2593.4523},{"sc_id":"c29","x":153,"px_width":19,"chr":"7","gridCell_value":2.2511,"cumsum_values":2597.7034},{"sc_id":"c29","x":173,"px_width":18,"chr":"8","gridCell_value":2.3107,"cumsum_values":2602.014},{"sc_id":"c29","x":192,"px_width":1,"chr":"9","cumsum_values":2605.014},{"sc_id":"c29","x":193,"px_width":16,"chr":"9","gridCell_value":1.2304,"cumsum_values":2607.2444},{"sc_id":"c29","x":210,"px_width":16,"chr":"10","gridCell_value":1.2551,"cumsum_values":2610.4995},{"sc_id":"c29","x":227,"px_width":1,"chr":"11","gridCell_value":0.7991,"cumsum_values":2613.2986},{"sc_id":"c29","x":228,"px_width":4,"chr":"11","gridCell_value":2.3743,"cumsum_values":2616.6729},{"sc_id":"c29","x":232,"px_width":1,"chr":"11","cumsum_values":2618.6729},{"sc_id":"c29","x":233,"px_width":1,"chr":"11","gridCell_value":4.3289,"cumsum_values":2624.0018},{"sc_id":"c29","x":234,"px_width":10,"chr":"11","gridCell_value":2.2193,"cumsum_values":2627.2211},{"sc_id":"c29","x":245,"px_width":13,"chr":"12","gridCell_value":1.1894,"cumsum_values":2630.4105},{"sc_id":"c29","x":258,"px_width":1,"chr":"12","cumsum_values":2632.4105},{"sc_id":"c29","x":259,"px_width":2,"chr":"12","gridCell_value":1.2199,"cumsum_values":2634.6304},{"sc_id":"c29","x":262,"px_width":2,"chr":"13","cumsum_values":2637.6304},{"sc_id":"c29","x":264,"px_width":12,"chr":"13","gridCell_value":1.6282,"cumsum_values":2640.2587},{"sc_id":"c29","x":277,"px_width":3,"chr":"14","cumsum_values":2643.2587},{"sc_id":"c29","x":280,"px_width":10,"chr":"14","gridCell_value":2.363,"cumsum_values":2646.6216},{"sc_id":"c29","x":291,"px_width":3,"chr":"15","cumsum_values":2649.6216},{"sc_id":"c29","x":294,"px_width":10,"chr":"15","gridCell_value":1.1843,"cumsum_values":2651.8059},{"sc_id":"c29","x":305,"px_width":1,"chr":"16","cumsum_values":2654.8059},{"sc_id":"c29","x":306,"px_width":11,"chr":"16","gridCell_value":2.0914,"cumsum_values":2657.8973},{"sc_id":"c29","x":318,"px_width":10,"chr":"17","gridCell_value":1.0668,"cumsum_values":2660.9641},{"sc_id":"c29","x":329,"px_width":10,"chr":"18","gridCell_value":1.7224,"cumsum_values":2664.6865},{"sc_id":"c29","x":340,"px_width":2,"chr":"19","cumsum_values":2667.6865},{"sc_id":"c29","x":342,"px_width":6,"chr":"19","gridCell_value":2.2222,"cumsum_values":2670.9087},{"sc_id":"c29","x":349,"px_width":6,"chr":"20","gridCell_value":2.3232,"cumsum_values":2675.2319},{"sc_id":"c29","x":355,"px_width":2,"chr":"20","gridCell_value":1.3669,"cumsum_values":2677.5988},{"sc_id":"c29","x":358,"px_width":2,"chr":"21","cumsum_values":2680.5988},{"sc_id":"c29","x":360,"px_width":4,"chr":"21","gridCell_value":2.209,"cumsum_values":2683.8078},{"sc_id":"c29","x":365,"px_width":2,"chr":"22","cumsum_values":2686.8078},{"sc_id":"c29","x":367,"px_width":5,"chr":"22","gridCell_value":1.0534,"cumsum_values":2688.8612},{"sc_id":"c29","x":373,"px_width":1,"chr":"X","gridCell_value":1.4196,"cumsum_values":2692.2808},{"sc_id":"c29","x":374,"px_width":18,"chr":"X","gridCell_value":2.6132,"cumsum_values":2695.894},{"sc_id":"c29","x":393,"px_width":1,"chr":"Y","cumsum_values":2698.894},{"sc_id":"c29","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2397,"cumsum_values":2700.1336}],"c3":[{"sc_id":"c3","x":0,"px_width":29,"chr":"1","gridCell_value":1.6784,"cumsum_values":2679.812},{"sc_id":"c3","x":30,"px_width":29,"chr":"2","gridCell_value":1.779,"cumsum_values":2683.5911},{"sc_id":"c3","x":60,"px_width":23,"chr":"3","gridCell_value":1.7399,"cumsum_values":2687.331},{"sc_id":"c3","x":84,"px_width":23,"chr":"4","gridCell_value":1.7692,"cumsum_values":2691.1002},{"sc_id":"c3","x":108,"px_width":19,"chr":"5","gridCell_value":1.8162,"cumsum_values":2694.9164},{"sc_id":"c3","x":127,"px_width":1,"chr":"5","cumsum_values":2696.9164},{"sc_id":"c3","x":128,"px_width":2,"chr":"5","gridCell_value":1.532,"cumsum_values":2699.4483},{"sc_id":"c3","x":131,"px_width":3,"chr":"6","gridCell_value":1.7776,"cumsum_values":2703.2259},{"sc_id":"c3","x":134,"px_width":1,"chr":"6","gridCell_value":0.467,"cumsum_values":2704.6929},{"sc_id":"c3","x":135,"px_width":17,"chr":"6","gridCell_value":1.7285,"cumsum_values":2707.4213},{"sc_id":"c3","x":153,"px_width":19,"chr":"7","gridCell_value":1.7436,"cumsum_values":2711.165},{"sc_id":"c3","x":173,"px_width":18,"chr":"8","gridCell_value":1.7538,"cumsum_values":2714.9188},{"sc_id":"c3","x":192,"px_width":17,"chr":"9","gridCell_value":1.6482,"cumsum_values":2718.567},{"sc_id":"c3","x":210,"px_width":16,"chr":"10","gridCell_value":1.6869,"cumsum_values":2722.2539},{"sc_id":"c3","x":227,"px_width":17,"chr":"11","gridCell_value":1.6668,"cumsum_values":2725.9208},{"sc_id":"c3","x":245,"px_width":16,"chr":"12","gridCell_value":1.6331,"cumsum_values":2729.5539},{"sc_id":"c3","x":262,"px_width":2,"chr":"13","cumsum_values":2732.5539},{"sc_id":"c3","x":264,"px_width":12,"chr":"13","gridCell_value":1.8657,"cumsum_values":2735.4195},{"sc_id":"c3","x":277,"px_width":3,"chr":"14","cumsum_values":2738.4195},{"sc_id":"c3","x":280,"px_width":10,"chr":"14","gridCell_value":1.7553,"cumsum_values":2741.1748},{"sc_id":"c3","x":291,"px_width":3,"chr":"15","cumsum_values":2744.1748},{"sc_id":"c3","x":294,"px_width":10,"chr":"15","gridCell_value":1.6106,"cumsum_values":2746.7854},{"sc_id":"c3","x":305,"px_width":1,"chr":"16","cumsum_values":2749.7854},{"sc_id":"c3","x":306,"px_width":11,"chr":"16","gridCell_value":1.7203,"cumsum_values":2752.5058},{"sc_id":"c3","x":318,"px_width":10,"chr":"17","gridCell_value":1.413,"cumsum_values":2755.9188},{"sc_id":"c3","x":329,"px_width":10,"chr":"18","gridCell_value":1.6742,"cumsum_values":2759.593},{"sc_id":"c3","x":340,"px_width":8,"chr":"19","gridCell_value":1.4305,"cumsum_values":2763.0235},{"sc_id":"c3","x":349,"px_width":8,"chr":"20","gridCell_value":1.5113,"cumsum_values":2766.5348},{"sc_id":"c3","x":358,"px_width":2,"chr":"21","cumsum_values":2769.5348},{"sc_id":"c3","x":360,"px_width":4,"chr":"21","gridCell_value":1.7513,"cumsum_values":2772.2861},{"sc_id":"c3","x":365,"px_width":2,"chr":"22","cumsum_values":2775.2861},{"sc_id":"c3","x":367,"px_width":2,"chr":"22","gridCell_value":1.707,"cumsum_values":2777.9931},{"sc_id":"c3","x":369,"px_width":1,"chr":"22","gridCell_value":0.5984,"cumsum_values":2779.5915},{"sc_id":"c3","x":370,"px_width":2,"chr":"22","gridCell_value":1.3562,"cumsum_values":2781.9477},{"sc_id":"c3","x":373,"px_width":19,"chr":"X","gridCell_value":2.034,"cumsum_values":2785.9817},{"sc_id":"c3","x":393,"px_width":1,"chr":"Y","cumsum_values":2788.9817},{"sc_id":"c3","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2242,"cumsum_values":2790.2059}],"c30":[{"sc_id":"c30","x":0,"px_width":29,"chr":"1","gridCell_value":2.4309,"cumsum_values":2770.6368},{"sc_id":"c30","x":30,"px_width":5,"chr":"2","gridCell_value":1.1509,"cumsum_values":2773.7877},{"sc_id":"c30","x":35,"px_width":1,"chr":"2","gridCell_value":0.2058,"cumsum_values":2774.9935},{"sc_id":"c30","x":36,"px_width":5,"chr":"2","gridCell_value":2.3658,"cumsum_values":2778.3592},{"sc_id":"c30","x":41,"px_width":18,"chr":"2","gridCell_value":1.1765,"cumsum_values":2780.5357},{"sc_id":"c30","x":60,"px_width":10,"chr":"3","gridCell_value":1.1331,"cumsum_values":2783.6688},{"sc_id":"c30","x":70,"px_width":1,"chr":"3","cumsum_values":2785.6688},{"sc_id":"c30","x":71,"px_width":12,"chr":"3","gridCell_value":2.2391,"cumsum_values":2788.9079},{"sc_id":"c30","x":84,"px_width":1,"chr":"4","gridCell_value":2.1856,"cumsum_values":2793.0935},{"sc_id":"c30","x":85,"px_width":22,"chr":"4","gridCell_value":1.1487,"cumsum_values":2795.2422},{"sc_id":"c30","x":108,"px_width":22,"chr":"5","gridCell_value":1.7305,"cumsum_values":2798.9727},{"sc_id":"c30","x":131,"px_width":3,"chr":"6","gridCell_value":2.0858,"cumsum_values":2803.0585},{"sc_id":"c30","x":134,"px_width":1,"chr":"6","gridCell_value":0.4661,"cumsum_values":2804.5245},{"sc_id":"c30","x":135,"px_width":17,"chr":"6","gridCell_value":2.1738,"cumsum_values":2807.6983},{"sc_id":"c30","x":153,"px_width":19,"chr":"7","gridCell_value":2.2578,"cumsum_values":2811.9561},{"sc_id":"c30","x":173,"px_width":18,"chr":"8","gridCell_value":2.2119,"cumsum_values":2816.168},{"sc_id":"c30","x":192,"px_width":15,"chr":"9","gridCell_value":1.1639,"cumsum_values":2819.3319},{"sc_id":"c30","x":207,"px_width":2,"chr":"9","gridCell_value":0.6607,"cumsum_values":2820.9926},{"sc_id":"c30","x":210,"px_width":7,"chr":"10","gridCell_value":1.2246,"cumsum_values":2824.2172},{"sc_id":"c30","x":217,"px_width":1,"chr":"10","gridCell_value":0.6471,"cumsum_values":2825.8643},{"sc_id":"c30","x":218,"px_width":8,"chr":"10","gridCell_value":1.2476,"cumsum_values":2828.1118},{"sc_id":"c30","x":227,"px_width":1,"chr":"11","gridCell_value":0.8728,"cumsum_values":2830.9847},{"sc_id":"c30","x":228,"px_width":16,"chr":"11","gridCell_value":2.2265,"cumsum_values":2834.2112},{"sc_id":"c30","x":245,"px_width":16,"chr":"12","gridCell_value":1.2323,"cumsum_values":2837.4436},{"sc_id":"c30","x":262,"px_width":2,"chr":"13","cumsum_values":2840.4436},{"sc_id":"c30","x":264,"px_width":9,"chr":"13","gridCell_value":1.4853,"cumsum_values":2842.9289},{"sc_id":"c30","x":273,"px_width":1,"chr":"13","cumsum_values":2844.9289},{"sc_id":"c30","x":274,"px_width":2,"chr":"13","gridCell_value":1.9491,"cumsum_values":2847.878},{"sc_id":"c30","x":277,"px_width":3,"chr":"14","cumsum_values":2850.878},{"sc_id":"c30","x":280,"px_width":10,"chr":"14","gridCell_value":2.2681,"cumsum_values":2854.1461},{"sc_id":"c30","x":291,"px_width":3,"chr":"15","cumsum_values":2857.1461},{"sc_id":"c30","x":294,"px_width":8,"chr":"15","gridCell_value":1.269,"cumsum_values":2859.4151},{"sc_id":"c30","x":302,"px_width":2,"chr":"15","gridCell_value":2.7897,"cumsum_values":2863.2048},{"sc_id":"c30","x":305,"px_width":12,"chr":"16","gridCell_value":2.2155,"cumsum_values":2867.4203},{"sc_id":"c30","x":318,"px_width":10,"chr":"17","gridCell_value":1.0949,"cumsum_values":2870.5152},{"sc_id":"c30","x":329,"px_width":10,"chr":"18","gridCell_value":1.7205,"cumsum_values":2874.2356},{"sc_id":"c30","x":340,"px_width":2,"chr":"19","cumsum_values":2877.2356},{"sc_id":"c30","x":342,"px_width":6,"chr":"19","gridCell_value":2.3275,"cumsum_values":2880.5632},{"sc_id":"c30","x":349,"px_width":8,"chr":"20","gridCell_value":2.1547,"cumsum_values":2884.7179},{"sc_id":"c30","x":358,"px_width":2,"chr":"21","cumsum_values":2887.7179},{"sc_id":"c30","x":360,"px_width":4,"chr":"21","gridCell_value":2.1432,"cumsum_values":2890.8611},{"sc_id":"c30","x":365,"px_width":2,"chr":"22","cumsum_values":2893.8611},{"sc_id":"c30","x":367,"px_width":5,"chr":"22","gridCell_value":1.224,"cumsum_values":2896.0851},{"sc_id":"c30","x":373,"px_width":1,"chr":"X","cumsum_values":2899.0851},{"sc_id":"c30","x":374,"px_width":18,"chr":"X","gridCell_value":2.4625,"cumsum_values":2902.5476},{"sc_id":"c30","x":393,"px_width":1,"chr":"Y","cumsum_values":2905.5476},{"sc_id":"c30","x":394,"px_width":2,"chr":"Y","gridCell_value":0.256,"cumsum_values":2906.8036}],"c31":[{"sc_id":"c31","x":0,"px_width":8,"chr":"1","gridCell_value":2.029,"cumsum_values":2886.8326},{"sc_id":"c31","x":8,"px_width":1,"chr":"1","cumsum_values":2888.8326},{"sc_id":"c31","x":9,"px_width":13,"chr":"1","gridCell_value":2.4647,"cumsum_values":2892.2973},{"sc_id":"c31","x":22,"px_width":1,"chr":"1","gridCell_value":0.9256,"cumsum_values":2894.2229},{"sc_id":"c31","x":23,"px_width":6,"chr":"1","gridCell_value":2.2324,"cumsum_values":2897.4553},{"sc_id":"c31","x":30,"px_width":2,"chr":"2","gridCell_value":0.9733,"cumsum_values":2900.4286},{"sc_id":"c31","x":32,"px_width":1,"chr":"2","cumsum_values":2902.4286},{"sc_id":"c31","x":33,"px_width":1,"chr":"2","gridCell_value":1.0077,"cumsum_values":2904.4363},{"sc_id":"c31","x":34,"px_width":1,"chr":"2","cumsum_values":2906.4363},{"sc_id":"c31","x":35,"px_width":1,"chr":"2","gridCell_value":0.29,"cumsum_values":2907.7263},{"sc_id":"c31","x":36,"px_width":10,"chr":"2","gridCell_value":1.6428,"cumsum_values":2910.3691},{"sc_id":"c31","x":46,"px_width":2,"chr":"2","cumsum_values":2912.3691},{"sc_id":"c31","x":48,"px_width":11,"chr":"2","gridCell_value":1.0171,"cumsum_values":2914.3862},{"sc_id":"c31","x":60,"px_width":1,"chr":"3","gridCell_value":1.0397,"cumsum_values":2917.4258},{"sc_id":"c31","x":61,"px_width":1,"chr":"3","cumsum_values":2919.4258},{"sc_id":"c31","x":62,"px_width":1,"chr":"3","gridCell_value":0.2162,"cumsum_values":2920.642},{"sc_id":"c31","x":63,"px_width":2,"chr":"3","gridCell_value":1.1446,"cumsum_values":2922.7866},{"sc_id":"c31","x":65,"px_width":2,"chr":"3","cumsum_values":2924.7866},{"sc_id":"c31","x":67,"px_width":2,"chr":"3","gridCell_value":1.3553,"cumsum_values":2927.1419},{"sc_id":"c31","x":69,"px_width":1,"chr":"3","cumsum_values":2929.1419},{"sc_id":"c31","x":70,"px_width":6,"chr":"3","gridCell_value":1.5548,"cumsum_values":2931.6967},{"sc_id":"c31","x":76,"px_width":1,"chr":"3","cumsum_values":2933.6967},{"sc_id":"c31","x":77,"px_width":6,"chr":"3","gridCell_value":1.6585,"cumsum_values":2936.3552},{"sc_id":"c31","x":84,"px_width":1,"chr":"4","gridCell_value":2.2276,"cumsum_values":2940.5828},{"sc_id":"c31","x":85,"px_width":3,"chr":"4","gridCell_value":1.0424,"cumsum_values":2942.6252},{"sc_id":"c31","x":88,"px_width":1,"chr":"4","cumsum_values":2944.6252},{"sc_id":"c31","x":89,"px_width":18,"chr":"4","gridCell_value":1.1389,"cumsum_values":2946.7641},{"sc_id":"c31","x":108,"px_width":8,"chr":"5","gridCell_value":2.1215,"cumsum_values":2950.8856},{"sc_id":"c31","x":116,"px_width":1,"chr":"5","gridCell_value":0.7171,"cumsum_values":2952.6027},{"sc_id":"c31","x":117,"px_width":13,"chr":"5","gridCell_value":2.1318,"cumsum_values":2955.7345},{"sc_id":"c31","x":131,"px_width":3,"chr":"6","gridCell_value":2.1013,"cumsum_values":2959.8358},{"sc_id":"c31","x":134,"px_width":1,"chr":"6","gridCell_value":0.4589,"cumsum_values":2961.2947},{"sc_id":"c31","x":135,"px_width":6,"chr":"6","gridCell_value":2.2447,"cumsum_values":2964.5393},{"sc_id":"c31","x":141,"px_width":1,"chr":"6","gridCell_value":0.8666,"cumsum_values":2966.406},{"sc_id":"c31","x":142,"px_width":10,"chr":"6","gridCell_value":1.879,"cumsum_values":2969.285},{"sc_id":"c31","x":153,"px_width":19,"chr":"7","gridCell_value":2.0517,"cumsum_values":2973.3367},{"sc_id":"c31","x":173,"px_width":18,"chr":"8","gridCell_value":2.0913,"cumsum_values":2977.428},{"sc_id":"c31","x":192,"px_width":17,"chr":"9","gridCell_value":2.1186,"cumsum_values":2981.5466},{"sc_id":"c31","x":210,"px_width":16,"chr":"10","gridCell_value":1.0771,"cumsum_values":2984.6237},{"sc_id":"c31","x":227,"px_width":1,"chr":"11","gridCell_value":0.1308,"cumsum_values":2986.7545},{"sc_id":"c31","x":228,"px_width":1,"chr":"11","gridCell_value":2.2009,"cumsum_values":2989.9554},{"sc_id":"c31","x":229,"px_width":1,"chr":"11","gridCell_value":0.806,"cumsum_values":2991.7615},{"sc_id":"c31","x":230,"px_width":14,"chr":"11","gridCell_value":1.9187,"cumsum_values":2994.6801},{"sc_id":"c31","x":245,"px_width":16,"chr":"12","gridCell_value":1.1254,"cumsum_values":2997.8056},{"sc_id":"c31","x":262,"px_width":2,"chr":"13","cumsum_values":3000.8056},{"sc_id":"c31","x":264,"px_width":12,"chr":"13","gridCell_value":1.614,"cumsum_values":3003.4195},{"sc_id":"c31","x":277,"px_width":3,"chr":"14","cumsum_values":3006.4195},{"sc_id":"c31","x":280,"px_width":10,"chr":"14","gridCell_value":1.9704,"cumsum_values":3009.3899},{"sc_id":"c31","x":291,"px_width":3,"chr":"15","cumsum_values":3012.3899},{"sc_id":"c31","x":294,"px_width":10,"chr":"15","gridCell_value":2.0881,"cumsum_values":3015.4781},{"sc_id":"c31","x":305,"px_width":12,"chr":"16","gridCell_value":1.9825,"cumsum_values":3019.4605},{"sc_id":"c31","x":318,"px_width":10,"chr":"17","gridCell_value":1.0008,"cumsum_values":3022.4614},{"sc_id":"c31","x":329,"px_width":1,"chr":"18","gridCell_value":2.1522,"cumsum_values":3026.6135},{"sc_id":"c31","x":330,"px_width":1,"chr":"18","cumsum_values":3028.6135},{"sc_id":"c31","x":331,"px_width":1,"chr":"18","gridCell_value":2.2571,"cumsum_values":3031.8707},{"sc_id":"c31","x":332,"px_width":1,"chr":"18","cumsum_values":3033.8707},{"sc_id":"c31","x":333,"px_width":1,"chr":"18","gridCell_value":2.1083,"cumsum_values":3036.979},{"sc_id":"c31","x":334,"px_width":2,"chr":"18","cumsum_values":3038.979},{"sc_id":"c31","x":336,"px_width":3,"chr":"18","gridCell_value":2.0794,"cumsum_values":3042.0585},{"sc_id":"c31","x":340,"px_width":2,"chr":"19","cumsum_values":3045.0585},{"sc_id":"c31","x":342,"px_width":6,"chr":"19","gridCell_value":2.3012,"cumsum_values":3048.3597},{"sc_id":"c31","x":349,"px_width":8,"chr":"20","gridCell_value":1.9249,"cumsum_values":3052.2846},{"sc_id":"c31","x":358,"px_width":2,"chr":"21","cumsum_values":3055.2846},{"sc_id":"c31","x":360,"px_width":4,"chr":"21","gridCell_value":2.1271,"cumsum_values":3058.4117},{"sc_id":"c31","x":365,"px_width":2,"chr":"22","cumsum_values":3061.4117},{"sc_id":"c31","x":367,"px_width":5,"chr":"22","gridCell_value":1.1244,"cumsum_values":3063.5362},{"sc_id":"c31","x":373,"px_width":3,"chr":"X","gridCell_value":1.9829,"cumsum_values":3067.519},{"sc_id":"c31","x":376,"px_width":1,"chr":"X","cumsum_values":3069.519},{"sc_id":"c31","x":377,"px_width":15,"chr":"X","gridCell_value":2.3535,"cumsum_values":3072.8725},{"sc_id":"c31","x":393,"px_width":1,"chr":"Y","cumsum_values":3075.8725},{"sc_id":"c31","x":394,"px_width":2,"chr":"Y","gridCell_value":0.259,"cumsum_values":3077.1316}],"c32":[{"sc_id":"c32","x":0,"px_width":1,"chr":"1","cumsum_values":3056.1316},{"sc_id":"c32","x":1,"px_width":18,"chr":"1","gridCell_value":2.4296,"cumsum_values":3059.5611},{"sc_id":"c32","x":19,"px_width":1,"chr":"1","cumsum_values":3061.5611},{"sc_id":"c32","x":20,"px_width":9,"chr":"1","gridCell_value":2.3177,"cumsum_values":3064.8788},{"sc_id":"c32","x":30,"px_width":5,"chr":"2","gridCell_value":0.999,"cumsum_values":3067.8779},{"sc_id":"c32","x":35,"px_width":1,"chr":"2","gridCell_value":0.1464,"cumsum_values":3069.0242},{"sc_id":"c32","x":36,"px_width":5,"chr":"2","gridCell_value":2.1154,"cumsum_values":3072.1396},{"sc_id":"c32","x":41,"px_width":1,"chr":"2","gridCell_value":1.0545,"cumsum_values":3074.194},{"sc_id":"c32","x":42,"px_width":1,"chr":"2","cumsum_values":3076.194},{"sc_id":"c32","x":43,"px_width":4,"chr":"2","gridCell_value":0.9515,"cumsum_values":3078.1455},{"sc_id":"c32","x":47,"px_width":1,"chr":"2","cumsum_values":3080.1455},{"sc_id":"c32","x":48,"px_width":11,"chr":"2","gridCell_value":1.0381,"cumsum_values":3082.1836},{"sc_id":"c32","x":60,"px_width":1,"chr":"3","gridCell_value":1.1028,"cumsum_values":3085.2864},{"sc_id":"c32","x":61,"px_width":1,"chr":"3","cumsum_values":3087.2864},{"sc_id":"c32","x":62,"px_width":9,"chr":"3","gridCell_value":1.0954,"cumsum_values":3089.3817},{"sc_id":"c32","x":71,"px_width":12,"chr":"3","gridCell_value":2.1706,"cumsum_values":3092.5523},{"sc_id":"c32","x":84,"px_width":1,"chr":"4","gridCell_value":2.252,"cumsum_values":3096.8043},{"sc_id":"c32","x":85,"px_width":1,"chr":"4","cumsum_values":3098.8043},{"sc_id":"c32","x":86,"px_width":4,"chr":"4","gridCell_value":2.5236,"cumsum_values":3102.328},{"sc_id":"c32","x":90,"px_width":17,"chr":"4","gridCell_value":1.0586,"cumsum_values":3104.3865},{"sc_id":"c32","x":108,"px_width":22,"chr":"5","gridCell_value":2.0457,"cumsum_values":3108.4322},{"sc_id":"c32","x":131,"px_width":3,"chr":"6","gridCell_value":2.2708,"cumsum_values":3112.703},{"sc_id":"c32","x":134,"px_width":1,"chr":"6","gridCell_value":0.3887,"cumsum_values":3114.0917},{"sc_id":"c32","x":135,"px_width":17,"chr":"6","gridCell_value":1.9827,"cumsum_values":3117.0745},{"sc_id":"c32","x":153,"px_width":4,"chr":"7","gridCell_value":2.2087,"cumsum_values":3121.2832},{"sc_id":"c32","x":157,"px_width":1,"chr":"7","cumsum_values":3123.2832},{"sc_id":"c32","x":158,"px_width":14,"chr":"7","gridCell_value":1.9559,"cumsum_values":3126.239},{"sc_id":"c32","x":173,"px_width":18,"chr":"8","gridCell_value":2.0247,"cumsum_values":3130.2637},{"sc_id":"c32","x":192,"px_width":15,"chr":"9","gridCell_value":2.1768,"cumsum_values":3134.4405},{"sc_id":"c32","x":207,"px_width":2,"chr":"9","gridCell_value":1.0591,"cumsum_values":3136.4996},{"sc_id":"c32","x":210,"px_width":8,"chr":"10","gridCell_value":1.1326,"cumsum_values":3139.6322},{"sc_id":"c32","x":218,"px_width":1,"chr":"10","cumsum_values":3141.6322},{"sc_id":"c32","x":219,"px_width":1,"chr":"10","gridCell_value":1.1556,"cumsum_values":3143.7878},{"sc_id":"c32","x":220,"px_width":1,"chr":"10","cumsum_values":3145.7878},{"sc_id":"c32","x":221,"px_width":5,"chr":"10","gridCell_value":1.0911,"cumsum_values":3147.8789},{"sc_id":"c32","x":227,"px_width":1,"chr":"11","gridCell_value":0.5701,"cumsum_values":3150.449},{"sc_id":"c32","x":228,"px_width":16,"chr":"11","gridCell_value":1.9961,"cumsum_values":3153.4451},{"sc_id":"c32","x":245,"px_width":5,"chr":"12","gridCell_value":1.0216,"cumsum_values":3156.4668},{"sc_id":"c32","x":250,"px_width":1,"chr":"12","cumsum_values":3158.4668},{"sc_id":"c32","x":251,"px_width":6,"chr":"12","gridCell_value":1.0061,"cumsum_values":3160.4729},{"sc_id":"c32","x":257,"px_width":1,"chr":"12","cumsum_values":3162.4729},{"sc_id":"c32","x":258,"px_width":3,"chr":"12","gridCell_value":0.9789,"cumsum_values":3164.4518},{"sc_id":"c32","x":262,"px_width":2,"chr":"13","cumsum_values":3167.4518},{"sc_id":"c32","x":264,"px_width":3,"chr":"13","gridCell_value":0.9723,"cumsum_values":3169.4241},{"sc_id":"c32","x":267,"px_width":2,"chr":"13","cumsum_values":3171.4241},{"sc_id":"c32","x":269,"px_width":7,"chr":"13","gridCell_value":1.8094,"cumsum_values":3174.2335},{"sc_id":"c32","x":277,"px_width":3,"chr":"14","cumsum_values":3177.2335},{"sc_id":"c32","x":280,"px_width":10,"chr":"14","gridCell_value":2.1293,"cumsum_values":3180.3629},{"sc_id":"c32","x":291,"px_width":3,"chr":"15","cumsum_values":3183.3629},{"sc_id":"c32","x":294,"px_width":10,"chr":"15","gridCell_value":2.2459,"cumsum_values":3186.6088},{"sc_id":"c32","x":305,"px_width":12,"chr":"16","gridCell_value":1.9949,"cumsum_values":3190.6036},{"sc_id":"c32","x":318,"px_width":10,"chr":"17","gridCell_value":1.0902,"cumsum_values":3193.6939},{"sc_id":"c32","x":329,"px_width":10,"chr":"18","gridCell_value":1.9971,"cumsum_values":3197.6909},{"sc_id":"c32","x":340,"px_width":2,"chr":"19","cumsum_values":3200.6909},{"sc_id":"c32","x":342,"px_width":6,"chr":"19","gridCell_value":1.7922,"cumsum_values":3203.4831},{"sc_id":"c32","x":349,"px_width":6,"chr":"20","gridCell_value":2.4254,"cumsum_values":3207.9085},{"sc_id":"c32","x":355,"px_width":2,"chr":"20","gridCell_value":1.2612,"cumsum_values":3210.1697},{"sc_id":"c32","x":358,"px_width":2,"chr":"21","cumsum_values":3213.1697},{"sc_id":"c32","x":360,"px_width":4,"chr":"21","gridCell_value":2.0767,"cumsum_values":3216.2464},{"sc_id":"c32","x":365,"px_width":2,"chr":"22","cumsum_values":3219.2464},{"sc_id":"c32","x":367,"px_width":5,"chr":"22","gridCell_value":1.0899,"cumsum_values":3221.3363},{"sc_id":"c32","x":373,"px_width":1,"chr":"X","cumsum_values":3224.3363},{"sc_id":"c32","x":374,"px_width":18,"chr":"X","gridCell_value":2.1842,"cumsum_values":3227.5205},{"sc_id":"c32","x":393,"px_width":1,"chr":"Y","cumsum_values":3230.5205},{"sc_id":"c32","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2206,"cumsum_values":3231.7411}],"c33":[{"sc_id":"c33","x":0,"px_width":29,"chr":"1","gridCell_value":2.1341,"cumsum_values":3211.8751},{"sc_id":"c33","x":30,"px_width":5,"chr":"2","gridCell_value":0.963,"cumsum_values":3214.8381},{"sc_id":"c33","x":35,"px_width":1,"chr":"2","gridCell_value":0.2487,"cumsum_values":3216.0868},{"sc_id":"c33","x":36,"px_width":4,"chr":"2","gridCell_value":2.2398,"cumsum_values":3219.3267},{"sc_id":"c33","x":40,"px_width":1,"chr":"2","cumsum_values":3221.3267},{"sc_id":"c33","x":41,"px_width":18,"chr":"2","gridCell_value":1.132,"cumsum_values":3223.4587},{"sc_id":"c33","x":60,"px_width":1,"chr":"3","gridCell_value":1.1795,"cumsum_values":3226.6382},{"sc_id":"c33","x":61,"px_width":1,"chr":"3","gridCell_value":0.5302,"cumsum_values":3228.1684},{"sc_id":"c33","x":62,"px_width":8,"chr":"3","gridCell_value":1.1986,"cumsum_values":3230.367},{"sc_id":"c33","x":70,"px_width":13,"chr":"3","gridCell_value":2.2221,"cumsum_values":3233.589},{"sc_id":"c33","x":84,"px_width":1,"chr":"4","cumsum_values":3236.589},{"sc_id":"c33","x":85,"px_width":22,"chr":"4","gridCell_value":1.1625,"cumsum_values":3238.7515},{"sc_id":"c33","x":108,"px_width":22,"chr":"5","gridCell_value":2.1678,"cumsum_values":3242.9193},{"sc_id":"c33","x":131,"px_width":3,"chr":"6","gridCell_value":2.0559,"cumsum_values":3246.9752},{"sc_id":"c33","x":134,"px_width":1,"chr":"6","gridCell_value":0.4377,"cumsum_values":3248.4129},{"sc_id":"c33","x":135,"px_width":17,"chr":"6","gridCell_value":2.2386,"cumsum_values":3251.6515},{"sc_id":"c33","x":153,"px_width":19,"chr":"7","gridCell_value":2.1474,"cumsum_values":3255.7989},{"sc_id":"c33","x":173,"px_width":16,"chr":"8","gridCell_value":2.1806,"cumsum_values":3259.9795},{"sc_id":"c33","x":189,"px_width":2,"chr":"8","gridCell_value":1.1418,"cumsum_values":3262.1212},{"sc_id":"c33","x":192,"px_width":15,"chr":"9","gridCell_value":2.1635,"cumsum_values":3266.2848},{"sc_id":"c33","x":207,"px_width":2,"chr":"9","gridCell_value":0.8579,"cumsum_values":3268.1427},{"sc_id":"c33","x":210,"px_width":16,"chr":"10","gridCell_value":1.0658,"cumsum_values":3271.2085},{"sc_id":"c33","x":227,"px_width":1,"chr":"11","gridCell_value":0.5015,"cumsum_values":3273.71},{"sc_id":"c33","x":228,"px_width":16,"chr":"11","gridCell_value":2.0735,"cumsum_values":3276.7835},{"sc_id":"c33","x":245,"px_width":16,"chr":"12","gridCell_value":1.116,"cumsum_values":3279.8996},{"sc_id":"c33","x":262,"px_width":2,"chr":"13","cumsum_values":3282.8996},{"sc_id":"c33","x":264,"px_width":4,"chr":"13","gridCell_value":1.1395,"cumsum_values":3285.0391},{"sc_id":"c33","x":268,"px_width":7,"chr":"13","gridCell_value":2.2845,"cumsum_values":3288.3236},{"sc_id":"c33","x":275,"px_width":1,"chr":"13","cumsum_values":3290.3236},{"sc_id":"c33","x":277,"px_width":3,"chr":"14","cumsum_values":3291.3236},{"sc_id":"c33","x":280,"px_width":6,"chr":"14","gridCell_value":2.1807,"cumsum_values":3294.5043},{"sc_id":"c33","x":286,"px_width":1,"chr":"14","cumsum_values":3296.5043},{"sc_id":"c33","x":287,"px_width":3,"chr":"14","gridCell_value":1.8095,"cumsum_values":3299.3139},{"sc_id":"c33","x":291,"px_width":3,"chr":"15","cumsum_values":3302.3139},{"sc_id":"c33","x":294,"px_width":10,"chr":"15","gridCell_value":2.0949,"cumsum_values":3305.4088},{"sc_id":"c33","x":305,"px_width":1,"chr":"16","cumsum_values":3308.4088},{"sc_id":"c33","x":306,"px_width":11,"chr":"16","gridCell_value":1.8397,"cumsum_values":3311.2485},{"sc_id":"c33","x":318,"px_width":1,"chr":"17","gridCell_value":1.0285,"cumsum_values":3314.277},{"sc_id":"c33","x":319,"px_width":1,"chr":"17","gridCell_value":0.6008,"cumsum_values":3315.8778},{"sc_id":"c33","x":320,"px_width":8,"chr":"17","gridCell_value":0.9498,"cumsum_values":3317.8276},{"sc_id":"c33","x":329,"px_width":10,"chr":"18","gridCell_value":2.099,"cumsum_values":3321.9266},{"sc_id":"c33","x":340,"px_width":2,"chr":"19","cumsum_values":3324.9266},{"sc_id":"c33","x":342,"px_width":6,"chr":"19","gridCell_value":1.7687,"cumsum_values":3327.6953},{"sc_id":"c33","x":349,"px_width":6,"chr":"20","gridCell_value":1.8982,"cumsum_values":3331.5935},{"sc_id":"c33","x":355,"px_width":2,"chr":"20","gridCell_value":0.8211,"cumsum_values":3333.4146},{"sc_id":"c33","x":358,"px_width":2,"chr":"21","cumsum_values":3336.4146},{"sc_id":"c33","x":360,"px_width":4,"chr":"21","gridCell_value":1.9436,"cumsum_values":3339.3581},{"sc_id":"c33","x":365,"px_width":2,"chr":"22","cumsum_values":3342.3581},{"sc_id":"c33","x":367,"px_width":5,"chr":"22","gridCell_value":0.8064,"cumsum_values":3344.1645},{"sc_id":"c33","x":373,"px_width":1,"chr":"X","cumsum_values":3347.1645},{"sc_id":"c33","x":374,"px_width":18,"chr":"X","gridCell_value":2.5184,"cumsum_values":3350.6829},{"sc_id":"c33","x":393,"px_width":1,"chr":"Y","cumsum_values":3353.6829},{"sc_id":"c33","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2967,"cumsum_values":3354.9796}],"c34":[{"sc_id":"c34","x":0,"px_width":5,"chr":"1","gridCell_value":2.0433,"cumsum_values":3335.0229},{"sc_id":"c34","x":5,"px_width":1,"chr":"1","cumsum_values":3337.0229},{"sc_id":"c34","x":6,"px_width":11,"chr":"1","gridCell_value":2.2531,"cumsum_values":3340.276},{"sc_id":"c34","x":17,"px_width":1,"chr":"1","cumsum_values":3342.276},{"sc_id":"c34","x":18,"px_width":11,"chr":"1","gridCell_value":2.4441,"cumsum_values":3345.7201},{"sc_id":"c34","x":30,"px_width":4,"chr":"2","gridCell_value":1.0888,"cumsum_values":3348.8089},{"sc_id":"c34","x":34,"px_width":1,"chr":"2","cumsum_values":3350.8089},{"sc_id":"c34","x":35,"px_width":1,"chr":"2","gridCell_value":0.2125,"cumsum_values":3352.0213},{"sc_id":"c34","x":36,"px_width":5,"chr":"2","gridCell_value":2.2487,"cumsum_values":3355.27},{"sc_id":"c34","x":41,"px_width":4,"chr":"2","gridCell_value":1.078,"cumsum_values":3357.348},{"sc_id":"c34","x":45,"px_width":1,"chr":"2","cumsum_values":3359.348},{"sc_id":"c34","x":46,"px_width":13,"chr":"2","gridCell_value":1.0232,"cumsum_values":3361.3712},{"sc_id":"c34","x":60,"px_width":10,"chr":"3","gridCell_value":1.1683,"cumsum_values":3364.5395},{"sc_id":"c34","x":70,"px_width":13,"chr":"3","gridCell_value":2.2561,"cumsum_values":3367.7955},{"sc_id":"c34","x":84,"px_width":23,"chr":"4","gridCell_value":1.1123,"cumsum_values":3370.9078},{"sc_id":"c34","x":108,"px_width":22,"chr":"5","gridCell_value":2.092,"cumsum_values":3374.9998},{"sc_id":"c34","x":131,"px_width":3,"chr":"6","gridCell_value":2.1032,"cumsum_values":3379.103},{"sc_id":"c34","x":134,"px_width":1,"chr":"6","gridCell_value":0.4669,"cumsum_values":3380.5699},{"sc_id":"c34","x":135,"px_width":8,"chr":"6","gridCell_value":2.242,"cumsum_values":3383.812},{"sc_id":"c34","x":143,"px_width":1,"chr":"6","cumsum_values":3385.812},{"sc_id":"c34","x":144,"px_width":8,"chr":"6","gridCell_value":2.117,"cumsum_values":3388.9289},{"sc_id":"c34","x":153,"px_width":19,"chr":"7","gridCell_value":2.0935,"cumsum_values":3393.0224},{"sc_id":"c34","x":173,"px_width":16,"chr":"8","gridCell_value":2.1211,"cumsum_values":3397.1435},{"sc_id":"c34","x":189,"px_width":2,"chr":"8","gridCell_value":1.2561,"cumsum_values":3399.3996},{"sc_id":"c34","x":192,"px_width":17,"chr":"9","gridCell_value":2.0385,"cumsum_values":3403.4381},{"sc_id":"c34","x":210,"px_width":16,"chr":"10","gridCell_value":1.0774,"cumsum_values":3406.5155},{"sc_id":"c34","x":227,"px_width":1,"chr":"11","gridCell_value":0.5689,"cumsum_values":3409.0844},{"sc_id":"c34","x":228,"px_width":1,"chr":"11","gridCell_value":2.0146,"cumsum_values":3412.099},{"sc_id":"c34","x":229,"px_width":1,"chr":"11","cumsum_values":3414.099},{"sc_id":"c34","x":230,"px_width":11,"chr":"11","gridCell_value":2.0568,"cumsum_values":3417.1558},{"sc_id":"c34","x":241,"px_width":1,"chr":"11","cumsum_values":3419.1558},{"sc_id":"c34","x":242,"px_width":2,"chr":"11","gridCell_value":1.9903,"cumsum_values":3422.1461},{"sc_id":"c34","x":245,"px_width":16,"chr":"12","gridCell_value":1.1157,"cumsum_values":3425.2618},{"sc_id":"c34","x":262,"px_width":2,"chr":"13","cumsum_values":3428.2618},{"sc_id":"c34","x":264,"px_width":1,"chr":"13","gridCell_value":0.9276,"cumsum_values":3430.1895},{"sc_id":"c34","x":265,"px_width":1,"chr":"13","cumsum_values":3432.1895},{"sc_id":"c34","x":266,"px_width":2,"chr":"13","gridCell_value":1.0882,"cumsum_values":3434.2776},{"sc_id":"c34","x":268,"px_width":8,"chr":"13","gridCell_value":1.9506,"cumsum_values":3437.2282},{"sc_id":"c34","x":277,"px_width":3,"chr":"14","cumsum_values":3440.2282},{"sc_id":"c34","x":280,"px_width":10,"chr":"14","gridCell_value":2.1765,"cumsum_values":3443.4047},{"sc_id":"c34","x":291,"px_width":3,"chr":"15","cumsum_values":3446.4047},{"sc_id":"c34","x":294,"px_width":8,"chr":"15","gridCell_value":2.2196,"cumsum_values":3449.6243},{"sc_id":"c34","x":302,"px_width":1,"chr":"15","cumsum_values":3451.6243},{"sc_id":"c34","x":303,"px_width":1,"chr":"15","gridCell_value":2.0006,"cumsum_values":3454.6248},{"sc_id":"c34","x":305,"px_width":12,"chr":"16","gridCell_value":1.9671,"cumsum_values":3458.592},{"sc_id":"c34","x":318,"px_width":2,"chr":"17","gridCell_value":1.019,"cumsum_values":3461.611},{"sc_id":"c34","x":320,"px_width":1,"chr":"17","cumsum_values":3463.611},{"sc_id":"c34","x":321,"px_width":7,"chr":"17","gridCell_value":1.1142,"cumsum_values":3465.7252},{"sc_id":"c34","x":329,"px_width":3,"chr":"18","gridCell_value":1.9655,"cumsum_values":3469.6907},{"sc_id":"c34","x":332,"px_width":1,"chr":"18","cumsum_values":3471.6907},{"sc_id":"c34","x":333,"px_width":6,"chr":"18","gridCell_value":2.1164,"cumsum_values":3474.8071},{"sc_id":"c34","x":340,"px_width":2,"chr":"19","cumsum_values":3477.8071},{"sc_id":"c34","x":342,"px_width":6,"chr":"19","gridCell_value":2.1361,"cumsum_values":3480.9432},{"sc_id":"c34","x":349,"px_width":8,"chr":"20","gridCell_value":2.0733,"cumsum_values":3485.0165},{"sc_id":"c34","x":358,"px_width":2,"chr":"21","cumsum_values":3488.0165},{"sc_id":"c34","x":360,"px_width":4,"chr":"21","gridCell_value":1.9173,"cumsum_values":3490.9338},{"sc_id":"c34","x":365,"px_width":2,"chr":"22","cumsum_values":3493.9338},{"sc_id":"c34","x":367,"px_width":5,"chr":"22","gridCell_value":1.079,"cumsum_values":3496.0128},{"sc_id":"c34","x":373,"px_width":19,"chr":"X","gridCell_value":2.2858,"cumsum_values":3500.2986},{"sc_id":"c34","x":393,"px_width":1,"chr":"Y","cumsum_values":3503.2986},{"sc_id":"c34","x":394,"px_width":2,"chr":"Y","gridCell_value":0.273,"cumsum_values":3504.5716}],"c35":[{"sc_id":"c35","x":0,"px_width":29,"chr":"1","gridCell_value":2.2952,"cumsum_values":3484.8667},{"sc_id":"c35","x":30,"px_width":5,"chr":"2","gridCell_value":1.1351,"cumsum_values":3488.0018},{"sc_id":"c35","x":35,"px_width":1,"chr":"2","gridCell_value":0.1683,"cumsum_values":3489.1701},{"sc_id":"c35","x":36,"px_width":4,"chr":"2","gridCell_value":2.0838,"cumsum_values":3492.2539},{"sc_id":"c35","x":40,"px_width":1,"chr":"2","cumsum_values":3494.2539},{"sc_id":"c35","x":41,"px_width":18,"chr":"2","gridCell_value":1.1089,"cumsum_values":3496.3628},{"sc_id":"c35","x":60,"px_width":10,"chr":"3","gridCell_value":1.1581,"cumsum_values":3499.5209},{"sc_id":"c35","x":70,"px_width":13,"chr":"3","gridCell_value":2.1833,"cumsum_values":3502.7042},{"sc_id":"c35","x":84,"px_width":1,"chr":"4","cumsum_values":3505.7042},{"sc_id":"c35","x":85,"px_width":22,"chr":"4","gridCell_value":1.1301,"cumsum_values":3507.8343},{"sc_id":"c35","x":108,"px_width":22,"chr":"5","gridCell_value":2.1549,"cumsum_values":3511.9891},{"sc_id":"c35","x":131,"px_width":3,"chr":"6","gridCell_value":2.1824,"cumsum_values":3516.1715},{"sc_id":"c35","x":134,"px_width":1,"chr":"6","gridCell_value":0.4743,"cumsum_values":3517.6458},{"sc_id":"c35","x":135,"px_width":17,"chr":"6","gridCell_value":2.1493,"cumsum_values":3520.7951},{"sc_id":"c35","x":153,"px_width":19,"chr":"7","gridCell_value":2.1369,"cumsum_values":3524.932},{"sc_id":"c35","x":173,"px_width":18,"chr":"8","gridCell_value":2.1435,"cumsum_values":3529.0755},{"sc_id":"c35","x":192,"px_width":17,"chr":"9","gridCell_value":2.1201,"cumsum_values":3533.1956},{"sc_id":"c35","x":210,"px_width":16,"chr":"10","gridCell_value":1.1188,"cumsum_values":3536.3144},{"sc_id":"c35","x":227,"px_width":1,"chr":"11","gridCell_value":0.7369,"cumsum_values":3539.0513},{"sc_id":"c35","x":228,"px_width":16,"chr":"11","gridCell_value":2.1198,"cumsum_values":3542.171},{"sc_id":"c35","x":245,"px_width":16,"chr":"12","gridCell_value":1.1438,"cumsum_values":3545.3148},{"sc_id":"c35","x":262,"px_width":2,"chr":"13","cumsum_values":3548.3148},{"sc_id":"c35","x":264,"px_width":4,"chr":"13","gridCell_value":1.2026,"cumsum_values":3550.5174},{"sc_id":"c35","x":268,"px_width":8,"chr":"13","gridCell_value":1.986,"cumsum_values":3553.5034},{"sc_id":"c35","x":277,"px_width":3,"chr":"14","cumsum_values":3556.5034},{"sc_id":"c35","x":280,"px_width":10,"chr":"14","gridCell_value":2.1401,"cumsum_values":3559.6435},{"sc_id":"c35","x":291,"px_width":3,"chr":"15","cumsum_values":3562.6435},{"sc_id":"c35","x":294,"px_width":10,"chr":"15","gridCell_value":2.1991,"cumsum_values":3565.8426},{"sc_id":"c35","x":305,"px_width":1,"chr":"16","cumsum_values":3568.8426},{"sc_id":"c35","x":306,"px_width":11,"chr":"16","gridCell_value":2.1376,"cumsum_values":3571.9802},{"sc_id":"c35","x":318,"px_width":10,"chr":"17","gridCell_value":1.1048,"cumsum_values":3575.085},{"sc_id":"c35","x":329,"px_width":10,"chr":"18","gridCell_value":2.1054,"cumsum_values":3579.1905},{"sc_id":"c35","x":340,"px_width":2,"chr":"19","cumsum_values":3582.1905},{"sc_id":"c35","x":342,"px_width":6,"chr":"19","gridCell_value":2.3015,"cumsum_values":3585.492},{"sc_id":"c35","x":349,"px_width":8,"chr":"20","gridCell_value":2.1392,"cumsum_values":3589.6312},{"sc_id":"c35","x":358,"px_width":2,"chr":"21","cumsum_values":3592.6312},{"sc_id":"c35","x":360,"px_width":4,"chr":"21","gridCell_value":2.0331,"cumsum_values":3595.6644},{"sc_id":"c35","x":365,"px_width":2,"chr":"22","cumsum_values":3598.6644},{"sc_id":"c35","x":367,"px_width":5,"chr":"22","gridCell_value":1.0792,"cumsum_values":3600.7436},{"sc_id":"c35","x":373,"px_width":19,"chr":"X","gridCell_value":2.4666,"cumsum_values":3605.2102},{"sc_id":"c35","x":393,"px_width":1,"chr":"Y","cumsum_values":3608.2102},{"sc_id":"c35","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2884,"cumsum_values":3609.4985}],"c36":[{"sc_id":"c36","x":0,"px_width":29,"chr":"1","gridCell_value":2.0774,"cumsum_values":3589.576},{"sc_id":"c36","x":30,"px_width":5,"chr":"2","gridCell_value":0.9474,"cumsum_values":3592.5233},{"sc_id":"c36","x":35,"px_width":1,"chr":"2","gridCell_value":0.2059,"cumsum_values":3593.7293},{"sc_id":"c36","x":36,"px_width":6,"chr":"2","gridCell_value":1.8009,"cumsum_values":3596.5301},{"sc_id":"c36","x":42,"px_width":1,"chr":"2","cumsum_values":3598.5301},{"sc_id":"c36","x":43,"px_width":16,"chr":"2","gridCell_value":0.9618,"cumsum_values":3600.4919},{"sc_id":"c36","x":60,"px_width":6,"chr":"3","gridCell_value":1.0499,"cumsum_values":3603.5419},{"sc_id":"c36","x":66,"px_width":1,"chr":"3","cumsum_values":3605.5419},{"sc_id":"c36","x":67,"px_width":16,"chr":"3","gridCell_value":1.71,"cumsum_values":3608.2519},{"sc_id":"c36","x":84,"px_width":23,"chr":"4","gridCell_value":0.947,"cumsum_values":3611.1989},{"sc_id":"c36","x":108,"px_width":22,"chr":"5","gridCell_value":1.9733,"cumsum_values":3615.1721},{"sc_id":"c36","x":131,"px_width":3,"chr":"6","gridCell_value":2.1462,"cumsum_values":3619.3184},{"sc_id":"c36","x":134,"px_width":1,"chr":"6","gridCell_value":0.3779,"cumsum_values":3620.6963},{"sc_id":"c36","x":135,"px_width":17,"chr":"6","gridCell_value":1.9212,"cumsum_values":3623.6175},{"sc_id":"c36","x":153,"px_width":14,"chr":"7","gridCell_value":2.0272,"cumsum_values":3627.6447},{"sc_id":"c36","x":167,"px_width":1,"chr":"7","cumsum_values":3629.6447},{"sc_id":"c36","x":168,"px_width":4,"chr":"7","gridCell_value":1.9419,"cumsum_values":3632.5866},{"sc_id":"c36","x":173,"px_width":15,"chr":"8","gridCell_value":2.0083,"cumsum_values":3636.595},{"sc_id":"c36","x":188,"px_width":1,"chr":"8","cumsum_values":3638.595},{"sc_id":"c36","x":189,"px_width":2,"chr":"8","gridCell_value":1.7264,"cumsum_values":3641.3214},{"sc_id":"c36","x":192,"px_width":17,"chr":"9","gridCell_value":1.991,"cumsum_values":3645.3124},{"sc_id":"c36","x":210,"px_width":16,"chr":"10","gridCell_value":0.9723,"cumsum_values":3648.2847},{"sc_id":"c36","x":227,"px_width":1,"chr":"11","gridCell_value":0.6022,"cumsum_values":3650.8868},{"sc_id":"c36","x":228,"px_width":16,"chr":"11","gridCell_value":1.944,"cumsum_values":3653.8308},{"sc_id":"c36","x":245,"px_width":8,"chr":"12","gridCell_value":0.9141,"cumsum_values":3656.7449},{"sc_id":"c36","x":253,"px_width":1,"chr":"12","cumsum_values":3658.7449},{"sc_id":"c36","x":254,"px_width":7,"chr":"12","gridCell_value":1.0504,"cumsum_values":3660.7953},{"sc_id":"c36","x":262,"px_width":2,"chr":"13","cumsum_values":3663.7953},{"sc_id":"c36","x":264,"px_width":3,"chr":"13","gridCell_value":0.9783,"cumsum_values":3665.7736},{"sc_id":"c36","x":267,"px_width":1,"chr":"13","cumsum_values":3667.7736},{"sc_id":"c36","x":268,"px_width":8,"chr":"13","gridCell_value":1.7623,"cumsum_values":3670.536},{"sc_id":"c36","x":277,"px_width":3,"chr":"14","cumsum_values":3673.536},{"sc_id":"c36","x":280,"px_width":10,"chr":"14","gridCell_value":2.0097,"cumsum_values":3676.5457},{"sc_id":"c36","x":291,"px_width":3,"chr":"15","cumsum_values":3679.5457},{"sc_id":"c36","x":294,"px_width":10,"chr":"15","gridCell_value":2.0784,"cumsum_values":3682.6241},{"sc_id":"c36","x":305,"px_width":1,"chr":"16","gridCell_value":1.9729,"cumsum_values":3686.597},{"sc_id":"c36","x":306,"px_width":1,"chr":"16","cumsum_values":3688.597},{"sc_id":"c36","x":307,"px_width":10,"chr":"16","gridCell_value":2.0978,"cumsum_values":3691.6949},{"sc_id":"c36","x":318,"px_width":7,"chr":"17","gridCell_value":1.0293,"cumsum_values":3694.7242},{"sc_id":"c36","x":325,"px_width":1,"chr":"17","cumsum_values":3696.7242},{"sc_id":"c36","x":326,"px_width":2,"chr":"17","gridCell_value":0.761,"cumsum_values":3698.4852},{"sc_id":"c36","x":329,"px_width":10,"chr":"18","gridCell_value":2.0521,"cumsum_values":3702.5373},{"sc_id":"c36","x":340,"px_width":2,"chr":"19","cumsum_values":3705.5373},{"sc_id":"c36","x":342,"px_width":3,"chr":"19","gridCell_value":1.9415,"cumsum_values":3708.4788},{"sc_id":"c36","x":345,"px_width":1,"chr":"19","gridCell_value":0.8842,"cumsum_values":3710.3631},{"sc_id":"c36","x":346,"px_width":2,"chr":"19","gridCell_value":2.0618,"cumsum_values":3713.4249},{"sc_id":"c36","x":349,"px_width":8,"chr":"20","gridCell_value":1.7749,"cumsum_values":3717.1997},{"sc_id":"c36","x":358,"px_width":2,"chr":"21","cumsum_values":3720.1997},{"sc_id":"c36","x":360,"px_width":4,"chr":"21","gridCell_value":1.8955,"cumsum_values":3723.0952},{"sc_id":"c36","x":365,"px_width":2,"chr":"22","cumsum_values":3726.0952},{"sc_id":"c36","x":367,"px_width":5,"chr":"22","gridCell_value":0.8293,"cumsum_values":3727.9245},{"sc_id":"c36","x":373,"px_width":19,"chr":"X","gridCell_value":2.3115,"cumsum_values":3732.236},{"sc_id":"c36","x":393,"px_width":1,"chr":"Y","cumsum_values":3735.236},{"sc_id":"c36","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2352,"cumsum_values":3736.4711}],"c37":[{"sc_id":"c37","x":0,"px_width":29,"chr":"1","gridCell_value":2.1045,"cumsum_values":3716.5757},{"sc_id":"c37","x":30,"px_width":2,"chr":"2","cumsum_values":3719.5757},{"sc_id":"c37","x":32,"px_width":3,"chr":"2","gridCell_value":0.9638,"cumsum_values":3721.5395},{"sc_id":"c37","x":35,"px_width":1,"chr":"2","gridCell_value":0.268,"cumsum_values":3722.8075},{"sc_id":"c37","x":36,"px_width":5,"chr":"2","gridCell_value":2.2597,"cumsum_values":3726.0671},{"sc_id":"c37","x":41,"px_width":18,"chr":"2","gridCell_value":0.9811,"cumsum_values":3728.0483},{"sc_id":"c37","x":60,"px_width":3,"chr":"3","gridCell_value":0.9627,"cumsum_values":3731.011},{"sc_id":"c37","x":63,"px_width":1,"chr":"3","cumsum_values":3733.011},{"sc_id":"c37","x":64,"px_width":19,"chr":"3","gridCell_value":1.5598,"cumsum_values":3735.5708},{"sc_id":"c37","x":84,"px_width":1,"chr":"4","gridCell_value":2.5104,"cumsum_values":3740.0812},{"sc_id":"c37","x":85,"px_width":1,"chr":"4","gridCell_value":1.0494,"cumsum_values":3742.1306},{"sc_id":"c37","x":86,"px_width":1,"chr":"4","cumsum_values":3744.1306},{"sc_id":"c37","x":87,"px_width":1,"chr":"4","gridCell_value":1.1553,"cumsum_values":3746.286},{"sc_id":"c37","x":88,"px_width":1,"chr":"4","cumsum_values":3748.286},{"sc_id":"c37","x":89,"px_width":10,"chr":"4","gridCell_value":1.0171,"cumsum_values":3750.303},{"sc_id":"c37","x":99,"px_width":1,"chr":"4","gridCell_value":0.4759,"cumsum_values":3751.7789},{"sc_id":"c37","x":100,"px_width":7,"chr":"4","gridCell_value":1.0043,"cumsum_values":3753.7832},{"sc_id":"c37","x":108,"px_width":22,"chr":"5","gridCell_value":2.0539,"cumsum_values":3757.8371},{"sc_id":"c37","x":131,"px_width":1,"chr":"6","cumsum_values":3760.8371},{"sc_id":"c37","x":132,"px_width":2,"chr":"6","gridCell_value":1.935,"cumsum_values":3763.7721},{"sc_id":"c37","x":134,"px_width":1,"chr":"6","gridCell_value":0.4869,"cumsum_values":3765.259},{"sc_id":"c37","x":135,"px_width":17,"chr":"6","gridCell_value":2.0667,"cumsum_values":3768.3257},{"sc_id":"c37","x":153,"px_width":14,"chr":"7","gridCell_value":2.1064,"cumsum_values":3772.4321},{"sc_id":"c37","x":167,"px_width":2,"chr":"7","cumsum_values":3774.4321},{"sc_id":"c37","x":169,"px_width":3,"chr":"7","gridCell_value":2.2309,"cumsum_values":3777.663},{"sc_id":"c37","x":173,"px_width":18,"chr":"8","gridCell_value":1.9588,"cumsum_values":3781.6218},{"sc_id":"c37","x":192,"px_width":1,"chr":"9","cumsum_values":3784.6218},{"sc_id":"c37","x":193,"px_width":16,"chr":"9","gridCell_value":2.0728,"cumsum_values":3787.6946},{"sc_id":"c37","x":210,"px_width":16,"chr":"10","gridCell_value":1.0297,"cumsum_values":3790.7243},{"sc_id":"c37","x":227,"px_width":17,"chr":"11","gridCell_value":1.928,"cumsum_values":3794.6523},{"sc_id":"c37","x":245,"px_width":16,"chr":"12","gridCell_value":1.0418,"cumsum_values":3797.6941},{"sc_id":"c37","x":262,"px_width":2,"chr":"13","cumsum_values":3800.6941},{"sc_id":"c37","x":264,"px_width":12,"chr":"13","gridCell_value":1.5367,"cumsum_values":3803.2308},{"sc_id":"c37","x":277,"px_width":3,"chr":"14","cumsum_values":3806.2308},{"sc_id":"c37","x":280,"px_width":10,"chr":"14","gridCell_value":1.9916,"cumsum_values":3809.2223},{"sc_id":"c37","x":291,"px_width":3,"chr":"15","cumsum_values":3812.2223},{"sc_id":"c37","x":294,"px_width":10,"chr":"15","gridCell_value":2.1143,"cumsum_values":3815.3367},{"sc_id":"c37","x":305,"px_width":12,"chr":"16","gridCell_value":2.011,"cumsum_values":3819.3477},{"sc_id":"c37","x":318,"px_width":10,"chr":"17","gridCell_value":1.1576,"cumsum_values":3822.5052},{"sc_id":"c37","x":329,"px_width":4,"chr":"18","gridCell_value":2.0774,"cumsum_values":3826.5827},{"sc_id":"c37","x":333,"px_width":1,"chr":"18","cumsum_values":3828.5827},{"sc_id":"c37","x":334,"px_width":5,"chr":"18","gridCell_value":2.0922,"cumsum_values":3831.6748},{"sc_id":"c37","x":340,"px_width":2,"chr":"19","cumsum_values":3834.6748},{"sc_id":"c37","x":342,"px_width":6,"chr":"19","gridCell_value":2.1687,"cumsum_values":3837.8435},{"sc_id":"c37","x":349,"px_width":1,"chr":"20","gridCell_value":2.355,"cumsum_values":3842.1984},{"sc_id":"c37","x":350,"px_width":1,"chr":"20","cumsum_values":3844.1984},{"sc_id":"c37","x":351,"px_width":6,"chr":"20","gridCell_value":1.9704,"cumsum_values":3847.1689},{"sc_id":"c37","x":358,"px_width":2,"chr":"21","cumsum_values":3850.1689},{"sc_id":"c37","x":360,"px_width":4,"chr":"21","gridCell_value":1.9307,"cumsum_values":3853.0995},{"sc_id":"c37","x":365,"px_width":2,"chr":"22","cumsum_values":3856.0995},{"sc_id":"c37","x":367,"px_width":5,"chr":"22","gridCell_value":1.0205,"cumsum_values":3858.12},{"sc_id":"c37","x":373,"px_width":19,"chr":"X","gridCell_value":2.319,"cumsum_values":3862.439},{"sc_id":"c37","x":393,"px_width":1,"chr":"Y","cumsum_values":3865.439},{"sc_id":"c37","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2506,"cumsum_values":3866.6896}],"c38":[{"sc_id":"c38","x":0,"px_width":29,"chr":"1","gridCell_value":2.0691,"cumsum_values":3846.7587},{"sc_id":"c38","x":30,"px_width":1,"chr":"2","gridCell_value":1.3702,"cumsum_values":3850.129},{"sc_id":"c38","x":31,"px_width":1,"chr":"2","cumsum_values":3852.129},{"sc_id":"c38","x":32,"px_width":3,"chr":"2","gridCell_value":0.9315,"cumsum_values":3854.0605},{"sc_id":"c38","x":35,"px_width":1,"chr":"2","gridCell_value":0.2399,"cumsum_values":3855.3004},{"sc_id":"c38","x":36,"px_width":23,"chr":"2","gridCell_value":1.0902,"cumsum_values":3857.3907},{"sc_id":"c38","x":60,"px_width":6,"chr":"3","gridCell_value":0.9809,"cumsum_values":3860.3716},{"sc_id":"c38","x":66,"px_width":1,"chr":"3","cumsum_values":3862.3716},{"sc_id":"c38","x":67,"px_width":16,"chr":"3","gridCell_value":1.6473,"cumsum_values":3865.0189},{"sc_id":"c38","x":84,"px_width":23,"chr":"4","gridCell_value":1,"cumsum_values":3868.0189},{"sc_id":"c38","x":108,"px_width":14,"chr":"5","gridCell_value":1.9071,"cumsum_values":3871.926},{"sc_id":"c38","x":122,"px_width":2,"chr":"5","cumsum_values":3873.926},{"sc_id":"c38","x":124,"px_width":6,"chr":"5","gridCell_value":2.1567,"cumsum_values":3877.0827},{"sc_id":"c38","x":131,"px_width":3,"chr":"6","gridCell_value":2.0141,"cumsum_values":3881.0967},{"sc_id":"c38","x":134,"px_width":1,"chr":"6","gridCell_value":0.4783,"cumsum_values":3882.575},{"sc_id":"c38","x":135,"px_width":17,"chr":"6","gridCell_value":2.0092,"cumsum_values":3885.5842},{"sc_id":"c38","x":153,"px_width":14,"chr":"7","gridCell_value":1.9575,"cumsum_values":3889.5417},{"sc_id":"c38","x":167,"px_width":1,"chr":"7","cumsum_values":3891.5417},{"sc_id":"c38","x":168,"px_width":4,"chr":"7","gridCell_value":1.9062,"cumsum_values":3894.4479},{"sc_id":"c38","x":173,"px_width":18,"chr":"8","gridCell_value":2.0032,"cumsum_values":3898.4511},{"sc_id":"c38","x":192,"px_width":17,"chr":"9","gridCell_value":1.9333,"cumsum_values":3902.3844},{"sc_id":"c38","x":210,"px_width":16,"chr":"10","gridCell_value":1.0051,"cumsum_values":3905.3895},{"sc_id":"c38","x":227,"px_width":1,"chr":"11","cumsum_values":3908.3895},{"sc_id":"c38","x":228,"px_width":7,"chr":"11","gridCell_value":2.0994,"cumsum_values":3911.4889},{"sc_id":"c38","x":235,"px_width":1,"chr":"11","cumsum_values":3913.4889},{"sc_id":"c38","x":236,"px_width":8,"chr":"11","gridCell_value":1.9351,"cumsum_values":3916.424},{"sc_id":"c38","x":245,"px_width":16,"chr":"12","gridCell_value":0.9875,"cumsum_values":3919.4115},{"sc_id":"c38","x":262,"px_width":2,"chr":"13","cumsum_values":3922.4115},{"sc_id":"c38","x":264,"px_width":12,"chr":"13","gridCell_value":1.5729,"cumsum_values":3924.9843},{"sc_id":"c38","x":277,"px_width":3,"chr":"14","cumsum_values":3927.9843},{"sc_id":"c38","x":280,"px_width":10,"chr":"14","gridCell_value":1.9446,"cumsum_values":3930.929},{"sc_id":"c38","x":291,"px_width":3,"chr":"15","cumsum_values":3933.929},{"sc_id":"c38","x":294,"px_width":6,"chr":"15","gridCell_value":2.1586,"cumsum_values":3937.0876},{"sc_id":"c38","x":300,"px_width":1,"chr":"15","cumsum_values":3939.0876},{"sc_id":"c38","x":301,"px_width":1,"chr":"15","gridCell_value":2.1661,"cumsum_values":3942.2537},{"sc_id":"c38","x":302,"px_width":1,"chr":"15","cumsum_values":3944.2537},{"sc_id":"c38","x":303,"px_width":1,"chr":"15","gridCell_value":2.0446,"cumsum_values":3947.2982},{"sc_id":"c38","x":305,"px_width":12,"chr":"16","gridCell_value":1.9865,"cumsum_values":3951.2847},{"sc_id":"c38","x":318,"px_width":10,"chr":"17","gridCell_value":0.9438,"cumsum_values":3954.2285},{"sc_id":"c38","x":329,"px_width":10,"chr":"18","gridCell_value":1.9388,"cumsum_values":3958.1674},{"sc_id":"c38","x":340,"px_width":2,"chr":"19","cumsum_values":3961.1674},{"sc_id":"c38","x":342,"px_width":6,"chr":"19","gridCell_value":2.1009,"cumsum_values":3964.2683},{"sc_id":"c38","x":349,"px_width":1,"chr":"20","gridCell_value":2.2831,"cumsum_values":3968.5514},{"sc_id":"c38","x":350,"px_width":1,"chr":"20","cumsum_values":3970.5514},{"sc_id":"c38","x":351,"px_width":6,"chr":"20","gridCell_value":2.0484,"cumsum_values":3973.5998},{"sc_id":"c38","x":358,"px_width":2,"chr":"21","cumsum_values":3976.5998},{"sc_id":"c38","x":360,"px_width":4,"chr":"21","gridCell_value":1.8329,"cumsum_values":3979.4326},{"sc_id":"c38","x":365,"px_width":2,"chr":"22","cumsum_values":3982.4326},{"sc_id":"c38","x":367,"px_width":5,"chr":"22","gridCell_value":0.9359,"cumsum_values":3984.3686},{"sc_id":"c38","x":373,"px_width":19,"chr":"X","gridCell_value":2.2138,"cumsum_values":3988.5824},{"sc_id":"c38","x":393,"px_width":1,"chr":"Y","cumsum_values":3991.5824},{"sc_id":"c38","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2736,"cumsum_values":3992.856}],"c39":[{"sc_id":"c39","x":0,"px_width":24,"chr":"1","gridCell_value":2.0006,"cumsum_values":3972.8566},{"sc_id":"c39","x":24,"px_width":1,"chr":"1","gridCell_value":0.4989,"cumsum_values":3974.3555},{"sc_id":"c39","x":25,"px_width":4,"chr":"1","gridCell_value":2.0802,"cumsum_values":3977.4357},{"sc_id":"c39","x":30,"px_width":5,"chr":"2","gridCell_value":0.8197,"cumsum_values":3980.2554},{"sc_id":"c39","x":35,"px_width":1,"chr":"2","gridCell_value":0.1502,"cumsum_values":3981.4056},{"sc_id":"c39","x":36,"px_width":2,"chr":"2","gridCell_value":1.7439,"cumsum_values":3984.1495},{"sc_id":"c39","x":38,"px_width":1,"chr":"2","cumsum_values":3986.1495},{"sc_id":"c39","x":39,"px_width":3,"chr":"2","gridCell_value":1.5896,"cumsum_values":3988.7391},{"sc_id":"c39","x":42,"px_width":1,"chr":"2","cumsum_values":3990.7391},{"sc_id":"c39","x":43,"px_width":16,"chr":"2","gridCell_value":0.9073,"cumsum_values":3992.6464},{"sc_id":"c39","x":60,"px_width":23,"chr":"3","gridCell_value":1.3286,"cumsum_values":3995.975},{"sc_id":"c39","x":84,"px_width":23,"chr":"4","gridCell_value":0.9688,"cumsum_values":3998.9438},{"sc_id":"c39","x":108,"px_width":22,"chr":"5","gridCell_value":1.8822,"cumsum_values":4002.826},{"sc_id":"c39","x":131,"px_width":3,"chr":"6","gridCell_value":1.6543,"cumsum_values":4006.4803},{"sc_id":"c39","x":134,"px_width":1,"chr":"6","gridCell_value":0.5544,"cumsum_values":4008.0347},{"sc_id":"c39","x":135,"px_width":17,"chr":"6","gridCell_value":1.9215,"cumsum_values":4010.9561},{"sc_id":"c39","x":153,"px_width":19,"chr":"7","gridCell_value":1.8987,"cumsum_values":4014.8548},{"sc_id":"c39","x":173,"px_width":18,"chr":"8","gridCell_value":1.8357,"cumsum_values":4018.6905},{"sc_id":"c39","x":192,"px_width":8,"chr":"9","gridCell_value":2.0835,"cumsum_values":4022.774},{"sc_id":"c39","x":200,"px_width":1,"chr":"9","cumsum_values":4024.774},{"sc_id":"c39","x":201,"px_width":8,"chr":"9","gridCell_value":1.8527,"cumsum_values":4027.6266},{"sc_id":"c39","x":210,"px_width":16,"chr":"10","gridCell_value":0.8428,"cumsum_values":4030.4694},{"sc_id":"c39","x":227,"px_width":1,"chr":"11","gridCell_value":0.7747,"cumsum_values":4033.2441},{"sc_id":"c39","x":228,"px_width":1,"chr":"11","cumsum_values":4035.2441},{"sc_id":"c39","x":229,"px_width":15,"chr":"11","gridCell_value":2.0134,"cumsum_values":4038.2575},{"sc_id":"c39","x":245,"px_width":16,"chr":"12","gridCell_value":1.0115,"cumsum_values":4041.269},{"sc_id":"c39","x":262,"px_width":2,"chr":"13","cumsum_values":4044.269},{"sc_id":"c39","x":264,"px_width":12,"chr":"13","gridCell_value":1.4128,"cumsum_values":4046.6818},{"sc_id":"c39","x":277,"px_width":3,"chr":"14","cumsum_values":4049.6818},{"sc_id":"c39","x":280,"px_width":10,"chr":"14","gridCell_value":1.9779,"cumsum_values":4052.6598},{"sc_id":"c39","x":291,"px_width":3,"chr":"15","cumsum_values":4055.6598},{"sc_id":"c39","x":294,"px_width":10,"chr":"15","gridCell_value":1.9877,"cumsum_values":4058.6475},{"sc_id":"c39","x":305,"px_width":6,"chr":"16","gridCell_value":1.8621,"cumsum_values":4062.5095},{"sc_id":"c39","x":311,"px_width":1,"chr":"16","cumsum_values":4064.5095},{"sc_id":"c39","x":312,"px_width":5,"chr":"16","gridCell_value":1.8991,"cumsum_values":4067.4086},{"sc_id":"c39","x":318,"px_width":10,"chr":"17","gridCell_value":0.8836,"cumsum_values":4070.2922},{"sc_id":"c39","x":329,"px_width":10,"chr":"18","gridCell_value":1.9257,"cumsum_values":4074.218},{"sc_id":"c39","x":340,"px_width":2,"chr":"19","cumsum_values":4077.218},{"sc_id":"c39","x":342,"px_width":6,"chr":"19","gridCell_value":1.9153,"cumsum_values":4080.1333},{"sc_id":"c39","x":349,"px_width":8,"chr":"20","gridCell_value":1.6358,"cumsum_values":4083.7691},{"sc_id":"c39","x":358,"px_width":2,"chr":"21","cumsum_values":4086.7691},{"sc_id":"c39","x":360,"px_width":4,"chr":"21","gridCell_value":1.8441,"cumsum_values":4089.6132},{"sc_id":"c39","x":365,"px_width":2,"chr":"22","cumsum_values":4092.6132},{"sc_id":"c39","x":367,"px_width":5,"chr":"22","gridCell_value":0.9673,"cumsum_values":4094.5805},{"sc_id":"c39","x":373,"px_width":19,"chr":"X","gridCell_value":2.072,"cumsum_values":4098.6525},{"sc_id":"c39","x":393,"px_width":1,"chr":"Y","cumsum_values":4101.6525},{"sc_id":"c39","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2493,"cumsum_values":4102.9018}],"c4":[{"sc_id":"c4","x":0,"px_width":1,"chr":"1","cumsum_values":4081.9018},{"sc_id":"c4","x":1,"px_width":28,"chr":"1","gridCell_value":1.7328,"cumsum_values":4084.6346},{"sc_id":"c4","x":30,"px_width":20,"chr":"2","gridCell_value":1.6839,"cumsum_values":4088.3185},{"sc_id":"c4","x":50,"px_width":1,"chr":"2","cumsum_values":4090.3185},{"sc_id":"c4","x":51,"px_width":8,"chr":"2","gridCell_value":1.7598,"cumsum_values":4093.0783},{"sc_id":"c4","x":60,"px_width":23,"chr":"3","gridCell_value":1.8331,"cumsum_values":4096.9114},{"sc_id":"c4","x":84,"px_width":23,"chr":"4","gridCell_value":1.8945,"cumsum_values":4100.8059},{"sc_id":"c4","x":108,"px_width":21,"chr":"5","gridCell_value":1.7896,"cumsum_values":4104.5955},{"sc_id":"c4","x":129,"px_width":1,"chr":"5","cumsum_values":4106.5955},{"sc_id":"c4","x":131,"px_width":3,"chr":"6","gridCell_value":1.7023,"cumsum_values":4110.2978},{"sc_id":"c4","x":134,"px_width":1,"chr":"6","gridCell_value":0.4758,"cumsum_values":4111.7736},{"sc_id":"c4","x":135,"px_width":17,"chr":"6","gridCell_value":1.6938,"cumsum_values":4114.4674},{"sc_id":"c4","x":153,"px_width":19,"chr":"7","gridCell_value":1.86,"cumsum_values":4118.3274},{"sc_id":"c4","x":173,"px_width":16,"chr":"8","gridCell_value":1.8489,"cumsum_values":4122.1763},{"sc_id":"c4","x":189,"px_width":2,"chr":"8","gridCell_value":0.751,"cumsum_values":4123.9273},{"sc_id":"c4","x":192,"px_width":17,"chr":"9","gridCell_value":1.7412,"cumsum_values":4127.6685},{"sc_id":"c4","x":210,"px_width":16,"chr":"10","gridCell_value":1.5883,"cumsum_values":4131.2568},{"sc_id":"c4","x":227,"px_width":1,"chr":"11","gridCell_value":0.6863,"cumsum_values":4133.9431},{"sc_id":"c4","x":228,"px_width":16,"chr":"11","gridCell_value":1.7561,"cumsum_values":4136.6993},{"sc_id":"c4","x":245,"px_width":16,"chr":"12","gridCell_value":1.7706,"cumsum_values":4140.4698},{"sc_id":"c4","x":262,"px_width":2,"chr":"13","cumsum_values":4143.4698},{"sc_id":"c4","x":264,"px_width":12,"chr":"13","gridCell_value":1.8949,"cumsum_values":4146.3647},{"sc_id":"c4","x":277,"px_width":3,"chr":"14","cumsum_values":4149.3647},{"sc_id":"c4","x":280,"px_width":10,"chr":"14","gridCell_value":1.763,"cumsum_values":4152.1277},{"sc_id":"c4","x":291,"px_width":3,"chr":"15","cumsum_values":4155.1277},{"sc_id":"c4","x":294,"px_width":10,"chr":"15","gridCell_value":1.7763,"cumsum_values":4157.904},{"sc_id":"c4","x":305,"px_width":12,"chr":"16","gridCell_value":1.5976,"cumsum_values":4161.5016},{"sc_id":"c4","x":318,"px_width":10,"chr":"17","gridCell_value":1.4638,"cumsum_values":4164.9654},{"sc_id":"c4","x":329,"px_width":10,"chr":"18","gridCell_value":1.7814,"cumsum_values":4168.7467},{"sc_id":"c4","x":340,"px_width":1,"chr":"19","cumsum_values":4171.7467},{"sc_id":"c4","x":341,"px_width":7,"chr":"19","gridCell_value":1.3977,"cumsum_values":4174.1445},{"sc_id":"c4","x":349,"px_width":8,"chr":"20","gridCell_value":1.5936,"cumsum_values":4177.7381},{"sc_id":"c4","x":358,"px_width":2,"chr":"21","cumsum_values":4180.7381},{"sc_id":"c4","x":360,"px_width":4,"chr":"21","gridCell_value":1.7142,"cumsum_values":4183.4523},{"sc_id":"c4","x":365,"px_width":2,"chr":"22","cumsum_values":4186.4523},{"sc_id":"c4","x":367,"px_width":5,"chr":"22","gridCell_value":1.3695,"cumsum_values":4188.8217},{"sc_id":"c4","x":373,"px_width":19,"chr":"X","gridCell_value":2.0466,"cumsum_values":4192.8683},{"sc_id":"c4","x":393,"px_width":1,"chr":"Y","cumsum_values":4195.8683},{"sc_id":"c4","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2998,"cumsum_values":4197.168}],"c40":[{"sc_id":"c40","x":0,"px_width":29,"chr":"1","gridCell_value":2.047,"cumsum_values":4177.215},{"sc_id":"c40","x":30,"px_width":2,"chr":"2","gridCell_value":1.0134,"cumsum_values":4180.2284},{"sc_id":"c40","x":32,"px_width":1,"chr":"2","cumsum_values":4182.2284},{"sc_id":"c40","x":33,"px_width":2,"chr":"2","gridCell_value":1.0013,"cumsum_values":4184.2297},{"sc_id":"c40","x":35,"px_width":1,"chr":"2","gridCell_value":0.1534,"cumsum_values":4185.3832},{"sc_id":"c40","x":36,"px_width":23,"chr":"2","gridCell_value":1.087,"cumsum_values":4187.4702},{"sc_id":"c40","x":60,"px_width":23,"chr":"3","gridCell_value":1.4215,"cumsum_values":4190.8917},{"sc_id":"c40","x":84,"px_width":23,"chr":"4","gridCell_value":0.9705,"cumsum_values":4193.8622},{"sc_id":"c40","x":108,"px_width":22,"chr":"5","gridCell_value":1.9467,"cumsum_values":4197.8088},{"sc_id":"c40","x":131,"px_width":3,"chr":"6","gridCell_value":2.0517,"cumsum_values":4201.8605},{"sc_id":"c40","x":134,"px_width":1,"chr":"6","gridCell_value":0.3655,"cumsum_values":4203.226},{"sc_id":"c40","x":135,"px_width":17,"chr":"6","gridCell_value":2.0317,"cumsum_values":4206.2577},{"sc_id":"c40","x":153,"px_width":1,"chr":"7","gridCell_value":1.751,"cumsum_values":4210.0088},{"sc_id":"c40","x":154,"px_width":1,"chr":"7","cumsum_values":4212.0088},{"sc_id":"c40","x":155,"px_width":17,"chr":"7","gridCell_value":2.0701,"cumsum_values":4215.0789},{"sc_id":"c40","x":173,"px_width":16,"chr":"8","gridCell_value":2.1385,"cumsum_values":4219.2174},{"sc_id":"c40","x":189,"px_width":2,"chr":"8","gridCell_value":0.8812,"cumsum_values":4221.0985},{"sc_id":"c40","x":192,"px_width":17,"chr":"9","gridCell_value":1.9859,"cumsum_values":4225.0844},{"sc_id":"c40","x":210,"px_width":16,"chr":"10","gridCell_value":0.9297,"cumsum_values":4228.0142},{"sc_id":"c40","x":227,"px_width":1,"chr":"11","gridCell_value":0.367,"cumsum_values":4230.3811},{"sc_id":"c40","x":228,"px_width":16,"chr":"11","gridCell_value":1.9083,"cumsum_values":4233.2895},{"sc_id":"c40","x":245,"px_width":16,"chr":"12","gridCell_value":0.9436,"cumsum_values":4236.233},{"sc_id":"c40","x":262,"px_width":2,"chr":"13","cumsum_values":4239.233},{"sc_id":"c40","x":264,"px_width":12,"chr":"13","gridCell_value":1.5285,"cumsum_values":4241.7615},{"sc_id":"c40","x":277,"px_width":3,"chr":"14","cumsum_values":4244.7615},{"sc_id":"c40","x":280,"px_width":10,"chr":"14","gridCell_value":1.9368,"cumsum_values":4247.6983},{"sc_id":"c40","x":291,"px_width":3,"chr":"15","cumsum_values":4250.6983},{"sc_id":"c40","x":294,"px_width":5,"chr":"15","gridCell_value":2.2593,"cumsum_values":4253.9577},{"sc_id":"c40","x":299,"px_width":1,"chr":"15","cumsum_values":4255.9577},{"sc_id":"c40","x":300,"px_width":4,"chr":"15","gridCell_value":1.7939,"cumsum_values":4258.7516},{"sc_id":"c40","x":305,"px_width":1,"chr":"16","cumsum_values":4261.7516},{"sc_id":"c40","x":306,"px_width":11,"chr":"16","gridCell_value":1.8024,"cumsum_values":4264.554},{"sc_id":"c40","x":318,"px_width":10,"chr":"17","gridCell_value":0.8223,"cumsum_values":4267.3762},{"sc_id":"c40","x":329,"px_width":10,"chr":"18","gridCell_value":1.9034,"cumsum_values":4271.2797},{"sc_id":"c40","x":340,"px_width":2,"chr":"19","cumsum_values":4274.2797},{"sc_id":"c40","x":342,"px_width":6,"chr":"19","gridCell_value":1.7829,"cumsum_values":4277.0625},{"sc_id":"c40","x":349,"px_width":8,"chr":"20","gridCell_value":1.8745,"cumsum_values":4280.937},{"sc_id":"c40","x":358,"px_width":2,"chr":"21","cumsum_values":4283.937},{"sc_id":"c40","x":360,"px_width":4,"chr":"21","gridCell_value":1.9982,"cumsum_values":4286.9352},{"sc_id":"c40","x":365,"px_width":2,"chr":"22","cumsum_values":4289.9352},{"sc_id":"c40","x":367,"px_width":5,"chr":"22","gridCell_value":0.6382,"cumsum_values":4291.5734},{"sc_id":"c40","x":373,"px_width":19,"chr":"X","gridCell_value":2.3638,"cumsum_values":4295.9372},{"sc_id":"c40","x":393,"px_width":1,"chr":"Y","cumsum_values":4298.9372},{"sc_id":"c40","x":394,"px_width":2,"chr":"Y","gridCell_value":0.267,"cumsum_values":4300.2041}],"c41":[{"sc_id":"c41","x":0,"px_width":29,"chr":"1","gridCell_value":2.004,"cumsum_values":4280.2082},{"sc_id":"c41","x":30,"px_width":29,"chr":"2","gridCell_value":0.9983,"cumsum_values":4283.2065},{"sc_id":"c41","x":60,"px_width":23,"chr":"3","gridCell_value":1.4579,"cumsum_values":4286.6644},{"sc_id":"c41","x":84,"px_width":23,"chr":"4","gridCell_value":0.9302,"cumsum_values":4289.5946},{"sc_id":"c41","x":108,"px_width":22,"chr":"5","gridCell_value":1.9542,"cumsum_values":4293.5488},{"sc_id":"c41","x":131,"px_width":3,"chr":"6","gridCell_value":2.0711,"cumsum_values":4297.6199},{"sc_id":"c41","x":134,"px_width":1,"chr":"6","gridCell_value":0.359,"cumsum_values":4298.9789},{"sc_id":"c41","x":135,"px_width":17,"chr":"6","gridCell_value":2.0598,"cumsum_values":4302.0387},{"sc_id":"c41","x":153,"px_width":19,"chr":"7","gridCell_value":1.8591,"cumsum_values":4305.8978},{"sc_id":"c41","x":173,"px_width":18,"chr":"8","gridCell_value":1.88,"cumsum_values":4309.7777},{"sc_id":"c41","x":192,"px_width":17,"chr":"9","gridCell_value":1.8932,"cumsum_values":4313.6709},{"sc_id":"c41","x":210,"px_width":16,"chr":"10","gridCell_value":0.9408,"cumsum_values":4316.6117},{"sc_id":"c41","x":227,"px_width":1,"chr":"11","gridCell_value":0.5996,"cumsum_values":4319.2113},{"sc_id":"c41","x":228,"px_width":16,"chr":"11","gridCell_value":1.8887,"cumsum_values":4322.1},{"sc_id":"c41","x":245,"px_width":16,"chr":"12","gridCell_value":0.8994,"cumsum_values":4324.9994},{"sc_id":"c41","x":262,"px_width":2,"chr":"13","cumsum_values":4327.9994},{"sc_id":"c41","x":264,"px_width":12,"chr":"13","gridCell_value":1.5369,"cumsum_values":4330.5363},{"sc_id":"c41","x":277,"px_width":3,"chr":"14","cumsum_values":4333.5363},{"sc_id":"c41","x":280,"px_width":6,"chr":"14","gridCell_value":1.874,"cumsum_values":4336.4103},{"sc_id":"c41","x":286,"px_width":1,"chr":"14","cumsum_values":4338.4103},{"sc_id":"c41","x":287,"px_width":3,"chr":"14","gridCell_value":1.8864,"cumsum_values":4341.2966},{"sc_id":"c41","x":291,"px_width":3,"chr":"15","cumsum_values":4344.2966},{"sc_id":"c41","x":294,"px_width":10,"chr":"15","gridCell_value":1.9609,"cumsum_values":4347.2575},{"sc_id":"c41","x":305,"px_width":12,"chr":"16","gridCell_value":1.7777,"cumsum_values":4351.0352},{"sc_id":"c41","x":318,"px_width":10,"chr":"17","gridCell_value":0.8476,"cumsum_values":4353.8828},{"sc_id":"c41","x":329,"px_width":10,"chr":"18","gridCell_value":1.9755,"cumsum_values":4357.8582},{"sc_id":"c41","x":340,"px_width":2,"chr":"19","cumsum_values":4360.8582},{"sc_id":"c41","x":342,"px_width":6,"chr":"19","gridCell_value":1.8805,"cumsum_values":4363.7387},{"sc_id":"c41","x":349,"px_width":8,"chr":"20","gridCell_value":1.9469,"cumsum_values":4367.6856},{"sc_id":"c41","x":358,"px_width":2,"chr":"21","cumsum_values":4370.6856},{"sc_id":"c41","x":360,"px_width":4,"chr":"21","gridCell_value":1.6913,"cumsum_values":4373.3769},{"sc_id":"c41","x":365,"px_width":2,"chr":"22","cumsum_values":4376.3769},{"sc_id":"c41","x":367,"px_width":5,"chr":"22","gridCell_value":0.8348,"cumsum_values":4378.2117},{"sc_id":"c41","x":373,"px_width":19,"chr":"X","gridCell_value":2.2571,"cumsum_values":4382.4688},{"sc_id":"c41","x":393,"px_width":1,"chr":"Y","cumsum_values":4385.4688},{"sc_id":"c41","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2433,"cumsum_values":4386.7121}],"c42":[{"sc_id":"c42","x":0,"px_width":29,"chr":"1","gridCell_value":1.9975,"cumsum_values":4366.7096},{"sc_id":"c42","x":30,"px_width":5,"chr":"2","gridCell_value":0.918,"cumsum_values":4369.6277},{"sc_id":"c42","x":35,"px_width":1,"chr":"2","gridCell_value":0.1921,"cumsum_values":4370.8198},{"sc_id":"c42","x":36,"px_width":16,"chr":"2","gridCell_value":1.1516,"cumsum_values":4372.9713},{"sc_id":"c42","x":52,"px_width":1,"chr":"2","cumsum_values":4374.9713},{"sc_id":"c42","x":53,"px_width":6,"chr":"2","gridCell_value":0.8158,"cumsum_values":4376.7871},{"sc_id":"c42","x":60,"px_width":23,"chr":"3","gridCell_value":1.3045,"cumsum_values":4380.0916},{"sc_id":"c42","x":84,"px_width":23,"chr":"4","gridCell_value":0.9614,"cumsum_values":4383.053},{"sc_id":"c42","x":108,"px_width":16,"chr":"5","gridCell_value":1.9414,"cumsum_values":4386.9944},{"sc_id":"c42","x":124,"px_width":1,"chr":"5","cumsum_values":4388.9944},{"sc_id":"c42","x":125,"px_width":5,"chr":"5","gridCell_value":2.0168,"cumsum_values":4392.0112},{"sc_id":"c42","x":131,"px_width":3,"chr":"6","gridCell_value":1.8454,"cumsum_values":4395.8566},{"sc_id":"c42","x":134,"px_width":1,"chr":"6","gridCell_value":0.3676,"cumsum_values":4397.2242},{"sc_id":"c42","x":135,"px_width":17,"chr":"6","gridCell_value":1.9706,"cumsum_values":4400.1948},{"sc_id":"c42","x":153,"px_width":19,"chr":"7","gridCell_value":1.8663,"cumsum_values":4404.0611},{"sc_id":"c42","x":173,"px_width":18,"chr":"8","gridCell_value":1.7706,"cumsum_values":4407.8317},{"sc_id":"c42","x":192,"px_width":17,"chr":"9","gridCell_value":1.8964,"cumsum_values":4411.7281},{"sc_id":"c42","x":210,"px_width":16,"chr":"10","gridCell_value":0.9491,"cumsum_values":4414.6772},{"sc_id":"c42","x":227,"px_width":1,"chr":"11","gridCell_value":0.547,"cumsum_values":4417.2242},{"sc_id":"c42","x":228,"px_width":16,"chr":"11","gridCell_value":1.8978,"cumsum_values":4420.122},{"sc_id":"c42","x":245,"px_width":16,"chr":"12","gridCell_value":0.9894,"cumsum_values":4423.1113},{"sc_id":"c42","x":262,"px_width":2,"chr":"13","cumsum_values":4426.1113},{"sc_id":"c42","x":264,"px_width":12,"chr":"13","gridCell_value":1.4442,"cumsum_values":4428.5556},{"sc_id":"c42","x":277,"px_width":3,"chr":"14","cumsum_values":4431.5556},{"sc_id":"c42","x":280,"px_width":10,"chr":"14","gridCell_value":1.8774,"cumsum_values":4434.4329},{"sc_id":"c42","x":291,"px_width":3,"chr":"15","cumsum_values":4437.4329},{"sc_id":"c42","x":294,"px_width":10,"chr":"15","gridCell_value":1.9606,"cumsum_values":4440.3935},{"sc_id":"c42","x":305,"px_width":12,"chr":"16","gridCell_value":1.8173,"cumsum_values":4444.2108},{"sc_id":"c42","x":318,"px_width":10,"chr":"17","gridCell_value":0.959,"cumsum_values":4447.1698},{"sc_id":"c42","x":329,"px_width":10,"chr":"18","gridCell_value":1.9472,"cumsum_values":4451.117},{"sc_id":"c42","x":340,"px_width":1,"chr":"19","cumsum_values":4454.117},{"sc_id":"c42","x":341,"px_width":7,"chr":"19","gridCell_value":2.282,"cumsum_values":4457.399},{"sc_id":"c42","x":349,"px_width":8,"chr":"20","gridCell_value":1.8411,"cumsum_values":4461.2402},{"sc_id":"c42","x":358,"px_width":2,"chr":"21","cumsum_values":4464.2402},{"sc_id":"c42","x":360,"px_width":4,"chr":"21","gridCell_value":1.6923,"cumsum_values":4466.9325},{"sc_id":"c42","x":365,"px_width":2,"chr":"22","cumsum_values":4469.9325},{"sc_id":"c42","x":367,"px_width":5,"chr":"22","gridCell_value":0.9871,"cumsum_values":4471.9195},{"sc_id":"c42","x":373,"px_width":19,"chr":"X","gridCell_value":2.0177,"cumsum_values":4475.9372},{"sc_id":"c42","x":393,"px_width":1,"chr":"Y","cumsum_values":4478.9372},{"sc_id":"c42","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2461,"cumsum_values":4480.1834}],"c43":[{"sc_id":"c43","x":0,"px_width":29,"chr":"1","gridCell_value":2.0891,"cumsum_values":4460.2725},{"sc_id":"c43","x":30,"px_width":5,"chr":"2","gridCell_value":0.9577,"cumsum_values":4463.2302},{"sc_id":"c43","x":35,"px_width":1,"chr":"2","gridCell_value":0.1575,"cumsum_values":4464.3877},{"sc_id":"c43","x":36,"px_width":10,"chr":"2","gridCell_value":1.4166,"cumsum_values":4466.8043},{"sc_id":"c43","x":46,"px_width":1,"chr":"2","cumsum_values":4468.8043},{"sc_id":"c43","x":47,"px_width":7,"chr":"2","gridCell_value":0.9495,"cumsum_values":4470.7538},{"sc_id":"c43","x":54,"px_width":1,"chr":"2","cumsum_values":4472.7538},{"sc_id":"c43","x":55,"px_width":2,"chr":"2","gridCell_value":0.9298,"cumsum_values":4474.6836},{"sc_id":"c43","x":57,"px_width":1,"chr":"2","cumsum_values":4476.6836},{"sc_id":"c43","x":58,"px_width":1,"chr":"2","gridCell_value":1.2098,"cumsum_values":4478.8935},{"sc_id":"c43","x":60,"px_width":23,"chr":"3","gridCell_value":1.4227,"cumsum_values":4482.3161},{"sc_id":"c43","x":84,"px_width":23,"chr":"4","gridCell_value":1.0407,"cumsum_values":4485.3568},{"sc_id":"c43","x":108,"px_width":13,"chr":"5","gridCell_value":2.0252,"cumsum_values":4489.382},{"sc_id":"c43","x":121,"px_width":1,"chr":"5","cumsum_values":4491.382},{"sc_id":"c43","x":122,"px_width":2,"chr":"5","gridCell_value":2.0989,"cumsum_values":4494.4809},{"sc_id":"c43","x":124,"px_width":1,"chr":"5","cumsum_values":4496.4809},{"sc_id":"c43","x":125,"px_width":5,"chr":"5","gridCell_value":1.9682,"cumsum_values":4499.4491},{"sc_id":"c43","x":131,"px_width":3,"chr":"6","gridCell_value":2.0184,"cumsum_values":4503.4675},{"sc_id":"c43","x":134,"px_width":1,"chr":"6","gridCell_value":0.3838,"cumsum_values":4504.8513},{"sc_id":"c43","x":135,"px_width":17,"chr":"6","gridCell_value":2.01,"cumsum_values":4507.8613},{"sc_id":"c43","x":153,"px_width":19,"chr":"7","gridCell_value":1.9429,"cumsum_values":4511.8042},{"sc_id":"c43","x":173,"px_width":18,"chr":"8","gridCell_value":1.99,"cumsum_values":4515.7943},{"sc_id":"c43","x":192,"px_width":17,"chr":"9","gridCell_value":1.9818,"cumsum_values":4519.776},{"sc_id":"c43","x":210,"px_width":3,"chr":"10","gridCell_value":0.8684,"cumsum_values":4522.6445},{"sc_id":"c43","x":213,"px_width":2,"chr":"10","cumsum_values":4524.6445},{"sc_id":"c43","x":215,"px_width":11,"chr":"10","gridCell_value":1.0152,"cumsum_values":4526.6597},{"sc_id":"c43","x":227,"px_width":1,"chr":"11","gridCell_value":0.737,"cumsum_values":4529.3967},{"sc_id":"c43","x":228,"px_width":16,"chr":"11","gridCell_value":1.9514,"cumsum_values":4532.3481},{"sc_id":"c43","x":245,"px_width":16,"chr":"12","gridCell_value":1.0646,"cumsum_values":4535.4127},{"sc_id":"c43","x":262,"px_width":2,"chr":"13","cumsum_values":4538.4127},{"sc_id":"c43","x":264,"px_width":2,"chr":"13","gridCell_value":1.0892,"cumsum_values":4540.5019},{"sc_id":"c43","x":266,"px_width":1,"chr":"13","cumsum_values":4542.5019},{"sc_id":"c43","x":267,"px_width":9,"chr":"13","gridCell_value":1.674,"cumsum_values":4545.1759},{"sc_id":"c43","x":277,"px_width":3,"chr":"14","cumsum_values":4548.1759},{"sc_id":"c43","x":280,"px_width":7,"chr":"14","gridCell_value":2.0145,"cumsum_values":4551.1904},{"sc_id":"c43","x":287,"px_width":1,"chr":"14","cumsum_values":4553.1904},{"sc_id":"c43","x":288,"px_width":2,"chr":"14","gridCell_value":1.8348,"cumsum_values":4556.0252},{"sc_id":"c43","x":291,"px_width":3,"chr":"15","cumsum_values":4559.0252},{"sc_id":"c43","x":294,"px_width":10,"chr":"15","gridCell_value":2.0761,"cumsum_values":4562.1013},{"sc_id":"c43","x":305,"px_width":6,"chr":"16","gridCell_value":1.9212,"cumsum_values":4566.0225},{"sc_id":"c43","x":311,"px_width":1,"chr":"16","cumsum_values":4568.0225},{"sc_id":"c43","x":312,"px_width":5,"chr":"16","gridCell_value":2.0257,"cumsum_values":4571.0482},{"sc_id":"c43","x":318,"px_width":3,"chr":"17","gridCell_value":1.0975,"cumsum_values":4574.1457},{"sc_id":"c43","x":321,"px_width":1,"chr":"17","cumsum_values":4576.1457},{"sc_id":"c43","x":322,"px_width":6,"chr":"17","gridCell_value":0.9215,"cumsum_values":4578.0671},{"sc_id":"c43","x":329,"px_width":10,"chr":"18","gridCell_value":1.7945,"cumsum_values":4581.8616},{"sc_id":"c43","x":340,"px_width":2,"chr":"19","cumsum_values":4584.8616},{"sc_id":"c43","x":342,"px_width":6,"chr":"19","gridCell_value":2.1644,"cumsum_values":4588.0261},{"sc_id":"c43","x":349,"px_width":8,"chr":"20","gridCell_value":2.106,"cumsum_values":4592.1321},{"sc_id":"c43","x":358,"px_width":2,"chr":"21","cumsum_values":4595.1321},{"sc_id":"c43","x":360,"px_width":4,"chr":"21","gridCell_value":1.8737,"cumsum_values":4598.0058},{"sc_id":"c43","x":365,"px_width":2,"chr":"22","cumsum_values":4601.0058},{"sc_id":"c43","x":367,"px_width":5,"chr":"22","gridCell_value":0.9169,"cumsum_values":4602.9227},{"sc_id":"c43","x":373,"px_width":19,"chr":"X","gridCell_value":2.2793,"cumsum_values":4607.202},{"sc_id":"c43","x":393,"px_width":1,"chr":"Y","cumsum_values":4610.202},{"sc_id":"c43","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2731,"cumsum_values":4611.4751}],"c44":[{"sc_id":"c44","x":0,"px_width":6,"chr":"1","gridCell_value":1.7784,"cumsum_values":4591.2535},{"sc_id":"c44","x":6,"px_width":1,"chr":"1","cumsum_values":4593.2535},{"sc_id":"c44","x":7,"px_width":22,"chr":"1","gridCell_value":2.2454,"cumsum_values":4596.4989},{"sc_id":"c44","x":30,"px_width":5,"chr":"2","gridCell_value":1.0449,"cumsum_values":4599.5439},{"sc_id":"c44","x":35,"px_width":1,"chr":"2","gridCell_value":0.2607,"cumsum_values":4600.8046},{"sc_id":"c44","x":36,"px_width":18,"chr":"2","gridCell_value":1.253,"cumsum_values":4603.0576},{"sc_id":"c44","x":54,"px_width":2,"chr":"2","cumsum_values":4605.0576},{"sc_id":"c44","x":56,"px_width":3,"chr":"2","gridCell_value":0.9809,"cumsum_values":4607.0385},{"sc_id":"c44","x":60,"px_width":23,"chr":"3","gridCell_value":1.5039,"cumsum_values":4610.5424},{"sc_id":"c44","x":84,"px_width":23,"chr":"4","gridCell_value":1.0558,"cumsum_values":4613.5982},{"sc_id":"c44","x":108,"px_width":22,"chr":"5","gridCell_value":2.0083,"cumsum_values":4617.6065},{"sc_id":"c44","x":131,"px_width":3,"chr":"6","gridCell_value":1.9565,"cumsum_values":4621.5631},{"sc_id":"c44","x":134,"px_width":1,"chr":"6","gridCell_value":0.3631,"cumsum_values":4622.9261},{"sc_id":"c44","x":135,"px_width":17,"chr":"6","gridCell_value":2.0591,"cumsum_values":4625.9852},{"sc_id":"c44","x":153,"px_width":9,"chr":"7","gridCell_value":1.9211,"cumsum_values":4629.9063},{"sc_id":"c44","x":162,"px_width":1,"chr":"7","cumsum_values":4631.9063},{"sc_id":"c44","x":163,"px_width":9,"chr":"7","gridCell_value":1.9856,"cumsum_values":4634.8919},{"sc_id":"c44","x":173,"px_width":15,"chr":"8","gridCell_value":2.0399,"cumsum_values":4638.9318},{"sc_id":"c44","x":188,"px_width":1,"chr":"8","cumsum_values":4640.9318},{"sc_id":"c44","x":189,"px_width":2,"chr":"8","gridCell_value":1.8186,"cumsum_values":4643.7504},{"sc_id":"c44","x":192,"px_width":17,"chr":"9","gridCell_value":2.0662,"cumsum_values":4647.8166},{"sc_id":"c44","x":210,"px_width":16,"chr":"10","gridCell_value":1.0498,"cumsum_values":4650.8664},{"sc_id":"c44","x":227,"px_width":1,"chr":"11","gridCell_value":0.8121,"cumsum_values":4653.6785},{"sc_id":"c44","x":228,"px_width":16,"chr":"11","gridCell_value":1.9887,"cumsum_values":4656.6672},{"sc_id":"c44","x":245,"px_width":16,"chr":"12","gridCell_value":1.0373,"cumsum_values":4659.7045},{"sc_id":"c44","x":262,"px_width":2,"chr":"13","cumsum_values":4662.7045},{"sc_id":"c44","x":264,"px_width":12,"chr":"13","gridCell_value":1.5684,"cumsum_values":4665.2729},{"sc_id":"c44","x":277,"px_width":3,"chr":"14","cumsum_values":4668.2729},{"sc_id":"c44","x":280,"px_width":10,"chr":"14","gridCell_value":2.0453,"cumsum_values":4671.3182},{"sc_id":"c44","x":291,"px_width":3,"chr":"15","cumsum_values":4674.3182},{"sc_id":"c44","x":294,"px_width":10,"chr":"15","gridCell_value":2.0621,"cumsum_values":4677.3803},{"sc_id":"c44","x":305,"px_width":12,"chr":"16","gridCell_value":1.9188,"cumsum_values":4681.2991},{"sc_id":"c44","x":318,"px_width":10,"chr":"17","gridCell_value":1.0058,"cumsum_values":4684.3049},{"sc_id":"c44","x":329,"px_width":10,"chr":"18","gridCell_value":2.0635,"cumsum_values":4688.3684},{"sc_id":"c44","x":340,"px_width":2,"chr":"19","cumsum_values":4691.3684},{"sc_id":"c44","x":342,"px_width":6,"chr":"19","gridCell_value":2.051,"cumsum_values":4694.4193},{"sc_id":"c44","x":349,"px_width":8,"chr":"20","gridCell_value":1.9997,"cumsum_values":4698.4191},{"sc_id":"c44","x":358,"px_width":2,"chr":"21","cumsum_values":4701.4191},{"sc_id":"c44","x":360,"px_width":4,"chr":"21","gridCell_value":2.0194,"cumsum_values":4704.4384},{"sc_id":"c44","x":365,"px_width":2,"chr":"22","cumsum_values":4707.4384},{"sc_id":"c44","x":367,"px_width":5,"chr":"22","gridCell_value":0.7945,"cumsum_values":4709.2329},{"sc_id":"c44","x":373,"px_width":4,"chr":"X","gridCell_value":2.1152,"cumsum_values":4713.3481},{"sc_id":"c44","x":377,"px_width":1,"chr":"X","gridCell_value":0.786,"cumsum_values":4715.1341},{"sc_id":"c44","x":378,"px_width":14,"chr":"X","gridCell_value":2.416,"cumsum_values":4718.5501},{"sc_id":"c44","x":393,"px_width":1,"chr":"Y","cumsum_values":4721.5501},{"sc_id":"c44","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2442,"cumsum_values":4722.7942}],"c45":[{"sc_id":"c45","x":0,"px_width":29,"chr":"1","gridCell_value":2.1699,"cumsum_values":4702.9641},{"sc_id":"c45","x":30,"px_width":5,"chr":"2","gridCell_value":1.0161,"cumsum_values":4705.9802},{"sc_id":"c45","x":35,"px_width":1,"chr":"2","gridCell_value":0.2232,"cumsum_values":4707.2034},{"sc_id":"c45","x":36,"px_width":23,"chr":"2","gridCell_value":1.1852,"cumsum_values":4709.3886},{"sc_id":"c45","x":60,"px_width":23,"chr":"3","gridCell_value":1.5494,"cumsum_values":4712.9379},{"sc_id":"c45","x":84,"px_width":23,"chr":"4","gridCell_value":1.1008,"cumsum_values":4716.0388},{"sc_id":"c45","x":108,"px_width":3,"chr":"5","gridCell_value":2.0935,"cumsum_values":4720.1323},{"sc_id":"c45","x":111,"px_width":1,"chr":"5","cumsum_values":4722.1323},{"sc_id":"c45","x":112,"px_width":18,"chr":"5","gridCell_value":2.1307,"cumsum_values":4725.2629},{"sc_id":"c45","x":131,"px_width":3,"chr":"6","gridCell_value":2.0592,"cumsum_values":4729.3221},{"sc_id":"c45","x":134,"px_width":1,"chr":"6","gridCell_value":0.4033,"cumsum_values":4730.7254},{"sc_id":"c45","x":135,"px_width":17,"chr":"6","gridCell_value":2.1034,"cumsum_values":4733.8288},{"sc_id":"c45","x":153,"px_width":19,"chr":"7","gridCell_value":2.0385,"cumsum_values":4737.8673},{"sc_id":"c45","x":173,"px_width":18,"chr":"8","gridCell_value":2.0078,"cumsum_values":4741.875},{"sc_id":"c45","x":192,"px_width":17,"chr":"9","gridCell_value":1.9964,"cumsum_values":4745.8714},{"sc_id":"c45","x":210,"px_width":16,"chr":"10","gridCell_value":1.0727,"cumsum_values":4748.9442},{"sc_id":"c45","x":227,"px_width":1,"chr":"11","gridCell_value":0.6824,"cumsum_values":4751.6265},{"sc_id":"c45","x":228,"px_width":16,"chr":"11","gridCell_value":2.0883,"cumsum_values":4754.7148},{"sc_id":"c45","x":245,"px_width":16,"chr":"12","gridCell_value":1.0991,"cumsum_values":4757.8139},{"sc_id":"c45","x":262,"px_width":2,"chr":"13","cumsum_values":4760.8139},{"sc_id":"c45","x":264,"px_width":4,"chr":"13","gridCell_value":0.996,"cumsum_values":4762.8099},{"sc_id":"c45","x":268,"px_width":4,"chr":"13","gridCell_value":2.0474,"cumsum_values":4765.8573},{"sc_id":"c45","x":272,"px_width":1,"chr":"13","gridCell_value":1.115,"cumsum_values":4767.9723},{"sc_id":"c45","x":273,"px_width":3,"chr":"13","gridCell_value":2.1465,"cumsum_values":4771.1188},{"sc_id":"c45","x":277,"px_width":3,"chr":"14","cumsum_values":4774.1188},{"sc_id":"c45","x":280,"px_width":10,"chr":"14","gridCell_value":2.1183,"cumsum_values":4777.2371},{"sc_id":"c45","x":291,"px_width":3,"chr":"15","cumsum_values":4780.2371},{"sc_id":"c45","x":294,"px_width":10,"chr":"15","gridCell_value":2.0453,"cumsum_values":4783.2824},{"sc_id":"c45","x":305,"px_width":12,"chr":"16","gridCell_value":1.9629,"cumsum_values":4787.2453},{"sc_id":"c45","x":318,"px_width":10,"chr":"17","gridCell_value":0.9932,"cumsum_values":4790.2386},{"sc_id":"c45","x":329,"px_width":10,"chr":"18","gridCell_value":2.0717,"cumsum_values":4794.3102},{"sc_id":"c45","x":340,"px_width":2,"chr":"19","cumsum_values":4797.3102},{"sc_id":"c45","x":342,"px_width":6,"chr":"19","gridCell_value":2.195,"cumsum_values":4800.5052},{"sc_id":"c45","x":349,"px_width":8,"chr":"20","gridCell_value":1.9981,"cumsum_values":4804.5033},{"sc_id":"c45","x":358,"px_width":2,"chr":"21","cumsum_values":4807.5033},{"sc_id":"c45","x":360,"px_width":4,"chr":"21","gridCell_value":1.9191,"cumsum_values":4810.4223},{"sc_id":"c45","x":365,"px_width":2,"chr":"22","cumsum_values":4813.4223},{"sc_id":"c45","x":367,"px_width":5,"chr":"22","gridCell_value":1.0619,"cumsum_values":4815.4842},{"sc_id":"c45","x":373,"px_width":19,"chr":"X","gridCell_value":2.2971,"cumsum_values":4819.7813},{"sc_id":"c45","x":393,"px_width":1,"chr":"Y","cumsum_values":4822.7813},{"sc_id":"c45","x":394,"px_width":2,"chr":"Y","gridCell_value":0.245,"cumsum_values":4824.0262}],"c46":[{"sc_id":"c46","x":0,"px_width":29,"chr":"1","gridCell_value":2.1538,"cumsum_values":4804.18},{"sc_id":"c46","x":30,"px_width":5,"chr":"2","gridCell_value":0.9606,"cumsum_values":4807.1406},{"sc_id":"c46","x":35,"px_width":1,"chr":"2","gridCell_value":0.195,"cumsum_values":4808.3357},{"sc_id":"c46","x":36,"px_width":23,"chr":"2","gridCell_value":1.1824,"cumsum_values":4810.5181},{"sc_id":"c46","x":60,"px_width":23,"chr":"3","gridCell_value":1.5337,"cumsum_values":4814.0517},{"sc_id":"c46","x":84,"px_width":23,"chr":"4","gridCell_value":1.0409,"cumsum_values":4817.0926},{"sc_id":"c46","x":108,"px_width":22,"chr":"5","gridCell_value":2.0195,"cumsum_values":4821.1121},{"sc_id":"c46","x":131,"px_width":3,"chr":"6","gridCell_value":2.0796,"cumsum_values":4825.1917},{"sc_id":"c46","x":134,"px_width":1,"chr":"6","gridCell_value":0.4469,"cumsum_values":4826.6386},{"sc_id":"c46","x":135,"px_width":17,"chr":"6","gridCell_value":1.9902,"cumsum_values":4829.6288},{"sc_id":"c46","x":153,"px_width":19,"chr":"7","gridCell_value":2.0409,"cumsum_values":4833.6696},{"sc_id":"c46","x":173,"px_width":18,"chr":"8","gridCell_value":2.0206,"cumsum_values":4837.6903},{"sc_id":"c46","x":192,"px_width":17,"chr":"9","gridCell_value":1.996,"cumsum_values":4841.6863},{"sc_id":"c46","x":210,"px_width":16,"chr":"10","gridCell_value":1.0338,"cumsum_values":4844.7201},{"sc_id":"c46","x":227,"px_width":1,"chr":"11","gridCell_value":0.7492,"cumsum_values":4847.4693},{"sc_id":"c46","x":228,"px_width":16,"chr":"11","gridCell_value":2.0621,"cumsum_values":4850.5314},{"sc_id":"c46","x":245,"px_width":16,"chr":"12","gridCell_value":1.0919,"cumsum_values":4853.6233},{"sc_id":"c46","x":262,"px_width":2,"chr":"13","cumsum_values":4856.6233},{"sc_id":"c46","x":264,"px_width":12,"chr":"13","gridCell_value":1.5837,"cumsum_values":4859.207},{"sc_id":"c46","x":277,"px_width":3,"chr":"14","cumsum_values":4862.207},{"sc_id":"c46","x":280,"px_width":10,"chr":"14","gridCell_value":2.0245,"cumsum_values":4865.2315},{"sc_id":"c46","x":291,"px_width":3,"chr":"15","cumsum_values":4868.2315},{"sc_id":"c46","x":294,"px_width":10,"chr":"15","gridCell_value":2.0505,"cumsum_values":4871.2821},{"sc_id":"c46","x":305,"px_width":12,"chr":"16","gridCell_value":1.9784,"cumsum_values":4875.2604},{"sc_id":"c46","x":318,"px_width":10,"chr":"17","gridCell_value":0.971,"cumsum_values":4878.2315},{"sc_id":"c46","x":329,"px_width":10,"chr":"18","gridCell_value":2.0436,"cumsum_values":4882.275},{"sc_id":"c46","x":340,"px_width":2,"chr":"19","cumsum_values":4885.275},{"sc_id":"c46","x":342,"px_width":6,"chr":"19","gridCell_value":2.0893,"cumsum_values":4888.3643},{"sc_id":"c46","x":349,"px_width":8,"chr":"20","gridCell_value":1.9958,"cumsum_values":4892.3601},{"sc_id":"c46","x":358,"px_width":2,"chr":"21","cumsum_values":4895.3601},{"sc_id":"c46","x":360,"px_width":4,"chr":"21","gridCell_value":1.9848,"cumsum_values":4898.345},{"sc_id":"c46","x":365,"px_width":2,"chr":"22","cumsum_values":4901.345},{"sc_id":"c46","x":367,"px_width":5,"chr":"22","gridCell_value":0.9875,"cumsum_values":4903.3324},{"sc_id":"c46","x":373,"px_width":1,"chr":"X","cumsum_values":4906.3324},{"sc_id":"c46","x":374,"px_width":18,"chr":"X","gridCell_value":2.2346,"cumsum_values":4909.567},{"sc_id":"c46","x":393,"px_width":1,"chr":"Y","cumsum_values":4912.567},{"sc_id":"c46","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2582,"cumsum_values":4913.8252}],"c47":[{"sc_id":"c47","x":0,"px_width":29,"chr":"1","gridCell_value":2.1804,"cumsum_values":4894.0056},{"sc_id":"c47","x":30,"px_width":5,"chr":"2","gridCell_value":1.0164,"cumsum_values":4897.0221},{"sc_id":"c47","x":35,"px_width":1,"chr":"2","gridCell_value":0.2254,"cumsum_values":4898.2475},{"sc_id":"c47","x":36,"px_width":23,"chr":"2","gridCell_value":1.161,"cumsum_values":4900.4085},{"sc_id":"c47","x":60,"px_width":23,"chr":"3","gridCell_value":1.4424,"cumsum_values":4903.8509},{"sc_id":"c47","x":84,"px_width":23,"chr":"4","gridCell_value":1.0651,"cumsum_values":4906.916},{"sc_id":"c47","x":108,"px_width":22,"chr":"5","gridCell_value":2.0398,"cumsum_values":4910.9558},{"sc_id":"c47","x":131,"px_width":3,"chr":"6","gridCell_value":2.4287,"cumsum_values":4915.3845},{"sc_id":"c47","x":134,"px_width":1,"chr":"6","gridCell_value":0.4581,"cumsum_values":4916.8426},{"sc_id":"c47","x":135,"px_width":9,"chr":"6","gridCell_value":2.0756,"cumsum_values":4919.9181},{"sc_id":"c47","x":144,"px_width":1,"chr":"6","cumsum_values":4921.9181},{"sc_id":"c47","x":145,"px_width":7,"chr":"6","gridCell_value":1.9996,"cumsum_values":4924.9177},{"sc_id":"c47","x":153,"px_width":19,"chr":"7","gridCell_value":2.0398,"cumsum_values":4928.9575},{"sc_id":"c47","x":173,"px_width":18,"chr":"8","gridCell_value":1.9829,"cumsum_values":4932.9404},{"sc_id":"c47","x":192,"px_width":17,"chr":"9","gridCell_value":1.956,"cumsum_values":4936.8964},{"sc_id":"c47","x":210,"px_width":8,"chr":"10","gridCell_value":1.0791,"cumsum_values":4939.9754},{"sc_id":"c47","x":218,"px_width":1,"chr":"10","cumsum_values":4941.9754},{"sc_id":"c47","x":219,"px_width":7,"chr":"10","gridCell_value":1.0589,"cumsum_values":4944.0343},{"sc_id":"c47","x":227,"px_width":1,"chr":"11","gridCell_value":0.8678,"cumsum_values":4946.9021},{"sc_id":"c47","x":228,"px_width":16,"chr":"11","gridCell_value":1.9745,"cumsum_values":4949.8766},{"sc_id":"c47","x":245,"px_width":16,"chr":"12","gridCell_value":1.0147,"cumsum_values":4952.8914},{"sc_id":"c47","x":262,"px_width":2,"chr":"13","cumsum_values":4955.8914},{"sc_id":"c47","x":264,"px_width":12,"chr":"13","gridCell_value":1.4946,"cumsum_values":4958.386},{"sc_id":"c47","x":277,"px_width":3,"chr":"14","cumsum_values":4961.386},{"sc_id":"c47","x":280,"px_width":10,"chr":"14","gridCell_value":2.0577,"cumsum_values":4964.4437},{"sc_id":"c47","x":291,"px_width":3,"chr":"15","cumsum_values":4967.4437},{"sc_id":"c47","x":294,"px_width":10,"chr":"15","gridCell_value":2.07,"cumsum_values":4970.5136},{"sc_id":"c47","x":305,"px_width":1,"chr":"16","cumsum_values":4973.5136},{"sc_id":"c47","x":306,"px_width":11,"chr":"16","gridCell_value":1.9485,"cumsum_values":4976.4622},{"sc_id":"c47","x":318,"px_width":10,"chr":"17","gridCell_value":1.0453,"cumsum_values":4979.5075},{"sc_id":"c47","x":329,"px_width":10,"chr":"18","gridCell_value":1.9145,"cumsum_values":4983.422},{"sc_id":"c47","x":340,"px_width":2,"chr":"19","cumsum_values":4986.422},{"sc_id":"c47","x":342,"px_width":6,"chr":"19","gridCell_value":2.2038,"cumsum_values":4989.6258},{"sc_id":"c47","x":349,"px_width":8,"chr":"20","gridCell_value":1.9701,"cumsum_values":4993.596},{"sc_id":"c47","x":358,"px_width":2,"chr":"21","cumsum_values":4996.596},{"sc_id":"c47","x":360,"px_width":4,"chr":"21","gridCell_value":2.0094,"cumsum_values":4999.6054},{"sc_id":"c47","x":365,"px_width":2,"chr":"22","cumsum_values":5002.6054},{"sc_id":"c47","x":367,"px_width":5,"chr":"22","gridCell_value":1.0285,"cumsum_values":5004.6339},{"sc_id":"c47","x":373,"px_width":4,"chr":"X","gridCell_value":2.0581,"cumsum_values":5008.692},{"sc_id":"c47","x":377,"px_width":1,"chr":"X","cumsum_values":5010.692},{"sc_id":"c47","x":378,"px_width":6,"chr":"X","gridCell_value":2.5191,"cumsum_values":5014.2111},{"sc_id":"c47","x":384,"px_width":1,"chr":"X","cumsum_values":5016.2111},{"sc_id":"c47","x":385,"px_width":7,"chr":"X","gridCell_value":2.3075,"cumsum_values":5019.5185},{"sc_id":"c47","x":393,"px_width":1,"chr":"Y","cumsum_values":5022.5185},{"sc_id":"c47","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2952,"cumsum_values":5023.8137}],"c48":[{"sc_id":"c48","x":0,"px_width":6,"chr":"1","gridCell_value":1.8038,"cumsum_values":5003.6174},{"sc_id":"c48","x":6,"px_width":1,"chr":"1","cumsum_values":5005.6174},{"sc_id":"c48","x":7,"px_width":20,"chr":"1","gridCell_value":2.0672,"cumsum_values":5008.6847},{"sc_id":"c48","x":27,"px_width":1,"chr":"1","cumsum_values":5010.6847},{"sc_id":"c48","x":28,"px_width":1,"chr":"1","gridCell_value":2.9306,"cumsum_values":5014.6153},{"sc_id":"c48","x":30,"px_width":5,"chr":"2","gridCell_value":1.0139,"cumsum_values":5017.6291},{"sc_id":"c48","x":35,"px_width":1,"chr":"2","cumsum_values":5019.6291},{"sc_id":"c48","x":36,"px_width":23,"chr":"2","gridCell_value":0.9632,"cumsum_values":5021.5923},{"sc_id":"c48","x":60,"px_width":16,"chr":"3","gridCell_value":1.0963,"cumsum_values":5024.6887},{"sc_id":"c48","x":76,"px_width":1,"chr":"3","cumsum_values":5026.6887},{"sc_id":"c48","x":77,"px_width":6,"chr":"3","gridCell_value":1.8308,"cumsum_values":5029.5195},{"sc_id":"c48","x":84,"px_width":21,"chr":"4","gridCell_value":0.8207,"cumsum_values":5032.3403},{"sc_id":"c48","x":105,"px_width":2,"chr":"4","gridCell_value":0.2412,"cumsum_values":5033.5815},{"sc_id":"c48","x":108,"px_width":22,"chr":"5","gridCell_value":1.7576,"cumsum_values":5037.3391},{"sc_id":"c48","x":131,"px_width":3,"chr":"6","gridCell_value":1.6839,"cumsum_values":5041.0229},{"sc_id":"c48","x":134,"px_width":1,"chr":"6","gridCell_value":0.4495,"cumsum_values":5042.4724},{"sc_id":"c48","x":135,"px_width":10,"chr":"6","gridCell_value":1.805,"cumsum_values":5045.2774},{"sc_id":"c48","x":145,"px_width":1,"chr":"6","cumsum_values":5047.2774},{"sc_id":"c48","x":146,"px_width":6,"chr":"6","gridCell_value":1.8468,"cumsum_values":5050.1242},{"sc_id":"c48","x":153,"px_width":19,"chr":"7","gridCell_value":1.797,"cumsum_values":5053.9212},{"sc_id":"c48","x":173,"px_width":18,"chr":"8","gridCell_value":1.8133,"cumsum_values":5057.7345},{"sc_id":"c48","x":192,"px_width":17,"chr":"9","gridCell_value":1.916,"cumsum_values":5061.6505},{"sc_id":"c48","x":210,"px_width":16,"chr":"10","gridCell_value":0.845,"cumsum_values":5064.4955},{"sc_id":"c48","x":227,"px_width":17,"chr":"11","gridCell_value":1.6246,"cumsum_values":5068.1201},{"sc_id":"c48","x":245,"px_width":1,"chr":"12","cumsum_values":5071.1201},{"sc_id":"c48","x":246,"px_width":15,"chr":"12","gridCell_value":0.8286,"cumsum_values":5072.9488},{"sc_id":"c48","x":262,"px_width":2,"chr":"13","cumsum_values":5075.9488},{"sc_id":"c48","x":264,"px_width":12,"chr":"13","gridCell_value":1.3692,"cumsum_values":5078.3179},{"sc_id":"c48","x":277,"px_width":3,"chr":"14","cumsum_values":5081.3179},{"sc_id":"c48","x":280,"px_width":10,"chr":"14","gridCell_value":1.7994,"cumsum_values":5084.1173},{"sc_id":"c48","x":291,"px_width":3,"chr":"15","cumsum_values":5087.1173},{"sc_id":"c48","x":294,"px_width":10,"chr":"15","gridCell_value":1.9348,"cumsum_values":5090.0521},{"sc_id":"c48","x":305,"px_width":12,"chr":"16","gridCell_value":1.7162,"cumsum_values":5093.7683},{"sc_id":"c48","x":318,"px_width":10,"chr":"17","gridCell_value":0.8112,"cumsum_values":5096.5795},{"sc_id":"c48","x":329,"px_width":10,"chr":"18","gridCell_value":1.5036,"cumsum_values":5100.0831},{"sc_id":"c48","x":340,"px_width":8,"chr":"19","gridCell_value":1.7162,"cumsum_values":5103.7993},{"sc_id":"c48","x":349,"px_width":8,"chr":"20","gridCell_value":1.7604,"cumsum_values":5107.5597},{"sc_id":"c48","x":358,"px_width":2,"chr":"21","cumsum_values":5110.5597},{"sc_id":"c48","x":360,"px_width":3,"chr":"21","gridCell_value":1.6304,"cumsum_values":5113.19},{"sc_id":"c48","x":363,"px_width":1,"chr":"21","cumsum_values":5115.19},{"sc_id":"c48","x":365,"px_width":2,"chr":"22","cumsum_values":5116.19},{"sc_id":"c48","x":367,"px_width":2,"chr":"22","gridCell_value":1.1682,"cumsum_values":5118.3582},{"sc_id":"c48","x":369,"px_width":1,"chr":"22","cumsum_values":5120.3582},{"sc_id":"c48","x":370,"px_width":2,"chr":"22","gridCell_value":0.9955,"cumsum_values":5122.3537},{"sc_id":"c48","x":373,"px_width":19,"chr":"X","gridCell_value":2.0419,"cumsum_values":5126.3956},{"sc_id":"c48","x":393,"px_width":1,"chr":"Y","cumsum_values":5129.3956},{"sc_id":"c48","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2667,"cumsum_values":5130.6624}],"c49":[{"sc_id":"c49","x":0,"px_width":29,"chr":"1","gridCell_value":2.0639,"cumsum_values":5110.7263},{"sc_id":"c49","x":30,"px_width":5,"chr":"2","gridCell_value":0.9328,"cumsum_values":5113.6591},{"sc_id":"c49","x":35,"px_width":1,"chr":"2","gridCell_value":0.1798,"cumsum_values":5114.8389},{"sc_id":"c49","x":36,"px_width":8,"chr":"2","gridCell_value":1.5891,"cumsum_values":5117.428},{"sc_id":"c49","x":44,"px_width":1,"chr":"2","cumsum_values":5119.428},{"sc_id":"c49","x":45,"px_width":10,"chr":"2","gridCell_value":0.948,"cumsum_values":5121.376},{"sc_id":"c49","x":55,"px_width":1,"chr":"2","cumsum_values":5123.376},{"sc_id":"c49","x":56,"px_width":1,"chr":"2","gridCell_value":0.6157,"cumsum_values":5124.9917},{"sc_id":"c49","x":57,"px_width":1,"chr":"2","cumsum_values":5126.9917},{"sc_id":"c49","x":58,"px_width":1,"chr":"2","gridCell_value":0.6451,"cumsum_values":5128.6367},{"sc_id":"c49","x":60,"px_width":9,"chr":"3","gridCell_value":1.0724,"cumsum_values":5131.7091},{"sc_id":"c49","x":69,"px_width":2,"chr":"3","cumsum_values":5133.7091},{"sc_id":"c49","x":71,"px_width":1,"chr":"3","gridCell_value":2.1221,"cumsum_values":5136.8312},{"sc_id":"c49","x":72,"px_width":1,"chr":"3","cumsum_values":5138.8312},{"sc_id":"c49","x":73,"px_width":4,"chr":"3","gridCell_value":1.9793,"cumsum_values":5141.8105},{"sc_id":"c49","x":77,"px_width":1,"chr":"3","cumsum_values":5143.8105},{"sc_id":"c49","x":78,"px_width":5,"chr":"3","gridCell_value":2.0568,"cumsum_values":5146.8673},{"sc_id":"c49","x":84,"px_width":1,"chr":"4","gridCell_value":2.6638,"cumsum_values":5151.5311},{"sc_id":"c49","x":85,"px_width":22,"chr":"4","gridCell_value":0.9159,"cumsum_values":5153.447},{"sc_id":"c49","x":108,"px_width":3,"chr":"5","gridCell_value":1.7121,"cumsum_values":5157.1591},{"sc_id":"c49","x":111,"px_width":1,"chr":"5","cumsum_values":5159.1591},{"sc_id":"c49","x":112,"px_width":18,"chr":"5","gridCell_value":1.8996,"cumsum_values":5162.0587},{"sc_id":"c49","x":131,"px_width":3,"chr":"6","gridCell_value":2.221,"cumsum_values":5166.2797},{"sc_id":"c49","x":134,"px_width":1,"chr":"6","gridCell_value":0.4483,"cumsum_values":5167.7281},{"sc_id":"c49","x":135,"px_width":17,"chr":"6","gridCell_value":1.6914,"cumsum_values":5170.4194},{"sc_id":"c49","x":153,"px_width":19,"chr":"7","gridCell_value":1.8561,"cumsum_values":5174.2756},{"sc_id":"c49","x":173,"px_width":18,"chr":"8","gridCell_value":1.9436,"cumsum_values":5178.2191},{"sc_id":"c49","x":192,"px_width":17,"chr":"9","gridCell_value":2.0439,"cumsum_values":5182.263},{"sc_id":"c49","x":210,"px_width":16,"chr":"10","gridCell_value":0.969,"cumsum_values":5185.232},{"sc_id":"c49","x":227,"px_width":1,"chr":"11","gridCell_value":0.8273,"cumsum_values":5188.0593},{"sc_id":"c49","x":228,"px_width":16,"chr":"11","gridCell_value":1.9487,"cumsum_values":5191.008},{"sc_id":"c49","x":245,"px_width":12,"chr":"12","gridCell_value":0.9687,"cumsum_values":5193.9767},{"sc_id":"c49","x":257,"px_width":1,"chr":"12","cumsum_values":5195.9767},{"sc_id":"c49","x":258,"px_width":3,"chr":"12","gridCell_value":1.0714,"cumsum_values":5198.0481},{"sc_id":"c49","x":262,"px_width":2,"chr":"13","cumsum_values":5201.0481},{"sc_id":"c49","x":264,"px_width":9,"chr":"13","gridCell_value":1.1501,"cumsum_values":5203.1981},{"sc_id":"c49","x":273,"px_width":1,"chr":"13","gridCell_value":4.0086,"cumsum_values":5208.2067},{"sc_id":"c49","x":274,"px_width":2,"chr":"13","gridCell_value":1.154,"cumsum_values":5210.3608},{"sc_id":"c49","x":277,"px_width":3,"chr":"14","cumsum_values":5213.3608},{"sc_id":"c49","x":280,"px_width":10,"chr":"14","gridCell_value":1.9656,"cumsum_values":5216.3264},{"sc_id":"c49","x":291,"px_width":3,"chr":"15","cumsum_values":5219.3264},{"sc_id":"c49","x":294,"px_width":10,"chr":"15","gridCell_value":2.0508,"cumsum_values":5222.3773},{"sc_id":"c49","x":305,"px_width":12,"chr":"16","gridCell_value":2.1543,"cumsum_values":5226.5315},{"sc_id":"c49","x":318,"px_width":5,"chr":"17","gridCell_value":1.033,"cumsum_values":5229.5645},{"sc_id":"c49","x":323,"px_width":1,"chr":"17","cumsum_values":5231.5645},{"sc_id":"c49","x":324,"px_width":1,"chr":"17","gridCell_value":0.9462,"cumsum_values":5233.5107},{"sc_id":"c49","x":325,"px_width":1,"chr":"17","cumsum_values":5235.5107},{"sc_id":"c49","x":326,"px_width":2,"chr":"17","gridCell_value":0.4202,"cumsum_values":5236.9309},{"sc_id":"c49","x":329,"px_width":10,"chr":"18","gridCell_value":1.6998,"cumsum_values":5240.6308},{"sc_id":"c49","x":340,"px_width":2,"chr":"19","cumsum_values":5243.6308},{"sc_id":"c49","x":342,"px_width":4,"chr":"19","gridCell_value":2.2534,"cumsum_values":5246.8842},{"sc_id":"c49","x":346,"px_width":1,"chr":"19","cumsum_values":5248.8842},{"sc_id":"c49","x":347,"px_width":1,"chr":"19","gridCell_value":2.1373,"cumsum_values":5252.0215},{"sc_id":"c49","x":349,"px_width":4,"chr":"20","gridCell_value":2.3625,"cumsum_values":5256.384},{"sc_id":"c49","x":353,"px_width":1,"chr":"20","cumsum_values":5258.384},{"sc_id":"c49","x":354,"px_width":3,"chr":"20","gridCell_value":2.1047,"cumsum_values":5261.4886},{"sc_id":"c49","x":358,"px_width":2,"chr":"21","cumsum_values":5264.4886},{"sc_id":"c49","x":360,"px_width":4,"chr":"21","gridCell_value":2.0074,"cumsum_values":5267.496},{"sc_id":"c49","x":365,"px_width":2,"chr":"22","cumsum_values":5270.496},{"sc_id":"c49","x":367,"px_width":5,"chr":"22","gridCell_value":1.299,"cumsum_values":5272.795},{"sc_id":"c49","x":373,"px_width":19,"chr":"X","gridCell_value":1.9659,"cumsum_values":5276.7609},{"sc_id":"c49","x":393,"px_width":1,"chr":"Y","cumsum_values":5279.7609},{"sc_id":"c49","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2379,"cumsum_values":5280.9988}],"c5":[{"sc_id":"c5","x":0,"px_width":1,"chr":"1","gridCell_value":1.7223,"cumsum_values":5260.7211},{"sc_id":"c5","x":1,"px_width":1,"chr":"1","cumsum_values":5262.7211},{"sc_id":"c5","x":2,"px_width":27,"chr":"1","gridCell_value":1.9145,"cumsum_values":5265.6356},{"sc_id":"c5","x":30,"px_width":29,"chr":"2","gridCell_value":1.8457,"cumsum_values":5269.4813},{"sc_id":"c5","x":60,"px_width":23,"chr":"3","gridCell_value":1.8783,"cumsum_values":5273.3596},{"sc_id":"c5","x":84,"px_width":2,"chr":"4","gridCell_value":1.9012,"cumsum_values":5277.2608},{"sc_id":"c5","x":86,"px_width":1,"chr":"4","cumsum_values":5279.2608},{"sc_id":"c5","x":87,"px_width":2,"chr":"4","gridCell_value":1.8612,"cumsum_values":5282.1219},{"sc_id":"c5","x":89,"px_width":1,"chr":"4","cumsum_values":5284.1219},{"sc_id":"c5","x":90,"px_width":17,"chr":"4","gridCell_value":1.8856,"cumsum_values":5287.0075},{"sc_id":"c5","x":108,"px_width":22,"chr":"5","gridCell_value":1.93,"cumsum_values":5290.9375},{"sc_id":"c5","x":131,"px_width":3,"chr":"6","gridCell_value":1.8242,"cumsum_values":5294.7618},{"sc_id":"c5","x":134,"px_width":1,"chr":"6","gridCell_value":0.4019,"cumsum_values":5296.1637},{"sc_id":"c5","x":135,"px_width":1,"chr":"6","cumsum_values":5298.1637},{"sc_id":"c5","x":136,"px_width":16,"chr":"6","gridCell_value":1.8744,"cumsum_values":5301.0381},{"sc_id":"c5","x":153,"px_width":19,"chr":"7","gridCell_value":1.8649,"cumsum_values":5304.903},{"sc_id":"c5","x":173,"px_width":18,"chr":"8","gridCell_value":1.9099,"cumsum_values":5308.8129},{"sc_id":"c5","x":192,"px_width":8,"chr":"9","gridCell_value":1.9239,"cumsum_values":5312.7367},{"sc_id":"c5","x":200,"px_width":1,"chr":"9","cumsum_values":5314.7367},{"sc_id":"c5","x":201,"px_width":8,"chr":"9","gridCell_value":1.8731,"cumsum_values":5317.6098},{"sc_id":"c5","x":210,"px_width":16,"chr":"10","gridCell_value":1.879,"cumsum_values":5321.4888},{"sc_id":"c5","x":227,"px_width":1,"chr":"11","cumsum_values":5324.4888},{"sc_id":"c5","x":228,"px_width":16,"chr":"11","gridCell_value":1.8949,"cumsum_values":5327.3837},{"sc_id":"c5","x":245,"px_width":12,"chr":"12","gridCell_value":1.82,"cumsum_values":5331.2036},{"sc_id":"c5","x":257,"px_width":2,"chr":"12","cumsum_values":5333.2036},{"sc_id":"c5","x":259,"px_width":2,"chr":"12","gridCell_value":1.9684,"cumsum_values":5336.172},{"sc_id":"c5","x":262,"px_width":2,"chr":"13","cumsum_values":5339.172},{"sc_id":"c5","x":264,"px_width":7,"chr":"13","gridCell_value":1.8137,"cumsum_values":5341.9857},{"sc_id":"c5","x":271,"px_width":5,"chr":"13","gridCell_value":0.9484,"cumsum_values":5343.934},{"sc_id":"c5","x":277,"px_width":3,"chr":"14","cumsum_values":5346.934},{"sc_id":"c5","x":280,"px_width":6,"chr":"14","gridCell_value":1.9082,"cumsum_values":5349.8422},{"sc_id":"c5","x":286,"px_width":1,"chr":"14","cumsum_values":5351.8422},{"sc_id":"c5","x":287,"px_width":3,"chr":"14","gridCell_value":1.758,"cumsum_values":5354.6002},{"sc_id":"c5","x":291,"px_width":3,"chr":"15","cumsum_values":5357.6002},{"sc_id":"c5","x":294,"px_width":4,"chr":"15","gridCell_value":1.9737,"cumsum_values":5360.5739},{"sc_id":"c5","x":298,"px_width":1,"chr":"15","cumsum_values":5362.5739},{"sc_id":"c5","x":299,"px_width":5,"chr":"15","gridCell_value":1.8529,"cumsum_values":5365.4268},{"sc_id":"c5","x":305,"px_width":10,"chr":"16","gridCell_value":1.8612,"cumsum_values":5369.2879},{"sc_id":"c5","x":315,"px_width":2,"chr":"16","gridCell_value":1.11,"cumsum_values":5371.398},{"sc_id":"c5","x":318,"px_width":8,"chr":"17","gridCell_value":1.8524,"cumsum_values":5375.2504},{"sc_id":"c5","x":326,"px_width":1,"chr":"17","cumsum_values":5377.2504},{"sc_id":"c5","x":327,"px_width":1,"chr":"17","gridCell_value":1.7332,"cumsum_values":5379.9835},{"sc_id":"c5","x":329,"px_width":1,"chr":"18","gridCell_value":1.8582,"cumsum_values":5383.8417},{"sc_id":"c5","x":330,"px_width":1,"chr":"18","cumsum_values":5385.8417},{"sc_id":"c5","x":331,"px_width":8,"chr":"18","gridCell_value":1.8609,"cumsum_values":5388.7026},{"sc_id":"c5","x":340,"px_width":1,"chr":"19","gridCell_value":1.1326,"cumsum_values":5391.8352},{"sc_id":"c5","x":341,"px_width":4,"chr":"19","gridCell_value":1.9552,"cumsum_values":5394.7904},{"sc_id":"c5","x":345,"px_width":1,"chr":"19","cumsum_values":5396.7904},{"sc_id":"c5","x":346,"px_width":2,"chr":"19","gridCell_value":2.046,"cumsum_values":5399.8364},{"sc_id":"c5","x":349,"px_width":4,"chr":"20","gridCell_value":1.9899,"cumsum_values":5403.8263},{"sc_id":"c5","x":353,"px_width":1,"chr":"20","gridCell_value":0.9369,"cumsum_values":5405.7632},{"sc_id":"c5","x":354,"px_width":1,"chr":"20","gridCell_value":1.828,"cumsum_values":5408.5912},{"sc_id":"c5","x":355,"px_width":2,"chr":"20","gridCell_value":0.8071,"cumsum_values":5410.3983},{"sc_id":"c5","x":358,"px_width":2,"chr":"21","cumsum_values":5413.3983},{"sc_id":"c5","x":360,"px_width":4,"chr":"21","gridCell_value":1.7424,"cumsum_values":5416.1407},{"sc_id":"c5","x":365,"px_width":2,"chr":"22","cumsum_values":5419.1407},{"sc_id":"c5","x":367,"px_width":2,"chr":"22","gridCell_value":1.8811,"cumsum_values":5422.0219},{"sc_id":"c5","x":369,"px_width":1,"chr":"22","gridCell_value":1.0049,"cumsum_values":5424.0267},{"sc_id":"c5","x":370,"px_width":2,"chr":"22","gridCell_value":1.7095,"cumsum_values":5426.7363},{"sc_id":"c5","x":373,"px_width":3,"chr":"X","gridCell_value":1.8945,"cumsum_values":5430.6307},{"sc_id":"c5","x":376,"px_width":1,"chr":"X","cumsum_values":5432.6307},{"sc_id":"c5","x":377,"px_width":6,"chr":"X","gridCell_value":2.2437,"cumsum_values":5435.8745},{"sc_id":"c5","x":383,"px_width":2,"chr":"X","cumsum_values":5437.8745},{"sc_id":"c5","x":385,"px_width":5,"chr":"X","gridCell_value":2.0825,"cumsum_values":5440.957},{"sc_id":"c5","x":390,"px_width":1,"chr":"X","cumsum_values":5442.957},{"sc_id":"c5","x":391,"px_width":1,"chr":"X","gridCell_value":1.6833,"cumsum_values":5445.6403},{"sc_id":"c5","x":393,"px_width":1,"chr":"Y","cumsum_values":5448.6403},{"sc_id":"c5","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2741,"cumsum_values":5449.9144}],"c6":[{"sc_id":"c6","x":0,"px_width":1,"chr":"1","cumsum_values":5428.9144},{"sc_id":"c6","x":1,"px_width":28,"chr":"1","gridCell_value":1.6343,"cumsum_values":5431.5487},{"sc_id":"c6","x":30,"px_width":29,"chr":"2","gridCell_value":1.7435,"cumsum_values":5435.2922},{"sc_id":"c6","x":60,"px_width":19,"chr":"3","gridCell_value":1.8148,"cumsum_values":5439.107},{"sc_id":"c6","x":79,"px_width":1,"chr":"3","gridCell_value":0.6794,"cumsum_values":5440.7864},{"sc_id":"c6","x":80,"px_width":3,"chr":"3","gridCell_value":1.7378,"cumsum_values":5443.5242},{"sc_id":"c6","x":84,"px_width":15,"chr":"4","gridCell_value":1.8595,"cumsum_values":5447.3837},{"sc_id":"c6","x":99,"px_width":1,"chr":"4","cumsum_values":5449.3837},{"sc_id":"c6","x":100,"px_width":7,"chr":"4","gridCell_value":1.7714,"cumsum_values":5452.1551},{"sc_id":"c6","x":108,"px_width":22,"chr":"5","gridCell_value":1.7995,"cumsum_values":5455.9546},{"sc_id":"c6","x":131,"px_width":2,"chr":"6","gridCell_value":1.7746,"cumsum_values":5459.7292},{"sc_id":"c6","x":133,"px_width":1,"chr":"6","cumsum_values":5461.7292},{"sc_id":"c6","x":134,"px_width":1,"chr":"6","gridCell_value":0.3391,"cumsum_values":5463.0683},{"sc_id":"c6","x":135,"px_width":17,"chr":"6","gridCell_value":1.8063,"cumsum_values":5465.8746},{"sc_id":"c6","x":153,"px_width":17,"chr":"7","gridCell_value":1.7308,"cumsum_values":5469.6053},{"sc_id":"c6","x":170,"px_width":1,"chr":"7","cumsum_values":5471.6053},{"sc_id":"c6","x":171,"px_width":1,"chr":"7","gridCell_value":1.6511,"cumsum_values":5474.2564},{"sc_id":"c6","x":173,"px_width":16,"chr":"8","gridCell_value":1.8148,"cumsum_values":5478.0712},{"sc_id":"c6","x":189,"px_width":2,"chr":"8","gridCell_value":0.8649,"cumsum_values":5479.9361},{"sc_id":"c6","x":192,"px_width":17,"chr":"9","gridCell_value":1.66,"cumsum_values":5483.5961},{"sc_id":"c6","x":210,"px_width":16,"chr":"10","gridCell_value":1.6646,"cumsum_values":5487.2607},{"sc_id":"c6","x":227,"px_width":17,"chr":"11","gridCell_value":1.693,"cumsum_values":5490.9537},{"sc_id":"c6","x":245,"px_width":11,"chr":"12","gridCell_value":1.8157,"cumsum_values":5494.7694},{"sc_id":"c6","x":256,"px_width":1,"chr":"12","cumsum_values":5496.7694},{"sc_id":"c6","x":257,"px_width":4,"chr":"12","gridCell_value":1.5406,"cumsum_values":5499.31},{"sc_id":"c6","x":262,"px_width":2,"chr":"13","cumsum_values":5502.31},{"sc_id":"c6","x":264,"px_width":12,"chr":"13","gridCell_value":1.8924,"cumsum_values":5505.2024},{"sc_id":"c6","x":277,"px_width":4,"chr":"14","cumsum_values":5508.2024},{"sc_id":"c6","x":281,"px_width":4,"chr":"14","gridCell_value":1.9172,"cumsum_values":5511.1196},{"sc_id":"c6","x":285,"px_width":2,"chr":"14","cumsum_values":5513.1196},{"sc_id":"c6","x":287,"px_width":3,"chr":"14","gridCell_value":1.7745,"cumsum_values":5515.8941},{"sc_id":"c6","x":291,"px_width":3,"chr":"15","cumsum_values":5518.8941},{"sc_id":"c6","x":294,"px_width":10,"chr":"15","gridCell_value":1.7059,"cumsum_values":5521.5999},{"sc_id":"c6","x":305,"px_width":12,"chr":"16","gridCell_value":1.4864,"cumsum_values":5525.0863},{"sc_id":"c6","x":318,"px_width":10,"chr":"17","gridCell_value":1.4783,"cumsum_values":5528.5646},{"sc_id":"c6","x":329,"px_width":10,"chr":"18","gridCell_value":1.7391,"cumsum_values":5532.3036},{"sc_id":"c6","x":340,"px_width":8,"chr":"19","gridCell_value":1.3325,"cumsum_values":5535.6361},{"sc_id":"c6","x":349,"px_width":8,"chr":"20","gridCell_value":1.5789,"cumsum_values":5539.215},{"sc_id":"c6","x":358,"px_width":2,"chr":"21","cumsum_values":5542.215},{"sc_id":"c6","x":360,"px_width":1,"chr":"21","gridCell_value":2.0562,"cumsum_values":5545.2712},{"sc_id":"c6","x":361,"px_width":1,"chr":"21","cumsum_values":5547.2712},{"sc_id":"c6","x":362,"px_width":2,"chr":"21","gridCell_value":1.6316,"cumsum_values":5549.9028},{"sc_id":"c6","x":365,"px_width":2,"chr":"22","cumsum_values":5552.9028},{"sc_id":"c6","x":367,"px_width":5,"chr":"22","gridCell_value":1.3755,"cumsum_values":5555.2783},{"sc_id":"c6","x":373,"px_width":8,"chr":"X","gridCell_value":1.8417,"cumsum_values":5559.12},{"sc_id":"c6","x":381,"px_width":1,"chr":"X","cumsum_values":5561.12},{"sc_id":"c6","x":382,"px_width":10,"chr":"X","gridCell_value":2.1342,"cumsum_values":5564.2542},{"sc_id":"c6","x":393,"px_width":1,"chr":"Y","cumsum_values":5567.2542},{"sc_id":"c6","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2314,"cumsum_values":5568.4856}],"c7":[{"sc_id":"c7","x":0,"px_width":26,"chr":"1","gridCell_value":1.6468,"cumsum_values":5548.1324},{"sc_id":"c7","x":26,"px_width":1,"chr":"1","cumsum_values":5550.1324},{"sc_id":"c7","x":27,"px_width":2,"chr":"1","gridCell_value":1.7669,"cumsum_values":5552.8993},{"sc_id":"c7","x":30,"px_width":29,"chr":"2","gridCell_value":1.6968,"cumsum_values":5556.5961},{"sc_id":"c7","x":60,"px_width":6,"chr":"3","gridCell_value":1.7374,"cumsum_values":5560.3334},{"sc_id":"c7","x":66,"px_width":1,"chr":"3","cumsum_values":5562.3334},{"sc_id":"c7","x":67,"px_width":16,"chr":"3","gridCell_value":1.7057,"cumsum_values":5565.0392},{"sc_id":"c7","x":84,"px_width":11,"chr":"4","gridCell_value":1.6656,"cumsum_values":5568.7047},{"sc_id":"c7","x":95,"px_width":1,"chr":"4","cumsum_values":5570.7047},{"sc_id":"c7","x":96,"px_width":11,"chr":"4","gridCell_value":1.5285,"cumsum_values":5573.2332},{"sc_id":"c7","x":108,"px_width":22,"chr":"5","gridCell_value":1.7733,"cumsum_values":5577.0065},{"sc_id":"c7","x":131,"px_width":3,"chr":"6","gridCell_value":1.681,"cumsum_values":5580.6874},{"sc_id":"c7","x":134,"px_width":2,"chr":"6","cumsum_values":5582.6874},{"sc_id":"c7","x":136,"px_width":16,"chr":"6","gridCell_value":1.6444,"cumsum_values":5585.3319},{"sc_id":"c7","x":153,"px_width":19,"chr":"7","gridCell_value":1.6619,"cumsum_values":5588.9937},{"sc_id":"c7","x":173,"px_width":18,"chr":"8","gridCell_value":1.6597,"cumsum_values":5592.6534},{"sc_id":"c7","x":192,"px_width":17,"chr":"9","gridCell_value":1.7548,"cumsum_values":5596.4082},{"sc_id":"c7","x":210,"px_width":16,"chr":"10","gridCell_value":1.7709,"cumsum_values":5600.1791},{"sc_id":"c7","x":227,"px_width":17,"chr":"11","gridCell_value":1.656,"cumsum_values":5603.8351},{"sc_id":"c7","x":245,"px_width":16,"chr":"12","gridCell_value":1.6789,"cumsum_values":5607.514},{"sc_id":"c7","x":262,"px_width":2,"chr":"13","cumsum_values":5610.514},{"sc_id":"c7","x":264,"px_width":12,"chr":"13","gridCell_value":1.5325,"cumsum_values":5613.0465},{"sc_id":"c7","x":277,"px_width":3,"chr":"14","cumsum_values":5616.0465},{"sc_id":"c7","x":280,"px_width":10,"chr":"14","gridCell_value":1.6827,"cumsum_values":5618.7292},{"sc_id":"c7","x":291,"px_width":3,"chr":"15","cumsum_values":5621.7292},{"sc_id":"c7","x":294,"px_width":10,"chr":"15","gridCell_value":1.6726,"cumsum_values":5624.4018},{"sc_id":"c7","x":305,"px_width":12,"chr":"16","gridCell_value":1.855,"cumsum_values":5628.2568},{"sc_id":"c7","x":318,"px_width":10,"chr":"17","gridCell_value":1.7593,"cumsum_values":5632.0161},{"sc_id":"c7","x":329,"px_width":2,"chr":"18","gridCell_value":1.8573,"cumsum_values":5635.8734},{"sc_id":"c7","x":331,"px_width":1,"chr":"18","cumsum_values":5637.8734},{"sc_id":"c7","x":332,"px_width":7,"chr":"18","gridCell_value":1.7211,"cumsum_values":5640.5945},{"sc_id":"c7","x":340,"px_width":8,"chr":"19","gridCell_value":1.7627,"cumsum_values":5644.3572},{"sc_id":"c7","x":349,"px_width":8,"chr":"20","gridCell_value":1.6199,"cumsum_values":5647.9771},{"sc_id":"c7","x":358,"px_width":2,"chr":"21","cumsum_values":5650.9771},{"sc_id":"c7","x":360,"px_width":4,"chr":"21","gridCell_value":1.527,"cumsum_values":5653.5041},{"sc_id":"c7","x":365,"px_width":2,"chr":"22","cumsum_values":5656.5041},{"sc_id":"c7","x":367,"px_width":5,"chr":"22","gridCell_value":1.861,"cumsum_values":5659.3651},{"sc_id":"c7","x":373,"px_width":9,"chr":"X","gridCell_value":1.9057,"cumsum_values":5663.2708},{"sc_id":"c7","x":382,"px_width":1,"chr":"X","cumsum_values":5665.2708},{"sc_id":"c7","x":383,"px_width":9,"chr":"X","gridCell_value":1.845,"cumsum_values":5668.1158},{"sc_id":"c7","x":393,"px_width":1,"chr":"Y","cumsum_values":5671.1158},{"sc_id":"c7","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2562,"cumsum_values":5672.372}],"c8":[{"sc_id":"c8","x":0,"px_width":29,"chr":"1","gridCell_value":1.8076,"cumsum_values":5652.1796},{"sc_id":"c8","x":30,"px_width":29,"chr":"2","gridCell_value":1.8279,"cumsum_values":5656.0075},{"sc_id":"c8","x":60,"px_width":23,"chr":"3","gridCell_value":1.9686,"cumsum_values":5659.9761},{"sc_id":"c8","x":84,"px_width":23,"chr":"4","gridCell_value":1.9161,"cumsum_values":5663.8923},{"sc_id":"c8","x":108,"px_width":22,"chr":"5","gridCell_value":1.8516,"cumsum_values":5667.7439},{"sc_id":"c8","x":131,"px_width":3,"chr":"6","gridCell_value":1.914,"cumsum_values":5671.6579},{"sc_id":"c8","x":134,"px_width":1,"chr":"6","gridCell_value":0.4116,"cumsum_values":5673.0695},{"sc_id":"c8","x":135,"px_width":17,"chr":"6","gridCell_value":1.9095,"cumsum_values":5675.9791},{"sc_id":"c8","x":153,"px_width":5,"chr":"7","gridCell_value":1.8124,"cumsum_values":5679.7915},{"sc_id":"c8","x":158,"px_width":1,"chr":"7","cumsum_values":5681.7915},{"sc_id":"c8","x":159,"px_width":5,"chr":"7","gridCell_value":1.7858,"cumsum_values":5684.5773},{"sc_id":"c8","x":164,"px_width":1,"chr":"7","cumsum_values":5686.5773},{"sc_id":"c8","x":165,"px_width":7,"chr":"7","gridCell_value":1.7784,"cumsum_values":5689.3557},{"sc_id":"c8","x":173,"px_width":18,"chr":"8","gridCell_value":1.8972,"cumsum_values":5693.253},{"sc_id":"c8","x":192,"px_width":15,"chr":"9","gridCell_value":2.0354,"cumsum_values":5697.2883},{"sc_id":"c8","x":207,"px_width":2,"chr":"9","gridCell_value":1.2442,"cumsum_values":5699.5325},{"sc_id":"c8","x":210,"px_width":16,"chr":"10","gridCell_value":1.7852,"cumsum_values":5703.3177},{"sc_id":"c8","x":227,"px_width":1,"chr":"11","gridCell_value":1.0161,"cumsum_values":5706.3339},{"sc_id":"c8","x":228,"px_width":16,"chr":"11","gridCell_value":1.7657,"cumsum_values":5709.0995},{"sc_id":"c8","x":245,"px_width":5,"chr":"12","gridCell_value":1.9495,"cumsum_values":5713.049},{"sc_id":"c8","x":250,"px_width":1,"chr":"12","gridCell_value":0.8867,"cumsum_values":5714.9357},{"sc_id":"c8","x":251,"px_width":10,"chr":"12","gridCell_value":1.7446,"cumsum_values":5717.6803},{"sc_id":"c8","x":262,"px_width":2,"chr":"13","cumsum_values":5720.6803},{"sc_id":"c8","x":264,"px_width":12,"chr":"13","gridCell_value":1.844,"cumsum_values":5723.5243},{"sc_id":"c8","x":277,"px_width":3,"chr":"14","cumsum_values":5726.5243},{"sc_id":"c8","x":280,"px_width":10,"chr":"14","gridCell_value":1.8045,"cumsum_values":5729.3288},{"sc_id":"c8","x":291,"px_width":3,"chr":"15","cumsum_values":5732.3288},{"sc_id":"c8","x":294,"px_width":10,"chr":"15","gridCell_value":1.7752,"cumsum_values":5735.104},{"sc_id":"c8","x":305,"px_width":12,"chr":"16","gridCell_value":1.6538,"cumsum_values":5738.7578},{"sc_id":"c8","x":318,"px_width":10,"chr":"17","gridCell_value":1.5995,"cumsum_values":5742.3573},{"sc_id":"c8","x":329,"px_width":10,"chr":"18","gridCell_value":1.8847,"cumsum_values":5746.2419},{"sc_id":"c8","x":340,"px_width":1,"chr":"19","cumsum_values":5749.2419},{"sc_id":"c8","x":341,"px_width":7,"chr":"19","gridCell_value":1.5672,"cumsum_values":5751.8091},{"sc_id":"c8","x":349,"px_width":6,"chr":"20","gridCell_value":1.7117,"cumsum_values":5755.5208},{"sc_id":"c8","x":355,"px_width":2,"chr":"20","gridCell_value":0.8158,"cumsum_values":5757.3366},{"sc_id":"c8","x":358,"px_width":2,"chr":"21","cumsum_values":5760.3366},{"sc_id":"c8","x":360,"px_width":4,"chr":"21","gridCell_value":1.7422,"cumsum_values":5763.0788},{"sc_id":"c8","x":365,"px_width":2,"chr":"22","cumsum_values":5766.0788},{"sc_id":"c8","x":367,"px_width":5,"chr":"22","gridCell_value":1.6976,"cumsum_values":5768.7764},{"sc_id":"c8","x":373,"px_width":1,"chr":"X","cumsum_values":5771.7764},{"sc_id":"c8","x":374,"px_width":18,"chr":"X","gridCell_value":2.0997,"cumsum_values":5774.8761},{"sc_id":"c8","x":393,"px_width":1,"chr":"Y","cumsum_values":5777.8761},{"sc_id":"c8","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2372,"cumsum_values":5779.1133}],"c9":[{"sc_id":"c9","x":0,"px_width":29,"chr":"1","gridCell_value":1.7427,"cumsum_values":5758.856},{"sc_id":"c9","x":30,"px_width":29,"chr":"2","gridCell_value":1.7458,"cumsum_values":5762.6018},{"sc_id":"c9","x":60,"px_width":23,"chr":"3","gridCell_value":1.8419,"cumsum_values":5766.4437},{"sc_id":"c9","x":84,"px_width":1,"chr":"4","gridCell_value":1.6607,"cumsum_values":5770.1044},{"sc_id":"c9","x":85,"px_width":1,"chr":"4","cumsum_values":5772.1044},{"sc_id":"c9","x":86,"px_width":21,"chr":"4","gridCell_value":1.7174,"cumsum_values":5774.8218},{"sc_id":"c9","x":108,"px_width":22,"chr":"5","gridCell_value":1.8168,"cumsum_values":5778.6386},{"sc_id":"c9","x":131,"px_width":3,"chr":"6","gridCell_value":1.9199,"cumsum_values":5782.5584},{"sc_id":"c9","x":134,"px_width":1,"chr":"6","gridCell_value":0.4205,"cumsum_values":5783.979},{"sc_id":"c9","x":135,"px_width":17,"chr":"6","gridCell_value":1.8098,"cumsum_values":5786.7887},{"sc_id":"c9","x":153,"px_width":19,"chr":"7","gridCell_value":1.7279,"cumsum_values":5790.5166},{"sc_id":"c9","x":173,"px_width":18,"chr":"8","gridCell_value":1.7573,"cumsum_values":5794.274},{"sc_id":"c9","x":192,"px_width":17,"chr":"9","gridCell_value":1.7208,"cumsum_values":5797.9948},{"sc_id":"c9","x":210,"px_width":16,"chr":"10","gridCell_value":1.7767,"cumsum_values":5801.7715},{"sc_id":"c9","x":227,"px_width":17,"chr":"11","gridCell_value":1.8155,"cumsum_values":5805.587},{"sc_id":"c9","x":245,"px_width":16,"chr":"12","gridCell_value":1.7872,"cumsum_values":5809.3742},{"sc_id":"c9","x":262,"px_width":2,"chr":"13","cumsum_values":5812.3742},{"sc_id":"c9","x":264,"px_width":12,"chr":"13","gridCell_value":1.699,"cumsum_values":5815.0732},{"sc_id":"c9","x":277,"px_width":3,"chr":"14","cumsum_values":5818.0732},{"sc_id":"c9","x":280,"px_width":10,"chr":"14","gridCell_value":1.7682,"cumsum_values":5820.8415},{"sc_id":"c9","x":291,"px_width":3,"chr":"15","cumsum_values":5823.8415},{"sc_id":"c9","x":294,"px_width":10,"chr":"15","gridCell_value":1.7733,"cumsum_values":5826.6147},{"sc_id":"c9","x":305,"px_width":12,"chr":"16","gridCell_value":1.6571,"cumsum_values":5830.2719},{"sc_id":"c9","x":318,"px_width":1,"chr":"17","cumsum_values":5833.2719},{"sc_id":"c9","x":319,"px_width":9,"chr":"17","gridCell_value":1.6771,"cumsum_values":5835.949},{"sc_id":"c9","x":329,"px_width":10,"chr":"18","gridCell_value":1.7526,"cumsum_values":5839.7016},{"sc_id":"c9","x":340,"px_width":8,"chr":"19","gridCell_value":1.6593,"cumsum_values":5843.3609},{"sc_id":"c9","x":349,"px_width":8,"chr":"20","gridCell_value":1.711,"cumsum_values":5847.0719},{"sc_id":"c9","x":358,"px_width":2,"chr":"21","cumsum_values":5850.0719},{"sc_id":"c9","x":360,"px_width":4,"chr":"21","gridCell_value":1.7683,"cumsum_values":5852.8402},{"sc_id":"c9","x":365,"px_width":2,"chr":"22","cumsum_values":5855.8402},{"sc_id":"c9","x":367,"px_width":5,"chr":"22","gridCell_value":1.6894,"cumsum_values":5858.5296},{"sc_id":"c9","x":373,"px_width":19,"chr":"X","gridCell_value":2.0391,"cumsum_values":5862.5687},{"sc_id":"c9","x":393,"px_width":1,"chr":"Y","cumsum_values":5865.5687},{"sc_id":"c9","x":394,"px_width":2,"chr":"Y","gridCell_value":0.2777,"cumsum_values":5866.8464}]},"heatmap_type":"cnv","heatmapWidth":400,"value_type":"CNV","node_type":"Cell","timepoint_title":"Timepoint","clone_title":"Clone","root":"c10","display_node_ids":false,"scs_missing_from_hm":["51","50"],"continuous_cnv":true,"timescape_wanted":false},"evals":[],"jsHooks":[]}</script>
<p>To view the documentation for CellScape, type the following command in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">?cellscape</code></pre></div>
<p>CellScape was developed at the Shah Lab for Computational Cancer Biology at the BC Cancer Research Centre.</p>
<p>References:</p>
<p>Eirew, Peter, et al. Dynamics of genomic clones in breast cancer patient xenografts at single-cell resolution. Nature 518.7539 (2015): 422-426.</p>
<p>Wang, Yong, et al. Clonal evolution in breast cancer revealed by single nucleus genome sequencing. Nature 512.7513 (2014): 155-160.</p>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
